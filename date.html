<!DOCTYPE html>
<html lang="en"><head> 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
<meta charset="utf-8">
<title>Add/Subtract Days from a Date Calculator | CalcDomain</title>
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="Professional date calculator to add or subtract days from a date. Supports business days, weekends/holiday exclusion, inclusive counting, and WCAG 2.1 AA accessible UI." name="description">
<meta content="Ugo Candido" name="author">
<meta content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" name="robots">
<link href="https://calcdomain.com/date.html" rel="canonical">
<meta content="#005A9C" name="theme-color">
<meta content="website" property="og:type">
<meta content="Add/Subtract Days from a Date Calculator" property="og:title">
<meta content="Add or subtract days from any date. Optional business days mode with weekend/holiday exclusion. Fully accessible and mobile-first." property="og:description">
<meta content="https://calcdomain.com/everyday-life/time-and-date/date-calculator" property="og:url">
<meta content="CalcDomain" property="og:site_name">
<meta content="summary" name="twitter:card">
<meta content="Add/Subtract Days from a Date Calculator" name="twitter:title">
<meta content="Add or subtract days from a date, with business days, holidays, and inclusive counting. WCAG 2.1 AA compliant." name="twitter:description">
<style>
    /* Design tokens (mobile-first) */
    :root{
      --primary:#005A9C; --primary-2:#003F6E; --bg:#F8F9FA; --surface:#FFFFFF;
      --text:#212529; --muted:#6C757D; --border:#DEE2E6; --success:#198754; --danger:#DC3545;
      --radius:12px; --radius-sm:8px; --shadow:0 4px 10px rgba(0,0,0,.06);
      --touch:48px;
    }
    @media (prefers-reduced-motion:reduce){
      *{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}
    }
    *,*::before,*::after{box-sizing:border-box}
    html{font-size:clamp(16px,2.5vw,18px)}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text);line-height:1.55}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}
    .skip-link{position:absolute;left:8px;top:-40px;background:var(--primary);color:#fff;padding:.5rem .75rem;border-radius:6px;z-index:1000}
    .skip-link:focus{top:8px;outline:3px solid #fff}
    /* Layout */
    .container{max-width:1200px;margin:0 auto;padding:0 clamp(1rem,4vw,2rem)}
    header{background:var(--surface);border-bottom:1px solid var(--border)}
    .header-inner{display:grid;grid-template-columns:auto 1fr auto;gap:.75rem;align-items:center;padding:.75rem 0}
    .brand{font-weight:800;color:var(--primary);font-size:1.25rem}
    .search{display:flex;gap:.5rem;align-items:center}
    .search input[type="search"]{flex:1;min-width:0;border:1px solid var(--border);border-radius:10px;padding:.6rem .75rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1rem;min-height:var(--touch);min-width:var(--touch);border-radius:10px;border:1px solid transparent;font-weight:700;cursor:pointer;background:var(--primary);color:#fff}
    .btn.secondary{background:transparent;color:var(--primary);border-color:var(--primary)}
    .btn:focus-visible{outline:3px solid var(--primary);outline-offset:2px}
    nav[aria-label="Main navigation"] a{padding:.5rem;border-radius:6px}
    nav[aria-label="Main navigation"] a:focus-visible{outline:3px solid var(--primary);outline-offset:2px}
    main{padding:1.25rem 0}
    .breadcrumb{font-size:.9rem;color:var(--muted);margin-bottom:1rem}
    h1{font-size:clamp(1.6rem,4.5vw,2.4rem);margin:.25rem 0 .75rem;color:var(--primary-2)}
    h2{font-size:clamp(1.35rem,3.5vw,1.75rem);margin:2rem 0 .75rem;color:var(--primary-2)}
    h3{font-size:1.15rem;margin:1rem 0 .5rem;color:var(--primary-2)}
    p{max-width:70ch}
    /* Calculator layout */
    .grid{display:grid;gap:clamp(1rem,3vw,1.5rem)}
    @media (min-width: 992px){
      .grid{grid-template-columns:minmax(280px,420px) 1fr}
    }
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .calculator{padding:clamp(1rem,3vw,1.5rem)}
    .form-group{margin-bottom:1rem}
    .form-group label{display:flex;align-items:center;gap:.5rem;font-weight:700;margin-bottom:.4rem}
    .help-btn{inline-size:var(--touch);block-size:var(--touch);border-radius:50%;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:800}
    .help-btn:focus-visible{outline:3px solid var(--primary);outline-offset:2px}
    .tooltip{display:none;margin:.35rem 0 0;background:#0b2e4a;color:#fff;border-radius:8px;padding:.5rem .75rem;box-shadow:0 6px 14px rgba(0,0,0,.12)}
    .tooltip[data-open="true"]{display:block}
    .field{position:relative}
    .input, select, textarea{width:100%;min-height:var(--touch);padding:.75rem 1rem;border:1px solid var(--border);border-radius:10px;background:#fff}
    .input:focus-visible, select:focus-visible, textarea:focus-visible{outline:3px solid var(--primary);outline-offset:2px;border-color:var(--primary)}
    .error{color:var(--danger);font-size:.95rem;margin-top:.35rem}
    .radio-row{display:flex;gap:.5rem;border:1px solid var(--border);border-radius:10px;padding:.25rem}
    .radio-row input[type="radio"]{position:absolute;opacity:0}
    .radio-row label{flex:1;text-align:center;padding:.5rem .75rem;border-radius:8px;cursor:pointer;min-height:var(--touch);display:flex;align-items:center;justify-content:center}
    .radio-row input[type="radio"]:focus-visible + label{outline:3px solid var(--primary);outline-offset:2px}
    .radio-row input[type="radio"]:checked + label{background:var(--primary);color:#fff}
    .options{display:grid;gap:.5rem}
    .option{display:flex;gap:.5rem;align-items:flex-start}
    .option input[type="checkbox"]{inline-size:1.25rem;block-size:1.25rem;margin-top:.4rem}
    details{border:1px dashed var(--border);border-radius:10px;padding:.5rem .75rem;background:#fcfcfd}
    details summary{cursor:pointer;font-weight:700}
    details[open]{background:#f4f8fc}
    .textarea{min-height:120px;resize:vertical}
    .actions{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.25rem}
    /* Results */
    .results{padding:clamp(1rem,3vw,1.5rem);min-height:240px}
    .results h2{margin-top:0}
    .result-box{display:grid;gap:.75rem;background:#f6faf6;border:1px solid #d9efe0;border-radius:10px;padding:1rem}
    .kv{display:flex;justify-content:space-between;gap:1rem}
    .kv .label{color:var(--muted)}
    .kv .value{font-weight:800;color:var(--success)}
    .muted{color:var(--muted)}
    /* Content */
    .content{padding:clamp(1rem,3vw,1.5rem)}
    .formula{background:#eef2f7;border:1px solid #d9e1ea;border-radius:10px;padding:1rem;overflow:auto}
    ul{padding-left:1.25rem}
    li{margin:.4rem 0}
    .author{font-size:.95rem;color:var(--muted);border-top:1px solid var(--border);margin-top:2rem;padding-top:1rem}
    footer{background:var(--primary-2);color:#fff;margin-top:3rem}
    footer a{color:#fff}
    .footer-inner{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.25rem;padding:1.5rem 0}
    .footer-bottom{border-top:1px solid rgba(255,255,255,.25);padding:1rem 0;text-align:center;color:#d8e6f3}
    /* Focus visible alternative for older browsers */
    :focus:not(:focus-visible){outline:none}
    /* Prevent CLS on headings in results/content cards */
    .results h3, .results h2, .content h2{min-height:1.5em}
  </style>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Add/Subtract Days from a Date Calculator",
  "description": "Add or subtract days from any date. Optional business days mode, weekend/holiday exclusion, and inclusive counting. Fully accessible and mobile-first.",
  "url": "https://calcdomain.com/date.html",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step Example",
      "description": "Example: Add 45 business days to 2025-01-15, excluding weekends and holidays.",
      "totalTime": "PT5S",
      "estimatedCost": {
        "@type": "MonetaryAmount",
        "currency": "USD",
        "value": "0"
      },
      "step": [
        {
          "@type": "HowToStep",
          "name": "Choose operation",
          "text": "Select Add."
        },
        {
          "@type": "HowToStep",
          "name": "Enter start date",
          "text": "Input 2025-01-15."
        },
        {
          "@type": "HowToStep",
          "name": "Enter days and options",
          "text": "Set Number of days to 45, enable Business days, and paste holidays (e.g., 2025-02-17)."
        },
        {
          "@type": "HowToStep",
          "name": "Calculate",
          "text": "Click Calculate to obtain the resulting date and breakdown."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Does the calculator account for leap years?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. All calculations use the proleptic Gregorian calendar, which includes leap-year rules (years divisible by 4, except centuries not divisible by 400)."
          }
        },
        {
          "@type": "Question",
          "name": "What does inclusive counting mean?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "If enabled, the start date is counted as day one. For example, adding 10 days inclusive is equivalent to adding 9 days exclusive."
          }
        },
        {
          "@type": "Question",
          "name": "How are business days calculated?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Business days are Monday through Friday. If enabled, weekends are skipped. You can also exclude custom holidays you paste into the tool."
          }
        },
        {
          "@type": "Question",
          "name": "Which calendar system is used?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The proleptic Gregorian calendar. Dates are handled as date-only values using UTC to avoid daylight saving time issues."
          }
        },
        {
          "@type": "Question",
          "name": "How should I enter holidays?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Enter one ISO date per line (YYYY-MM-DD). Invalid dates are ignored and flagged inline."
          }
        },
        {
          "@type": "Question",
          "name": "What is the maximum number of days?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Up to 100,000 for calendar-day math. For business days, up to 10,000 to ensure instant performance."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['$','$'], ['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script">

</head>
<body>

<a class="skip-link" href="#main">Skip to main content</a>
<header>
<div class="container header-inner">
<a aria-label="CalcDomain - Home" class="brand" href="https://calcdomain.com/">CalcDomain</a>
<form action="https://calcdomain.com/search" aria-label="Site search" class="search" role="search">
<label class="sr-only" for="q" style="position:absolute;left:-9999px">Search calculators</label>
<input aria-label="Search calculators" autocomplete="off" id="q" inputmode="search" name="q" placeholder="Search calculators…" type="search">
<button class="btn secondary" type="submit">Search</button>
</form>
<nav aria-label="Main navigation">
<a href="https://calcdomain.com/lifestyle-everyday.html">Everyday Life</a>
</nav>
</div>
</header>
<main class="container" id="main" role="main">
<nav aria-label="Breadcrumb" class="breadcrumb">
<a href="https://calcdomain.com/">Home</a> / <a href="https://calcdomain.com/lifestyle-everyday.html">Everyday Life</a> / <a href="https://calcdomain.com/everyday-life/time-and-date.html">Time &amp; Date</a> / Add/Subtract Days from a Date Calculator
    </nav>
<h1>Add/Subtract Days from a Date Calculator</h1>
<p>This professional-grade date calculator lets you add or subtract any number of days from a start date. It supports inclusive counting, business-day calculations that skip weekends, and optional holiday exclusions. Designed for reliability, accessibility (WCAG 2.1 AA), and fast results on any device.</p>
<div class="grid" id="calculator-grid">
<!-- Calculator -->
<section aria-labelledby="calc-heading" class="card calculator" id="date-calculator">
<h2 id="calc-heading" style="margin-top:0">Calculator</h2>
<!-- Operation -->
<div class="form-group">
<fieldset>
<legend class="sr-only" style="position:absolute;left:-9999px">Choose operation</legend>
<div aria-label="Choose operation" class="radio-row" role="radiogroup">
<input checked="" id="opAdd" name="op" type="radio" value="add">
<label for="opAdd">Add</label>
<input id="opSub" name="op" type="radio" value="sub">
<label for="opSub">Subtract</label>
</div>
</fieldset>
</div>
<!-- Start date -->
<div class="form-group">
<label for="startDate">
            Start date *
            <button aria-controls="helpStart" aria-expanded="false" aria-label="About start date" class="help-btn" id="helpStartBtn" type="button">?</button>
</label>
<div class="field">
<input aria-describedby="helpStart startDateError" aria-required="true" class="input" id="startDate" inputmode="numeric" name="startDate" required="" type="date">
</div>
<div class="tooltip" data-open="false" id="helpStart" role="tooltip">
            Use the ISO format YYYY-MM-DD (e.g., 2025-09-15). The tool applies the proleptic Gregorian calendar.
          </div>
<div aria-live="polite" class="error" id="startDateError" role="alert"></div>
</div>
<!-- Number of days -->
<div class="form-group">
<label for="days">
            Number of days *
            <button aria-controls="helpDays" aria-expanded="false" aria-label="About number of days" class="help-btn" id="helpDaysBtn" type="button">?</button>
</label>
<div class="field">
<input aria-describedby="helpDays daysError" aria-required="true" class="input" id="days" inputmode="numeric" min="0" name="days" placeholder="e.g., 30" required="" step="1" type="number">
</div>
<div class="tooltip" data-open="false" id="helpDays" role="tooltip">
            Enter a whole number of days (0 or greater). For inclusive counting, enable the option below.
          </div>
<div aria-live="polite" class="error" id="daysError" role="alert"></div>
</div>
<!-- Options -->
<div aria-label="Options" class="form-group options">
<div class="option">
<input aria-describedby="inclusiveTip" id="inclusive" type="checkbox">
<label for="inclusive">Inclusive counting</label>
</div>
<div class="muted" id="inclusiveTip" style="margin:-.4rem 0 .25rem 2rem">
            Count the start date as day one. Adding 10 days inclusive equals adding 9 days exclusive.
          </div>
<div class="option">
<input aria-describedby="businessTip" id="business" type="checkbox">
<label for="business">Business days (Mon–Fri)</label>
</div>
<div class="muted" id="businessTip" style="margin:-.4rem 0 .25rem 2rem">
            Skip Saturdays and Sundays. Optionally exclude holidays below.
          </div>
</div>
<!-- Holidays -->
<div class="form-group">
<details>
<summary>Custom holidays (optional)</summary>
<p class="muted" id="holidayTip">Paste one date per line in YYYY-MM-DD format. These dates will be excluded when Business days is enabled.</p>
<textarea aria-describedby="holidayTip holidaysError" class="input textarea" id="holidays" placeholder="e.g.
2025-01-01
2025-02-17
2025-07-04"></textarea>
<div aria-live="polite" class="error" id="holidaysError" role="alert"></div>
</details>
</div>
<div class="actions">
<button aria-label="Calculate" class="btn" id="calcBtn" type="button">Calculate</button>
<button aria-label="Reset form" class="btn secondary" id="resetBtn" type="button">Reset</button>
</div>
</section>
<!-- Results -->
<section aria-labelledby="resultsHeading" class="card results" id="results">
<h2 id="resultsHeading">Results</h2>
<div aria-atomic="true" aria-live="polite" class="result-box">
<div class="kv">
<span class="label">Result date</span>
<span class="value" id="resultDate">—</span>
</div>
<div class="kv">
<span class="label">Day of week</span>
<span class="value" id="resultDOW">—</span>
</div>
<div class="kv">
<span class="label">Input days</span>
<span class="value" id="inputDays">—</span>
</div>
<div class="kv">
<span class="label">Mode</span>
<span class="value" id="modeLabel">—</span>
</div>
<div class="kv">
<span class="label">Excluded days (weekends/holidays)</span>
<span class="value" id="excludedCount">—</span>
</div>
<div class="kv">
<span class="label">Computation details</span>
<span class="value" id="detailText" style="color:#0b5e24">—</span>
</div>
</div>
</section>
</div>
<!-- Content ecosystem -->
<section aria-labelledby="data-method" class="card content" id="content-ecosystem">
<h2 id="data-method">Data Source and Methodology</h2>
<p><strong>Primary reference:</strong> ISO 8601:2019 — Date and time — Representations for information interchange (2019). Official standard details at:
        <a href="https://www.iso.org/standard/70907.html" rel="nofollow noopener" target="_blank">iso.org/standard/70907</a>.
      </p>
<p><strong>Algorithmic reference:</strong> Dershowitz, N. &amp; Reingold, E. M. (2018). Calendrical Calculations (4th ed.). Cambridge University Press. <a href="https://www.cambridge.org/core/books/calendrical-calculations/6D3EB6B1A8B6C2FA2C8C2583F68C7E1A" rel="nofollow noopener" target="_blank">View book</a>.</p>
<p>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</p>
<h2>The Formula Explained</h2>
<div aria-label="Formulas in LaTeX" class="formula">
<p><strong>Calendar days (exclusive counting):</strong></p>
<p>Let S be the start date and d ∈ ℕ the number of days. For operation o ∈ {+1 (add), −1 (subtract)}:</p>
<p>$$ R = S + o \cdot d $$</p>
<p><strong>Inclusive counting:</strong> If the start date counts as day one and d &gt; 0, compute</p>
<p>$$ d' = d - 1,\quad R = S + o \cdot d' $$</p>
<p><strong>Business days (Mon–Fri) with holiday set H:</strong></p>
<p>Let B(n) advance by one day in the direction of o until a business day not in H is encountered, repeating n times:</p>
<p>$$ R = B^{(d')}(S) $$</p>
<p>Leap years follow Gregorian rules:</p>
<p>$$ \text{leap}(y) \iff (y \bmod 4 = 0) \land (y \bmod 100 \ne 0 \lor y \bmod 400 = 0). $$</p>
</div>
<h2>Glossary of Variables</h2>
<ul>
<li>S (Start date): The initial date you input (YYYY-MM-DD).</li>
<li>o (Operation): +1 to add; −1 to subtract.</li>
<li>d (Number of days): The number of days to add or subtract.</li>
<li>d' (Adjusted days): d − 1 when inclusive counting is enabled and d &gt; 0; otherwise d.</li>
<li>R (Result date): The computed date after applying the operation.</li>
<li>B (Business-day successor): Function that moves to the next/previous business day, skipping weekends and specified holidays.</li>
<li>H (Holiday set): Optional set of ISO dates excluded from business-day counting.</li>
</ul>
<h2>How It Works: A Step-by-Step Example</h2>
<h3>Example: Add 45 business days (excluding weekends and a holiday)</h3>
<ol>
<li>Operation: Add; Start date S = 2025-01-15; d = 45; Inclusive = off; Business days = on.</li>
<li>Holiday set H includes 2025-02-17 (Presidents’ Day).</li>
<li>Adjusted days d' = 45 (since not inclusive).</li>
<li>Apply B 45 times from S, skipping weekends and 2025-02-17.</li>
<li>The result R is the first date after completing 45 counted business days. The calculator shows the exact date and the number of excluded days encountered.</li>
</ol>
<h2>FAQ</h2>
<div>
<h3>Does this tool use my time zone?</h3>
<p>No. To avoid daylight saving anomalies, dates are treated as date-only values in UTC.</p>
<h3>Can I paste holidays from a spreadsheet?</h3>
<p>Yes. Paste one ISO date per line (YYYY-MM-DD). Duplicates are ignored; invalid lines are flagged.</p>
<h3>What happens if I enter 0 days?</h3>
<p>The result equals the start date, regardless of inclusive or business-day options.</p>
<h3>Are weekends configurable?</h3>
<p>This version treats Saturday and Sunday as weekends. A future update will offer locale-based weekend definitions.</p>
<h3>How fast is it for large inputs?</h3>
<p>Calendar-day math is instant up to 100,000 days. For business days, inputs are limited to 10,000 days to guarantee responsiveness.</p>
<h3>Is the result legally binding?</h3>
<p>No. While algorithmically rigorous, always verify critical dates against your organization’s official calendars.</p>
</div>
<div class="author">
        Tool developed by Ugo Candido. Content reviewed by the CalcDomain Editorial Team. Last reviewed for accuracy on: September 15, 2025.
      </div>
</section>
</main>
<!-- Standard Footer --> 
<noscript>
<div class="container" style="margin:1rem 0;color:#b02a37;border:1px solid #f1c0c7;background:#fff5f6;padding:1rem;border-radius:10px">
      JavaScript is required for interactive calculations. Please enable it to use this date calculator.
    </div>
</noscript>
<script defer="">
  (function(){
    'use strict';

    // Elements
    const opAdd = document.getElementById('opAdd');
    const opSub = document.getElementById('opSub');
    const startDateEl = document.getElementById('startDate');
    const startDateError = document.getElementById('startDateError');
    const daysEl = document.getElementById('days');
    const daysError = document.getElementById('daysError');
    const inclusiveEl = document.getElementById('inclusive');
    const businessEl = document.getElementById('business');
    const holidaysEl = document.getElementById('holidays');
    const holidaysError = document.getElementById('holidaysError');

    const resultDateEl = document.getElementById('resultDate');
    const resultDOWEl = document.getElementById('resultDOW');
    const inputDaysEl = document.getElementById('inputDays');
    const modeLabelEl = document.getElementById('modeLabel');
    const excludedCountEl = document.getElementById('excludedCount');
    const detailTextEl = document.getElementById('detailText');

    const calcBtn = document.getElementById('calcBtn');
    const resetBtn = document.getElementById('resetBtn');

    // Tooltips
    const helpStartBtn = document.getElementById('helpStartBtn');
    const helpStart = document.getElementById('helpStart');
    const helpDaysBtn = document.getElementById('helpDaysBtn');
    const helpDays = document.getElementById('helpDays');

    function toggleTooltip(btn, tip){
      const open = tip.getAttribute('data-open') === 'true';
      tip.setAttribute('data-open', String(!open));
      btn.setAttribute('aria-expanded', String(!open));
    }
    helpStartBtn.addEventListener('click', () => toggleTooltip(helpStartBtn, helpStart));
    helpDaysBtn.addEventListener('click', () => toggleTooltip(helpDaysBtn, helpDays));
    helpStartBtn.addEventListener('keydown', e => { if(e.key === 'Escape'){ helpStart.setAttribute('data-open','false'); helpStartBtn.setAttribute('aria-expanded','false'); }});
    helpDaysBtn.addEventListener('keydown', e => { if(e.key === 'Escape'){ helpDays.setAttribute('data-open','false'); helpDaysBtn.setAttribute('aria-expanded','false'); }});

    // Utilities
    const WEEKDAYS = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

    function isIsoDate(str){
      if(!/^\d{4}-\d{2}-\d{2}$/.test(str)) return false;
      const [y,m,d] = str.split('-').map(Number);
      const dt = new Date(Date.UTC(y, m-1, d));
      return dt.getUTCFullYear() === y && (dt.getUTCMonth()+1) === m && dt.getUTCDate() === d;
    }

    function parseISOToUTCDate(str){
      const [y,m,d] = str.split('-').map(Number);
      return new Date(Date.UTC(y, m-1, d));
    }

    function formatISO(dateUTC){
      const y = dateUTC.getUTCFullYear();
      const m = String(dateUTC.getUTCMonth()+1).padStart(2,'0');
      const d = String(dateUTC.getUTCDate()).padStart(2,'0');
      return `${y}-${m}-${d}`;
    }

    function addDaysUTC(dateUTC, delta){
      const d = new Date(dateUTC.getTime());
      d.setUTCDate(d.getUTCDate()+delta);
      return d;
    }

    function isWeekendUTC(dateUTC){
      const day = dateUTC.getUTCDay(); // 0=Sun,6=Sat
      return day === 0 || day === 6;
    }

    function parseHolidays(text){
      const lines = text.split(/\r?\n|,/).map(s => s.trim()).filter(Boolean);
      const set = new Set();
      const invalid = [];
      for(const l of lines){
        if(isIsoDate(l)){
          set.add(l);
        } else {
          invalid.push(l);
        }
      }
      return {set, invalid};
    }

    // Validation
    function showError(el, errEl, msg){
      el.setAttribute('aria-invalid','true');
      errEl.textContent = msg;
    }
    function clearError(el, errEl){
      el.removeAttribute('aria-invalid');
      errEl.textContent = '';
    }

    function validateStart(){
      const v = startDateEl.value.trim();
      if(!v){
        showError(startDateEl, startDateError, 'Please provide a start date (YYYY-MM-DD).');
        return false;
      }
      if(!isIsoDate(v)){
        showError(startDateEl, startDateError, 'Invalid date format. Use YYYY-MM-DD, e.g., 2025-09-15.');
        return false;
      }
      clearError(startDateEl, startDateError);
      return true;
    }

    function validateDays(){
      const v = daysEl.value.trim();
      if(v === ''){
        showError(daysEl, daysError, 'Please enter the number of days.');
        return false;
      }
      const n = Number(v);
      if(!Number.isFinite(n) || n < 0 || !Number.isInteger(n)){
        showError(daysEl, daysError, 'Enter a whole number of days (0 or greater).');
        return false;
      }
      // Performance limits
      const business = businessEl.checked;
      if(business && n > 10000){
        showError(daysEl, daysError, 'For business-day mode, please enter 10,000 days or fewer to ensure instant performance.');
        return false;
      }
      if(!business && n > 100000){
        showError(daysEl, daysError, 'Please enter 100,000 days or fewer.');
        return false;
      }
      clearError(daysEl, daysError);
      return true;
    }

    function validateHolidays(){
      const txt = holidaysEl.value.trim();
      if(!txt){
        clearError(holidaysEl, holidaysError);
        return {set:new Set(), invalid:[]};
      }
      const {set, invalid} = parseHolidays(txt);
      if(invalid.length){
        showError(holidaysEl, holidaysError, `Ignored invalid date(s): ${invalid.slice(0,5).join(', ')}${invalid.length>5?'…':''}`);
      } else {
        clearError(holidaysEl, holidaysError);
      }
      return {set, invalid};
    }

    // Business-day advance (direction = +1 add, -1 subtract). Counts n business days from start, not including start unless you pre-adjust.
    function advanceBusinessDays(startUTC, n, direction, holidaysSet){
      if(n === 0) return {date: new Date(startUTC.getTime()), skippedWeekends:0, skippedHolidays:0};
      let d = new Date(startUTC.getTime());
      let remaining = n;
      let skippedWeekends = 0;
      let skippedHolidays = 0;
      while(remaining > 0){
        d = addDaysUTC(d, direction);
        if(isWeekendUTC(d)){ skippedWeekends++; continue; }
        const iso = formatISO(d);
        if(holidaysSet && holidaysSet.has(iso)){ skippedHolidays++; continue; }
        remaining--;
      }
      return {date:d, skippedWeekends, skippedHolidays};
    }

    // Compute
    function compute(){
      const okStart = validateStart();
      const okDays = validateDays();
      const {set: holidaySet} = validateHolidays();
      if(!(okStart && okDays)){
        // Reset results but keep some hints
        resultDateEl.textContent = '—';
        resultDOWEl.textContent = '—';
        inputDaysEl.textContent = '—';
        modeLabelEl.textContent = '—';
        excludedCountEl.textContent = '—';
        detailTextEl.textContent = 'Fix the highlighted fields to see the result.';
        return;
      }

      const op = opAdd.checked ? +1 : -1;
      const start = parseISOToUTCDate(startDateEl.value.trim());
      const days = Number(daysEl.value.trim());
      const inclusive = inclusiveEl.checked;
      const business = businessEl.checked;

      const adjusted = (inclusive && days > 0) ? days - 1 : days;

      let resultUTC, excludedW = 0, excludedH = 0, detail = '';
      if(!business){
        resultUTC = addDaysUTC(start, op * adjusted);
        detail = `Calendar-day math: applied ${op===1?'+':'−'}${adjusted} day(s)${inclusive?' after inclusive adjustment':''}.`;
      } else {
        // For business days, if inclusive and start is a countable business day, we reduce the number of steps by one
        let steps = adjusted;
        // If inclusive and days>0 and start is business day and not a holiday, reduce steps further by 0 (already handled by adjusted).
        // Note: adjusted already accounts for inclusive counting.
        const adv = advanceBusinessDays(start, steps, op, holidaySet);
        resultUTC = adv.date;
        excludedW = adv.skippedWeekends;
        excludedH = adv.skippedHolidays;
        detail = `Business-day math: skipped ${excludedW} weekend day(s) and ${excludedH} holiday(s).`;
      }

      // Output
      const iso = formatISO(resultUTC);
      const dow = WEEKDAYS[resultUTC.getUTCDay()];
      resultDateEl.textContent = iso;
      resultDOWEl.textContent = dow;
      inputDaysEl.textContent = String(days);
      modeLabelEl.textContent = business ? `Business days${inclusive?' (inclusive)':' (exclusive)'}` : `Calendar days${inclusive?' (inclusive)':' (exclusive)'}`;
      excludedCountEl.textContent = business ? `${excludedW + excludedH}` : '0';
      detailTextEl.textContent = detail;
    }

    // Events
    startDateEl.addEventListener('blur', validateStart);
    daysEl.addEventListener('blur', validateDays);
    holidaysEl.addEventListener('blur', validateHolidays);

    [opAdd, opSub, inclusiveEl, businessEl].forEach(el => el.addEventListener('change', compute));
    [startDateEl, daysEl, holidaysEl].forEach(el => el.addEventListener('input', () => {
      // Live compute without spamming errors
      if(el !== startDateEl || startDateEl.value) clearError(startDateEl, startDateError);
      if(el !== daysEl || daysEl.value) clearError(daysEl, daysError);
      compute();
    }));

    calcBtn.addEventListener('click', compute);

    resetBtn.addEventListener('click', () => {
      document.getElementById('opAdd').checked = true;
      startDateEl.value = '';
      daysEl.value = '';
      inclusiveEl.checked = false;
      businessEl.checked = false;
      holidaysEl.value = '';
      [startDateEl, daysEl, holidaysEl].forEach((el,i)=>{
        const err = [startDateError, daysError, holidaysError][i];
        clearError(el, err);
      });
      resultDateEl.textContent = '—';
      resultDOWEl.textContent = '—';
      inputDaysEl.textContent = '—';
      modeLabelEl.textContent = '—';
      excludedCountEl.textContent = '—';
      detailTextEl.textContent = '—';
      startDateEl.focus();
    });

    // Initialize with today as convenience
    const today = new Date();
    const todayUTC = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()));
    startDateEl.value = formatISO(todayUTC);
    compute();

    // Enhance keyboard support on radio group labels
    document.querySelectorAll('.radio-row label').forEach(label=>{
      label.addEventListener('keydown', e=>{
        if(e.key === ' ' || e.key === 'Enter'){
          e.preventDefault();
          const forId = label.getAttribute('for');
          const input = document.getElementById(forId);
          input.checked = true;
          input.dispatchEvent(new Event('change', {bubbles:true}));
        }
      });
    });
  })();
  </script>

</body></html>