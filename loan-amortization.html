<!DOCTYPE html>
<html lang="en">
<head> 
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
  <meta charset="utf-8"/>
  <title>Loan Amortization Schedule Calculator | Payments, Interest, Payoff Date</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Build a complete loan amortization schedule with extras, PMI and escrow options, multiple payment frequencies, CSV export, and print-friendly layout. Professional, WCAG-compliant, mobile-first."/>
  <meta name="author" content="Ugo Candido"/>
  <link rel="canonical" href="https://calcdomain.com/loan-amortization.html"/>
  <meta name="theme-color" content="#ffffff"/>
  <meta name="robots" content="index,follow"/>

  <!-- Tailwind + Inter (from blueprint) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- MathJax for formulas (for SEO content below) -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Finance","item":"https://calcdomain.com/finance.html"},
      {"@type":"ListItem","position":3,"name":"Loans & Debt","item":"https://calcdomain.com/subcategories/finance-loans-debt.html"},
      {"@type":"ListItem","position":4,"name":"Loan Amortization Schedule Calculator","item":"https://calcdomain.com/loan-amortization.html"}
    ]
  }
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .prose{max-width:72ch}
    .prose h2{font-size:1.5rem;font-weight:700;margin-top:2rem;margin-bottom:.75rem}
    .prose h3{font-weight:700;margin-top:1.25rem}
    .prose .formula{background:#EEF2F7;border:1px solid #E2E8F0;border-radius:10px;padding:14px;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

    /* Search (from blueprint) */
    #search-results{background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.1);max-height:400px;overflow-y:auto}
    #search-results a{display:block;padding:16px;border-bottom:1px solid #f3f4f6;transition:.2s;text-decoration:none}
    #search-results a:last-child{border-bottom:none}
    #search-results a:hover{background:#f8fafc;transform:translateX(4px)}
    input[type="search"]:focus{box-shadow:0 0 0 3px rgba(59,130,246,.1);border-color:#3b82f6}

    /* Table */
    table{width:100%;border-collapse:collapse}
    thead th{position:sticky;top:0;background:#F1F5F9;border-bottom:1px solid #E5E7EB;padding:.6rem .5rem;text-align:right}
    thead th:first-child, tbody td:first-child,
    thead th:nth-child(2), tbody td:nth-child(2){text-align:left}
    tbody td{padding:.55rem .5rem;border-bottom:1px solid #E5E7EB;text-align:right}
    caption{caption-side:top;text-align:left;padding:.25rem 0 .5rem;color:#6B7280}
    @media print{
      header, .no-print, .actions{display:none !important}
      .shadow-md,.shadow{box-shadow:none !important}
      .border{border-color:#ddd !important}
      body{background:#fff}
    }
  </style>

  <!-- JSON-LD (WebPage + FAQ) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Loan Amortization Schedule Calculator",
    "url":"https://calcdomain.com/loan-amortization.html",
    "description":"Professional-grade loan amortization calculator with extras, escrow/PMI, and multiple payment frequencies. Exports CSV and is print-friendly.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "mainEntity":{
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"How are payments calculated?","acceptedAnswer":{"@type":"Answer","text":"We use the standard fixed-rate amortization formula given principal, APR, term, and payment frequency."}},
        {"@type":"Question","name":"Does it include taxes, insurance, and PMI?","acceptedAnswer":{"@type":"Answer","text":"Escrow (tax & insurance) and PMI are optional add-ons shown in the all-in payment; the core schedule remains principal & interest."}},
        {"@type":"Question","name":"Can I add extra payments?","acceptedAnswer":{"@type":"Answer","text":"Yes—enter a recurring extra per period and/or a one-time extra at a specific payment number to see time and interest saved."}}
      ]
    }
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-extrabold text-blue-600">CalcDomain</a>

        <!-- Desktop search -->
        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            <input type="search" id="search-input" placeholder="Search calculators…"
                   class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
                   autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a href="search.html" class="text-gray-700 hover:text-blue-600 transition-colors">Advanced Search</a>
          <a href="index.html#categories" class="text-gray-700 hover:text-blue-600 transition-colors">Categories</a>
        </div>

        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile menu -->
      <div id="mobile-menu" class="md:hidden mt-4 hidden">
        <div class="space-y-2">
          <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main -->
  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Left: Calculator + Content -->
      <section class="w-full lg:w-2/3">
        <!-- Breadcrumbs / Category mapping -->
        <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
          <a href="subcategories/finance-loans-debt.html" class="hover:text-blue-600">Loans &amp; Debt</a> &raquo;
          <span class="text-gray-900 font-medium">Loan Amortization</span>
        </nav>

        <!-- Calculator card -->
        <section class="bg-white p-6 rounded-lg shadow-md" aria-labelledby="calc-title">
          <h1 id="calc-title" class="text-3xl font-extrabold mb-2 text-slate-800">Loan Amortization Schedule Calculator</h1>
          <p class="text-gray-600 mb-6">Build a complete amortization schedule with extras, multiple payment frequencies, optional escrow &amp; PMI, CSV export, and print-friendly output. Accurate, accessible, and fast for professional use.</p>

          <!-- Inputs -->
          <div id="calculator-ui" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="currency" class="block text-sm font-medium text-gray-800">Currency</label>
              <select id="currency" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                <option value="USD" selected>USD — United States Dollar</option>
                <option value="EUR">EUR — Euro</option>
                <option value="GBP">GBP — British Pound</option>
                <option value="CAD">CAD — Canadian Dollar</option>
                <option value="AUD">AUD — Australian Dollar</option>
              </select>
            </div>

            <div>
              <label for="amount" class="block text-sm font-medium text-gray-800">Loan amount *</label>
              <div class="relative">
                <input type="number" id="amount" inputmode="decimal" step="0.01" min="0" placeholder="e.g., 25000"
                       class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="amountErr" aria-required="true">
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" aria-hidden="true" id="amountSuffix">$</span>
              </div>
              <p id="amountErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="apr" class="block text-sm font-medium text-gray-800">Annual interest rate (APR) *</label>
              <div class="relative">
                <input type="number" id="apr" inputmode="decimal" step="0.001" min="0" max="100" placeholder="e.g., 6.5"
                       class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="aprErr" aria-required="true">
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">%</span>
              </div>
              <p id="aprErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-800">Loan term *</label>
              <div class="grid grid-cols-2 gap-3">
                <input type="number" id="years" inputmode="numeric" step="1" min="0" max="50" placeholder="Years"
                       class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="termErr" aria-required="true">
                <input type="number" id="months" inputmode="numeric" step="1" min="0" max="11" placeholder="Months"
                       class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="termErr" aria-required="true">
              </div>
              <p id="termErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <fieldset>
                <legend class="block text-sm font-semibold text-gray-800 mb-2">Payment frequency *</legend>
                <div class="flex flex-wrap gap-2">
                  <label class="inline-flex items-center gap-2 border rounded-md px-3 py-2">
                    <input type="radio" name="frequency" id="freqMonthly" value="12" checked> <span>Monthly</span>
                  </label>
                  <label class="inline-flex items-center gap-2 border rounded-md px-3 py-2">
                    <input type="radio" name="frequency" id="freqBiweekly" value="26"> <span>Biweekly</span>
                  </label>
                  <label class="inline-flex items-center gap-2 border rounded-md px-3 py-2">
                    <input type="radio" name="frequency" id="freqWeekly" value="52"> <span>Weekly</span>
                  </label>
                </div>
              </fieldset>
            </div>

            <div>
              <label for="startDate" class="block text-sm font-medium text-gray-800">Start date *</label>
              <input type="date" id="startDate"
                     class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                     aria-describedby="dateErr" aria-required="true">
              <p id="dateErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div class="md:col-span-2">
              <h3 class="text-sm font-semibold text-gray-800 mb-2">Extra payments (optional)</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div>
                  <label for="extraRecurring" class="block text-sm font-medium text-gray-800">Recurring extra per period</label>
                  <div class="relative">
                    <input type="number" id="extraRecurring" inputmode="decimal" step="0.01" min="0" value="0"
                           class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" id="extraRecurringSuffix">$</span>
                  </div>
                </div>
                <div>
                  <label for="extraOnce" class="block text-sm font-medium text-gray-800">One-time extra</label>
                  <div class="relative">
                    <input type="number" id="extraOnce" inputmode="decimal" step="0.01" min="0" value="0"
                           class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" id="extraOnceSuffix">$</span>
                  </div>
                </div>
                <div>
                  <label for="extraOnceAt" class="block text-sm font-medium text-gray-800">Apply one-time at payment #</label>
                  <input type="number" id="extraOnceAt" inputmode="numeric" step="1" min="1" value="1"
                         class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
              </div>
            </div>

            <div class="md:col-span-2">
              <h3 class="text-sm font-semibold text-gray-800 mb-2">Escrow &amp; PMI (optional)</h3>
              <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <div>
                  <label for="taxMonthly" class="block text-sm font-medium text-gray-800">Property tax (monthly)</label>
                  <div class="relative">
                    <input type="number" id="taxMonthly" inputmode="decimal" step="0.01" min="0" value="0"
                           class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" id="taxMonthlySuffix">$</span>
                  </div>
                </div>
                <div>
                  <label for="insMonthly" class="block text-sm font-medium text-gray-800">Insurance (monthly)</label>
                  <div class="relative">
                    <input type="number" id="insMonthly" inputmode="decimal" step="0.01" min="0" value="0"
                           class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" id="insMonthlySuffix">$</span>
                  </div>
                </div>
                <div>
                  <label for="homeValue" class="block text-sm font-medium text-gray-800">Home value</label>
                  <div class="relative">
                    <input type="number" id="homeValue" inputmode="decimal" step="0.01" min="0"
                           class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" id="homeValueSuffix">$</span>
                  </div>
                </div>
                <div>
                  <label for="pmiRate" class="block text-sm font-medium text-gray-800">PMI rate (annual %)</label>
                  <input type="number" id="pmiRate" inputmode="decimal" step="0.01" min="0" max="5" value="0.00"
                         class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-1">PMI applies until LTV ≤ 80% (when balance ≤ 80% of home value). We compute PMI each period from the current balance and allocate it to the all-in payment.</p>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap gap-3 mt-4 actions">
            <button id="calcBtn" type="button" class="inline-flex items-center justify-center min-h-[44px] px-4 py-2 rounded-md bg-blue-600 text-white font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">Calculate</button>
            <button id="resetBtn" type="button" class="inline-flex items-center justify-center min-h-[44px] px-4 py-2 rounded-md border border-blue-600 text-blue-700 font-semibold hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500">Reset</button>
            <button id="downloadBtn" type="button" class="inline-flex items-center justify-center min-h-[44px] px-4 py-2 rounded-md border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">Download CSV</button>
            <button id="printBtn" type="button" class="inline-flex items-center justify-center min-h-[44px] px-4 py-2 rounded-md border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">Print</button>
            <button id="shareBtn" type="button" class="inline-flex items-center justify-center min-h-[44px] px-4 py-2 rounded-md border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">Copy shareable link</button>
          </div>

          <!-- Results -->
          <div id="results" class="mt-8 bg-blue-50 p-6 rounded-lg">
            <h2 class="text-xl font-bold text-slate-800 mb-3">Results</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
              <div class="bg-white border border-blue-100 rounded-lg p-4"><p class="text-sm text-gray-600">Periodic payment</p><p id="kpiPayment" class="text-xl font-extrabold text-blue-700 mt-1">—</p></div>
              <div class="bg-white border border-blue-100 rounded-lg p-4"><p class="text-sm text-gray-600"># Payments</p><p id="kpiCount" class="text-xl font-extrabold text-slate-800 mt-1">—</p></div>
              <div class="bg-white border border-blue-100 rounded-lg p-4"><p class="text-sm text-gray-600">Total interest</p><p id="kpiInterest" class="text-xl font-extrabold text-emerald-700 mt-1">—</p></div>
              <div class="bg-white border border-blue-100 rounded-lg p-4"><p class="text-sm text-gray-600">Total paid (loan)</p><p id="kpiTotal" class="text-xl font-extrabold text-slate-800 mt-1">—</p></div>
              <div class="bg-white border border-blue-100 rounded-lg p-4"><p class="text-sm text-gray-600">Payoff date</p><p id="kpiPayoff" class="text-xl font-extrabold text-slate-800 mt-1">—</p></div>
              <div class="bg-white border border-blue-100 rounded-lg p-4"><p class="text-sm text-gray-600">All-in payment*</p><p id="kpiAllInPay" class="text-xl font-extrabold text-slate-800 mt-1">—</p></div>
            </div>
            <p class="text-xs text-gray-600 mt-2">* All-in includes escrow (tax + insurance) and PMI while applicable.</p>

            <!-- Schedule -->
            <div class="mt-5">
              <div class="flex flex-wrap items-center gap-3 mb-2">
                <label for="viewMode" class="text-sm text-gray-700">View:</label>
                <select id="viewMode" class="px-3 py-2 border border-gray-300 rounded-md">
                  <option value="detailed" selected>Detailed (per period)</option>
                  <option value="yearly">Yearly summary</option>
                </select>

                <label for="rowsPerPage" class="text-sm text-gray-700 ml-auto">Rows / page:</label>
                <select id="rowsPerPage" class="px-3 py-2 border border-gray-300 rounded-md">
                  <option>12</option><option selected>24</option><option>60</option><option>120</option>
                </select>
              </div>

              <div class="rounded-lg border border-blue-100 bg-white overflow-auto max-h-[480px]">
                <table role="table" aria-describedby="scheduleCaption">
                  <caption id="scheduleCaption" class="text-sm">Each row shows how your payment is split across interest and principal, extras, PMI/escrow, and the remaining balance.</caption>
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Date</th>
                      <th scope="col">Payment</th>
                      <th scope="col">Interest</th>
                      <th scope="col">Principal</th>
                      <th scope="col">Extra</th>
                      <th scope="col">PMI</th>
                      <th scope="col">Escrow</th>
                      <th scope="col">All-in</th>
                      <th scope="col">Balance</th>
                    </tr>
                  </thead>
                  <tbody id="scheduleBody" aria-live="polite"></tbody>
                </table>
              </div>

              <div class="flex items-center justify-between mt-2">
                <div class="flex gap-2">
                  <button id="prevPage" class="px-3 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Prev</button>
                  <button id="nextPage" class="px-3 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Next</button>
                </div>
                <div id="pageInfo" class="text-sm text-gray-600">Page — of —</div>
              </div>
            </div>
          </div>
        </section>

        <!-- SEO content (kept & polished for E-E-A-T) -->
        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>Data Source and Methodology</h2>
          <p><strong>Authoritative reference:</strong> OpenStax, “Algebra and Trigonometry,” Section 3.7 Financial Formulas (Amortization), 2016 — and standard finance texts on fixed-rate amortization. These sources ground the formulas and definitions used here.</p>
          <p><strong>Modeling notes:</strong> Payments follow a fixed-rate amortization with period rate \( r = \frac{\text{APR}}{m} \) where \( m \) is payments per year (12, 26, or 52). Extras shorten the term unless your lender recasts. Escrow (tax + insurance) and PMI are added to show an “all-in” outflow; the core schedule remains P&amp;I.</p>

          <h2>The Formula Explained</h2>
          <div class="formula" aria-label="Amortization formulas">
            Payment: \( P = \dfrac{L\,r}{1 - (1+r)^{-n}} \), where \( L \) is principal, \( r \) the period rate, and \( n \) total periods. <br/>
            Per period \(k\): \( \text{Interest}_k = B_{k-1}\,r \), \( \text{Principal}_k = P - \text{Interest}_k \), \( B_k = B_{k-1} - \text{Principal}_k - \text{Extra}_k \). <br/>
            Zero-rate case: \( P = \dfrac{L}{n} \), \( \text{Interest}_k = 0 \).
          </div>

          <h2>Frequently Asked Questions (FAQ)</h2>
          <h3>Do extra payments change my required payment?</h3>
          <p>No. Required payment stays fixed; extras reduce term and total interest. Some lenders offer optional <em>recast</em> programs—check your agreement.</p>
          <h3>How does PMI end?</h3>
          <p>PMI is applied each period until LTV ≤ 80% (balance ≤ 80% of home value). The tool removes PMI automatically once the condition is met.</p>
          <h3>Why might my lender’s numbers differ?</h3>
          <p>Daily interest accrual, posting dates, rounding, and fees can create small differences versus this idealized monthly model.</p>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
            <p>
              <strong>Tool developed by Ugo Candido.</strong> Finance accuracy reviewed by the CalcDomain Editorial Board.<br>
              Last accuracy review: <time datetime="2025-02-10">February 10, 2025</time>
            </p>
          </div>
        </article>
      </section>

      <!-- Right: Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24">
          <!-- Sticky Ad -->
          <div class="bg-gray-200 h-72 rounded-lg mb-6 flex items-center justify-center text-gray-500 no-print">
            Ad Placement (300×600)
          </div>

          <!-- Topic cluster -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-3">Why use this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
              <li>Compare amortization across payment frequencies and extra payment strategies.</li>
              <li>Export lender-ready schedules with escrow, PMI, and all-in payment tracking.</li>
              <li>Model refinance or recast scenarios by editing APR, term, and cash to close.</li>
            </ul>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related loan tools</h3>
            <ul class="space-y-3 text-sm">
              <li><a class="text-blue-600 hover:underline" href="simple-loan-calculator.html">Simple Loan Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-payoff.html">Loan Payoff Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-prepayment.html">Loan Prepayment Planner</a></li>
              <li><a class="text-blue-600 hover:underline" href="apr-calculator.html">APR Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="debt-consolidation.html">Debt Consolidation Analysis</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- Calculator logic -->
  <script>
    (function(){
      'use strict';

      // Helpers
      const $ = (sel, ctx=document) => ctx.querySelector(sel);
      const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

      function guessCurrency(){
        try{
          const region = Intl.DateTimeFormat().resolvedOptions().locale?.split('-')[1] || '';
          if(region === 'GB') return 'GBP';
          if(region === 'CA') return 'CAD';
          if(region === 'AU') return 'AUD';
          if(['EU','DE','FR','ES','IT','NL','IE','PT'].includes(region)) return 'EUR';
        }catch(e){}
        return 'USD';
      }
      const currFmt = () => new Intl.NumberFormat(undefined, { style:'currency', currency: $('#currency')?.value || guessCurrency() });
      function fmt(n){ const c = currFmt(); return Number.isFinite(n) ? c.format(n) : '—'; }

      function getFreq(){ const r = $$('input[name="frequency"]').find(x=>x.checked); return r ? parseInt(r.value,10) : 12; }
      function monthsToPeriods(months, freq){ return Math.round(months * (freq/12)); }

      function addPeriods(date, periods, freq){
        // Map periods to days rough heuristic for biweekly/weekly; monthly uses true calendar months
        const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        if(freq === 12){
          const mAdds = periods;
          const y = d.getFullYear(), m = d.getMonth();
          const ny = y + Math.floor((m + mAdds)/12);
          const nm = (m + mAdds) % 12;
          const dim = new Date(ny, nm+1, 0).getDate();
          d.setFullYear(ny, nm, Math.min(d.getDate(), dim));
          return d;
        }else{
          const days = freq === 26 ? periods*14 : periods*7;
          d.setDate(d.getDate() + days);
          return d;
        }
      }

      // Inputs
      const currency = $('#currency');
      const amount = $('#amount');
      const apr = $('#apr');
      const years = $('#years');
      const months = $('#months');
      const taxMonthly = $('#taxMonthly');
      const insMonthly = $('#insMonthly');
      const homeValue = $('#homeValue');
      const pmiRate = $('#pmiRate');
      const extraRecurring = $('#extraRecurring');
      const extraOnce = $('#extraOnce');
      const extraOnceAt = $('#extraOnceAt');
      const startDate = $('#startDate');

      // Results
      const kpiPayment = $('#kpiPayment');
      const kpiCount = $('#kpiCount');
      const kpiInterest = $('#kpiInterest');
      const kpiTotal = $('#kpiTotal');
      const kpiPayoff = $('#kpiPayoff');
      const kpiAllInPay = $('#kpiAllInPay');

      // Table / paging
      const scheduleBody = $('#scheduleBody');
      const rowsPerPageSel = $('#rowsPerPage');
      const pageInfo = $('#pageInfo');
      let schedule = []; let page = 1;

      // Validation helpers
      function parseNum(input){ const v = parseFloat(input.value); return Number.isFinite(v) ? v : NaN; }
      function validate(){
        const errs = [];
        if(!(parseNum(amount) > 0)) errs.push('Enter a positive loan amount.');
        const aprv = parseNum(apr);
        if(!(aprv >= 0 && aprv < 100)) errs.push('APR must be between 0 and 100.');
        const nMonths = (parseNum(years)||0)*12 + (parseNum(months)||0);
        if(!(nMonths > 0)) errs.push('Term must be at least 1 month.');
        if(!startDate.value) errs.push('Choose a start date.');
        return { ok: errs.length===0, errs };
      }

      // Core math
      function paymentAmt(PV, i, n){
        if(n<=0) return NaN;
        if(i===0) return PV / n;
        return PV * (i / (1 - Math.pow(1+i, -n)));
      }

      function buildSchedule(){
        const PV = parseNum(amount);
        const APR = parseNum(apr)/100;
        const freq = getFreq();
        const r = APR / freq;
        const nMonths = (parseNum(years)||0)*12 + (parseNum(months)||0);
        const n = monthsToPeriods(nMonths, freq);

        // Monthly escrow split into per-period
        const escrowPerPeriod = ((parseNum(taxMonthly)||0) + (parseNum(insMonthly)||0)) * 12 / freq;

        // PMI inputs
        const hv = parseNum(homeValue) || 0;
        const pmiAnnual = parseNum(pmiRate)/100 || 0;

        // Extras
        const Erec = Math.max(0, parseNum(extraRecurring) || 0);
        const Eonce = Math.max(0, parseNum(extraOnce) || 0);
        const EonceAt = Math.max(1, Math.floor(parseNum(extraOnceAt) || 1));

        const sched = [];
        const start = new Date(startDate.value);
        const pay = paymentAmt(PV, r, n);

        let bal = PV;
        let totalInterest = 0;
        let totalPaidLoan = 0;

        for(let k=1; k<=n && bal>1e-8; k++){
          const date = addPeriods(start, k-1, freq);

          // Interest and principal on loan portion only
          const interest = r===0 ? 0 : bal * r;
          let principal = pay - interest;
          if(principal < 0) principal = 0; // non-amortizing safety

          // Extra(s)
          let extra = Erec;
          if(k === EonceAt) extra += Eonce;

          // Apply to balance
          let totalPrincipal = principal + extra;
          if(totalPrincipal > bal + 1e-8){ // last payment trim
            totalPrincipal = bal;
          }
          bal = Math.max(0, bal - totalPrincipal);

          // PMI (loan-only portion, ends at 80% LTV)
          let pmi = 0;
          if(hv>0 && pmiAnnual>0 && bal > 0.80*hv){
            pmi = (pmiAnnual / freq) * bal;
          }

          // All-in payment
          const loanPayment = r===0 ? totalPrincipal : Math.min(pay + extra, totalPrincipal + interest); // cap for final row
          const allIn = loanPayment + escrowPerPeriod + pmi;

          totalInterest += interest;
          totalPaidLoan += loanPayment;

          sched.push({
            k,
            date,
            payment: loanPayment,
            interest,
            principal,
            extra,
            pmi,
            escrow: escrowPerPeriod,
            allIn,
            balance: bal
          });

          if(bal <= 1e-8){ break; }
        }

        // KPIs
        kpiPayment.textContent = fmt(pay + Erec); // show recurring extra included here
        kpiCount.textContent = String(sched.length);
        kpiInterest.textContent = fmt(totalInterest);
        kpiTotal.textContent = fmt(totalPaidLoan);
        const payoff = sched.length ? sched[sched.length-1].date : start;
        kpiPayoff.textContent = payoff.toLocaleDateString(undefined,{year:'numeric',month:'long'});
        kpiAllInPay.textContent = fmt((pay + Erec) + escrowPerPeriod); // PMI varies; omit here

        schedule = sched;
      }

      function renderTable(){
        const rowsPerPage = parseInt(rowsPerPageSel.value,10) || 24;
        const totalPages = Math.max(1, Math.ceil(schedule.length / rowsPerPage));
        page = Math.min(Math.max(1,page), totalPages);
        const startIdx = (page-1)*rowsPerPage;
        const subset = schedule.slice(startIdx, startIdx+rowsPerPage);

        scheduleBody.innerHTML = subset.map(row=>{
          return `<tr>
            <td>${row.k}</td>
            <td>${row.date.toLocaleDateString()}</td>
            <td>${fmt(row.payment)}</td>
            <td>${fmt(row.interest)}</td>
            <td>${fmt(row.principal)}</td>
            <td>${fmt(row.extra)}</td>
            <td>${fmt(row.pmi)}</td>
            <td>${fmt(row.escrow)}</td>
            <td>${fmt(row.allIn)}</td>
            <td>${fmt(row.balance)}</td>
          </tr>`;
        }).join('');

        pageInfo.textContent = \`Page \${page} of \${totalPages}\`;
      }

      // Yearly summary view
      function renderYearly(){
        const byYear = new Map();
        schedule.forEach(r=>{
          const y = r.date.getFullYear();
          if(!byYear.has(y)) byYear.set(y, {pay:0,int:0,prin:0,extra:0,pmi:0,esc:0,all:0,balance:r.balance});
          const a = byYear.get(y);
          a.pay += r.payment; a.int += r.interest; a.prin += r.principal; a.extra += r.extra; a.pmi += r.pmi; a.esc += r.escrow; a.all += r.allIn;
          a.balance = r.balance;
        });
        const rows = Array.from(byYear.entries()).sort((a,b)=>a[0]-b[0]).map(([y,a],i)=>{
          return `<tr>
            <td>${i+1}</td>
            <td>${y}</td>
            <td>${fmt(a.pay)}</td>
            <td>${fmt(a.int)}</td>
            <td>${fmt(a.prin)}</td>
            <td>${fmt(a.extra)}</td>
            <td>${fmt(a.pmi)}</td>
            <td>${fmt(a.esc)}</td>
            <td>${fmt(a.all)}</td>
            <td>${fmt(a.balance)}</td>
          </tr>`;
        }).join('');
        scheduleBody.innerHTML = rows || '';
        pageInfo.textContent = \`Years: \${byYear.size}\`;
      }

      function calculate(){
        const v = validate();
        if(!v.ok){ alert(v.errs.join('\\n')); return; }
        buildSchedule();
        if($('#viewMode').value === 'yearly') renderYearly();
        else { renderTable(); }
      }

      function reset(){
        amount.value='25000'; apr.value='6.5'; years.value='5'; months.value='0';
        extraRecurring.value='0'; extraOnce.value='0'; extraOnceAt.value='1';
        taxMonthly.value='0'; insMonthly.value='0'; homeValue.value=''; pmiRate.value='0.00';
        $('#freqMonthly').checked = true;
        startDate.valueAsDate = new Date();
        schedule = []; page = 1;
        kpiPayment.textContent = '—'; kpiCount.textContent='—'; kpiInterest.textContent='—'; kpiTotal.textContent='—'; kpiPayoff.textContent='—'; kpiAllInPay.textContent='—';
        scheduleBody.innerHTML = ''; pageInfo.textContent='Page — of —';
      }

      // CSV export
      function toCSV(){
        const c = currFmt();
        const header = ['#','Date','Payment','Interest','Principal','Extra','PMI','Escrow','All-in','Balance'];
        const rows = schedule.map(r=>[
          r.k, r.date.toISOString().slice(0,10),
          r.payment.toFixed(2), r.interest.toFixed(2), r.principal.toFixed(2), r.extra.toFixed(2),
          r.pmi.toFixed(2), r.escrow.toFixed(2), r.allIn.toFixed(2), r.balance.toFixed(2)
        ]);
        const csv = [header.join(','), ...rows.map(r=>r.join(','))].join('\\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'loan-amortization-schedule.csv';
        a.click();
        URL.revokeObjectURL(a.href);
      }

      // Share link
      function copyShare(){
        const params = new URLSearchParams({
          c: currency.value,
          A: amount.value, apr: apr.value,
          y: years.value, m: months.value,
          f: getFreq(),
          s: startDate.value,
          er: extraRecurring.value, eo: extraOnce.value, eon: extraOnceAt.value,
          tx: taxMonthly.value, ins: insMonthly.value, hv: homeValue.value, pmi: pmiRate.value
        });
        const url = location.origin + location.pathname + '?' + params.toString();
        navigator.clipboard.writeText(url).then(()=>{ alert('Shareable link copied.'); });
      }

      // Hydrate from URL (nice UX)
      function fromURL(){
        const q = new URLSearchParams(location.search);
        if(q.size===0) return;
        if(q.get('c')) currency.value = q.get('c');
        if(q.get('A')) amount.value = q.get('A');
        if(q.get('apr')) apr.value = q.get('apr');
        if(q.get('y')) years.value = q.get('y');
        if(q.get('m')) months.value = q.get('m');
        const f = q.get('f'); if(f){ const r = $$('input[name="frequency"]').find(x=>x.value===f); if(r) r.checked = true; }
        if(q.get('s')) startDate.value = q.get('s');
        if(q.get('er')) extraRecurring.value = q.get('er');
        if(q.get('eo')) extraOnce.value = q.get('eo');
        if(q.get('eon')) extraOnceAt.value = q.get('eon');
        if(q.get('tx')) taxMonthly.value = q.get('tx');
        if(q.get('ins')) insMonthly.value = q.get('ins');
        if(q.get('hv')) homeValue.value = q.get('hv');
        if(q.get('pmi')) pmiRate.value = q.get('pmi');
      }

      // Paging + view toggles
      $('#prevPage').addEventListener('click', ()=>{ page=Math.max(1,page-1); renderTable(); });
      $('#nextPage').addEventListener('click', ()=>{ page=page+1; renderTable(); });
      $('#rowsPerPage').addEventListener('change', ()=>{ page=1; renderTable(); });
      $('#viewMode').addEventListener('change', ()=>{
        if($('#viewMode').value === 'yearly') renderYearly(); else renderTable();
      });

      // Buttons
      $('#calcBtn').addEventListener('click', calculate);
      $('#resetBtn').addEventListener('click', reset);
      $('#downloadBtn').addEventListener('click', ()=>{ if(schedule.length===0) calculate(); toCSV(); });
      $('#printBtn').addEventListener('click', ()=>{ if(schedule.length===0) calculate(); window.print(); });
      $('#shareBtn').addEventListener('click', copyShare);

      // Currency suffix sync
      function syncSuffixes(){
        const cur = currency.value;
        const symbol = new Intl.NumberFormat(undefined,{style:'currency',currency:cur}).formatToParts(0).find(p=>p.type==='currency')?.value || '$';
        ['amountSuffix','extraRecurringSuffix','extraOnceSuffix','taxMonthlySuffix','insMonthlySuffix','homeValueSuffix'].forEach(id=>{
          const el = document.getElementById(id); if(el) el.textContent = symbol;
        });
      }
      currency.addEventListener('change', ()=>{ syncSuffixes(); if(schedule.length) { renderTable(); } });

      // Mobile menu
      document.getElementById('mobile-menu-toggle')?.addEventListener('click', ()=>{
        document.getElementById('mobile-menu')?.classList.toggle('hidden');
      });

      // Defaults
      startDate.valueAsDate = new Date();
      amount.value='25000'; apr.value='6.5'; years.value='5'; months.value='0';
      syncSuffixes();
      fromURL();
      calculate();
    })();
  </script>
</body>
</html>
