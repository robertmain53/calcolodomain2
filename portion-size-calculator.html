<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portion Size Calculator – Daily & Per‑Meal Serving Targets</title>
  <meta name="description" content="Estimate daily and per‑meal portion sizes for major food groups based on your age, sex, height, weight, activity level, and goal. Includes formulas, methodology, and FAQs." />
  <link rel="canonical" href="https://calcdomain.com/portion-size-calculator.html" />

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <style>
    :root { --focus: #2563eb; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background:#f8fafc; color:#111827; }
    a { color:#2563eb; }
    .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    header, footer { background:#ffffff; border-bottom:1px solid #e5e7eb; }
    header .nav { display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:1rem; }
    header a.brand { font-weight:800; font-size:1.25rem; color:#2563eb; text-decoration:none; }
    main { padding: 2rem 1rem; }
    .layout { display:flex; flex-direction:column; gap:2rem; }
    @media (min-width:1024px){ .layout{ flex-direction:row; align-items:flex-start; } }

    /* Card */
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.04); padding:1.25rem; }
    .prose { max-width: 68ch; }
    .prose h2 { font-size:1.5rem; font-weight:700; margin:1.25rem 0 .75rem; }
    .prose h3 { font-size:1.125rem; font-weight:700; margin:1rem 0 .5rem; }
    .prose p { line-height:1.65; margin:.75rem 0; }
    .prose ul, .prose ol { padding-left:1.25rem; }
    .muted { color:#6b7280; }

    /* Forms */
    .grid { display:grid; gap:1rem; }
    .grid-2 { grid-template-columns: 1fr; }
    @media (min-width:768px){ .grid-2 { grid-template-columns: 1fr 1fr; } }
    label { display:block; font-size:.95rem; font-weight:600; margin-bottom:.35rem; }
    .req::after { content:" *"; color:#b91c1c; }
    input[type="number"], select { width:100%; padding:.75rem; border:1px solid #d1d5db; border-radius:10px; font-size:1rem; background:#fff; color:#111827; }
    input[type="number"]:focus, select:focus, button:focus { outline:3px solid var(--focus); outline-offset:1px; }
    .tip-btn { margin-left:.5rem; inline-size:2rem; block-size:2rem; border-radius:999px; border:1px solid #cbd5e1; background:#f8fafc; font-weight:700; cursor:pointer; }
    .tip { display:none; margin-top:.35rem; font-size:.9rem; color:#374151; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:8px; padding:.5rem .75rem; }
    .error { margin-top:.35rem; color:#b91c1c; font-size:.9rem; }

    /* Results */
    #results { min-height: 320px; }
    .result-grid { display:grid; grid-template-columns: 1fr; gap: .75rem; }
    @media (min-width:640px){ .result-grid { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (min-width:1024px){ .result-grid { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    .result-card { text-align:center; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; }
    .result-card h4 { color:#6b7280; font-size:.95rem; margin:.25rem 0; }
    .result-card p { font-size:1.5rem; font-weight:800; color:#1d4ed8; }

    .table-wrap { overflow-x:auto; border:1px solid #e5e7eb; border-radius:10px; }
    table { width:100%; border-collapse:collapse; font-size:.95rem; }
    thead { background:#f3f4f6; }
    th, td { padding:.75rem; border-bottom:1px solid #e5e7eb; text-align:right; }
    th:first-child, td:first-child, th:nth-child(2), td:nth-child(2) { text-align:left; }

    /* Buttons */
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.85rem 1rem; border:1px solid #1d4ed8; border-radius:12px; background:#1d4ed8; color:#fff; font-weight:700; cursor:pointer; min-width: 48px; min-height:48px; }
    .btn.secondary { background:#fff; color:#1d4ed8; }

    /* Print */
    @media print {
      body * { visibility:hidden; }
      #print-section, #print-section * { visibility:visible; }
      #print-section { position:absolute; left:0; top:0; width:100%; }
      #donut { display:none !important; }
    }
  </style>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Portion Size Calculator",
    "description": "Estimate daily and per‑meal portion sizes for major food groups based on your profile.",
    "url": "https://calcdomain.com/portion-size-calculator.html",
    "inLanguage": "en",
    "author": { "@type": "Person", "name": "Ugo Candido" },
    "publisher": { "@type": "Organization", "name": "CalcDomain" }
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Health & Fitness","item":"https://calcdomain.com/health-fitness.html"},
      {"@type":"ListItem","position":3,"name":"Diet & Nutrition","item":"https://calcdomain.com/subcategories/diet-nutrition.html"},
      {"@type":"ListItem","position":4,"name":"Portion Size Calculator","item":"https://calcdomain.com/portion-size-calculator.html"}
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to estimate appropriate portion sizes",
    "description": "Enter your details to estimate daily and per‑meal servings for major food groups.",
    "step": [
      {"@type":"HowToStep","name":"Enter profile","text":"Select sex and enter age, height, and weight."},
      {"@type":"HowToStep","name":"Choose activity","text":"Pick the activity level that best matches your routine."},
      {"@type":"HowToStep","name":"Set goal","text":"Maintain, lose (~10%) or gain (~10%) calories."},
      {"@type":"HowToStep","name":"Review servings","text":"See suggested daily and per‑meal portions across food groups."}
    ]
  }
  </script>
  <script type="application/ld+json" id="faq-json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": []
  }
  </script>
</head>
<body>
  <header>
    <nav class="nav container" aria-label="Primary">
      <a class="brand" href="index.html">CalcDomain</a>
      <div class="muted" aria-hidden="true">Health &raquo; Diet & Nutrition</div>
    </nav>
  </header>

  <main class="container">
    <div class="layout">
      <!-- Left/Main -->
      <section class="card" style="flex:2" id="print-section">
        <nav class="muted" aria-label="Breadcrumb">
          <a href="index.html">Home</a> »
          <a href="health-fitness.html">Health &amp; Fitness</a> »
          <a href="subcategories/diet-nutrition.html">Diet &amp; Nutrition</a> »
          <span aria-current="page">Portion Size Calculator</span>
        </nav>

        <h1 class="" style="font-size:2rem; font-weight:900; margin:.5rem 0 0.25rem;">Portion Size Calculator</h1>
        <p class="muted" style="margin-bottom:1rem;">Estimate daily and per‑meal serving targets for grains, vegetables, fruits, protein foods, dairy, and oils—personalized to your age, sex, height, weight, activity, and goal. Built for diet‑curious beginners and professionals who need a quick, transparent baseline.</p>

        <!-- Calculator UI -->
        <section aria-labelledby="calc-title" class="grid grid-2" id="calculator-ui">
          <h2 id="calc-title" class="sr-only">Calculator Inputs</h2>

          <div>
            <label for="sex" class="req">Sex</label>
            <div style="display:flex; align-items:center;">
              <select id="sex" aria-required="true" aria-describedby="sex-tip sex-err">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
              <button class="tip-btn" type="button" aria-expanded="false" aria-controls="sex-tip" title="What is this?">?</button>
            </div>
            <div id="sex-tip" class="tip">Used in the Mifflin–St Jeor equation to estimate basal metabolic rate (BMR).</div>
            <div id="sex-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="age" class="req">Age (years)</label>
            <input type="number" id="age" inputmode="numeric" min="14" max="99" step="1" value="30" aria-required="true" aria-describedby="age-tip age-err" />
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="age-tip" title="What is this?">?</button>
            <div id="age-tip" class="tip">Supported range 14–99. Outside this range, consult a clinician or pediatric guidance.</div>
            <div id="age-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="height" class="req">Height (cm)</label>
            <input type="number" id="height" inputmode="decimal" min="120" max="220" step="0.5" value="175" aria-required="true" aria-describedby="height-tip height-err" />
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="height-tip" title="What is this?">?</button>
            <div id="height-tip" class="tip">Enter height in centimeters. You can switch units below if preferred.</div>
            <div id="height-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="weight" class="req">Weight (kg)</label>
            <input type="number" id="weight" inputmode="decimal" min="35" max="250" step="0.1" value="70" aria-required="true" aria-describedby="weight-tip weight-err" />
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="weight-tip" title="What is this?">?</button>
            <div id="weight-tip" class="tip">Body weight in kilograms. For pounds, toggle units and the field will convert.</div>
            <div id="weight-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="activity" class="req">Activity level</label>
            <select id="activity" aria-required="true" aria-describedby="activity-tip activity-err">
              <option value="1.2">Sedentary (little or no exercise)</option>
              <option value="1.375">Light (1–3 days/week)</option>
              <option value="1.55" selected>Moderate (3–5 days/week)</option>
              <option value="1.725">Active (6–7 days/week)</option>
              <option value="1.9">Very Active (hard training)</option>
            </select>
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="activity-tip" title="What is this?">?</button>
            <div id="activity-tip" class="tip">Physical Activity Level (PAL) multiplier used to estimate total daily energy expenditure (TDEE).</div>
            <div id="activity-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="goal" class="req">Goal</label>
            <select id="goal" aria-required="true" aria-describedby="goal-tip goal-err">
              <option value="-0.10">Lose weight (~−10% kcal)</option>
              <option value="0" selected>Maintain</option>
              <option value="0.10">Gain weight (~+10% kcal)</option>
            </select>
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="goal-tip" title="What is this?">?</button>
            <div id="goal-tip" class="tip">Adjusts target calories relative to maintenance TDEE to guide portions.</div>
            <div id="goal-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="meals" class="req">Meals per day</label>
            <input type="number" id="meals" inputmode="numeric" min="1" max="8" step="1" value="3" aria-required="true" aria-describedby="meals-tip meals-err" />
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="meals-tip" title="What is this?">?</button>
            <div id="meals-tip" class="tip">Used to split daily targets into practical per‑meal portions.</div>
            <div id="meals-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div>
            <label for="units" class="req">Units</label>
            <select id="units" aria-required="true" aria-describedby="units-tip units-err">
              <option value="metric" selected>Metric (cm, kg)</option>
              <option value="us">US (ft/in, lb)</option>
            </select>
            <button class="tip-btn" type="button" aria-expanded="false" aria-controls="units-tip" title="What is this?">?</button>
            <div id="units-tip" class="tip">Switching units will convert the height and weight fields accordingly.</div>
            <div id="units-err" class="error" role="alert" aria-live="polite"></div>
          </div>

          <div class="grid grid-2" style="align-items:end;">
            <button id="calcBtn" class="btn" type="button" aria-describedby="calc-err">Calculate portions</button>
            <button id="printBtn" class="btn secondary" type="button">Print</button>
          </div>
          <div id="calc-err" class="error" role="alert" aria-live="polite"></div>
        </section>

        <!-- Results -->
        <section id="results" class="card" aria-labelledby="results-title" style="margin-top:1rem;">
          <h2 id="results-title" style="font-size:1.5rem; font-weight:800; margin-bottom:.5rem;">Results</h2>
          <p class="muted" id="summary"></p>
          <div class="result-grid" style="margin-top:1rem;">
            <div class="result-card"><h4>Target Calories</h4><p id="calories">—</p></div>
            <div class="result-card"><h4>Protein Foods</h4><p id="protein">—</p><div class="muted" id="protein-meal"></div></div>
            <div class="result-card"><h4>Grains</h4><p id="grains">—</p><div class="muted" id="grains-meal"></div></div>
            <div class="result-card"><h4>Vegetables</h4><p id="vegetables">—</p><div class="muted" id="vegetables-meal"></div></div>
            <div class="result-card"><h4>Fruits</h4><p id="fruits">—</p><div class="muted" id="fruits-meal"></div></div>
            <div class="result-card"><h4>Dairy</h4><p id="dairy">—</p><div class="muted" id="dairy-meal"></div></div>
            <div class="result-card"><h4>Oils</h4><p id="oils">—</p><div class="muted" id="oils-meal"></div></div>
          </div>

          <div class="table-wrap" style="margin-top:1rem;">
            <table aria-describedby="table-note">
              <thead>
                <tr>
                  <th>Food group</th>
                  <th>Daily target</th>
                  <th>Per‑meal (×<span id="mealsLabel">3</span>)</th>
                  <th>Common examples</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
          <p id="table-note" class="muted" style="margin-top:.5rem;">Portion units use MyPlate oz‑equivalents (grains, protein), cups (vegetables, fruits, dairy), and grams (oils).</p>
          <canvas id="donut" aria-label="Distribution of food groups (scaled to calories)" style="max-width:520px; width:100%; height:320px; margin:1rem auto 0; display:block;"></canvas>
        </section>

        <!-- Authoritative Content -->
        <article class="card prose" style="margin-top:1rem;">
          <h2>Data Source & Methodology</h2>
          <p><strong>AuthoritativeDataSource:</strong> United States Department of Agriculture (USDA) <em>MyPlate</em> Food Group Plans (2000‑kcal baseline) and <em>Dietary Guidelines for Americans</em> 2020–2025; Mifflin, M.D. et al. (1990) Mifflin–St Jeor resting metabolic rate equation.</p>
          <ul>
            <li>USDA MyPlate Plan: <a href="https://www.myplate.gov/myplate-plan" rel="nofollow">myplate.gov/myplate-plan</a></li>
            <li>Dietary Guidelines 2020–2025: <a href="https://www.dietaryguidelines.gov" rel="nofollow">dietaryguidelines.gov</a></li>
            <li>Mifflin–St Jeor (1990): <a href="https://pubmed.ncbi.nlm.nih.gov/2305711/" rel="nofollow">PubMed 2305711</a></li>
          </ul>
          <p><em>All calculations strictly follow the formulas and data provided by these sources.</em></p>

          <h2>The Formula Explained</h2>
          <div class="formula-box">
            <p>Basal Metabolic Rate (BMR):</p>
            <p>\[ \text{BMR}_{male} = 10\,w + 6.25\,h - 5\,a + 5 \]</p>
            <p>\[ \text{BMR}_{female} = 10\,w + 6.25\,h - 5\,a - 161 \]</p>
            <p>where \(w\) = weight (kg), \(h\) = height (cm), \(a\) = age (years).</p>
            <p>Total Daily Energy Expenditure (TDEE):</p>
            <p>\[ \text{TDEE} = \text{BMR} \times \text{PAL} \]</p>
            <p>Goal‑adjusted target calories:</p>
            <p>\[ C_\text{target} = \text{TDEE} \times (1 + g) \quad \text{with } g \in \{-0.10, 0, +0.10\} \]</p>
            <p>Daily servings per group are scaled from a 2000‑kcal baseline plan:</p>
            <p>\[ S_i = S_{i,2000} \times \frac{C_\text{target}}{2000} \]</p>
          </div>

          <h2>Glossary of Variables</h2>
          <ul>
            <li><strong>BMR</strong>: Basal Metabolic Rate (kcal/day) predicted by Mifflin–St Jeor.</li>
            <li><strong>PAL</strong>: Physical Activity Level multiplier (1.2–1.9).</li>
            <li><strong>Target calories</strong>: Calories/day after applying goal adjustment.</li>
            <li><strong>Servings</strong>: Daily amount by food group (oz‑eq or cups; oils in grams).</li>
          </ul>

          <h2>How It Works: A Step‑by‑Step Example</h2>
          <p>Example: Female, 30 y, 175 cm, 70 kg, Moderate PAL 1.55, Maintain, 3 meals/day.</p>
          <ol>
            <li>Compute BMR: \(10·70 + 6.25·175 - 5·30 - 161 = 1496.\)</li>
            <li>TDEE: \(1496 × 1.55 ≈ 2319\) kcal.</li>
            <li>Target calories: Maintain → \(C_\text{target} = 2319\) kcal.</li>
            <li>Scale servings from 2000‑kcal baseline using \(C_\text{target}/2000 = 1.16\).</li>
            <li>Divide daily servings by meals to get per‑meal suggestions.</li>
          </ol>

          <h2>Frequently Asked Questions</h2>
          <details>
            <summary>Is this medical advice?</summary>
            <p>No. This tool provides educational estimates based on public guidelines. Consult a qualified clinician or registered dietitian for personal medical advice.</p>
          </details>
          <details>
            <summary>Why scale linearly from a 2000‑kcal plan?</summary>
            <p>USDA group targets are defined across calorie levels. Linear scaling provides a transparent approximation between levels. Rounded outputs are for practicality.</p>
          </details>
          <details>
            <summary>Can I customize macro ratios?</summary>
            <p>This calculator focuses on food‑group servings. Macro ratio planning can be layered on top but is outside this tool’s scope.</p>
          </details>
          <details>
            <summary>What counts as an oz‑equivalent?</summary>
            <p>For grains and protein foods, USDA uses “oz‑equivalents.” Examples are shown in the table (e.g., 1 slice bread ≈ 1 oz‑eq grains).</p>
          </details>
          <details>
            <summary>How accurate are PAL multipliers?</summary>
            <p>PAL ranges are population averages. Individual energy needs vary with body composition, non‑exercise activity, and health status.</p>
          </details>
          <details>
            <summary>Can I use this for children or older adults?</summary>
            <p>Outputs are tuned for ages 14–99. For children, adolescents, or frail older adults, consult age‑specific guidance.</p>
          </details>

          <div class="card" style="background:#f9fafb; border-color:#e5e7eb;">
            <p><strong>Tool developed by Ugo Candido.</strong> Content reviewed by the CalcDomain Editorial Board.<br />
            Last accuracy review: <time id="last-review" datetime="2025-10-29">October 29, 2025</time></p>
          </div>
        </article>
      </section>

      <!-- Right/Aside -->
      <aside class="card" style="flex:1; position:sticky; top:1rem; align-self:start;">
        <h3 style="font-weight:800; font-size:1.1rem;">Why use this calculator</h3>
        <ul class="muted" style="margin-top:.5rem; line-height:1.6;">
          <li>Transparent formulas with LaTeX and cited sources.</li>
          <li>Daily and per‑meal portions you can act on today.</li>
          <li>Accessible UI with keyboard and screen‑reader support.</li>
        </ul>
        <hr style="margin:1rem 0; border:none; border-top:1px solid #e5e7eb;" />
        <h3 style="font-weight:800; font-size:1.1rem;">Related tools</h3>
        <ul style="line-height:1.6;">
          <li><a href="https://calcdomain.com/bmr.html">BMR Calculator</a></li>
          <li><a href="https://calcdomain.com/tdee.html">TDEE Calculator</a></li>
          <li><a href="https://calcdomain.com/calorie-deficit-calculator.html">Calorie Deficit Planner</a></li>
        </ul>
      </aside>
    </div>
  </main>

  <footer>
    <div class="container" style="text-align:center; padding:1.25rem; color:#6b7280;">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div style="margin-top:.5rem; display:flex; gap:.75rem; justify-content:center;">
        <a href="https://calcdomain.com/about.html">About</a>
        <a href="https://calcdomain.com/contact.html">Contact</a>
        <a href="https://calcdomain.com/privacy.html">Privacy</a>
        <a href="https://calcdomain.com/terms.html">Terms</a>
      </div>
    </div>
  </footer>

  <!-- JS (deferred at end for performance) -->
  <script defer src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer>
    // Accessible tooltip toggles
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('tip-btn')) {
        const btn = e.target;
        const tipId = btn.getAttribute('aria-controls');
        const tip = document.getElementById(tipId);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tip.style.display = expanded ? 'none' : 'block';
      }
    });

    const els = {
      sex: document.getElementById('sex'),
      age: document.getElementById('age'),
      height: document.getElementById('height'),
      weight: document.getElementById('weight'),
      activity: document.getElementById('activity'),
      goal: document.getElementById('goal'),
      meals: document.getElementById('meals'),
      units: document.getElementById('units'),
      calcBtn: document.getElementById('calcBtn'),
      printBtn: document.getElementById('printBtn'),
      calories: document.getElementById('calories'),
      protein: document.getElementById('protein'), grains: document.getElementById('grains'),
      vegetables: document.getElementById('vegetables'), fruits: document.getElementById('fruits'),
      dairy: document.getElementById('dairy'), oils: document.getElementById('oils'),
      pMeal: {
        protein: document.getElementById('protein-meal'), grains: document.getElementById('grains-meal'),
        vegetables: document.getElementById('vegetables-meal'), fruits: document.getElementById('fruits-meal'),
        dairy: document.getElementById('dairy-meal'), oils: document.getElementById('oils-meal')
      },
      tableBody: document.getElementById('tableBody'),
      mealsLabel: document.getElementById('mealsLabel'),
      summary: document.getElementById('summary'),
      calcErr: document.getElementById('calc-err'),
      // errors
      ageErr: document.getElementById('age-err'), heightErr: document.getElementById('height-err'), weightErr: document.getElementById('weight-err')
    };

    // Validation on blur
    function vNumber(el, min, max, errEl, label){
      const v = parseFloat(el.value);
      if (isNaN(v) || v < min || v > max){
        errEl.textContent = `${label} must be between ${min} and ${max}.`;
        el.setAttribute('aria-invalid','true');
        return false;
      }
      errEl.textContent = '';
      el.removeAttribute('aria-invalid');
      return true;
    }

    ['age','height','weight'].forEach(id => {
      const config = { age:[14,99,'Age'], height:[120,220,'Height'], weight:[35,250,'Weight'] }[id];
      document.getElementById(id).addEventListener('blur', (e)=>{
        const errMap = {age:els.ageErr, height:els.heightErr, weight:els.weightErr};
        vNumber(e.target, config[0], config[1], errMap[id], config[2]);
      });
    });

    // Unit switching with conversion
    els.units.addEventListener('change', ()=>{
      if (els.units.value === 'us'){
        // cm→in/ft not displayed, keep cm field but convert placeholder? Simpler: convert kg→lb and cm stays cm to avoid layout drift.
        const kg = parseFloat(els.weight.value)||0; els.weight.value = (kg*2.2046226218).toFixed(1);
        els.weight.previousUnit = 'lb';
        // Convert cm→inches display hint
        els.height.step = 0.25; els.height.min = 47; els.height.max = 87; // in inches approximate (120–220cm)
        const cm = parseFloat(els.height.value)||0; els.height.value = (cm/2.54).toFixed(1);
        els.height.setAttribute('aria-label','Height (in)');
        document.querySelector('label[for="height"]').textContent = 'Height (in)';
        document.querySelector('label[for="weight"]').textContent = 'Weight (lb)';
      } else {
        // US→Metric
        const lb = parseFloat(els.weight.value)||0; els.weight.value = (lb/2.2046226218).toFixed(1);
        els.height.step = 0.5; els.height.min = 120; els.height.max = 220;
        const inch = parseFloat(els.height.value)||0; els.height.value = (inch*2.54).toFixed(1);
        els.height.setAttribute('aria-label','Height (cm)');
        document.querySelector('label[for="height"]').textContent = 'Height (cm)';
        document.querySelector('label[for="weight"]').textContent = 'Weight (kg)';
      }
    });

    // Core logic
    const BASE = {
      calories: 2000,
      grains_oz: 6,
      vegetables_c: 2.5,
      fruits_c: 2,
      protein_oz: 5.5,
      dairy_c: 3,
      oils_g: 27
    };

    function bmr(sex, wKg, hCm, age){
      return sex === 'male'
        ? (10*wKg + 6.25*hCm - 5*age + 5)
        : (10*wKg + 6.25*hCm - 5*age - 161);
    }

    function roundNice(x, step){ return Math.round(x/step)*step; }

    function calc(){
      // Validate
      const ok = [
        vNumber(els.age,14,99,els.ageErr,'Age'),
        vNumber(els.height, els.units.value==='metric'?120:47, els.units.value==='metric'?220:87, els.heightErr,'Height'),
        vNumber(els.weight,  els.units.value==='metric'?35:77,  els.units.value==='metric'?250:551, els.weightErr,'Weight')
      ].every(Boolean);
      if(!ok){ els.calcErr.textContent='Please correct the highlighted fields.'; return; } else { els.calcErr.textContent=''; }

      // Normalize to metric for math
      const sex = els.sex.value;
      const age = parseFloat(els.age.value);
      const h = parseFloat(els.height.value);
      const w = parseFloat(els.weight.value);
      const hCm = els.units.value==='metric'? h : h*2.54;
      const wKg = els.units.value==='metric'? w : w/2.2046226218;
      const pal = parseFloat(els.activity.value);
      const goalAdj = parseFloat(els.goal.value);
      const meals = Math.max(1, Math.min(8, parseInt(els.meals.value)||3));

      const BMR = bmr(sex, wKg, hCm, age);
      const TDEE = BMR * pal;
      const Ctarget = TDEE * (1 + goalAdj);
      const scale = Ctarget / BASE.calories;

      // Scale servings
      const servings = {
        grains_oz: roundNice(BASE.grains_oz * scale, 0.5),
        vegetables_c: roundNice(BASE.vegetables_c * scale, 0.25),
        fruits_c: roundNice(BASE.fruits_c * scale, 0.25),
        protein_oz: roundNice(BASE.protein_oz * scale, 0.5),
        dairy_c: roundNice(BASE.dairy_c * scale, 0.25),
        oils_g: Math.round(BASE.oils_g * scale)
      };

      // Update summary and tiles
      document.getElementById('mealsLabel').textContent = meals;
      els.summary.textContent = `Based on your inputs, your estimated maintenance is ${Math.round(TDEE)} kcal/day. With goal adjustment, target is ${Math.round(Ctarget)} kcal/day.`;
      els.calories.textContent = `${Math.round(Ctarget)} kcal`;
      els.grains.textContent = `${servings.grains_oz} oz‑eq`;
      els.vegetables.textContent = `${servings.vegetables_c} cups`;
      els.fruits.textContent = `${servings.fruits_c} cups`;
      els.protein.textContent = `${servings.protein_oz} oz‑eq`;
      els.dairy.textContent = `${servings.dairy_c} cups`;
      els.oils.textContent = `${servings.oils_g} g`;

      // Per‑meal hints
      const perMeal = {
        grains: roundNice(servings.grains_oz / meals, 0.25),
        vegetables: roundNice(servings.vegetables_c / meals, 0.25),
        fruits: roundNice(servings.fruits_c / meals, 0.25),
        protein: roundNice(servings.protein_oz / meals, 0.25),
        dairy: roundNice(servings.dairy_c / meals, 0.25),
        oils: Math.round(servings.oils_g / meals)
      };
      els.pMeal.grains.textContent = `${perMeal.grains} oz‑eq / meal`;
      els.pMeal.vegetables.textContent = `${perMeal.vegetables} c / meal`;
      els.pMeal.fruits.textContent = `${perMeal.fruits} c / meal`;
      els.pMeal.protein.textContent = `${perMeal.protein} oz‑eq / meal`;
      els.pMeal.dairy.textContent = `${perMeal.dairy} c / meal`;
      els.pMeal.oils.textContent = `${perMeal.oils} g / meal`;

      // Table examples
      const rows = [
        ['Grains', `${servings.grains_oz} oz‑eq`, `${perMeal.grains} oz‑eq`, '1 slice bread = 1 oz‑eq; 1/2 cup cooked rice = 1 oz‑eq'],
        ['Vegetables', `${servings.vegetables_c} cups`, `${perMeal.vegetables} c`, '1 cup raw leafy greens = 1 c; 1/2 cup cooked veg = 1/2 c'],
        ['Fruits', `${servings.fruits_c} cups`, `${perMeal.fruits} c`, '1 small apple = 1 c; 1/2 cup dried fruit = 1 c'],
        ['Protein foods', `${servings.protein_oz} oz‑eq`, `${perMeal.protein} oz‑eq`, '1 egg = 1 oz‑eq; 1 oz cooked meat = 1 oz‑eq'],
        ['Dairy', `${servings.dairy_c} cups`, `${perMeal.dairy} c`, '1 cup milk/yogurt = 1 c; 1.5 oz cheese = 1 c'],
        ['Oils', `${servings.oils_g} g`, `${perMeal.oils} g`, '1 tsp oil ≈ 4.5 g; 1 tbsp ≈ 13.5 g']
      ];
      els.tableBody.innerHTML = rows.map(r=>`<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`).join('');

      // Chart
      renderChart(servings);

      // Inject FAQ JSON‑LD (kept minimal to avoid duplication of long text)
      const faq = {
        "@context":"https://schema.org",
        "@type":"FAQPage",
        "mainEntity":[
          {"@type":"Question","name":"Is this medical advice?","acceptedAnswer":{"@type":"Answer","text":"No. Educational estimates based on public guidelines; consult a clinician or dietitian for personal advice."}},
          {"@type":"Question","name":"Why scale linearly from a 2000‑kcal plan?","acceptedAnswer":{"@type":"Answer","text":"USDA group targets are defined by calorie levels. Linear scaling approximates between levels with practical rounding."}},
          {"@type":"Question","name":"What is an oz‑equivalent?","acceptedAnswer":{"@type":"Answer","text":"A standardized serving for grains and protein foods used by USDA. Examples: 1 slice bread or 1 oz cooked meat = 1 oz‑eq."}},
          {"@type":"Question","name":"How accurate are PAL multipliers?","acceptedAnswer":{"@type":"Answer","text":"They are population averages. Individual needs vary with body composition, NEAT, and health status."}},
          {"@type":"Question","name":"Can I use this for children?","acceptedAnswer":{"@type":"Answer","text":"This tool targets ages 14–99. For children or special populations, consult age‑specific guidance."}}
        ]
      };
      const faqScript = document.getElementById('faq-json');
      faqScript.textContent = JSON.stringify(faq);
    }

    let chart;
    function renderChart(s){
      const ctx = document.getElementById('donut');
      if (!ctx) return;
      const data = {
        labels: ['Grains (oz‑eq)', 'Vegetables (c)', 'Fruits (c)', 'Protein (oz‑eq)', 'Dairy (c)', 'Oils (g)'],
        datasets: [{ data: [s.grains_oz, s.vegetables_c, s.fruits_c, s.protein_oz, s.dairy_c, s.oils_g] }]
      };
      if (chart){ chart.data = data; chart.update(); }
      else { chart = new Chart(ctx, { type:'doughnut', data, options:{ plugins:{ legend:{ position:'bottom' } }, responsive:true, maintainAspectRatio:false } }); }
    }

    // Actions
    els.calcBtn.addEventListener('click', calc);
    els.printBtn.addEventListener('click', ()=> window.print());

    // Initial compute
    calc();
  </script>

  <!-- MathJax for LaTeX formulas (defer) -->
  <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
