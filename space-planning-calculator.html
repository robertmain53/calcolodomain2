<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space Planning Calculator - Estimate Total Required Area</title>
<meta name="description" content="Estimate the total required square footage (or meters) for an office, residential, or event project. Input occupants and room types to calculate net and gross area.">
<meta name="author" content="Ugo Candido">
<link rel="canonical" href="https://calcdomain.com/space-planning-calculator.html">

<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
font-size: 1.1rem;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }

/* Stili del calcolatore */
.form-label { display: block; text-sm; font-medium; text-gray-700; margin-bottom: 0.25rem; }
.form-input {
display: block; width: 100%; padding: 0.5rem 0.75rem;
border: 1px solid #d1d5db; border-radius: 0.375rem; shadow-sm;
min-height: 48px; /* Target tattile 48x48 */
}
.form-input:focus-visible {
outline: 3px solid #2563eb; /* Stile focus visibile A11y */
outline-offset: 1px;
border-color: #2563eb; box-shadow: 0 0 0 1px #2563eb;
}
.tooltip-btn {
display: inline-flex; align-items: center; justify-content: center;
width: 24px; height: 24px; padding: 0;
border-radius: 9999px; border: 1px solid #9ca3af;
background: #f9fafb; color: #6b7280;
font-weight: 700; cursor: help;
}
.remove-btn {
display: flex; align-items: center; justify-content: center;
height: 48px; width: 48px; padding: 0;
background: transparent; color: #ef4444; border: none;
border-radius: 0.375rem; cursor: pointer;
}
.remove-btn:hover { background-color: #fee2e2; }
.add-btn {
display: inline-flex; align-items: center; gap: 0.5rem;
padding: 0.6rem 1rem; min-height: 48px;
background-color: #2563eb; color: white;
font-weight: 500; border-radius: 0.375rem;
border: none; cursor: pointer;
}
.add-btn:hover { background-color: #1d4ed8; }

/* Stili dei risultati */
.results-container {
background: #f9fafb; border: 1px solid #e5e7eb;
border-radius: 10px; padding: 1.5rem;
min-height: 250px; /* Prevenzione CLS */
}
.result-card {
background: #fff; border: 1px solid #e5e7eb;
border-radius: 10px; padding: 1.25rem; text-align: center;
}
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; }
.result-card p { font-size: 1.75rem; font-weight: 700; color: #1f2937; }
.result-card p.primary-result { font-size: 2.25rem; font-weight: 800; color: #2563eb; }

/* Stile focus visibile globale */
*:focus-visible {
outline: 3px solid #2563eb !important;
outline-offset: 2px;
}

@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
#results-chart-container { display: none !important; }
}
</style>

<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "WebPage",
"name": "Space Planning Calculator",
"description": "Estimate the total required square footage (or meters) for an office, residential, or event project. Input occupants and room types to calculate net and gross area.",
"url": "https://calcdomain.com/space-planning-calculator.html",
"inLanguage": "en",
"author": { "@type": "Person", "name": "Ugo Candido" },
"publisher": { "@type": "Organization", "name": "CalcDomain" }space-planning-calculator
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
{ "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
{ "@type": "ListItem", "position": 2, "name": "Construction DIY", "item": "https://calcdomain.com/construction-diy.html" },
{ "@type": "ListItem", "position": 3, "name": "Project Layout Design", "item": "https://calcdomain.com/subcategories/construction-project-layout-design.html" },
{ "@type": "ListItem", "position": 4, "name": "Space Planning Calculator", "item": "https://calcdomain.com/space-planning-calculator.html" }
]
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "Calculator",
"name": "Space Planning Calculator",
"description": "Estimate total required space for office, residential, or event planning. Input occupants and room types to calculate net and gross square footage.",
"mainEntity": {
"@type": "HowTo",
"name": "How to Use the Space Planning Calculator",
"step": [
{"@type": "HowToStep", "name": "Add Space Types", "text": "Click 'Add Space' to create a row for each distinct area (e.g., 'Private Office', 'Lobby')."},
{"@type": "HowToStep", "name": "Enter Occupants", "text": "Input the maximum number of people that will use each space type."},
{"@type": "HowToStep", "name": "Enter Area Per Occupant", "text": "Input the net square footage (or meters) required for each person in that space. Use industry benchmarks or the provided FAQ for guidance."},
{"@type": "HowToStep", "name": "Set Circulation Factor", "text": "Enter a percentage (e.g., 20-30%) to account for non-usable areas like hallways, walls, and restrooms."},
{"@type": "HowToStep", "name": "Review Results", "text": "The calculator instantly updates to show your Net Usable Area, Circulation Allowance, and Total Required Area."}
]
},
"provider": {
"@type": "Organization",
"name": "CalcDomain"
},
"author": {
"@type": "Person",
"name": "Ugo Candido"
}
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "FAQPage",
"mainEntity": [
{
"@type": "Question",
"name": "What is a good Circulation Factor to use?",
"acceptedAnswer": {
"@type": "Answer",
"text": "This factor, also known as a 'gross-up' factor, typically ranges from 15% for very open plans to 35% for dense, private layouts. Good starting points are: 15-20% for open-plan offices, 25-30% for mixed layouts (offices and cubicles), and 30-35% for complex spaces like medical clinics or buildings with many private rooms and corridors."
}
},
{
"@type": "Question",
"name": "Where do I find the 'Area per Occupant' numbers?",
"acceptedAnswer": {
"@type": "Answer",
"text": "These numbers are based on building codes, industry benchmarks, and architectural standards. For example, the International Building Code (IBC) provides 'Occupant Load Factors' (e.g., 100 sq ft for an office, 15 sq ft for a conference room, 7 sq ft for assembly areas). You should consult these official sources or an architect for your specific use case."
}
},
{
"@type": "Question",
"name": "Does this calculator work for residential projects?",
"acceptedAnswer": {
"@type": "Answer",
"text": "Yes. You can use it for high-level residential planning. Use 'Bedrooms', 'Living Room', 'Kitchen' as space types. The 'Area per Occupant' will be different (e.g., a master bedroom might be 300-400 sq ft for 2 occupants). The principle of net area plus circulation still applies."
}
},
{
"@type": "Question",
"name": "What is the difference between 'Net' and 'Gross' area?",
"acceptedAnswer": {
"@type": "Answer",
"text": "'Net Usable Area' is the functional, programmable space within a building (e.g., offices, rooms, workstations). 'Total Required Area' (or Gross Area) is the Net Area *plus* all the space for circulation, walls, columns, mechanical rooms, and restrooms. Landlords typically lease space based on the Gross Area."
}
},
{
"@type": "Question",
"name": "Is this a substitute for a professional architect?",
"acceptedAnswer": {
"@type": "Answer",
"text": "No. This tool is for estimation and preliminary planning. A licensed architect or professional designer is required to create a detailed, code-compliant, and safe floor plan."
}
}
]
}
</script>

<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="construction-diy.html" class="hover:text-blue-600">Construction DIY</a> &raquo;
<a href="subcategories/construction-project-layout-design.html" class="hover:text-blue-600">Project Layout Design</a> &raquo;
<span class="text-gray-900">Space Planning Calculator</span>
</nav>

<div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Space Planning Calculator</h1>
<p class="text-gray-600 mb-6">This calculator helps you estimate the total square footage needed for your project—whether it's an office, home, or event. It's designed for facility managers, architects, and DIY planners to quickly translate occupant needs into a reliable gross area estimate.</p>

<form id="space-form">
<section id="calculator-ui" aria-label="Space Planning Inputs">
<div class="space-y-6">
<div id="space-list" class="space-y-4">
</div>

<button type="button" id="add-space-btn" class="add-btn">
<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
Add Space Type
</button>

<hr class="my-6">

<div class="max-w-md">
<div class="flex items-center gap-2 mb-1">
<label for="circulationFactor" class="form-label mb-0">Circulation Factor (%)<span class="text-red-500">*</span></label>
<button type="button" class="tooltip-btn" aria-label="What is Circulation Factor?" aria-describedby="circulation-tooltip" id="tooltip-btn">?</button>
</div>
<input type="number" id="circulationFactor" value="20" step="1" min="0" max="100" class="form-input" aria-required="true" aria-describedby="circulation-tooltip circulation-error">
<p id="circulation-tooltip" role="tooltip" class="text-sm text-gray-500 mt-1 hidden">
This is the 'gross-up' factor for non-usable space like hallways, walls, and restrooms. Common values are 15-30%.
</p>
<p id="circulation-error" class="text-sm text-red-600 mt-1 hidden" role="alert">Please enter a valid percentage.</p>
</div>
</div>
</section>

<button type="reset" id="reset-btn" class="mt-6 text-sm font-medium text-blue-600 hover:text-blue-800">Reset Calculator</button>
</form>

<section id="results" class="mt-8 results-container" aria-live="polite" aria-atomic="true">
<h2 class="text-xl font-semibold text-gray-900 mb-4">Your Space Estimate</h2>
<div class="flex flex-col md:flex-row gap-6">
<div class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
<div class="result-card">
<h4>Net Usable Area</h4>
<p id="net-area">0 sq ft</p>
</div>
<div class="result-card">
<h4>Circulation Allowance</h4>
<p id="circulation-area">0 sq ft</p>
</div>
<div class="result-card sm:col-span-2">
<h4>Total Required Area</h4>
<p id-"total-area" class="primary-result" id="total-area">0 sq ft</p>
</div>
</div>
<div class="w-full md:w-1/3">
<div id="results-chart-container" class="h-48 md:h-full">
<canvas id="resultsChart" aria-label="Net Area vs. Circulation Allowance chart"></canvas>
</div>
</div>
</div>
</section>
</div>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose prose-blue">
<h2>Data Source &amp; Methodology</h2>
<p>This calculator's methodology is based on standard architectural planning principles and occupant load factors derived from authoritative building codes, such as the <strong>International Building Code (IBC), 2021 Edition, Chapter 10: Means of Egress, Table 1004.1.2: Maximum Floor Area Allowances Per Occupant</strong>.</p>
<p>You can find similar data published by code authorities like the <a href="https://www.iccsafe.org/" target="_blank" rel="noopener nofollow">International Code Council (ICC)</a>. All calculations are based on the formulas derived from these standard principles for estimating net and gross area.</p>

<h2>The Formula Explained</h2>
<p>The calculator first determines the Net Usable Area by summing the requirements for each individual space type you define. The formula for the net area ($Area_{Net}$) is:</p>
<div class="formula-box" aria-label="Net Area Formula">
$$Area_{Net} = \sum_{i=1}^{n} (Occupants_i \times AreaPerOccupant_i)$$
</div>
<p class="mt-4">Where $i$ represents each space type row you add. Next, it applies the Circulation Factor to find the Total Required (Gross) Area ($Area_{Total}$):</p>
<div class="formula-box" aria-label="Total Area Formulas">
$$Area_{Circulation} = Area_{Net} \times (\frac{CirculationFactor\%}{100})$$
<br>
$$Area_{Total} = Area_{Net} + Area_{Circulation}$$
</div>

<h2>Glossary of Variables</h2>
<ul class="list-disc list-outside">
<li><strong>Space Type:</strong> A descriptive name for a distinct functional area (e.g., 'Private Office', 'Lobby', 'Kitchen').</li>
<li><strong>Number of Occupants:</strong> The maximum number of people expected to use that specific space at one time.</li>
<li><strong>Area per Occupant (sq ft):</strong> The net square footage allocated to each person *within that space*. This value varies widely by function (e.g., an office may be 100-150 sq ft/person, while a conference room is 15-25 sq ft/person).</li>
<li><strong>Circulation Factor (%):</strong> A crucial percentage added to the Net Area to account for all non-usable, shared spaces. This includes hallways, stairwells, elevators, mechanical rooms, restrooms, and the thickness of interior and exterior walls.</li>
<li><strong>Net Usable Area:</strong> The sum of all functional spaces. This is the "programmable" area where work and activities occur.</li>
<li><strong>Circulation Allowance:</strong> The total square footage calculated from the Circulation Factor.</li>
<li><strong>Total Required Area (Gross Area):</strong> The final footprint you need. This is the number a landlord would typically use for a lease or a builder would use for a total project estimate.</li>
</ul>

<h2>How It Works: A Step-by-Step Example</h2>
<p>Let's plan a small satellite office for a tech company.</p>
<p><strong>Inputs:</strong></p>
<ol>
<li><strong>Space 1:</strong> "Open Workstations", 12 Occupants, 80 sq ft/person</li>
<li><strong>Space 2:</strong> "Conference Room", 8 Occupants, 25 sq ft/person</li>
<li><strong>Space 3:</strong> "Kitchen/Break Room", 12 Occupants, 15 sq ft/person</li>
<li><strong>Global Input:</strong> "Circulation Factor" = 25%</li>
</ol>
<p><strong>Calculation:</strong></p>
<ol>
<li>
<strong>Calculate Net Area for each space:</strong>
<ul class="list-disc list-inside">
<li>Workstations: $12 \times 80 = 960 \text{ sq ft}$</li>
<li>Conference Room: $8 \times 25 = 200 \text{ sq ft}$</li>
<li>Break Room: $12 \times 15 = 180 \text{ sq ft}$</li>
</ul>
</li>
<li>
<strong>Sum for Total Net Area:</strong>
<p>$Area_{Net} = 960 + 200 + 180 = 1,340 \text{ sq ft}$</p>
</li>
<li>
<strong>Calculate Circulation Allowance:</strong>
<p>$Area_{Circulation} = 1,340 \text{ sq ft} \times 0.25 = 335 \text{ sq ft}$</p>
</li>
<li>
<strong>Calculate Total Required Area:</strong>
<p>$Area_{Total} = 1,340 \text{ sq ft} + 335 \text{ sq ft} = \textbf{1,675 sq ft}$</p>
</li>
</ol>
<p>The team would need to look for a space of approximately 1,675 sq ft.</p>

<h2>Frequently Asked Questions</h2>
<details>
<summary>What is a good Circulation Factor to use?</summary>
<p>This factor, also known as a 'gross-up' factor, typically ranges from 15% for very open plans to 35% for dense, private layouts. Good starting points are: <strong>15-20%</strong> for open-plan offices, <strong>25-30%</strong> for mixed layouts (offices and cubicles), and <strong>30-35%</strong> for complex spaces like medical clinics or buildings with many private rooms and corridors.</p>
</details>
<details>
<summary>Where do I find the 'Area per Occupant' numbers?</summary>
<p>These numbers are based on building codes, industry benchmarks, and architectural standards. For example, the International Building Code (IBC) provides 'Occupant Load Factors' (e.g., 100 sq ft for an office, 15 sq ft for a conference room, 7 sq ft for assembly areas). You should consult these official sources or an architect for your specific use case.</p>
</details>
<details>
<summary>Does this calculator work for residential projects?</summary>
<p>Yes. You can use it for high-level residential planning. Use 'Bedrooms', 'Living Room', 'Kitchen' as space types. The 'Area per Occupant' will be different (e.g., a master bedroom might be 300-400 sq ft for 2 occupants). The principle of net area plus circulation still applies.</p>
</details>
<details>
<summary>What's the difference between 'Net' and 'Gross' area?</summary>
<p>'Net Usable Area' is the functional, programmable space within a building (e.g., offices, rooms, workstations). 'Total Required Area' (or Gross Area) is the Net Area *plus* all the space for circulation, walls, columns, mechanical rooms, and restrooms. Landlords typically lease space based on the Gross Area.</p>
</details>
<details>
<summary>Is this a substitute for a professional architect?</summary>
<p>No. This tool is for estimation and preliminary planning. A licensed architect or professional designer is required to create a detailed, code-compliant, and safe floor plan.</p>
</details>
<details>
<summary>How does this calculator handle walls and columns?</summary>
<p>The area taken up by interior and exterior walls, as well as structural columns, is accounted for within the <strong>Circulation Factor (%)</strong>. This is precisely why the factor is added to the 'net' area.</p>
</details>

<div class="mt-8 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Architectural principles verified by the CalcDomain Editorial Board.<br>
Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>Get an instant, data-driven estimate of your total space needs.</li>
<li>Clearly understand the difference between usable (net) and total (gross) area.</li>
<li>Model different scenarios by adding or removing space types.</li>
<li>Plan budgets for leases or construction with a reliable gross square footage figure.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Layout Tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="room-size-calculator.html" class="text-blue-600 hover:underline">Room Size &amp; Dimensions Calculator</a></li>
<li><a href="office-layout-planner.html" class="text-blue-600 hover:underline">Office Layout Density Planner</a></li>
<li><a href="event-seating-calculator.html" class="text-blue-600 hover:underline">Event Seating &amp; Space Calculator</a></li>
<li><a href="paint-calculator.html" class="text-blue-600 hover:underline">Paint Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t mt-12">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="about.html" class="hover:text-blue-600">About</a>
<a href="contact.html" class="hover:text-blue-600">Contact</a>
<a href="privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<template id="space-row-template">
<div classT="dynamic-row grid grid-cols-1 md:grid-cols-4 gap-4 items-end p-4 border rounded-lg bg-gray-50">
<div class="md:col-span-2">
<label class="form-label" for="spaceType-0">Space Type</label>
<input type="text" class="form-input space-type" id="spaceType-0" placeholder="e.g., Private Office">
</div>
<div>
<label class="form-label" for="numOccupants-0">Occupants <span class="text-red-500">*</span></label>
<input type="number" class="form-input num-occupants" id="numOccupants-0" value="1" min="1" step="1" aria-required="true">
</div>
<div>
<label class="form-label" for="areaPerOccupant-0">Area/Occupant <span class="text-red-500">*</span></label>
<input type="number" class="form-input area-per-occupant" id="areaPerOccupant-0" value="100" min="1" step="1" aria-required="true" aria-describedby="area-unit">
<span id="area-unit" class="text-sm text-gray-500">sq ft</span>
</div>
<div class="text-right">
<button type="button" class="remove-btn" aria-label="Remove this space type">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
</button>
</div>
</div>
</template>


<script>
document.addEventListener('DOMContentLoaded', () => {
// --- Elementi DOM ---
const spaceForm = document.getElementById('space-form');
const spaceList = document.getElementById('space-list');
const spaceRowTemplate = document.getElementById('space-row-template');
const addSpaceBtn = document.getElementById('add-space-btn');
const resetBtn = document.getElementById('reset-btn');
const circulationFactorInput = document.getElementById('circulationFactor');
const tooltipBtn = document.getElementById('tooltip-btn');
const tooltipPanel = document.getElementById('circulation-tooltip');

// Elementi dei risultati
const netAreaEl = document.getElementById('net-area');
const circulationAreaEl = document.getElementById('circulation-area');
const totalAreaEl = document.getElementById('total-area');
const chartCtx = document.getElementById('resultsChart')?.getContext('2d');
let resultsChart = null;

// --- Utility Functions ---
let rowCounter = 0;
const fmtSqFt = (val) => new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 }).format(val || 0) + ' sq ft';

// --- Funzioni Principali ---

/**
* Aggiunge una nuova riga per il tipo di spazio al DOM
*/
function addSpaceRow() {
rowCounter++;
const clone = spaceRowTemplate.content.cloneNode(true);
const rowDiv = clone.querySelector('.dynamic-row');
rowDiv.id = `space-row-${rowCounter}`;

// Aggiorna ID e 'for' per accessibilità
const labelType = clone.querySelector('label[for="spaceType-0"]');
const inputType = clone.querySelector('input[id="spaceType-0"]');
labelType.htmlFor = `spaceType-${rowCounter}`;
inputType.id = `spaceType-${rowCounter}`;

const labelOccupants = clone.querySelector('label[for="numOccupants-0"]');
const inputOccupants = clone.querySelector('input[id="numOccupants-0"]');
labelOccupants.htmlFor = `numOccupants-${rowCounter}`;
inputOccupants.id = `numOccupants-${rowCounter}`;

const labelArea = clone.querySelector('label[for="areaPerOccupant-0"]');
const inputArea = clone.querySelector('input[id="areaPerOccupant-0"]');
labelArea.htmlFor = `areaPerOccupant-${rowCounter}`;
inputArea.id = `areaPerOccupant-${rowCounter}`;
inputArea.setAttribute('aria-describedby', `area-unit-${rowCounter}`);
clone.querySelector('#area-unit').id = `area-unit-${rowCounter}`;

// Aggiungi listener per rimuovere la riga
const removeBtn = clone.querySelector('.remove-btn');
removeBtn.setAttribute('aria-controls', `space-row-${rowCounter}`);
removeBtn.addEventListener('click', () => {
rowDiv.remove();
calculateAndRender();
});

spaceList.appendChild(clone);
}

/**
* Calcola e renderizza tutti i risultati
*/
function calculateAndRender() {
let totalNetArea = 0;
const spaceRows = spaceList.querySelectorAll('.dynamic-row');

spaceRows.forEach(row => {
const occupants = parseFloat(row.querySelector('.num-occupants').value) || 0;
const areaPer = parseFloat(row.querySelector('.area-per-occupant').value) || 0;
totalNetArea += (occupants * areaPer);
});

const circFactor = (parseFloat(circulationFactorInput.value) || 0) / 100;
const circulationArea = totalNetArea * circFactor;
const totalGrossArea = totalNetArea + circulationArea;

// Renderizza i risultati
netAreaEl.textContent = fmtSqFt(totalNetArea);
circulationAreaEl.textContent = fmtSqFt(circulationArea);
totalAreaEl.textContent = fmtSqFt(totalGrossArea);

// Renderizza il grafico
renderChart(totalNetArea, circulationArea);
}

/**
* Aggiorna o crea il grafico a ciambella
*/
function renderChart(net, circ) {
if (!chartCtx) return; // Non fare nulla se il canvas non esiste

const data = {
labels: ['Net Usable Area', 'Circulation Allowance'],
datasets: [{
data: [Math.max(0, net), Math.max(0, circ)],
backgroundColor: ['#2563eb', '#f97316'], // Blu (Primario), Arancione
borderColor: '#f9fafb',
borderWidth: 2
}]
};

if (resultsChart) {
// Aggiorna il grafico esistente
resultsChart.data = data;
resultsChart.update();
} else {
// Crea un nuovo grafico
resultsChart = new Chart(chartCtx, {
type: 'doughnut',
data: data,
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
position: 'bottom',
labels: {
boxWidth: 12,
padding: 15
}
},
tooltip: {
callbacks: {
label: function(context) {
let label = context.label || '';
let value = context.raw || 0;
return `${label}: ${fmtSqFt(value)}`;
}
}
}
}
}
});
}
}

// --- Event Listeners ---

// Calcola su qualsiasi input nel form
spaceForm.addEventListener('input', (e) => {
if (e.target.tagName === 'INPUT') {
// Validazione di base (non-negativo)
if (e.target.type === 'number' && parseFloat(e.target.value) < 0) {
e.target.value = '0';
}
calculateAndRender();
}
});

// Aggiungi una nuova riga
addSpaceBtn.addEventListener('click', addSpaceRow);

// Gestione del Reset
resetBtn.addEventListener('click', () => {
spaceList.innerHTML = ''; // Svuota tutte le righe
circulationFactorInput.value = '20'; // Resetta il fattore
addSpaceRow(); // Aggiungi una riga vuota
calculateAndRender(); // Ricalcola (mostrerà 0)
});

// Gestione del Tooltip
tooltipBtn.addEventListener('click', () => {
const isHidden = tooltipPanel.classList.toggle('hidden');
tooltipBtn.setAttribute('aria-expanded', !isHidden);
});

// --- Inizializzazione ---
addSpaceRow(); // Aggiungi la prima riga al caricamento
calculateAndRender(); // Esegui un calcolo iniziale
});

// Gestione menu mobile (dal template)
document.getElementById('mobile-menu-toggle').addEventListener('click', function () {
const menu = document.getElementById('mobile-menu');
const isHidden = menu.classList.toggle('hidden');
this.setAttribute('aria-expanded', !isHidden);
});
</script>

</body>
</html>