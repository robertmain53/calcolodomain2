<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Network Calculator (IPv4 & IPv6) — CIDR, Subnet, Usable Hosts</title>
  <meta name="description" content="Professional IPv4 & IPv6 network calculator. Compute CIDR, subnet mask, network/broadcast, first/last usable, private ranges, reverse DNS (in-addr.arpa / ip6.arpa), and more. Built for reliability and accessibility." />
  <link rel="canonical" href="https://calcdomain.com/network-calculator.html" />
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
  <meta name="theme-color" content="#0b57d0">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- MathJax for LaTeX formulas (deferred) -->
  <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          integrity="sha256-6qPqV3k7vN0fI7gG9i9y8xi9r6Q+VQ3tC3i5P1p3i7s=" crossorigin="anonymous"></script>

  <style>
    /* Typography and readable line-length */
    body{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .prose{max-width:65ch}
    .prose h2{font-size:1.5rem;font-weight:700;margin-top:1.75rem;margin-bottom:0.75rem}
    .prose h3{font-size:1.125rem;font-weight:700;margin-top:1.25rem;margin-bottom:0.5rem}
    .prose p{margin:0.75rem 0;line-height:1.65}
    .formula-box{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:10px;padding:1rem;overflow:auto}
    /* Visible focus */
    :focus{outline:3px solid #0ea5e9;outline-offset:2px}
    /* Touch targets */
    .tap-target{min-height:48px;min-width:48px}
    /* Result area min-height to avoid CLS */
    #results-container{min-height:18rem}
    /* Data tables */
    table{border-collapse:collapse}
    th,td{border-bottom:1px solid #e5e7eb}
    th{background:#f8fafc;text-transform:uppercase;font-size:.75rem;color:#475569;letter-spacing:.03em}
    /* Print */
    @media print{
      header,footer,aside,#faq,#related,#ads{display:none !important}
      main{padding:0}
      #results-card{box-shadow:none;border:1px solid #e5e7eb}
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Network Calculator (IPv4 & IPv6)",
    "description":"Compute IPv4 & IPv6 network essentials: CIDR, subnet mask, network/broadcast, usable hosts, private ranges, reverse DNS.",
    "url":"https://calcdomain.com/network-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Lifestyle Everyday","item":"https://calcdomain.com/lifestyle-everyday.html"},
      {"@type":"ListItem","position":3,"name":"Miscellaneous","item":"https://calcdomain.com/subcategories/miscellaneous.html"},
      {"@type":"ListItem","position":4,"name":"Network Calculator","item":"https://calcdomain.com/network-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to calculate IPv4/IPv6 network information",
    "description":"Enter an IP with CIDR, choose version, and read network/broadcast, usable range, and masks.",
    "step":[
      {"@type":"HowToStep","name":"Choose IP version","text":"Select IPv4 or IPv6."},
      {"@type":"HowToStep","name":"Enter IP/CIDR","text":"Type an address like 192.168.1.10/24 or 2001:db8::1/64."},
      {"@type":"HowToStep","name":"Validate","text":"Fix any highlighted errors (format, prefix range)."},
      {"@type":"HowToStep","name":"Review results","text":"See network address, range, mask, reverse DNS and classification."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a class="text-2xl font-extrabold text-blue-700" href="index.html">CalcDomain</a>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a class="hover:text-blue-700" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-700" href="index.html#categories">Categories</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a class="hover:text-blue-700" href="index.html">Home</a> &raquo;
          <a class="hover:text-blue-700" href="lifestyle-everyday.html">Lifestyle Everyday</a> &raquo;
          <a class="hover:text-blue-700" href="subcategories/miscellaneous.html">Miscellaneous</a> &raquo;
          <span class="text-gray-900">Network Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
          <h1 class="text-3xl font-extrabold mb-2">network calculator</h1>
          <p class="text-gray-700 mb-6">
            A precise IPv4/IPv6 subnet tool for engineers, admins, and learners. Enter an address in CIDR notation to get
            network/broadcast, first &amp; last usable, subnet/wildcard masks (IPv4), reverse DNS pointers, and private/public classification.
          </p>

          <!-- Calculator -->
          <section id="calculator" class="space-y-6" aria-labelledby="calcHeading">
            <h2 id="calcHeading" class="sr-only">Network calculator inputs</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- IP version -->
              <div>
                <label for="ipVersion" class="block text-sm font-medium text-gray-800">
                  IP Version <span aria-hidden="true" class="text-red-600">*</span>
                </label>
                <div class="mt-1 relative">
                  <select id="ipVersion" class="tap-target w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600"
                          aria-required="true" aria-describedby="ipVersion-help">
                    <option value="v4" selected>IPv4</option>
                    <option value="v6">IPv6</option>
                  </select>
                </div>
                <p id="ipVersion-help" class="text-xs text-gray-600 mt-1">Choose IPv4 (32-bit) or IPv6 (128-bit).</p>
              </div>

              <!-- Address/CIDR -->
              <div>
                <div class="flex items-center justify-between">
                  <label for="ipCidr" class="block text-sm font-medium text-gray-800">
                    Address in CIDR <span aria-hidden="true" class="text-red-600">*</span>
                  </label>
                  <button type="button" class="tap-target text-sm px-2 py-1 rounded border hover:bg-gray-50"
                          aria-expanded="false" aria-controls="tip-ip" id="tip-btn-ip" title="What is CIDR?">
                    ?
                  </button>
                </div>
                <input id="ipCidr" class="tap-target mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600"
                       placeholder="e.g., 192.168.1.10/24 or 2001:db8::1/64"
                       inputmode="text" aria-required="true" aria-describedby="ip-error tip-ip">
                <p id="ip-error" class="text-sm text-red-700 mt-1 hidden" role="alert"></p>
                <div id="tip-ip" class="text-xs text-gray-600 mt-2 hidden">
                  Enter an IP followed by “/prefix”. Examples: <code>10.0.0.1/8</code>, <code>172.16.5.10/16</code>, <code>192.168.1.10/24</code>,
                  <code>2001:db8::1/64</code>. CIDR prefix ranges: IPv4 (0–32), IPv6 (0–128).
                </div>
              </div>

              <!-- Optional: subnet mask (IPv4 helper) -->
              <div>
                <div class="flex items-center justify-between">
                  <label for="maskHelper" class="block text-sm font-medium text-gray-800">
                    IPv4 Subnet Mask (optional)
                  </label>
                  <button type="button" class="tap-target text-sm px-2 py-1 rounded border hover:bg-gray-50"
                          aria-expanded="false" aria-controls="tip-mask" id="tip-btn-mask" title="Mask helper">
                    ?
                  </button>
                </div>
                <input id="maskHelper" class="tap-target mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600"
                       placeholder="e.g., 255.255.255.0 (auto-derives /24)" aria-describedby="tip-mask">
                <div id="tip-mask" class="text-xs text-gray-600 mt-2 hidden">
                  If provided, the calculator will sync the CIDR prefix with this mask (IPv4 only).
                </div>
              </div>

              <!-- Actions -->
              <div class="flex gap-3 items-end">
                <button id="btnCalc" class="tap-target inline-flex items-center justify-center px-4 py-2 bg-blue-700 text-white font-semibold rounded shadow hover:bg-blue-800"
                        aria-label="Calculate">
                  Calculate
                </button>
                <button id="btnClear" class="tap-target inline-flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-900 font-semibold rounded border hover:bg-gray-200"
                        aria-label="Clear inputs">
                  Clear
                </button>
              </div>
            </div>
          </section>

          <!-- Results -->
          <section id="results-container" class="mt-8">
            <div id="results-card" class="bg-blue-50 border border-blue-100 rounded-lg p-6">
              <h2 class="text-xl font-bold text-blue-900 mb-4">Results</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white rounded-lg p-4 border">
                  <h3 class="font-semibold text-gray-700 mb-2">General</h3>
                  <dl class="text-sm space-y-2">
                    <div class="flex justify-between"><dt class="text-gray-600">IP Version</dt><dd id="r-version" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Input Address</dt><dd id="r-input" class="font-mono break-all">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">CIDR Prefix</dt><dd id="r-prefix" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Type</dt><dd id="r-type" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Private/Reserved</dt><dd id="r-private" class="font-mono">—</dd></div>
                  </dl>
                </div>

                <div class="bg-white rounded-lg p-4 border">
                  <h3 class="font-semibold text-gray-700 mb-2">Mask / Size</h3>
                  <dl class="text-sm space-y-2">
                    <div class="flex justify-between"><dt class="text-gray-600">Subnet Mask (v4)</dt><dd id="r-mask" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Wildcard Mask (v4)</dt><dd id="r-wild" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Block Size</dt><dd id="r-block" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600"># of Addresses</dt><dd id="r-count" class="font-mono">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Usable Hosts (v4)</dt><dd id="r-usable" class="font-mono">—</dd></div>
                  </dl>
                </div>

                <div class="bg-white rounded-lg p-4 border md:col-span-2">
                  <h3 class="font-semibold text-gray-700 mb-2">Range</h3>
                  <dl class="text-sm space-y-2">
                    <div class="flex justify-between"><dt class="text-gray-600">Network</dt><dd id="r-network" class="font-mono break-all">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">First Usable</dt><dd id="r-first" class="font-mono break-all">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Last Usable</dt><dd id="r-last" class="font-mono break-all">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">Broadcast (v4)</dt><dd id="r-broadcast" class="font-mono break-all">—</dd></div>
                  </dl>
                </div>

                <div class="bg-white rounded-lg p-4 border md:col-span-2">
                  <h3 class="font-semibold text-gray-700 mb-2">Representations</h3>
                  <dl class="text-sm space-y-2">
                    <div class="flex justify-between"><dt class="text-gray-600">Reverse DNS</dt><dd id="r-rev" class="font-mono break-all">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">IPv6 (Compressed)</dt><dd id="r-v6c" class="font-mono break-all">—</dd></div>
                    <div class="flex justify-between"><dt class="text-gray-600">IPv6 (Expanded)</dt><dd id="r-v6e" class="font-mono break-all">—</dd></div>
                  </dl>
                </div>
              </div>

              <!-- Live announcements for screen readers -->
              <div class="sr-only" aria-live="polite" id="live"></div>
            </div>
          </section>

          <!-- Authoritative Content -->
          <section class="prose mt-10">
            <h2>Data Source &amp; Methodology</h2>
            <p>
              Primary references:
              <ul class="list-disc ml-6">
                <li><strong>IETF RFC 4632</strong> — Classless Inter-Domain Routing (CIDR): <em>IPv4 Addressing Architecture</em> (August 2006).</li>
                <li><strong>IETF RFC 791</strong> — Internet Protocol (IPv4) (September 1981).</li>
                <li><strong>IETF RFC 4291</strong> — IPv6 Addressing Architecture (February 2006).</li>
                <li><strong>IETF RFC 1035</strong> — DNS: in-addr.arpa / ip6.arpa reverse mapping (November 1987).</li>
              </ul>
            </p>
            <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

            <h2>The Formula Explained</h2>
            <div class="formula-box">
              <p><strong>Number of addresses</strong> for prefix \( p \):</p>
              <p>IPv4: \( N = 2^{(32 - p)} \), &nbsp; IPv6: \( N = 2^{(128 - p)} \)</p>
              <p><strong>Network address</strong> (integer form):</p>
              <p>\( \text{network} = \left\lfloor \dfrac{\text{address}}{2^{(W - p)}} \right\rfloor \times 2^{(W - p)} \) where \( W=32 \) (IPv4) or \( W=128 \) (IPv6).</p>
              <p><strong>Broadcast</strong> (IPv4): \( \text{broadcast} = \text{network} + N - 1 \)</p>
              <p><strong>First/Last usable</strong> (IPv4, \(p \le 30\)):</p>
              <p>\( \text{first} = \text{network} + 1,\quad \text{last} = \text{broadcast} - 1 \)</p>
            </div>

            <h2>Glossary of Variables</h2>
            <ul>
              <li><strong>Address</strong>: The input IP (IPv4 dotted quad or IPv6 hex) with CIDR prefix.</li>
              <li><strong>Prefix (p)</strong>: Bits that identify the network portion (0–32 for IPv4, 0–128 for IPv6).</li>
              <li><strong>Subnet Mask</strong>: IPv4 mask derived from the prefix (e.g., /24 → 255.255.255.0).</li>
              <li><strong>Wildcard Mask</strong>: IPv4 complement mask (e.g., 0.0.0.255 for /24).</li>
              <li><strong>Network/Broadcast</strong>: First and last addresses in the block (broadcast only for IPv4).</li>
              <li><strong>Usable Hosts</strong>: Number of assignable addresses (IPv4 excludes network &amp; broadcast for /0–/30; special cases noted).</li>
            </ul>

            <h2>How It Works: A Step-by-Step Example</h2>
            <p><strong>Example:</strong> <code>192.168.10.42/26</code></p>
            <ol>
              <li>Prefix \(p=26\) ⇒ \(N = 2^{(32-26)} = 64\) addresses.</li>
              <li>Mask = 255.255.255.192; Wildcard = 0.0.0.63.</li>
              <li>Network = 192.168.10.<code>0</code> + multiples of 64 ⇒ 192.168.10.<code>0</code>, 64, 128, 192 … The host (42) lies in the 0–63 block ⇒ Network = <code>192.168.10.0</code>.</li>
              <li>Broadcast = Network + 63 = <code>192.168.10.63</code>.</li>
              <li>Usable = 62 addresses: <code>192.168.10.1</code> to <code>192.168.10.62</code>.</li>
            </ol>

            <h2 id="faq">FAQ</h2>
            <details>
              <summary>What prefixes are valid?</summary>
              <p>IPv4 allows /0 to /32; IPv6 allows /0 to /128. Subnetting typically uses /8–/30 (IPv4) and /32–/64 (IPv6) for routing practicality.</p>
            </details>
            <details>
              <summary>Why are /31 and /32 special in IPv4?</summary>
              <p>/31 (RFC 3021) can be used for point-to-point without broadcast; /32 denotes a single host route. Usable host count differs from classic “minus 2” rule.</p>
            </details>
            <details>
              <summary>How do private ranges get detected?</summary>
              <p>The tool checks RFC-defined ranges (e.g., 10/8, 172.16/12, 192.168/16 for IPv4; fc00::/7 for IPv6 unique local).</p>
            </details>
            <details>
              <summary>Why show reverse DNS?</summary>
              <p>Operations teams use in-addr.arpa/ip6.arpa to verify PTR (reverse) records. We assemble the canonical pointer for the network address.</p>
            </details>
            <details>
              <summary>What if I only enter a mask?</summary>
              <p>For IPv4 you can paste a mask (e.g., 255.255.255.0) in the helper. The calculator will map it to the nearest valid prefix.</p>
            </details>
            <details>
              <summary>Does the tool validate non-canonical IPv6?</summary>
              <p>Yes—addresses are normalized to compressed and expanded forms. Invalid compressions or hextet sizes trigger accessible error messages.</p>
            </details>

            <div class="mt-6 p-4 bg-gray-50 border rounded text-sm text-gray-700">
              <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
              Last accuracy review: <time datetime="2025-10-26">October 26, 2025</time></p>
            </div>
          </section>
        </div>
      </section>

      <aside class="w-full lg:w-1/3" id="related">
        <div id="ads" class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-600">
          Ad Placement (300×600)
        </div>

        <div class="bg-white mt-6 p-6 rounded-lg shadow-md">
          <h3 class="font-bold text-lg mb-3">Why this calculator</h3>
          <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
            <li>IPv4 &amp; IPv6 in one place with robust parsing.</li>
            <li>Accessible, keyboard-friendly UI for professionals.</li>
            <li>Clear reverse DNS pointers and canonical IPv6 formatting.</li>
          </ul>
        </div>

        <div class="bg-white mt-6 p-6 rounded-lg shadow-md">
          <h3 class="font-bold text-lg mb-4">Related networking tools</h3>
          <ul class="space-y-3 text-sm">
            <li><a class="text-blue-700 hover:underline" href="ipv4-to-binary.html">IPv4 to Binary Converter</a></li>
            <li><a class="text-blue-700 hover:underline" href="ipv6-expander.html">IPv6 Expander/Compressor</a></li>
            <li><a class="text-blue-700 hover:underline" href="cidr-to-mask.html">CIDR ↔ Mask Converter</a></li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a class="hover:text-blue-700" href="about.html">About</a>
        <a class="hover:text-blue-700" href="contact.html">Contact</a>
        <a class="hover:text-blue-700" href="privacy.html">Privacy</a>
        <a class="hover:text-blue-700" href="terms.html">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (placed before </body> per perf spec). Inline scripts don't honor defer; kept at end to avoid blocking. -->
  <script>
  (function(){
    const els = {
      ipVersion: document.getElementById('ipVersion'),
      ipCidr: document.getElementById('ipCidr'),
      maskHelper: document.getElementById('maskHelper'),
      btnCalc: document.getElementById('btnCalc'),
      btnClear: document.getElementById('btnClear'),
      tipBtnIp: document.getElementById('tip-btn-ip'),
      tipIp: document.getElementById('tip-ip'),
      tipBtnMask: document.getElementById('tip-btn-mask'),
      tipMask: document.getElementById('tip-mask'),
      errIp: document.getElementById('ip-error'),
      live: document.getElementById('live'),

      rVersion: document.getElementById('r-version'),
      rInput: document.getElementById('r-input'),
      rPrefix: document.getElementById('r-prefix'),
      rType: document.getElementById('r-type'),
      rPrivate: document.getElementById('r-private'),
      rMask: document.getElementById('r-mask'),
      rWild: document.getElementById('r-wild'),
      rBlock: document.getElementById('r-block'),
      rCount: document.getElementById('r-count'),
      rUsable: document.getElementById('r-usable'),
      rNetwork: document.getElementById('r-network'),
      rFirst: document.getElementById('r-first'),
      rLast: document.getElementById('r-last'),
      rBroadcast: document.getElementById('r-broadcast'),
      rRev: document.getElementById('r-rev'),
      rV6c: document.getElementById('r-v6c'),
      rV6e: document.getElementById('r-v6e')
    };

    // Accessible tooltip toggles
    function toggleTip(btn, panel){
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      panel.classList.toggle('hidden', expanded);
    }
    els.tipBtnIp.addEventListener('click', ()=>toggleTip(els.tipBtnIp, els.tipIp));
    els.tipBtnMask.addEventListener('click', ()=>toggleTip(els.tipBtnMask, els.tipMask));

    // Utility: number format
    const nf = new Intl.NumberFormat(undefined);

    // IPv4 helpers
    function isValidIPv4(str){
      const parts = str.split('.');
      if(parts.length !== 4) return false;
      for(const p of parts){
        if(!/^\d{1,3}$/.test(p)) return false;
        const n = Number(p);
        if(n < 0 || n > 255 || (p.length>1 && p[0]==='0' && p!=='0')) return false;
      }
      return true;
    }
    function ipv4ToInt(str){
      return str.split('.').reduce((acc,oct)=> (acc<<8) + Number(oct), 0) >>> 0;
    }
    function intToIPv4(n){
      return [24,16,8,0].map(shift=> (n>>>shift) & 255).join('.');
    }
    function prefixToMaskV4(p){
      let mask = (p===0)?0: (0xFFFFFFFF << (32 - p)) >>> 0;
      return intToIPv4(mask);
    }
    function maskToPrefixV4(mask){
      if(!isValidIPv4(mask)) return null;
      const m = ipv4ToInt(mask);
      // must be contiguous ones
      let seenZero = false, count=0;
      for(let i=31;i>=0;i--){
        const bit = (m>>>i) & 1;
        if(bit===1){
          if(seenZero) return null;
          count++;
        }else{
          seenZero = true;
        }
      }
      return count;
    }
    function wildcardFromMask(mask){
      const m = ipv4ToInt(mask);
      return intToIPv4((~m) >>> 0);
    }
    function isPrivateV4(int){
      // RFC 1918 + 127/8 loopback + 169.254/16 link-local
      if((int & 0xff000000) === 0x0a000000) return true;        // 10.0.0.0/8
      if((int & 0xfff00000) === 0xac100000) return true;        // 172.16.0.0/12
      if((int & 0xffff0000) === 0xc0a80000) return true;        // 192.168.0.0/16
      if((int & 0xff000000) === 0x7f000000) return true;        // 127.0.0.0/8
      if((int & 0xffff0000) === 0xa9fe0000) return true;        // 169.254.0.0/16
      return false;
    }
    function reverseIPv4(int){
      const a = [ (int>>>24)&255, (int>>>16)&255, (int>>>8)&255, int&255 ];
      return a.reverse().join('.') + '.in-addr.arpa.';
    }

    // IPv6 helpers (BigInt)
    function expandIPv6(address){
      // Normalize :: compression to full 8 hextets
      if(address.indexOf('::') !== -1){
        const [head, tail] = address.split('::');
        const headParts = head ? head.split(':') : [];
        const tailParts = tail ? tail.split(':') : [];
        const missing = 8 - (headParts.length + tailParts.length);
        if(missing < 0) return null;
        const zeros = Array(missing).fill('0');
        const parts = [...headParts, ...zeros, ...tailParts];
        return parts.map(h => h.padStart(4,'0')).join(':');
      } else {
        const parts = address.split(':');
        if(parts.length !== 8) return null;
        return parts.map(h => {
          if(h.length===0 || h.length>4 || !/^[0-9a-fA-F]{1,4}$/.test(h)) return null;
          return h.padStart(4,'0');
        }).join(':');
      }
    }
    function compressIPv6(expanded){
      // Remove leading zeros and compress longest run of :0:
      const parts = expanded.split(':').map(h=>h.replace(/^0+([0-9a-fA-F]{1,4})$/,'$1').replace(/^0$/,'0'));
      // find longest zero run
      let bestStart=-1,bestLen=0,curStart=-1,curLen=0;
      for(let i=0;i<8;i++){
        if(parts[i]==='0'){
          if(curStart===-1){curStart=i;curLen=1;} else curLen++;
        } else {
          if(curLen>bestLen){bestLen=curLen;bestStart=curStart;}
          curStart=-1;curLen=0;
        }
      }
      if(curLen>bestLen){bestLen=curLen;bestStart=curStart;}
      if(bestLen>1){
        const before = parts.slice(0,bestStart);
        const after = parts.slice(bestStart+bestLen);
        return (before.length?before.join(':'):'') + '::' + (after.length?after.join(':'):'');
      }
      return parts.join(':');
    }
    function ipv6ToBig(expanded){
      const parts = expanded.split(':').map(h=>BigInt('0x'+h));
      return parts.reduce((acc,h)=> (acc<<16n) + h, 0n);
    }
    function bigToIPv6(n){
      const parts = [];
      for(let i=7;i>=0;i--){
        const h = (n >> BigInt(i*16)) & 0xffffn;
        parts.push(h.toString(16));
      }
      const expanded = parts.map(h=>h.padStart(4,'0')).join(':');
      return {
        expanded,
        compressed: compressIPv6(expanded)
      };
    }
    function countAddrsV6(prefix){
      const bits = 128 - prefix;
      // Return string representation: "2^(bits)"
      return `2^${bits}`;
    }
    function isPrivateV6(big){
      // Unique local fc00::/7
      return (big >> 121n) === 0x1fcn >> 1n; // simpler: check first 7 bits == 0b1111110? We'll implement mask way:
    }
    function isULA(big){
      // fc00::/7 -> top 7 bits 1111110 (0xFC00/7)
      const top7 = (big >> 121n) & 0x7fn;
      return top7 === 0x7en; // 0b1111110 = 126
    }
    function isLinkLocalV6(big){
      // fe80::/10
      const top10 = (big >> 118n) & 0x3ffn;
      return top10 === 0x3fAn; // 0b1111111010 = 1018
    }
    function reverseIPv6(big){
      // produce ip6.arpa nibble-reversed for 128-bit number
      let hex = big.toString(16).padStart(32,'0');
      const nibbles = hex.split('').reverse().join('.'); // reversed nibble order with dots between
      return nibbles + '.ip6.arpa.';
    }

    // Validation
    function setError(msg){
      if(msg){
        els.errIp.textContent = msg;
        els.errIp.classList.remove('hidden');
        els.ipCidr.setAttribute('aria-invalid','true');
      }else{
        els.errIp.textContent = '';
        els.errIp.classList.add('hidden');
        els.ipCidr.removeAttribute('aria-invalid');
      }
    }

    function parseInput(){
      const version = els.ipVersion.value; // v4 or v6
      let raw = (els.ipCidr.value || '').trim();
      // sync prefix from mask helper if present (IPv4)
      const maskVal = (els.maskHelper.value || '').trim();
      if(maskVal && isValidIPv4(maskVal)){
        const p = maskToPrefixV4(maskVal);
        if(p !== null){
          // if user typed "a.b.c.d/x", replace x; if not, append
          if(raw.includes('/')){
            raw = raw.replace(/\/\d{1,3}$/, '/'+p);
          } else {
            raw = raw + '/' + p;
          }
        }
      }
      const m = raw.match(/^(.+?)\/(\d{1,3})$/);
      if(!m) return {error:'Please enter an address in CIDR notation, e.g., 192.168.1.10/24 or 2001:db8::1/64.'};
      const addr = m[1], prefix = Number(m[2]);
      if(version==='v4'){
        if(prefix<0 || prefix>32) return {error:'IPv4 prefix must be between 0 and 32.'};
        if(!isValidIPv4(addr)) return {error:'Invalid IPv4 address format.'};
        return {version:'v4', addr, prefix};
      } else {
        if(prefix<0 || prefix>128) return {error:'IPv6 prefix must be between 0 and 128.'};
        // try to expand
        const expanded = expandIPv6(addr);
        if(!expanded) return {error:'Invalid IPv6 address (check :: compression and hextets).'};
        return {version:'v6', addr, expanded, prefix};
      }
    }

    function calculate(){
      const parsed = parseInput();
      if(parsed.error){
        setError(parsed.error);
        announce('Input error. ' + parsed.error);
        clearResults();
        return;
      }
      setError('');
      if(parsed.version==='v4'){
        calcV4(parsed.addr, parsed.prefix);
      }else{
        calcV6(parsed.expanded, parsed.addr, parsed.prefix);
      }
    }

    function clearResults(){
      const dashes = '—';
      [
        'rVersion','rInput','rPrefix','rType','rPrivate','rMask','rWild','rBlock','rCount','rUsable',
        'rNetwork','rFirst','rLast','rBroadcast','rRev','rV6c','rV6e'
      ].forEach(id=> els[id].textContent = dashes);
    }

    function announce(msg){ els.live.textContent = msg; }

    // IPv4 calculation
    function calcV4(addr, prefix){
      const ipInt = ipv4ToInt(addr);
      const maskInt = prefix===0 ? 0 : (0xFFFFFFFF << (32 - prefix)) >>> 0;
      const maskStr = prefixToMaskV4(prefix);
      const wildStr = wildcardFromMask(maskStr);
      const network = (ipInt & maskInt) >>> 0;
      const count = Math.pow(2, 32 - prefix);
      const broadcast = (network + count - 1) >>> 0;
      let firstUsable='—', lastUsable='—', usable='—';

      if(prefix===31){
        // RFC 3021 point-to-point: two addresses, both usable, no broadcast
        firstUsable = intToIPv4(network);
        lastUsable = intToIPv4(broadcast);
        usable = 2;
      } else if(prefix===32){
        firstUsable = intToIPv4(ipInt);
        lastUsable = intToIPv4(ipInt);
        usable = 1;
      } else {
        if(prefix<=30){
          firstUsable = intToIPv4((network + 1) >>> 0);
          lastUsable = intToIPv4((broadcast - 1) >>> 0);
          usable = Math.max(0, count - 2);
        }
      }

      els.rVersion.textContent = 'IPv4';
      els.rInput.textContent = `${addr}/${prefix}`;
      els.rPrefix.textContent = `/${prefix}`;
      els.rType.textContent = (prefix<=30) ? 'Subnet (with broadcast)' : (prefix===31 ? 'Point-to-Point (/31)' : 'Host (/32)');
      els.rPrivate.textContent = isPrivateV4(ipInt) ? 'Private/Reserved' : 'Public';
      els.rMask.textContent = maskStr;
      els.rWild.textContent = wildStr;
      els.rBlock.textContent = String(count);
      els.rCount.textContent = nf.format(count);
      els.rUsable.textContent = typeof usable==='number' ? nf.format(usable) : usable;
      els.rNetwork.textContent = intToIPv4(network);
      els.rFirst.textContent = firstUsable;
      els.rLast.textContent = lastUsable;
      els.rBroadcast.textContent = intToIPv4(broadcast);
      els.rRev.textContent = reverseIPv4(network);
      els.rV6c.textContent = '—';
      els.rV6e.textContent = '—';

      announce('IPv4 results ready.');
    }

    // IPv6 calculation
    function calcV6(expanded, original, prefix){
      const big = ipv6ToBig(expanded);
      const hostBits = 128 - BigInt(prefix);
      const blockSizeDesc = `2^${Number(hostBits)}`;
      // Network = big & mask
      const mask = (hostBits===128n) ? 0n : (~((1n<<hostBits) - 1n)) & ((1n<<128n)-1n);
      const network = big & mask;
      const last = network | ((1n<<hostBits) - 1n);

      const netText = bigToIPv6(network);
      const lastText = bigToIPv6(last);

      els.rVersion.textContent = 'IPv6';
      els.rInput.textContent = `${original}/${prefix}`;
      els.rPrefix.textContent = `/${prefix}`;
      els.rType.textContent = 'Subnet (no broadcast)';
      els.rPrivate.textContent = isULA(big) ? 'Unique Local (fc00::/7)' : (isLinkLocalV6(big) ? 'Link-local (fe80::/10)' : 'Global/Other');
      els.rMask.textContent = '—';
      els.rWild.textContent = '—';
      els.rBlock.textContent = blockSizeDesc;
      els.rCount.textContent = countAddrsV6(prefix);
      els.rUsable.textContent = '—'; // not commonly defined like IPv4

      els.rNetwork.textContent = `${netText.compressed}/${prefix}`;
      els.rFirst.textContent = netText.compressed;
      els.rLast.textContent = lastText.compressed;
      els.rBroadcast.textContent = '—';

      els.rRev.textContent = reverseIPv6(network);
      els.rV6c.textContent = bigToIPv6(big).compressed;
      els.rV6e.textContent = expanded;

      announce('IPv6 results ready.');
    }

    // Inline validation on blur
    els.ipCidr.addEventListener('blur', ()=>{
      const parsed = parseInput();
      if(parsed.error){ setError(parsed.error); }
      else setError('');
    });
    els.maskHelper.addEventListener('blur', ()=>{
      const v = els.maskHelper.value.trim();
      if(v && !isValidIPv4(v)){
        // gentle
        els.maskHelper.setCustomValidity('Invalid IPv4 mask format.');
        els.maskHelper.reportValidity();
      }else{
        els.maskHelper.setCustomValidity('');
      }
    });

    // Actions
    els.btnCalc.addEventListener('click', calculate);
    els.btnClear.addEventListener('click', ()=>{
      els.ipCidr.value = '';
      els.maskHelper.value = '';
      setError('');
      clearResults();
      announce('Cleared.');
      els.ipCidr.focus();
    });

    // Sensible default for demo
    els.ipCidr.value = '192.168.1.10/24';
    calculate();
  })();
  </script>
</body>
</html>
