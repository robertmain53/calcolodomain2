<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#475569;
    --line:#e5e7eb;
    --primary:#2563eb;
    --primary2:#1d4ed8;
    --danger:#b91c1c;
    --dangerBg:#fef2f2;
    --ok:#15803d;
    --warn:#b45309;
    --warnBg:#fffbeb;
    --shadow:0 10px 25px rgba(2,6,23,.08);
    --radius:14px;
    --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family:var(--sans);
    color:var(--text);
    background:var(--bg);
    line-height:1.5;
  }
  .container{ max-width:1120px; margin:0 auto; padding:18px; }

  header{
    position:sticky; top:0; z-index:50;
    background:rgba(255,255,255,.92);
    backdrop-filter:blur(8px);
    border-bottom:1px solid var(--line);
  }
  .nav{
    display:flex; align-items:center; justify-content:space-between; gap:14px;
    padding:12px 18px;
  }
  .brand{ font-weight:800; letter-spacing:.2px; font-size:20px; color:var(--text); text-decoration:none; }
  .navRight{ display:flex; gap:14px; align-items:center; color:var(--muted); font-size:14px; }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    border:1px solid var(--line); background:#fff;
    padding:8px 10px; border-radius:999px; font-size:13px;
    text-decoration:none; color:var(--text);
  }

  h1{ margin:18px 0 6px; font-size:28px; line-height:1.2; }
  .sub{ margin:0 0 18px; color:var(--muted); font-size:15px; }

  .calc-hero{
    display:grid;
    grid-template-columns:1.15fr .85fr;
    gap:24px;
    align-items:start;
  }
  @media (max-width:900px){ .calc-hero{ grid-template-columns:1fr; } }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:22px;
  }
  .sticky{ position:sticky; top:90px; }
  @media (max-width:900px){ .sticky{ position:relative; top:auto; } }

  .sectionTitle{
    font-weight:800; margin:0 0 12px;
    font-size:13px; text-transform:uppercase; letter-spacing:.5px; color:var(--muted);
  }

  .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
  @media (max-width:520px){ .grid2{ grid-template-columns:1fr; } }

  label{ display:block; font-size:13px; font-weight:700; color:var(--muted); margin:0 0 6px; }
  input, select{
    width:100%;
    padding:10px 12px;
    border:1px solid var(--line);
    border-radius:10px;
    background:#fff;
    font-size:14px;
    outline:none;
    transition:border-color .2s, box-shadow .2s;
  }
  input:focus, select:focus{
    border-color:var(--primary);
    box-shadow:0 0 0 3px rgba(37,99,235,0.15);
  }

  .help{ margin:6px 0 0; font-size:12px; color:var(--muted); }

  .optional{
    margin-top:14px;
    padding:14px;
    background:#f8fafc;
    border:1px solid var(--line);
    border-radius:12px;
  }

  .btnRow{ display:flex; gap:10px; margin-top:14px; }
  .btn{
    flex:1;
    border:none;
    background:var(--primary);
    color:#fff;
    padding:12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:800;
    font-size:14px;
  }
  .btn:hover{ background:var(--primary2); }
  .btnSecondary{
    background:#fff;
    border:1px solid var(--line);
    color:var(--text);
  }
  .btnSecondary:hover{ background:#f8fafc; }

  .alert{
    display:none;
    padding:12px;
    margin:12px 0 0;
    border-radius:10px;
    font-size:14px;
  }
  .alert.error{ background:var(--dangerBg); border:1px solid #fecaca; color:#7f1d1d; }
  .alert.warn{ background:var(--warnBg); border:1px solid #fde68a; color:#7c2d12; }

  .totalBox{
    text-align:center;
    padding-bottom:16px;
    border-bottom:1px solid var(--line);
    margin-bottom:12px;
  }
  .totalBox .t{ color:var(--muted); font-size:12px; font-weight:900; text-transform:uppercase; letter-spacing:.5px; }
  .totalBox .v{ font-size:22px; font-weight:950; margin-top:4px; }

  .kpi{ display:flex; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px dashed var(--line); font-size:14px; }
  .kpi:last-child{ border-bottom:none; }
  .kpi span:first-child{ color:var(--muted); }
  .kpi span:last-child{ font-weight:900; }

  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .small{ font-size:12px; color:var(--muted); margin-top:10px; }
</style>

<html>
  <head></head>
  <body>
    <header>
      <div class="nav container">
        <a class="brand" href="https://calcdomain.com">CalcDomain</a>
        <div class="navRight">
          <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
          <span class="pill">Construction</span>
        </div>
      </div>
    </header>

    <div class="container">
      <h1>ACI Concrete Mix Design Calculator (Absolute Volume Method)</h1>
      <p class="sub">
        Computes cement, water, coarse aggregate, fine aggregate, and optional moisture corrections for a 1&nbsp;m³ or 1&nbsp;yd³ batch (absolute volume method).
      </p>

      <div class="calc-hero">
        <section class="card" id="inputsCard" aria-label="Calculator inputs">
          <div class="sectionTitle">Core inputs</div>

          <div class="grid2">
            <div>
              <label for="unit">Unit system</label>
              <select id="unit">
                <option value="SI" selected>SI (m³, kg, kg/m³)</option>
                <option value="US">US customary (yd³, lb, lb/ft³)</option>
              </select>
              <p class="help">Batch volume is fixed to 1 (m³ or yd³) as standard for mix proportioning.</p>
            </div>

            <div>
              <label for="air">Air content a (%)</label>
              <input id="air" type="number" inputmode="decimal" min="0" max="15" step="0.1" value="2.0" />
              <p class="help">Entrapped/entrained air by volume fraction: V<sub>a</sub> = a/100.</p>
              <div class="mono small" id="airErr"></div>
            </div>
          </div>

          <div class="grid2" style="margin-top:12px;">
            <div>
              <label for="water">Water content W</label>
              <input id="water" type="number" inputmode="decimal" min="0" step="0.1" value="180" />
              <p class="help" id="waterHelp">SI: kg per m³ (typical 140–220). US: lb per yd³ (typical ~250–400).</p>
              <div class="mono small" id="waterErr"></div>
            </div>

            <div>
              <label for="wcr">Water–cement ratio r</label>
              <input id="wcr" type="number" inputmode="decimal" min="0.2" max="0.9" step="0.01" value="0.50" />
              <p class="help">Cement mass: C = W / r.</p>
              <div class="mono small" id="wcrErr"></div>
            </div>
          </div>

          <div class="grid2" style="margin-top:12px;">
            <div>
              <label for="phi">Coarse aggregate bulk fraction φ</label>
              <input id="phi" type="number" inputmode="decimal" min="0" max="1" step="0.01" value="0.62" />
              <p class="help">Typically selected from ACI table (depends on NMSA + fineness modulus).</p>
              <div class="mono small" id="phiErr"></div>
            </div>

            <div>
              <label for="druw">Dry-rodded unit weight γ<sub>DRUW</sub></label>
              <input id="druw" type="number" inputmode="decimal" min="0" step="0.1" value="1600" />
              <p class="help" id="druwHelp">SI: kg/m³. US: lb/ft³. Used to compute M<sub>ca</sub><sup>OD</sup>.</p>
              <div class="mono small" id="druwErr"></div>
            </div>
          </div>

          <div class="sectionTitle" style="margin-top:18px;">Specific gravities</div>
          <div class="grid2">
            <div>
              <label for="Gc">Cement G<sub>c</sub></label>
              <input id="Gc" type="number" inputmode="decimal" min="2.5" max="3.3" step="0.01" value="3.15" />
              <div class="mono small" id="GcErr"></div>
            </div>
            <div>
              <label for="Gca">Coarse aggregate G<sub>ca</sub></label>
              <input id="Gca" type="number" inputmode="decimal" min="2.3" max="2.9" step="0.01" value="2.65" />
              <div class="mono small" id="GcaErr"></div>
            </div>
          </div>

          <div class="grid2" style="margin-top:12px;">
            <div>
              <label for="Gfa">Fine aggregate G<sub>fa</sub></label>
              <input id="Gfa" type="number" inputmode="decimal" min="2.3" max="2.9" step="0.01" value="2.60" />
              <div class="mono small" id="GfaErr"></div>
            </div>
            <div>
              <label for="showMoisture">
                <input id="showMoisture" type="checkbox" />
                Apply moisture corrections
              </label>
              <p class="help">Uses absorption A (%) and actual moisture m (%) on OD basis to adjust batch masses and batch water.</p>
            </div>
          </div>

          <div class="optional" id="moistureBox" style="display:none;" aria-label="Moisture corrections">
            <div class="sectionTitle" style="margin:0 0 10px;">Moisture corrections</div>

            <div class="grid2">
              <div>
                <label for="Afa">Fine absorption A<sub>fa</sub> (%)</label>
                <input id="Afa" type="number" inputmode="decimal" min="0" max="10" step="0.01" value="1.2" />
                <div class="mono small" id="AfaErr"></div>
              </div>
              <div>
                <label for="mfa">Fine moisture m<sub>fa</sub> (%)</label>
                <input id="mfa" type="number" inputmode="decimal" min="0" max="20" step="0.01" value="4.0" />
                <div class="mono small" id="mfaErr"></div>
              </div>
            </div>

            <div class="grid2" style="margin-top:12px;">
              <div>
                <label for="Aca">Coarse absorption A<sub>ca</sub> (%)</label>
                <input id="Aca" type="number" inputmode="decimal" min="0" max="10" step="0.01" value="0.8" />
                <div class="mono small" id="AcaErr"></div>
              </div>
              <div>
                <label for="mca">Coarse moisture m<sub>ca</sub> (%)</label>
                <input id="mca" type="number" inputmode="decimal" min="0" max="20" step="0.01" value="2.0" />
                <div class="mono small" id="mcaErr"></div>
              </div>
            </div>

            <p class="help" style="margin-top:10px;">
              Aggregate water contribution: ΔW = M<sub>fa</sub><sup>OD</sup>(m<sub>fa</sub>−A<sub>fa</sub>)/100 + M<sub>ca</sub><sup>OD</sup>(m<sub>ca</sub>−A<sub>ca</sub>)/100.
            </p>
          </div>

          <div class="btnRow">
            <button class="btn" id="calcBtn" type="button">Calculate</button>
            <button class="btn btnSecondary" id="resetBtn" type="button">Reset</button>
          </div>

          <div id="errorBox" class="alert error" role="alert" aria-live="polite"></div>
          <div id="warnBox" class="alert warn" role="status" aria-live="polite"></div>
        </section>

        <section class="card sticky" aria-label="Calculator results">
          <div class="totalBox">
            <div class="t">Fine aggregate volume V<sub>fa</sub></div>
            <div class="v" id="VfaOut">—</div>
          </div>

          <div class="sectionTitle">Masses (per unit batch)</div>
          <div class="kpi"><span>Water W</span><span id="WOut">—</span></div>
          <div class="kpi"><span>Cement C</span><span id="COut">—</span></div>
          <div class="kpi"><span>Coarse aggregate M<sub>ca</sub><sup>OD</sup></span><span id="McaODOut">—</span></div>
          <div class="kpi"><span>Fine aggregate M<sub>fa</sub><sup>SSD</sup></span><span id="MfaSSDOut">—</span></div>

          <div class="sectionTitle" style="margin-top:14px;">Volumes (absolute)</div>
          <div class="kpi"><span>V<sub>w</sub></span><span id="VwOut">—</span></div>
          <div class="kpi"><span>V<sub>c</sub></span><span id="VcOut">—</span></div>
          <div class="kpi"><span>V<sub>a</sub></span><span id="VaOut">—</span></div>
          <div class="kpi"><span>V<sub>ca</sub></span><span id="VcaOut">—</span></div>

          <div class="sectionTitle" style="margin-top:14px;">Moisture-corrected batching (optional)</div>
          <div class="kpi"><span>Fine M<sub>fa</sub><sup>OD</sup></span><span id="MfaODOut">—</span></div>
          <div class="kpi"><span>Fine M<sub>fa</sub><sup>batched</sup></span><span id="MfaBOut">—</span></div>
          <div class="kpi"><span>Coarse M<sub>ca</sub><sup>batched</sup></span><span id="McaBOut">—</span></div>
          <div class="kpi"><span>Aggregate water ΔW</span><span id="dWOut">—</span></div>
          <div class="kpi"><span>Batch water W<sub>batch</sub></span><span id="WbOut">—</span></div>

          <div class="small">
            Notes: This is an absolute-volume balance for a 1-unit batch. It does not auto-select ACI table values (φ, W, air) — you input them.
          </div>
        </section>
      </div>
    </div>
  </body>
</html>

<script>
(function(){
  'use strict';

  const debounce = (fn, delay=120) => {
    let t;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), delay);
    };
  };

  const $ = (id) => document.getElementById(id);

  function toNum(v){
    const n = Number(v);
    return Number.isFinite(n) ? n : NaN;
  }

  function setInlineError(id, msg){
    const el = $(id);
    if (el) el.textContent = msg || '';
  }

  function showBox(id, msg){
    const el = $(id);
    if (!el) return;
    if (msg){
      el.style.display = 'block';
      el.textContent = msg;
    } else {
      el.style.display = 'none';
      el.textContent = '';
    }
  }

  function unitLabels(unit){
    if (unit === 'US'){
      return {
        mass: 'lb/yd³',
        density: 'lb/ft³',
        volume: 'yd³/yd³',
        rho_w: 1684.8, // lb/yd³ (given)
        caFactor: 27   // ft³ per yd³ (given in the extracted method)
      };
    }
    return {
      mass: 'kg/m³',
      density: 'kg/m³',
      volume: 'm³/m³',
      rho_w: 1000, // kg/m³
      caFactor: 1
    };
  }

  function parseInputs(){
    const unit = $('unit').value;

    return {
      unit,
      air: toNum($('air').value),
      water: toNum($('water').value),
      wcr: toNum($('wcr').value),
      phi: toNum($('phi').value),
      druw: toNum($('druw').value),
      Gc: toNum($('Gc').value),
      Gca: toNum($('Gca').value),
      Gfa: toNum($('Gfa').value),
      doMoisture: $('showMoisture').checked,
      Afa: toNum($('Afa').value),
      mfa: toNum($('mfa').value),
      Aca: toNum($('Aca').value),
      mca: toNum($('mca').value)
    };
  }

  function validate(x){
    const errs = [];
    const warns = [];

    // Reset inline errors
    ['airErr','waterErr','wcrErr','phiErr','druwErr','GcErr','GcaErr','GfaErr','AfaErr','mfaErr','AcaErr','mcaErr']
      .forEach(id => setInlineError(id,''));

    const u = unitLabels(x.unit);

    // air
    if (!Number.isFinite(x.air) || x.air < 0 || x.air > 20){
      errs.push('Air content a must be between 0 and 20%.');
      setInlineError('airErr','Invalid a (0–20%).');
    }

    // water
    if (!Number.isFinite(x.water) || x.water <= 0){
      errs.push('Water content W must be > 0.');
      setInlineError('waterErr','Enter a positive W.');
    } else {
      if (x.unit === 'SI' && (x.water < 80 || x.water > 300)) warns.push('W looks unusual for SI. Typical range is roughly 140–220 kg/m³.');
      if (x.unit === 'US' && (x.water < 150 || x.water > 500)) warns.push('W looks unusual for US. Typical range is roughly 250–400 lb/yd³.');
    }

    // w/c
    if (!Number.isFinite(x.wcr) || x.wcr <= 0){
      errs.push('Water–cement ratio r must be > 0.');
      setInlineError('wcrErr','Enter r > 0.');
    } else {
      if (x.wcr < 0.25 || x.wcr > 0.80) warns.push('r is outside common structural ranges; verify exposure/strength requirements.');
    }

    // phi
    if (!Number.isFinite(x.phi) || x.phi < 0 || x.phi > 1){
      errs.push('Coarse aggregate fraction φ must be between 0 and 1.');
      setInlineError('phiErr','Invalid φ (0–1).');
    }

    // druw
    if (!Number.isFinite(x.druw) || x.druw <= 0){
      errs.push('Dry-rodded unit weight γDRUW must be > 0.');
      setInlineError('druwErr','Enter γDRUW > 0.');
    } else {
      if (x.unit === 'SI' && (x.druw < 1200 || x.druw > 2000)) warns.push('γDRUW looks unusual for SI; verify units (kg/m³).');
      if (x.unit === 'US' && (x.druw < 70 || x.druw > 120)) warns.push('γDRUW looks unusual for US; verify units (lb/ft³).');
    }

    // specific gravities
    const checkG = (val, id, name) => {
      if (!Number.isFinite(val) || val <= 0){
        errs.push(`${name} specific gravity must be > 0.`);
        setInlineError(id, 'Enter > 0.');
      } else if (val < 2.0 || val > 3.5){
        warns.push(`${name} specific gravity is outside typical range; verify.`);
      }
    };
    checkG(x.Gc,'GcErr','Cement (Gc)');
    checkG(x.Gca,'GcaErr','Coarse aggregate (Gca)');
    checkG(x.Gfa,'GfaErr','Fine aggregate (Gfa)');

    // moisture
    if (x.doMoisture){
      const checkPct = (val, id, label, max=25) => {
        if (!Number.isFinite(val) || val < 0 || val > max){
          errs.push(`${label} must be between 0 and ${max}%.`);
          setInlineError(id, `Invalid (0–${max}%).`);
        }
      };
      checkPct(x.Afa,'AfaErr','Afa',10);
      checkPct(x.mfa,'mfaErr','mfa',25);
      checkPct(x.Aca,'AcaErr','Aca',10);
      checkPct(x.mca,'mcaErr','mca',25);
    }

    return { ok: errs.length === 0, errs, warns, u };
  }

  function compute(x, u){
    // V is 1 by definition (m³ or yd³)
    const V = 1;

    // 1) Cement mass
    const C = x.water / x.wcr;

    // 2) Volumes
    const Vw = x.water / u.rho_w;
    const Vc = C / (x.Gc * u.rho_w);
    const Va = x.air / 100;

    // 4) Coarse aggregate OD mass per unit
    // SI: φ * γDRUW * 1 (kg/m³ * m³)
    // US: φ * γDRUW (lb/ft³) * 27 ft³/yd³ -> lb/yd³
    const McaOD = x.phi * x.druw * u.caFactor;

    // 5) Coarse absolute volume
    const Vca = McaOD / (x.Gca * u.rho_w);

    // 6) Fine absolute volume by remainder
    const Vfa = V - (Vw + Vc + Va + Vca);

    // 7) Fine aggregate SSD mass
    const MfaSSD = Vfa * x.Gfa * u.rho_w;

    // 8) Moisture corrections
    let MfaOD = NaN, MfaB = NaN, McaB = NaN, dW = NaN, Wbatch = NaN;

    if (x.doMoisture){
      // Fine: OD from SSD and absorption
      MfaOD = MfaSSD / (1 + x.Afa/100);
      MfaB  = MfaOD * (1 + x.mfa/100);

      // Coarse: batched from OD and moisture
      McaB  = McaOD * (1 + x.mca/100);

      // Aggregate water contribution (positive means aggregates add free water; negative means they absorb)
      dW = MfaOD * ((x.mfa - x.Afa)/100) + McaOD * ((x.mca - x.Aca)/100);

      // Batch water to add
      Wbatch = x.water - dW;
    }

    return { V, C, Vw, Vc, Va, McaOD, Vca, Vfa, MfaSSD, MfaOD, MfaB, McaB, dW, Wbatch };
  }

  function fmt(n, digits=2){
    return Number.isFinite(n) ? n.toFixed(digits) : '—';
  }

  function render(out, x, u, warns){
    // Errors already handled upstream; here we only show warnings and results.
    showBox('warnBox', warns.length ? warns.join(' ') : '');

    const massUnit = u.mass;
    const volUnit = x.unit === 'US' ? 'yd³' : 'm³';

    $('WOut').textContent = `${fmt(x.water,1)} ${massUnit}`;
    $('COut').textContent = `${fmt(out.C,1)} ${massUnit}`;
    $('McaODOut').textContent = `${fmt(out.McaOD,1)} ${massUnit}`;
    $('MfaSSDOut').textContent = (Number.isFinite(out.MfaSSD) ? `${fmt(out.MfaSSD,1)} ${massUnit}` : '—');

    $('VwOut').textContent = `${fmt(out.Vw,4)} ${volUnit}/${volUnit}`;
    $('VcOut').textContent = `${fmt(out.Vc,4)} ${volUnit}/${volUnit}`;
    $('VaOut').textContent = `${fmt(out.Va,4)} ${volUnit}/${volUnit}`;
    $('VcaOut').textContent = `${fmt(out.Vca,4)} ${volUnit}/${volUnit}`;
    $('VfaOut').textContent = `${fmt(out.Vfa,4)} ${volUnit}/${volUnit}`;

    if (x.doMoisture){
      $('MfaODOut').textContent = `${fmt(out.MfaOD,1)} ${massUnit}`;
      $('MfaBOut').textContent  = `${fmt(out.MfaB,1)} ${massUnit}`;
      $('McaBOut').textContent  = `${fmt(out.McaB,1)} ${massUnit}`;
      $('dWOut').textContent    = `${fmt(out.dW,1)} ${massUnit}`;
      $('WbOut').textContent    = `${fmt(out.Wbatch,1)} ${massUnit}`;
    } else {
      $('MfaODOut').textContent = '—';
      $('MfaBOut').textContent  = '—';
      $('McaBOut').textContent  = '—';
      $('dWOut').textContent    = '—';
      $('WbOut').textContent    = '—';
    }

    // Additional physical sanity checks -> warnings (non-fatal)
    const extraWarns = [];
    if (Number.isFinite(out.Vfa) && out.Vfa < 0){
      extraWarns.push('Computed Vfa is negative: your inputs overfill the 1-unit volume (check φ, W, air, DRUW, or specific gravities).');
    } else if (Number.isFinite(out.Vfa) && out.Vfa > 0.55){
      extraWarns.push('Vfa is quite large: mix may be very sand-rich (verify φ and DRUW).');
    }

    if (x.doMoisture && Number.isFinite(out.Wbatch) && out.Wbatch < 0){
      extraWarns.push('Wbatch is negative: aggregates contribute more free water than the target W. Re-check moisture/absorption values or target W.');
    }

    if (extraWarns.length){
      showBox('warnBox', [warns.join(' '), extraWarns.join(' ')].filter(Boolean).join(' '));
    }
  }

  function updateUnitHints(){
    const unit = $('unit').value;
    if (unit === 'US'){
      $('waterHelp').textContent = 'US: lb per yd³ (typical ~250–400).';
      $('druwHelp').textContent = 'US: γDRUW in lb/ft³. Tool multiplies by 27 ft³/yd³ to obtain lb/yd³.';
      // Set reasonable defaults if user switches units
      if ($('water').value === '180') $('water').value = '325';
      if ($('druw').value === '1600') $('druw').value = '100';
    } else {
      $('waterHelp').textContent = 'SI: kg per m³ (typical 140–220).';
      $('druwHelp').textContent = 'SI: γDRUW in kg/m³.';
      if ($('water').value === '325') $('water').value = '180';
      if ($('druw').value === '100') $('druw').value = '1600';
    }
  }

  function update(){
    const x = parseInputs();

    // toggle moisture block
    $('moistureBox').style.display = x.doMoisture ? 'block' : 'none';

    const v = validate(x);
    if (!v.ok){
      showBox('errorBox', v.errs.join(' '));
      showBox('warnBox', '');
      // Clear outputs (keep stable UI)
      ['VfaOut','WOut','COut','McaODOut','MfaSSDOut','VwOut','VcOut','VaOut','VcaOut','MfaODOut','MfaBOut','McaBOut','dWOut','WbOut']
        .forEach(id => { $(id).textContent = '—'; });
      return;
    }

    showBox('errorBox','');
    const out = compute(x, v.u);
    render(out, x, v.u, v.warns);
  }

  const debouncedUpdate = debounce(update, 120);

  // Events
  $('unit').addEventListener('change', () => { updateUnitHints(); debouncedUpdate(); });
  $('showMoisture').addEventListener('change', debouncedUpdate);

  document.querySelectorAll('#inputsCard input, #inputsCard select')
    .forEach(el => {
      el.addEventListener('input', debouncedUpdate);
      el.addEventListener('change', debouncedUpdate);
    });

  $('calcBtn').addEventListener('click', update);

  $('resetBtn').addEventListener('click', () => {
    $('unit').value = 'SI';
    $('air').value = '2.0';
    $('water').value = '180';
    $('wcr').value = '0.50';
    $('phi').value = '0.62';
    $('druw').value = '1600';
    $('Gc').value = '3.15';
    $('Gca').value = '2.65';
    $('Gfa').value = '2.60';

    $('showMoisture').checked = false;
    $('Afa').value = '1.2';
    $('mfa').value = '4.0';
    $('Aca').value = '0.8';
    $('mca').value = '2.0';

    updateUnitHints();
    update();
  });

  // Init
  updateUnitHints();
  update();
})();
</script>
