<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Mean Calculator — Arithmetic, Weighted, Geometric, Harmonic & Trimmed Mean</title>
<meta name="description" content="Professional mean calculator: arithmetic mean, weighted mean, geometric, harmonic, and trimmed mean. Paste numbers or use a frequency table. Outlier filters, LaTeX formulas, and step-by-step explanation.">
<link rel="canonical" href="https://calcdomain.com/mean-calculator.html">
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg">
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png">
<link rel="manifest" href="https://calcdomain.com/site.webmanifest">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          brand: { DEFAULT: '#1d4ed8' }
        }
      }
    }
  }
</script>
<style>
  :root { --focus: #2563eb; }
  html,body{height:100%}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:#f9fafb;color:#0f172a}
  .container{max-width:1100px}
  .prose { max-width:65ch }
  .prose h2{font-size:1.5rem;font-weight:700;margin:2rem 0 0.75rem}
  .prose h3{font-size:1.25rem;font-weight:600;margin:1.5rem 0 0.5rem}
  .prose p{margin:0.75rem 0;line-height:1.65}
  .prose ul,.prose ol{margin:0.5rem 0 1rem 1.25rem}
  .formula-box{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:10px;padding:1rem;overflow:auto}
  /* Focus styles (WCAG) */
  :where(a,button,input,select,textarea,summary)[tabindex]:focus,
  :where(a,button,input,select,textarea,summary):focus{outline:3px solid var(--focus);outline-offset:2px;border-radius:6px}
  /* Error & helper text */
  .field-help{font-size:.85rem}
  .field-error{color:#b91c1c}
  /* Touch target min 48px */
  .tap-target{min-height:48px;min-width:48px}
  /* Results min-height to prevent CLS */
  #results-summary{min-height:140px}
  #results-advanced{min-height:56px}
  /* Print */
  @media print{
    header,aside,.no-print{display:none !important}
    #print-section{display:block !important}
    body{background:#fff}
  }
</style>

<!-- MathJax for LaTeX rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        id="MathJax-script"></script>

<!-- Chart.js (small and deferred) -->
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<!-- JSON-LD: WebPage -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebPage",
  "name":"Mean Calculator",
  "url":"https://calcdomain.com/mean-calculator.html",
  "description":"Calculate arithmetic, weighted, geometric, harmonic and trimmed means with outlier handling and frequency table support.",
  "inLanguage":"en",
  "author":{"@type":"Person","name":"Ugo Candido"},
  "publisher":{"@type":"Organization","name":"CalcDomain"}
}
</script>

<!-- JSON-LD: WebApplication (Calculator) -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebApplication",
  "name":"Mean Calculator",
  "applicationCategory":"Calculator",
  "operatingSystem":"Any",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
  "url":"https://calcdomain.com/mean-calculator.html",
  "author":{"@type":"Person","name":"Ugo Candido"}
}
</script>

<!-- JSON-LD: Breadcrumbs -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
    {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
    {"@type":"ListItem","position":3,"name":"Algebra","item":"https://calcdomain.com/subcategories/math-algebra.html"},
    {"@type":"ListItem","position":4,"name":"Mean Calculator","item":"https://calcdomain.com/mean-calculator.html"}
  ]
}
</script>

<!-- JSON-LD: HowTo (Step-by-step) -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"HowTo",
  "name":"How to calculate different types of mean",
  "step":[
    {"@type":"HowToStep","name":"Choose the mean type","text":"Select arithmetic, weighted, geometric, harmonic, or trimmed."},
    {"@type":"HowToStep","name":"Enter data","text":"Paste a list of numbers or provide a frequency table. For weighted mean, add matching weights."},
    {"@type":"HowToStep","name":"Apply options","text":"Optionally trim percentages, exclude outliers by IQR or z-score, and choose decimal precision."},
    {"@type":"HowToStep","name":"Compute and review","text":"See the computed mean with dataset summary, chart, and formula."}
  ]
}
</script>

<!-- JSON-LD: FAQPage -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {"@type":"Question","name":"What is the arithmetic mean?","acceptedAnswer":{"@type":"Answer","text":"It is the sum of all values divided by the number of values."}},
    {"@type":"Question","name":"When should I use the weighted mean?","acceptedAnswer":{"@type":"Answer","text":"Use it when values contribute unequally—supply a weight for each value to reflect its importance or frequency."}},
    {"@type":"Question","name":"What is the geometric mean used for?","acceptedAnswer":{"@type":"Answer","text":"It is suitable for multiplicative processes, such as growth rates, and requires all values to be positive."}},
    {"@type":"Question","name":"What is a trimmed mean?","acceptedAnswer":{"@type":"Answer","text":"A trimmed mean discards a fixed percentage of the lowest and highest values to reduce the effect of outliers."}},
    {"@type":"Question","name":"How do I compute a mean from a frequency table?","acceptedAnswer":{"@type":"Answer","text":"Multiply each value by its frequency, sum those products, then divide by the total frequency."}},
    {"@type":"Question","name":"How are outliers handled here?","acceptedAnswer":{"@type":"Answer","text":"You can exclude suspected outliers using IQR (Tukey fences) or a z-score threshold."}},
    {"@type":"Question","name":"Does geometric mean accept zeros or negatives?","acceptedAnswer":{"@type":"Answer","text":"No. All inputs must be strictly positive for the geometric mean."}}
  ]
}
</script>
</head>
<body class="antialiased">
  <!-- Header (non-sticky per requirements) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-brand">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-brand" href="search.html">Search</a>
        <a class="hover:text-brand" href="index.html#categories">Categories</a>
      </nav>
      <button class="md:hidden tap-target p-2" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></svg>
      </button>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div id="print-section" class="bg-white shadow-sm rounded-lg p-6">
      <!-- 1) H1 -->
      <h1 class="text-3xl font-extrabold tracking-tight mb-2">mean calculator</h1>

      <!-- 2) Intro -->
      <p class="text-slate-600 mb-6">Compute <strong>arithmetic</strong>, <strong>weighted</strong>, <strong>geometric</strong>, <strong>harmonic</strong>, and <strong>trimmed</strong> means from a clean, accessible interface. Paste a list, upload a CSV, or use a frequency table. Designed for students, analysts, and professionals who need reliable, well-explained results.</p>

      <!-- Breadcrumbs (visible) -->
      <nav aria-label="Breadcrumb" class="text-sm text-slate-600 mb-6">
        <a href="index.html" class="hover:text-brand">Home</a> &raquo;
        <a href="math.html" class="hover:text-brand">Math</a> &raquo;
        <a href="subcategories/math-algebra.html" class="hover:text-brand">Algebra</a> &raquo;
        <span class="text-slate-900">Mean Calculator</span>
      </nav>

      <!-- 3) Calculator UI -->
      <section id="calculator" class="space-y-6" aria-labelledby="calc-heading">
        <h2 id="calc-heading" class="sr-only">Calculator Inputs</h2>

        <!-- Mean type & options -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="meanType" class="block font-medium mb-1">Mean type <span aria-hidden="true" class="text-red-600">*</span></label>
            <div class="flex items-center gap-2">
              <select id="meanType" class="tap-target w-full border rounded-md px-3 py-2" aria-required="true" aria-describedby="meanType_help meanType_err">
                <option value="arithmetic" selected>Arithmetic mean</option>
                <option value="weighted">Weighted mean</option>
                <option value="geometric">Geometric mean</option>
                <option value="harmonic">Harmonic mean</option>
                <option value="trimmed">Trimmed mean</option>
              </select>
              <button type="button" class="tap-target p-2 rounded border" aria-expanded="false" aria-controls="meanType_help" title="What is each mean?" id="tt-meanType">?</button>
            </div>
            <p id="meanType_help" class="field-help text-slate-600 mt-1 hidden">
              Arithmetic: sum/count. Weighted: sum(w·x)/sum(w). Geometric: (∏x)^{1/n} (x>0). Harmonic: n / Σ(1/x) (x≠0). Trimmed: mean after discarding equal tails.
            </p>
            <p id="meanType_err" class="field-help field-error mt-1" role="alert" aria-live="polite"></p>
          </div>

          <div id="trimBlock" class="hidden">
            <label for="trimPercent" class="block font-medium mb-1">Trim each tail (%)</label>
            <div class="flex items-center gap-2">
              <input id="trimPercent" type="number" step="0.5" min="0" max="45" value="10" class="tap-target w-full border rounded-md px-3 py-2" aria-describedby="trim_help trim_err">
              <button type="button" class="tap-target p-2 rounded border" aria-expanded="false" aria-controls="trim_help" id="tt-trim">?</button>
            </div>
            <p id="trim_help" class="field-help text-slate-600 mt-1 hidden">
              Discards the lowest and highest k% of data (by value) before computing the mean. Total removed = 2k% (capped to integers).
            </p>
            <p id="trim_err" class="field-help field-error mt-1" role="alert" aria-live="polite"></p>
          </div>
        </div>

        <!-- Data entry tabs -->
        <div class="bg-slate-50 border rounded-lg">
          <div class="flex flex-wrap">
            <button class="tap-target px-4 py-3 font-medium border-b-2 border-brand text-brand" id="tab-raw" aria-selected="true" aria-controls="panel-raw">Raw list</button>
            <button class="tap-target px-4 py-3 font-medium border-b-2 border-transparent hover:border-slate-300" id="tab-weighted" aria-selected="false" aria-controls="panel-weighted">Values + Weights</button>
            <button class="tap-target px-4 py-3 font-medium border-b-2 border-transparent hover:border-slate-300" id="tab-freq" aria-selected="false" aria-controls="panel-freq">Frequency table</button>
          </div>

          <div class="p-4 space-y-5">
            <!-- Raw list panel -->
            <div id="panel-raw" role="region" aria-labelledby="tab-raw">
              <label for="rawValues" class="block font-medium mb-1">Numbers (comma, space, or newline separated) <span aria-hidden="true" class="text-red-600">*</span></label>
              <div class="flex items-start gap-2">
                <textarea id="rawValues" rows="5" class="tap-target w-full border rounded-md px-3 py-2" aria-required="true" aria-describedby="raw_help raw_err" placeholder="e.g., 12, 14, 16 18 19&#10;You can also paste CSV columns."></textarea>
                <button type="button" id="btn-demo" class="tap-target px-3 py-2 border rounded-md no-print" title="Load demo data">Demo</button>
              </div>
              <p id="raw_help" class="field-help text-slate-600 mt-1">Non-numeric tokens are ignored. Use period “.” for decimals.</p>
              <p id="raw_err" class="field-help field-error mt-1" role="alert" aria-live="polite"></p>
            </div>

            <!-- Weighted panel -->
            <div id="panel-weighted" class="hidden" role="region" aria-labelledby="tab-weighted">
              <label for="weightedPairs" class="block font-medium mb-1">Value,Weight pairs (two columns or pairs like 10:3)</label>
              <textarea id="weightedPairs" rows="5" class="tap-target w-full border rounded-md px-3 py-2" aria-describedby="weighted_help weighted_err" placeholder="Examples:&#10;10,3&#10;12,5&#10;15,2&#10;or paste two CSV columns"></textarea>
              <p id="weighted_help" class="field-help text-slate-600 mt-1">Both value and weight must be numeric. Negative weights are not allowed.</p>
              <p id="weighted_err" class="field-help field-error mt-1" role="alert" aria-live="polite"></p>
            </div>

            <!-- Frequency panel -->
            <div id="panel-freq" class="hidden" role="region" aria-labelledby="tab-freq">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="freqValues" class="block font-medium mb-1">Values (one per line)</label>
                  <textarea id="freqValues" rows="5" class="tap-target w-full border rounded-md px-3 py-2" aria-describedby="freq_help freq_err" placeholder="e.g., 1&#10;2&#10;3&#10;4"></textarea>
                </div>
                <div>
                  <label for="freqCounts" class="block font-medium mb-1">Frequencies (one per line)</label>
                  <textarea id="freqCounts" rows="5" class="tap-target w-full border rounded-md px-3 py-2" aria-describedby="freq_help freq_err" placeholder="e.g., 2&#10;3&#10;1&#10;4"></textarea>
                </div>
              </div>
              <p id="freq_help" class="field-help text-slate-600 mt-1">Lengths must match. Frequencies must be non-negative.</p>
              <p id="freq_err" class="field-help field-error mt-1" role="alert" aria-live="polite"></p>
            </div>

            <!-- Options -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="precision" class="block font-medium mb-1">Decimals</label>
                <input id="precision" type="number" class="tap-target w-full border rounded-md px-3 py-2" min="0" max="10" step="1" value="4" aria-describedby="prec_help">
                <p id="prec_help" class="field-help text-slate-600 mt-1">Rounding precision for results.</p>
              </div>
              <div>
                <label for="outlierMethod" class="block font-medium mb-1">Outlier filter</label>
                <select id="outlierMethod" class="tap-target w-full border rounded-md px-3 py-2" aria-describedby="outlier_help">
                  <option value="none" selected>None</option>
                  <option value="iqr">IQR (Tukey fences)</option>
                  <option value="z">z-score</option>
                </select>
                <p id="outlier_help" class="field-help text-slate-600 mt-1">Exclude suspected outliers before computing the mean.</p>
              </div>
              <div id="zBlock" class="hidden">
                <label for="zThreshold" class="block font-medium mb-1">z-score threshold</label>
                <input id="zThreshold" type="number" class="tap-target w-full border rounded-md px-3 py-2" min="1" step="0.1" value="3" aria-describedby="z_help z_err">
                <p id="z_help" class="field-help text-slate-600 mt-1">Common choices: 2.5 or 3.0.</p>
                <p id="z_err" class="field-help field-error mt-1" role="alert" aria-live="polite"></p>
              </div>
            </div>

            <div class="flex flex-wrap gap-3 pt-2">
              <button id="btn-calc" class="tap-target px-4 py-2 bg-brand text-white rounded-md hover:bg-blue-700">Calculate</button>
              <button id="btn-clear" class="tap-target px-4 py-2 border rounded-md">Clear</button>
              <button id="btn-copy" class="tap-target px-4 py-2 border rounded-md no-print">Copy results</button>
            </div>
          </div>
        </div>
      </section>

      <!-- 4) Results Area -->
      <section id="results" class="mt-8" aria-labelledby="results-heading">
        <h2 id="results-heading" class="text-xl font-semibold mb-3">Results</h2>

        <div id="results-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="border rounded-lg p-4 text-center">
            <div class="text-sm text-slate-500">Mean</div>
            <div id="out-mean" class="text-2xl font-bold text-brand">—</div>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <div class="text-sm text-slate-500">Count (used)</div>
            <div id="out-count" class="text-2xl font-bold">—</div>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <div class="text-sm text-slate-500">Sum (used)</div>
            <div id="out-sum" class="text-2xl font-bold">—</div>
          </div>
        </div>

        <div id="results-advanced" class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="border rounded-lg p-4 text-center">
            <div class="text-sm text-slate-500">Min • Max</div>
            <div id="out-minmax" class="text-lg font-semibold">—</div>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <div class="text-sm text-slate-500">Std. Deviation</div>
            <div id="out-sd" class="text-lg font-semibold">—</div>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <div class="text-sm text-slate-500">Outliers removed</div>
            <div id="out-removed" class="text-lg font-semibold">0</div>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">Dataset preview</h3>
            <div class="text-sm text-slate-600"><span id="preview"></span></div>
          </div>
          <div class="border rounded-lg p-4">
            <h3 class="font-semibold mb-2">Chart</h3>
            <div class="h-48">
              <canvas id="chart" aria-label="Values and mean chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- 5) Authoritative Content Ecosystem -->
      <section class="prose mt-10">
        <h2>Source of Data &amp; Methodology</h2>
        <p><strong>AuthoritativeDataSource:</strong> National Institute of Standards and Technology (NIST). <em>Engineering Statistics Handbook</em>, “Measures of Location: Mean.” Last updated 2012; accessed 2025. <a class="text-brand underline" href="https://www.itl.nist.gov/div898/handbook/prc/section1/prc141.htm">NIST/SEMATECH e-Handbook of Statistical Methods</a>.</p>
        <p><em>“Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.”</em></p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          <p><strong>Arithmetic mean:</strong> \\(\\displaystyle \\bar{x} = \\frac{1}{n}\\sum_{i=1}^{n} x_i\\)</p>
          <p><strong>Weighted mean:</strong> \\(\\displaystyle \\bar{x}_w = \\frac{\\sum_{i=1}^{n} w_i x_i}{\\sum_{i=1}^{n} w_i}\\)</p>
          <p><strong>Geometric mean (all \\(x_i>0\\)):</strong> \\(\\displaystyle G = \\left(\\prod_{i=1}^{n} x_i\\right)^{1/n}\\)</p>
          <p><strong>Harmonic mean (all \\(x_i\\neq 0\\)):</strong> \\(\\displaystyle H = \\frac{n}{\\sum_{i=1}^{n} \\frac{1}{x_i}}\\)</p>
          <p><strong>Trimmed mean (\\(\\alpha\\) per tail):</strong> sort \\(x\\), remove lowest and highest \\(\\alpha\\%\\), then compute arithmetic mean of the remaining values.</p>
          <p><strong>Mean from frequency table:</strong> \\(\\displaystyle \\bar{x}=\\frac{\\sum v_j f_j}{\\sum f_j}\\)</p>
        </div>

        <h2>Glossary of variables</h2>
        <ul>
          <li><strong>\\(x_i\\)</strong>: data values; <strong>\\(n\\)</strong>: number of values used after filters</li>
          <li><strong>\\(w_i\\)</strong>: weight for each value (weighted mean)</li>
          <li><strong>\\(f_j\\)</strong>: frequency of value \\(v_j\\) (frequency table)</li>
          <li><strong>Trim %</strong>: percentage removed from each tail before averaging (trimmed mean)</li>
          <li><strong>IQR / z-score</strong>: optional outlier removal methods before calculating the mean</li>
        </ul>

        <h2>How it works: a step-by-step example</h2>
        <p><em>Example:</em> values 10, 12, 13, 18, 22. Arithmetic mean is \\((10+12+13+18+22)/5 = 15\\). With a 20% trimmed mean (remove 1 lowest and 1 highest), remaining values 12, 13, 18 → mean \\((12+13+18)/3 = 14.3333\\). Weighted example with weights 1,2,1,1,1 gives \\(\\bar{x}_w=(10·1+12·2+13·1+18·1+22·1)/(1+2+1+1+1)=75/6=12.5\\).</p>

        <h2>Frequently asked questions (FAQ)</h2>
        <details>
          <summary>Should I prefer trimmed mean over arithmetic mean?</summary>
          <p>Use trimmed mean when a few extreme values could distort the average. It’s common in robust statistics and performance benchmarking.</p>
        </details>
        <details>
          <summary>What’s the difference between weighted and frequency means?</summary>
          <p>They are algebraically the same if weights equal frequencies. Frequency tables are a specific case of weighted averages.</p>
        </details>
        <details>
          <summary>Why can’t geometric mean accept zeros or negatives?</summary>
          <p>Because products and nth-roots are undefined or complex under those inputs; geometric mean is defined for strictly positive values.</p>
        </details>
        <details>
          <summary>Is the harmonic mean ever larger than the arithmetic mean?</summary>
          <p>No. For positive numbers, harmonic ≤ geometric ≤ arithmetic, with equality only if all values are equal.</p>
        </details>
        <details>
          <summary>Do outlier filters guarantee “correct” results?</summary>
          <p>No filter can replace domain judgment. These tools help explore robustness but should be applied thoughtfully.</p>
        </details>

        <div class="mt-6 p-4 bg-slate-50 border rounded-lg text-sm text-slate-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-4 py-8 text-center text-slate-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-brand">About</a>
        <a href="contact.html" class="hover:text-brand">Contact</a>
        <a href="privacy.html" class="hover:text-brand">Privacy</a>
        <a href="terms.html" class="hover:text-brand">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (deferred) -->
  <script defer>
  (function(){
    const $ = id => document.getElementById(id);
    const state = {
      values: [],
      weights: [],
      usedValues: [],
      removedCount: 0,
      chart: null
    };

    // Helpers
    const parseNumber = s => {
      const x = Number(String(s).trim());
      return Number.isFinite(x) ? x : null;
    };
    const parseList = (text) => {
      if (!text) return [];
      // Split by commas, spaces, or newlines; also accept CSV column pastes
      const raw = text.replace(/;/g,',').split(/[\s,]+/).filter(Boolean);
      const arr = raw.map(parseNumber).filter(v => v !== null);
      return arr;
    };
    const parsePairs = (text) => {
      if (!text) return {v:[], w:[]};
      const lines = text.trim().split(/\n+/);
      const v=[], w=[];
      for (const line of lines) {
        const t = line.trim();
        if (!t) continue;
        if (t.includes(':')) {
          const [a,b] = t.split(':');
          const x=parseNumber(a), y=parseNumber(b);
          if (x!==null && y!==null) { v.push(x); w.push(y); }
        } else {
          const parts = t.split(/[\s,]+/).filter(Boolean);
          if (parts.length>=2) {
            const x=parseNumber(parts[0]), y=parseNumber(parts[1]);
            if (x!==null && y!==null) { v.push(x); w.push(y); }
          }
        }
      }
      return {v,w};
    };
    const parseTwoCols = (a,b) => {
      const va = a.trim().split(/\n+/).filter(Boolean).map(parseNumber);
      const fb = b.trim().split(/\n+/).filter(Boolean).map(parseNumber);
      if (va.some(v=>v===null)||fb.some(v=>v===null)) return null;
      if (va.length !== fb.length) return null;
      return {v:va, f:fb};
    };
    const roundN = (x,n) => {
      const k = Math.pow(10, n);
      return Math.round((x + Number.EPSILON) * k)/k;
    };

    // Statistics
    const mean = arr => arr.reduce((a,b)=>a+b,0)/arr.length;
    const sd = arr => {
      if (arr.length<2) return 0;
      const m = mean(arr);
      const v = arr.reduce((s,x)=>s+(x-m)*(x-m),0)/(arr.length-1);
      return Math.sqrt(v);
    };
    const quantile = (arr, q) => {
      if (arr.length===0) return NaN;
      const a = [...arr].sort((x,y)=>x-y);
      const pos = (a.length-1)*q;
      const base = Math.floor(pos), rest = pos-base;
      return a[base] + (a[base+1] - a[base || 0]) * (isNaN(rest)?0:rest);
    };
    const iqrFences = (arr) => {
      const a = [...arr].sort((x,y)=>x-y);
      const q1 = quantile(a, 0.25);
      const q3 = quantile(a, 0.75);
      const iqr = q3 - q1;
      return {low: q1 - 1.5*iqr, high: q3 + 1.5*iqr};
    };

    // Accessibility: tooltips toggles
    const makeToggle = (btnId, targetId) => {
      const btn = $(btnId), tgt = $(targetId);
      if (!btn || !tgt) return;
      btn.addEventListener('click', () => {
        const open = tgt.classList.toggle('hidden') ? false : true;
        btn.setAttribute('aria-expanded', String(open));
      });
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
      });
    };
    makeToggle('tt-meanType','meanType_help');
    makeToggle('tt-trim','trim_help');

    // Tabs
    const tabs = [
      {btn:'tab-raw', panel:'panel-raw'},
      {btn:'tab-weighted', panel:'panel-weighted'},
      {btn:'tab-freq', panel:'panel-freq'}
    ];
    tabs.forEach(({btn,panel},i)=>{
      $(btn).addEventListener('click', ()=>{
        tabs.forEach(({btn:b,panel:p})=>{
          $(b).setAttribute('aria-selected','false');
          $(b).classList.remove('border-brand','text-brand');
          $(b).classList.add('border-transparent');
          $(p).classList.add('hidden');
        });
        $(btn).setAttribute('aria-selected','true');
        $(btn).classList.add('border-brand','text-brand');
        $(panel).classList.remove('hidden');
      });
    });

    // Show/Hide blocks based on selections
    const onMeanTypeChange = () => {
      const t = $('meanType').value;
      $('trimBlock').classList.toggle('hidden', t!=='trimmed');
    };
    $('meanType').addEventListener('change', onMeanTypeChange);
    onMeanTypeChange();

    const onOutlierMethod = () => {
      $('zBlock').classList.toggle('hidden', $('outlierMethod').value!=='z');
    };
    $('outlierMethod').addEventListener('change', onOutlierMethod);
    onOutlierMethod();

    // Inline validation (on blur)
    const setErr = (id,msg) => { const el=$(id); if(el){ el.textContent=msg||''; } };
    $('trimPercent').addEventListener('blur', ()=>{
      const v = Number($('trimPercent').value);
      setErr('trim_err', (isNaN(v) || v<0 || v>45) ? 'Enter a trim between 0 and 45%' : '');
    });
    $('zThreshold').addEventListener('blur', ()=>{
      const z = Number($('zThreshold').value);
      setErr('z_err', (isNaN(z) || z<1) ? 'z-score threshold must be ≥ 1' : '');
    });

    // Demo
    $('btn-demo').addEventListener('click', ()=>{
      $('rawValues').value = '9, 10, 10, 11, 12, 12, 13, 14, 40';
    });

    // Clear
    $('btn-clear').addEventListener('click', ()=>{
      $('rawValues').value='';
      $('weightedPairs').value='';
      $('freqValues').value='';
      $('freqCounts').value='';
      $('outlierMethod').value='none';
      $('zThreshold').value='3';
      $('meanType').value='arithmetic';
      $('trimPercent').value='10';
      onMeanTypeChange();
      onOutlierMethod();
      renderOutputs(null,[],0,true);
    });

    // Copy results
    $('btn-copy').addEventListener('click', ()=>{
      const report = buildReportText();
      navigator.clipboard.writeText(report).then(()=>{
        alert('Results copied to clipboard.');
      });
    });

    // Calculate
    $('btn-calc').addEventListener('click', compute);

    function gatherData(){
      const type = $('meanType').value;
      const prec = Math.max(0, Math.min(10, Number($('precision').value)||0));
      const outlier = $('outlierMethod').value;
      const zthr = Number($('zThreshold').value)||3;
      // Parse by visible panel
      let base = [];
      let weights = null;

      if (!$('#panel-raw').classList.contains('hidden')) {
        base = parseList($('rawValues').value);
        setErr('raw_err', base.length? '' : 'Please enter at least one valid number.');
      } else if (!$('#panel-weighted').classList.contains('hidden')) {
        const {v,w} = parsePairs($('weightedPairs').value);
        base = v; weights = w;
        setErr('weighted_err', (v.length && v.length===w.length) ? '' : 'Provide value,weight per line (two columns or a:b).');
        if (w && w.some(x => !Number.isFinite(x) || x<0)) setErr('weighted_err','Weights must be non-negative.');
      } else {
        const tf = parseTwoCols($('freqValues').value, $('freqCounts').value);
        if (tf===null){ setErr('freq_err','Values and frequencies must be numeric with the same count.'); }
        else{
          setErr('freq_err','');
          // Expand into base list (efficient enough for UI sizes)
          base = [];
          for (let i=0;i<tf.v.length;i++){
            const times = Math.max(0, Math.floor(tf.f[i]));
            for (let k=0;k<times;k++) base.push(tf.v[i]);
          }
        }
      }
      return {type, base, weights, prec, outlier, zthr};
    }

    function filterOutliers(arr, method, zthr){
      if (method==='none' || arr.length<3) return {used:[...arr], removed:0};
      if (method==='iqr'){
        const {low, high} = iqrFences(arr);
        const used = arr.filter(x=>x>=low && x<=high);
        return {used, removed: arr.length - used.length};
      }
      // z-score
      const m = mean(arr), s = sd(arr);
      if (s===0) return {used:[...arr], removed:0};
      const used = arr.filter(x=>Math.abs((x-m)/s) <= zthr);
      return {used, removed: arr.length - used.length};
    }

    function compute(){
      // Reset errors
      setErr('meanType_err',''); setErr('raw_err',''); setErr('weighted_err',''); setErr('freq_err','');

      const {type, base, weights, prec, outlier, zthr} = gatherData();
      if (!base.length){ renderOutputs(null,[],0); return; }

      // Special constraints
      if (type==='geometric' && base.some(x => x<=0)){
        setErr('raw_err','Geometric mean requires all values strictly positive.');
        renderOutputs(null,[],0); return;
      }
      if (type==='harmonic' && base.some(x => x===0)){
        setErr('raw_err','Harmonic mean requires all values non-zero.');
        renderOutputs(null,[],0); return;
      }

      // Outlier filtering
      const {used, removed} = filterOutliers(base, outlier, zthr);
      if (!used.length){ renderOutputs(null,[],removed); return; }

      let m = NaN, sumUsed = used.reduce((a,b)=>a+b,0);

      if (type==='arithmetic' || type==='trimmed'){
        let arr = used;
        if (type==='trimmed'){
          const p = Math.max(0, Math.min(45, Number($('trimPercent').value)||0));
          const sorted = [...used].sort((a,b)=>a-b);
          const k = Math.floor(sorted.length * (p/100));
          arr = sorted.slice(k, sorted.length - k);
          sumUsed = arr.reduce((a,b)=>a+b,0);
          if (!arr.length){ renderOutputs(null,[],removed,true,'Trim removed all data. Reduce the percentage.'); return; }
        }
        m = sumUsed / (type==='trimmed' ? arr.length : used.length);
        state.usedValues = (type==='trimmed' ? arr : used);
      } else if (type==='weighted'){
        if (!$('#panel-weighted').classList.contains('hidden')){
          const {v,w} = parsePairs($('weightedPairs').value);
          const W = w.reduce((a,b)=>a+b,0);
          if (W<=0){ setErr('weighted_err','Sum of weights must be > 0.'); renderOutputs(null,[],removed); return; }
          let num = 0;
          for (let i=0;i<v.length;i++){ num += v[i]*w[i]; }
          m = num / W;
          state.usedValues = [...v]; sumUsed = v.reduce((a,b)=>a+b,0);
        } else {
          // If user is in raw panel but selected weighted (edge case)
          const W = used.length;
          m = sumUsed / W;
          state.usedValues = used;
        }
      } else if (type==='geometric'){
        const prod = used.reduce((a,b)=>a*b,1);
        m = Math.pow(prod, 1/used.length);
        state.usedValues = used;
      } else if (type==='harmonic'){
        const denom = used.reduce((s,x)=>s + (1/x), 0);
        m = used.length / denom;
        state.usedValues = used;
      }

      renderOutputs(Number.isFinite(m) ? roundN(m, Number($('precision').value)||0) : null, state.usedValues, removed);
    }

    function renderOutputs(meanVal, used, removed, silent=false, warn=''){
      // Summary
      $('out-mean').textContent = (meanVal===null || !Number.isFinite(meanVal)) ? '—' : String(meanVal);
      $('out-count').textContent = used.length ? String(used.length) : '—';
      const sum = used.reduce((a,b)=>a+b,0);
      $('out-sum').textContent = used.length ? String(roundN(sum, Number($('precision').value)||0)) : '—';
      $('out-minmax').textContent = used.length ? `${Math.min(...used)} • ${Math.max(...used)}` : '—';
      $('out-sd').textContent = used.length>1 ? String(roundN(sd(used), Number($('precision').value)||0)) : (used.length? '0' : '—');
      $('out-removed').textContent = String(removed||0);
      $('preview').textContent = used.length ? used.slice(0,50).join(', ') + (used.length>50?' …':'') : '—';
      if (warn && !silent) alert(warn);

      // Chart
      const ctx = $('chart');
      if (!ctx) return;
      const labels = used.map((_,i)=>String(i+1));
      const data = {
        labels,
        datasets: [
          {label:'Values', data: used, type:'bar'},
          {label:'Mean', data: used.map(()=>meanVal), type:'line'}
        ]
      };
      const options = {
        responsive:true, maintainAspectRatio:false,
        plugins:{legend:{position:'bottom'}},
        scales:{x:{title:{display:true,text:'Index'}},y:{title:{display:true,text:'Value'}}}
      };
      if (state.chart){
        state.chart.data = data;
        state.chart.options = options;
        state.chart.update();
      } else {
        state.chart = new Chart(ctx, {data, options});
      }
    }

    function buildReportText(){
      return [
        'Mean Calculator Report',
        '======================',
        `Mean: ${$('out-mean').textContent}`,
        `Count (used): ${$('out-count').textContent}`,
        `Sum (used): ${$('out-sum').textContent}`,
        `Min • Max: ${$('out-minmax').textContent}`,
        `Std. Deviation: ${$('out-sd').textContent}`,
        `Outliers removed: ${$('out-removed').textContent}`,
        `Preview: ${$('preview').textContent}`
      ].join('\n');
    }

    // Recompute when key settings change for instant feedback
    ['meanType','trimPercent','precision','outlierMethod','zThreshold','rawValues','weightedPairs','freqValues','freqCounts']
      .forEach(id => { const el=$(id); if (el){ el.addEventListener('input', ()=>{/* debounced by browser */}); el.addEventListener('blur', compute); }});

    // Initial blank state
    renderOutputs(null,[],0,true);
  })();
  </script>
</body>
</html>
