<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fraction Calculator — Add, Subtract, Multiply, Divide Fractions</title>
<meta name="description" content="Professional fraction calculator for adding, subtracting, multiplying, and dividing fractions and mixed numbers. Shows simplified result, mixed form, decimal, and LaTeX step-by-step working." />
<link rel="canonical" href="https://calcdomain.com/fraction-calculator.html" />

<!-- Icons / PWA (optional placeholders to avoid CLS if absent) -->
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />

<!-- Tailwind (CDN for rapid, mobile-first UI) -->
<script src="https://cdn.tailwindcss.com" defer></script>

<!-- MathJax for LaTeX rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        id="MathJax-script"></script>

<style>
  /* Base typography and layout hygiene */
  html { color-scheme: light; }
  body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; }
  .prose { max-width: 70ch; }
  .prose h2 { font-size: 1.35rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
  .prose h3 { font-size: 1.15rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
  .prose p, .prose li { line-height: 1.65; }
  .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:12px; padding:1rem; overflow-x:auto; }
  /* Accessible, visible focus (WCAG 2.4.7) */
  :where(a,button,input,select,summary,details)[tabindex], a, button, input, select, summary, details { outline-offset: 2px; }
  :focus-visible { outline: 3px solid #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,.25); border-radius: 6px; }
  /* Error text and min-heights to prevent CLS */
  .error-msg { color:#b91c1c; font-size: .875rem; margin-top: .375rem; min-height: 1.25rem; }
  #results-panel { min-height: 220px; } /* avoids layout shift when results render */
  /* Touch targets (>=48x48) via padding + spacing */
  .touch-target { min-height: 48px; }
  /* Print hygiene */
  @media print {
    header, nav, aside, .no-print { display: none !important; }
    main { padding: 0 !important; }
  }
</style>

<!-- JSON-LD: WebPage + WebApplication + Breadcrumb + FAQ -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": ["WebPage","WebApplication"],
  "name": "Fraction Calculator",
  "url": "https://calcdomain.com/fraction-calculator.html",
  "inLanguage": "en",
  "applicationCategory": "EducationalApplication",
  "about": { "@type": "Thing", "name": "Fractions, Rational numbers, Mixed numbers" },
  "isBasedOn": {
    "@type": "CreativeWork",
    "name": "NIST Handbook of Mathematical Functions (Chapter 1: Numbers, Section on Rational Numbers)",
    "url": "https://dlmf.nist.gov/",
    "datePublished": "2010-06-07",
    "publisher": { "@type": "Organization", "name": "National Institute of Standards and Technology (NIST)" }
  },
  "author": { "@type": "Person", "name": "Ugo Candido" },
  "publisher": { "@type": "Organization", "name": "CalcDomain" },
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
    {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
    {"@type":"ListItem","position":3,"name":"Algebra","item":"https://calcdomain.com/subcategories/math-algebra.html"},
    {"@type":"ListItem","position":4,"name":"Fraction Calculator","item":"https://calcdomain.com/fraction-calculator.html"}
  ]
}
</script>
<script type="application/ld+json" id="faq-jsonld">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {"@type":"Question","name":"What inputs does this fraction calculator accept?","acceptedAnswer":{"@type":"Answer","text":"You can enter integers (e.g., 7), simple fractions (e.g., -3/5), or mixed numbers (e.g., 3 1/2). Negative signs may precede the whole number or the numerator."}},
    {"@type":"Question","name":"Does it simplify results automatically?","acceptedAnswer":{"@type":"Answer","text":"Yes. Results are returned in lowest terms. We also show the improper fraction, mixed number, and decimal expansion."}},
    {"@type":"Question","name":"How are addition and subtraction computed?","acceptedAnswer":{"@type":"Answer","text":"The calculator finds the least common multiple (LCM) of denominators, converts each fraction to an equivalent form with that denominator, combines numerators, and simplifies using the GCD."}},
    {"@type":"Question","name":"How are multiplication and division computed?","acceptedAnswer":{"@type":"Answer","text":"For multiplication, numerators and denominators are multiplied and then simplified. For division, we multiply by the reciprocal of the second fraction and simplify."}},
    {"@type":"Question","name":"Will it show the algebraic steps?","acceptedAnswer":{"@type":"Answer","text":"Yes. It displays LaTeX-formatted steps: conversion of mixed to improper, common denominators, operations, and simplification."}},
    {"@type":"Question","name":"Can I copy results?","acceptedAnswer":{"@type":"Answer","text":"Yes. Use the copy buttons near each result to put the value on your clipboard."}},
    {"@type":"Question","name":"Is this suitable for professional or academic use?","acceptedAnswer":{"@type":"Answer","text":"Yes. It follows standard arithmetic rules for rational numbers and clearly documents methodology and references."}}
  ]
}
</script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per requirements) -->
  <header class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="text-xl font-extrabold text-blue-700">CalcDomain</a>
      <nav aria-label="Utility" class="hidden md:flex gap-6 text-sm">
        <a href="search.html" class="hover:text-blue-700">Advanced Search</a>
        <a href="index.html#categories" class="hover:text-blue-700">Categories</a>
      </nav>
      <button class="md:hidden p-2 rounded hover:bg-gray-100 touch-target" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- Breadcrumbs -->
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
      <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
      <a href="subcategories/math-algebra.html" class="hover:text-blue-700">Algebra</a> &raquo;
      <span class="text-gray-900">Fraction Calculator</span>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <section class="lg:col-span-2 bg-white rounded-xl shadow-sm border p-6">
        <h1 class="text-3xl font-extrabold mb-2">fraction calculator</h1>
        <p class="text-gray-700 mb-6">
          Enter two fractions or mixed numbers, choose an operation, and get a fully simplified result with a decimal
          approximation and LaTeX step-by-step working. Built for students, teachers, engineers, and finance pros who
          need reliable, audit-ready arithmetic on rational numbers.
        </p>

        <!-- Calculator (Section 3 in the order) -->
        <section aria-labelledby="calc-title">
          <h2 id="calc-title" class="sr-only">Calculator Inputs</h2>

          <form id="calc-form" class="space-y-5" novalidate>
            <!-- Input A -->
            <div>
              <div class="flex items-center gap-2">
                <label for="inputA" class="block text-sm font-medium text-gray-900">
                  Fraction A <span aria-hidden="true" class="text-red-700 font-semibold">*</span>
                </label>
                <!-- Accessible tooltip -->
                <button type="button" class="ml-1 text-xs px-2 py-1 rounded border hover:bg-gray-50 touch-target"
                        aria-expanded="false" aria-controls="tipA" id="tipA-btn">?</button>
              </div>
              <input id="inputA" name="inputA" inputmode="text" aria-required="true"
                     aria-describedby="errA tipA"
                     placeholder='Examples: 3/4   -2   1 1/2'
                     class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600 focus:border-blue-600"
                     />
              <p id="errA" class="error-msg" role="alert" aria-live="polite"></p>
              <div id="tipA" hidden class="mt-2 text-sm text-gray-700">
                <p class="rounded-md bg-blue-50 border border-blue-200 p-3">
                  Accepted formats: <code>integer</code> (e.g., <code>-2</code>), <code>fraction</code> (e.g., <code>3/4</code>),
                  <code>mixed</code> (e.g., <code>1 1/2</code>). Use a leading minus sign for negatives (e.g., <code>-1 3/5</code>).
                </p>
              </div>
            </div>

            <!-- Operator -->
            <div>
              <label for="operator" class="block text-sm font-medium text-gray-900">
                Operation <span aria-hidden="true" class="text-red-700 font-semibold">*</span>
              </label>
              <select id="operator" name="operator" aria-required="true" aria-describedby="errOp"
                      class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600 focus:border-blue-600 touch-target">
                <option value="+">Add (A + B)</option>
                <option value="-">Subtract (A − B)</option>
                <option value="*">Multiply (A × B)</option>
                <option value="/">Divide (A ÷ B)</option>
              </select>
              <p id="errOp" class="error-msg" role="alert" aria-live="polite"></p>
            </div>

            <!-- Input B -->
            <div>
              <div class="flex items-center gap-2">
                <label for="inputB" class="block text-sm font-medium text-gray-900">
                  Fraction B <span aria-hidden="true" class="text-red-700 font-semibold">*</span>
                </label>
                <button type="button" class="ml-1 text-xs px-2 py-1 rounded border hover:bg-gray-50 touch-target"
                        aria-expanded="false" aria-controls="tipB" id="tipB-btn">?</button>
              </div>
              <input id="inputB" name="inputB" inputmode="text" aria-required="true"
                     aria-describedby="errB tipB"
                     placeholder='Examples: -5/6   4   2 3/8'
                     class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600 focus:border-blue-600"
                     />
              <p id="errB" class="error-msg" role="alert" aria-live="polite"></p>
              <div id="tipB" hidden class="mt-2 text-sm text-gray-700">
                <p class="rounded-md bg-blue-50 border border-blue-200 p-3">
                  Same formats as A. For division, B must not be zero.
                </p>
              </div>
            </div>

            <!-- Action buttons -->
            <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
              <button type="button" id="btn-calc"
                      class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white font-semibold hover:bg-blue-700 touch-target">
                Calculate
              </button>
              <button type="button" id="btn-clear"
                      class="inline-flex items-center justify-center px-4 py-2 rounded-md border bg-white hover:bg-gray-50 touch-target">
                Clear
              </button>
            </div>
          </form>
        </section>

        <!-- Results (Section 4 in the order) -->
        <section id="results" class="mt-8" aria-labelledby="results-title">
          <h2 id="results-title" class="text-xl font-bold mb-3">Results</h2>
          <div id="results-panel" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            <!-- Cards -->
            <div class="border rounded-lg p-4 bg-white">
              <div class="text-sm text-gray-600 mb-1">Simplified (improper)</div>
              <div id="res-improper" class="text-2xl font-extrabold text-blue-700">—</div>
              <button type="button" data-copy="#res-improper"
                class="mt-2 text-sm underline text-blue-700 no-print">Copy</button>
            </div>
            <div class="border rounded-lg p-4 bg-white">
              <div class="text-sm text-gray-600 mb-1">Mixed number</div>
              <div id="res-mixed" class="text-2xl font-extrabold text-blue-700">—</div>
              <button type="button" data-copy="#res-mixed"
                class="mt-2 text-sm underline text-blue-700 no-print">Copy</button>
            </div>
            <div class="border rounded-lg p-4 bg-white">
              <div class="text-sm text-gray-600 mb-1">Decimal</div>
              <div id="res-decimal" class="text-2xl font-extrabold text-blue-700">—</div>
              <button type="button" data-copy="#res-decimal"
                class="mt-2 text-sm underline text-blue-700 no-print">Copy</button>
            </div>
          </div>

          <!-- Steps -->
          <details class="mt-6 bg-white border rounded-lg p-4">
            <summary class="font-semibold cursor-pointer">Show LaTeX step-by-step</summary>
            <div id="steps" class="mt-4 space-y-3">
              <div id="steps-tex" class="formula-box text-sm">No steps yet.</div>
            </div>
          </details>
        </section>
      </section>

      <!-- Aside -->
      <aside class="lg:col-span-1 space-y-6">
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h3 class="font-bold text-lg mb-2">Why this calculator</h3>
          <ul class="list-disc list-inside text-gray-700 text-sm space-y-2">
            <li>Accepts integers, fractions, and mixed numbers with negative values.</li>
            <li>Displays simplified result, mixed form, decimal, and LaTeX steps.</li>
            <li>WCAG-compliant, keyboard-friendly, and ready for classroom or pro use.</li>
          </ul>
        </div>

        <div class="bg-white rounded-xl shadow-sm border p-6 prose">
          <h2>Data source &amp; methodology</h2>
          <p>
            Authoritative source: <strong>NIST Handbook of Mathematical Functions</strong> (2010), National Institute of
            Standards and Technology. See the sections on numbers and rational arithmetic. 
            <a class="text-blue-700 underline" href="https://dlmf.nist.gov/">dlmf.nist.gov</a>.
            <br><em>All computations rigorously follow the formulas and rules provided by this source.</em>
          </p>
        </div>
      </aside>
    </div>

    <!-- Authoritativeness content ecosystem (Section 5) -->
    <article class="bg-white rounded-xl shadow-sm border p-6 mt-10 prose">
      <h2>The formula explained</h2>
      <p>We model fractions as rational numbers \( \tfrac{a}{b} \) with \( b \neq 0 \). Mixed numbers \( w\ \tfrac{a}{b} \) are converted to improper form via:</p>
      <div class="formula-box">\( w\ \frac{a}{b} = \frac{|w|\cdot b + a}{b}\) with the sign from \(w\); if \(w &lt; 0\) the result is negative.</div>

      <h3>Operations</h3>
      <ul>
        <li><strong>Add/Subtract</strong>: find the least common multiple (LCM) of denominators \(d_1,d_2\), convert, then combine:
          <div class="formula-box">\( \frac{a_1}{d_1} \pm \frac{a_2}{d_2} 
            = \frac{a_1\cdot \frac{\text{lcm}(d_1,d_2)}{d_1} \ \pm\ a_2\cdot \frac{\text{lcm}(d_1,d_2)}{d_2}}{\text{lcm}(d_1,d_2)} \)</div>
        </li>
        <li><strong>Multiply</strong>:
          <div class="formula-box">\( \frac{a_1}{d_1}\cdot \frac{a_2}{d_2} = \frac{a_1 a_2}{d_1 d_2} \)</div>
        </li>
        <li><strong>Divide</strong> (reciprocal of the second):
          <div class="formula-box">\( \frac{a_1}{d_1}\div \frac{a_2}{d_2} = \frac{a_1}{d_1}\cdot \frac{d_2}{a_2} \), with \( a_2 \neq 0\).</div>
        </li>
      </ul>
      <p>All results are reduced using the greatest common divisor (GCD): \( \frac{a}{b} = \frac{a/\gcd(a,b)}{b/\gcd(a,b)} \).</p>

      <h2>Glossary of variables</h2>
      <table class="w-full border collapse">
        <thead class="bg-gray-100"><tr><th class="p-2 text-left">Symbol</th><th class="p-2 text-left">Meaning</th></tr></thead>
        <tbody>
          <tr><td class="p-2"><code>w</code></td><td class="p-2">Whole part of a mixed number</td></tr>
          <tr><td class="p-2"><code>a</code></td><td class="p-2">Numerator</td></tr>
          <tr><td class="p-2"><code>b</code></td><td class="p-2">Denominator (non-zero)</td></tr>
          <tr><td class="p-2"><code>\(\gcd\)</code></td><td class="p-2">Greatest common divisor</td></tr>
          <tr><td class="p-2"><code>\(\text{lcm}\)</code></td><td class="p-2">Least common multiple</td></tr>
        </tbody>
      </table>

      <h2>How it works: a step-by-step example</h2>
      <h3>Add \(1\ \tfrac{1}{2} + \tfrac{3}{4}\)</h3>
      <ol>
        <li>Convert \(1\ \tfrac{1}{2} = \tfrac{3}{2}\).</li>
        <li>LCM\((2,4)=4\). Convert: \(\tfrac{3}{2}=\tfrac{6}{4}\), \(\tfrac{3}{4}\) stays \(\tfrac{3}{4}\).</li>
        <li>Add numerators: \(\tfrac{6}{4}+\tfrac{3}{4}=\tfrac{9}{4}\).</li>
        <li>Simplify (already reduced), mixed: \(2\ \tfrac{1}{4}\), decimal: \(2.25\).</li>
      </ol>

      <h2>Frequently asked questions</h2>
      <details><summary>How do I type a mixed number?</summary>
        <p>Type like <code>3 1/2</code> (whole, space, fraction). For negatives, use <code>-1 3/5</code>.</p>
      </details>
      <details><summary>Will it reduce improper fractions?</summary>
        <p>Yes, everything is reduced to lowest terms using the GCD.</p>
      </details>
      <details><summary>Does it handle zero and negatives?</summary>
        <p>Yes. Denominators cannot be zero. Signs are preserved through operations.</p>
      </details>
      <details><summary>What about division by zero?</summary>
        <p>The tool prevents division by a zero fraction and shows a clear error.</p>
      </details>
      <details><summary>Can I copy the result?</summary>
        <p>Use the “Copy” buttons next to each result.</p>
      </details>

      <div class="mt-6 p-4 bg-gray-50 border rounded-lg text-sm text-gray-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
        Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
      </div>
    </article>
  </main>

  <footer class="bg-white border-t mt-10">
    <div class="max-w-6xl mx-auto px-4 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a class="hover:text-blue-700" href="about.html">About</a>
        <a class="hover:text-blue-700" href="contact.html">Contact</a>
        <a class="hover:text-blue-700" href="privacy.html">Privacy</a>
        <a class="hover:text-blue-700" href="terms.html">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  // --- Utilities ---
  const gcd = (a,b)=>{ a=Math.abs(a); b=Math.abs(b); while(b){[a,b]=[b,a%b]} return a||1; };
  const lcm = (a,b)=> Math.abs(a*b)/gcd(a,b) || 0;

  // Parse "integer", "a/b", or "w a/b" (with optional leading minus)
  function parseFraction(str) {
    if (!str || typeof str !== 'string') return null;
    const s = str.trim().replace(/\s+/g,' ').toLowerCase();
    // Mixed with sign: "-w a/b" or "w a/b" with possible leading '-'
    const mixed = /^(-)?\s*(\d+)\s+(\d+)\s*\/\s*(\d+)$/.exec(s);
    if (mixed) {
      const sign = mixed[1] ? -1 : 1;
      const w = parseInt(mixed[2],10);
      const a = parseInt(mixed[3],10);
      const b = parseInt(mixed[4],10);
      if (b === 0) return null;
      const num = sign * (w*b + a);
      return [num, b];
    }
    // Simple fraction: "-?a/b"
    const frac = /^(-)?\s*(\d+)\s*\/\s*(\d+)$/.exec(s);
    if (frac) {
      const sign = frac[1] ? -1 : 1;
      const a = parseInt(frac[2],10);
      const b = parseInt(frac[3],10);
      if (b === 0) return null;
      return [sign*a, b];
    }
    // Integer: "-?k"
    const intg = /^(-)?\s*(\d+)$/.exec(s);
    if (intg) {
      const sign = intg[1] ? -1 : 1;
      const k = parseInt(intg[2],10);
      return [sign*k, 1];
    }
    return null;
  }

  function simplify([n,d]) {
    if (d < 0) { n = -n; d = -d; }
    const g = gcd(n,d);
    return [n/g, d/g];
  }

  function toMixed([n,d]) {
    const sign = n < 0 ? -1 : 1;
    const an = Math.abs(n);
    const w = Math.trunc(an / d);
    const r = an % d;
    if (r === 0) return [sign*w, 0, 1]; // whole number
    return [sign*w, r, d];
  }

  function dec([n,d]) { return d === 0 ? NaN : n/d; }

  function opFrac(a, b, op) {
    const [n1,d1] = a, [n2,d2] = b;
    if (d1===0 || d2===0) throw new Error("Denominator cannot be zero.");
    let n=0, d=1, steps = [];
    // Prepare TeX views of inputs
    const tex = (n,d)=>`\\dfrac{${n}}{${d}}`;
    const texMixed = ([n,d])=>{
      const [w, r, den] = toMixed([n,d]);
      if (r===0) return `${w}`;
      const s = (w<0) ? "-" : "";
      const aw = Math.abs(w);
      return `${s}${aw>0?aw+"\\ ":""}\\dfrac{${r}}{${den}}`;
    };

    switch(op){
      case '+': {
        const L = lcm(d1,d2);
        const m1 = L/d1, m2 = L/d2;
        const tn1 = n1*m1, tn2 = n2*m2;
        steps.push(`\\text{LCM}(${d1},${d2})=${L}`);
        steps.push(`${tex(n1,d1)}=\\dfrac{${tn1}}{${L}},\\quad ${tex(n2,d2)}=\\dfrac{${tn2}}{${L}}`);
        n = tn1 + tn2; d = L;
        steps.push(`\\dfrac{${tn1}}{${L}} + \\dfrac{${tn2}}{${L}} = \\dfrac{${n}}{${L}}`);
        break;
      }
      case '-': {
        const L = lcm(d1,d2);
        const m1 = L/d1, m2 = L/d2;
        const tn1 = n1*m1, tn2 = n2*m2;
        steps.push(`\\text{LCM}(${d1},${d2})=${L}`);
        steps.push(`${tex(n1,d1)}=\\dfrac{${tn1}}{${L}},\\quad ${tex(n2,d2)}=\\dfrac{${tn2}}{${L}}`);
        n = tn1 - tn2; d = L;
        steps.push(`\\dfrac{${tn1}}{${L}} - \\dfrac{${tn2}}{${L}} = \\dfrac{${n}}{${L}}`);
        break;
      }
      case '*': {
        steps.push(`${tex(n1,d1)}\\times ${tex(n2,d2)} = \\dfrac{${n1}\\cdot ${n2}}{${d1}\\cdot ${d2}}`);
        n = n1*n2; d = d1*d2;
        break;
      }
      case '/': {
        if (n2 === 0) throw new Error("Cannot divide by zero.");
        steps.push(`${tex(n1,d1)}\\div ${tex(n2,d2)} = ${tex(n1,d1)}\\times ${tex(d2,n2)} = \\dfrac{${n1}\\cdot ${d2}}{${d1}\\cdot ${n2}}`);
        n = n1*d2; d = d1*n2;
        break;
      }
      default: throw new Error("Unknown operation.");
    }
    const [sn, sd] = simplify([n,d]);
    const g = gcd(Math.abs(n), Math.abs(d));
    steps.push(`\\text{Simplify by } \\gcd(|${n}|,|${d}|)=${g}:\\quad \\dfrac{${n}}{${d}}=\\dfrac{${sn}}{${sd}}`);
    return {result:[sn,sd], steps, viewA: texMixed(a), viewB: texMixed(b)};
  }

  // --- DOM helpers ---
  function $(sel){ return document.querySelector(sel); }
  function setText(sel, txt){ const el=$(sel); if(el){ el.textContent = txt; } }
  function showError(id, msg){ const el = $('#'+id); if(el){ el.textContent = msg||''; } }
  function toggle(el){ const expanded = el.getAttribute('aria-expanded')==='true'; el.setAttribute('aria-expanded', String(!expanded)); const panel = document.getElementById(el.getAttribute('aria-controls')); if(panel){ panel.hidden = expanded; } }

  document.addEventListener('DOMContentLoaded', () => {
    const elA = $('#inputA'), elB = $('#inputB'), elOp = $('#operator');
    const errA = $('#errA'), errB = $('#errB'), errOp = $('#errOp');
    const btnCalc = $('#btn-calc'), btnClear = $('#btn-clear');
    const tipABtn = $('#tipA-btn'), tipBBtn = $('#tipB-btn');

    // Tooltip toggles
    tipABtn.addEventListener('click', e => toggle(tipABtn));
    tipBBtn.addEventListener('click', e => toggle(tipBBtn));

    // Inline validation on blur
    function validate(el, errEl){
      const val = el.value.trim();
      if(!val){ errEl.textContent = 'This field is required. Enter an integer (e.g., 5), fraction (e.g., 3/4), or mixed number (e.g., 2 1/3).'; return false; }
      const p = parseFraction(val);
      if(!p){ errEl.textContent = 'Invalid format. Use integer, a/b, or w a/b. Example: -1 3/5'; return false; }
      if (p[1] === 0){ errEl.textContent = 'Denominator cannot be zero.'; return false; }
      errEl.textContent = '';
      return true;
    }
    elA.addEventListener('blur', ()=>validate(elA, errA));
    elB.addEventListener('blur', ()=>validate(elB, errB));
    elOp.addEventListener('blur', ()=>{ errOp.textContent = elOp.value ? '' : 'Choose an operation.'; });

    // Copy handlers
    document.body.addEventListener('click', (e)=>{
      const t = e.target;
      if (t && t.matches('[data-copy]')) {
        const sel = t.getAttribute('data-copy');
        const txt = document.querySelector(sel)?.textContent?.trim();
        if (txt && txt !== '—') {
          navigator.clipboard.writeText(txt).then(()=>{
            t.textContent = 'Copied!';
            setTimeout(()=>{ t.textContent = 'Copy'; }, 1200);
          });
        }
      }
    });

    function renderResults(frac, steps) {
      const [n,d] = frac;
      // Improper simplified
      setText('#res-improper', `${n}/${d}`);
      // Mixed
      const [w, r, den] = toMixed([n,d]);
      let mixed;
      if (r===0) mixed = `${w}`;
      else {
        const sign = w<0 ? '-' : '';
        const aw = Math.abs(w);
        mixed = `${sign}${aw>0?aw+' ':''}${r}/${den}`;
      }
      setText('#res-mixed', mixed);
      // Decimal
      const decVal = (n/d).toString();
      setText('#res-decimal', Number.isFinite(n/d) ? (n/d).toFixed(10).replace(/\.?0+$/,'') : '—');

      // Steps (TeX)
      const texLines = steps.map(s=>`\\[ ${s} \\]`).join('\n');
      const el = document.getElementById('steps-tex');
      el.textContent = ''; // clear
      el.innerHTML = texLines || '—';
      // Typeset LaTeX
      if (window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise([el]);
    }

    btnCalc.addEventListener('click', ()=>{
      const okA = validate(elA, errA);
      const okB = validate(elB, errB);
      if (!elOp.value) { errOp.textContent = 'Choose an operation.'; }
      if (!(okA && okB && elOp.value)) return;

      const a = parseFraction(elA.value.trim());
      const b = parseFraction(elB.value.trim());
      try {
        const {result, steps, viewA, viewB} = opFrac(a, b, elOp.value);
        // Prepend mixed conversion if applicable
        const toImpNote = (s, parsed) => {
          // If user provided mixed pattern, show conversion step
          if (/^\s*-?\d+\s+\d+\s*\/\s*\d+\s*$/.test(s)) {
            const [n,d] = parsed;
            return `\\text{Convert mixed to improper: } ${s.replace(/\s+/g,'\\ ')} = \\dfrac{${n}}{${d}}`;
          }
          return null;
        };
        const extraA = toImpNote(elA.value, a);
        const extraB = toImpNote(elB.value, b);
        const allSteps = [
          ...(extraA ? [extraA] : []),
          ...(extraB ? [extraB] : []),
          ...steps
        ];
        renderResults(result, allSteps);
      } catch (err) {
        if ((elOp.value === '/') && parseFraction(elB.value)?.[0] === 0) {
          errB.textContent = 'Division by zero is undefined. Enter a non-zero fraction for B.';
        } else {
          errB.textContent = (''+err.message) || 'An error occurred.';
        }
      }
    });

    btnClear.addEventListener('click', ()=>{
      elA.value = '';
      elB.value = '';
      errA.textContent = '';
      errB.textContent = '';
      errOp.textContent = '';
      setText('#res-improper','—');
      setText('#res-mixed','—');
      setText('#res-decimal','—');
      const el = document.getElementById('steps-tex');
      el.innerHTML = 'No steps yet.';
    });
  });
  </script>
</body>
</html>
