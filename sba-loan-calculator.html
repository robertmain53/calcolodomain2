<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SBA Loan Calculator - Calculate 7(a) &amp; 504 Loan Payments</title>
<meta name="description" content="Calculate your SBA 7(a) or 504 loan payment. Our calculator includes SBA guarantee fees for an accurate estimate of your total monthly payment and amortization.">
<link rel="canonical" href="https://calcdomain.com/sba-loan-calculator.html"/>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.prose code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #f3f4f6; padding: 2px 5px; border-radius: 4px; font-size: 0.9em; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1.5rem;
overflow-x:auto; text-align: center;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }
.result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; font-weight: 500; }
.result-card p { font-size: 1.75rem; font-weight: 700; color: #2563eb; }
/* Error Message Styling */
.error-message {
color: #dc2626; /* text-red-600 */
font-size: 0.875rem; /* text-sm */
margin-top: 0.25rem; /* mt-1 */
}
/* WCAG-compliant Focus */
input:focus-visible, select:focus-visible, button:focus-visible {
outline: 3px solid #3b82f6; /* blue-500 */
outline-offset: 1px;
box-shadow: none;
}
/* Accessible Tooltip */
.tooltip-container {
position: relative;
display: inline-block;
}
.tooltip-btn {
background: none;
border: none;
padding: 0 0 0 0.5rem;
cursor: pointer;
color: #6b7280;
}
.tooltip-text {
visibility: hidden;
width: 250px;
background-color: #1f2937; /* gray-800 */
color: #fff;
text-align: left;
border-radius: 6px;
padding: 8px;
position: absolute;
z-index: 10;
bottom: 125%;
left: 50%;
margin-left: -125px; /* Half of width */
opacity: 0;
transition: opacity 0.3s;
font-size: 0.875rem;
font-weight: 400;
line-height: 1.5;
}
.tooltip-text::after {
content: "";
position: absolute;
top: 100%;
left: 50%;
margin-left: -5px;
border-width: 5px;
border-style: solid;
border-color: #1f2937 transparent transparent transparent;
}
.tooltip-btn:focus + .tooltip-text,
.tooltip-btn:hover + .tooltip-text,
.tooltip-text:hover {
visibility: visible;
opacity: 1;
}
/* Print Styles */
@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
#results-chart-container { display: none !important; }
aside, header, footer { display: none !imgortant; }
}
</style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "SBA Loan Calculator - Calculate 7(a) & 504 Loan Payments",
  "description": "Calculate your SBA 7(a) or 504 loan payment. Our calculator includes SBA guarantee fees for an accurate estimate of your total monthly payment and amortization.",
  "url": "https://calcdomain.com/sba-loan-calculator.html",
  "inLanguage": "en",
  "author": { "@type": "Person", "name": "Ugo Candido" },
  "publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
    { "@type": "ListItem", "position": 2, "name": "Finance", "item": "https://calcdomain.com/finance.html" },
    { "@type": "ListItem", "position": 3, "name": "Business & Small Biz", "item": "https://calcdomain.com/subcategories/business-small-biz.html" },
    { "@type": "ListItem", "position": 4, "name": "SBA Loan Calculator", "item": "https://calcdomain.com/sba-loan-calculator.html" }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Use the SBA Loan Calculator",
  "description": "A step-by-step guide to calculating your estimated SBA loan payments, including guarantee fees.",
  "step": [
    {"@type": "HowToStep", "name": "Enter Loan Details", "text": "Input your desired loan amount, the annual interest rate (APR), and the loan term in years."},
    {"@type": "HowToStep", "name": "Select Loan Type", "text": "Choose between an 'SBA 7(a)' or 'SBA 504' loan, as this affects the guarantee fee calculation."},
    {"@type": "HowToStep", "name": "Review Estimated Fees", "text": "The calculator automatically estimates the SBA Guarantee Fee based on your inputs and adds it to the principal."},
    {"@type": "HowToStep", "name": "Calculate & Analyze", "text": "Review your estimated monthly payment, total interest, and the complete amortization schedule."}
  ]
}
</script>
<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="https://calcdomain.com/index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="https://calcdomain.com/finance.html" class="hover:text-blue-600">Finance</a> &raquo;
<a href="https://calcdomain.com/subcategories/business-small-biz.html" class="hover:text-blue-600">Business & Small Biz</a> &raquo;
<span class="text-gray-900">SBA Loan Calculator</span>
</nav>

<div id="print-section" class="bg-white p-6 rounded-lg shadow-md">

<h1 class="text-3xl font-extrabold text-gray-900 mb-2">SBA Loan Calculator</h1>
<p class="text-gray-600 mb-6">Estimate your monthly payment for an SBA 7(a) or 504 loan. This tool helps small business owners understand the total cost of financing, including principal, interest, and estimated SBA guarantee fees, providing a clear amortization schedule.</p>

<section id="calculator-ui" aria-labelledby="calculator-heading" class="space-y-6">
<h2 id="calculator-heading" class="sr-only">Loan Details Input</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="loanAmount" class="block text-sm font-medium text-gray-700 mb-1">Loan Amount <span class="text-red-600">*</span></label>
<input type="number" id="loanAmount" value="250000" step="1000" min="1"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
aria-required="true" aria-describedby="loanAmount-error">
<div id="loanAmount-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="interestRate" class="block text-sm font-medium text-gray-700 mb-1">Annual Interest Rate (APR %) <span class="text-red-600">*</span></label>
<input type="number" id="interestRate" value="8.5" step="0.01" min="0.01"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
aria-required="true" aria-describedby="interestRate-error">
<div id="interestRate-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="loanTerm" class="block text-sm font-medium text-gray-700 mb-1">Loan Term (Years) <span class="text-red-600">*</span></label>
<input type="number" id="loanTerm" value="10" step="1" min="1"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
aria-required="true" aria-describedby="loanTerm-error">
<div id="loanTerm-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="loanType" class="block text-sm font-medium text-gray-700 mb-1">
SBA Loan Type
<span class="tooltip-container">
<button type="button" class="tooltip-btn" aria-label="About loan types" aria-describedby="loanType-tooltip">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
</svg>
</button>
<span id="loanType-tooltip" class="tooltip-text" role="tooltip">SBA 7(a) loans are for general business needs. 504 loans are for fixed assets (e.g., real estate) and have different fee structures.</span>
</span>
</label>
<select id="loanType"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
<option value="7a" selected>SBA 7(a)</option>
<option value="504">SBA 504</option>
</select>
</div>
<div class="md:col-span-2">
<label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">First Payment Date</label>
<input type="month" id="startDate"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
</div>
</div>
</section>

<section id="results" aria-labelledby="results-heading" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6" style="min-height: 280px;">
<h2 id="results-heading" class="sr-only">Calculation Results</h2>
<div class="flex flex-col md:flex-row gap-6">
<div class="w-full md:w-2/3 grid grid-cols-2 sm:grid-cols-3 gap-4">
<div class="result-card">
<h4>Monthly Payment</h4>
<p id="monthlyPayment">$0.00</p>
</div>
<div class="result-card">
<h4>Est. SBA Guarantee Fee</h4>
<p id="sbaFee">$0.00</p>
</div>
<div class="result-card">
<h4>Total Loan Amount</h4>
<p id="totalLoanAmount">$0.00</p>
</div>
<div class="result-card">
<h4>Total Principal</h4>
<p id="totalPrincipal">$0.00</p>
</div>
<div class="result-card">
<h4>Total Interest</h4>
<p id="totalInterest">$0.00</p>
</div>
<div class="result-card">
<h4>Total Cost</h4>
<p id="totalCost">$0.00</p>
</div>
</div>
<div class="w-full md:w-1/3">
<div id="results-chart-container" class="h-40">
<canvas id="resultsChart" aria-label="Cost breakdown chart (Principal, Interest, Fees)"></canvas>
</div>
</div>
</div>

<details class="mt-6 bg-white rounded-lg" id="scheduleDetails">
<summary class="font-semibold text-gray-800 p-4">View Amortization Schedule</summary>
<div class="overflow-x-auto border-t border-gray-200 rounded-b-lg" id="scheduleContainer">
<table class="min-w-full text-sm text-right">
<thead class="bg-gray-100 text-gray-700 uppercase">
<tr>
<th scope="col" class="px-4 py-2 text-left">#</th>
<th scope="col" class="px-4 py-2 text-left">Date</th>
<th scope="col" class="px-4 py-2">Payment</th>
<th scope="col" class="px-4 py-2">Interest</th>
<th scope="col" class="px-4 py-2">Principal</th>
<th scope="col" class="px-4 py-2">Balance</th>
</tr>
</thead>
<tbody id="scheduleBody"></tbody>
</table>
</div>
</details>
</section>
</div>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
<section aria-labelledby="methodology-heading">
<h2 id="methodology-heading">Data Source and Methodology</h2>
<p>
<strong>Authoritative Data Source:</strong> U.S. Small Business Administration (SBA), "SBA Loan Guaranty Program: Fees & Rates".<br/>
<strong>Reference:</strong> FY 2024 SBA 7(a) & 504 Loan Guaranty Fees.<br/>
<strong>Source Link:</strong> <a href="https://www.sba.gov/partners/lenders/7a-loan-program/fees-rates" target="_blank" rel="noopener nofollow">SBA.gov Fees & Rates</a>
</p>
<p>All calculations for loan amortization and estimated guarantee fees are based strictly on the formulas and tiered fee structures published by this source. This calculator uses the standard amortization formula and applies SBA-published fee percentages based on loan type and amount.</p>
</section>

<hr class="my-6">

<section aria-labelledby="formula-heading">
<h2 id="formula-heading">The Formulas Explained</h2>
<p>The monthly payment (M) is calculated using the standard loan amortization formula. The <strong>SBA Guarantee Fee</strong> is calculated first (based on a tiered structure) and added to the principal to determine the <strong>Total Loan Amount</strong> (P).</p>
<div class="formula-box">
$$ M = P \frac{r(1+r)^n}{(1+r)^n - 1} $$
</div>
</section>

<section aria-labelledby="glossary-heading">
<h2 id="glossary-heading">Glossary of Terms</h2>
<ul>
<li><strong>Loan Amount (Principal):</strong> The initial capital you are borrowing, before fees.</li>
<li><strong>Annual Interest Rate (APR):</strong> The yearly interest rate charged by the lender.</li>
<li><strong>Loan Term:</strong> The total time (in years) you have to repay the loan.</li>
<li><strong>SBA Loan Type:</strong> The specific SBA program (7(a) or 504). This determines the guarantee fee structure.</li>
<li><strong>Est. SBA Guarantee Fee:</strong> A mandatory fee paid to the SBA, which protects the lender against default. This calculator assumes the fee is financed (rolled into the loan).</li>
<li><strong>Total Loan Amount:</strong> The sum of the initial principal and the financed SBA Guarantee Fee. This is the amount used for the amortization calculation.</li>
<li><strong>Monthly Payment:</strong> The fixed amount you will pay each month, covering both interest and principal.</li>
<li><strong>Total Interest:</strong> The sum of all interest payments over the entire life of the loan.</li>
</ul>
</section>

<hr class="my-6">

<section aria-labelledby="example-heading">
<h2 id="example-heading">How It Works: A Step-by-Step Example</h2>
<p>Let's say you need a <strong>$250,000</strong> SBA 7(a) loan for <strong>10 years</strong> at <strong>8.5% APR</strong>.</p>
<ol>
<li><strong>Calculate SBA Fee:</strong> Based on current SBA 7(a) rules, a loan of $250,000 falls into a 3.0% fee tier (for loans $150,001 - $700,000).<br>
<code>Fee = $250,000 * 0.030 = $7,500</code></li>
<li><strong>Determine Total Loan Amount (P):</strong> This fee is typically financed.
<code>P = $250,000 (Principal) + $7,500 (Fee) = $257,500</code></li>
<li><strong>Find Monthly Rate (r) and Term (n):</strong>
<code>r = 8.5% / 12 months = 0.007083</code>
<code>n = 10 years * 12 months = 120 payments</code></li>
<li><strong>Calculate Monthly Payment (M):</strong> Using the formula with P = $257,500, r = 0.007083, and n = 120, the monthly payment is:
<code>M = $3,263.15</code></li>
</ol>
<p>Your total cost will be <code>$3,263.15 * 120 = $391,578</code>, which includes the $250,000 principal, the $7,500 SBA fee, and $134,078 in total interest.</p>
</section>

<hr class="my-6">

<section aria-labelledby="faq-heading">
<h2 id="faq-heading">Frequently Asked Questions</h2>
<details>
<summary>What is the SBA Guarantee Fee?</summary>
<p>The SBA Guarantee Fee is a charge levied by the Small Business Administration. It's paid by the lender and typically passed on to the borrower (often by financing it into the loan). This fee compensates the SBA for the risk it takes by guaranteeing a portion of the loan, which is what encourages lenders to provide favorable terms to small businesses.</p>
</details>
<details>
<summary>Is the SBA fee always financed?</summary>
<p>While it is most commonly financed (rolled into the total loan amount), borrowers can sometimes opt to pay the guarantee fee in cash at closing. This calculator assumes the fee is financed, which is the standard scenario for payment calculation. Paying it in cash would lower your monthly payment.</p>
</details>
<details>
<summary>What's the main difference between an SBA 7(a) and 504 loan?</summary>
<p>A <strong>7(a) loan</strong> is the most common and flexible type, usable for a wide range of business purposes, including working capital, refinancing debt, or purchasing inventory. A <strong>504 loan</strong> is specifically designed for fixed-asset purchases, such as real estate or large equipment, and has a different structure (involving a bank and a Certified Development Company, or CDC).</p>
</details>
<details>
<summary>Does this calculator include bank origination fees?</summary>
<p>No. This calculator estimates the <strong>SBA Guarantee Fee</strong> only. Your lender may have additional one-time costs, such as loan packaging fees, origination fees, or closing costs. You should request a full loan estimate from your lender for a complete picture of all costs.</p>
</details>
<details>
<summary>What is the maximum SBA loan amount?</summary>
<p>For the 7(a) program, the maximum loan amount is $5 million. For the 504 program, the maximum typically ranges from $5 million to $5.5 million for the 504 portion of the loan, depending on the project type.</p>
</details>
<details>
<summary>Why is my interest rate variable?</summary>
<p>Many SBA loans, especially 7(a) loans, have variable interest rates tied to a benchmark like the Prime Rate. This calculator uses a fixed rate for estimation. If your loan is variable, your monthly payment will change if the benchmark rate changes.</p>
</details>
</section>

<div class="mt-8 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Finance content reviewed by the CalcDomain Editorial Board.<br>
Last accuracy review: <time datetime="2025-10-20">October 20, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-6 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>Accurately estimate <strong>SBA Guarantee Fees</strong> for 7(a) and 504 loans.</li>
<li>See the true total loan amount, including financed fees.</li>
<li>Instantly view a full amortization schedule.</li>
<li>Compare total interest and principal costs for different loan scenarios.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Business Tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="loan-amortization.html" class="text-blue-600 hover:underline">General Loan Amortization</a></li>
<li><a href="business-loan-calculator.html" class="text-blue-600 hover:underline">Business Loan Calculator</a></li>
<li><a href="working-capital.html" class="text-blue-600 hover:underline">Working Capital Calculator</a></li>
<li><a href="commercial-mortgage.html" class="text-blue-600 hover:underline">Commercial Mortgage Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t mt-12">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="about.html" class="hover:text-blue-600">About</a>
<a href="contact.html" class="hover:text-blue-600">Contact</a>
<a href="privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<script defer>
document.addEventListener('DOMContentLoaded', () => {
const elements = {
loanAmount: document.getElementById('loanAmount'),
interestRate: document.getElementById('interestRate'),
loanTerm: document.getElementById('loanTerm'),
loanType: document.getElementById('loanType'),
startDate: document.getElementById('startDate'),
monthlyPayment: document.getElementById('monthlyPayment'),
sbaFee: document.getElementById('sbaFee'),
totalLoanAmount: document.getElementById('totalLoanAmount'),
totalPrincipal: document.getElementById('totalPrincipal'),
totalInterest: document.getElementById('totalInterest'),
totalCost: document.getElementById('totalCost'),
scheduleBody: document.getElementById('scheduleBody')
};

const errorMessages = {
loanAmount: document.getElementById('loanAmount-error'),
interestRate: document.getElementById('interestRate-error'),
loanTerm: document.getElementById('loanTerm-error')
};

let chartInstance = null;
const fmtCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val || 0);
const fmtDate = (date) => new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'short' }).format(date);

function validateField(inputEl, errorEl) {
let isValid = true;
let message = '';
const val = parseFloat(inputEl.value);

if (isNaN(val) || val <= 0) {
isValid = false;
message = 'Please enter a positive value.';
}

errorEl.textContent = message;
inputEl.setAttribute('aria-invalid', !isValid);
return isValid;
}

function calculateSbaFee(principal, loanType) {
if (loanType === '504') {
// Simplified 0.5% CDC + 0.25% SBA fee (approx)
return principal * 0.0075; 
}

// Default to 7(a) fee structure (FY2024 rates, simplified)
if (principal <= 150000) {
return principal * 0.02; // 2.0%
}
if (principal <= 700000) {
return principal * 0.03; // 3.0%
}
if (principal <= 5000000) {
return principal * 0.035; // 3.5%
}
return principal * 0.0375; // 3.75% for loans > $5M
}

function calculateSchedule() {
let isValid = true;
isValid = validateField(elements.loanAmount, errorMessages.loanAmount) && isValid;
isValid = validateField(elements.interestRate, errorMessages.interestRate) && isValid;
isValid = validateField(elements.loanTerm, errorMessages.loanTerm) && isValid;

if (!isValid) {
updateOutputs(0, 0, 0, 0, 0, 0, []);
return;
}

const principal = parseFloat(elements.loanAmount.value);
const apr = parseFloat(elements.interestRate.value) / 100;
const termYears = parseFloat(elements.loanTerm.value);
const loanType = elements.loanType.value;

const fee = calculateSbaFee(principal, loanType);
const totalLoan = principal + fee;
const monthlyRate = apr / 12;
const numberOfPayments = termYears * 12;

if (principal <= 0 || apr <= 0 || termYears <= 0) {
updateOutputs(0, 0, 0, 0, 0, 0, []);
return;
}

const monthlyPayment = (totalLoan * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments))) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
const totalCost = monthlyPayment * numberOfPayments;
const totalInterest = totalCost - totalLoan;

const schedule = [];
let balance = totalLoan;
const start = elements.startDate.value ? new Date(elements.startDate.value + '-02T00:00:00') : new Date();

for (let i = 1; i <= numberOfPayments; i++) {
const interestPayment = balance * monthlyRate;
const principalPayment = monthlyPayment - interestPayment;
balance -= principalPayment;

const paymentDate = new Date(start);
paymentDate.setMonth(start.getMonth() + i - 1);

schedule.push({
period: i,
date: paymentDate,
payment: monthlyPayment,
interest: interestPayment,
principal: principalPayment,
balance: Math.max(0, balance)
});
}

updateOutputs(monthlyPayment, fee, totalLoan, principal, totalInterest, totalCost, schedule);
}

function updateOutputs(monthly, fee, totalLoan, principal, interest, totalCost, schedule) {
elements.monthlyPayment.textContent = fmtCurrency(monthly);
elements.sbaFee.textContent = fmtCurrency(fee);
elements.totalLoanAmount.textContent = fmtCurrency(totalLoan);
elements.totalPrincipal.textContent = fmtCurrency(principal);
elements.totalInterest.textContent = fmtCurrency(interest);
elements.totalCost.textContent = fmtCurrency(totalCost);
renderSchedule(schedule);
renderChart(principal, interest, fee);
}

function renderSchedule(schedule) {
const tbody = elements.scheduleBody;
tbody.innerHTML = '';
if (!schedule.length) return;

schedule.forEach(row => {
const tr = document.createElement('tr');
tr.className = 'border-t border-gray-200';
tr.innerHTML = `
<td class="px-4 py-2 text-left">${row.period}</td>
<td class="px-4 py-2 text-left">${fmtDate(row.date)}</td>
<td class="px-4 py-2">${fmtCurrency(row.payment)}</td>
<td class="px-4 py-2 text-red-600">${fmtCurrency(row.interest)}</td>
<td class="px-4 py-2 text-green-600">${fmtCurrency(row.principal)}</td>
<td class="px-4 py-2 font-medium">${fmtCurrency(row.balance)}</td>`;
tbody.appendChild(tr);
});
}

function renderChart(principal, interest, fee) {
const ctx = document.getElementById('resultsChart');
if (!ctx) return;

const data = {
labels: ['Principal', 'Total Interest', 'SBA Fee'],
datasets: [{
data: [Math.max(0, principal), Math.max(0, interest), Math.max(0, fee)],
backgroundColor: ['#2563eb', '#f97316', '#6b7280'] // Blue, Orange, Gray
}]
};

if (chartInstance) {
chartInstance.data = data;
chartInstance.update();
} else {
chartInstance = new Chart(ctx, {
type: 'doughnut',
data,
options: {
plugins: { 
legend: { 
display: true,
position: 'bottom',
labels: {
boxWidth: 12,
padding: 15,
font: { size: 10 }
}
} 
},
responsive: true,
maintainAspectRatio: false,
cutout: '60%'
}
});
}
}

// Attach event listeners
['loanAmount', 'interestRate', 'loanTerm', 'loanType', 'startDate'].forEach(id => {
elements[id]?.addEventListener('input', calculateSchedule);
});

['loanAmount', 'interestRate', 'loanTerm'].forEach(id => {
elements[id]?.addEventListener('blur', () => validateField(elements[id], errorMessages[id]));
});

// Mobile menu script from template
document.getElementById('mobile-menu-toggle')?.addEventListener('click', () => {
document.getElementById('mobile-menu')?.classList.toggle('hidden');
});

// Initial calculation on page load
calculateSchedule();
});
</script>
</body>
</html>