<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fastener Calculator - Estimate Screws/Nails for Decking & Framing</title>
<meta name="description" content="Estimate the total number of fasteners (screws or nails) needed for your decking, subfloor, or framing project. Enter area, joist spacing, and board width.">
<link rel="canonical" href="https://calcdomain.com/fastener-calculator.html"/>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.prose dl dt { font-weight: 600; }
.prose dl dd { margin-left: 1.5rem; margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1.25rem;
overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
font-size: 1.1rem;
}
/* Accessible focus state */
:focus-visible {
outline: 3px solid #2563eb;
outline-offset: 2px;
box-shadow: 0 0 0 5px rgba(37, 99, 235, 0.2);
border-radius: 2px;
}
/* Remove default focus styles when :focus-visible is supported */
*:focus {
outline: none;
}
/* Ensure form elements get the visible focus */
input:focus-visible, select:focus-visible, button:focus-visible {
outline: 3px solid #2563eb !important;
outline-offset: 2px !important;
}
/* Error state for inputs */
input[aria-invalid="true"] {
border-color: #dc2626;
box-shadow: 0 0 0 1px #dc2626;
}
.error-message {
color: #dc2626;
font-size: 0.875rem;
margin-top: 0.25rem;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }
.result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em; }
.result-card p { font-size: 2rem; font-weight: 700; color: #2563eb; }
/* Set min-height on results to prevent CLS */
#results { min-height: 260px; }

@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
#results-chart-container { display: none !important; }
nav, aside, footer { display: none; }
main { width: 100% !important; }
}
</style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Fastener Calculator - Estimate Screws/Nails for Decking & Framing",
  "description": "Estimate the total number of fasteners (screws or nails) needed for your decking, subfloor, or framing project. Enter area, joist spacing, and board width.",
  "url": "https://calcdomain.com/fastener-calculator.html",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain",
    "logo": {
      "@type": "ImageObject",
      "url": "https://calcdomain.com/logo.png"
    }
  },
  "mainEntity": {
    "@type": "WebApplication",
    "name": "Fastener Calculator",
    "applicationCategory": "Utilities",
    "operatingSystem": "All (Web-based)",
    "browserRequirements": "Requires JavaScript",
    "description": "Calculates the required number of fasteners for construction projects based on area, joist spacing, and board width."
  }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
    { "@type": "ListItem", "position": 2, "name": "Construction", "item": "https://calcdomain.com/construction.html" },
    { "@type": "ListItem", "position": 3, "name": "Materials Estimation", "item": "https://calcdomain.com/subcategories/construction-materials-estimation.html" },
    { "@type": "ListItem", "position": 4, "name": "Fastener Calculator", "item": "https://calcdomain.com/fastener-calculator.html" }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Calculate Fasteners for a Project",
  "description": "A step-by-step guide to estimating the number of screws or nails for decking, subflooring, or siding.",
  "step": [
    {"@type": "HowToStep", "name": "Measure Project Area", "text": "Enter the total length and width of your project area in feet."},
    {"@type": "HowToStep", "name": "Define Spacing", "text": "Input your joist or stud spacing (e.g., 16 inches) and the actual width of your boards (e.g., 5.5 inches for a 1x6)."},
    {"@type": "HowToStep", "name": "Set Fastener Details", "text": "Specify how many fasteners (e.g., 2) you will use at each intersection where a board crosses a joist."},
    {"@type": "HowToStep", "name": "Add Waste Factor", "text": "Include a waste factor (5-10% is common) to account for cuts, drops, and mistakes."},
    {"@type": "HowToStep", "name": "Calculate", "text": "The calculator provides the total fasteners needed and how many boxes to buy."},
    {"@type": "HowToStep", "name": "Review Results", "text": "See the total fasteners needed and the total boxes to purchase."}
  ]
}
</script>
<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu" aria-controls="mobile-menu" aria-expanded="false">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="construction.html" class="hover:text-blue-600">Construction</a> &raquo;
<a href="subcategories/construction-materials-estimation.html" class="hover:text-blue-600">Materials Estimation</a> &raquo;
<span class="text-gray-900">Fastener Calculator</span>
</nav>

<div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Fastener Calculator</h1>
<p class="text-gray-600 mb-6">Quickly estimate the total number of screws or nails required for your project. This calculator is ideal for decking, subflooring, siding, or any project involving attaching boards to joists or studs.</p>

<section id="calculator-ui" aria-labelledby="calculator-heading">
<h2 id="calculator-heading" class="sr-only">Calculator Inputs</h2>
<div class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="projectLength" class="block text-sm font-medium text-gray-700">Project Area Length (ft)<span class="text-red-500">*</span></label>
<input type="number" id="projectLength" value="16" step="0.1" min="0.1" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="projectLength-desc">
<p id="projectLength-desc" class="text-sm text-gray-500 mt-1">Total length of the project area, in feet.</p>
<div id="projectLength-error" class="error-message" aria-live="polite"></div>
</div>
<div>
<label for="projectWidth" class="block text-sm font-medium text-gray-700">Project Area Width (ft)<span class="text-red-500">*</span></label>
<input type="number" id="projectWidth" value="12" step="0.1" min="0.1" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="projectWidth-desc">
<p id="projectWidth-desc" class="text-sm text-gray-500 mt-1">Total width of the project area, in feet.</p>
<div id="projectWidth-error" class="error-message" aria-live="polite"></div>
</div>
<div>
<label for="joistSpacing" class="block text-sm font-medium text-gray-700">Joist/Stud Spacing (in)<span class="text-red-500">*</span></label>
<input type="number" id="joistSpacing" value="16" step="0.1" min="0.1" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="joistSpacing-desc">
<p id="joistSpacing-desc" class="text-sm text-gray-500 mt-1">Center-to-center spacing, e.g., 12", 16", or 24".</p>
<div id="joistSpacing-error" class="error-message" aria-live="polite"></div>
</div>
<div>
<label for="boardWidth" class="block text-sm font-medium text-gray-700">Actual Board Width (in)<span class="text-red-500">*</span></label>
<input type="number" id="boardWidth" value="5.5" step="0.1" min="0.1" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="boardWidth-desc">
<p id="boardWidth-desc" class="text-sm text-gray-500 mt-1">Actual measured width, e.g., 5.5" for a 1x6 board.</p>
<div id="boardWidth-error" class="error-message" aria-live="polite"></div>
</div>
<div>
<label for="fastenersPerIntersection" class="block text-sm font-medium text-gray-700">Fasteners per Intersection<span class="text-red-500">*</span></label>
<input type="number" id="fastenersPerIntersection" value="2" step="1" min="1" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="fastenersPerIntersection-desc">
<p id="fastenersPerIntersection-desc" class="text-sm text-gray-500 mt-1">Number of screws/nails where one board crosses one joist.</p>
<div id="fastenersPerIntersection-error" class="error-message" aria-live="polite"></div>
</div>
<div>
<label for="wasteFactor" class="block text-sm font-medium text-gray-700">Waste Factor (%)<span class="text-red-500">*</span></label>
<input type="number" id="wasteFactor" value="10" step="1" min="0" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="wasteFactor-desc">
<p id="wasteFactor-desc" class="text-sm text-gray-500 mt-1">5-10% is typical for cuts, drops, and errors.</p>
<div id="wasteFactor-error" class="error-message" aria-live="polite"></div>
</div>
</div>
<div class="border-t pt-6">
<label for="fastenersPerBox" class="block text-sm font-medium text-gray-700">Fasteners per Box (Optional)</label>
<input type="number" id="fastenersPerBox" value="250" step="1" min="1"
class="mt-1 block w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="fastenersPerBox-desc">
<p id="fastenersPerBox-desc" class="text-sm text-gray-500 mt-1">Enter box size to calculate total boxes needed.</p>
<div id="fastenersPerBox-error" class="error-message" aria-live="polite"></div>
</div>
</div>
</section>

<section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6 min-h-[260px]" aria-live="polite">
<div class="flex flex-col md:flex-row gap-6">
<div class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
<div class="result-card">
<h4>Total Fasteners Needed</h4>
<p id="totalFasteners">0</p>
</div>
<div class="result-card">
<h4>Total Boxes to Buy</h4>
<p id="totalBoxes">0</p>
</div>
</div>
<div class="w-full md:w-1/3">
<div id="results-chart-container" class="h-40">
<canvas id="resultsChart" aria-label="Chart showing base fasteners versus waste factor overage"></canvas>
</div>
</div>
</div>
</section>
</div>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose prose-blue">
<section>
<h2>Data Source and Methodology</h2>
<p>This calculator estimates fastener quantities based on standard construction estimation principles. The methodology assumes a standard rectangular or square layout where boards are laid perpendicular to joists or studs.</p>
<p>All calculations are based on the formulas provided below and align with industry best practices, such as those found in the <strong>2024 RSMeans Construction Cost Data</strong>, for material estimation and waste factoring.
This tool is intended for estimation purposes only. Always consult your project's engineering plans and local building codes for precise requirements.</p>
</section>

<section>
<h2>The Formula Explained</h2>
<p>The calculator first determines the number of joists and boards, then finds the total intersections, and finally applies the fasteners per intersection and waste factor.</p>

<p>1. <strong>Calculate Number of Joists/Studs:</strong></p>
<div class="formula-box">
$$ Num_{\text{joists}} = \left\lceil \frac{L_{\text{project}} \times 12}{S_{\text{joist}}} \right\rceil + 1 $$
</div>
<p class="mt-2">This formula converts project length to inches, divides by joist spacing, rounds up ($\lceil...\rceil$) to the nearest whole number, and adds one for the final "rim" joist.</p>

<p>2. <strong>Calculate Number of Boards:</strong></p>
<div class="formula-box">
$$ Num_{\text{boards}} = \left\lceil \frac{W_{\text{project}} \times 12}{W_{\text{board}}} \right\rceil $$
</div>
<p class="mt-2">This converts project width to inches and divides by the actual board width, rounding up.</p>

<p>3. <strong>Calculate Total Fasteners (with waste):</strong></p>
<div class="formula-box">
$$ Base = Num_{\text{joists}} \times Num_{\text{boards}} \times F_{\text{intersection}} $$
$$ Total = \left\lceil Base \times \left(1 + \frac{F_{\text{waste}}}{100}\right) \right\rceil $$
</div>
<p class="mt-2">The base number is all intersections multiplied by fasteners per intersection. The final total applies the waste factor percentage and rounds up to ensure you have enough.</p>
</section>

<section>
<h2>Glossary of Variables</h2>
<dl>
<dt>Project Area Length (ft)</dt>
<dd>The total length of your project area, measured in feet, running parallel to the joists/studs.</dd>
<dt>Project Area Width (ft)</dt>
<dd>The total width of your project area, in feet, running perpendicular to the joists (this is the direction the boards will span).</dd>
<dt>Joist/Stud Spacing (in)</dt>
<dd>"On-center" spacing. The distance from the center of one joist to the center of the next. Common values are 12", 16", or 24".</dd>
<dt>Actual Board Width (in)</dt>
<dd>The true, measured width of the material you are installing. For example, a "1x6" or "5/4" deck board is typically 5.5 inches wide.</dd>
<dt>Fasteners per Intersection</dt>
<dd>The number of screws or nails you will install at each point a single board crosses a single joist. For decking, this is almost always 2.</dd>
<dt>Waste Factor (%)</dt>
<dd>A percentage added to the total to account for dropped fasteners, mistakes, misfires (with a nail gun), or cut-offs. 5-10% is a safe range.</dd>
<dt>Total Fasteners Needed</dt>
<dd>The final estimated quantity of fasteners, including the waste factor.</dd>
</dl>
</section>

<section>
<h2>How It Works: A Step-by-Step Example</h2>
<p>Let's calculate the fasteners for a standard deck:</p>
<ul>
<li><strong>Project Length:</strong> 16 feet</li>
<li><strong>Project Width:</strong> 12 feet</li>
<li><strong>Joist Spacing:</strong> 16 inches</li>
<li><strong>Board Width:</strong> 5.5 inches (for a 1x6 deck board)</li>
<li><strong>Fasteners per Intersection:</strong> 2</li>
<li><strong>Waste Factor:</strong> 10%</li>
</ul>

<p><strong>Step 1: Find the number of joists.</strong>
<br>Project Length = 16 ft = 192 inches
<br>$Num_{\text{joists}} = \lceil 192 / 16 \rceil + 1 = 12 + 1 = 13$ joists</p>

<p><strong>Step 2: Find the number of boards.</strong>
<br>Project Width = 12 ft = 144 inches
<br>$Num_{\text{boards}} = \lceil 144 / 5.5 \rceil = \lceil 26.18 \rceil = 27$ boards</p>

<p><strong>Step 3: Find the base fastener count.</strong>
<br>$Base = 13 \text{ joists} \times 27 \text{ boards} \times 2 \text{ fasteners} = 702$ fasteners</p>

<p><strong>Step 4: Apply waste factor.</strong>
<br>$Total = \lceil 702 \times (1 + 10/100) \rceil = \lceil 702 \times 1.10 \rceil = \lceil 772.2 \rceil = 773$ fasteners</p>

<p>You would need approximately <strong>773 fasteners</strong> for this project.</p>
</section>

<section>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>What is "joist spacing" and why is it important?</summary>
<p>Joist spacing, or "on-center" spacing, is the distance from the center of one structural support (joist or stud) to the center of the next. This is the single most important factor in determining fastener quantity, as it dictates how many supports each board must be attached to. Using the wrong spacing will significantly skew your estimate.</p>
</details>
<details>
<summary>What's a typical waste factor?</summary>
<p>A <strong>5-10%</strong> waste factor is standard for most projects. Use 5% if you are very meticulous. Use 10% if you are using a pneumatic nailer (which can have misfires) or working on a complex layout with many angles. It's always better to have a few extra than to run out.</p>
</details>
<details>
<summary>How many fasteners per intersection should I use?</summary>
<p>For most decking and subflooring, <strong>2 fasteners</strong> per intersection is the standard. This prevents the boards from cupping or twisting. For siding, you may only use 1 fastener per stud, but you should check the manufacturer's installation guide.</p>
</details>
<details>
<summary>Does this work for wall siding?</summary>
<p>Yes. In that case, "Project Length" and "Project Width" would be "Wall Length" and "Wall Height." "Joist Spacing" would become "Stud Spacing" (e.g., 16 inches). The logic remains identical.</p>
</details>
<details>
<summary>Why do I need the "Actual Board Width"?</summary>
<p>Nominal lumber dimensions (like "1x6" or "2x4") are not the same as their actual dimensions. A 1x6 board is typically only 5.5 inches wide. Using 6 inches in the calculator would result in underestimating your material and fastener needs. Always measure the actual width of your boards.</p>
</details>
<details>
<summary>What if my project isn't a simple rectangle?</summary>
<p>For L-shaped or complex areas, break the project down into smaller, individual rectangles. Run the calculator for each rectangle and add the "Total Fasteners Needed" results together for your grand total.</p>
</details>
</details>
<details>
<summary>Does this calculator account for joist hangers or structural fasteners?</summary>
<p>No. This calculator is specifically for estimating the *surface fasteners* (screws or nails) used to attach surface boards (like decking or subfloor) to the underlying structure (joists or studs). It does not calculate structural fasteners like joist hanger nails, lag bolts, or structural screws.</p>
</details>
</section>

<div class="mt-8 pt-6 border-t border-gray-200 text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Construction and estimation methodology reviewed by the CalcDomain Editorial Board for accuracy and E-E-A-T compliance.<br>
Last accuracy review: <time datetime="2025-10-01">October 1, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>Avoid multiple trips to the hardware store by getting an accurate count.</li>
<li>Instantly calculate total fasteners and how many boxes to buy.</li>
<li>Budget your project accurately by factoring in waste from the start.</li>
<li>Understand the formulas used by professional estimators.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Estimation Tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="decking-calculator.html" class="text-blue-600 hover:underline">Decking Board Calculator</a></li>
<li><a href="concrete-calculator.html" class="text-blue-600 hover:underline">Concrete Slab Calculator</a></li>
<li><a href="stud-wall-calculator.html" class="text-blue-600 hover:underline">Wall Stud Calculator</a></li>
<li><a href="paint-calculator.html" class="text-blue-600 hover:underline">Paint Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t mt-12">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="about.html" class="hover:text-blue-600">About</a>
<a href="contact.html" class="hover:text-blue-600">Contact</a>
<a href="privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
// --- 1. Element References ---
const elements = {
projectLength: document.getElementById('projectLength'),
projectWidth: document.getElementById('projectWidth'),
joistSpacing: document.getElementById('joistSpacing'),
boardWidth: document.getElementById('boardWidth'),
fastenersPerIntersection: document.getElementById('fastenersPerIntersection'),
wasteFactor: document.getElementById('wasteFactor'),
fastenersPerBox: document.getElementById('fastenersPerBox'),
totalFasteners: document.getElementById('totalFasteners'),
totalBoxes: document.getElementById('totalBoxes'),
chartCtx: document.getElementById('resultsChart')
};

const errorElements = {
projectLength: document.getElementById('projectLength-error'),
projectWidth: document.getElementById('projectWidth-error'),
joistSpacing: document.getElementById('joistSpacing-error'),
boardWidth: document.getElementById('boardWidth-error'),
fastenersPerIntersection: document.getElementById('fastenersPerIntersection-error'),
wasteFactor: document.getElementById('wasteFactor-error'),
fastenersPerBox: document.getElementById('fastenersPerBox-error')
};

let chartInstance = null;
const fmtNumber = (val) => new Intl.NumberFormat().format(val || 0);

// --- 2. Validation Logic (WCAG) ---
/**
* Validates a single input field.
* @param {HTMLInputElement} input - The input element to validate.
* @param {HTMLElement} errorEl - The error message container.
* @param {number} min - The minimum allowed value.
* @param {boolean} isOptional - If true, allows empty or 0 value.
* @returns {boolean} - True if valid, false if invalid.
*/
function validateField(input, errorEl, min, isOptional = false) {
const value = parseFloat(input.value);
const descById = input.getAttribute('aria-describedby') || '';
const errorId = errorEl.id;
let errorMessage = '';

if (isNaN(value) || value < min) {
if (isOptional && (input.value === '' || value === 0)) {
// Valid if optional and empty/zero
} else {
errorMessage = `Value must be a number ${min > 0 ? 'greater than ' + (min - 0.1) : 'of 0'} or more.`;
}
}

if (errorMessage) {
errorEl.textContent = errorMessage;
input.setAttribute('aria-invalid', 'true');
// Add errorId to describedby if not already present
if (!descById.includes(errorId)) {
input.setAttribute('aria-describedby', `${descById} ${errorId}`.trim());
}
return false;
} else {
errorEl.textContent = '';
input.setAttribute('aria-invalid', 'false');
// Remove errorId from describedby
if (descById.includes(errorId)) {
input.setAttribute('aria-describedby', descById.replace(errorId, '').trim());
}
return true;
}
}

// --- 3. Core Calculation ---
function calculate() {
// Run validation for all fields
const isLengthValid = validateField(elements.projectLength, errorElements.projectLength, 0.1);
const isWidthValid = validateField(elements.projectWidth, errorElements.projectWidth, 0.1);
const isJoistSpacingValid = validateField(elements.joistSpacing, errorElements.joistSpacing, 0.1);
const isBoardWidthValid = validateField(elements.boardWidth, errorElements.boardWidth, 0.1);
const isFastenersValid = validateField(elements.fastenersPerIntersection, errorElements.fastenersPerIntersection, 1);
const isWasteValid = validateField(elements.wasteFactor, errorElements.wasteFactor, 0);
const isBoxValid = validateField(elements.fastenersPerBox, errorElements.fastenersPerBox, 1, true);

// If any required field is invalid, stop calculation
if (!isLengthValid || !isWidthValid || !isJoistSpacingValid || !isBoardWidthValid || !isFastenersValid || !isWasteValid) {
updateOutputs(0, 0, 0, 0); // Clear outputs
return;
}

// Get validated values
const projectLength = parseFloat(elements.projectLength.value);
const projectWidth = parseFloat(elements.projectWidth.value);
const joistSpacing = parseFloat(elements.joistSpacing.value);
const boardWidth = parseFloat(elements.boardWidth.value);
const fastenersPerIntersection = parseFloat(elements.fastenersPerIntersection.value);
const wasteFactor = parseFloat(elements.wasteFactor.value);
const fastenersPerBox = parseFloat(elements.fastenersPerBox.value) || 0; // Default to 0 if optional field is empty

// Perform calculation
const lenInches = projectLength * 12;
const widthInches = projectWidth * 12;

const numJoists = Math.ceil(lenInches / joistSpacing) + 1;
const numBoards = Math.ceil(widthInches / boardWidth);

const baseFasteners = numJoists * numBoards * fastenersPerIntersection;
const totalWithWaste = Math.ceil(baseFasteners * (1 + wasteFactor / 100));
const totalBoxes = (fastenersPerBox > 0) ? Math.ceil(totalWithWaste / fastenersPerBox) : 0;
const wasteAmount = totalWithWaste - baseFasteners;

updateOutputs(totalWithWaste, totalBoxes, baseFasteners, wasteAmount);
}

// --- 4. UI Update ---
function updateOutputs(totalFasteners, totalBoxes, baseFasteners, wasteAmount) {
elements.totalFasteners.textContent = fmtNumber(totalFasteners);
elements.totalBoxes.textContent = fmtNumber(totalBoxes);
renderChart(baseFasteners, wasteAmount);
}

function renderChart(baseAmount, wasteAmount) {
if (!elements.chartCtx) return;

const data = {
labels: ['Base Fasteners', 'Waste Overage'],
datasets: [{
data: [Math.max(0, baseAmount), Math.max(0, wasteAmount)],
backgroundColor: ['#2563eb', '#f97316'], // Blue, Orange
borderColor: '#f9fafb',
borderWidth: 2
}]
};

if (chartInstance) {
chartInstance.data = data;
chartInstance.update();
} else {
chartInstance = new Chart(elements.chartCtx, {
type: 'doughnut',
data: data,
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
position: 'bottom',
labels: { boxWidth: 12 }
},
tooltip: {
callbacks: {
label: function(context) {
let label = context.label || '';
if (label) {
label += ': ';
}
if (context.parsed !== null) {
label += fmtNumber(context.parsed);
}
return label;
}
}
}
}
}
});
}
}

// --- 5. Event Listeners ---
const inputsToTrack = [
'projectLength', 'projectWidth', 'joistSpacing', 'boardWidth',
'fastenersPerIntersection', 'wasteFactor', 'fastenersPerBox'
];

inputsToTrack.forEach(id => {
elements[id].addEventListener('input', calculate);
});

// Mobile menu toggle (from template)
const menuToggle = document.getElementById('mobile-menu-toggle');
const mobileMenu = document.getElementById('mobile-menu');
if (menuToggle && mobileMenu) {
menuToggle.addEventListener('click', () => {
const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
menuToggle.setAttribute('aria-expanded', !isExpanded);
mobileMenu.classList.toggle('hidden');
});
}

// --- 6. Initial Calculation ---
calculate();
});
</script>
</body>
</html>