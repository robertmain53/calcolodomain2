<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grade Calculator - Calculate Your Weighted &amp; Final Grade</title>
<meta name="description" content="A comprehensive, accessible Grade Calculator to find your current weighted average or determine the final exam score needed to achieve your target grade.">
<link rel="canonical" href="https://calcdomain.com/grade-calculator.html">

<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Stili personalizzati e conformità al template */
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1.5rem;
overflow-x:auto; font-family:monospace; font-size: 1.1rem;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }

/* Stili specifici del calcolatore */
label { display: block; margin-bottom: 0.25rem; font-weight: 500; }
input[type="number"] {
-moz-appearance: textfield; /* Rimuove frecce in Firefox */
}
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
-webkit-appearance: none; /* Rimuove frecce in Chrome/Safari */
margin: 0;
}
/* Stile focus visibile per A11y (WCAG 2.4.7) */
:focus-visible {
outline: 3px solid #3b82f6 !important;
outline-offset: 2px;
}
/* Stile per tab */
[role="tab"] {
padding: 0.75rem 1rem;
border-bottom: 3px solid transparent;
}
[role="tab"][aria-selected="true"] {
border-bottom-color: #2563eb;
color: #1d4ed8;
font-weight: 600;
}
/* Prevenzione CLS (Cumulative Layout Shift) */
#results-container {
min-height: 10rem;
}
/* Messaggi di errore A11y */
.error-message {
color: #dc2626;
font-size: 0.875rem;
margin-top: 0.25rem;
}
/* Dimensioni target tattili (WCAG 2.5.5) */
.btn-calc, .btn-add, .btn-remove {
min-height: 48px;
min-width: 48px;
display: inline-flex;
align-items: center;
justify-content: center;
padding: 0.5rem 1rem;
}
</style>

<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "WebPage",
"name": "Grade Calculator",
"description": "Calculate your weighted grade average or the final exam score needed to achieve a target grade with this accessible, mobile-first tool.",
"url": "https://calcdomain.com/grade-calculator.html",
"inLanguage": "en",
"author": {
"@type": "Person",
"name": "Ugo Candido"
},
"publisher": {
"@type": "Organization",
"name": "CalcDomain"
}
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
{ "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
{ "@type": "ListItem", "position": 2, "name": "Lifestyle & Everyday", "item": "https://calcdomain.com/lifestyle-everyday.html" },
{ "@type": "ListItem", "position": 3, "name": "Miscellaneous", "item": "https://calcdomain.com/subcategories/miscellaneous.html" },
{ "@type": "ListItem", "position": 4, "name": "Grade Calculator", "item": "https://calcdomain.com/grade-calculator.html" }
]
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "WebApplication",
"name": "Grade Calculator",
"description": "A versatile tool for students to calculate weighted grades and final exam requirements.",
"applicationCategory": "EducationalApplication",
"operatingSystem": "Any (Web)",
"browserRequirements": "Requires a modern web browser with JavaScript enabled.",
"offers": {
"@type": "Offer",
"price": "0"
}
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "HowTo",
"name": "How to Use the Grade Calculator",
"description": "A step-by-step guide to calculating your weighted grade or the final exam score you need.",
"step": [
{
"@type": "HowToStep",
"name": "Choose Calculator Mode",
"text": "Select either the 'Weighted Grade Calculator' to find your current average or the 'Final Grade Calculator' to see what you need on your final."
},
{
"@type": "HowToStep",
"name": "Enter Your Grades (Weighted Mode)",
"text": "In the 'Weighted Grade Calculator' tab, enter each assignment's grade and its corresponding weight as a percentage. Use the 'Add Assignment' button for more rows."
},
{
"@type": "HowToStep",
"name": "Calculate Weighted Grade",
"text": "Click 'Calculate Weighted Grade'. The tool will display your current overall grade. This result can be automatically used in the 'Final Grade' tab."
},
{
"@type": "HowToStep",
"name": "Enter Final Grade Goals (Final Grade Mode)",
"text": "In the 'Final Grade Calculator' tab, enter your current grade (or use the one calculated), the total weight of your current grade, your desired final grade for the class, and the weight of your final exam."
},
{
"@type": "HowToStep",
"name": "Review Your Required Score",
"text": "Click 'Calculate Final Grade Needed'. The calculator will show you the minimum grade you must achieve on your final exam."
}
]
}
</script>
<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="https://calcdomain.com/search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="https://calcdomain.com/index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="https://calcdomain.com/search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="https://calcdomain.com/index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="https://calcdomain.com/index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="https://calcdomain.com/lifestyle-everyday.html" class="hover:text-blue-600">Lifestyle & Everyday</a> &raquo;
<a href="https://calcdomain.com/subcategories/miscellaneous.html" class="hover:text-blue-600">Miscellaneous</a> &raquo;
<span class="text-gray-900">Grade Calculator</span>
</nav>

<div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Grade Calculator</h1>
<p class="text-gray-600 mb-6">This versatile tool helps students quickly calculate their weighted grade average or determine the exact score needed on a final exam to achieve a desired overall course grade. Stay on top of your academic goals with ease and precision.</p>

<section id="calculator-ui" aria-label="Grade Calculator Interface">
<div class="border-b border-gray-200 mb-6">
<div role="tablist" class="flex -mb-px">
<button role="tab" aria-selected="true" id="tab-weighted" aria-controls="panel-weighted"
class="text-sm font-medium text-gray-600 hover:text-blue-600 hover:border-gray-300">
Weighted Grade Calculator
</button>
<button role="tab" aria-selected="false" id="tab-final" aria-controls="panel-final"
class="ml-4 text-sm font-medium text-gray-600 hover:text-blue-600 hover:border-gray-300">
Final Grade Calculator
</button>
</div>
</div>

<div role="tabpanel" id="panel-weighted" aria-labelledby="tab-weighted" class="space-y-6">
<p class="text-sm text-gray-500">Enter your assignments, their grades, and their weights to find your current overall grade.</p>
<div id="assignment-list" class="space-y-4">
</div>
<div class="flex justify-between items-center mt-4">
<button id="add-row" type="button"
class="btn-add text-sm font-medium text-blue-600 hover:text-blue-800">
<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
</svg>
Add Assignment
</button>
<button id="calculate-weighted" type="button"
class="btn-calc bg-blue-600 text-white font-bold hover:bg-blue-700 rounded-lg">
Calculate Weighted Grade
</button>
</div>
</div>

<div role="tabpanel" id="panel-final" aria-labelledby="tab-final" class="space-y-6" hidden>
<p class="text-sm text-gray-500">Find out what grade you need on your final exam.</p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="current-grade" class="block text-sm font-medium text-gray-700">Current Grade (%) <span class="text-red-500">*</span></label>
<input type="number" id="current-grade" min="0" step="0.01" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="current-grade-error">
<p id="current-grade-error" class="error-message" aria-live="polite"></p>
</div>
<div>
<label for="current-weight" class="block text-sm font-medium text-gray-700">Current Grade Weight (%) <span class="text-red-500">*</span></label>
<input type="number" id="current-weight" min="0" max="100" step="0.01" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="current-weight-error">
<p id="current-weight-error" class="error-message" aria-live="polite"></p>
</div>
<div>
<label for="desired-grade" class="block text-sm font-medium text-gray-700">Desired Final Grade (%) <span class="text-red-500">*</span></label>
<input type="number" id="desired-grade" value="90" min="0" max="100" step="0.01" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="desired-grade-error">
<p id="desired-grade-error" class="error-message" aria-live="polite"></p>
</div>
<div>
<label for="final-weight" class="block text-sm font-medium text-gray-700">Final Exam Weight (%) <span class="text-red-500">*</span></label>
<input type="number" id="final-weight" min="0" max="100" step="0.01" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="final-weight-error">
<p id="final-weight-error" class="error-message" aria-live="polite"></p>
</div>
</div>
<div class="text-right mt-4">
<button id="calculate-final" type="button"
class="btn-calc bg-blue-600 text-white font-bold hover:bg-blue-700 rounded-lg">
Calculate Final Grade Needed
</button>
</div>
</div>
</section>

<section id="results-container" aria-live="polite"
class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6 text-center flex items-center justify-center">
<p id="result-text" class="text-xl font-medium text-gray-700">Your results will appear here.</p>
</section>

<div id="error-container" aria-live="assertive" class="mt-4"></div>

</div>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
<section>
<h2>Data Source and Methodology</h2>
<p>This calculator operates on the fundamental mathematical principles of weighted averages, which are standard in academic grading systems worldwide. There is no single external data source, as the logic relies on established arithmetic formulas.</p>
<p>All calculations are based strictly on these universally accepted formulas to ensure accuracy.</p>
</section>

<section>
<h2>The Formulas Explained</h2>
<p>The calculator uses two primary formulas depending on your goal.</p>
<h3>1. Weighted Grade Calculation</h3>
<p>To find your current weighted grade, we sum the products of each grade ($g_i$) and its corresponding weight ($w_i$), and then divide by the sum of all weights entered.</p>
<div class="formula-box" role="math" aria-label="Weighted Grade Formula">
$$ \text{Weighted Grade} = \frac{\sum_{i=1}^{n} (g_i \times w_i)}{\sum_{i=1}^{n} w_i} $$
</div>

<h3>2. Final Grade Needed Calculation</h3>
<p>To find the grade you need on your final exam, we use an algebraic rearrangement of the weighted average formula. We solve for the unknown grade ($g_{\text{final}}$) required to achieve your target grade ($g_{\text{target}}$).</p>
<div class="formula-box" role="math" aria-label="Final Grade Needed Formula">
$$ g_{\text{final}} = \frac{(g_{\text{target}} \times W_{\text{total}}) - (g_{\text{current}} \times w_{\text{current}})}{w_{\text{final}}} $$
</div>
</section>

<section>
<h2>Glossary of Variables</h2>
<dl class="space-y-2">
<dt class="font-semibold">Grade ($g_i$)</dt>
<dd class="ml-4">The percentage score you received on an assignment, test, or category (e.g., 85).</dd>

<dt class="font-semibold">Weight ($w_i$)</dt>
<dd class="ml-4">The percentage value that an assignment or category contributes to your total course grade (e.g., 20 for 20%).</dd>

<dt class="font-semibold">Current Grade ($g_{\text{current}}$)</dt>
<dd class="ml-4">Your current weighted average *before* factoring in the final exam.</dd>

<dt class="font-semibold">Current Weight ($w_{\text{current}}$)</dt>
<dd class="ml-4">The sum of all weights for assignments you have completed so far.</dd>

<dt class="font-semibold">Desired Final Grade ($g_{\text{target}}$)</dt>
<dd class="ml-4">The overall percentage you want to achieve in the class (e.g., 90 for an A).</dd>

<dt class="font-semibold">Final Exam Weight ($w_{\text{final}}$)</dt>
<dd class="ml-4">The weight of your upcoming final exam (e.g., 30 for 30%).</dd>

<dt class="font-semibold">Total Weight ($W_{\text{total}}$)</dt>
<dd class="ml-4">The total weight of all components in the course, typically 100. This is calculated as $w_{\text{current}} + w_{\text{final}}$.</dd>
</dl>
</section>

<section>
<h2>How it Works: A Step-by-Step Example</h2>
<p>Let's follow a student, Alex, who wants to know what grade is needed on the final exam to get an <strong>'A' (90%)</strong> in a course.</p>
<p>The course syllabus has the following weights:</p>
<ul>
<li>Homework: 20%</li>
<li>Quizzes: 20%</li>
<li>Midterm Exam: 30%</li>
<li>Final Exam: 30%</li>
</ul>
<p>Alex has completed everything except the final exam and has the following grades:</p>
<ul>
<li>Homework Grade: <strong>95%</strong></li>
<li>Quizzes Grade: <strong>85%</strong></li>
<li>Midterm Exam Grade: <strong>82%</strong></li>
</ul>

<h3>Step 1: Calculate Current Weighted Grade</h3>
<p>First, Alex uses the 'Weighted Grade Calculator' tab to find the current grade. (Alternatively, Alex can calculate this manually).</p>
<ul>
<li>Homework: (95% grade) × (20% weight) = 19</li>
<li>Quizzes: (85% grade) × (20% weight) = 17</li>
<li>Midterm: (82% grade) × (30% weight) = 24.6</li>
</ul>
<p><strong>Sum of (Grade × Weight):</strong> $19 + 17 + 24.6 = 60.6$</p>
<p><strong>Sum of Weights so far:</strong> $20 + 20 + 30 = 70$</p>
<p><strong>Current Grade:</strong> $60.6 / 70 = 0.8657 = $ <strong>86.57%</strong></p>

<h3>Step 2: Use the 'Final Grade Calculator'</h3>
<p>Alex now switches to the 'Final Grade Calculator' tab and enters the following information:</p>
<ol>
<li><strong>Current Grade (%):</strong> 86.57</li>
<li><strong>Current Grade Weight (%):</strong> 70 (the sum of weights for Homework, Quizzes, and Midterm)</li>
<li><strong>Desired Final Grade (%):</strong> 90</li>
<li><strong>Final Exam Weight (%):</strong> 30</li>
</ol>

<h3>Step 3: Review the Result</h3>
<p>The calculator applies the formula:</p>
<p>$$ \text{Needed Grade} = \frac{(90 \times 100) - (86.57 \times 70)}{30} $$</p>
<p>$$ \text{Needed Grade} = \frac{9000 - 6059.9}{30} $$</p>
<p>$$ \text{Needed Grade} = \frac{2940.1}{30} = 98.003 $$</p>
<p>The calculator will display: "You need to score at least <strong>98.01%</strong> on your final exam to get a 90% in the class."</p>
</section>

<section>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>What's the difference between "weight" and "points"?</summary>
<p>This calculator is designed for a <strong>percentage-based weighting system</strong>. "Weight" (e.g., "Homework is 20% of the grade") is different from "points" (e.g., "Homework is 200 points out of 1000 total"). If your class uses points, you can convert it: simply use the total points for each category as its "weight" and your points earned as the "grade" (e.g., Grade: 180, Weight: 200). Or, simpler, divide your total points earned so far by the total points possible so far to get your 'Current Grade (%)'.</p>
</details>
<details>
<summary>Can I add more than 4 or 5 assignments?</summary>
<p>Yes. In the 'Weighted Grade Calculator' tab, click the "+ Add Assignment" button as many times as you need. The calculator will expand to include all your course components.</p>
</details>
<details>
<summary>My weights add up to more than 100%. Is that a problem?</summary>
<p>Yes, that usually indicates an error in how you're reading the syllabus. In most standard courses, all components (including the final exam) should sum to exactly 100%. If your 'Current Grade Weight' + 'Final Exam Weight' is not 100, the calculation may be inaccurate. Double-check your syllabus. (The only exception is for extra credit).</p>
</details>
<details>
<summary>What if I don't know the weight of my final exam?</summary>
<p>The calculator cannot work without this crucial variable. The weight of the final exam is essential for determining its impact on your total grade. This information should be in your course syllabus. If not, you must ask your instructor.</p>
</details>
<details>
<summary>The calculator says I need over 100% on the final. What does that mean?</summary>
<p>This means that, based on the weights and your grades so far, your desired final grade is mathematically impossible to achieve, even with a perfect score on the final. This can happen if your current grade is too low or the final exam's weight is not large enough to make the difference.</p>
</details>
<details>
<summary>What if the calculator says I need a negative score?</summary>
<p>This is great news! It means you have already achieved your desired grade for the class, even if you get a 0 on the final exam. Congratulations, you've already passed your goal!</p>
</details>
</section>

<div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Academic content verified by the CalcDomain Editorial Board.<br>
Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>Instantly see your current weighted average.</li>
<li>Demystify what you need on the final exam.</li>
<li>Plan your study time by seeing how much the final impacts your grade.</li>
<li>Accessible on all devices and WCAG 2.1 AA compliant.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Student Tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="https://calcdomain.com/gpa-calculator.html" class="text-blue-600 hover:underline">GPA Calculator</a></li>
<li><a href="https://calcdomain.com/https://calcdomain.com/final-grade-calculator.html" class="text-blue-600 hover:underline">Final Grade (Simple)</a></li>
<li><a href="https://calcdomain.com/study-time-planner.html" class="text-blue-600 hover:underline">Study Time Planner</a></li>
<li><a href="https://calcdomain.com/percentage-calculator.html" class="text-blue-600 hover:underline">Percentage Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="https://calcdomain.com/about.html" class="hover:text-blue-600">About</a>
<a href="https://calcdomain.com/contact.html" class="hover:text-blue-600">Contact</a>
<a href="https://calcdomain.com/privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="https://calcdomain.com/terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

// ---- Elementi DOM ----
const tabs = document.querySelectorAll('[role="tab"]');
const panels = document.querySelectorAll('[role="tabpanel"]');
const assignmentList = document.getElementById('assignment-list');
const addRowBtn = document.getElementById('add-row');
const calcWeightedBtn = document.getElementById('calculate-weighted');
const calcFinalBtn = document.getElementById('calculate-final');
const resultText = document.getElementById('result-text');
const errorContainer = document.getElementById('error-container');

// Campi del calcolatore finale
const currentGradeEl = document.getElementById('current-grade');
const currentWeightEl = document.getElementById('current-weight');
const desiredGradeEl = document.getElementById('desired-grade');
const finalWeightEl = document.getElementById('final-weight');

let assignmentCounter = 0;

// ---- Gestione Tab ----
tabs.forEach(tab => {
tab.addEventListener('click', (e) => {
// Disattiva tutti
tabs.forEach(t => t.setAttribute('aria-selected', 'false'));
panels.forEach(p => p.setAttribute('hidden', 'true'));

// Attiva quello cliccato
const targetPanel = document.getElementById(e.target.getAttribute('aria-controls'));
e.target.setAttribute('aria-selected', 'true');
targetPanel.removeAttribute('hidden');
});
});

// ---- Funzioni Helper ----

/**
* Aggiunge una nuova riga di assignment
*/
function addAssignmentRow() {
assignmentCounter++;
const rowId = `assignment-row-${assignmentCounter}`;
const nameId = `assignment-name-${assignmentCounter}`;
const gradeId = `assignment-grade-${assignmentCounter}`;
const weightId = `assignment-weight-${assignmentCounter}`;

const row = document.createElement('div');
row.id = rowId;
row.className = 'grid grid-cols-1 md:grid-cols-3 gap-4 border-b pb-4';
row.innerHTML = `
<div>
<label for="${nameId}" class="block text-sm font-medium text-gray-700">Assignment ${assignmentCounter} (Optional)</label>
<input type"text" id="${nameId}"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
placeholder="e.g., Homework">
</div>
<div>
<label for="${gradeId}" class="block text-sm font-medium text-gray-700">Grade (%) <span class="text-red-500">*</span></label>
<input type="number" id="${gradeId}" min="0" step="0.01" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="${gradeId}-error">
<p id="${gradeId}-error" class="error-message" aria-live="polite"></p>
</div>
<div class="flex items-end">
<div class="flex-grow">
<label for="${weightId}" class="block text-sm font-medium text-gray-700">Weight (%) <span class="text-red-500">*</span></label>
<input type="number" id="${weightId}" min="0" step="0.01" aria-required="true"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-describedby="${weightId}-error">
<p id="${weightId}-error" class="error-message" aria-live="polite"></p>
</div>
<button type="button" class="btn-remove ml-2 text-red-500 hover:text-red-700" aria-label="Remove Assignment ${assignmentCounter}">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
</svg>
</button>
</div>
`;

// Aggiungi listener per rimuovere la riga
row.querySelector('.btn-remove').addEventListener('click', () => {
row.remove();
// Ricalcola se una riga viene rimossa
calculateWeightedGrade();
});

// Aggiungi listener per validazione on-blur
row.querySelectorAll('input[type="number"]').forEach(input => {
input.addEventListener('blur', () => validateField(input, 0, undefined, 'This field is required.'));
});

assignmentList.appendChild(row);
document.getElementById(nameId).focus();
}

/**
* Mostra un risultato
*/
function showResult(message, level = 'info') {
let textClass = 'text-blue-700';
if (level === 'warning') textClass = 'text-amber-700';
if (level === 'success') textClass = 'text-green-700';
if (level === 'error') textClass = 'text-red-700';

resultText.innerHTML = `<span class="text-3xl font-bold ${textClass}">${message}</span>`;
clearAllErrors();
}

/**
* Mostra un errore per un campo specifico
*/
function showError(inputEl, message) {
const errorEl = document.getElementById(inputEl.getAttribute('aria-describedby'));
if (errorEl) {
errorEl.textContent = message;
}
inputEl.setAttribute('aria-invalid', 'true');
}

/**
* Cancella tutti i messaggi di errore
*/
function clearAllErrors() {
document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
document.querySelectorAll('[aria-invalid]').forEach(el => el.setAttribute('aria-invalid', 'false'));
errorContainer.innerHTML = '';
}

/**
* Valida un singolo campo
*/
function validateField(input, min = 0, max, requiredMsg = "Required") {
clearError(input);
const val = parseFloat(input.value);
const id = input.id;

if (input.value.trim() === '') {
showError(input, requiredMsg);
return false;
}
if (isNaN(val)) {
showError(input, 'Must be a number.');
return false;
}
if (val < min) {
showError(input, `Must be ${min} or greater.`);
return false;
}
if (max !== undefined && val > max) {
showError(input, `Must be ${max} or less.`);
return false;
}
return true;
}

/**
* Cancella l'errore per un singolo campo
*/
function clearError(inputEl) {
const errorEl = document.getElementById(inputEl.getAttribute('aria-describedby'));
if (errorEl) {
errorEl.textContent = '';
}
inputEl.setAttribute('aria-invalid', 'false');
}

/**
* Mostra un errore generale del calcolatore
*/
function showGeneralError(message) {
errorContainer.innerHTML = `
<div class="p-4 bg-red-50 border border-red-200 rounded-md">
<p class="text-sm font-medium text-red-700">${message}</p>
</div>
`;
}

// ---- Logica di Calcolo ----

/**
* 1. Calcola Media Ponderata
*/
function calculateWeightedGrade() {
clearAllErrors();
let totalWeightedGrade = 0;
let totalWeight = 0;
let isValid = true;

const rows = assignmentList.querySelectorAll('[id^="assignment-row-"]');

if (rows.length === 0) {
showGeneralError('Please add at least one assignment to calculate a grade.');
return;
}

rows.forEach(row => {
const gradeInput = row.querySelector('[id^="assignment-grade-"]');
const weightInput = row.querySelector('[id^="assignment-weight-"]');

const isGradeValid = validateField(gradeInput, 0, undefined, "Grade is required.");
const isWeightValid = validateField(weightInput, 0.001, undefined, "Weight is required.");

if (!isGradeValid || !isWeightValid) {
isValid = false;
} else {
const grade = parseFloat(gradeInput.value);
const weight = parseFloat(weightInput.value);
totalWeightedGrade += grade * weight;
totalWeight += weight;
}
});

if (!isValid) {
resultText.innerHTML = '<span class="text-xl font-medium text-gray-700">Please fix the errors above.</span>';
return;
}

if (totalWeight === 0) {
showGeneralError('Total weight cannot be zero.');
return;
}

const finalGrade = totalWeightedGrade / totalWeight;
const formattedGrade = finalGrade.toFixed(2);

showResult(`Your current weighted grade is: <br> <strong>${formattedGrade}%</strong>`, 'success');

// Popola il tab "Final Grade"
currentGradeEl.value = formattedGrade;
currentWeightEl.value = totalWeight.toFixed(2);
}

/**
* 2. Calcola Voto Finale Necessario
*/
function calculateFinalGrade() {
clearAllErrors();

// Validazione
const isCurrentValid = validateField(currentGradeEl);
const isCurrentWeightValid = validateField(currentWeightEl, 0.01, 100);
const isDesiredValid = validateField(desiredGradeEl, 0, 100);
const isFinalWeightValid = validateField(finalWeightEl, 0.01, 100);

if (!isCurrentValid || !isCurrentWeightValid || !isDesiredValid || !isFinalWeightValid) {
resultText.innerHTML = '<span class="text-xl font-medium text-gray-700">Please fix the errors above.</span>';
return;
}

const currentGrade = parseFloat(currentGradeEl.value);
const currentWeight = parseFloat(currentWeightEl.value);
const desiredGrade = parseFloat(desiredGradeEl.value);
const finalWeight = parseFloat(finalWeightEl.value);

const totalWeight = currentWeight + finalWeight;
if (totalWeight > 100.01) { // Tolleranza per float
showError(finalWeightEl, `Total weight (${totalWeight.toFixed(2)}%) exceeds 100%. Check your weights.`);
return;
}

// Formula: needed = ((target * totalWeight) - (current * currentWeight)) / finalWeight
const neededScore = ((desiredGrade * totalWeight) - (currentGrade * currentWeight)) / finalWeight;
const formattedNeeded = neededScore.toFixed(2);

// Fornisci un contesto al risultato
if (neededScore < 0) {
showResult(`You need: <br> <strong>${formattedNeeded}%</strong> <br> <span class="text-lg font-normal">You've already achieved your target grade!</span>`, 'success');
} else if (neededScore > 100) {
showResult(`You need: <br> <strong>${formattedNeeded}%</strong> <br> <span class="text-lg font-normal">This score is mathematically impossible.</span>`, 'warning');
} else {
showResult(`You need to score at least: <br> <strong>${formattedNeeded}%</strong> <br> <span class="text-lg font-normal">on your final exam.</span>`, 'info');
}
}

// ---- Event Listeners ----
addRowBtn.addEventListener('click', addAssignmentRow);
calcWeightedBtn.addEventListener('click', calculateWeightedGrade);
calcFinalBtn.addEventListener('click', calculateFinalGrade);

// Inizializza con la prima riga
addAssignmentRow();
});

// Gestione menu mobile (da template)
document.getElementById('mobile-menu-toggle').addEventListener('click', ()_=> {
document.getElementById('mobile-menu').classList.toggle('hidden');
});
</script>

</body>
</html>