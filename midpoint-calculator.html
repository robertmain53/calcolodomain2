<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta & Icons -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Midpoint Calculator — Geometry (2D & 3D) with Distance, Slope & Line</title>
  <meta name="description" content="Professional midpoint calculator for 2D/3D geometry. Compute midpoint, distance, slope, and line equation from two points. Mobile-first, fully accessible, and optimized for Core Web Vitals." />
  <link rel="canonical" href="https://calcdomain.com/midpoint-calculator.html" />
  <meta name="author" content="Ugo Candido" />
  <meta name="keywords" content="midpoint calculator, geometry, distance between two points, slope, line equation, 2D, 3D" />

  <!-- Assets -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MathJax (for LaTeX formulas) -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          id="MathJax-script"></script>

  <!-- Styles: mobile-first, high-contrast focus, CLS-safe result shells -->
  <style>
    :root { --brand:#1d4ed8; --ink:#0f172a; --muted:#475569; --surface:#ffffff; --bg:#f8fafc; }
    html,body{height:100%}
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;background:var(--bg);color:var(--ink)}
    .prose { max-width: 70ch; }
    .prose h2{font-size:1.35rem;font-weight:700;margin-top:1.5rem;margin-bottom:.75rem}
    .prose h3{font-size:1.15rem;font-weight:700;margin-top:1.25rem;margin-bottom:.5rem}
    .prose p{margin:.6rem 0;line-height:1.65}
    .prose ul,.prose ol{margin:.75rem 0 .75rem 1.25rem}
    .formula-box{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:1rem;overflow:auto}
    .result-card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;text-align:center;min-height:92px}
    .result-card h4{font-size:.9rem;color:#64748b;margin-bottom:.25rem}
    .result-card p{font-size:1.35rem;font-weight:800;color:var(--brand);word-break:break-word}
    .kbd:focus,button:focus,input:focus,select:focus,summary:focus{outline:3px solid #60a5fa;outline-offset:2px}
    .help-tip[aria-expanded="true"] + .help-text{display:block}
    .help-text{display:none}
    /* CLS prevention placeholders */
    #results-quick { min-height: 140px; }
    #results-extended { min-height: 140px; }
    /* Touch targets */
    .btn{min-height:48px;min-width:48px}
    @media print{
      header,nav,aside,footer,.no-print{display:none!important}
      #print-section{position:absolute;inset:0;margin:0}
      body{background:#fff}
    }
  </style>

  <!-- JSON-LD (WebPage + WebApplication + Breadcrumbs + FAQPage + HowTo) -->
  <script type="application/ld+json" defer>
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebPage",
        "name": "Midpoint Calculator",
        "inLanguage": "en",
        "url": "https://calcdomain.com/midpoint-calculator.html",
        "description": "Compute midpoint, distance, slope, and line equation from two points in 2D or 3D.",
        "isPartOf": { "@type": "WebSite", "name": "CalcDomain", "url": "https://calcdomain.com/" },
        "about": [{ "@type":"Thing", "name":"Geometry" }, { "@type":"Thing", "name":"Analytic Geometry" }],
        "author": { "@type":"Person", "name":"Ugo Candido" },
        "dateModified": "2025-10-25"
      },
      {
        "@type": "WebApplication",
        "name": "Midpoint Calculator",
        "applicationCategory": "Calculator",
        "operatingSystem": "All",
        "url": "https://calcdomain.com/midpoint-calculator.html",
        "offers": { "@type": "Offer", "price":"0", "priceCurrency":"USD" },
        "creator": { "@type":"Person", "name":"Ugo Candido" }
      },
      {
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type":"ListItem", "position":1, "name":"Home", "item":"https://calcdomain.com/" },
          { "@type":"ListItem", "position":2, "name":"Math", "item":"https://calcdomain.com/math.html" },
          { "@type":"ListItem", "position":3, "name":"Geometry", "item":"https://calcdomain.com/subcategories/geometry.html" },
          { "@type":"ListItem", "position":4, "name":"Midpoint Calculator", "item":"https://calcdomain.com/midpoint-calculator.html" }
        ]
      },
      {
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type":"Question",
            "name":"What is the midpoint between two points?",
            "acceptedAnswer":{"@type":"Answer","text":"The midpoint is the point exactly halfway between two points. In 2D it is ((x1 + x2)/2, (y1 + y2)/2). In 3D add the z coordinate ((z1 + z2)/2)."}
          },
          {
            "@type":"Question",
            "name":"Does unit choice affect the midpoint?",
            "acceptedAnswer":{"@type":"Answer","text":"Units do not change the midpoint’s coordinates because the average of coordinates is unit-agnostic; units only label distance."}
          },
          {
            "@type":"Question",
            "name":"Can the slope be undefined?",
            "acceptedAnswer":{"@type":"Answer","text":"Yes. If x1 = x2 the segment is vertical and the slope is undefined. The line is x = constant."}
          },
          {
            "@type":"Question",
            "name":"How do I get the line equation?",
            "acceptedAnswer":{"@type":"Answer","text":"When the slope is defined, slope-intercept form is y = m x + b where m = (y2−y1)/(x2−x1) and b = y1 − m x1."}
          },
          {
            "@type":"Question",
            "name":"How is 3D distance computed?",
            "acceptedAnswer":{"@type":"Answer","text":"With the Euclidean metric: √((x2−x1)^2 + (y2−y1)^2 + (z2−z1)^2). If z is omitted, the 2D formula is used."}
          }
        ]
      },
      {
        "@type":"HowTo",
        "name":"How to compute a midpoint",
        "step":[
          {"@type":"HowToStep","name":"Enter coordinates","text":"Provide x1, y1 and x2, y2 (and optional z1, z2)."},
          {"@type":"HowToStep","name":"Select options","text":"Choose 2D or 3D and preferred unit labels."},
          {"@type":"HowToStep","name":"Calculate","text":"The tool outputs midpoint, distance, slope (2D), and line equation where defined."}
        ]
      }
    ]
  }
  </script>
</head>

<body class="antialiased">
  <!-- Header (non-sticky to maximize mobile viewport) -->
  <header class="bg-white border-b">
    <nav class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between" aria-label="Primary">
      <a href="index.html" class="text-xl font-extrabold text-blue-700">CalcDomain</a>
      <div class="hidden md:flex gap-6 text-sm">
        <a href="search.html" class="text-slate-700 hover:text-blue-700">Search</a>
        <a href="index.html#categories" class="text-slate-700 hover:text-blue-700">Categories</a>
      </div>
      <button class="md:hidden p-2 rounded btn border hover:bg-slate-50" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
    <!-- Breadcrumbs -->
    <nav class="text-sm text-slate-600 mb-4" aria-label="Breadcrumb">
      <a class="hover:text-blue-700" href="index.html">Home</a> &raquo;
      <a class="hover:text-blue-700" href="math.html">Math</a> &raquo;
      <a class="hover:text-blue-700" href="subcategories/math-geometry.html">Geometry</a> &raquo;
      <span class="text-slate-900">Midpoint Calculator</span>
    </nav>

    <div id="print-section" class="bg-white rounded-xl shadow-sm border p-5 sm:p-7">
      <!-- 1) H1 -->
      <h1 class="text-3xl font-extrabold tracking-tight mb-2">Midpoint Calculator</h1>

      <!-- 2) Intro -->
      <p class="text-slate-600 mb-6">
        Enter two points to compute the <strong>midpoint</strong>. This professional tool also reports
        <strong>distance</strong>, <strong>slope</strong> (2D), and the <strong>line equation</strong>, with accessible UX,
        clear validation, and printable results. Ideal for students, engineers, surveyors, and GIS analysts.
      </p>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 3) Calculator UI -->
        <section class="lg:col-span-2">
          <h2 class="sr-only">Calculator</h2>

          <form id="mp-form" novalidate class="space-y-5">
            <!-- Mode & Precision Row -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
              <div>
                <label for="spaceMode" class="block text-sm font-medium text-slate-800">
                  Dimension <span aria-hidden="true" class="text-rose-600">*</span>
                </label>
                <div class="flex items-center gap-2">
                  <select id="spaceMode" name="spaceMode" aria-required="true"
                          class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2"
                          aria-describedby="spaceMode_help">
                    <option value="2d" selected>2D (x, y)</option>
                    <option value="3d">3D (x, y, z)</option>
                  </select>
                  <button type="button" class="help-tip btn px-2 rounded border"
                          aria-expanded="false" aria-controls="spaceMode_help">?</button>
                </div>
                <p id="spaceMode_help" class="help-text mt-1 text-xs text-slate-600">
                  Select <em>2D</em> for planar problems or <em>3D</em> to include the z coordinate.
                </p>
              </div>

              <div>
                <label for="unitLabel" class="block text-sm font-medium text-slate-800">
                  Unit (for distance)
                </label>
                <select id="unitLabel" name="unitLabel" class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2">
                  <option value="" selected>— none —</option>
                  <option value="m">m</option>
                  <option value="ft">ft</option>
                  <option value="km">km</option>
                  <option value="mi">mi</option>
                </select>
              </div>

              <div>
                <label for="decimals" class="block text-sm font-medium text-slate-800">
                  Decimals
                </label>
                <select id="decimals" name="decimals" class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2">
                  <option>0</option><option>1</option><option selected>2</option><option>3</option><option>4</option><option>6</option>
                </select>
              </div>
            </div>

            <!-- Coordinates -->
            <fieldset class="border rounded-lg p-3">
              <legend class="px-2 text-sm font-semibold text-slate-700">Point A (x₁, y₁, z₁)</legend>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label for="x1" class="block text-sm font-medium text-slate-800">x₁ <span class="text-rose-600" aria-hidden="true">*</span></label>
                  <input type="number" inputmode="decimal" id="x1" name="x1" aria-required="true"
                         aria-describedby="x1_err x1_tip"
                         class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2" placeholder="e.g., -2.5" />
                  <p id="x1_err" class="mt-1 text-sm text-rose-600"></p>
                  <p id="x1_tip" class="sr-only">Enter any real number.</p>
                </div>
                <div>
                  <label for="y1" class="block text-sm font-medium text-slate-800">y₁ <span class="text-rose-600" aria-hidden="true">*</span></label>
                  <input type="number" inputmode="decimal" id="y1" name="y1" aria-required="true"
                         aria-describedby="y1_err y1_tip"
                         class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2" placeholder="e.g., 4" />
                  <p id="y1_err" class="mt-1 text-sm text-rose-600"></p>
                  <p id="y1_tip" class="sr-only">Enter any real number.</p>
                </div>
                <div>
                  <label for="z1" class="block text-sm font-medium text-slate-800">z₁ (3D only)</label>
                  <input type="number" inputmode="decimal" id="z1" name="z1"
                         aria-describedby="z1_err z1_tip"
                         class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2" placeholder="optional" />
                  <p id="z1_err" class="mt-1 text-sm text-rose-600"></p>
                  <p id="z1_tip" class="sr-only">Only required in 3D mode.</p>
                </div>
              </div>
            </fieldset>

            <fieldset class="border rounded-lg p-3">
              <legend class="px-2 text-sm font-semibold text-slate-700">Point B (x₂, y₂, z₂)</legend>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label for="x2" class="block text-sm font-medium text-slate-800">x₂ <span class="text-rose-600" aria-hidden="true">*</span></label>
                  <input type="number" inputmode="decimal" id="x2" name="x2" aria-required="true"
                         aria-describedby="x2_err x2_tip"
                         class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2" placeholder="e.g., 5" />
                  <p id="x2_err" class="mt-1 text-sm text-rose-600"></p>
                  <p id="x2_tip" class="sr-only">Enter any real number.</p>
                </div>
                <div>
                  <label for="y2" class="block text-sm font-medium text-slate-800">y₂ <span class="text-rose-600" aria-hidden="true">*</span></label>
                  <input type="number" inputmode="decimal" id="y2" name="y2" aria-required="true"
                         aria-describedby="y2_err y2_tip"
                         class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2" placeholder="e.g., -1.75" />
                  <p id="y2_err" class="mt-1 text-sm text-rose-600"></p>
                  <p id="y2_tip" class="sr-only">Enter any real number.</p>
                </div>
                <div>
                  <label for="z2" class="block text-sm font-medium text-slate-800">z₂ (3D only)</label>
                  <input type="number" inputmode="decimal" id="z2" name="z2"
                         aria-describedby="z2_err z2_tip"
                         class="w-full mt-1 rounded-md border border-slate-300 px-3 py-2" placeholder="optional" />
                  <p id="z2_err" class="mt-1 text-sm text-rose-600"></p>
                  <p id="z2_tip" class="sr-only">Only required in 3D mode.</p>
                </div>
              </div>
            </fieldset>

            <!-- Actions -->
            <div class="flex flex-wrap gap-3">
              <button type="button" id="calcBtn" class="btn inline-flex items-center gap-2 px-4 py-2 rounded-md bg-blue-600 text-white font-semibold hover:bg-blue-700 focus-visible:outline-blue-400">
                Calculate
              </button>
              <button type="button" id="resetBtn" class="btn inline-flex items-center gap-2 px-4 py-2 rounded-md border font-semibold hover:bg-slate-50">
                Reset
              </button>
              <button type="button" id="copyBtn" class="btn inline-flex items-center gap-2 px-4 py-2 rounded-md border font-semibold hover:bg-slate-50 no-print">
                Copy results
              </button>
              <button type="button" id="printBtn" class="btn inline-flex items-center gap-2 px-4 py-2 rounded-md border font-semibold hover:bg-slate-50">
                Print
              </button>
            </div>
          </form>
        </section>

        <!-- 4) Results -->
        <section aria-live="polite" aria-atomic="true" class="lg:col-span-1">
          <h2 class="sr-only">Results</h2>
          <div id="results-quick" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-3">
            <div class="result-card">
              <h4>Midpoint</h4>
              <p id="midpointOut">—</p>
            </div>
            <div class="result-card">
              <h4>Distance</h4>
              <p id="distanceOut">—</p>
            </div>
            <div class="result-card">
              <h4>Slope (2D)</h4>
              <p id="slopeOut">—</p>
            </div>
            <div class="result-card">
              <h4>Line (2D)</h4>
              <p id="lineOut" class="text-sm leading-tight break-words">—</p>
            </div>
          </div>

          <details id="results-extended" class="mt-4 border rounded-lg p-3">
            <summary class="font-semibold cursor-pointer">Show coordinate-by-coordinate details</summary>
            <div class="mt-2 text-sm text-slate-700 space-y-2">
              <div><span class="font-semibold">Midpoint x:</span> <span id="mxDetail">—</span></div>
              <div><span class="font-semibold">Midpoint y:</span> <span id="myDetail">—</span></div>
              <div class="z-only"><span class="font-semibold">Midpoint z:</span> <span id="mzDetail">—</span></div>
              <div><span class="font-semibold">Δx:</span> <span id="dxDetail">—</span></div>
              <div><span class="font-semibold">Δy:</span> <span id="dyDetail">—</span></div>
              <div class="z-only"><span class="font-semibold">Δz:</span> <span id="dzDetail">—</span></div>
            </div>
          </details>
        </section>
      </div>
    </div>

    <!-- 5) Authoritative Content Ecosystem -->
    <section class="prose mt-8 bg-white border rounded-xl p-5 sm:p-7">
      <h2>Authoritative data source & methodology</h2>
      <p>
        Primary reference: <strong>OpenStax, <em>Algebra and Trigonometry</em>, “The Midpoint Formula” & “Distance Formula,”</strong> Houston, 2015 (current OER edition).
        Permalink: <a class="text-blue-700 underline" href="https://openstax.org/details/books/algebra-and-trigonometry">openstax.org/details/books/algebra-and-trigonometry</a>.
        <br />
        <em>All calculations strictly follow the formulas and definitions provided by this source.</em>
      </p>

      <h2>The formula explained</h2>
      <div class="formula-box" role="region" aria-label="Formulas in LaTeX">
        <p><strong>Midpoint (2D):</strong> \\( M\\bigl(\\tfrac{x_1 + x_2}{2},\\; \\tfrac{y_1 + y_2}{2} \\bigr) \\)</p>
        <p><strong>Midpoint (3D):</strong> \\( M\\bigl(\\tfrac{x_1 + x_2}{2},\\; \\tfrac{y_1 + y_2}{2},\\; \\tfrac{z_1 + z_2}{2} \\bigr) \\)</p>
        <p><strong>Distance (2D):</strong> \\( d = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2} \\)</p>
        <p><strong>Distance (3D):</strong> \\( d = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2 + (z_2 - z_1)^2} \\)</p>
        <p><strong>Slope (2D):</strong> \\( m = \\dfrac{y_2 - y_1}{x_2 - x_1} \\) (undefined if \\(x_1 = x_2\\))</p>
        <p><strong>Line (2D):</strong> point–slope \\( y - y_1 = m(x - x_1) \\); slope–intercept \\( y = mx + b \\) with \\( b = y_1 - mx_1 \\).</p>
      </div>

      <h2>Glossary of variables</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm border border-slate-200">
          <thead class="bg-slate-50">
            <tr>
              <th class="text-left p-2 border-b">Symbol</th>
              <th class="text-left p-2 border-b">Meaning</th>
              <th class="text-left p-2 border-b">Units</th>
            </tr>
          </thead>
          <tbody>
            <tr><td class="p-2 border-b">x₁, y₁, z₁</td><td class="p-2 border-b">Coordinates of point A</td><td class="p-2 border-b">as entered</td></tr>
            <tr><td class="p-2 border-b">x₂, y₂, z₂</td><td class="p-2 border-b">Coordinates of point B</td><td class="p-2 border-b">as entered</td></tr>
            <tr><td class="p-2 border-b">M</td><td class="p-2 border-b">Midpoint between A and B</td><td class="p-2 border-b">as entered</td></tr>
            <tr><td class="p-2 border-b">d</td><td class="p-2 border-b">Distance between A and B</td><td class="p-2 border-b">unit label (optional)</td></tr>
            <tr><td class="p-2 border-b">m</td><td class="p-2 border-b">Slope of AB (2D)</td><td class="p-2 border-b">dimensionless</td></tr>
            <tr><td class="p-2 border-b">b</td><td class="p-2 border-b">Intercept in y = mx + b</td><td class="p-2 border-b">as entered</td></tr>
          </tbody>
        </table>
      </div>

      <h2>How it works: a step-by-step example</h2>
      <p>Let A = (−2, 4) and B = (5, −1).</p>
      <ol>
        <li>Midpoint: \\( M = \Bigl(\\frac{-2+5}{2},\\frac{4+(-1)}{2}\\Bigr) = (1.5, 1.5) \\)</li>
        <li>Distance: \\( d = \\sqrt{(5-(-2))^2 + (-1-4)^2} = \\sqrt{7^2 + (-5)^2} = \\sqrt{74} \\approx 8.602 \\)</li>
        <li>Slope: \\( m = \\frac{-1-4}{5-(-2)} = \\frac{-5}{7} \\approx -0.7143 \\)</li>
        <li>Line: \\( y = mx + b \\Rightarrow b = y_1 - m x_1 = 4 - (-0.7143)(-2) \\approx 2.5714 \\). So \\( y \\approx -0.7143x + 2.5714 \\).</li>
      </ol>

      <h2>Frequently asked questions</h2>
      <details><summary>Do I need to choose units before entering coordinates?</summary><p>No. Units are only used to label the distance. Coordinates and midpoint are unit-agnostic.</p></details>
      <details><summary>Can I compute 3D midpoint and distance?</summary><p>Yes. Switch to 3D mode and provide z₁ and z₂; the calculator uses the 3D formulas.</p></details>
      <details><summary>Why is the slope “undefined” sometimes?</summary><p>When x₁ = x₂, the segment is vertical. The slope is undefined and the line is written as x = constant.</p></details>
      <details><summary>How many decimals should I use?</summary><p>Choose any preset. The calculator rounds outputs to your selected precision without losing internal accuracy.</p></details>
      <details><summary>Is rounding banker's rounding?</summary><p>No. It uses standard half-away-from-zero rounding via JavaScript’s <code>toFixed</code>-style formatting.</p></details>
      <details><summary>Can I copy or print results?</summary><p>Yes. Use “Copy results” to place a clean text summary onto your clipboard or “Print”.</p></details>
      <details><summary>Does it handle very large numbers?</summary><p>Yes, within typical JavaScript double precision. Extremely large magnitudes may lose precision.</p></details>

      <!-- 6) Authorship & Review -->
      <div class="mt-6 p-4 bg-slate-50 border rounded-lg text-sm text-slate-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content reviewed by the CalcDomain Editorial Board.<br />
        Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
      </div>
    </section>
  </main>

  <footer class="bg-white border-t">
    <div class="max-w-6xl mx-auto px-6 py-8 text-center text-slate-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-3 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (placed before </body>, using defer attribute) -->
  <script defer>
  (function () {
    const $ = (id) => document.getElementById(id);

    // Elements
    const els = {
      spaceMode: $('spaceMode'),
      unitLabel: $('unitLabel'),
      decimals: $('decimals'),
      x1: $('x1'), y1: $('y1'), z1: $('z1'),
      x2: $('x2'), y2: $('y2'), z2: $('z2'),
      calcBtn: $('calcBtn'), resetBtn: $('resetBtn'),
      copyBtn: $('copyBtn'), printBtn: $('printBtn'),
      midpointOut: $('midpointOut'),
      distanceOut: $('distanceOut'),
      slopeOut: $('slopeOut'),
      lineOut: $('lineOut'),
      mxDetail: $('mxDetail'), myDetail: $('myDetail'), mzDetail: $('mzDetail'),
      dxDetail: $('dxDetail'), dyDetail: $('dyDetail'), dzDetail: $('dzDetail')
    };

    // Accessible tooltip toggles
    document.querySelectorAll('.help-tip').forEach(btn => {
      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
      });
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });

    // Show/Hide z fields based on mode
    function syncMode() {
      const is3D = els.spaceMode.value === '3d';
      document.querySelectorAll('.z-only').forEach(n => n.style.display = is3D ? '' : 'none');
      [els.z1, els.z2].forEach(inp => {
        inp.parentElement.style.display = is3D ? '' : 'none';
        inp.setAttribute('aria-required', is3D ? 'true' : 'false');
      });
    }

    // Validation helpers
    function setFieldError(id, message) {
      const err = $(id + '_err');
      const input = $(id);
      if (message) {
        err.textContent = message;
        input.setAttribute('aria-invalid', 'true');
      } else {
        err.textContent = '';
        input.removeAttribute('aria-invalid');
      }
    }

    function requireNumber(id, req = true) {
      const v = $(id).value.trim();
      if (!req && v === '') { setFieldError(id, ''); return null; }
      if (v === '') { setFieldError(id, 'This field is required. Enter a number (e.g., 3.5 or -2).'); return undefined; }
      const n = Number(v);
      if (Number.isNaN(n)) { setFieldError(id, 'Invalid number. Use digits, optional sign, and decimal point.'); return undefined; }
      setFieldError(id, '');
      return n;
    }

    // Attach on-blur validation (WCAG-friendly, not only on submit)
    ['x1','y1','x2','y2','z1','z2'].forEach(id => {
      $(id).addEventListener('blur', () => {
        const is3D = els.spaceMode.value === '3d';
        const required = (id === 'z1' || id === 'z2') ? is3D : true;
        requireNumber(id, required);
      });
    });

    els.spaceMode.addEventListener('change', () => { syncMode(); calculate(); });

    function fmt(n, d) {
      if (typeof n !== 'number' || !isFinite(n)) return '—';
      return n.toFixed(d);
    }
    function unitize(val, unit) {
      return unit ? `${val} ${unit}` : val;
    }

    function calculate() {
      const is3D = els.spaceMode.value === '3d';
      const d = Number(els.decimals.value) || 2;
      const unit = els.unitLabel.value || '';

      const x1 = requireNumber('x1');
      const y1 = requireNumber('y1');
      const x2 = requireNumber('x2');
      const y2 = requireNumber('y2');
      if ([x1,y1,x2,y2].some(v => v === undefined)) { renderPlaceholders(); return; }

      let z1 = null, z2 = null;
      if (is3D) {
        z1 = requireNumber('z1', true);
        z2 = requireNumber('z2', true);
        if ([z1,z2].some(v => v === undefined)) { renderPlaceholders(); return; }
      }

      // Midpoint
      const mx = (x1 + x2) / 2;
      const my = (y1 + y2) / 2;
      const mz = is3D ? (z1 + z2) / 2 : null;

      // Deltas
      const dx = x2 - x1;
      const dy = y2 - y1;
      const dz = is3D ? (z2 - z1) : null;

      // Distance
      const dist = Math.sqrt(dx*dx + dy*dy + (is3D ? dz*dz : 0));

      // Slope & line (2D only)
      let slopeTxt = '—', lineTxt = '—';
      if (!is3D) {
        if (x2 === x1) {
          slopeTxt = 'undefined (vertical)';
          lineTxt = `x = ${fmt(x1, d)}`;
        } else {
          const m = dy / dx;
          const b = y1 - m * x1;
          slopeTxt = fmt(m, d);
          lineTxt = `y = ${fmt(m, d)}·x + ${fmt(b, d)}`;
        }
      }

      // Output summaries
      const midCompact = is3D
        ? `(${fmt(mx,d)}, ${fmt(my,d)}, ${fmt(mz,d)})`
        : `(${fmt(mx,d)}, ${fmt(my,d)})`;

      els.midpointOut.textContent = midCompact;
      els.distanceOut.textContent = unitize(fmt(dist, d), unit);
      els.slopeOut.textContent = slopeTxt;
      els.lineOut.textContent = lineTxt;

      // Details
      els.mxDetail.textContent = fmt(mx, d);
      els.myDetail.textContent = fmt(my, d);
      if (is3D) els.mzDetail.textContent = fmt(mz, d);
      els.dxDetail.textContent = fmt(dx, d);
      els.dyDetail.textContent = fmt(dy, d);
      if (is3D) els.dzDetail.textContent = fmt(dz, d);
    }

    function renderPlaceholders() {
      els.midpointOut.textContent = '—';
      els.distanceOut.textContent = '—';
      els.slopeOut.textContent = '—';
      els.lineOut.textContent = '—';
      ['mxDetail','myDetail','mzDetail','dxDetail','dyDetail','dzDetail'].forEach(id => { const n=$(id); if(n) n.textContent='—'; });
    }

    // Copy and Print
    function copyResults() {
      const txt = [
        'Midpoint Calculator — Results',
        `Mode: ${els.spaceMode.value.toUpperCase()}`,
        `Midpoint: ${els.midpointOut.textContent}`,
        `Distance: ${els.distanceOut.textContent}`,
        `Slope (2D): ${els.slopeOut.textContent}`,
        `Line (2D): ${els.lineOut.textContent}`
      ].join('\n');
      navigator.clipboard.writeText(txt).then(()=> {
        els.copyBtn.textContent = 'Copied!';
        setTimeout(()=>{ els.copyBtn.textContent = 'Copy results'; }, 1500);
      });
    }

    function resetAll() {
      ['x1','y1','z1','x2','y2','z2'].forEach(id => { const n=$(id); if(n) n.value=''; setFieldError(id,''); });
      renderPlaceholders();
    }

    // Events
    els.calcBtn.addEventListener('click', calculate);
    ['x1','y1','z1','x2','y2','z2','unitLabel','decimals'].forEach(id=>{
      const n=$(id); if(n) n.addEventListener('input', calculate);
    });
    els.copyBtn.addEventListener('click', copyResults);
    els.printBtn.addEventListener('click', () => window.print());
    els.resetBtn.addEventListener('click', resetAll);

    // Init
    syncMode();
    calculate();
  })();
  </script>
</body>
</html>
