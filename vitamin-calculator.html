<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vitamin Calculator — Personalized RDAs, AIs & ULs by Age & Sex</title>
  <meta name="description" content="Professional vitamin calculator for diet & nutrition. Get age/sex-specific RDAs/AIs, compare your intake, and check against Upper Intake Levels (UL). Includes formulas, glossary, worked example, FAQs, and authoritative sources." />
  <link rel="canonical" href="https://calcdomain.com/vitamin-calculator.html" />
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --focus: #1d4ed8; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow-x:auto; }
    .result-card h4{ font-size:.9rem; color:#374151; }
    .result-card p{ font-size:1.4rem; font-weight:700; }
    .sr-only-focusable:focus { position: static !important; width: auto; height: auto; clip: auto; }
    /* Accessible visible focus */
    :is(a, button, input, select, summary, textarea):focus { outline: 3px solid var(--focus); outline-offset: 2px; }
    /* Minimum height to avoid CLS when results render */
    #results-panel { min-height: 320px; }
    /* Touch target size */
    .touch-target { min-height: 48px; min-width: 48px; }
    /* Status chips */
    .chip { border-radius: 9999px; padding:.15rem .6rem; font-size:.75rem; font-weight:600; }
    .chip-ok { background:#dcfce7; color:#166534; border:1px solid #86efac; }
    .chip-low { background:#fee2e2; color:#991b1b; border:1px solid #fecaca; }
    .chip-high { background:#fff7ed; color:#9a3412; border:1px solid #fed7aa; }
    /* Error text */
    .err { color:#b91c1c; font-size:.85rem; margin-top:.25rem; }
    @media print {
      header, nav, aside, .no-print { display:none !important; }
      #print-section { display:block !important; }
    }
  </style>

  <!-- JSON-LD: WebPage + Breadcrumbs + HowTo + FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Vitamin Calculator",
    "url":"https://calcdomain.com/vitamin-calculator.html",
    "inLanguage":"en",
    "description":"Professional vitamin calculator to compare your intake against age/sex-specific RDAs/AIs and Upper Intake Levels.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "mainEntityOfPage":"https://calcdomain.com/vitamin-calculator.html"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Health & Fitness","item":"https://calcdomain.com/health-fitness.html"},
      {"@type":"ListItem","position":3,"name":"Diet & Nutrition","item":"https://calcdomain.com/subcategories/diet-nutrition.html"},
      {"@type":"ListItem","position":4,"name":"Vitamin Calculator","item":"https://calcdomain.com/vitamin-calculator.html"}
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to use the Vitamin Calculator",
    "description":"Enter age, sex and (if applicable) pregnancy/lactation status, then add your daily vitamin intakes to see % of RDA/AI and UL flags.",
    "step":[
      {"@type":"HowToStep","name":"Set profile","text":"Choose age, sex, and pregnancy/lactation as applicable."},
      {"@type":"HowToStep","name":"Enter intakes","text":"For each vitamin you track, enter your estimated daily intake."},
      {"@type":"HowToStep","name":"Review results","text":"Compare your intake vs RDA/AI and check if you exceed UL."},
      {"@type":"HowToStep","name":"Adjust plan","text":"Use the per-vitamin status to fine-tune diet or supplements."}
    ]
  }
  </script>
  <script type="application/ld+json" id="faq-json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Are RDAs and AIs the same?","acceptedAnswer":{"@type":"Answer","text":"No. An RDA is based on robust evidence to meet the needs of nearly all healthy individuals; an AI is used when evidence is insufficient to establish an RDA."}},
      {"@type":"Question","name":"What is a UL?","acceptedAnswer":{"@type":"Answer","text":"UL is the Tolerable Upper Intake Level — the highest daily intake unlikely to pose risk for almost all individuals. Not all vitamins have a UL."}},
      {"@type":"Question","name":"Do I need supplements if I meet the RDA from food?","acceptedAnswer":{"@type":"Answer","text":"Generally no, if your intake is consistent and you have no special conditions. Supplements can help fill gaps but may pose risks at high doses."}},
      {"@type":"Question","name":"Why does the calculator use RDAs/AIs by age and sex?","acceptedAnswer":{"@type":"Answer","text":"Requirements vary with age, sex, and life stage due to physiology, metabolism, and reproductive status."}},
      {"@type":"Question","name":"Can this calculator diagnose deficiencies?","acceptedAnswer":{"@type":"Answer","text":"No. It is an educational tool. Clinical assessment and lab tests are needed to diagnose deficiencies or toxicities."}},
      {"@type":"Question","name":"How accurate are my intake estimates?","acceptedAnswer":{"@type":"Answer","text":"Food labels and reputable databases help, but day-to-day variability is high. Consider averaging over multiple days and consulting a dietitian."}},
      {"@type":"Question","name":"What about bioavailability and interactions?","acceptedAnswer":{"@type":"Answer","text":"Absorption can vary by form and co-ingestion (e.g., fat improves vitamin D and A absorption). The tool compares totals to reference values; it does not model bioavailability."}}
    ]
  }
  </script>

  <!-- MathJax for LaTeX display -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
      <div class="flex items-center justify-between">
        <a class="text-2xl font-bold text-blue-700" href="https://calcdomain.com/index.html">CalcDomain</a>
        <div class="hidden md:flex gap-6 text-sm">
          <a class="hover:text-blue-700" href="https://calcdomain.com/search.html">Advanced Search</a>
          <a class="hover:text-blue-700" href="https://calcdomain.com/index.html#categories">Categories</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a class="hover:text-blue-700" href="https://calcdomain.com/index.html">Home</a> &raquo;
      <a class="hover:text-blue-700" href="https://calcdomain.com/health-fitness.html">Health &amp; Fitness</a> &raquo;
      <a class="hover:text-blue-700" href="https://calcdomain.com/subcategories/diet-nutrition.html">Diet &amp; Nutrition</a> &raquo;
      <span class="text-gray-900">Vitamin Calculator</span>
    </nav>

    <div id="print-section" class="bg-white rounded-xl shadow-sm p-6">
      <!-- 1) H1 -->
      <h1 class="text-3xl font-extrabold mb-2">vitamin calculator</h1>

      <!-- 2) Intro -->
      <p class="text-gray-700 mb-6">
        Enter your age, sex, and (if applicable) pregnancy/lactation status, then add daily vitamin intakes.
        The tool compares them against life-stage specific <strong>RDAs/AIs</strong> and checks <strong>Upper Intake Levels (UL)</strong>.
        Designed for dietitians, clinicians, and informed consumers who need a fast, transparent check.
      </p>

      <!-- 3) Calculator UI -->
      <section id="calculator-ui" class="space-y-6" aria-labelledby="calc-heading">
        <h2 id="calc-heading" class="text-xl font-bold">Your profile</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Age -->
          <div>
            <label for="age" class="block text-sm font-medium text-gray-800">Age (years) <span class="text-red-700">*</span></label>
            <div class="flex items-center gap-2">
              <input id="age" name="age" type="number" inputmode="numeric" min="0" step="1"
                     aria-required="true" aria-describedby="age-help age-error"
                     class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-0 focus:border-blue-600"
                     value="30" />
              <button type="button" id="age-help-btn" class="touch-target px-2 py-1 border rounded" aria-expanded="false" aria-controls="age-help">?</button>
            </div>
            <p id="age-help" class="text-gray-600 text-sm mt-1 hidden">
              Use chronological age. For infants, choose months below 1 year.
            </p>
            <p id="age-error" class="err" role="alert" aria-live="polite"></p>
          </div>

          <!-- Sex -->
          <div>
            <label for="sex" class="block text-sm font-medium text-gray-800">Sex <span class="text-red-700">*</span></label>
            <div class="flex items-center gap-2">
              <select id="sex" name="sex" aria-required="true" aria-describedby="sex-help"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-0 focus:border-blue-600">
                <option value="female">Female</option>
                <option value="male" selected>Male</option>
              </select>
              <button type="button" id="sex-help-btn" class="touch-target px-2 py-1 border rounded" aria-expanded="false" aria-controls="sex-help">?</button>
            </div>
            <p id="sex-help" class="text-gray-600 text-sm mt-1 hidden">
              Select biological sex for DRI life-stage groups used by reference bodies.
            </p>
          </div>

          <!-- Life stage -->
          <div>
            <label for="lifestage" class="block text-sm font-medium text-gray-800">Life stage</label>
            <div class="flex items-center gap-2">
              <select id="lifestage" name="lifestage" aria-describedby="ls-help"
                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-0 focus:border-blue-600">
                <option value="general" selected>General (not pregnant/lactating)</option>
                <option value="pregnancy">Pregnancy</option>
                <option value="lactation">Lactation</option>
              </select>
              <button type="button" id="ls-help-btn" class="touch-target px-2 py-1 border rounded" aria-expanded="false" aria-controls="ls-help">?</button>
            </div>
            <p id="ls-help" class="text-gray-600 text-sm mt-1 hidden">
              Applies only to females of reproductive age; otherwise leave as General.
            </p>
          </div>
        </div>

        <h2 class="text-xl font-bold">Enter your daily vitamin intakes</h2>
        <p class="text-gray-600 -mt-2">Leave blank to ignore a vitamin. Units are pre-set to the standard DRI units (µg RAE, µg DFE, mg, or µg).</p>

        <!-- Intake grid -->
        <div class="overflow-x-auto border rounded-lg">
          <table class="min-w-full text-sm">
            <thead class="bg-gray-100 text-left">
              <tr>
                <th class="px-4 py-2">Vitamin</th>
                <th class="px-4 py-2">Your Intake</th>
                <th class="px-4 py-2">Unit</th>
                <th class="px-4 py-2">RDA/AI</th>
                <th class="px-4 py-2">UL</th>
                <th class="px-4 py-2">% of RDA/AI</th>
                <th class="px-4 py-2">Status</th>
              </tr>
            </thead>
            <tbody id="vit-body" class="[&>tr:nth-child(even)]:bg-gray-50">
              <!-- Rows injected by JS -->
            </tbody>
          </table>
        </div>

        <div class="flex flex-wrap gap-3">
          <button id="reset-btn" type="button" class="touch-target px-4 py-2 rounded-md bg-gray-100 border hover:bg-gray-200">Reset</button>
          <button id="fill-example-btn" type="button" class="touch-target px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Load example day</button>
        </div>
      </section>

      <!-- 4) Results -->
      <section id="results-panel" class="mt-8" aria-labelledby="results-heading">
        <h2 id="results-heading" class="text-xl font-bold mb-3">Results overview</h2>
        <div id="results-cards" class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="result-card border rounded-lg p-4">
            <h4>Vitamins below RDA/AI</h4>
            <p id="low-count" class="text-red-700">0</p>
          </div>
          <div class="result-card border rounded-lg p-4">
            <h4>Vitamins above UL</h4>
            <p id="high-count" class="text-amber-700">0</p>
          </div>
          <div class="result-card border rounded-lg p-4">
            <h4>All good</h4>
            <p id="ok-count" class="text-green-700">0</p>
          </div>
        </div>

        <details class="mt-6">
          <summary class="font-semibold cursor-pointer">Show compact status list</summary>
          <ul id="status-list" class="mt-3 list-disc list-inside text-sm text-gray-700"></ul>
        </details>
      </section>

      <!-- 5) Authoritative Ecosystem -->
      <section class="prose mt-10">
        <h2>Authoritative data source & methodology</h2>
        <p>
          Primary reference: <strong>Dietary Reference Intakes (DRIs)</strong> by the National Academies (Institute of Medicine/Health and Medicine Division) and
          <strong>NIH Office of Dietary Supplements (ODS)</strong> fact sheets. Selected life-stage values align to RDA or AI where applicable; ULs are included when defined.
          <br>
          Key portals:
          <a class="text-blue-700 underline" href="https://ods.od.nih.gov/HealthInformation/nutrientrecommendations.aspx" rel="nofollow">NIH ODS—Nutrient Recommendations</a>,
          <a class="text-blue-700 underline" href="https://www.nal.usda.gov/human-nutrition-and-food-safety/dri-calculator" rel="nofollow">USDA DRI Calculator</a>,
          <a class="text-blue-700 underline" href="https://www.nrv.gov.au/" rel="nofollow">Australian NRVs portal</a>.
        </p>
        <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          \[
            \text{Percent of Requirement}~(\%) = \frac{\text{Your Intake}}{\text{RDA or AI for your life stage}} \times 100
          \]
          \[
            \text{UL Check}:~~ \text{Flag High if}~~ \text{Your Intake} > \text{UL (if defined)}
          \]
        </div>

        <h2>Glossary of variables</h2>
        <ul>
          <li><strong>Your Intake</strong>: Estimated daily amount you consume from food + supplements.</li>
          <li><strong>RDA (Recommended Dietary Allowance)</strong>: Average daily level sufficient for ~97–98% of healthy individuals.</li>
          <li><strong>AI (Adequate Intake)</strong>: Used when evidence is insufficient for an RDA.</li>
          <li><strong>UL (Upper Intake Level)</strong>: Highest daily intake unlikely to pose risk.</li>
          <li><strong>% of RDA/AI</strong>: Intake as a percentage of your life-stage reference value.</li>
        </ul>

        <h2>How it works: a step-by-step example</h2>
        <h3>Example day (Male, 30 years, General)</h3>
        <p>Suppose your estimated intakes are: Vitamin C = 60 mg, Vitamin D = 15 µg, Folate = 320 µg DFE, Vitamin B12 = 2.4 µg.</p>
        <p>If the RDA/AI values are: C = 90 mg, D = 15 µg, Folate = 400 µg DFE, B12 = 2.4 µg, then:</p>
        <div class="formula-box">
          \[
            \%C = \frac{60}{90}\times 100 \approx 67\% \quad (Low) \\
            \%D = \frac{15}{15}\times 100 = 100\% \quad (OK) \\
            \%\text{Folate} = \frac{320}{400}\times 100 = 80\% \quad (Low) \\
            \%\text{B12} = \frac{2.4}{2.4}\times 100 = 100\% \quad (OK)
          \]
        </div>
        <p>
          The tool will flag Vitamin C and Folate as <span class="chip chip-low">Low</span>. If any intake exceeds a defined UL, it is flagged
          <span class="chip chip-high">High</span>.
        </p>

        <h2>Frequently asked questions</h2>
        <details>
          <summary>Are RDAs and AIs the same?</summary>
          <p>No. RDAs have stronger evidence; AIs are set when data are insufficient. The tool displays whichever applies.</p>
        </details>
        <details>
          <summary>What is a UL and why does it matter?</summary>
          <p>It’s a safety cap. Regularly exceeding a UL may increase adverse effect risks, especially with supplements.</p>
        </details>
        <details>
          <summary>Can I switch units?</summary>
          <p>Units follow DRI conventions (e.g., vitamin A in µg RAE, folate in µg DFE). This avoids conversion ambiguity.</p>
        </details>
        <details>
          <summary>Does sunlight change vitamin D requirements?</summary>
          <p>DRIs assume minimal sun exposure. Individual synthesis varies; consult local guidance and clinicians.</p>
        </details>
        <details>
          <summary>Will this diagnose deficiency or toxicity?</summary>
          <p>No. It’s an educational estimator. For medical advice, see a qualified professional.</p>
        </details>

        <div class="mt-6 p-4 bg-gray-50 border rounded text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-29">October 29, 2025</time></p>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="https://calcdomain.com/about.html" class="hover:text-blue-700">About</a>
        <a href="https://calcdomain.com/contact.html" class="hover:text-blue-700">Contact</a>
        <a href="https://calcdomain.com/privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="https://calcdomain.com/terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- ====== DATA + LOGIC (defer) ====== -->
  <script defer>
  // --- Reference tables (concise DRI set for adults/children; units per DRI conventions) ---
  // Values are illustrative, aligned with common DRI tables; adjust/expand as needed.
  // Keys for vitamins: id, label, unit, rdaAI by life-stage group, UL (if available). Ages in years.
  const DRI = [
    { id:'A',  label:'Vitamin A (RAE)', unit:'µg RAE',
      rdaAI:[
        {min:0, max:0.49, male:400, female:400, pregnancy:null, lactation:null}, // 0-6 mo AI
        {min:0.5, max:0.99, male:500, female:500, pregnancy:null, lactation:null}, // 7-12 mo AI
        {min:1, max:3, male:300, female:300, pregnancy:null, lactation:null},
        {min:4, max:8, male:400, female:400, pregnancy:null, lactation:null},
        {min:9, max:13, male:600, female:600, pregnancy:null, lactation:null},
        {min:14, max:18, male:900, female:700, pregnancy:750, lactation:1200},
        {min:19, max:150, male:900, female:700, pregnancy:770, lactation:1300}
      ],
      UL:[
        {min:1, max:3, val:600}, {min:4, max:8, val:900}, {min:9, max:13, val:1700},
        {min:14, max:18, val:2800}, {min:19, max:150, val:3000}
      ]
    },
    { id:'C',  label:'Vitamin C', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:15, female:15, pregnancy:null, lactation:null},
        {min:4, max:8, male:25, female:25, pregnancy:null, lactation:null},
        {min:9, max:13, male:45, female:45, pregnancy:null, lactation:null},
        {min:14, max:18, male:75, female:65, pregnancy:80, lactation:115},
        {min:19, max:150, male:90, female:75, pregnancy:85, lactation:120}
      ],
      UL:[
        {min:1, max:3, val:400}, {min:4, max:8, val:650}, {min:9, max:13, val:1200},
        {min:14, max:18, val:1800}, {min:19, max:150, val:2000}
      ]
    },
    { id:'D',  label:'Vitamin D (D3)', unit:'µg',
      rdaAI:[
        {min:1, max:12, male:10, female:10, pregnancy:null, lactation:null}, // 1–12 y: 15 µg commonly; using simplified bands
        {min:13, max:70, male:15, female:15, pregnancy:15, lactation:15},
        {min:71, max:150, male:20, female:20, pregnancy:20, lactation:20}
      ],
      UL:[
        {min:1, max:3, val:62.5}, {min:4, max:8, val:75}, {min:9, max:18, val:100},
        {min:19, max:150, val:100}
      ]
    },
    { id:'E',  label:'Vitamin E (α-TE)', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:6, female:6, pregnancy:null, lactation:null},
        {min:4, max:8, male:7, female:7, pregnancy:null, lactation:null},
        {min:9, max:13, male:11, female:11, pregnancy:null, lactation:null},
        {min:14, max:150, male:15, female:15, pregnancy:15, lactation:19}
      ],
      UL:[
        {min:1, max:3, val:200}, {min:4, max:8, val:300}, {min:9, max:13, val:600},
        {min:14, max:18, val:800}, {min:19, max:150, val:1000}
      ]
    },
    { id:'K',  label:'Vitamin K', unit:'µg',
      rdaAI:[
        {min:1, max:3, male:30, female:30, pregnancy:null, lactation:null},
        {min:4, max:8, male:55, female:55, pregnancy:null, lactation:null},
        {min:9, max:13, male:60, female:60, pregnancy:null, lactation:null},
        {min:14, max:18, male:75, female:75, pregnancy:75, lactation:75},
        {min:19, max:150, male:120, female:90, pregnancy:90, lactation:90}
      ],
      UL:[]
    },
    { id:'B1', label:'Thiamin (B1)', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:0.5, female:0.5, pregnancy:null, lactation:null},
        {min:4, max:8, male:0.6, female:0.6, pregnancy:null, lactation:null},
        {min:9, max:13, male:0.9, female:0.9, pregnancy:null, lactation:null},
        {min:14, max:18, male:1.2, female:1.0, pregnancy:1.4, lactation:1.4},
        {min:19, max:150, male:1.2, female:1.1, pregnancy:1.4, lactation:1.4}
      ],
      UL:[]
    },
    { id:'B2', label:'Riboflavin (B2)', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:0.5, female:0.5, pregnancy:null, lactation:null},
        {min:4, max:8, male:0.6, female:0.6, pregnancy:null, lactation:null},
        {min:9, max:13, male:0.9, female:0.9, pregnancy:null, lactation:null},
        {min:14, max:18, male:1.3, female:1.0, pregnancy:1.4, lactation:1.6},
        {min:19, max:150, male:1.3, female:1.1, pregnancy:1.4, lactation:1.6}
      ],
      UL:[]
    },
    { id:'B3', label:'Niacin (NE)', unit:'mg NE',
      rdaAI:[
        {min:1, max:3, male:6, female:6, pregnancy:null, lactation:null},
        {min:4, max:8, male:8, female:8, pregnancy:null, lactation:null},
        {min:9, max:13, male:12, female:12, pregnancy:null, lactation:null},
        {min:14, max:150, male:16, female:14, pregnancy:18, lactation:17}
      ],
      UL:[
        {min:1, max:3, val:10}, {min:4, max:8, val:15}, {min:9, max:13, val:20},
        {min:14, max:18, val:30}, {min:19, max:150, val:35}
      ]
    },
    { id:'B5', label:'Pantothenic acid (B5)', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:2, female:2, pregnancy:null, lactation:null},
        {min:4, max:8, male:3, female:3, pregnancy:null, lactation:null},
        {min:9, max:13, male:4, female:4, pregnancy:null, lactation:null},
        {min:14, max:150, male:5, female:5, pregnancy:6, lactation:7}
      ],
      UL:[]
    },
    { id:'B6', label:'Vitamin B6', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:0.5, female:0.5, pregnancy:null, lactation:null},
        {min:4, max:8, male:0.6, female:0.6, pregnancy:null, lactation:null},
        {min:9, max:13, male:1.0, female:1.0, pregnancy:null, lactation:null},
        {min:14, max:50, male:1.3, female:1.2, pregnancy:1.9, lactation:2.0},
        {min:51, max:150, male:1.7, female:1.5, pregnancy:1.9, lactation:2.0}
      ],
      UL:[
        {min:1, max:3, val:30}, {min:4, max:8, val:40}, {min:9, max:13, val:60},
        {min:14, max:18, val:80}, {min:19, max:150, val:100}
      ]
    },
    { id:'B7', label:'Biotin (B7)', unit:'µg',
      rdaAI:[
        {min:1, max:3, male:8, female:8, pregnancy:null, lactation:null},
        {min:4, max:8, male:12, female:12, pregnancy:null, lactation:null},
        {min:9, max:13, male:20, female:20, pregnancy:null, lactation:null},
        {min:14, max:150, male:30, female:30, pregnancy:30, lactation:35}
      ],
      UL:[]
    },
    { id:'B9', label:'Folate (DFE)', unit:'µg DFE',
      rdaAI:[
        {min:1, max:3, male:150, female:150, pregnancy:null, lactation:null},
        {min:4, max:8, male:200, female:200, pregnancy:null, lactation:null},
        {min:9, max:13, male:300, female:300, pregnancy:null, lactation:null},
        {min:14, max:150, male:400, female:400, pregnancy:600, lactation:500}
      ],
      UL:[
        {min:1, max:3, val:300}, {min:4, max:8, val:400}, {min:9, max:13, val:600},
        {min:14, max:150, val:1000}
      ]
    },
    { id:'B12', label:'Vitamin B12', unit:'µg',
      rdaAI:[
        {min:1, max:3, male:0.9, female:0.9, pregnancy:null, lactation:null},
        {min:4, max:8, male:1.2, female:1.2, pregnancy:null, lactation:null},
        {min:9, max:13, male:1.8, female:1.8, pregnancy:null, lactation:null},
        {min:14, max:150, male:2.4, female:2.4, pregnancy:2.6, lactation:2.8}
      ],
      UL:[]
    },
    { id:'Choline', label:'Choline', unit:'mg',
      rdaAI:[
        {min:1, max:3, male:200, female:200, pregnancy:null, lactation:null},
        {min:4, max:8, male:250, female:250, pregnancy:null, lactation:null},
        {min:9, max:13, male:375, female:375, pregnancy:null, lactation:null},
        {min:14, max:18, male:550, female:400, pregnancy:450, lactation:550},
        {min:19, max:150, male:550, female:425, pregnancy:450, lactation:550}
      ],
      UL:[
        {min:1, max:3, val:1000}, {min:4, max:8, val:1000}, {min:9, max:13, val:2000},
        {min:14, max:18, val:3000}, {min:19, max:150, val:3500}
      ]
    }
  ];

  // --- State & helpers ---
  const els = {};
  function q(id){ return document.getElementById(id); }
  function show(id,flag){ const el=q(id); if(!el) return; el.classList.toggle('hidden',!flag); }
  function fmt(x){ if(x==null || Number.isNaN(x)) return '—'; return new Intl.NumberFormat().format(x); }
  function findLifeStage(age, sex, stage, rows){
    // pick the last row where min<=age<=max
    const row = rows.slice().reverse().find(r => age>=r.min && age<=r.max) || rows[rows.length-1];
    if(stage==='pregnancy') return row.pregnancy ?? row.female ?? row.male;
    if(stage==='lactation') return row.lactation ?? row.female ?? row.male;
    return sex==='female' ? (row.female ?? row.male) : (row.male ?? row.female);
  }
  function findUL(age, ULrows){
    if(!ULrows || ULrows.length===0) return null;
    const row = ULrows.slice().reverse().find(r => age>=r.min && age<=r.max) || ULrows[ULrows.length-1];
    return row?.val ?? null;
  }
  function statusBadge(pct, overUL){
    if(overUL) return '<span class="chip chip-high">High</span>';
    if(pct < 90) return '<span class="chip chip-low">Low</span>';
    return '<span class="chip chip-ok">OK</span>';
  }

  function validateAge(){
    const age = Number(els.age.value);
    const err = q('age-error');
    err.textContent = '';
    if(Number.isNaN(age) || age < 0 || age > 150){
      err.textContent = 'Enter an age between 0 and 150 years.';
      return false;
    }
    return true;
  }

  function buildTable(){
    const tbody = q('vit-body');
    tbody.innerHTML = '';
    DRI.forEach(v => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="px-4 py-2 font-medium">${v.label}</td>
        <td class="px-4 py-2">
          <input type="number" inputmode="decimal" min="0" step="0.1"
                 class="w-32 px-2 py-1 border rounded-md focus:border-blue-600"
                 aria-label="Your intake for ${v.label}"
                 data-vit="${v.id}"/>
        </td>
        <td class="px-4 py-2 text-gray-700">${v.unit}</td>
        <td class="px-4 py-2"><span data-vit="${v.id}-rda">—</span></td>
        <td class="px-4 py-2"><span data-vit="${v.id}-ul">—</span></td>
        <td class="px-4 py-2"><span data-vit="${v.id}-pct">—</span></td>
        <td class="px-4 py-2"><span data-vit="${v.id}-status" class="chip">—</span></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function recalc(){
    if(!validateAge()) return;

    const age = Number(els.age.value);
    const sex = els.sex.value;
    const stage = els.lifestage.value;

    let low=0, high=0, ok=0;
    const statuses = [];

    DRI.forEach(v => {
      const intakeEl = document.querySelector(`input[data-vit="${v.id}"]`);
      const intake = Number(intakeEl.value || 0);
      const rda = findLifeStage(age, sex, stage, v.rdaAI);
      const ul  = findUL(age, v.UL);

      q(`${v.id}-rda`)?.replaceWith(Object.assign(document.createElement('span'), {id:`${v.id}-rda`, textContent: rda ? `${fmt(rda)} ${v.unit}`:'—'}));
      q(`${v.id}-ul`)?.replaceWith(Object.assign(document.createElement('span'), {id:`${v.id}-ul`, textContent: ul ? `${fmt(ul)} ${v.unit}`:'—'}));

      const pct = (rda && intake>0) ? (intake / rda * 100) : (intake===0 ? null : 0);
      const overUL = (ul && intake > ul) ? true : false;

      let pctText = '—';
      if(pct===null){ pctText = '—'; }
      else { pctText = `${Math.round(pct)}%`; }

      q(`${v.id}-pct`)?.replaceWith(Object.assign(document.createElement('span'), {id:`${v.id}-pct`, textContent: pctText}));
      const statusHTML = statusBadge(pct ?? 0, overUL);
      const statusSpan = document.createElement('span');
      statusSpan.id = `${v.id}-status`;
      statusSpan.innerHTML = statusHTML;
      const oldStatus = document.querySelector(`span[data-vit="${v.id}-status"]`) || q(`${v.id}-status`);
      if(oldStatus) oldStatus.replaceWith(statusSpan);

      // Tally
      if(overUL){ high++; statuses.push(`${v.label}: High`); }
      else if((pct ?? 100) < 90 && intake>0){ low++; statuses.push(`${v.label}: Low`); }
      else if(intake>0){ ok++; statuses.push(`${v.label}: OK`); }
    });

    q('low-count').textContent = low;
    q('high-count').textContent = high;
    q('ok-count').textContent = ok;

    // status list
    const ul = q('status-list');
    ul.innerHTML = '';
    statuses.forEach(s => {
      const li = document.createElement('li');
      li.textContent = s;
      ul.appendChild(li);
    });
  }

  function wire(){
    els.age = q('age'); els.sex = q('sex'); els.lifestage = q('lifestage');
    ['blur','change','input'].forEach(evt => {
      els.age.addEventListener(evt, recalc);
      els.sex.addEventListener(evt, recalc);
      els.lifestage.addEventListener(evt, recalc);
    });

    // Inline validation on blur
    els.age.addEventListener('blur', validateAge);

    // Help tooltips (click/keyboard toggle)
    function toggle(btnId, panelId){
      const b = q(btnId), p = q(panelId);
      b.addEventListener('click', () => {
        const expanded = b.getAttribute('aria-expanded') === 'true';
        b.setAttribute('aria-expanded', (!expanded).toString());
        p.classList.toggle('hidden', expanded);
      });
      b.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); b.click(); }});
    }
    toggle('age-help-btn','age-help');
    toggle('sex-help-btn','sex-help');
    toggle('ls-help-btn','ls-help');

    // Inputs in table
    document.getElementById('vit-body').addEventListener('input', (e)=>{
      if(e.target.matches('input[type="number"]')){
        const val = Number(e.target.value);
        if(val < 0){ e.target.value = ''; }
        recalc();
      }
    });

    q('reset-btn').addEventListener('click', ()=>{
      document.querySelectorAll('#vit-body input[type="number"]').forEach(i=> i.value = '');
      recalc();
    });

    q('fill-example-btn').addEventListener('click', ()=>{
      // Example fills some common vitamins
      const set = (id,val) => { const el=document.querySelector(`input[data-vit="${id}"]`); if(el) el.value = val; }
      set('C',60); set('D',15); set('B9',320); set('B12',2.4); set('A',700); set('E',10);
      recalc();
    });
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    buildTable();
    // add id hooks to newly created spans for rda/ul/pct/status
    DRI.forEach(v=>{
      // Ensure id attributes exist after buildTable()
      const rdaSpan = document.querySelector(`[data-vit="${v.id}-rda"]`) || document.createElement('span');
      rdaSpan.id = `${v.id}-rda`;
      const ulSpan = document.querySelector(`[data-vit="${v.id}-ul"]`) || document.createElement('span');
      ulSpan.id = `${v.id}-ul`;
      const pctSpan = document.querySelector(`[data-vit="${v.id}-pct"]`) || document.createElement('span');
      pctSpan.id = `${v.id}-pct`;
      const stSpan = document.querySelector(`[data-vit="${v.id}-status"]`) || document.createElement('span');
      stSpan.id = `${v.id}-status`;
    });
    wire();
    recalc();
  });
  </script>
</body>
</html>
