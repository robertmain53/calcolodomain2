<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peer to Peer Loan Calculator - Calculate P2P Loan Payments & APR</title>
<meta name="description" content="Calculate your Peer-to-Peer (P2P) loan payment, total interest, and the true APR including origination fees. Get a full amortization schedule.">
<link rel="canonical" href="https://calcdomain.com/peer-to-peer-loan-calculator.html"/>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.prose strong { font-weight: 600; }
.prose code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #f3f4f6; padding: 0.2em 0.4em; border-radius: 6px; }

/* LaTeX Formula Box */
.formula-box {
background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 8px; padding: 1.5rem;
overflow-x: auto; text-align: center; font-size: 1.125rem;
}

/* FAQ Details/Summary Styling */
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }

/* Result Card Styling */
.result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; text-transform: uppercase; font-weight: 500; }
.result-card p { font-size: 1.75rem; font-weight: 700; color: #2563eb; }
.result-card-apr p { color: #d9463e; } /* Highlight APR */

/* CLS Prevention */
#results-grid { min-height: 150px; }
#results-chart-container { min-height: 160px; }
#scheduleContainer { min-height: 200px; }

/* Accessibility & Form Enhancements */
/* Visible focus ring for keyboard users (WCAG 2.4.7) */
:focus-visible {
outline: 3px solid #3b82f6;
outline-offset: 2px;
border-radius: 2px;
}
/* Hide native spinner on number inputs */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
input[type=number] { -moz-appearance: textfield; }

/* Accessible Tooltip */
.tooltip-btn {
display: inline-flex;
align-items: center;
justify-content: center;
width: 20px;
height: 20px;
border-radius: 9999px;
background: #e5e7eb;
color: #6b7280;
border: 1px solid #d1d5db;
font-weight: 700;
font-style: italic;
cursor: pointer;
margin-left: 4px;
}
.tooltip-text {
display: none;
background: #1f2937;
color: #f9fafb;
padding: 0.5rem 0.75rem;
border-radius: 6px;
font-size: 0.875rem;
margin-top: 0.5rem;
position: relative;
z-index: 10;
width: 100%;
}
.tooltip-text[aria-hidden="false"] {
display: block;
}

/* Error Message Styling (WCAG 3.3.1) */
.error-message {
color: #dc2626;
font-size: 0.875rem;
margin-top: 0.5rem;
}
input[aria-invalid="true"] {
border-color: #dc2626;
box-shadow: 0 0 0 1px #dc2626;
}

/* Print Styles */
@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
#results-chart-container, .no-print { display: none !important; }
}
</style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Peer to Peer Loan Calculator",
  "description": "Calculate your Peer-to-Peer (P2P) loan payment, total interest, and the true APR including origination fees. Get a full amortization schedule.",
  "url": "https://calcdomain.com/peer-to-peer-loan-calculator.html",
  "inLanguage": "en",
  "author": { "@type": "Person", "name": "Ugo Candido" },
  "publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
    { "@type": "ListItem", "position": 2, "name": "Finance", "item": "https://calcdomain.com/finance.html" },
    { "@type": "ListItem", "position": 3, "name": "Loans & Debt", "item": "https://calcdomain.com/subcategories/finance-loans-debt.html" },
    { "@type": "ListItem", "position": 4, "name": "Peer to Peer Loan Calculator", "item": "https://calcdomain.com/peer-to-peer-loan-calculator.html" }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Use the Peer-to-Peer (P2P) Loan Calculator",
  "description": "A step-by-step guide to calculating the true cost of a P2P loan, including payments, interest, and APR.",
  "step": [
    {"@type": "HowToStep", "name": "Enter Loan Amount", "text": "Input the total amount you wish to borrow."},
    {"@type": "HowToStep", "name": "Enter Interest Rate", "text": "Input the annual 'note rate' offered by the P2P platform (this is NOT the APR)."},
    {"@type": "HowToStep", "name": "Enter Loan Term", "text": "Provide the length of the loan in either years or months."},
    {"@type": "HowToStep", "name": "Enter Origination Fees", "text": "Input the platform's origination fee, either as a percentage of the loan amount or a flat dollar amount. This is critical for an accurate APR."},
    {"@type": "HowToStep", "name": "Review Results", "text": "The calculator will display your monthly payment, total interest, total cost, and the effective APR, which represents the true cost of your loan."}
  ]
}
</script>
<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
  <nav class="container mx-auto px-4 lg:px-6 py-4">
    <div class="flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

      <div class="w-full max-w-md hidden md:block mx-8">
        <div class="relative">
          <input type="search" id="search-input" placeholder="Search for a calculator..."
            class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
            autocomplete="off">
          <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
            fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
        </div>
      </div>

      <div class="hidden md:flex items-center space-x-6 text-sm">
        <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
      </div>

      <button id="mobile-menu-toggle" class="md:hidden p-2 no-print" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <div id="mobile-menu" class="md:hidden mt-4 hidden">
      <div class="space-y-2">
        <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
      </div>
    </div>
  </nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
  <div class="flex flex-col lg:flex-row gap-8">

    <section class="w-full lg:w-2/3">
      <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
        <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
        <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
        <a href="subcategories/finance-loans-debt.html" class="hover:text-blue-600">Loans &amp; Debt</a> &raquo;
        <span class="text-gray-900">Peer to Peer Loan Calculator</span>
      </nav>

      <div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
        
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Peer to Peer Loan Calculator</h1>
        <p class="text-gray-600 mb-6">
          This tool helps you understand the true cost of a Peer-to-Peer (P2P) loan. Enter your loan details, including any
          platform origination fees, to accurately calculate your monthly payment, total interest, and the effective Annual Percentage Rate (APR).
        </p>

        <form id="calculator-ui" class="space-y-6" novalidate onsubmit="return false;">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
            
            <div>
              <label for="loanAmount" class="block text-sm font-medium text-gray-700">Loan Amount <span class="text-red-600">*</span></label>
              <div class="mt-1 relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <span class="text-gray-500">$</span>
                </div>
                <input type="number" id="loanAmount" value="10000" step="100" min="1"
                  class="pl-7 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                  aria-required="true" aria-describedby="loanAmount-error">
              </div>
              <span id="loanAmount-error" class="error-message" role="alert" aria-live="assertive"></span>
            </div>

            <div>
              <label for="interestRate" class="block text-sm font-medium text-gray-700">Annual Interest Rate (Note Rate) <span class="text-red-600">*</span></label>
              <div class="mt-1 relative">
                <input type="number" id="interestRate" value="7.5" step="0.01" min="0"
                  class="pr-8 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                  aria-required="true" aria-describedby="interestRate-error">
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                  <span class="text-gray-500">%</span>
                </div>
              </div>
              <span id="interestRate-error" class="error-message" role="alert" aria-live="assertive"></span>
            </div>
            
            <div class="grid grid-cols-3 gap-2">
              <div class="col-span-2">
                <label for="loanTerm" class="block text-sm font-medium text-gray-700">Loan Term <span class="text-red-600">*</span></label>
                <input type="number" id="loanTerm" value="3" step="1" min="1"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                  aria-required="true" aria-describedby="loanTerm-error">
              </div>
              <div>
                <label for="termUnits" class="block text-sm font-medium text-gray-700">Unit</label>
                <select id="termUnits"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                  <option value="years" selected>Years</option>
                  <option value="months">Months</option>
                </select>
              </div>
            </div>
             <span id="loanTerm-error" class="error-message md:col-span-2" role="alert" aria-live="assertive"></span>

            <div>
              <label for="originationFeePercent" class="block text-sm font-medium text-gray-700">
                Origination Fee (%)
                <button type="button" class="tooltip-btn no-print" aria-label="About Origination Fee Percent" aria-describedby="feePercent-tooltip" aria-expanded="false" data-tooltip="feePercent-tooltip">?</button>
              </label>
              <div class="mt-1 relative">
                <input type="number" id="originationFeePercent" value="3" step="0.1" min="0"
                  class="pr-8 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                  aria-describedby="originationFeePercent-error feePercent-tooltip">
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                  <span class="text-gray-500">%</span>
                </div>
              </div>
              <span id="originationFeePercent-error" class="error-message" role="alert" aria-live="assertive"></span>
              <span id="feePercent-tooltip" role="tooltip" class="tooltip-text" aria-hidden="true">
                The one-time fee the P2P platform charges, calculated as a percentage of the loan amount.
              </span>
            </div>

            <div>
              <label for="originationFeeFlat" class="block text-sm font-medium text-gray-700">
                Origination Fee ($)
                <button type="button" class="tooltip-btn no-print" aria-label="About Flat Origination Fee" aria-describedby="feeFlat-tooltip" aria-expanded="false" data-tooltip="feeFlat-tooltip">?</button>
              </label>
              <div class="mt-1 relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <span class="text-gray-500">$</span>
                </div>
                <input type="number" id="originationFeeFlat" value="0" step="10" min="0"
                  class="pl-7 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                  aria-describedby="originationFeeFlat-error feeFlat-tooltip">
              </div>
              <span id="originationFeeFlat-error" class="error-message" role="alert" aria-live="assertive"></span>
              <span id="feeFlat-tooltip" role="tooltip" class="tooltip-text" aria-hidden="true">
                A flat, one-time fee charged by the platform. This is added to any percentage-based fee.
              </span>
            </div>
            
            <div>
              <label for="startDate" class="block text-sm font-medium text-gray-700">First Payment Date <span class="text-red-600">*</span></label>
              <input type="month" id="startDate"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                aria-required="true" aria-describedby="startDate-error">
              <span id="startDate-error" class="error-message" role="alert" aria-live="assertive"></span>
            </div>
            
          </div>
          
          <div class="flex items-center justify-between space-x-4 pt-2 no-print">
            <button type="button" id="calculateBtn" class="w-full py-3 px-6 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Calculate
            </button>
            <button type="button" id="resetBtn" class="w-auto py-3 px-4 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
              Reset
            </button>
          </div>
        </form>

        <div id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6" aria-live="polite">
          <h2 class="text-xl font-semibold text-gray-900 mb-4 text-center">Your P2P Loan Results</h2>
          <div class="flex flex-col md:flex-row gap-6">
            
            <div id="results-grid" class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="result-card">
                <h4>Monthly Payment</h4>
                <p id="monthlyPayment">$0.00</p>
              </div>
              <div class="result-card result-card-apr">
                <h4>Effective APR</h4>
                <p id="effectiveAPR">0.000%</p>
              </div>
              <div class="result-card">
                <h4>Total Interest</h4>
                <p id="totalInterest">$0.00</p>
              </div>
              <div class="result-card">
                <h4>Total Cost</h4>
                <p id="totalCost">$0.00</p>
              </div>
            </div>
            
            <div class="w-full md:w-1/3">
              <div id="results-chart-container" class="h-40 md:h-full">
                <canvas id="resultsChart" aria-label="Cost breakdown: Principal, Interest, and Fees"></canvas>
              </div>
            </div>
          </div>

          <details class="mt-6 bg-white rounded-lg no-print" id="scheduleDetails">
            <summary class="font-semibold text-gray-800 p-4">View Full Amortization Schedule</summary>
            <div class="overflow-x-auto border border-gray-200 rounded-b-lg" id="scheduleContainer">
              <table class="min-w-full text-sm text-right">
                <thead class="bg-gray-100 text-gray-700 uppercase">
                  <tr>
                    <th class="px-4 py-2 text-left">#</th>
                    <th class="px-4 py-2 text-left">Date</th>
                    <th class="px-4 py-2">Payment</th>
                    <th class="px-4 py-2">Interest</th>
                    <th class="px-4 py-2">Principal</th>
                    <th class="px-4 py-2">Balance</th>
                  </tr>
                </thead>
                <tbody id="scheduleBody">
                  <tr><td colspan="6" class="text-center p-6 text-gray-500">Enter your loan details to generate a schedule.</td></tr>
                </tbody>
              </table>
            </div>
          </details>
        </div>
      </div>

      <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
        
        <h2>Data Source and Methodology</h2>
        <p>
          This calculator determines the monthly payment for a fixed-rate amortizing loan and computes the 
          <strong>Annual Percentage Rate (APR)</strong> based on the loan's interest rate and financed origination fees.
        </p>
        <p>
          The methodology for calculating APR strictly adheres to the standards set by the
          <strong>U.S. Truth in Lending Act (Regulation Z)</strong>.
          This regulation ensures that the advertised cost of credit is transparent and uniform,
          allowing consumers to accurately compare different loan offers.
        </p>
        <ul>
          <li><strong>Authoritative Source:</strong> U.S. Consumer Financial Protection Bureau (CFPB)</li>
          <li><strong>Reference:</strong> 12 C.F.R. Part 1026 (Regulation Z)</li>
          <li><strong>Link:</strong> <a href="https://www.consumerfinance.gov/rules-policy/regulations/1026/" target="_blank" rel="noopener nofollow">consumerfinance.gov/rules-policy/regulations/1026/</a></li>
        </ul>
        <p>All calculations are based rigorously on the formulas derived from this source.</p>

        <h2>The Formulas Explained</h2>
        <p>
          The calculator first determines your fixed monthly payment (M) using the standard amortization formula.
        </p>
        <div class="formula-box" aria-label="Monthly Payment Formula">
          $$ M = P \frac{r(1+r)^n}{(1+r)^n - 1} $$
        </div>
        <p>
          It then calculates the APR, which is the "true" annual cost of your loan. The APR is the interest rate
          that makes the present value of all your monthly payments equal to the amount you actually received
          (the loan amount *minus* the origination fees).
        </p>
        <div class="formula-box" aria-label="APR Formula (Present Value)">
          $$ \text{Net Proceeds} = \sum_{k=1}^{n} \frac{M}{(1 + i)^k} $$
        </div>
        <p>Where the calculator solves for $i$ (the periodic APR) and then multiplies by 12 to get the annual APR.</p>

        <h2>Glossary of Variables</h2>
        <dl>
          <dt><strong>Loan Amount (P)</strong></dt>
          <dd class="mb-2">The total principal amount you are borrowing.</dd>
          
          <dt><strong>Annual Interest Rate (Note Rate)</strong></dt>
          <dd class="mb-2">The stated interest rate of the loan, used to calculate interest payments. This is *not* the APR.</dd>
          
          <dt><strong>Loan Term (n)</strong></dt>
          <dd class="mb-2">The total number of payments (e.g., 3 years = 36 monthly payments).</dd>

          <dt><strong>Monthly Interest Rate (r)</strong></dt>
          <dd class="mb-2">The annual rate divided by 12.</dd>

          <dt><strong>Origination Fee</strong></dt>
          <dd class="mb-2">A one-time fee charged by the P2P platform to process your loan. This fee is subtracted from your loan amount, but you still pay interest on the full amount.</dd>

          <dt><strong>Net Proceeds</strong></dt>
          <dd class="mb-2">The cash you actually receive: <code>Loan Amount - Origination Fee</code>.</dd>
          
          <dt><strong>Monthly Payment (M)</strong></dt>
          <dd class="mb-2">The fixed amount you pay each month, which includes both principal and interest.</dd>
          
          <dt><strong>Effective APR (i)</strong></dt>
          <dd class="mb-2">The Annual Percentage Rate. This is the true, effective cost of your loan, expressed as an annual rate, because it accounts for the origination fee. It will always be higher than your Note Rate if a fee is charged.</dd>
        </dl>
        
        <h2>How It Works: A Step-by-Step Example</h2>
        <p>Let's walk through a realistic scenario:</p>
        <ul>
          <li><strong>Loan Amount:</strong> $10,000</li>
          <li><strong>Annual Interest Rate:</strong> 7.5%</li>
          <li><strong>Loan Term:</strong> 3 Years (36 months)</li>
          <li><strong>Origination Fee:</strong> 3% ($300)</li>
        </ul>
        <ol>
          <li><strong>Calculate Monthly Payment:</strong> First, we find the payment based on the full $10,000.
            <ul>
              <li>$P = 10000$</li>
              <li>$r = 0.075 / 12 = 0.00625$</li>
              <li>$n = 36$</li>
              <li>Using the formula $M = P \frac{r(1+r)^n}{(1+r)^n - 1}$, the <strong>Monthly Payment (M) is $311.06</strong>.</li>
            </ul>
          </li>
          <li><strong>Calculate Net Proceeds:</strong> You don't receive the full $10,000.
            <ul>
              <li><code>$10,000 (Loan) - $300 (Fee) = $9,700</code>. You only get $9,700 in cash.</li>
            </ul>
          </li>
          <li><strong>Calculate APR:</strong> The calculator now finds the interest rate that makes 36 payments of $311.06 equal to a present value of $9,700.
            <ul>
              <li>This calculation reveals an <strong>Effective APR of 9.516%</strong>.</li>
            </ul>
          </li>
        </ol>
        <p>
          As you can see, while your "note rate" was 7.5%, the 3% fee increased the *true cost* of your loan to over 9.5%.
          This is why comparing loans by APR, not just interest rate, is essential.
        </section>
        
        <h2>Frequently Asked Questions (FAQ)</h2>
        
        <details>
          <summary>What is a P2P origination fee?</summary>
          <p>It's a one-time, upfront fee charged by the P2P lending platform (like LendingClub or Prosper) to cover the costs of underwriting and processing your loan. It's typically deducted directly from your loan proceeds, so you receive less cash than the amount you borrowed.</p>
        </details>
        
        <details>
          <summary>Why is the APR higher than the interest rate?</summary>
          <p>The APR (Annual Percentage Rate) includes both the interest *and* any mandatory fees, like the origination fee. The "interest rate" (or "note rate") only reflects the cost of the interest. Because the APR factors in the fee, it is a more accurate measure of the loan's total cost.</p>
        </details>
        
        <details>
          <summary>Are P2P loan rates fixed or variable?</summary>
          <p>Most P2P personal loans offer fixed interest rates. This means your interest rate and monthly payment will not change for the life of the loan, making it easier to budget.</p>
        </details>

        <details>
          <summary>Can I prepay a P2P loan without penalty?</summary>
          <p>In most cases, yes. The vast majority of P2P platforms for personal loans do not charge prepayment penalties. This means you can pay off your loan early to save on interest without incurring an extra fee. You should always confirm this in your loan agreement.</p>
        </details>
        
        <details>
          <summary>How does this calculator differ from a personal loan calculator?</summary>
          <p>While the underlying amortization math is the same, this calculator is specifically designed to highlight the impact of P2P-specific costs, namely the **origination fee**, and prominently displays the **Effective APR**. A generic loan calculator may not have a field for this fee, thus underestimating the loan's true cost.</p>
        </details>

        <div class="mt-8 pt-6 border-t border-gray-200 text-sm text-gray-600">
          <p>
            <strong>Tool developed by Ugo Candido.</strong>
            Financial methodology and content reviewed by the CalcDomain Editorial Board for accuracy.
          </p>
          <p>
            Last accuracy review: <time datetime="2025-10-31">October 31, 2025</time>
          </p>
        </div>
      </article>
    </section>

    <aside class="w-full lg:w-1/3 no-print">
      <div class="sticky top-10 space-y-6">
        <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
          Ad Placement (300×600)
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
          <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
            <li>See the <strong>true cost (APR)</strong>, not just the interest rate.</li>
            <li>Understand the exact impact of origination fees.</li>
            <li>Generate a full, printable amortization schedule.</li>
            <li>Compare multiple P2P loan offers accurately.</li>
          </ul>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="font-bold text-lg mb-4">Related Loan Tools</h3>
          <ul class="space-y-3 text-sm">
            <li><a href="loan-amortization.html" class="text-blue-600 hover:underline">Loan Amortization Schedule</a></li>
            <li><a href="apr.html" class="text-blue-600 hover:underline">APR Calculator</a></li>
            <li><a href="personal-loan-calculator.html" class="text-blue-600 hover:underline">Personal Loan Calculator</a></li>
            <li><a href="loan-prepayment.html" class="text-blue-600 hover:underline">Loan Prepayment Planner</a></li>
          </ul>
        </div>
      </div>
    </aside>

  </div>
</main>

<footer class="bg-white border-t mt-12">
  <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
    <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
    <div class="mt-4 space-x-4">
      <a href="about.html" class="hover:text-blue-600">About</a>
      <a href="contact.html" class="hover:text-blue-600">Contact</a>
      <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
      <a href="terms.html" class="hover:text-blue-600">Terms</a>
    </div>
  </div>
</footer>

<script defer>
document.addEventListener('DOMContentLoaded', () => {

  // --- Element Cache ---
  const elements = {
    // Inputs
    loanAmount: document.getElementById('loanAmount'),
    interestRate: document.getElementById('interestRate'),
    loanTerm: document.getElementById('loanTerm'),
    termUnits: document.getElementById('termUnits'),
    originationFeePercent: document.getElementById('originationFeePercent'),
    originationFeeFlat: document.getElementById('originationFeeFlat'),
    startDate: document.getElementById('startDate'),
    // Outputs
    monthlyPayment: document.getElementById('monthlyPayment'),
    effectiveAPR: document.getElementById('effectiveAPR'),
    totalInterest: document.getElementById('totalInterest'),
    totalCost: document.getElementById('totalCost'),
    scheduleBody: document.getElementById('scheduleBody'),
    // UI
    form: document.getElementById('calculator-ui'),
    calculateBtn: document.getElementById('calculateBtn'),
    resetBtn: document.getElementById('resetBtn'),
    tooltipBtns: document.querySelectorAll('.tooltip-btn'),
    mobileMenuToggle: document.getElementById('mobile-menu-toggle'),
    mobileMenu: document.getElementById('mobile-menu')
  };

  let chartInstance = null;
  const today = new Date();
  elements.startDate.value = `${today.getFullYear()}-${(today.getMonth() + 2).toString().padStart(2, '0')}`;


  // --- Formatters ---
  const fmtCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val || 0);
  const fmtPercent = (val) => `${(val || 0).toFixed(3)}%`;


  // --- Validation Logic (WCAG 3.3.1) ---
  const validationRules = {
    loanAmount: { required: true, min: 1, msg: 'Please enter a valid loan amount.' },
    interestRate: { required: true, min: 0, msg: 'Please enter a valid interest rate.' },
    loanTerm: { required: true, min: 1, msg: 'Please enter a valid loan term.' },
    originationFeePercent: { required: false, min: 0, msg: 'Fee must be 0 or more.' },
    originationFeeFlat: { required: false, min: 0, msg: 'Fee must be 0 or more.' },
    startDate: { required: true, msg: 'Please select a start date.' }
  };

  function validateField(input) {
    const id = input.id;
    const rules = validationRules[id];
    if (!rules) return true;

    const value = input.value;
    const errorEl = document.getElementById(`${id}-error`);
    let isValid = true;
    let errorMsg = '';

    if (rules.required && !value) {
      isValid = false;
      errorMsg = rules.msg;
    } else if (rules.min !== undefined && parseFloat(value) < rules.min) {
      isValid = false;
      errorMsg = rules.msg;
    }

    if (!isValid) {
      input.setAttribute('aria-invalid', 'true');
      input.setAttribute('aria-describedby', `${id}-error`);
      errorEl.textContent = errorMsg;
      errorEl.style.display = 'block';
    } else {
      input.setAttribute('aria-invalid', 'false');
      errorEl.textContent = '';
      errorEl.style.display = 'none';
      // Restore default describedby (for tooltips)
      const tooltip = document.querySelector(`[data-tooltip][aria-describedby*="${id}"]`);
      if (tooltip) {
        input.setAttribute('aria-describedby', tooltip.getAttribute('aria-describedby'));
      } else {
        input.removeAttribute('aria-describedby');
      }
    }
    return isValid;
  }

  function validateForm() {
    let isFormValid = true;
    let firstInvalidField = null;

    Object.keys(validationRules).forEach(id => {
      const field = elements[id];
      if (field && !validateField(field)) {
        isFormValid = false;
        if (!firstInvalidField) {
          firstInvalidField = field;
        }
      }
    });

    if (firstInvalidField) {
      firstInvalidField.focus();
    }
    return isFormValid;
  }

  // --- Core Calculation Logic ---
  function calculateAmortization() {
    if (!validateForm()) {
      clearOutputs();
      return;
    }

    // 1. Get Inputs
    const principal = parseFloat(elements.loanAmount.value) || 0;
    const annualRate = (parseFloat(elements.interestRate.value) || 0) / 100;
    const termValue = parseFloat(elements.loanTerm.value) || 0;
    const termInMonths = elements.termUnits.value === 'years' ? termValue * 12 : termValue;
    const feePercent = (parseFloat(elements.originationFeePercent.value) || 0) / 100;
    const feeFlat = parseFloat(elements.originationFeeFlat.value) || 0;

    if (principal <= 0 || annualRate < 0 || termInMonths <= 0) {
      clearOutputs();
      return;
    }

    // 2. Calculate Fees & Monthly Payment
    const totalFee = (principal * feePercent) + feeFlat;
    const netProceeds = principal - totalFee;
    const monthlyRate = annualRate / 12;
    let monthlyPayment;

    if (monthlyRate === 0) {
      monthlyPayment = principal / termInMonths;
    } else {
      const pow = Math.pow(1 + monthlyRate, termInMonths);
      monthlyPayment = principal * (monthlyRate * pow) / (pow - 1);
    }
    
    // 3. Calculate Schedule & Totals
    const schedule = [];
    let remainingBalance = principal;
    let totalInterest = 0;
    const [startYear, startMonth] = elements.startDate.value.split('-').map(Number);
    
    for (let i = 1; i <= termInMonths; i++) {
      const interestPayment = remainingBalance * monthlyRate;
      const principalPayment = monthlyPayment - interestPayment;
      remainingBalance -= principalPayment;
      totalInterest += interestPayment;

      // Handle date logic
      const paymentDate = new Date(startYear, startMonth - 1, 1);
      paymentDate.setMonth(paymentDate.getMonth() + i);

      schedule.push({
        period: i,
        date: paymentDate,
        payment: monthlyPayment,
        interest: interestPayment,
        principal: principalPayment,
        balance: Math.abs(remainingBalance) < 0.01 ? 0 : remainingBalance
      });
    }

    // 4. Calculate APR
    const effectiveAPR = findAPR(netProceeds, monthlyPayment, termInMonths);
    const totalCost = principal + totalInterest + totalFee;

    // 5. Update UI
    updateOutputs(monthlyPayment, totalInterest, totalFee, totalCost, effectiveAPR, schedule);
  }

  /**
   * Iterative APR solver (Bisection method)
   * Solves for the monthly rate `i` in the present value formula:
   * NetProceeds = M * [ (1 - (1 + i)^-n) / i ]
   */
  function findAPR(netProceeds, payment, periods) {
    if (netProceeds === 0) return 0;
    
    let low = 0, high = 1; // Monthly rate bounds
    let mid = 0.5;
    const precision = 0.0000001; // 1e-7

    // Test high bound
    while (presentValue(high, payment, periods) > netProceeds) {
      high *= 2;
    }

    for (let i = 0; i < 100; i++) { // Max 100 iterations
      mid = (low + high) / 2;
      const pv = presentValue(mid, payment, periods);
      
      if (Math.abs(pv - netProceeds) < precision) {
        break; // Found it
      } else if (pv > netProceeds) {
        low = mid;
      } else {
        high = mid;
      }
    }
    return mid * 12 * 100; // Annual APR as percentage
  }

  function presentValue(monthlyRate, payment, periods) {
    if (monthlyRate === 0) {
      return payment * periods;
    }
    return payment * (1 - Math.pow(1 + monthlyRate, -periods)) / monthlyRate;
  }

  // --- UI Update Functions ---
  function updateOutputs(monthly, interest, fee, cost, apr, schedule) {
    elements.monthlyPayment.textContent = fmtCurrency(monthly);
    elements.effectiveAPR.textContent = fmtPercent(apr);
    elements.totalInterest.textContent = fmtCurrency(interest);
    elements.totalCost.textContent = fmtCurrency(cost);
    
    renderSchedule(schedule);
    
    const principal = cost - interest - fee;
    renderChart(principal, interest, fee);
  }

  function clearOutputs() {
    elements.monthlyPayment.textContent = '$0.00';
    elements.effectiveAPR.textContent = '0.000%';
    elements.totalInterest.textContent = '$0.00';
    elements.totalCost.textContent = '$0.00';
    elements.scheduleBody.innerHTML = '<tr><td colspan="6" class="text-center p-6 text-gray-500">Enter your loan details to generate a schedule.</td></tr>';
    renderChart(0, 0, 0);
  }

  function renderSchedule(schedule) {
    const tbody = elements.scheduleBody;
    tbody.innerHTML = '';
    if (!schedule || !schedule.length) {
      clearOutputs();
      return;
    }

    const formatter = new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'short' });
    const fragment = document.createDocumentFragment();
    
    schedule.forEach(row => {
      const tr = document.createElement('tr');
      tr.className = 'border-b border-gray-100 hover:bg-gray-50';
      tr.innerHTML = `
        <td class="px-4 py-2 text-left text-gray-600">${row.period}</td>
        <td class="px-4 py-2 text-left">${formatter.format(row.date)}</td>
        <td class="px-4 py-2">${fmtCurrency(row.payment)}</td>
        <td class="px-4 py-2 text-orange-600">${fmtCurrency(row.interest)}</td>
        <td class="px-4 py-2 text-green-600">${fmtCurrency(row.principal)}</td>
        <td class="px-4 py-2 font-medium">${fmtCurrency(row.balance)}</td>
      `;
      fragment.appendChild(tr);
    });
    tbody.appendChild(fragment);
  }

  function renderChart(principal, interest, fee) {
    const ctx = document.getElementById('resultsChart');
    if (!ctx) return;

    const hasData = principal > 0 || interest > 0 || fee > 0;
    
    const data = {
      labels: ['Principal', 'Total Interest', 'Origination Fees'],
      datasets: [{
        data: hasData ? [Math.max(0, principal), Math.max(0, interest), Math.max(0, fee)] : [1],
        backgroundColor: hasData ? ['#2563eb', '#f97316', '#f59e0b'] : ['#e5e7eb'],
        borderWidth: 0,
      }]
    };

    if (chartInstance) {
      chartInstance.data = data;
      chartInstance.options.plugins.tooltip.enabled = hasData;
      chartInstance.update();
    } else {
      chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '60%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                boxWidth: 12,
                padding: 15,
                font: { size: 12 }
              }
            },
            tooltip: {
              enabled: hasData,
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  let value = context.raw || 0;
                  return `${label}: ${fmtCurrency(value)}`;
                }
              }
            }
          }
        }
      });
    }
  }

  function resetForm() {
    elements.form.reset();
    elements.startDate.value = `${today.getFullYear()}-${(today.getMonth() + 2).toString().padStart(2, '0')}`;
    Object.keys(validationRules).forEach(id => {
        const field = elements[id];
        if(field) validateField(field); // This will clear the error state
    });
    clearOutputs();
  }

  // --- Accessible Tooltip ---
  function toggleTooltip(event) {
    const btn = event.currentTarget;
    const tooltipId = btn.getAttribute('aria-describedby');
    const tooltip = document.getElementById(tooltipId);
    
    if (!tooltip) return;

    const isExpanded = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', !isExpanded);
    tooltip.setAttribute('aria-hidden', isExpanded);
  }
  
  // --- Accessible Mobile Menu ---
  function toggleMobileMenu() {
    const isExpanded = elements.mobileMenuToggle.getAttribute('aria-expanded') === 'true';
    elements.mobileMenuToggle.setAttribute('aria-expanded', !isExpanded);
    elements.mobileMenu.classList.toggle('hidden', isExpanded);
  }

  // --- Event Listeners ---
  elements.calculateBtn.addEventListener('click', calculateAmortization);
  elements.resetBtn.addEventListener('click', resetForm);
  elements.tooltipBtns.forEach(btn => btn.addEventListener('click', toggleTooltip));
  elements.mobileMenuToggle.addEventListener('click', toggleMobileMenu);

  // Add on-blur validation
  Object.keys(validationRules).forEach(id => {
    const field = elements[id];
    if (field) {
      field.addEventListener('blur', () => validateField(field));
    }
  });

  // Initial Calculation
  calculateAmortization();
});
</script>

</body>
</html>