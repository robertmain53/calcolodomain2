<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Potassium Calculator — Daily Intake, %AI, and Sodium:Potassium Ratio</title>
  <meta name="description" content="Compute your daily potassium (K) intake from foods, compare to Adequate Intake (AI) by age/sex, and get your sodium-to-potassium ratio. Includes accessible UI, clear formulas, and authoritative sources." />
  <link rel="canonical" href="https://calcdomain.com/potassium-calculator.html"/>

  <!-- Icons -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Fonts & Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="preload" as="style" onload="this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --focus: #1d4ed8; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 600; margin-top: 1.25rem; margin-bottom: .5rem; }
    .formula-box { background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; overflow-x:auto; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; text-align:center; }
    .result-card h4 { font-size:.95rem; color:#4b5563; margin-bottom:.25rem; }
    .result-card p { font-size:1.6rem; font-weight:800; color:#1d4ed8; }
    .kbd { border:1px solid #d1d5db; border-bottom-width:3px; padding:.1rem .4rem; border-radius:.4rem; background:#fff; }
    .sr-only-focusable:focus { position:static!important; width:auto!important; height:auto!important; clip:auto!important; }
    /* Accessibility: visible focus */
    :where(a, button, input, select, textarea, summary, [role="switch"], [tabindex]) :focus,
    :where(a, button, input, select, textarea, summary, [role="switch"], [tabindex]):focus,
    :where(a, button, input, select, textarea, summary, [role="switch"], [tabindex]):focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }
    /* Prevent CLS in the results area */
    #results-container { min-height: 320px; }
    /* Touch targets */
    .touch-target { min-height: 48px; min-width: 48px; }
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; inset: 0; width: 100%; }
      #chartContainer { display: none !important; }
    }
  </style>

  <!-- MathJax for LaTeX -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          id="MathJax-script"></script>

  <!-- Chart.js (lightweight doughnut for %AI & Na:K) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Potassium Calculator",
    "description":"Calculate daily potassium intake from foods, % of Adequate Intake (AI), and sodium-to-potassium ratio with an accessible, mobile-first tool.",
    "url":"https://calcdomain.com/potassium-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "dateModified":"2025-10-30",
    "about":[{"@type":"Thing","name":"Potassium","sameAs":"https://en.wikipedia.org/wiki/Potassium"}],
    "isPartOf":{"@type":"Collection","name":"Health & Fitness > Diet & Nutrition"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"How much potassium do I need per day?",
       "acceptedAnswer":{"@type":"Answer","text":"For adults 19+, the Adequate Intake (AI) is typically 3,400 mg/day for males and 2,600 mg/day for females. Pregnancy ~2,900 mg/day and lactation ~2,800 mg/day. Children and teens have lower AIs by age group."}},
      {"@type":"Question","name":"Is a sodium-to-potassium ratio under 1 good?",
       "acceptedAnswer":{"@type":"Answer","text":"Many public health sources recommend keeping the dietary sodium-to-potassium ratio below 1 by reducing sodium and increasing potassium-rich foods."}},
      {"@type":"Question","name":"What foods are high in potassium?",
       "acceptedAnswer":{"@type":"Answer","text":"Examples include potatoes, beans, lentils, tomatoes, spinach, bananas, oranges, avocados, yogurt, and salmon. Whole minimally processed foods tend to be richer in potassium."}},
      {"@type":"Question","name":"Should I take potassium supplements?",
       "acceptedAnswer":{"@type":"Answer","text":"Do not start supplements without medical advice. Potassium can be dangerous for people with kidney disease or those taking certain medications (e.g., ACE inhibitors, ARBs, potassium-sparing diuretics)." }},
      {"@type":"Question","name":"Does cooking change potassium content?",
       "acceptedAnswer":{"@type":"Answer","text":"Yes. Boiling can leach potassium into water; roasting or steaming tends to preserve more. Nutrition labels and databases usually assume typical preparation."}},
      {"@type":"Question","name":"What unit does the calculator use?",
       "acceptedAnswer":{"@type":"Answer","text":"Milligrams (mg) for potassium and sodium. You can enter sodium separately or let the tool sum any sodium values you add."}},
      {"@type":"Question","name":"Can I use this for clinical dosing?",
       "acceptedAnswer":{"@type":"Answer","text":"No. This tool is for general nutrition education only and is not a substitute for professional medical advice or clinical calculators for hypokalemia treatment."}}
    ]
  }
  </script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Skip link -->
  <a href="#calculator" class="sr-only sr-only-focusable focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-white border border-gray-300 rounded px-3 py-2">Skip to calculator</a>

  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex justify-between items-center">
      <a href="index.html" class="text-2xl font-extrabold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a href="search.html" class="text-gray-700 hover:text-blue-700">Search</a>
        <a href="index.html#categories" class="text-gray-700 hover:text-blue-700">Categories</a>
        <a href="health-fitness.html" class="text-gray-700 hover:text-blue-700">Health & Fitness</a>
      </nav>
      <button class="md:hidden p-2 rounded hover:bg-gray-100 touch-target" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div id="print-section" class="max-w-5xl mx-auto">
      <!-- 1. H1 -->
      <h1 class="text-3xl font-extrabold mb-2">potassium calculator</h1>

      <!-- 2. Intro -->
      <p class="text-gray-700 mb-6">
        Quickly estimate your daily potassium (K) intake from foods, compare it with the Adequate Intake (AI) for your age and sex, and see your sodium-to-potassium ratio.
        Built for dietitians, athletes, and health-conscious individuals who want a clean, accessible tool that’s reliable and easy to use on mobile.
      </p>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left: Calculator -->
        <section id="calculator" class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border" aria-labelledby="calcHeading">
          <h2 id="calcHeading" class="text-xl font-bold mb-4">Interactive Calculator</h2>

          <!-- Persona / Group selection -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="ageGroup" class="block text-sm font-medium text-gray-800">Age group *</label>
              <select id="ageGroup" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 touch-target"
                      aria-required="true" aria-describedby="ageHelp">
                <option value="1-3">1–3 years</option>
                <option value="4-8">4–8 years</option>
                <option value="9-13">9–13 years</option>
                <option value="14-18">14–18 years</option>
                <option value="19-50" selected>19–50 years</option>
                <option value="51+">51+ years</option>
              </select>
              <p id="ageHelp" class="text-xs text-gray-600 mt-1">Used to set the AI baseline for potassium.</p>
              <p id="ageError" class="mt-1 text-sm text-red-700 hidden"></p>
            </div>

            <div>
              <div class="flex items-center justify-between">
                <label for="sex" class="block text-sm font-medium text-gray-800">Sex *</label>
                <button id="sexTipBtn" type="button" class="ml-2 text-blue-700 underline text-xs touch-target"
                        aria-expanded="false" aria-controls="sexTip">?</button>
              </div>
              <select id="sex" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 touch-target"
                      aria-required="true" aria-describedby="sexTip">
                <option value="male" selected>Male</option>
                <option value="female">Female</option>
              </select>
              <p id="sexTip" class="text-xs text-gray-600 mt-1 hidden">
                Female AI differs from male; pregnancy and lactation adjust it further.
              </p>
              <p id="sexError" class="mt-1 text-sm text-red-700 hidden"></p>
            </div>

            <div>
              <label for="pregnancy" class="block text-sm font-medium text-gray-800">Pregnancy/Lactation</label>
              <select id="pregnancy" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 touch-target"
                      aria-describedby="pregHelp">
                <option value="none" selected>Not pregnant / not lactating</option>
                <option value="pregnant">Pregnant</option>
                <option value="lactating">Lactating</option>
              </select>
              <p id="pregHelp" class="text-xs text-gray-600 mt-1">Adjusts female AI. Ignored for males.</p>
            </div>

            <div>
              <div class="flex items-center justify-between">
                <label for="extraSodium" class="block text-sm font-medium text-gray-800">
                  Additional sodium today (mg)
                </label>
                <button id="naTipBtn" type="button" class="ml-2 text-blue-700 underline text-xs touch-target"
                        aria-expanded="false" aria-controls="naTip">?</button>
              </div>
              <input type="number" inputmode="decimal" id="extraSodium" min="0" step="1" value="0"
                     class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 touch-target"
                     aria-describedby="naTip naError" />
              <p id="naTip" class="text-xs text-gray-600 mt-1 hidden">Add sodium from salt or packaged foods not listed individually.</p>
              <p id="naError" class="mt-1 text-sm text-red-700 hidden"></p>
            </div>
          </div>

          <hr class="my-6">

          <!-- Food adder -->
          <div>
            <h3 class="text-lg font-semibold mb-2">Add foods</h3>
            <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
              <div class="md:col-span-6">
                <label for="foodSelect" class="block text-sm font-medium text-gray-800">Food (per 100 g)</label>
                <select id="foodSelect" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 touch-target" aria-describedby="foodHelp">
                  <!-- Filled by JS from DB -->
                </select>
                <p id="foodHelp" class="text-xs text-gray-600 mt-1">Database includes typical cooked/raw values.</p>
                <p id="foodError" class="mt-1 text-sm text-red-700 hidden"></p>
              </div>
              <div class="md:col-span-3">
                <label for="grams" class="block text-sm font-medium text-gray-800">Amount (g) *</label>
                <input type="number" id="grams" inputmode="decimal" min="1" step="1" value="150"
                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 touch-target"
                       aria-required="true" aria-describedby="gramsError"/>
                <p id="gramsError" class="mt-1 text-sm text-red-700 hidden"></p>
              </div>
              <div class="md:col-span-3">
                <button id="addFood" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-md px-4 py-3 touch-target"
                        type="button">Add to list</button>
              </div>
            </div>

            <!-- Entries table -->
            <div class="mt-4 overflow-x-auto border border-gray-200 rounded-lg">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-100 text-gray-700">
                  <tr>
                    <th class="px-4 py-2 text-left">Food</th>
                    <th class="px-4 py-2 text-right">Amount (g)</th>
                    <th class="px-4 py-2 text-right">K (mg)</th>
                    <th class="px-4 py-2 text-right">Na (mg)</th>
                    <th class="px-4 py-2 text-right">Actions</th>
                  </tr>
                </thead>
                <tbody id="foodBody"></tbody>
                <tfoot class="bg-gray-50 font-semibold">
                  <tr>
                    <td class="px-4 py-2 text-right" colspan="2">Totals:</td>
                    <td id="totKCell" class="px-4 py-2 text-right">0</td>
                    <td id="totNaCell" class="px-4 py-2 text-right">0</td>
                    <td class="px-4 py-2"></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </section>

        <!-- Right: Results -->
        <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm border" aria-labelledby="resultsHeading" id="results-container">
          <h2 id="resultsHeading" class="text-xl font-bold mb-4">Results</h2>

          <div class="grid grid-cols-1 gap-4">
            <div class="result-card">
              <h4>Total Potassium (K)</h4>
              <p id="totalK">0 mg</p>
            </div>
            <div class="result-card">
              <h4>Adequate Intake (AI)</h4>
              <p id="aiK">—</p>
            </div>
            <div class="result-card">
              <h4>% of AI</h4>
              <p id="pctAI">0%</p>
            </div>
            <div class="result-card">
              <h4>Total Sodium (Na)</h4>
              <p id="totalNa">0 mg</p>
            </div>
            <div class="result-card">
              <h4>Na:K Ratio</h4>
              <p id="naKRatio">—</p>
            </div>
          </div>

          <div id="chartContainer" class="mt-6">
            <canvas id="pctChart" aria-label="Potassium Adequacy Chart"></canvas>
          </div>

          <div class="mt-6 p-4 rounded-lg border bg-blue-50 text-sm text-blue-900" id="adviceBox">
            Aim for at least your AI and keep your sodium-to-potassium ratio under 1 by lowering sodium and choosing potassium-rich foods.
          </div>

          <div class="mt-4 flex gap-3">
            <button id="resetBtn" type="button" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-900 font-semibold rounded-md px-4 py-3 touch-target">Reset</button>
            <button id="printBtn" type="button" class="flex-1 bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-md px-4 py-3 touch-target">Print</button>
          </div>
        </section>
      </div>

      <!-- 5. Authoritative Content -->
      <article class="prose mt-10 bg-white p-6 rounded-xl shadow-sm border">
        <h2>Authoritative data source &amp; methodology</h2>
        <ul class="list-disc list-inside">
          <li>
            <strong>Dietary Reference Intakes (DRIs): Potassium.</strong>
            National Academies of Sciences, Engineering, and Medicine (2019 update).
            <a href="https://www.nationalacademies.org/our-work/dietary-reference-intakes-for-sodium-and-potassium" class="text-blue-700 underline">Official resource</a>.
          </li>
          <li>
            <strong>WHO guideline on potassium intake for adults and children.</strong>
            World Health Organization (2012; reaffirmed in subsequent guidance).
            <a href="https://www.who.int/publications/i/item/9789241504829" class="text-blue-700 underline">WHO publication</a>.
          </li>
        </ul>
        <p class="mt-2"><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          <p>Let \(K_{\text{tot}}\) be total dietary potassium in mg, \(AI\) the Adequate Intake in mg/day, and \(Na_{\text{tot}}\) total sodium in mg.</p>
          <p>\[
            \%AI = \frac{K_{\text{tot}}}{AI} \times 100
          \]</p>
          <p>\[
            \text{Na:K ratio} = \frac{Na_{\text{tot}}}{K_{\text{tot}}}
          \]</p>
          <p>Food contributions are scaled from per-100 g database values:
          \[
            K_i = K_{100,i} \times \frac{g_i}{100}, \quad
            Na_i = Na_{100,i} \times \frac{g_i}{100}, \quad
            K_{\text{tot}}=\sum_i K_i,\; Na_{\text{tot}}=\sum_i Na_i
          \]</p>
        </div>

        <h2>Glossary of variables</h2>
        <table class="w-full text-sm border border-gray-200 rounded-lg overflow-hidden">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="text-left px-3 py-2">Symbol / Field</th>
              <th class="text-left px-3 py-2">Meaning</th>
              <th class="text-left px-3 py-2">Unit</th>
            </tr>
          </thead>
          <tbody>
            <tr><td class="px-3 py-2">Age group, Sex, Pregnancy</td><td class="px-3 py-2">Determines potassium AI.</td><td class="px-3 py-2">—</td></tr>
            <tr><td class="px-3 py-2">Food, Amount</td><td class="px-3 py-2">Your chosen items and serving sizes.</td><td class="px-3 py-2">g</td></tr>
            <tr><td class="px-3 py-2">Additional sodium</td><td class="px-3 py-2">Extra sodium not in the food list.</td><td class="px-3 py-2">mg</td></tr>
            <tr><td class="px-3 py-2">\(K_{\text{tot}}\)</td><td class="px-3 py-2">Total potassium intake.</td><td class="px-3 py-2">mg</td></tr>
            <tr><td class="px-3 py-2">\(Na_{\text{tot}}\)</td><td class="px-3 py-2">Total sodium intake.</td><td class="px-3 py-2">mg</td></tr>
            <tr><td class="px-3 py-2">%AI</td><td class="px-3 py-2">Percent of Adequate Intake reached.</td><td class="px-3 py-2">%</td></tr>
            <tr><td class="px-3 py-2">Na:K</td><td class="px-3 py-2">Sodium-to-potassium ratio (target &lt; 1).</td><td class="px-3 py-2">—</td></tr>
          </tbody>
        </table>

        <h2>How it works: a step-by-step example</h2>
        <p><strong>Scenario.</strong> Female, 19–50 years (AI = 2600 mg/day). Foods: baked potato 200 g; cooked lentils 150 g; banana 120 g. Additional sodium: 0 mg.</p>
        <ol class="list-decimal list-inside">
          <li>From the database (per 100 g): potato 544 mg K, lentils 369 mg K, banana 358 mg K.</li>
          <li>Scale to grams:
            \(K_{\text{potato}}=544\times 2=1088\) mg,
            \(K_{\text{lentils}}=369\times 1.5=553.5\) mg,
            \(K_{\text{banana}}=358\times 1.2=429.6\) mg.
          </li>
          <li>Total \(K_{\text{tot}} \approx 2071\) mg. %AI \(= 2071/2600 \times 100 \approx 79.7\%\).</li>
          <li>If sodium were 1800 mg: Na:K \(= 1800/2071 \approx 0.87\) (under 1 is preferable).</li>
        </ol>

        <h2>Frequently asked questions</h2>
        <details>
          <summary>Is it safe to increase potassium?</summary>
          <p>For healthy individuals, increasing potassium from foods is generally beneficial. People with kidney disease or on certain medications must consult their clinician first.</p>
        </details>
        <details>
          <summary>Why do AI values differ by age and sex?</summary>
          <p>They reflect differences in body size, metabolism, and physiological needs (e.g., pregnancy/lactation).</p>
        </details>
        <details>
          <summary>Do I need to track every food precisely?</summary>
          <p>No—use typical portions of potassium-rich foods and reduce high-sodium items to push your ratio below 1 over time.</p>
        </details>
        <details>
          <summary>What about supplements vs. food?</summary>
          <p>Food sources also provide fiber and other nutrients; supplements can pose risks without supervision. Always check with a professional.</p>
        </details>
        <details>
          <summary>Can I export or print my results?</summary>
          <p>Yes. Use the <span class="kbd">Print</span> button for a clean printout or save as PDF.</p>
        </details>

        <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
          Ultima revisione per l'accuratezza in data: <time datetime="2025-10-30">October 30, 2025</time></p>
          <p class="mt-2"><em>Disclaimer:</em> This tool is for education only and not a medical device. It does not diagnose or treat any condition.</p>
        </div>
      </article>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  (function(){
    // --- Tiny food DB (per 100 g). Values representative; can be expanded later.
    // K and Na in mg per 100 g (approx values; many from standard nutrition tables).
    const FOOD_DB = [
      { id:'potato_baked', name:'Potato, baked (flesh & skin)', k:544, na:6 },
      { id:'sweet_potato_baked', name:'Sweet potato, baked', k:337, na:72 },
      { id:'banana_raw', name:'Banana, raw', k:358, na:1 },
      { id:'avocado_raw', name:'Avocado, raw', k:485, na:7 },
      { id:'spinach_cooked', name:'Spinach, cooked', k:466, na:70 },
      { id:'tomato_raw', name:'Tomato, raw', k:237, na:5 },
      { id:'tomato_sauce', name:'Tomato sauce, canned', k:420, na:330 },
      { id:'lentils_cooked', name:'Lentils, cooked', k:369, na:2 },
      { id:'black_beans_cooked', name:'Black beans, cooked', k:355, na:1 },
      { id:'white_beans_cooked', name:'Cannellini/white beans, cooked', k:561, na:2 },
      { id:'yogurt_plain', name:'Yogurt, plain, low-fat', k:255, na:70 },
      { id:'milk_2', name:'Milk 2%', k:150, na:44 },
      { id:'orange_raw', name:'Orange, raw', k:181, na:2 },
      { id:'orange_juice', name:'Orange juice', k:200, na:1 },
      { id:'salmon_baked', name:'Salmon, baked', k:363, na:75 },
      { id:'chicken_breast_roasted', name:'Chicken breast, roasted', k:256, na:74 },
      { id:'beef_top_sirloin', name:'Beef top sirloin, roasted', k:318, na:67 },
      { id:'almonds', name:'Almonds', k:733, na:1 },
      { id:'pistachios', name:'Pistachios', k:1025, na:1 },
      { id:'raisins', name:'Raisins', k:749, na:11 },
      { id:'broccoli_cooked', name:'Broccoli, cooked', k:180, na:41 },
      { id:'edamame_cooked', name:'Edamame, cooked', k:436, na:6 },
      { id:'tomato_paste', name:'Tomato paste, canned', k:1014, na:590 },
      { id:'coconut_water', name:'Coconut water', k:250, na:105 }
    ];

    // --- Adequate Intakes (AI) for potassium (mg/day)
    // National Academies (2019): Adults 19+ M 3400, F 2600; Pregnancy 2900; Lactation 2800.
    // Children/teens (approx widely used values):
    const AI_TABLE = {
      '1-3': 2000,
      '4-8': 2300,
      '9-13_male': 2500,
      '9-13_female': 2300,
      '14-18_male': 3000,
      '14-18_female': 2300,
      '19-50_male': 3400,
      '19-50_female': 2600,
      '51+_male': 3400,
      '51+_female': 2600,
      'pregnant': 2900,
      'lactating': 2800
    };

    // --- Elements
    const els = {
      ageGroup: document.getElementById('ageGroup'),
      sex: document.getElementById('sex'),
      pregnancy: document.getElementById('pregnancy'),
      extraSodium: document.getElementById('extraSodium'),
      foodSelect: document.getElementById('foodSelect'),
      grams: document.getElementById('grams'),
      addFood: document.getElementById('addFood'),
      foodBody: document.getElementById('foodBody'),
      totKCell: document.getElementById('totKCell'),
      totNaCell: document.getElementById('totNaCell'),
      totalK: document.getElementById('totalK'),
      aiK: document.getElementById('aiK'),
      pctAI: document.getElementById('pctAI'),
      totalNa: document.getElementById('totalNa'),
      naKRatio: document.getElementById('naKRatio'),
      resetBtn: document.getElementById('resetBtn'),
      printBtn: document.getElementById('printBtn'),
      adviceBox: document.getElementById('adviceBox'),
      // errors / tooltips
      ageError: document.getElementById('ageError'),
      sexError: document.getElementById('sexError'),
      foodError: document.getElementById('foodError'),
      gramsError: document.getElementById('gramsError'),
      naError: document.getElementById('naError'),
      sexTipBtn: document.getElementById('sexTipBtn'),
      sexTip: document.getElementById('sexTip'),
      naTipBtn: document.getElementById('naTipBtn'),
      naTip: document.getElementById('naTip')
    };

    // --- Populate foods
    function populateFoods(){
      FOOD_DB.forEach(f=>{
        const opt = document.createElement('option');
        opt.value = f.id;
        opt.textContent = `${f.name} — ${f.k} mg K / ${f.na} mg Na (per 100 g)`;
        els.foodSelect.appendChild(opt);
      });
    }

    // --- State
    let rows = []; // {key, id, name, grams, k100, na100}

    function fmtInt(n){ return new Intl.NumberFormat().format(Math.round(n || 0)); }
    function clamp(n, min, max){ return Math.min(max, Math.max(min, n)); }

    // --- Compute AI based on selection
    function computeAI(){
      const age = els.ageGroup.value;
      const sex = els.sex.value;
      const preg = els.pregnancy.value;

      // Pregnancy/lactation override only for females 14–50 typically; we keep simple:
      if (sex === 'female' && (preg === 'pregnant' || preg === 'lactating')) {
        return AI_TABLE[preg];
      }

      if (age === '9-13' || age === '14-18') {
        return AI_TABLE[`${age}_${sex}`];
      }
      if (age === '19-50') return AI_TABLE[`19-50_${sex}`];
      if (age === '51+') return AI_TABLE[`51+_${sex}`];
      return AI_TABLE[age]; // 1-3, 4-8
    }

    function totals(){
      const k = rows.reduce((s,r)=> s + r.k100 * (r.grams/100), 0);
      const naFoods = rows.reduce((s,r)=> s + r.na100 * (r.grams/100), 0);
      const extraNa = parseFloat(els.extraSodium.value||0);
      return { k, na: naFoods + extraNa };
    }

    function renderRows(){
      els.foodBody.innerHTML = '';
      rows.forEach(r=>{
        const tr = document.createElement('tr');
        const k = r.k100 * (r.grams/100);
        const na = r.na100 * (r.grams/100);
        tr.innerHTML = `
          <td class="px-4 py-2">${r.name}</td>
          <td class="px-4 py-2 text-right">${fmtInt(r.grams)}</td>
          <td class="px-4 py-2 text-right">${fmtInt(k)}</td>
          <td class="px-4 py-2 text-right">${fmtInt(na)}</td>
          <td class="px-4 py-2 text-right">
            <button type="button" data-key="${r.key}" class="text-red-700 underline touch-target">Remove</button>
          </td>
        `;
        els.foodBody.appendChild(tr);
      });

      // Bind remove
      els.foodBody.querySelectorAll('button[data-key]').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const key = e.currentTarget.getAttribute('data-key');
          rows = rows.filter(r=> r.key !== key);
          update();
        });
      });

      const t = totals();
      els.totKCell.textContent = fmtInt(t.k);
      els.totNaCell.textContent = fmtInt(t.na);
    }

    let chart;
    function renderSummary(){
      const ai = computeAI();
      const t = totals();
      const pct = ai > 0 ? (t.k/ai)*100 : 0;
      const ratio = t.k > 0 ? (t.na / t.k) : NaN;

      els.totalK.textContent = `${fmtInt(t.k)} mg`;
      els.aiK.textContent = `${fmtInt(ai)} mg/day`;
      els.pctAI.textContent = `${fmtInt(pct)}%`;
      els.totalNa.textContent = `${fmtInt(t.na)} mg`;
      els.naKRatio.textContent = isFinite(ratio) ? ratio.toFixed(2) : '—';

      // Advice box tone
      if (pct >= 100 && ratio <= 1) {
        els.adviceBox.className = "mt-6 p-4 rounded-lg border bg-green-50 text-sm text-green-900";
        els.adviceBox.textContent = "Great job — you’re meeting your potassium AI and your sodium-to-potassium ratio is at or below 1.";
      } else if (pct >= 80 && ratio <= 1.2) {
        els.adviceBox.className = "mt-6 p-4 rounded-lg border bg-amber-50 text-sm text-amber-900";
        els.adviceBox.textContent = "You’re close. Add one potassium-rich item (beans, potatoes, tomatoes, leafy greens) and trim sodium to push your ratio below 1.";
      } else {
        els.adviceBox.className = "mt-6 p-4 rounded-lg border bg-blue-50 text-sm text-blue-900";
        els.adviceBox.textContent = "Aim for at least your AI and keep your sodium-to-potassium ratio under 1 by lowering sodium and choosing potassium-rich foods.";
      }

      // Chart: percent of AI (capped visual)
      const ctx = document.getElementById('pctChart');
      const hit = Math.max(0, Math.min(100, pct));
      const rem = Math.max(0, 100 - hit);
      const data = {
        labels: ['% of AI reached', 'Remaining to 100%'],
        datasets: [{ data: [hit, rem] }]
      };
      const options = {
        plugins: { legend: { display: true, position:'bottom' } },
        responsive: true,
        maintainAspectRatio: false
      };
      if (chart) { chart.data = data; chart.update(); }
      else { chart = new Chart(ctx, { type: 'doughnut', data, options }); }
    }

    function update(){ renderRows(); renderSummary(); }

    // --- Validation (on blur)
    function showError(el, errEl, msg){
      if (msg) {
        errEl.textContent = msg;
        errEl.classList.remove('hidden');
        el.setAttribute('aria-invalid','true');
      } else {
        errEl.textContent = '';
        errEl.classList.add('hidden');
        el.removeAttribute('aria-invalid');
      }
    }

    els.grams.addEventListener('blur', ()=>{
      const v = parseFloat(els.grams.value);
      if (!isFinite(v) || v < 1) showError(els.grams, els.gramsError, 'Enter an amount of at least 1 g.');
      else showError(els.grams, els.gramsError, '');
    });

    els.extraSodium.addEventListener('blur', ()=>{
      const v = parseFloat(els.extraSodium.value);
      if (!isFinite(v) || v < 0) showError(els.extraSodium, els.naError, 'Sodium cannot be negative.');
      else showError(els.extraSodium, els.naError, '');
      update();
    });

    els.ageGroup.addEventListener('blur', ()=> showError(els.ageGroup, els.ageError, ''));
    els.sex.addEventListener('blur', ()=> showError(els.sex, els.sexError, ''));

    // Tooltips (accessible toggle)
    function toggleTip(btn, tip){
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      tip.classList.toggle('hidden', expanded);
    }
    els.sexTipBtn.addEventListener('click', ()=> toggleTip(els.sexTipBtn, els.sexTip));
    els.naTipBtn.addEventListener('click', ()=> toggleTip(els.naTipBtn, els.naTip));
    els.sexTipBtn.addEventListener('keydown', (e)=> { if (e.key==='Enter' || e.key===' ') { e.preventDefault(); els.sexTipBtn.click(); }});
    els.naTipBtn.addEventListener('keydown', (e)=> { if (e.key==='Enter' || e.key===' ') { e.preventDefault(); els.naTipBtn.click(); }});

    // Add food
    els.addFood.addEventListener('click', ()=>{
      const id = els.foodSelect.value;
      const grams = parseFloat(els.grams.value);
      if (!id) { showError(els.foodSelect, els.foodError, 'Select a food.'); return; }
      if (!isFinite(grams) || grams < 1) { showError(els.grams, els.gramsError, 'Enter an amount of at least 1 g.'); return; }
      showError(els.foodSelect, els.foodError, '');
      showError(els.grams, els.gramsError, '');

      const f = FOOD_DB.find(x=> x.id===id);
      const key = `${id}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;
      rows.push({ key, id, name:f.name, grams: clamp(grams,1,5000), k100:f.k, na100:f.na });
      update();
    });

    // React to selectors / sodium change
    ['ageGroup','sex','pregnancy','extraSodium'].forEach(id=>{
      document.getElementById(id).addEventListener('input', update);
    });

    // Reset / Print
    els.resetBtn.addEventListener('click', ()=>{
      rows = [];
      els.ageGroup.value = '19-50';
      els.sex.value = 'male';
      els.pregnancy.value = 'none';
      els.extraSodium.value = '0';
      els.grams.value = '150';
      update();
      window.scrollTo({ top:0, behavior:'smooth' });
    });
    els.printBtn.addEventListener('click', ()=> window.print());

    // Init
    populateFoods();
    update();
  })();
  </script>

  <!-- Lightweight competitor gap plan (for internal E-E-A-T; non-blocking) -->
  <script defer>
  /*
    Competitor gap notes synthesized for UX/feature parity:
    - Many potassium tools focus on clinical dosing (hypokalemia) or narrow biomarkers (TTKG).
    - Nutrition calculators often lack %AI by age/sex and Na:K ratio in one place.
    - This tool closes gaps via: mobile-first A11y UI, inline validation, LaTeX formulas, AI mapping by persona (age/sex/pregnancy),
      editable food ledger with both K and Na, Na:K ratio target guidance, JSON-LD (FAQ + WebPage), print-ready output.
  */
  </script>
</body>
</html>
