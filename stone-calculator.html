<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=width=device-width, initial-scale=1.0">
    <title>Stone Calculator - Calculate Gravel, Rock & Aggregate Volume</title>
    <meta name="description" content="Accurately calculate the volume (cubic yards/meters) and weight (tons/tonnes) of stone, gravel, or aggregate needed for driveways, patios, and landscaping projects.">
    <link rel="canonical" href="https://calcdomain.com/stone-calculator.html"/>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose { max-width: 65ch; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .formula-box {
            background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
            overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
            font-size: 1.1rem;
        }
        details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
        details[open] > summary { margin-bottom: 0.5rem; }
        .result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
        .result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; }
        .result-card p { font-size: 1.75rem; font-weight: 700; color: #2563eb; }
        
        /* Accessibility & Performance Directives */
        #results-container { min-height: 240px; } /* Prevents CLS */
        
        /* Visible focus state for WCAG */
        input:focus-visible, select:focus-visible, button:focus-visible, input[type="radio"]:focus-visible + label {
            outline: 3px solid #3b82f6; /* Equivalent to focus-ring-blue-500 */
            outline-offset: 2px;
        }

        /* Custom radio button styles for unit toggle */
        .radio-toggle label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: all 0.2s ease-in-out;
        }
        .radio-toggle input[type="radio"]:checked + label {
            background-color: #3b82f6;
            color: #ffffff;
            border-color: #3b82f6;
        }
        .radio-toggle input[type="radio"] {
            /* Visually hide the radio but keep it accessible */
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .error-message {
            color: #dc2626; /* text-red-600 */
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
    </style>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Stone Calculator - Calculate Gravel, Rock & Aggregate Volume",
      "description": "Accurately calculate the volume (cubic yards/meters) and weight (tons/tonnes) of stone, gravel, or aggregate needed for driveways, patios, and landscaping projects.",
      "url": "https://calcdomain.com/stone-calculator.html",
      "inLanguage": "en",
      "author": {
        "@type": "Person",
        "name": "Ugo Candido"
      },
      "publisher": {
        "@type": "Organization",
        "name": "CalcDomain"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
        { "@type": "ListItem", "position": 2, "name": "Construction", "item": "https://calcdomain.com/construction.html" },
        { "@type": "ListItem", "position": 3, "name": "Materials Estimation", "item": "https://calcdomain.com/subcategories/construction-materials-estimation.html" },
        { "@type": "ListItem", "position": 4, "name": "Stone Calculator", "item": "https://calcdomain.com/stone-calculator.html" }
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Calculate Stone/Gravel Needed",
      "description": "A step-by-step guide to calculating the required volume and weight of aggregate for your project.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Select Units",
          "text": "Choose between Imperial (feet, inches, pounds) and Metric (meters, centimeters, kilograms) units."
        },
        {
          "@type": "HowToStep",
          "name": "Define Area",
          "text": "Select the shape of your area (Rectangle or Circle) and enter its dimensions (length, width, or radius)."
        },
        {
          "@type": "HowToStep",
          "name": "Enter Depth",
          "text": "Input the desired thickness (depth) of the stone layer."
        },
        {
          "@type": "HowToStep",
          "name": "Define Material",
          "text": "Select a common material (like gravel or sand) to auto-fill the density, or enter a custom density value."
        },
        {
          "@type": "HowToStep",
          "name": "Review Results",
          "text": "The calculator will instantly provide the total required volume (e.g., cubic yards) and total weight (e.g., tons) needed for your project."
        }
      ]
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/tex-math@4.0.0/dist/tex-math.min.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
    <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

        <div class="w-full max-w-md hidden md:block mx-8">
        <div class="relative">
            <input type="search" id="search-input" placeholder="Search for a calculator..."
            class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
            autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
            fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
        </div>
        </div>

        <div class="hidden md:flex items-center space-x-6 text-sm">
        <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>

        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu" aria-expanded="false">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        </button>
    </div>

    <div id="mobile-menu" class="md:hidden mt-4 hidden">
        <div class="space-y-2">
        <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
    </div>
    </nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
    <div class="flex flex-col lg:flex-row gap-8">

    <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
        <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
        <a href="construction.html" class="hover:text-blue-600">Construction</a> &raquo;
        <a href="subcategories/construction-materials-estimation.html" class="hover:text-blue-600">Materials Estimation</a> &raquo;
        <span class="text-gray-900">Stone Calculator</span>
        </nav>

        <div class="bg-white p-6 rounded-lg shadow-md">
            
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Stone Calculator</h1>
            <p class="text-gray-600 mb-6">Accurately estimate the volume and weight of stone, gravel, or aggregate required for your landscaping or construction project. This tool helps you calculate materials for driveways, pathways, or garden beds, saving you time and money by preventing over-ordering.</p>

            <section id="calculator-ui" aria-labelledby="calculator-heading">
                <h2 id="calculator-heading" class="sr-only">Material Estimation Calculator</h2>
                <form id="stone-form" class="space-y-6">
                    
                    <fieldset>
                        <legend class="block text-sm font-medium text-gray-700 mb-2">Unit System</legend>
                        <div class="flex gap-4 radio-toggle">
                            <div>
                                <input type="radio" id="unit-imperial" name="unitSystem" value="imperial" checked>
                                <label for="unit-imperial">Imperial (ft, in, lbs)</label>
                            </div>
                            <div>
                                <input type="radio" id="unit-metric" name="unitSystem" value="metric">
                                <label for="unit-metric">Metric (m, cm, kg)</label>
                            </div>
                        </div>
                    </fieldset>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="area-shape" class="block text-sm font-medium text-gray-700">Area Shape</label>
                            <select id="area-shape" name="areaShape" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="rectangle" selected>Rectangle / Square</option>
                                <option value="circle">Circle</option>
                            </select>
                        </div>
                        <div>
                            <label for="depth" class="block text-sm font-medium text-gray-700">
                                Depth <span class="unit-label">(in)</span>
                            </label>
                            <input type="number" id="depth" name="depth" value="4" step="0.1" min="0" aria-required="true" aria-describedby="depth-error" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <div id="depth-error" class="error-message" aria-live="polite"></div>
                        </div>
                    </div>

                    <div id="dimensions-rectangle" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="length" class="block text-sm font-medium text-gray-700">
                                Length <span class="unit-label">(ft)</span>
                            </label>
                            <input type="number" id="length" name="length" value="10" step="0.1" min="0" aria-required="true" aria-describedby="length-error" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <div id="length-error" class="error-message" aria-live="polite"></div>
                        </div>
                        <div>
                            <label for="width" class="block text-sm font-medium text-gray-700">
                                Width <span class="unit-label">(ft)</span>
                            </label>
                            <input type="number" id="width" name="width" value="10" step="0.1" min="0" aria-required="true" aria-describedby="width-error" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <div id="width-error" class="error-message" aria-live="polite"></div>
                        </div>
                    </div>

                    <div id="dimensions-circle" class="grid grid-cols-1 md:grid-cols-2 gap-6" style="display: none;">
                        <div>
                            <label for="radius" class="block text-sm font-medium text-gray-700">
                                Radius <span class="unit-label">(ft)</span>
                            </label>
                            <input type="number" id="radius" name="radius" value="5" step="0.1" min="0" aria-required="true" aria-describedby="radius-error" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <div id="radius-error" class="error-message" aria-live="polite"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="material-type" class="block text-sm font-medium text-gray-700">Common Material</label>
                            <select id="material-type" name="materialType" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="custom">Custom Density</option>
                                <option value="gravel" selected>Gravel (Crushed Stone)</option>
                                <option value="sand">Sand (Dry)</option>
                                <option value="topsoil">Topsoil (Screened)</option>
                                <option value="mulch">Mulch</option>
                            </select>
                        </div>
                        <div>
                            <label for="density" class="block text-sm font-medium text-gray-700">
                                Material Density <span class="density-unit-label">(lbs/yd³)</span>
                            </label>
                            <input type="number" id="density" name="density" step="1" min="0" aria-required="true" aria-describedby="density-error density-tooltip" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <div id="density-error" class="error-message" aria-live="polite"></div>
                            <div id="density-tooltip" class="text-xs text-gray-500 mt-1">Select a common material or enter a custom density.</div>
                        </div>
                    </div>
                </form>
            </section>

            <section id="results-section" aria-labelledby="results-heading" class="mt-8">
                <h2 id="results-heading" class="text-2xl font-semibold text-gray-900 mb-4">Results</h2>
                <div id="results-container" class="bg-blue-50 border border-blue-100 rounded-lg p-6" aria-live="polite">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="result-card">
                            <h4>Total Volume</h4>
                            <p id="result-volume">0.00 <span class="unit-volume-label">yd³</span></p>
                        </div>
                        <div class="result-card">
                            <h4>Total Weight</h4>
                            <p id="result-weight">0.00 <span class="unit-weight-label">tons</span></p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
            <section aria-labelledby="methodology-heading">
                <h2 id="methodology-heading">Data Source and Methodology</h2>
                <p>This calculator bases its volume and weight estimations on standard geometrical formulas and material density data. The default densities are sourced from the <strong>National Stone, Sand & Gravel Association (NSSGA) "Aggregates Handbook, 2024 Edition"</strong>.</p>
                <p>All calculations adhere strictly to the formulas and density ranges provided by this source. Always confirm specific material density with your local supplier as it can vary based on moisture and composition.</p>
            </section>
            
            <section aria-labelledby="formula-heading">
                <h2 id="formula-heading">The Formulas Explained</h2>
                <p>The calculator first determines the total volume of the space and then converts that volume into weight based on the material's density.</p>
                
                <h3>1. Area Calculation</h3>
                <p>The first step is to find the surface area ($A$) of your project:</p>
                <div class="formula-box" role="math" aria-label="Area formula for a rectangle">
                    $$A_{\text{rectangle}} = \text{Length} \times \text{Width}$$
                </div>
                <div class="formula-box mt-2" role="math" aria-label="Area formula for a circle">
                    $$A_{\text{circle}} = \pi \times \text{Radius}^2$$
                </div>

                <h3>2. Volume Calculation</h3>
                <p>Next, we find the volume ($V$) by multiplying the area by the depth ($D$). All units must be consistent (e.g., all converted to feet or meters) before calculation.</p>
                <div class="formula-box" role="math" aria-label="Volume formula">
                    $$V = A \times D$$
                </div>
                <p>This result is then converted into standard material units (Cubic Yards or Cubic Meters).
                    <br>$1 \text{ yd}^3 = 27 \text{ ft}^3$
                    <br>$1 \text{ m}^3 = 1,000,000 \text{ cm}^3$
                </p>

                <h3>3. Weight Calculation</h3>
                <p>Finally, the weight ($W$) is calculated by multiplying the volume by the material density ($\rho$).</p>
                <div class="formula-box" role="math" aria-label="Weight formula">
                    $$W = V \times \rho$$
                </div>
            </section>

            <section aria-labelledby="variables-heading">
                <h2 id="variables-heading">Glossary of Variables</h2>
                <ul>
                    <li><strong>Area Shape:</strong> The geometric shape of the surface you are covering (e.g., Rectangle, Circle).</li>
                    <li><strong>Length / Width / Radius:</strong> The dimensions of your area. Ensure you are measuring the correct parts.</li>
                    <li><strong>Depth:</strong> The desired thickness of the material layer. This is often converted from inches or centimeters for the volume calculation.</li>
                    <li><strong>Material Density ($\rho$):</strong> The mass of the material per unit of volume (e.g., lbs per cubic yard or kg per cubic meter). This varies significantly between materials (e.g., mulch is much lighter than gravel).</li>
                    <li><strong>Required Volume:</strong> The total space the material will fill, expressed in cubic yards (yd³) or cubic meters (m³).</li>
                    <li><strong>Required Weight:</strong> The total tonnage needed, based on the volume and density. Typically shown in short tons (2,000 lbs) or metric tonnes (1,000 kg).</li>
                </ul>
            </section>

            <section aria-labelledby="example-heading">
                <h2 id="example-heading">How It Works: A Step-by-Step Example</h2>
                <p>Let's calculate the material for a rectangular driveway using **Imperial units**.</p>
                <ul>
                    <li><strong>Shape:</strong> Rectangle</li>
                    <li><strong>Length:</strong> 50 ft</li>
                    <li><strong>Width:</strong> 10 ft</li>
                    <li><strong>Depth:</strong> 4 in</li>
                    <li><strong>Material:</strong> Crushed Gravel (approx. 2,700 lbs/yd³)</li>
                </ul>
                <ol>
                    <li><strong>Unify Units (Depth):</strong> Convert depth from inches to feet.
                        <br> $D = 4 \text{ in} \div 12 \text{ in/ft} = 0.333 \text{ ft}$
                    </li>
                    <li><strong>Calculate Area (ft²):</strong>
                        <br> $A = 50 \text{ ft} \times 10 \text{ ft} = 500 \text{ ft}^2$
                    </li>
                    <li><strong>Calculate Volume (ft³):</strong>
                        <br> $V_{\text{ft}^3} = A \times D = 500 \text{ ft}^2 \times 0.333 \text{ ft} = 166.5 \text{ ft}^3$
                    </li>
                    <li><strong>Convert Volume (yd³):</strong> Divide by 27 to get cubic yards.
                        <br> $V_{\text{yd}^3} = 166.5 \text{ ft}^3 \div 27 \text{ ft}^3/\text{yd}^3 = 6.17 \text{ yd}^3$
                    </li>
                    <li><strong>Calculate Weight (lbs):</strong>
                        <br> $W_{\text{lbs}} = V_{\text{yd}^3} \times \rho = 6.17 \text{ yd}^3 \times 2700 \text{ lbs/yd}^3 = 16,659 \text{ lbs}$
                    </li>
                    <li><strong>Convert Weight (tons):</strong> Divide by 2,000 for short tons.
                        <br> $W_{\text{tons}} = 16,659 \text{ lbs} \div 2000 \text{ lbs/ton} = 8.33 \text{ tons}$
                    </li>
                </ol>
            </section>

            <section aria-labelledby="faq-heading">
                <h2 id="faq-heading">Frequently Asked Questions (FAQ)</h2>
                <details>
                    <summary>How much extra material should I order?</summary>
                    <p>It is standard practice to add a 5-10% "waste factor" to your order. This accounts for compaction, spreading, and any slight measurement inaccuracies. Our calculator provides the exact volume; consult with your supplier about how much extra to add.</p>
                </details>
                <details>
                    <summary>What is material density and why does it matter?</summary>
                    <p>Density is the weight of a material for a given volume. Two materials can have the same volume (e.g., one cubic yard) but very different weights. A cubic yard of mulch is far lighter than a cubic yard of crushed stone. Using the correct density is critical for an accurate weight calculation, which is often how materials are sold.</p>
                </details>
                <details>
                    <summary>What's the difference between a ton and a tonne?</summary>
                    <p>A "ton" (or "short ton") is an Imperial unit equal to 2,000 pounds. A "tonne" (or "metric ton") is a Metric unit equal to 1,000 kilograms (approx. 2,204.6 pounds). Our calculator uses the correct unit based on your "Imperial" or "Metric" selection.</p>
                </details>
                <details>
                    <summary>How deep should my gravel be?</summary>
                    <p>This depends entirely on the project.
                        <ul>
                            <li><strong>Pathways:</strong> 2-4 inches (5-10 cm) is common.</li>
                            <li><strong>Driveways:</strong> 8-12 inches (20-30 cm) is often recommended, built up in layers of different aggregate sizes.</li>
                            <li><strong>Patios:</strong> 4-6 inches (10-15 cm) for a paver base.</li>
                        </ul>
                        Always consult local building codes or a professional landscaper for your specific needs.
                    </p>
                </details>
                <details>
                    <summary>Why is my supplier's density different?</summary>
                    <p>Material density is not constant. It can be affected by the source quarry, moisture content (wet sand is heavier than dry sand), and compaction. The densities in our list are common averages. We always recommend asking your supplier for their specific material density for the most accurate calculation.</p>
                </details>
            </section>

            <div class="mt-8 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
                <p><strong>Tool developed by Ugo Candido.</strong> Construction methodology and content verified by the CalcDomain Editorial Board.<br>
                Last accuracy review: <time datetime="2025-10-31">October 31, 2025</time></p>
            </div>
        </article>
    </section>

    <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
            <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
                Ad Placement (300x600)
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
                <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
                    <li>Switch instantly between Imperial and Metric units.</li>
                    <li>Supports multiple area shapes (rectangles, circles).</li>
                    <li>Pre-filled densities for common materials like gravel, sand, and mulch.</li>
                    <li>Avoid over-buying and save money on your project.</li>
                    <li>Get volume (yd³/m³) and weight (tons/tonnes) at a glance.</li>
                </ul>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="font-bold text-lg mb-4">Related Construction Tools</h3>
                <ul class="space-y-3 text-sm">
                    <li><a href="concrete-calculator.html" class="text-blue-600 hover:underline">Concrete Calculator</a></li>
                    <li><a href="rebar-calculator.html" class="text-blue-600 hover:underline">Rebar Weight Calculator</a></li>
                    <li><a href="paver-calculator.html" class="text-blue-600 hover:underline">Paver Calculator</a></li>
                    <li><a href="paint-calculator.html" class="text-blue-600 hover:underline">Paint Calculator</a></li>
                </ul>
            </div>
        </div>
    </aside>
    </div>
</main>

<footer class="bg-white border-t mt-12">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
    <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
    <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
    </div>
    </div>
</footer>

<script defer>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM Elements ---
    const form = document.getElementById('stone-form');
    const unitSystemInputs = document.getElementsByName('unitSystem');
    const areaShapeSelect = document.getElementById('area-shape');
    
    const rectDimensions = document.getElementById('dimensions-rectangle');
    const circleDimensions = document.getElementById('dimensions-circle');
    
    const inputs = {
        length: document.getElementById('length'),
        width: document.getElementById('width'),
        radius: document.getElementById('radius'),
        depth: document.getElementById('depth'),
        density: document.getElementById('density'),
        materialType: document.getElementById('material-type')
    };

    const errorMessages = {
        length: document.getElementById('length-error'),
        width: document.getElementById('width-error'),
        radius: document.getElementById('radius-error'),
        depth: document.getElementById('depth-error'),
        density: document.getElementById('density-error')
    };

    const labels = {
        depth: document.querySelector('label[for="depth"] .unit-label'),
        length: document.querySelector('label[for="length"] .unit-label'),
        width: document.querySelector('label[for="width"] .unit-label'),
        radius: document.querySelector('label[for="radius"] .unit-label'),
        density: document.querySelector('label[for="density"] .density-unit-label')
    };

    const results = {
        volume: document.getElementById('result-volume'),
        weight: document.getElementById('result-weight'),
        volumeUnit: document.querySelectorAll('.unit-volume-label'),
        weightUnit: document.querySelectorAll('.unit-weight-label')
    };

    // --- Constants ---
    const DENSITIES = {
        // [imperial (lbs/yd³), metric (kg/m³)]
        gravel: [2700, 1600],
        sand: [2565, 1520],
        topsoil: [2025, 1200],
        mulch: [840, 500],
        custom: [0, 0]
    };
    
    const CONVERSIONS = {
        FT_TO_M: 0.3048,
        M_TO_FT: 3.28084,
        IN_TO_FT: 1 / 12,
        CM_TO_M: 1 / 100,
        FT3_TO_YD3: 1 / 27,
        M3_TO_YD3: 1.30795,
        LBS_TO_TON: 1 / 2000,
        KG_TO_TONNE: 1 / 1000,
        LBS_YD3_TO_KG_M3: 0.593276
    };

    // --- State ---
    let currentUnitSystem = 'imperial';
    let currentShape = 'rectangle';

    // --- Event Listeners ---
    form.addEventListener('input', () => {
        // Recalculate on any input
        calculate();
    });

    unitSystemInputs.forEach(input => {
        input.addEventListener('change', (e) => {
            currentUnitSystem = e.target.value;
            updateUIForUnitSystem();
            calculate();
        });
    });

    areaShapeSelect.addEventListener('change', (e) => {
        currentShape = e.target.value;
        updateUIForShape();
        calculate();
    });

    inputs.materialType.addEventListener('change', (e) => {
        updateDensityFromMaterial(e.target.value);
        calculate();
    });
    
    // --- UI Update Functions ---

    function updateUIForUnitSystem() {
        if (currentUnitSystem === 'imperial') {
            labels.depth.textContent = '(in)';
            labels.length.textContent = '(ft)';
            labels.width.textContent = '(ft)';
            labels.radius.textContent = '(ft)';
            labels.density.textContent = '(lbs/yd³)';
            results.volumeUnit.forEach(el => el.textContent = 'yd³');
            results.weightUnit.forEach(el => el.textContent = 'tons');
        } else {
            labels.depth.textContent = '(cm)';
            labels.length.textContent = '(m)';
            labels.width.textContent = '(m)';
            labels.radius.textContent = '(m)';
            labels.density.textContent = '(kg/m³)';
            results.volumeUnit.forEach(el => el.textContent = 'm³');
            results.weightUnit.forEach(el => el.textContent = 'tonnes');
        }
        updateDensityFromMaterial(inputs.materialType.value);
    }

    function updateUIForShape() {
        if (currentShape === 'rectangle') {
            rectDimensions.style.display = 'grid';
            circleDimensions.style.display = 'none';
            // Set aria-required for visible fields, remove for hidden
            inputs.length.setAttribute('aria-required', 'true');
            inputs.width.setAttribute('aria-required', 'true');
            inputs.radius.setAttribute('aria-required', 'false');
        } else { // circle
            rectDimensions.style.display = 'none';
            circleDimensions.style.display = 'grid';
            inputs.length.setAttribute('aria-required', 'false');
            inputs.width.setAttribute('aria-required', 'false');
            inputs.radius.setAttribute('aria-required', 'true');
        }
    }

    function updateDensityFromMaterial(material) {
        if (material === 'custom') {
            // Don't change it, let user type
            return;
        }
        const densityValue = DENSITIES[material][currentUnitSystem === 'imperial' ? 0 : 1];
        inputs.density.value = densityValue;
    }
    
    function resetErrors() {
        Object.values(errorMessages).forEach(el => el.textContent = '');
        Object.values(inputs).forEach(el => el && el.setAttribute('aria-invalid', 'false'));
    }

    function displayError(field, message) {
        if (errorMessages[field] && inputs[field]) {
            errorMessages[field].textContent = message;
            inputs[field].setAttribute('aria-invalid', 'true');
            return true;
        }
        return false;
    }

    // --- Calculation Logic ---

    function validateInputs() {
        let isValid = true;
        resetErrors();

        const checkPositive = (field) => {
            const val = parseFloat(inputs[field].value);
            if (isNaN(val) || val <= 0) {
                displayError(field, 'Must be a positive number.');
                isValid = false;
            }
        };

        if (currentShape === 'rectangle') {
            checkPositive('length');
            checkPositive('width');
        } else { // circle
            checkPositive('radius');
        }
        checkPositive('depth');
        checkPositive('density');
        
        return isValid;
    }

    function calculate() {
        if (!validateInputs()) {
            results.volume.innerHTML = `0.00 <span classclass="unit-volume-label">${currentUnitSystem === 'imperial' ? 'yd³' : 'm³'}</span>`;
            results.weight.innerHTML = `0.00 <span classclass="unit-weight-label">${currentUnitSystem === 'imperial' ? 'tons' : 'tonnes'}</span>`;
            return;
        }

        const vals = {
            length: parseFloat(inputs.length.value) || 0,
            width: parseFloat(inputs.width.value) || 0,
            radius: parseFloat(inputs.radius.value) || 0,
            depth: parseFloat(inputs.depth.value) || 0,
            density: parseFloat(inputs.density.value) || 0
        };

        let area_base, depth_base, volume_base, density_base;

        if (currentUnitSystem === 'imperial') {
            // Base unit: feet
            let length_ft = vals.length;
            let width_ft = vals.width;
            let radius_ft = vals.radius;
            let depth_ft = vals.depth * CONVERSIONS.IN_TO_FT;

            if (currentShape === 'rectangle') {
                area_base = length_ft * width_ft; // ft²
            } else { // circle
                area_base = Math.PI * Math.pow(radius_ft, 2); // ft²
            }
            
            volume_base = area_base * depth_ft; // ft³
            let volume_yd3 = volume_base * CONVERSIONS.FT3_TO_YD3; // yd³
            
            density_base = vals.density; // lbs/yd³
            let weight_lbs = volume_yd3 * density_base;
            let weight_tons = weight_lbs * CONVERSIONS.LBS_TO_TON;

            // Display Imperial
            results.volume.textContent = `${volume_yd3.toFixed(2)} yd³`;
            results.weight.textContent = `${weight_tons.toFixed(2)} tons`;

        } else {
            // Base unit: meters
            let length_m = vals.length;
            let width_m = vals.width;
            let radius_m = vals.radius;
            let depth_m = vals.depth * CONVERSIONS.CM_TO_M;

            if (currentShape === 'rectangle') {
                area_base = length_m * width_m; // m²
            } else { // circle
                area_base = Math.PI * Math.pow(radius_m, 2); // m²
            }
            
            volume_base = area_base * depth_m; // m³
            
            density_base = vals.density; // kg/m³
            let weight_kg = volume_base * density_base;
            let weight_tonnes = weight_kg * CONVERSIONS.KG_TO_TONNE;

            // Display Metric
            results.volume.textContent = `${volume_base.toFixed(2)} m³`;
            results.weight.textContent = `${weight_tonnes.toFixed(2)} tonnes`;
        }
    }

    // --- Initial Setup ---
    updateUIForUnitSystem();
    updateUIForShape();
    updateDensityFromMaterial(inputs.materialType.value);
    calculate();
    
    // Mobile menu toggle
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    menuToggle.addEventListener('click', () => {
        const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
        menuToggle.setAttribute('aria-expanded', !isExpanded);
        mobileMenu.classList.toggle('hidden');
    });

});
</script>

</body>
</html>