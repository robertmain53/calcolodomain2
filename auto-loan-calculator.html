<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Loan Calculator - Calculate Monthly Car Payments | CalcDomain</title>
    <meta name="description" content="Professional auto loan calculator to estimate monthly car payments, total interest, amount financed, and impact of sales tax and fees. Fast, accurate, and mobile-friendly.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose { max-width: 65ch; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .prose .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem; overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
        details > summary { cursor: pointer; font-weight: 600; }
        details[open] > summary { margin-bottom: 0.5rem; }
        .radio-group { display: flex; gap: 0.5rem; }
        .radio-option { display: flex; align-items: center; gap: 0.25rem; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer; }
        .radio-option input[type="radio"] { margin: 0; }
        .radio-option.selected { background-color: #3b82f6; color: white; }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Calculate Auto Loan Payments",
      "description": "A step-by-step guide to calculating monthly car payments, total interest, and amount financed.",
      "step": [
        {"@type": "HowToStep", "name": "Enter Vehicle Details", "text": "Input the vehicle price, down payment amount or percentage, and trade-in value if applicable."},
        {"@type": "HowToStep", "name": "Set Tax and Fees", "text": "Enter your local sales tax rate and any additional fees like documentation or title fees."},
        {"@type": "HowToStep", "name": "Loan Terms", "text": "Input the APR (Annual Percentage Rate) and loan term in years or months."},
        {"@type": "HowToStep", "name": "Review Results", "text": "The calculator displays monthly payment, total interest, amount financed, and total cost."}
      ]
    }
    </script>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 lg:px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>
            <div class="w-full max-w-md hidden md:block">
                <div class="relative">
                    <input type="search" placeholder="Search for a calculator..." class="w-full py-2 px-4 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                     <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>
             <div class="hidden md:block"></div>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Left Column: Calculator & Content -->
            <main class="w-full lg:w-2/3">
                <!-- Breadcrumbs -->
                <nav class="text-sm mb-4 text-gray-600">
                    <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
                    <a href="#" class="hover:text-blue-600">Finance</a> &raquo;
                    <span>Auto Loan Calculator</span>
                </nav>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <!-- Calculator Title and Intro -->
                    <h1 class="text-3xl font-bold mb-2">Auto Loan Calculator</h1>
                    <p class="text-gray-600 mb-6">Estimate your monthly car payment, amount financed, total interest, and overall cost including taxes and fees.</p>

                    <!-- Calculator Form -->
                    <div id="calculator-ui" class="space-y-6">
                        
                        <!-- Vehicle Price -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="vehiclePrice" class="block text-sm font-medium text-gray-700">Vehicle Price ($)</label>
                                <input type="number" id="vehiclePrice" value="30000" step="0.01" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="30000">
                            </div>
                            <div>
                                <label for="tradeInValue" class="block text-sm font-medium text-gray-700">Trade-in Value ($)</label>
                                <input type="number" id="tradeInValue" value="0" step="0.01" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="0">
                            </div>
                        </div>

                        <!-- Down Payment -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Down Payment</label>
                            <div class="flex flex-col space-y-4">
                                <div class="radio-group">
                                    <label class="radio-option selected" id="downAmountOption">
                                        <input type="radio" name="downPaymentType" value="amount" checked>
                                        <span>Amount ($)</span>
                                    </label>
                                    <label class="radio-option" id="downPercentOption">
                                        <input type="radio" name="downPaymentType" value="percent">
                                        <span>Percentage (%)</span>
                                    </label>
                                </div>
                                <input type="number" id="downPayment" value="3000" step="0.01" class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="3000">
                            </div>
                        </div>

                        <!-- Sales Tax and Fees -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="salesTaxRate" class="block text-sm font-medium text-gray-700">Sales Tax Rate (%)</label>
                                <input type="number" id="salesTaxRate" value="7.5" step="0.01" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="7.5">
                            </div>
                            <div>
                                <label for="fees" class="block text-sm font-medium text-gray-700">Documentation/Title Fees ($)</label>
                                <input type="number" id="fees" value="500" step="0.01" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="500">
                            </div>
                        </div>

                        <!-- Tax Options -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tax Calculation</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="taxFees" class="mr-2">
                                    <label for="taxFees" class="text-sm text-gray-600">Apply sales tax to fees</label>
                                </div>
                                <select id="taxBase" class="block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="priceMinusTrade">Tax on Price minus Trade-in</option>
                                    <option value="priceMinusTradeDown">Tax on Price minus Trade-in and Down payment</option>
                                </select>
                            </div>
                        </div>

                        <!-- Loan Terms -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="apr" class="block text-sm font-medium text-gray-700">APR (Annual %)</label>
                                <input type="number" id="apr" value="5.5" step="0.001" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="5.5">
                            </div>
                            <div>
                                <label for="loanTerm" class="block text-sm font-medium text-gray-700">Loan Term (Months)</label>
                                <input type="number" id="loanTerm" value="60" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="60">
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="results" class="mt-8 bg-blue-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Loan Summary:</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Monthly Payment</p>
                                <p class="text-2xl font-bold text-blue-600" id="monthlyPayment">$0.00</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Amount Financed</p>
                                <p class="text-2xl font-bold text-gray-700" id="amountFinanced">$0.00</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Total Interest</p>
                                <p class="text-2xl font-bold text-red-600" id="totalInterest">$0.00</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Total of Payments</p>
                                <p class="text-xl font-bold text-gray-700" id="totalPayments">$0.00</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Sales Tax</p>
                                <p class="text-xl font-bold text-gray-700" id="salesTax">$0.00</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">Total Cost</p>
                                <p class="text-xl font-bold text-green-600" id="totalCost">$0.00</p>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <button id="exportCsv" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md mr-2">Export Amortization Schedule</button>
                            <button id="copyLink" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">Copy Shareable Link</button>
                        </div>
                    </div>
                </div>

                <!-- SEO Content Area -->
                <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
                    <h2>Data Source and Methodology</h2>
                    <p class="text-blue-700 font-semibold">✓ Authoritative Source</p>
                    <p>This calculator provides professional-grade estimates based on standard financial mathematics used in the automotive lending industry. Our calculations follow the established amortization formulas used by banks and credit unions.</p>
                    
                    <ul>
                        <li><strong>OpenStax Business Math</strong>, Section 13.3 Annuities—Present Value and Payments, 2022. <a href="https://openstax.org/details/books/business-math" target="_blank" rel="noopener">Publisher</a></li>
                        <li><strong>Federal Trade Commission</strong> guidance on auto loan calculations and consumer protection standards.</li>
                        <li><strong>Consumer Financial Protection Bureau (CFPB)</strong> resources on auto lending practices and APR calculations.</li>
                    </ul>
                    <p><strong>All calculations are strictly based on the formulas and data provided by these authoritative sources.</strong></p>

                    <h2>The Auto Loan Formula Explained</h2>
                    <p>Understanding the mathematics behind auto loans helps you make informed decisions about your purchase. Here are the core formulas used by our calculator:</p>
                    
                    <div class="formula-box" aria-label="Auto loan formulas">
                        <p><strong>Monthly Payment (Amortizing Loan):</strong><br>
                        <code>PMT = P × [i(1 + i)^n] / [(1 + i)^n - 1]</code></p>
                        
                        <p><strong>Where:</strong><br>
                        • P = Principal (amount financed)<br>
                        • i = Monthly interest rate (APR ÷ 12)<br>
                        • n = Number of payments (months)</p>
                        
                        <p><strong>Amount Financed:</strong><br>
                        <code>P = (Vehicle Price - Down Payment - Trade-in) + Fees + Sales Tax</code></p>
                        
                        <p><strong>For 0% APR:</strong><br>
                        <code>PMT = P ÷ n</code></p>
                    </div>

                    <h2>How to Use the Auto Loan Calculator</h2>
                    <p>Our calculator is designed to provide accurate estimates for your auto loan by considering all major factors that affect your monthly payment and total cost.</p>
                    
                    <h3>Step-by-Step Instructions</h3>
                    <ol>
                        <li><strong>Vehicle Price:</strong> Enter the total purchase price of the vehicle before any deductions or additions.</li>
                        <li><strong>Trade-in Value:</strong> If you're trading in a vehicle, enter its estimated value. This reduces the amount you need to finance.</li>
                        <li><strong>Down Payment:</strong> Choose between entering a fixed dollar amount or a percentage of the vehicle price. A larger down payment reduces your monthly payment and total interest.</li>
                        <li><strong>Sales Tax Rate:</strong> Enter your local sales tax rate as a percentage. This varies by state and sometimes by county or city.</li>
                        <li><strong>Fees:</strong> Include documentation fees, title fees, registration, and other dealer charges.</li>
                        <li><strong>Tax Calculation:</strong> Choose how sales tax is calculated in your area—some states tax the full price minus trade-in, while others also subtract the down payment.</li>
                        <li><strong>APR:</strong> Enter the Annual Percentage Rate offered by your lender. This includes interest and certain fees.</li>
                        <li><strong>Loan Term:</strong> Enter the length of the loan in months. Common terms are 36, 48, 60, or 72 months.</li>
                    </ol>

                    <!-- In-Content Ad Placeholder -->
                    <div class="text-center my-6 bg-gray-200 py-10">
                        <p class="text-gray-500">In-Content Ad Unit</p>
                    </div>

                    <h2>Understanding Your Results</h2>
                    <p>The calculator provides a comprehensive breakdown of your auto loan costs:</p>
                    
                    <ul>
                        <li><strong>Monthly Payment:</strong> Your fixed monthly payment amount for principal and interest only (does not include insurance).</li>
                        <li><strong>Amount Financed:</strong> The total amount you're borrowing after down payment, trade-in, plus taxes and fees.</li>
                        <li><strong>Total Interest:</strong> The total amount you'll pay in interest over the life of the loan.</li>
                        <li><strong>Total of Payments:</strong> The sum of all monthly payments you'll make.</li>
                        <li><strong>Sales Tax:</strong> The calculated sales tax based on your local rate and tax base selection.</li>
                        <li><strong>Total Cost:</strong> The complete cost including the vehicle price, interest, taxes, and fees.</li>
                    </ul>

                    <h2>Factors That Affect Your Auto Loan</h2>
                    <p>Several factors influence your monthly payment and total cost:</p>
                    
                    <h3>Credit Score Impact</h3>
                    <p>Your credit score significantly affects the APR you'll qualify for. Higher credit scores typically receive lower interest rates, while lower scores may face higher rates or require larger down payments.</p>
                    
                    <h3>Loan Term Considerations</h3>
                    <p>Longer loan terms reduce monthly payments but increase total interest paid. Shorter terms have higher monthly payments but save money on interest. Consider your budget and the vehicle's expected lifespan when choosing a term.</p>
                    
                    <h3>Down Payment Benefits</h3>
                    <p>A larger down payment reduces the amount financed, lowering monthly payments and total interest. It also helps you avoid being "upside down" on the loan (owing more than the vehicle is worth).</p>

                    <h2>Frequently Asked Questions (FAQ)</h2>
                    <details class="border-b py-2">
                        <summary>How is APR different from the interest rate?</summary>
                        <p class="mt-2 text-gray-700">APR (Annual Percentage Rate) includes the interest rate plus certain fees and costs, giving you a more complete picture of the loan's cost. The interest rate is just the cost of borrowing the principal amount.</p>
                    </details>
                    <details class="border-b py-2">
                        <summary>Should I finance through the dealer or my bank?</summary>
                        <p class="mt-2 text-gray-700">Compare offers from multiple sources including your bank, credit union, and dealer financing. Dealers sometimes offer promotional rates, but your bank or credit union might provide better terms, especially if you have good credit.</p>
                    </details>
                    <details class="border-b py-2">
                        <summary>What if I want to pay off my loan early?</summary>
                        <p class="mt-2 text-gray-700">Most auto loans don't have prepayment penalties, so you can pay extra toward principal or pay off the loan early to save on interest. Check your loan agreement to confirm there are no prepayment restrictions.</p>
                    </details>
                    <details class="border-b py-2">
                        <summary>How accurate are these calculations?</summary>
                        <p class="mt-2 text-gray-700">Our calculations use standard financial formulas and are accurate for estimation purposes. Actual loan terms may vary based on credit approval, lender policies, and specific vehicle details. Always confirm final terms with your lender.</p>
                    </details>
                    <details class="border-b py-2">
                        <summary>What costs are not included in this calculator?</summary>
                        <p class="mt-2 text-gray-700">This calculator doesn't include auto insurance, extended warranties, maintenance costs, or optional add-ons like GAP coverage. These additional costs should be factored into your total budget.</p>
                    </details>

                    <h2>Tips for Getting the Best Auto Loan</h2>
                    <ul>
                        <li><strong>Check your credit score</strong> before shopping and address any errors on your credit report.</li>
                        <li><strong>Shop around</strong> with multiple lenders including banks, credit unions, and online lenders.</li>
                        <li><strong>Get pre-approved</strong> to know your rate and budget before visiting dealers.</li>
                        <li><strong>Consider certified pre-owned vehicles</strong> which often qualify for better financing rates than used cars.</li>
                        <li><strong>Negotiate the vehicle price</strong> separately from financing to ensure you get the best deal.</li>
                        <li><strong>Read all terms carefully</strong> including any fees, prepayment policies, and insurance requirements.</li>
                    </ul>
                </article>
            </main>

            <!-- Right Sidebar: Ads & Related Links -->
            <aside class="w-full lg:w-1/3">
                <div class="sticky top-24">
                    <!-- Ad Placeholder -->
                    <div class="bg-gray-200 h-96 rounded-lg mb-6 flex items-center justify-center">
                        <p class="text-gray-500">Sticky Ad Unit (e.g., 300x600)</p>
                    </div>

                    <!-- Related Calculators -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-4">Related Financial Tools</h3>
                        <ul class="space-y-3">
                            <li><a href="mortgage-calculator.html" class="text-blue-600 hover:underline">Mortgage Calculator</a></li>
                            <li><a href="loan-amortization-calculator.html" class="text-blue-600 hover:underline">Loan Amortization Calculator</a></li>
                            <li><a href="apr-calculator.html" class="text-blue-600 hover:underline">APR Calculator</a></li>
                            <li><a href="debt-to-income-ratio-calculator.html" class="text-blue-600 hover:underline">Debt-to-Income Ratio Calculator</a></li>
                            <li><a href="car-affordability-calculator.html" class="text-blue-600 hover:underline">Car Affordability Calculator</a></li>
                            <li><a href="refinance-calculator.html" class="text-blue-600 hover:underline">Refinance Calculator</a></li>
                        </ul>
                    </div>
                </div>
            </aside>

        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="font-bold text-lg mb-4">CalcDomain</h4>
                    <p class="text-gray-600">High-precision tools for professionals and everyday use.</p>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Finance Tools</h4>
                    <ul class="space-y-2 text-gray-600">
                        <li><a href="mortgage-calculator.html" class="hover:text-blue-600">Mortgage Calculator</a></li>
                        <li><a href="investment-calculator.html" class="hover:text-blue-600">Investment Calculator</a></li>
                        <li><a href="retirement-calculator.html" class="hover:text-blue-600">Retirement Calculator</a></li>
                        <li><a href="budget-calculator.html" class="hover:text-blue-600">Budget Calculator</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Categories</h4>
                    <ul class="space-y-2 text-gray-600">
                        <li><a href="construction.html" class="hover:text-blue-600">Construction</a></li>
                        <li><a href="health-and-fitness.html" class="hover:text-blue-600">Health & Fitness</a></li>
                        <li><a href="science.html" class="hover:text-blue-600">Science</a></li>
                        <li><a href="math.html" class="hover:text-blue-600">Math</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Company</h4>
                    <ul class="space-y-2 text-gray-600">
                        <li><a href="about.html" class="hover:text-blue-600">About Us</a></li>
                        <li><a href="contact.html" class="hover:text-blue-600">Contact</a></li>
                        <li><a href="privacy.html" class="hover:text-blue-600">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center text-gray-600 mt-8 pt-8 border-t">
                <p>Tool developed by <strong>Ugo Candido</strong>. Content verified by <strong>CalcDomain Expert Review Team</strong>.</p>
                <p>Last reviewed for accuracy on: <time datetime="2025-09-12">September 12, 2025</time></p>
                <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- Auto Loan Calculator Logic ---
        
        // Get references to all HTML elements
        const elements = {
            vehiclePrice: document.getElementById('vehiclePrice'),
            tradeInValue: document.getElementById('tradeInValue'),
            downPayment: document.getElementById('downPayment'),
            salesTaxRate: document.getElementById('salesTaxRate'),
            fees: document.getElementById('fees'),
            taxFees: document.getElementById('taxFees'),
            taxBase: document.getElementById('taxBase'),
            apr: document.getElementById('apr'),
            loanTerm: document.getElementById('loanTerm'),
            monthlyPayment: document.getElementById('monthlyPayment'),
            amountFinanced: document.getElementById('amountFinanced'),
            totalInterest: document.getElementById('totalInterest'),
            totalPayments: document.getElementById('totalPayments'),
            salesTax: document.getElementById('salesTax'),
            totalCost: document.getElementById('totalCost'),
            exportCsv: document.getElementById('exportCsv'),
            copyLink: document.getElementById('copyLink'),
            downAmountOption: document.getElementById('downAmountOption'),
            downPercentOption: document.getElementById('downPercentOption')
        };

        // Helper functions
        const fmtCurrency = (amount) => new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        }).format(amount);

        // Down payment type toggle
        function setupDownPaymentToggle() {
            const radioButtons = document.querySelectorAll('input[name="downPaymentType"]');
            const options = [elements.downAmountOption, elements.downPercentOption];
            
            radioButtons.forEach((radio, index) => {
                radio.addEventListener('change', () => {
                    if (radio.checked) {
                        options.forEach(option => option.classList.remove('selected'));
                        options[index].classList.add('selected');
                        
                        if (radio.value === 'percent') {
                            elements.downPayment.placeholder = '10';
                            elements.downPayment.value = '10';
                        } else {
                            elements.downPayment.placeholder = '3000';
                            elements.downPayment.value = '3000';
                        }
                        calculate();
                    }
                });
            });
        }

        // Main calculation function
        function calculate() {
            // Get input values
            const vehiclePrice = parseFloat(elements.vehiclePrice.value) || 0;
            const tradeInValue = parseFloat(elements.tradeInValue.value) || 0;
            const downPaymentValue = parseFloat(elements.downPayment.value) || 0;
            const salesTaxRate = parseFloat(elements.salesTaxRate.value) || 0;
            const fees = parseFloat(elements.fees.value) || 0;
            const apr = parseFloat(elements.apr.value) || 0;
            const loanTermMonths = parseInt(elements.loanTerm.value) || 60;
            
            // Determine down payment type
            const downPaymentType = document.querySelector('input[name="downPaymentType"]:checked').value;
            let downPaymentAmount;
            
            if (downPaymentType === 'percent') {
                downPaymentAmount = (downPaymentValue / 100) * vehiclePrice;
            } else {
                downPaymentAmount = downPaymentValue;
            }
            
            // Calculate taxable amount based on tax base selection
            let taxableAmount;
            if (elements.taxBase.value === 'priceMinusTradeDown') {
                taxableAmount = vehiclePrice - tradeInValue - downPaymentAmount;
            } else {
                taxableAmount = vehiclePrice - tradeInValue;
            }
            taxableAmount = Math.max(0, taxableAmount);
            
            // Calculate sales tax
            let salesTaxAmount = (salesTaxRate / 100) * taxableAmount;
            if (elements.taxFees.checked) {
                salesTaxAmount += (salesTaxRate / 100) * fees;
            }
            
            // Calculate amount financed
            const amountFinanced = vehiclePrice - downPaymentAmount - tradeInValue + fees + salesTaxAmount;
            
            // Calculate monthly payment
            let monthlyPayment;
            if (apr === 0) {
                monthlyPayment = amountFinanced / loanTermMonths;
            } else {
                const monthlyRate = apr / 100 / 12;
                const numerator = amountFinanced * monthlyRate * Math.pow(1 + monthlyRate, loanTermMonths);
                const denominator = Math.pow(1 + monthlyRate, loanTermMonths) - 1;
                monthlyPayment = numerator / denominator;
            }
            
            const totalPayments = monthlyPayment * loanTermMonths;
            const totalInterest = totalPayments - amountFinanced;
            const totalCost = vehiclePrice + totalInterest + salesTaxAmount + fees;
            
            // Update display
            elements.monthlyPayment.textContent = fmtCurrency(monthlyPayment);
            elements.amountFinanced.textContent = fmtCurrency(amountFinanced);
            elements.totalInterest.textContent = fmtCurrency(totalInterest);
            elements.totalPayments.textContent = fmtCurrency(totalPayments);
            elements.salesTax.textContent = fmtCurrency(salesTaxAmount);
            elements.totalCost.textContent = fmtCurrency(totalCost);
        }

        // Generate amortization schedule for CSV export
        function generateAmortizationSchedule() {
            const vehiclePrice = parseFloat(elements.vehiclePrice.value) || 0;
            const tradeInValue = parseFloat(elements.tradeInValue.value) || 0;
            const downPaymentValue = parseFloat(elements.downPayment.value) || 0;
            const salesTaxRate = parseFloat(elements.salesTaxRate.value) || 0;
            const fees = parseFloat(elements.fees.value) || 0;
            const apr = parseFloat(elements.apr.value) || 0;
            const loanTermMonths = parseInt(elements.loanTerm.value) || 60;
            
            const downPaymentType = document.querySelector('input[name="downPaymentType"]:checked').value;
            let downPaymentAmount = downPaymentType === 'percent' ? 
                (downPaymentValue / 100) * vehiclePrice : downPaymentValue;
            
            let taxableAmount = elements.taxBase.value === 'priceMinusTradeDown' ?
                vehiclePrice - tradeInValue - downPaymentAmount : vehiclePrice - tradeInValue;
            taxableAmount = Math.max(0, taxableAmount);
            
            let salesTaxAmount = (salesTaxRate / 100) * taxableAmount;
            if (elements.taxFees.checked) {
                salesTaxAmount += (salesTaxRate / 100) * fees;
            }
            
            const principal = vehiclePrice - downPaymentAmount - tradeInValue + fees + salesTaxAmount;
            const monthlyRate = apr / 100 / 12;
            
            let monthlyPayment;
            if (apr === 0) {
                monthlyPayment = principal / loanTermMonths;
            } else {
                const numerator = principal * monthlyRate * Math.pow(1 + monthlyRate, loanTermMonths);
                const denominator = Math.pow(1 + monthlyRate, loanTermMonths) - 1;
                monthlyPayment = numerator / denominator;
            }
            
            const schedule = [];
            let remainingBalance = principal;
            
            for (let month = 1; month <= loanTermMonths; month++) {
                const interestPayment = apr === 0 ? 0 : remainingBalance * monthlyRate;
                const principalPayment = monthlyPayment - interestPayment;
                remainingBalance = Math.max(0, remainingBalance - principalPayment);
                
                schedule.push({
                    month,
                    payment: monthlyPayment,
                    principal: principalPayment,
                    interest: interestPayment,
                    balance: remainingBalance
                });
            }
            
            return schedule;
        }

        // Export CSV functionality
        function exportToCsv() {
            const schedule = generateAmortizationSchedule();
            let csvContent = "Month,Payment,Principal,Interest,Remaining Balance\n";
            
            schedule.forEach(row => {
                csvContent += `${row.month},${row.payment.toFixed(2)},${row.principal.toFixed(2)},${row.interest.toFixed(2)},${row.balance.toFixed(2)}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'auto_loan_amortization.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Copy shareable link functionality
        function copyShareableLink() {
            const params = new URLSearchParams();
            params.set('price', elements.vehiclePrice.value);
            params.set('tradeIn', elements.tradeInValue.value);
            params.set('downPayment', elements.downPayment.value);
            params.set('downType', document.querySelector('input[name="downPaymentType"]:checked').value);
            params.set('taxRate', elements.salesTaxRate.value);
            params.set('fees', elements.fees.value);
            params.set('taxFees', elements.taxFees.checked);
            params.set('taxBase', elements.taxBase.value);
            params.set('apr', elements.apr.value);
            params.set('term', elements.loanTerm.value);
            
            const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
            
            navigator.clipboard.writeText(url).then(() => {
                const originalText = elements.copyLink.textContent;
                elements.copyLink.textContent = 'Link Copied!';
                setTimeout(() => {
                    elements.copyLink.textContent = originalText;
                }, 2000);
            }).catch(() => {
                prompt('Copy this link:', url);
            });
        }

        // Load parameters from URL
        function loadFromUrl() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.get('price')) elements.vehiclePrice.value = params.get('price');
            if (params.get('tradeIn')) elements.tradeInValue.value = params.get('tradeIn');
            if (params.get('downPayment')) elements.downPayment.value = params.get('downPayment');
            if (params.get('downType')) {
                document.querySelector(`input[name="downPaymentType"][value="${params.get('downType')}"]`).checked = true;
            }
            if (params.get('taxRate')) elements.salesTaxRate.value = params.get('taxRate');
            if (params.get('fees')) elements.fees.value = params.get('fees');
            if (params.get('taxFees')) elements.taxFees.checked = params.get('taxFees') === 'true';
            if (params.get('taxBase')) elements.taxBase.value = params.get('taxBase');
            if (params.get('apr')) elements.apr.value = params.get('apr');
            if (params.get('term')) elements.loanTerm.value = params.get('term');
        }

        // Event listeners
        function setupEventListeners() {
            // Add input event listeners for real-time calculation
            Object.values(elements).forEach(element => {
                if (element && (element.tagName === 'INPUT' || element.tagName === 'SELECT')) {
                    element.addEventListener('input', calculate);
                    element.addEventListener('change', calculate);
                }
            });

            // Export and share functionality
            elements.exportCsv.addEventListener('click', exportToCsv);
            elements.copyLink.addEventListener('click', copyShareableLink);
        }

        // Initialize the calculator
        function init() {
            setupDownPaymentToggle();
            loadFromUrl();
            setupEventListeners();
            calculate(); // Initial calculation
        }

        // Run when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
