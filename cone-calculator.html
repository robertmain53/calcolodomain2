<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cone Calculator — Volume, Surface Area, Slant Height & Angles</title>
  <meta name="description" content="Professional cone calculator: compute volume, lateral and total surface area, slant height, base radius/diameter, and apex angle from your choice of inputs. Mobile-first, accessible, and accurate." />
  <link rel="canonical" href="https://calcdomain.com/cone-calculator.html" />

  <!-- Icons / Manifest -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MathJax for LaTeX -->
  <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Structured Data: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Cone Calculator — Volume, Surface Area, Slant Height & Angles",
    "description":"Professional cone calculator: compute volume, lateral and total surface area, slant height, base radius/diameter, and apex angle from your choice of inputs.",
    "url":"https://calcdomain.com/cone-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- Structured Data: WebApplication (Calculator) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Cone Calculator",
    "applicationCategory":"Calculator",
    "operatingSystem":"Any",
    "url":"https://calcdomain.com/cone-calculator.html",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "featureList":[
      "Volume from radius & height",
      "Surface areas (lateral & total)",
      "Slant height and apex angle",
      "Solve from different input pairs (r+h, d+h, r+l, V+h)"
    ]
  }
  </script>

  <!-- Structured Data: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Geometry","item":"https://calcdomain.com/subcategories/geometry.html"},
      {"@type":"ListItem","position":4,"name":"Cone Calculator","item":"https://calcdomain.com/cone-calculator.html"}
    ]
  }
  </script>

  <!-- Structured Data: FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What inputs do I need to calculate a cone?","acceptedAnswer":{"@type":"Answer","text":"You can compute a cone from different pairs of values: radius and height, diameter and height, radius and slant height, or volume and height. The calculator lets you pick the pair you have."}},
      {"@type":"Question","name":"What is the difference between lateral and total surface area?","acceptedAnswer":{"@type":"Answer","text":"Lateral surface area excludes the base and equals π·r·l. Total surface area includes the base: π·r·(r + l)."}},
      {"@type":"Question","name":"How do I find the apex (aperture) angle?","acceptedAnswer":{"@type":"Answer","text":"The full apex angle is 2·arctan(r/h). The half-angle at the axis is arctan(r/h)."}},
      {"@type":"Question","name":"Can I enter diameter instead of radius?","acceptedAnswer":{"@type":"Answer","text":"Yes. Choose the input mode “Diameter + Height” and the tool will convert diameter to radius automatically (r = d/2)."}},
      {"@type":"Question","name":"Which units does the calculator support?","acceptedAnswer":{"@type":"Answer","text":"Select Metric (mm, cm, m) or US/Imperial (in, ft). All results are shown coherently in the chosen unit system."}},
      {"@type":"Question","name":"Does this calculator include frustums?","acceptedAnswer":{"@type":"Answer","text":"This page focuses on right circular cones. A frustum calculator is available separately and covers truncated cones."}},
      {"@type":"Question","name":"Are the formulas valid for any cone?","acceptedAnswer":{"@type":"Answer","text":"Formulas here assume a right circular cone (axis perpendicular to base center). Oblique cones require integral methods and are outside this scope."}}
    ]
  }
  </script>

  <style>
    :root { --brand:#1d4ed8; --ink:#0b1324; --muted:#4b5563; --surface:#ffffff; --bg:#f5f7fb; --danger:#b91c1c; }
    html,body{height:100%}
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;background:var(--bg);color:var(--ink)}
    .container{max-width:1100px}
    .prose{max-width:68ch}
    .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:10px;padding:1rem;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .result-card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;text-align:center}
    .result-card h4{font-size:.95rem;color:#6b7280;margin-bottom:.25rem}
    .result-card p{font-size:1.5rem;font-weight:700;color:var(--brand)}
    /* Focus styles (WCAG 2.1 AA) */
    :focus-visible{outline:3px solid #2563eb; outline-offset:3px; border-radius:8px}
    /* Min-height to prevent CLS when results update */
    #results-cards{min-height: 220px}
    /* Touch target sizing */
    .touch-target{min-height:48px;min-width:48px}
    /* Print */
    @media print{
      body *{visibility:hidden}
      #print-section, #print-section *{visibility:visible}
      #print-section{position:absolute;left:0;top:0;width:100%}
    }
  </style>
</head>
<body>
  <!-- Header (non-sticky per requirements) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a href="search.html" class="hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="hover:text-blue-600">Categories</a>
      </div>
      <button class="md:hidden touch-target p-2" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="math.html" class="hover:text-blue-600">Math</a> &raquo;
          <a href="subcategories/geometry.html" class="hover:text-blue-600">Geometry</a> &raquo;
          <span class="text-gray-900">Cone Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-xl shadow-sm">
          <h1 class="text-3xl font-extrabold mb-2">cone calculator</h1>
          <p class="text-gray-600 mb-6">
            Compute a right circular cone’s <strong>volume</strong>, <strong>lateral and total surface area</strong>,
            <strong>slant height</strong>, and <strong>apex angle</strong>. Designed for engineers, fabricators,
            students, and educators who need fast, reliable results with clear formulas and units.
          </p>

          <!-- Calculator UI -->
          <section aria-labelledby="calculator-title" class="space-y-6" id="calculator-ui">
            <h2 id="calculator-title" class="sr-only">Cone Calculator Inputs</h2>

            <!-- Unit System -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="unitSystem" class="block text-sm font-medium text-gray-800">Unit system *</label>
                <select id="unitSystem" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500 touch-target" aria-required="true" aria-describedby="unitSystem_help">
                  <option value="metric" selected>Metric (mm, cm, m)</option>
                  <option value="imperial">US/Imperial (in, ft)</option>
                </select>
                <p id="unitSystem_help" class="text-xs text-gray-500 mt-1">Choose the measurement system used for inputs and results.</p>
              </div>

              <div>
                <label for="mode" class="block text-sm font-medium text-gray-800">
                  Input mode * 
                  <button type="button" class="ml-1 text-blue-700 underline touch-target align-middle" id="modeTipBtn" aria-expanded="false" aria-controls="modeTip">
                    ?
                  </button>
                </label>
                <select id="mode" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500 touch-target" aria-required="true" aria-describedby="modeTip">
                  <option value="r_h" selected>Radius (r) + Height (h)</option>
                  <option value="d_h">Diameter (d) + Height (h)</option>
                  <option value="r_l">Radius (r) + Slant (l)</option>
                  <option value="V_h">Volume (V) + Height (h)</option>
                </select>
                <p id="modeTip" class="text-xs text-gray-500 mt-1 hidden">
                  Pick the pair of values you know. The calculator solves the rest automatically.
                </p>
              </div>

              <div>
                <label for="unitLength" class="block text-sm font-medium text-gray-800">Display length unit *</label>
                <select id="unitLength" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500 touch-target" aria-required="true" aria-describedby="unitLength_help">
                  <option value="mm">mm</option>
                  <option value="cm" selected>cm</option>
                  <option value="m">m</option>
                  <option value="in">in</option>
                  <option value="ft">ft</option>
                </select>
                <p id="unitLength_help" class="text-xs text-gray-500 mt-1">Affects how lengths are shown (radius, height, slant).</p>
              </div>
            </div>

            <!-- Dynamic Inputs -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="inputs-grid">
              <!-- Radius -->
              <div>
                <label for="radius" class="block text-sm font-medium text-gray-800">
                  Radius r * 
                  <button type="button" class="ml-1 text-blue-700 underline touch-target" id="radiusTipBtn" aria-expanded="false" aria-controls="radiusTip">?</button>
                </label>
                <input type="number" inputmode="decimal" id="radius" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" step="any" min="0" aria-required="true" aria-describedby="radiusTip radius_error" />
                <p id="radiusTip" class="text-xs text-gray-500 mt-1 hidden">Distance from the center of the base to its edge.</p>
                <p id="radius_error" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>

              <!-- Height -->
              <div>
                <label for="height" class="block text-sm font-medium text-gray-800">
                  Height h * 
                  <button type="button" class="ml-1 text-blue-700 underline touch-target" id="heightTipBtn" aria-expanded="false" aria-controls="heightTip">?</button>
                </label>
                <input type="number" inputmode="decimal" id="height" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" step="any" min="0" aria-required="true" aria-describedby="heightTip height_error" />
                <p id="heightTip" class="text-xs text-gray-500 mt-1 hidden">Axis length from base center to apex (right cone).</p>
                <p id="height_error" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>

              <!-- Diameter (only for d+h mode) -->
              <div id="diameter_wrap" class="hidden">
                <label for="diameter" class="block text-sm font-medium text-gray-800">Diameter d *</label>
                <input type="number" inputmode="decimal" id="diameter" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" step="any" min="0" aria-required="true" aria-describedby="diameter_error"/>
                <p id="diameter_error" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>

              <!-- Slant (only for r+l mode) -->
              <div id="slant_wrap" class="hidden">
                <label for="slant" class="block text-sm font-medium text-gray-800">
                  Slant l * 
                  <button type="button" class="ml-1 text-blue-700 underline touch-target" id="slantTipBtn" aria-expanded="false" aria-controls="slantTip">?</button>
                </label>
                <input type="number" inputmode="decimal" id="slant" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" step="any" min="0" aria-required="true" aria-describedby="slantTip slant_error" />
                <p id="slantTip" class="text-xs text-gray-500 mt-1 hidden">Generator length along the side of the cone.</p>
                <p id="slant_error" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>

              <!-- Volume (only for V+h mode) -->
              <div id="volume_wrap" class="hidden">
                <label for="volume" class="block text-sm font-medium text-gray-800">Volume V *</label>
                <input type="number" inputmode="decimal" id="volume" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500" step="any" min="0" aria-required="true" aria-describedby="volume_error"/>
                <p id="volume_error" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>
            </div>

            <div class="flex items-center gap-3 pt-2">
              <button id="calcBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-3 rounded-md touch-target">Calculate</button>
              <button id="resetBtn" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 font-medium px-5 py-3 rounded-md touch-target">Reset</button>
              <button id="printBtn" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 font-medium px-5 py-3 rounded-md touch-target">Print</button>
            </div>
          </section>

          <!-- Results -->
          <section aria-labelledby="results-title" class="mt-8">
            <h2 id="results-title" class="sr-only">Results</h2>
            <div id="results-cards" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="result-card"><h4>Radius r</h4><p id="out_r">—</p></div>
              <div class="result-card"><h4>Height h</h4><p id="out_h">—</p></div>
              <div class="result-card"><h4>Slant l</h4><p id="out_l">—</p></div>
              <div class="result-card"><h4>Base diameter d</h4><p id="out_d">—</p></div>
              <div class="result-card"><h4>Lateral area \(A_L\)</h4><p id="out_A_lat">—</p></div>
              <div class="result-card"><h4>Total area \(A_T\)</h4><p id="out_A_tot">—</p></div>
              <div class="result-card"><h4>Base area \(A_B\)</h4><p id="out_A_base">—</p></div>
              <div class="result-card"><h4>Volume \(V\)</h4><p id="out_V">—</p></div>
              <div class="result-card sm:col-span-2"><h4>Apex angle (full)</h4><p id="out_apex">—</p></div>
            </div>
          </section>
        </div>

        <!-- Authoritative Content Ecosystem -->
        <article class="bg-white p-6 rounded-xl shadow-sm mt-8 prose">
          <h2>Source of Data & Methodology</h2>
          <p>
            <strong>Authoritative source:</strong> National Institute of Standards and Technology (NIST),
            <em>Digital Library of Mathematical Functions</em>, Geometry of 3D shapes; and CRC Standard Mathematical Tables &amp; Formulae (selected identities).
            <a href="https://dlmf.nist.gov/" rel="noopener">NIST DLMF (accessed Oct 25, 2025)</a>.
            <br><em>All calculations strictly follow the formulas and definitions from this source.</em>
          </p>

          <h2>The formulas explained</h2>
          <div class="formula-box">
            For a right circular cone with base radius \(r\), height \(h\), and slant height \(l=\sqrt{r^2+h^2}\):<br/><br/>
            Base area: \(\displaystyle A_B=\pi r^2\)<br/>
            Lateral area: \(\displaystyle A_L=\pi r\,l\)<br/>
            Total area: \(\displaystyle A_T=\pi r(r+l)\)<br/>
            Volume: \(\displaystyle V=\frac{1}{3}\pi r^2 h\)<br/>
            Apex angle (full): \(\displaystyle \Theta = 2\,\arctan\!\left(\frac{r}{h}\right)\), &nbsp; half-angle \(\displaystyle \alpha=\arctan\!\left(\frac{r}{h}\right)\).
          </div>

          <h2>Glossary of variables</h2>
          <ul>
            <li><strong>r</strong>: base radius (length)</li>
            <li><strong>d</strong>: base diameter \(d=2r\) (length)</li>
            <li><strong>h</strong>: height (axis) (length)</li>
            <li><strong>l</strong>: slant height (generator) (length)</li>
            <li><strong>A_B</strong>: base area (\( \text{length}^2 \))</li>
            <li><strong>A_L</strong>: lateral surface area (\( \text{length}^2 \))</li>
            <li><strong>A_T</strong>: total surface area (\( \text{length}^2 \))</li>
            <li><strong>V</strong>: volume (\( \text{length}^3 \))</li>
            <li><strong>\(\Theta\)</strong>: full apex (aperture) angle in degrees</li>
          </ul>

          <h2>How it works: a step-by-step example</h2>
          <p>
            Suppose you have a cone with <strong>r = 5&nbsp;cm</strong> and <strong>h = 12&nbsp;cm</strong>.
          </p>
          <ol>
            <li>Compute \(l=\sqrt{r^2+h^2}=\sqrt{5^2+12^2}=13\text{ cm}\).</li>
            <li>Base area \(A_B=\pi r^2=\pi\cdot 25\approx 78.540\text{ cm}^2\).</li>
            <li>Lateral area \(A_L=\pi r l=\pi\cdot 5\cdot 13\approx 204.204\text{ cm}^2\).</li>
            <li>Total area \(A_T=\pi r(r+l)=\pi\cdot 5\cdot 18\approx 282.743\text{ cm}^2\).</li>
            <li>Volume \(V=\tfrac13\pi r^2 h=\tfrac13\pi\cdot 25\cdot 12\approx 314.159\text{ cm}^3\).</li>
            <li>Apex angle \(\Theta=2\arctan(r/h)\approx 2\arctan(5/12)\approx 45.238^\circ\).</li>
          </ol>

          <h2>Frequently asked questions</h2>
          <details>
            <summary>Which input pair should I use?</summary>
            <p>Use the pair you actually know. For metal layout, r+l is common; for classroom problems, r+h or d+h are typical; for process design, V+h sometimes appears.</p>
          </details>
          <details>
            <summary>Is this valid for oblique cones?</summary>
            <p>No. These closed forms assume a right circular cone. Oblique cones need different methods.</p>
          </details>
          <details>
            <summary>What is the “apex angle” vs “half-angle”?</summary>
            <p>The full apex angle is at the tip across the axis; the half-angle is measured from the axis to the generator.</p>
          </details>
          <details>
            <summary>Can I switch units?</summary>
            <p>Yes. Pick Metric or Imperial and select a display length unit. The tool keeps results coherent.</p>
          </details>
          <details>
            <summary>Do rounding and display affect accuracy?</summary>
            <p>The engine computes in double precision and rounds for display. You can copy raw values from the browser console if needed.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
            Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
          </div>
        </article>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
            Ad Placement (300×600)
          </div>
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="font-bold text-lg mb-3">Why use this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Solve from multiple input pairs (r+h, d+h, r+l, V+h).</li>
              <li>Clear LaTeX formulas and variable glossary.</li>
              <li>WCAG 2.1 AA compliant UI, mobile-first.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="font-bold text-lg mb-3">Related geometry tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-600 hover:underline" href="frustum-calculator.html">Frustum (Truncated Cone) Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="cylinder-calculator.html">Cylinder Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="sphere-calculator.html">Sphere Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="pyramid-calculator.html">Pyramid Calculator</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  (function(){
    const $ = (id)=>document.getElementById(id);
    const el = {
      unitSystem: $('unitSystem'),
      unitLength: $('unitLength'),
      mode: $('mode'),
      radius: $('radius'),
      height: $('height'),
      diameter: $('diameter'),
      slant: $('slant'),
      volume: $('volume'),
      radiusWrap: $('radius')?.parentElement,
      heightWrap: $('height')?.parentElement,
      diameterWrap: $('diameter_wrap'),
      slantWrap: $('slant_wrap'),
      volumeWrap: $('volume_wrap'),
      // tooltips
      modeTipBtn: $('modeTipBtn'),
      modeTip: $('modeTip'),
      radiusTipBtn: $('radiusTipBtn'),
      radiusTip: $('radiusTip'),
      heightTipBtn: $('heightTipBtn'),
      heightTip: $('heightTip'),
      slantTipBtn: $('slantTipBtn'),
      slantTip: $('slantTip'),
      // actions
      calcBtn: $('calcBtn'),
      resetBtn: $('resetBtn'),
      printBtn: $('printBtn'),
      // errors
      rErr: $('radius_error'),
      hErr: $('height_error'),
      dErr: $('diameter_error'),
      lErr: $('slant_error'),
      vErr: $('volume_error'),
      // outputs
      out_r: $('out_r'), out_h: $('out_h'), out_l: $('out_l'), out_d: $('out_d'),
      out_A_lat: $('out_A_lat'), out_A_tot: $('out_A_tot'), out_A_base: $('out_A_base'),
      out_V: $('out_V'), out_apex: $('out_apex')
    };

    // Utility: unit labels and conversions (to SI meters internally)
    const LEN_UNITS = { mm: 0.001, cm: 0.01, m: 1, in: 0.0254, ft: 0.3048 };
    const VOL_UNITS = { // derived cubic of display unit
      mm: Math.pow(LEN_UNITS.mm,3),
      cm: Math.pow(LEN_UNITS.cm,3),
      m: Math.pow(LEN_UNITS.m,3),
      in: Math.pow(LEN_UNITS.in,3),
      ft: Math.pow(LEN_UNITS.ft,3)
    };

    function toggle(elem){ const open = elem.classList.toggle('hidden'); return !open; }
    function show(elm){ elm.classList.remove('hidden'); }
    function hide(elm){ elm.classList.add('hidden'); }
    function clearErrors(){
      [el.rErr, el.hErr, el.dErr, el.lErr, el.vErr].forEach(s=>{ s.textContent=''; s.classList.add('hidden'); });
    }
    function setErr(slot, msg){ slot.textContent = msg; slot.classList.remove('hidden'); }

    // Input mode switching
    function syncModeUI(){
      const mode = el.mode.value;
      // reset visibility
      show(el.radiusWrap); show(el.heightWrap);
      hide(el.diameterWrap); hide(el.slantWrap); hide(el.volumeWrap);

      if(mode==='d_h'){ hide(el.radiusWrap); show(el.diameterWrap); show(el.heightWrap); }
      if(mode==='r_l'){ show(el.radiusWrap); hide(el.heightWrap); show(el.slantWrap); }
      if(mode==='V_h'){ hide(el.radiusWrap); hide(el.diameterWrap); show(el.volumeWrap); show(el.heightWrap); }
    }

    // Validation on blur (inline)
    function requirePositive(input, errSlot, label){
      const v = parseFloat(input.value);
      if(!(v>0)){ setErr(errSlot, `${label} must be a positive number.`); return false; }
      errSlot.classList.add('hidden'); return true;
    }

    ['radius','height','diameter','slant','volume'].forEach(id=>{
      const input = $(id); if(!input) return;
      const slot = {radius:el.rErr,height:el.hErr,diameter:el.dErr,slant:el.lErr,volume:el.vErr}[id];
      const label = {radius:'Radius',height:'Height',diameter:'Diameter',slant:'Slant',volume:'Volume'}[id];
      input.addEventListener('blur',()=>requirePositive(input,slot,label));
    });

    // Tooltips (click/keyboard)
    [[el.modeTipBtn, el.modeTip],[el.radiusTipBtn, el.radiusTip],[el.heightTipBtn, el.heightTip],[el.slantTipBtn, el.slantTip]]
      .forEach(([btn, box])=>{
        if(!btn||!box) return;
        btn.addEventListener('click', ()=> {
          const nowOpen = box.classList.toggle('hidden');
          btn.setAttribute('aria-expanded', String(!nowOpen));
        });
        btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); }});
      });

    // Unit system coupling: suggest defaults
    function syncUnits(){
      const sys = el.unitSystem.value;
      if(sys==='metric' && !['mm','cm','m'].includes(el.unitLength.value)) el.unitLength.value='cm';
      if(sys==='imperial' && !['in','ft'].includes(el.unitLength.value)) el.unitLength.value='in';
    }

    // Formatting helpers
    function fmtLen(meters){
      const u = el.unitLength.value;
      const factor = 1 / LEN_UNITS[u];
      const val = meters * factor;
      return `${roundNice(val)} ${u}`;
    }
    function fmtArea(m2){
      const u = el.unitLength.value;
      const factor = 1 / (LEN_UNITS[u]**2);
      const val = m2 * factor;
      return `${roundNice(val)} ${u}²`;
    }
    function fmtVol(m3){
      const u = el.unitLength.value;
      const factor = 1 / (LEN_UNITS[u]**3);
      const val = m3 * factor;
      return `${roundNice(val)} ${u}³`;
    }
    function roundNice(x){
      if(!isFinite(x)) return '—';
      const ax = Math.abs(x);
      if(ax>=1000) return x.toFixed(1);
      if(ax>=100)  return x.toFixed(2);
      if(ax>=1)    return x.toFixed(3);
      if(ax>=0.01) return x.toFixed(4);
      return x.toExponential(3);
    }
    const DEG = 180/Math.PI;

    // Core math (internals in meters)
    function calc(){
      clearErrors();
      syncUnits();

      const u = el.unitLength.value;
      const toMeters = LEN_UNITS[u];
      const fromM = (x)=>x*toMeters; // read in chosen unit -> meters

      const mode = el.mode.value;

      let r_m=null, h_m=null, l_m=null, d_m=null, V_m3=null;

      // parse helpers
      const val = (inp)=> parseFloat(inp?.value);

      if(mode==='r_h'){
        if(!requirePositive(el.radius, el.rErr, 'Radius') | !requirePositive(el.height, el.hErr, 'Height')) return;
        r_m = fromM(val(el.radius)); h_m = fromM(val(el.height));
        l_m = Math.hypot(r_m, h_m); d_m = 2*r_m; V_m3 = (Math.PI*r_m*r_m*h_m)/3;
      }
      else if(mode==='d_h'){
        if(!requirePositive(el.diameter, el.dErr, 'Diameter') | !requirePositive(el.height, el.hErr, 'Height')) return;
        d_m = fromM(val(el.diameter)); r_m = d_m/2; h_m = fromM(val(el.height));
        l_m = Math.hypot(r_m, h_m); V_m3 = (Math.PI*r_m*r_m*h_m)/3;
      }
      else if(mode==='r_l'){
        if(!requirePositive(el.radius, el.rErr, 'Radius') | !requirePositive(el.slant, el.lErr, 'Slant')) return;
        r_m = fromM(val(el.radius)); l_m = fromM(val(el.slant));
        if(l_m<=r_m){ setErr(el.lErr,'Slant must be greater than radius for a real height.'); return; }
        h_m = Math.sqrt(Math.max(0,l_m*l_m - r_m*r_m)); d_m = 2*r_m; V_m3 = (Math.PI*r_m*r_m*h_m)/3;
      }
      else if(mode==='V_h'){
        if(!requirePositive(el.volume, el.vErr, 'Volume') | !requirePositive(el.height, el.hErr, 'Height')) return;
        const V_in = val(el.volume); // in selected length^3
        const Vmeters = V_in * VOL_UNITS[u]; // to m^3
        h_m = fromM(val(el.height));
        // V = (1/3) π r^2 h  => r = sqrt( 3V / (π h) )
        r_m = Math.sqrt((3*Vmeters)/(Math.PI*h_m));
        l_m = Math.hypot(r_m, h_m);
        d_m = 2*r_m;
        V_m3 = Vmeters;
      }

      // Areas
      const A_base = Math.PI*r_m*r_m;
      const A_lat  = Math.PI*r_m*l_m;
      const A_tot  = Math.PI*r_m*(r_m + l_m);
      const apex_deg = 2*Math.atan2(r_m, h_m)*DEG;

      // Output
      el.out_r.textContent = fmtLen(r_m);
      el.out_h.textContent = fmtLen(h_m);
      el.out_l.textContent = fmtLen(l_m);
      el.out_d.textContent = fmtLen(d_m);
      el.out_A_base.textContent = fmtArea(A_base);
      el.out_A_lat.textContent  = fmtArea(A_lat);
      el.out_A_tot.textContent  = fmtArea(A_tot);
      el.out_V.textContent      = fmtVol(V_m3);
      el.out_apex.textContent   = isFinite(apex_deg) ? `${roundNice(apex_deg)} °` : '—';
    }

    function resetAll(){
      clearErrors();
      el.unitSystem.value='metric';
      el.unitLength.value='cm';
      el.mode.value='r_h';
      syncModeUI();
      el.radius.value='5';
      el.height.value='12';
      if(el.diameter) el.diameter.value='';
      if(el.slant) el.slant.value='';
      if(el.volume) el.volume.value='';
      calc();
    }

    // Events
    el.mode.addEventListener('change', ()=>{ syncModeUI(); calc(); });
    el.unitSystem.addEventListener('change', ()=>{ syncUnits(); calc(); });
    el.unitLength.addEventListener('change', ()=>{ calc(); });

    ['radius','height','diameter','slant','volume'].forEach(id=>{
      const input=$(id); if(!input) return;
      input.addEventListener('input', calc);
    });

    el.calcBtn.addEventListener('click', calc);
    el.resetBtn.addEventListener('click', resetAll);
    el.printBtn.addEventListener('click', ()=>window.print());

    // Initialize
    syncModeUI();
    resetAll();
  })();
  </script>
</body>
</html>
