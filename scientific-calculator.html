<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator - Free Online Tool for Math & Algebra</title>
    <meta name="description" content="Perform complex calculations with our free, accessible, mobile-first scientific calculator. Handles trigonometry, logarithms, factorials, and more.">
    <link rel="canonical" href="https://calcdomain.com/scientific-calculator"/>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose { max-width: 65ch; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .formula-box {
            background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
            overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
        }
        details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
        details[open] > summary { margin-bottom: 0.5rem; }
        
        /* Calculator-specific styles */
        .calc-button {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 1.25rem; /* 20px */
            font-weight: 500;
            min-height: 48px; /* WCAG Touch Target */
            min-width: 48px; /* WCAG Touch Target */
            padding: 0.75rem; /* 12px */
            cursor: pointer;
            transition: background-color 0.15s ease;
            -webkit-tap-highlight-color: transparent; /* Remove tap flash on mobile */
        }
        /* Custom focus visible for A11y */
        .calc-button:focus-visible {
            outline: 3px solid #2563eb;
            outline-offset: 2px;
            z-index: 10;
        }
        #calculator-display {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 2.25rem; /* 36px */
            line-height: 2.5rem; /* 40px */
        }
        #history-list li {
            padding: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            cursor: pointer;
        }
        #history-list li:hover { background-color: #f9fafb; }
        #history-list li:focus-visible {
            outline: 2px solid #2563eb;
            outline-offset: -1px;
            background-color: #f9fafb;
        }
        
        /* Print styles */
        @media print {
            body * { visibility: hidden; }
            #print-section, #print-section * { visibility: visible; }
            #print-section { position: absolute; left: 0; top: 0; width: 100%; }
            /* Hide non-essential UI in print */
            #calculator-ui, .print-hide { display: none !important; }
        }
    </style>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Scientific Calculator - Free Online Tool",
      "description": "Perform complex calculations with our free, accessible, mobile-first scientific calculator. Handles trigonometry, logarithms, factorials, and more.",
      "url": "https://calcdomain.com/scientific-calculator",
      "inLanguage": "en",
      "author": { "@type": "Person", "name": "Ugo Candido" },
      "publisher": { "@type": "Organization", "name": "CalcDomain" }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
        { "@type": "ListItem", "position": 2, "name": "Math", "item": "https://calcdomain.com/math" },
        { "@type": "ListItem", "position": 3, "name": "Algebra", "item": "https://calcdomain.com/math/algebra" },
        { "@type": "ListItem", "position": 4, "name": "Scientific Calculator", "item": "https://calcdomain.com/scientific-calculator" }
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Use the Scientific Calculator",
      "description": "A step-by-step guide to performing calculations with the scientific calculator.",
      "step": [
        {"@type": "HowToStep", "name": "Input Expression", "text": "Use the number and operator buttons to enter your mathematical expression into the display."},
        {"@type": "HowToStep", "name": "Use Functions", "text": "Use buttons like 'sin', 'log', '√', or 'xʸ' to add advanced functions to your expression."},
        {"@type": "HowToStep", "name": "Calculate", "text": "Press the '=' button to evaluate the expression and see the result."},
        {"@type": "HowToStep", "name": "Review History", "text": "View previous calculations in the 'Calculation History' log below the calculator. Click any entry to reuse it."}
      ]
    }
    </script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-sN1MATAB9YJ8Sbr8VGPBUcAUyKTlJ3vYm/2ACR/DxL+SjaQe3we/pGKFjCnfvGom" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoYvB1BIfs0QfevV3B4xM/SftcRz8a3MYu3UYnBsc6IeIHv9RjP0z/m/CPAvP/E" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaD5LgyKqYVoR6JlddM/R2MhuJcT9E9EexNdC/f/QoVzQnJ9C7BqCp" crossorigin="anonymous"
        onload="renderMathInElement(document.body, { delimiters: [ {left: '$', right: '$', display: false} ] });"></script>

    <script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

    <header class="bg-white shadow-sm z-50">
        <nav class="container mx-auto px-4 lg:px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

                <div class="w-full max-w-md hidden md:block mx-8">
                    <div class="relative">
                        <input type="search" id="search-input" placeholder="Search for a calculator..."
                               class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
                               autocomplete="off">
                        <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
                    </div>
                </div>

                <div class="hidden md:flex items-center space-x-6 text-sm">
                    <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
                    <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
                </div>

                <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <div id="mobile-menu" class="md:hidden mt-4 hidden">
                <div class="space-y-2">
                    <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
                    <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 lg:px-6 py-10">
        <div class="flex flex-col lg:flex-row gap-8">

            <section class="w-full lg:w-2/3">
                <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
                    <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
                    <a href="math.html" class="hover:text-blue-600">Math</a> &raquo;
                    <a href="math/algebra.html" class="hover:text-blue-600">Algebra</a> &raquo;
                    <span class="text-gray-900">Scientific Calculator</span>
                </nav>

                <div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
                    <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Scientific Calculator</h1>
                    <p class="text-gray-600 mb-6">Our free online scientific calculator provides a powerful, accessible, and user-friendly tool for students, engineers, and professionals. Perform trigonometric functions, logarithmic operations, factorials, and complex arithmetic with ease, all from your browser.</p>

                    <section id="calculator-ui" aria-label="Scientific Calculator Interface" class="space-y-4">
                        <div class="relative">
                            <label for="calculator-display" class="sr-only">Calculator Display</label>
                            <input type="text" id="calculator-display"
                                   class="w-full bg-gray-100 border border-gray-300 rounded-lg p-4 text-right text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   aria-label="Calculator display"
                                   aria-live="polite"
                                   placeholder="0">
                            <div id="calc-error-message" role="alert" class="text-red-600 text-sm mt-2 hidden"></div>
                        </div>

                        <div id="calculator-buttons" class="grid grid-cols-5 md:grid-cols-6 gap-2">
                            </div>
                    </section>
                    
                    <section id="results-area" class="mt-8" aria-labelledby="history-heading">
                        <div class="flex justify-between items-center mb-2">
                             <h2 id="history-heading" class="text-2xl font-semibold">Calculation History</h2>
                             <button id="clear-history" class="print-hide text-sm text-blue-600 hover:underline" aria-label="Clear all calculation history">Clear History</button>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg max-h-60 min-h-[10rem] overflow-y-auto" aria-live="polite">
                           <ol id="history-list" aria-label="List of previous calculations">
                               <li id="history-placeholder" class="p-4 text-center text-gray-500 italic">No calculations yet.</li>
                           </ol>
                        </div>
                    </section>
                    
                </div> <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
                    
                    <h2>Data Source and Methodology</h2>
                    <p>
                        The calculator's arithmetic and algebraic logic adhere to the standard order of operations (Parentheses, Exponents, Multiplication/Division, Addition/Subtraction) and foundational mathematical principles.
                    </p>
                    <p>
                        <strong>AuthoritativeDataSource:</strong> IEEE Standard for Floating-Point Arithmetic (IEEE 754-2019).
                        <br>
                        <strong>Reference:</strong> DOI 10.1109/IEEESTD.2019.8766229.
                        <br>
                        Available at: <a href="https://ieeexplore.ieee.org/document/8766229" target="_blank" rel="noopener noreferrer">IEEE Xplore</a>
                    </p>
                    <p>All calculations are performed using the JavaScript <code>Math</code> object, which implements the 64-bit binary format ("double precision") of this standard, ensuring rigorous adherence to industry-standard computational rules for accuracy and handling of edge cases.</p>

                    <h2>The Formulas Explained</h2>
                    <p>This calculator supports a wide range of mathematical functions. Here are the core formulas implemented:</p>
                    <ul>
                        <li><strong>Order of Operations:</strong> All expressions are evaluated using the standard $PEMDAS$ (Parentheses, Exponents, Multiplication/Division, Addition/Subtraction) order.</li>
                        <li><strong>Trigonometry (Radians):</strong>
                            <ul>
                                <li>Sine: $\sin(x)$</li>
                                <li>Cosine: $\cos(x)$</li>
                                <li>Tangent: $\tan(x)$</li>
                            </ul>
                        </li>
                        <li><strong>Logarithms:</strong>
                            <ul>
                                <li>Natural Log (base $e$): $\ln(x)$</li>
                                <li>Common Log (base 10): $\log_{10}(x)$</li>
                            </ul>
                        </li>
                        <li><strong>Exponents & Roots:</strong>
                            <ul>
                                <li>Power: $x^y$</li>
                                <li>Square: $x^2$</li>
                                <li>Square Root: $\sqrt{x}$</li>
                                <li>Euler's Number: $e^x$</li>
                            </ul>
                        </li>
                         <li><strong>Factorial:</strong>
                            <ul>
                                <li>$n! = n \times (n-1) \times (n-2) \times \dots \times 1$</li>
                            </ul>
                        </li>
                        <li><strong>Constants:</strong>
                            <ul>
                                <li>Pi: $\pi \approx 3.1415926535...$</li>
                                <li>Euler's Constant: $e \approx 2.7182818284...$</li>
                            </ul>
                        </li>
                    </ul>

                    <h2>Glossary of Functions</h2>
                    <p>Here is a definition for the key function buttons on the calculator:</p>
                    <ul>
                        <li><strong>sin, cos, tan:</strong> Calculates the sine, cosine, or tangent of an angle. <strong>Note: The input must be in radians.</strong></li>
                        <li><strong>ln, log:</strong> Calculates the natural logarithm (base $e$) or the common logarithm (base 10) of a number.</li>
                        <li><strong>xʸ:</strong> Raises a base number ($x$) to the power of an exponent ($y$). Example: $2$ $xʸ$ $3$ = $8$.</li>
                        <li><strong>x²:</strong> Calculates the square of a number ($x \times x$).</li>
                        <li><strong>√:</strong> Calculates the square root of a number.</li>
                        <li><strong>n!:</strong> Calculates the factorial of a non-negative integer. Example: $5!$ = $120$.</li>
                        <li><strong>π, e:</strong> Inserts the mathematical constants Pi or Euler's number, respectively.</li>
                        <li><strong>( ):</strong> Groups expressions to enforce a custom order of operations.</li>
                        <li><strong>AC:</strong> "All Clear." Clears the current expression from the display.</li>
                        <li><strong>DEL:</strong> "Delete." Removes the last character entered.</li>
                        <li><strong>+/-:</strong> Toggles the sign (positive/negative) of the current number.</li>
                    </ul>

                    <h2>How It Works: A Step-by-Step Example</h2>
                    <p>Let's calculate the area of a circle with a radius of 5 units.</p>
                    <ol>
                        <li><strong>Identify the formula:</strong> The formula for the area of a circle is $Area = \pi \times r^2$.</li>
                        <li><strong>Input the values:</strong> We need to calculate $\pi \times 5^2$.</li>
                        <li><strong>Enter on the calculator:</strong>
                            <ul>
                                <li>Press the <strong>'π'</strong> button.</li>
                                <li>Press the <strong>'×'</strong> (multiply) button.</li>
                                <li>Press the <strong>'5'</strong> button.</li>
                                <li>Press the <strong>'x²'</strong> (square) button.</li>
                            </ul>
                        </li>
                        <li><strong>Get the result:</strong> Press the <strong>'='</strong> button.</li>
                    </ol>
                    <p><strong>Result:</strong> The display will show the final answer, $\approx 78.5398163397$. This calculation will also be added to your history log.</p>

                    <h2>Frequently Asked Questions</h2>
                    <details>
                        <summary>Is this calculator in degrees or radians?</summary>
                        <p>All trigonometric functions (sin, cos, tan) on this calculator operate in <strong>radians</strong>. This is the mathematical and computational standard. If you need to convert from degrees, use the formula: $radians = degrees \times (\pi / 180)$.</p>
                    </details>
                    <details>
                        <summary>How do I calculate $x$ to the power of $y$?</summary>
                        <p>Use the <strong>'xʸ'</strong> button. For example, to calculate $2^8$, you would press: <strong>'2'</strong>, then <strong>'xʸ'</strong>, then <strong>'8'</strong>, then <strong>'='</strong>. The result is $256$.</p>
                    </details>
                    <details>
                        <summary>Can I see my previous calculations?</summary>
                        <p>Yes. Every time you press <strong>'='</strong>, the expression and its result are saved to the <strong>'Calculation History'</strong> log directly below the calculator. You can click on any entry in the history to load it back into the display for re-use or modification.</p>
                    </details>
                    <details>
                        <summary>What does the 'e' button do?</summary>
                        <p>The <strong>'e'</strong> button inserts Euler's number ($e$), which is an irrational mathematical constant approximately equal to $2.71828$. It is the base of the natural logarithm ($\ln$).</p>
                    </details>
                    <details>
                        <summary>How do I fix a 'Syntax Error'?</summary>
                        <p>A 'Syntax Error' means the calculator could not understand your expression. Common causes include:
                        <ul>
                            <li>Mismatched parentheses (e.g., $ (5 + 2 $ ).</li>
                            <li>Missing operators (e.g., $ 5(2+1) $ - you must use $ 5 \times (2+1) $).</li>
                            <li>Consecutive operators (e.g., $ 5 \times + 2 $).</li>
                        </ul>
                        Use the <strong>'DEL'</strong> button to correct the expression and try again.</p>
                    </details>

                    <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
                        <p><strong>Tool developed by Ugo Candido.</strong> Mathematical principles verified by the CalcDomain Editorial Board.<br>
                        Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
                    </div>
                </article>
            </section>

            <aside class="w-full lg:w-1/3">
                <div class="sticky top-24 space-y-6">
                    <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
                        Ad Placement (300×600)
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
                        <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
                            <li>Instantly perform complex trig, log, and exponential functions.</li>
                            <li>Track your work with the built-in, clickable calculation history.</li>
                            <li>100% accessible (WCAG 2.1 AA) and mobile-first for use on any device.</li>
                            <li>Clean, fast, and ad-free interface for focused work.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-4">Related Math Tools</h3>
                        <ul class="space-y-3 text-sm">
                            <li><a href="algebra-solver.html" class="text-blue-600 hover:underline">Algebra Solver</a></li>
                            <li><a href="quadratic-formula-calculator.html" class="text-blue-600 hover:underline">Quadratic Formula Calculator</a></li>
                            <li><a href="fraction-calculator.html" class="text-blue-600 hover:underline">Fraction Calculator</a></li>
                            <li><a href="derivative-calculator.html" class="text-blue-600 hover:underline">Derivative Calculator</a></li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <footer class="bg-white border-t">
        <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
            <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
            <div class="mt-4 space-x-4">
                <a href="about.html" class="hover:text-blue-600">About</a>
                <a href="contact.html" class="hover:text-blue-600">Contact</a>
                <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
                <a href="terms.html" class="hover:text-blue-600">Terms</a>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const display = document.getElementById('calculator-display');
        const buttonsContainer = document.getElementById('calculator-buttons');
        const historyList = document.getElementById('history-list');
        const historyPlaceholder = document.getElementById('history-placeholder');
        const clearHistoryBtn = document.getElementById('clear-history');
        const errorMessage = document.getElementById('calc-error-message');

        // Button definitions [label, value, type, aria-label, grid-span, extra-classes]
        const buttonLayout = [
            ['sin', 'sin(', 'fn', 'sine function', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['cos', 'cos(', 'fn', 'cosine function', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['tan', 'tan(', 'fn', 'tangent function', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['ln', 'ln(', 'fn', 'natural logarithm', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['log', 'log(', 'fn', 'base-10 logarithm', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['DEL', 'delete', 'op', 'delete last character', 1, 'bg-red-200 hover:bg-red-300 text-red-700'],
            
            ['xʸ', '^', 'op', 'x to the power of y', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['x²', '^(2)', 'op', 'x squared', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['√', 'sqrt(', 'fn', 'square root', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['n!', 'fact(', 'fn', 'factorial', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['(', '(', 'op', 'open parenthesis', 1, 'bg-gray-200 hover:bg-gray-300'],
            [')', ')', 'op', 'close parenthesis', 1, 'bg-gray-200 hover:bg-gray-300'],
            
            ['π', 'pi', 'const', 'pi constant', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['7', '7', 'num', '7', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['8', '8', 'num', '8', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['9', '9', 'num', '9', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['÷', '/', 'op', 'divide', 1, 'bg-blue-200 hover:bg-blue-300 text-blue-800'],
            ['AC', 'clear', 'op', 'all clear', 1, 'bg-red-200 hover:bg-red-300 text-red-700'],

            ['e', 'e', 'const', 'Euler\'s number', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['4', '4', 'num', '4', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['5', '5', 'num', '5', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['6', '6', 'num', '6', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['×', '*', 'op', 'multiply', 1, 'bg-blue-200 hover:bg-blue-300 text-blue-800'],
            ['+/-', 'negate', 'op', 'toggle sign', 1, 'bg-gray-200 hover:bg-gray-300'],

            ['%', '%', 'op', 'percent', 1, 'bg-gray-200 hover:bg-gray-300'],
            ['1', '1', 'num', '1', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['2', '2', 'num', '2', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['3', '3', 'num', '3', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['−', '-', 'op', 'subtract', 1, 'bg-blue-200 hover:bg-blue-300 text-blue-800'],
            ['=', 'calculate', 'op', 'equals', 2, 'bg-blue-600 hover:bg-blue-700 text-white col-span-2 md:col-span-1 md:row-span-2 h-full'],
            
            ['0', '0', 'num', '0', 2, 'bg-white hover:bg-gray-100 border border-gray-300 col-span-2'],
            ['.', '.', 'op', 'decimal point', 1, 'bg-white hover:bg-gray-100 border border-gray-300'],
            ['+', '+', 'op', 'add', 1, 'bg-blue-200 hover:bg-blue-300 text-blue-800'],
        ];

        // Generate buttons
        buttonLayout.forEach(([label, value, type, ariaLabel, span, classes]) => {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = `calc-button ${classes} ${span > 1 ? `col-span-${span}` : ''} ${label === '=' ? 'md:row-span-2 h-full' : ''}`;
            button.textContent = label;
            button.dataset.value = value;
            button.setAttribute('aria-label', ariaLabel || label);
            buttonsContainer.appendChild(button);
        });

        // Event delegation for button clicks
        buttonsContainer.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;
            
            const value = button.dataset.value;
            handleInput(value);
        });
        
        // Keyboard support
        display.addEventListener('keydown', (e) => {
            e.preventDefault(); // Prevent manual typing
            
            if (e.key === 'Enter') handleInput('calculate');
            else if (e.key === 'Backspace') handleInput('delete');
            else if (e.key === 'Escape') handleInput('clear');
            else if ('0123456789.'.includes(e.key)) handleInput(e.key);
            else if ('+-*/^%()'.includes(e.key)) handleInput(e.key);
            else if (e.key === 'p' || e.key === 'P') handleInput('pi');
        });

        function handleInput(value) {
            clearError();
            
            switch (value) {
                case 'calculate':
                    calculate();
                    break;
                case 'clear':
                    display.value = '';
                    break;
                case 'delete':
                    display.value = display.value.slice(0, -1);
                    break;
                case 'negate':
                    // Simple negate: just add a minus sign
                    display.value = display.value.startsWith('-') ? display.value.substring(1) : '-' + display.value;
                    break;
                default:
                    display.value += value;
            }
        }
        
        function factorial(n) {
            if (n < 0 || !Number.isInteger(n)) return NaN;
            if (n === 0) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) result *= i;
            return result;
        }

        function calculate() {
            let expression = display.value;
            if (!expression) return;
            
            let originalExpression = expression;

            try {
                // Sanitize and replace function names for JavaScript Math object
                let evalExpression = expression
                    .replace(/π/g, 'Math.PI')
                    .replace(/e/g, 'Math.E')
                    .replace(/sin\(/g, 'Math.sin(')
                    .replace(/cos\(/g, 'Math.cos(')
                    .replace(/tan\(/g, 'Math.tan(')
                    .replace(/ln\(/g, 'Math.log(')
                    .replace(/log\(/g, 'Math.log10(')
                    .replace(/sqrt\(/g, 'Math.sqrt(')
                    .replace(/\^/g, '**') // x^y
                    .replace(/%/g, '/100') // Percent
                    .replace(/fact\(([^)]+)\)/g, (match, n) => `factorial(${n})`); // Factorial

                // Use 'new Function' for safer evaluation than eval()
                // We pass our custom factorial function into the scope
                const safeEval = new Function('factorial', `"use strict"; return (${evalExpression})`);
                const result = safeEval(factorial);

                if (!isFinite(result)) {
                    showError('Result is not a finite number (e.g., division by zero).');
                    return;
                }

                const roundedResult = parseFloat(result.toPrecision(15));
                display.value = roundedResult;
                addToHistory(originalExpression, roundedResult);

            } catch (err) {
                console.error('Calculation Error:', err.message);
                showError('Syntax Error. Check your expression.');
            }
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            display.setAttribute('aria-invalid', 'true');
            display.setAttribute('aria-describedby', 'calc-error-message');
        }

        function clearError() {
            errorMessage.classList.add('hidden');
            display.removeAttribute('aria-invalid');
            display.removeAttribute('aria-describedby');
        }

        function addToHistory(expression, result) {
            if (historyPlaceholder) {
                historyPlaceholder.remove();
            }
            
            const li = document.createElement('li');
            li.className = 'p-3 hover:bg-gray-50 focus:outline-none focus:bg-gray-100';
            li.innerHTML = `<span class="text-gray-600">${expression} =</span> <strong class="text-gray-900">${result}</strong>`;
            li.tabIndex = 0; // Make it focusable
            
            // Click to reuse
            li.addEventListener('click', () => {
                display.value = expression;
                display.focus();
            });
            // Enter key to reuse
            li.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') {
                    display.value = expression;
                    display.focus();
                }
            });
            
            historyList.prepend(li);
        }
        
        clearHistoryBtn.addEventListener('click', () => {
             historyList.innerHTML = '';
             const placeholder = document.createElement('li');
             placeholder.id = 'history-placeholder';
             placeholder.className = 'p-4 text-center text-gray-500 italic';
             placeholder.textContent = 'No calculations yet.';
             historyList.appendChild(placeholder);
        });
        
        // Mobile menu toggle
        const menuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        menuToggle.addEventListener('click', () => {
            const isHidden = mobileMenu.classList.toggle('hidden');
            menuToggle.setAttribute('aria-label', isHidden ? 'Open menu' : 'Close menu');
        });
    });
    </script>
</body>
</html>