<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Series Calculator — Sum of Arithmetic & Geometric Series</title>
  <meta name="description" content="Professional series calculator for arithmetic and geometric progressions. Compute nth term, finite sums, and infinite geometric sums with proofs, formulas, and worked examples." />
  <link rel="canonical" href="https://calcdomain.com/series-calculator.html" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS (CDN for a single-file deliverable) -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- Chart.js for small term preview -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- KaTeX for LaTeX rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <style>
    :root {
      --focus-ring: 3px solid #2563eb;
    }
    html, body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p { margin-bottom: 1rem; line-height: 1.65; }
    .prose ul, .prose ol { margin-left: 1.25rem; margin-bottom: 1rem; }
    .formula-box {
      background: #f8fafc; border: 1px solid #e5e7eb; border-radius: .75rem; padding: 1rem; overflow-x: auto;
      font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }
    .result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: .75rem; padding: 1rem; }
    .result-card h4 { font-size: .95rem; color:#475569; }
    .result-card p { font-size: 1.5rem; font-weight: 700; color:#1d4ed8; }
    /* Visible focus */
    a:focus, button:focus, input:focus, select:focus, summary:focus { outline: none; box-shadow: 0 0 0 3px rgba(37,99,235,.5); }
    /* Prevent CLS by reserving space for results */
    #results-region { min-height: 280px; }
    /* Touch target sizing */
    .touch-target { min-height: 48px; min-width: 48px; }
    /* Print */
    @media print {
      header, nav, aside, .noprint, .chart-wrap { display: none !important; }
      #print-section { display:block; }
      body { color:#000; background:#fff; }
    }
  </style>

  <!-- JSON-LD: WebPage + Breadcrumbs + WebApplication + HowTo + FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Series Calculator — Sum of Arithmetic & Geometric Series",
    "url":"https://calcdomain.com/series-calculator.html",
    "inLanguage":"en",
    "description":"Compute nth term, finite sums, and infinite geometric sums for arithmetic and geometric series. Includes proofs, formulas, and a step-by-step example.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Algebra","item":"https://calcdomain.com/subcategories/math-algebra.html"},
      {"@type":"ListItem","position":4,"name":"Series Calculator","item":"https://calcdomain.com/series-calculator.html"}
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Series Calculator",
    "applicationCategory":"EducationalApplication",
    "operatingSystem":"Any",
    "url":"https://calcdomain.com/series-calculator.html",
    "creator":{"@type":"Person","name":"Ugo Candido"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to compute series sums",
    "description":"Enter the first term, common difference or ratio, and the number of terms. Choose arithmetic or geometric to get nth term and sum.",
    "step":[
      {"@type":"HowToStep","name":"Choose type","text":"Select Arithmetic or Geometric series."},
      {"@type":"HowToStep","name":"Enter parameters","text":"Provide first term a1, difference d (or ratio r), and number of terms n."},
      {"@type":"HowToStep","name":"Optionally infinite","text":"For geometric, select Infinite sum if |r| < 1."},
      {"@type":"HowToStep","name":"Review results","text":"See nth term, partial sum S_n, and S_∞ when applicable."}
    ]
  }
  </script>
  <script type="application/ld+json" id="faq-jsonld">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the sum of an arithmetic series?","acceptedAnswer":{"@type":"Answer","text":"For first term a1, difference d, and n terms: S_n = n/2 · (2a1 + (n-1)d)."}},
      {"@type":"Question","name":"When does an infinite geometric series converge?","acceptedAnswer":{"@type":"Answer","text":"It converges only if |r| < 1, in which case S_∞ = a1 / (1 - r)."}},
      {"@type":"Question","name":"How do I find the nth term?","acceptedAnswer":{"@type":"Answer","text":"Arithmetic: a_n = a1 + (n-1)d. Geometric: a_n = a1 · r^(n-1)."}},
      {"@type":"Question","name":"Can I enter negative n?","acceptedAnswer":{"@type":"Answer","text":"No. The number of terms n must be a positive integer (n ≥ 1)."}},
      {"@type":"Question","name":"What happens if |r| ≥ 1 for infinite geometric?","acceptedAnswer":{"@type":"Answer","text":"The series diverges and S_∞ does not exist."}},
      {"@type":"Question","name":"Does this tool handle partial sums from k=m to n?","acceptedAnswer":{"@type":"Answer","text":"Yes. Use the optional start index m ≥ 1 to compute S_{m..n} by subtracting partial sums: S_n − S_{m-1}."}}
    ]
  }
  </script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per requirements) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-5 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-700 focus:outline-none focus:ring focus:ring-blue-300 rounded">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700 focus:outline-none focus:ring focus:ring-blue-300 rounded" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-700 focus:outline-none focus:ring focus:ring-blue-300 rounded" href="index.html#categories">Categories</a>
      </nav>
      <a href="index.html" class="md:hidden text-blue-700 underline">Menu</a>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-700 focus:outline-none focus:ring focus:ring-blue-300 rounded">Home</a> &raquo;
      <a href="math.html" class="hover:text-blue-700 focus:outline-none focus:ring focus:ring-blue-300 rounded">Math</a> &raquo;
      <a href="subcategories/math-algebra.html" class="hover:text-blue-700 focus:outline-none focus:ring focus:ring-blue-300 rounded">Algebra</a> &raquo;
      <span class="text-gray-900">Series Calculator</span>
    </nav>

    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <div id="print-section" class="bg-white p-6 rounded-xl shadow">
          <!-- 1) H1 -->
          <h1 class="text-3xl font-extrabold mb-2">series calculator</h1>

          <!-- 2) Intro -->
          <p class="text-gray-700 mb-6">
            A professional, mobile-first tool to compute <strong>nth terms</strong>, <strong>finite sums</strong> \(S_n\), and <strong>infinite geometric sums</strong> \(S_\infty\).
            Built for students, engineers, and analysts who need reliable, explainable results with clear formulas and accessible UX.
          </p>

          <!-- 3) Calculator -->
          <section aria-labelledby="calc-heading" class="space-y-5">
            <h2 id="calc-heading" class="sr-only">Series calculator inputs</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Series Type -->
              <div>
                <label for="seriesType" class="block text-sm font-medium text-gray-900">Series type <span class="text-red-600">*</span></label>
                <div class="mt-1 flex items-center gap-2">
                  <select id="seriesType" aria-required="true" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600">
                    <option value="arithmetic" selected>Arithmetic</option>
                    <option value="geometric">Geometric</option>
                  </select>
                  <button id="tip-type" type="button" class="touch-target px-2 py-1 border rounded text-xs" aria-expanded="false" aria-controls="tip-type-text" aria-label="What is series type?">?</button>
                </div>
                <p id="tip-type-text" class="mt-2 hidden text-sm text-gray-600">
                  Arithmetic: constant difference \(d\). Geometric: constant ratio \(r\).
                </p>
              </div>

              <!-- a1 -->
              <div>
                <label for="a1" class="block text-sm font-medium text-gray-900">First term \(a_1\) <span class="text-red-600">*</span></label>
                <input type="number" id="a1" inputmode="decimal" aria-required="true" aria-describedby="a1-help a1-error"
                  class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  value="2" step="any" />
                <p id="a1-help" class="text-sm text-gray-600 mt-1">The first term of the series.</p>
                <p id="a1-error" class="text-sm text-red-700 mt-1 hidden"></p>
              </div>

              <!-- d for arithmetic OR r for geometric -->
              <div id="diffWrap">
                <label for="d" class="block text-sm font-medium text-gray-900">Common difference \(d\) <span class="text-red-600">*</span></label>
                <input type="number" id="d" inputmode="decimal" aria-required="true" aria-describedby="d-help d-error"
                  class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  value="3" step="any" />
                <p id="d-help" class="text-sm text-gray-600 mt-1">Arithmetic only: the increment between consecutive terms.</p>
                <p id="d-error" class="text-sm text-red-700 mt-1 hidden"></p>
              </div>

              <div id="ratioWrap" class="hidden">
                <label for="r" class="block text-sm font-medium text-gray-900">Common ratio \(r\) <span class="text-red-600">*</span></label>
                <input type="number" id="r" inputmode="decimal" aria-required="true" aria-describedby="r-help r-error"
                  class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  value="0.5" step="any" />
                <p id="r-help" class="text-sm text-gray-600 mt-1">Geometric only: the factor between terms.</p>
                <p id="r-error" class="text-sm text-red-700 mt-1 hidden"></p>
              </div>

              <!-- n -->
              <div>
                <label for="n" class="block text-sm font-medium text-gray-900">Number of terms \(n\) <span class="text-red-600">*</span></label>
                <input type="number" id="n" inputmode="numeric" aria-required="true" aria-describedby="n-help n-error"
                  class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  value="6" min="1" step="1" />
                <p id="n-help" class="text-sm text-gray-600 mt-1">Positive integer (n ≥ 1) for partial sums.</p>
                <p id="n-error" class="text-sm text-red-700 mt-1 hidden"></p>
              </div>

              <!-- Optional start index m -->
              <div>
                <label for="m" class="block text-sm font-medium text-gray-900">Start index \(m\) (optional)</label>
                <input type="number" id="m" inputmode="numeric" aria-describedby="m-help m-error"
                  class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  placeholder="1" min="1" step="1" />
                <p id="m-help" class="text-sm text-gray-600 mt-1">Compute \(S_{m..n} = \sum_{k=m}^{n} a_k\). Leave blank for \(m=1\).</p>
                <p id="m-error" class="text-sm text-red-700 mt-1 hidden"></p>
              </div>

              <!-- Infinite geometric toggle -->
              <div id="infiniteWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-900">Infinite geometric sum</label>
                <div class="mt-2 flex items-center gap-3">
                  <input id="infinite" type="checkbox" class="h-5 w-5 rounded border-gray-300 focus:ring-2 focus:ring-blue-600" />
                  <label for="infinite" class="text-sm text-gray-800">Compute \(S_{\infty}\) when \(|r| &lt; 1\)</label>
                </div>
              </div>
            </div>

            <!-- Action row -->
            <div class="flex flex-wrap gap-3 mt-2">
              <button id="btn-calc" class="touch-target px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">
                Calculate
              </button>
              <button id="btn-reset" class="touch-target px-4 py-2 rounded-lg bg-gray-100 text-gray-900 hover:bg-gray-200 focus:outline-none focus:ring-4 focus:ring-blue-300">
                Reset
              </button>
              <button id="btn-print" class="touch-target px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-blue-300">
                Print results
              </button>
            </div>
          </section>

          <!-- 4) Results -->
          <section id="results-region" aria-live="polite" class="mt-8 bg-blue-50 border border-blue-100 rounded-xl p-5">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="result-card">
                <h4>n-th term \(a_n\)</h4>
                <p id="res-an">—</p>
              </div>
              <div class="result-card">
                <h4>Partial sum \(S_n\)</h4>
                <p id="res-sn">—</p>
              </div>
              <div class="result-card">
                <h4>Range sum \(S_{m..n}\)</h4>
                <p id="res-smn">—</p>
              </div>
            </div>

            <div id="res-convergence" class="mt-4 text-sm text-gray-800"></div>

            <details class="mt-5 bg-white rounded-lg">
              <summary class="font-semibold px-4 py-3 cursor-pointer">Preview first 12 terms</summary>
              <div class="p-4 chart-wrap">
                <canvas id="termsChart" aria-label="Preview chart of first terms"></canvas>
              </div>
              <div class="p-4 overflow-x-auto">
                <table class="min-w-full text-sm">
                  <thead class="bg-gray-100 text-gray-700">
                    <tr>
                      <th class="px-3 py-2 text-left">k</th>
                      <th class="px-3 py-2 text-left">a<sub>k</sub></th>
                      <th class="px-3 py-2 text-left">S<sub>k</sub></th>
                    </tr>
                  </thead>
                  <tbody id="termsTableBody"></tbody>
                </table>
              </div>
            </details>
          </section>

          <!-- 5) Content ecosystem -->
          <article class="prose mt-8">
            <h2>Authoritative data source & methodology</h2>
            <p><strong>AuthoritativeDataSource:</strong> NIST Digital Library of Mathematical Functions (DLMF), §1.2 & §2.1 (Series and Summation), National Institute of Standards and Technology. <a class="text-blue-700 underline" href="https://dlmf.nist.gov/" rel="nofollow">NIST DLMF</a>. Published and continually updated by NIST.</p>
            <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

            <h2>The formulas explained</h2>
            <div class="formula-box">
              <div>
                <strong>Arithmetic series</strong><br>
                \( a_n = a_1 + (n-1)d \)<br>
                \( S_n = \dfrac{n}{2}\,\big(2a_1 + (n-1)d\big) \)
              </div>
              <hr class="my-3">
              <div>
                <strong>Geometric series</strong><br>
                \( a_n = a_1\, r^{\,n-1} \)<br>
                \( S_n = \begin{cases}
                   n\,a_1 & r=1 \\
                   a_1\,\dfrac{1-r^{\,n}}{1-r} & r\neq 1
                \end{cases} \)<br>
                Infinite (convergent if \(|r|&lt;1\)): \( S_{\infty} = \dfrac{a_1}{1-r} \)
              </div>
              <hr class="my-3">
              <div>
                <strong>Range sum</strong> \(S_{m..n} = \sum_{k=m}^{n} a_k = S_n - S_{m-1}\) for \(1 \le m \le n\).
              </div>
            </div>

            <h2>Glossary of variables</h2>
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-3 py-2 text-left">Symbol</th>
                    <th class="px-3 py-2 text-left">Meaning</th>
                    <th class="px-3 py-2 text-left">Units</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td class="px-3 py-2"><code>a_1</code></td><td class="px-3 py-2">First term of the series</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>d</code></td><td class="px-3 py-2">Common difference (arithmetic)</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>r</code></td><td class="px-3 py-2">Common ratio (geometric)</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>n</code></td><td class="px-3 py-2">Number of terms (positive integer)</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>a_n</code></td><td class="px-3 py-2">n-th term</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>S_n</code></td><td class="px-3 py-2">Sum of first n terms</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>S_{m..n}</code></td><td class="px-3 py-2">Sum from index m to n</td><td class="px-3 py-2">—</td></tr>
                  <tr><td class="px-3 py-2"><code>S_{\infty}</code></td><td class="px-3 py-2">Infinite sum (geometric; |r|&lt;1)</td><td class="px-3 py-2">—</td></tr>
                </tbody>
              </table>
            </div>

            <h2>How it works: a step-by-step example</h2>
            <h3>Example 1 — Arithmetic</h3>
            <p>Let \(a_1=2\), \(d=3\), \(n=6\). Then \(a_6 = 2+(6-1)3=17\). The sum \(S_6=\frac{6}{2}(2·2+(6-1)·3)=3(4+15)=57\).</p>
            <h3>Example 2 — Geometric (Infinite)</h3>
            <p>Let \(a_1=5\), \(r=0.4\). Since \(|r|=0.4&lt;1\), the series converges and \(S_{\infty}=\frac{5}{1-0.4}=\frac{5}{0.6}\approx 8.333\).</p>

            <h2>Frequently asked questions</h2>
            <details>
              <summary>Can I compute sums over a sub-range \(m..n\)?</summary>
              <p>Yes, set a start index \(m\ge 1\). The tool uses \(S_{m..n}=S_n - S_{m-1}\).</p>
            </details>
            <details>
              <summary>Does the infinite sum exist for arithmetic series?</summary>
              <p>No. Arithmetic series diverge unless all terms are zero.</p>
            </details>
            <details>
              <summary>What if \(r=1\) in geometric series?</summary>
              <p>Then every term equals \(a_1\) and \(S_n = n\,a_1\). The infinite sum diverges unless \(a_1=0\).</p>
            </details>
            <details>
              <summary>Can \(r\) or \(d\) be negative?</summary>
              <p>Yes. Negative values generate alternating or decreasing sequences; formulas still hold.</p>
            </details>
            <details>
              <summary>Why does the preview show 12 terms only?</summary>
              <p>It’s a diagnostic view. Use \(n\) to compute large partial sums precisely; the chart limits to 12 for readability.</p>
            </details>

            <!-- 6) Author & Review -->
            <div class="mt-6 p-4 bg-gray-100 border border-gray-200 rounded-lg text-sm text-gray-700">
              <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
                Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
            </div>
          </article>
        </div>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-6 space-y-6 noprint">
          <div class="bg-white p-5 rounded-xl shadow">
            <h3 class="font-semibold mb-2">Why this tool is different</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
              <li>WCAG 2.1 AA accessible UI with inline validation.</li>
              <li>Explains every formula in LaTeX with references.</li>
              <li>Range sums \(S_{m..n}\) and infinite geometric checks built-in.</li>
            </ul>
          </div>
          <div class="bg-gray-200 h-72 rounded-xl flex items-center justify-center text-gray-600">
            Ad Placement (300×600)
          </div>
          <div class="bg-white p-5 rounded-xl shadow">
            <h3 class="font-semibold mb-2">Related math tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-700 hover:underline" href="geometric-mean-calculator.html">Geometric Mean Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="arithmetic-mean-calculator.html">Arithmetic Mean Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="summation-sigma-calculator.html">Summation (Σ) Calculator</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600 focus:outline-none focus:ring focus:ring-blue-300 rounded">About</a>
        <a href="contact.html" class="hover:text-blue-600 focus:outline-none focus:ring focus:ring-blue-300 rounded">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600 focus:outline-none focus:ring focus:ring-blue-300 rounded">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600 focus:outline-none focus:ring focus:ring-blue-300 rounded">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Script: calculator logic (defer loaded via end-of-body placement) -->
  <script defer>
    // KaTeX auto-render on load
    document.addEventListener("DOMContentLoaded", function() {
      if (window.renderMathInElement) {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "\\(", right: "\\)", display: false},
            {left: "\\[", right: "\\]", display: true}
          ]
        });
      }
    });

    const $ = (id) => document.getElementById(id);
    const elements = {
      seriesType: $("seriesType"),
      a1: $("a1"),
      d: $("d"),
      r: $("r"),
      n: $("n"),
      m: $("m"),
      diffWrap: $("diffWrap"),
      ratioWrap: $("ratioWrap"),
      infiniteWrap: $("infiniteWrap"),
      infinite: $("infinite"),
      resAn: $("res-an"),
      resSn: $("res-sn"),
      resSmn: $("res-smn"),
      resConv: $("res-convergence"),
      termsChart: $("termsChart"),
      termsTableBody: $("termsTableBody"),
      btnCalc: $("btn-calc"),
      btnReset: $("btn-reset"),
      btnPrint: $("btn-print"),
      tipTypeBtn: $("tip-type"),
      tipTypeText: $("tip-type-text"),
      // errors
      a1Error: $("a1-error"),
      dError: $("d-error"),
      rError: $("r-error"),
      nError: $("n-error"),
      mError: $("m-error")
    };

    // Accessible tooltip
    elements.tipTypeBtn.addEventListener("click", () => {
      const expanded = elements.tipTypeBtn.getAttribute("aria-expanded") === "true";
      elements.tipTypeBtn.setAttribute("aria-expanded", String(!expanded));
      elements.tipTypeText.classList.toggle("hidden", expanded);
    });

    // Helper: number formatting
    const fmt = new Intl.NumberFormat(undefined, { maximumFractionDigits: 12 });
    function fmtNum(x) {
      if (!isFinite(x)) return "—";
      // Trim very small near-zeros
      const val = Math.abs(x) < 1e-12 ? 0 : x;
      return fmt.format(val);
    }

    // Validation (on blur)
    function setError(el, msgEl, msg) {
      if (msg) {
        msgEl.textContent = msg;
        msgEl.classList.remove("hidden");
        el.setAttribute("aria-invalid", "true");
      } else {
        msgEl.textContent = "";
        msgEl.classList.add("hidden");
        el.removeAttribute("aria-invalid");
      }
    }

    function validate() {
      let ok = true;
      // a1 required
      const a1v = parseFloat(elements.a1.value);
      if (isNaN(a1v)) { setError(elements.a1, elements.a1Error, "Please enter a valid number for a1."); ok = false; }
      else setError(elements.a1, elements.a1Error, "");

      // n required, integer ≥ 1
      const nv = parseInt(elements.n.value, 10);
      if (!Number.isInteger(nv) || nv < 1) { setError(elements.n, elements.nError, "n must be an integer ≥ 1."); ok = false; }
      else setError(elements.n, elements.nError, "");

      if (elements.seriesType.value === "arithmetic") {
        const dv = parseFloat(elements.d.value);
        if (isNaN(dv)) { setError(elements.d, elements.dError, "Please enter a valid number for the difference d."); ok = false; }
        else setError(elements.d, elements.dError, "");
        setError(elements.r, elements.rError, "");
      } else {
        const rv = parseFloat(elements.r.value);
        if (isNaN(rv)) { setError(elements.r, elements.rError, "Please enter a valid number for the ratio r."); ok = false; }
        else setError(elements.r, elements.rError, "");
        setError(elements.d, elements.dError, "");
      }

      // m optional: if present, integer ≥1 and ≤ n
      const mvRaw = elements.m.value.trim();
      if (mvRaw !== "") {
        const mv = parseInt(mvRaw, 10);
        const nv2 = parseInt(elements.n.value, 10);
        if (!Number.isInteger(mv) || mv < 1) { setError(elements.m, elements.mError, "m must be an integer ≥ 1."); ok = false; }
        else if (Number.isInteger(nv2) && mv > nv2) { setError(elements.m, elements.mError, "m must be ≤ n."); ok = false; }
        else setError(elements.m, elements.mError, "");
      } else {
        setError(elements.m, elements.mError, "");
      }

      return ok;
    }

    ["a1","d","r","n","m"].forEach(id => {
      const el = $(id); if (!el) return;
      el.addEventListener("blur", validate);
    });

    // Toggle UI for series type
    function syncTypeUI() {
      const type = elements.seriesType.value;
      const isAr = type === "arithmetic";
      elements.diffWrap.classList.toggle("hidden", !isAr);
      elements.ratioWrap.classList.toggle("hidden", isAr);
      elements.infiniteWrap.classList.toggle("hidden", isAr); // infinite only for geometric
    }
    elements.seriesType.addEventListener("change", () => {
      syncTypeUI();
      // clear convergence message on type switch
      elements.resConv.textContent = "";
    });
    syncTypeUI();

    // Core math
    function arithmetic_an(a1, d, n) { return a1 + (n - 1) * d; }
    function arithmetic_sn(a1, d, n) { return (n / 2) * (2 * a1 + (n - 1) * d); }
    function geometric_an(a1, r, n) { return a1 * Math.pow(r, n - 1); }
    function geometric_sn(a1, r, n) {
      if (r === 1) return n * a1;
      return a1 * (1 - Math.pow(r, n)) / (1 - r);
    }
    function geometric_s_inf(a1, r) {
      if (Math.abs(r) < 1) return a1 / (1 - r);
      return Number.POSITIVE_INFINITY;
    }

    // Chart
    let chart = null;
    function renderChart(data) {
      const ctx = elements.termsChart;
      if (!ctx) return;

      const labels = data.map((_, i) => `a${i+1}`);
      const ds = {
        labels,
        datasets: [{ label: "a_k", data, borderWidth: 1 }]
      };
      if (chart) {
        chart.data = ds;
        chart.update();
      } else {
        chart = new Chart(ctx, {
          type: "bar",
          data: ds,
          options: {
            animation: false,
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { ticks: { autoSkip: true } } }
          }
        });
      }
    }

    function fillTermsTable(terms, partials) {
      elements.termsTableBody.innerHTML = "";
      for (let i = 0; i < terms.length; i++) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="px-3 py-2">${i+1}</td>
          <td class="px-3 py-2">${fmtNum(terms[i])}</td>
          <td class="px-3 py-2">${fmtNum(partials[i])}</td>
        `;
        elements.termsTableBody.appendChild(tr);
      }
    }

    function calculate() {
      if (!validate()) return;

      const type = elements.seriesType.value;
      const a1 = parseFloat(elements.a1.value);
      const n = parseInt(elements.n.value, 10);
      const mRaw = elements.m.value.trim();
      const m = mRaw === "" ? 1 : parseInt(mRaw, 10);

      let an = NaN, sn = NaN, smn = NaN, convMsg = "", previewTerms = [], previewS = [];

      if (type === "arithmetic") {
        const d = parseFloat(elements.d.value);
        an = arithmetic_an(a1, d, n);
        sn = arithmetic_sn(a1, d, n);
        const sm1 = (m > 1) ? arithmetic_sn(a1, d, m - 1) : 0;
        smn = sn - sm1;

        // build first up to 12 terms
        const cap = Math.min(12, n);
        let running = 0;
        for (let k = 1; k <= cap; k++) {
          const ak = arithmetic_an(a1, d, k);
          running += ak;
          previewTerms.push(ak);
          previewS.push(running);
        }
        convMsg = `<span class="text-amber-700">Arithmetic series do not converge as k→∞ unless all terms are zero.</span>`;
      } else {
        const r = parseFloat(elements.r.value);
        an = geometric_an(a1, r, n);
        sn = geometric_sn(a1, r, n);
        const sm1 = (m > 1) ? geometric_sn(a1, r, m - 1) : 0;
        smn = sn - sm1;

        const cap = Math.min(12, n);
        let running = 0;
        for (let k = 1; k <= cap; k++) {
          const ak = geometric_an(a1, r, k);
          running += ak;
          previewTerms.push(ak);
          previewS.push(running);
        }

        if (elements.infinite.checked) {
          if (Math.abs(r) < 1) {
            const sinf = geometric_s_inf(a1, r);
            convMsg = `<span class="text-green-700 font-medium">Convergent:</span> \\(|r|<1\\). \(S_{\\infty} = ${fmtNum(sinf)}\)`;
          } else {
            convMsg = `<span class="text-red-700 font-medium">Divergent:</span> \\(|r| \\ge 1\\). Infinite sum does not exist.`;
          }
        } else {
          convMsg = `<span class="text-gray-800">For infinite geometric sum, enable the option and ensure \\(|r|<1\\).</span>`;
        }
      }

      elements.resAn.textContent = fmtNum(an);
      elements.resSn.textContent = fmtNum(sn);
      elements.resSmn.textContent = fmtNum(smn);
      elements.resConv.innerHTML = convMsg;

      // Update preview
      renderChart(previewTerms);
      fillTermsTable(previewTerms, previewS);

      // Re-render KaTeX for newly injected math snippets
      if (window.renderMathInElement) {
        renderMathInElement(elements.resConv, {
          delimiters: [{left:"\\(",right:"\\)",display:false}]
        });
      }
    }

    // Events
    elements.btnCalc.addEventListener("click", calculate);
    elements.btnReset.addEventListener("click", () => {
      elements.seriesType.value = "arithmetic";
      elements.a1.value = "2";
      elements.d.value = "3";
      elements.r.value = "0.5";
      elements.n.value = "6";
      elements.m.value = "";
      elements.infinite.checked = false;
      syncTypeUI();
      elements.resAn.textContent = "—";
      elements.resSn.textContent = "—";
      elements.resSmn.textContent = "—";
      elements.resConv.textContent = "";
      elements.termsTableBody.innerHTML = "";
      if (window.chart) { chart.destroy(); chart = null; }
    });
    elements.btnPrint.addEventListener("click", () => window.print());

    // Recalculate automatically on input changes for great UX (still validates on blur)
    ["seriesType","a1","d","r","n","m","infinite"].forEach(id => {
      const el = $(id); if (!el) return;
      el.addEventListener("input", calculate);
      el.addEventListener("change", calculate);
    });

    // Initial compute
    window.addEventListener("load", calculate);
  </script>
</body>
</html>
