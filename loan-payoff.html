<!DOCTYPE html>
<html lang="en">
<head> 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
  <meta charset="utf-8">
  <title>Loan Payoff Calculator | Extra Payments &amp; Savings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Project your loan payoff date, total interest, and savings from extra monthly payments or a one-time lump sum. See how faster payments shorten your timeline with a detailed amortization schedule.">
  <meta name="author" content="Ugo Candido">
  <link rel="canonical" href="https://calcdomain.com/loan-payoff.html">
  <meta name="theme-color" content="#0b3d69">
  <meta name="robots" content="index, follow">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Loan Payoff Calculator">
  <meta property="og:description" content="Estimate payoff date, total interest, and savings with extra payments or a lump sum toward your loan.">
  <meta property="og:url" content="https://calcdomain.com/loan-payoff.html">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p { margin-bottom: .9rem; line-height: 1.7; }
    .prose ul { list-style: disc; padding-left: 1.25rem; }
    .prose ol { list-style: decimal; padding-left: 1.25rem; }
    details > summary { cursor: pointer; font-weight: 600; }
    details[open] > summary { margin-bottom: .5rem; }
    .eeat { display:grid; gap:0.75rem; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); font-size:0.875rem; color:#374151; }
    @media (min-width: 768px) { .eeat { grid-template-columns:repeat(4,minmax(0,1fr)); } }
    .eeat span { display:block; background:#f9fafb; border:1px solid #e5e7eb; border-radius:0.5rem; padding:0.75rem 1rem; }
    .result-pill { display:inline-flex; align-items:center; font-size:0.875rem; font-weight:600; padding:0.25rem 0.75rem; border-radius:9999px; }
    .formula-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius:0.75rem; padding:1rem; overflow:auto; }
    .formula-box mjx-container { overflow-x:auto; }
    .sticky-ad { height: 600px; }
  </style>

  <script src="search.js" defer></script>

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Finance","item":"https://calcdomain.com/finance.html"},
      {"@type":"ListItem","position":3,"name":"Loans & Debt","item":"https://calcdomain.com/subcategories/finance-loans-debt.html"},
      {"@type":"ListItem","position":4,"name":"Loan Payoff Calculator","item":"https://calcdomain.com/loan-payoff.html"}
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Loan Payoff Calculator",
    "url":"https://calcdomain.com/loan-payoff.html",
    "description":"Estimate loan payoff timing, total interest, and interest saved by applying extra monthly payments or lump sums.",
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "author":{"@type":"Person","name":"Ugo Candido"},
    "mainEntity":{
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"What happens if my payment is lower than monthly interest?","acceptedAnswer":{"@type":"Answer","text":"Negative amortization occurs and the balance grows. Increase your payment or add extra contributions to pay down principal."}},
        {"@type":"Question","name":"How are lump sums applied?","acceptedAnswer":{"@type":"Answer","text":"Lump sums reduce the balance immediately before extra monthly payments are applied in each simulation step."}},
        {"@type":"Question","name":"Does the calculator consider daily interest?","acceptedAnswer":{"@type":"Answer","text":"It uses simple monthly compounding. Actual lender practices may differ slightly with daily interest or rounding, but the results closely approximate your payoff timeline."}}
      ]
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"Accelerate your loan payoff",
    "description":"Example using a $20,000 balance at 6.5% APR with a $450 payment, $75 extra per month, and a $1,000 lump sum.",
    "step":[
      {"@type":"HowToStep","name":"Enter current balance","text":"Balance = $20,000."},
      {"@type":"HowToStep","name":"Enter APR and monthly payment","text":"APR = 6.5%, monthly payment = $450."},
      {"@type":"HowToStep","name":"Add extras","text":"Extra monthly payment = $75; Lump sum = $1,000 applied now."},
      {"@type":"HowToStep","name":"Review results","text":"Payoff occurs about 8 months sooner with â‰ˆ $560 interest saved."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-800">

  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            <input id="search-input" type="search" placeholder="Search for a calculator..."
                   class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>

        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Toggle menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <div id="mobile-menu" class="md:hidden mt-4 hidden">
        <div class="mb-4">
          <div class="relative">
            <input id="mobile-search-input" type="search" placeholder="Search calculators..."
                   class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        <div class="space-y-2">
          <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <section class="w-full lg:w-2/3">
        <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
          <a href="subcategories/finance-loans-debt.html" class="hover:text-blue-600">Loans &amp; Debt</a> &raquo;
          <span class="text-gray-900 font-medium">Loan Payoff</span>
        </nav>

        <section class="bg-white p-6 rounded-lg shadow-md" aria-labelledby="calc-title">
          <h1 id="calc-title" class="text-3xl font-extrabold mb-2 text-slate-800">Loan Payoff Calculator</h1>
          <p class="text-gray-600 mb-6">Find out how quickly you can become debt-free by adding extra monthly payments or a one-time lump sum. The calculator shows the new payoff date, interest saved, and a detailed amortization preview.</p>

          <div class="eeat mb-6">
            <span><strong>Author:</strong> Ugo Candido</span>
            <span><strong>Reviewed by:</strong> Finance Content Editor</span>
            <span><strong>Last updated:</strong> <time id="lastUpdated"></time></span>
            <span><strong>Category:</strong> Finance â†’ Loans &amp; Debt</span>
          </div>

          <div id="calculator-ui" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="balance" class="block text-sm font-medium text-gray-700">Current balance *</label>
              <div class="relative">
                <input id="balance" type="number" inputmode="decimal" min="0" step="0.01" value="20000"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="balanceErr" aria-required="true">
                <span id="balanceSymbol" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">$</span>
              </div>
              <p id="balanceErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="apr" class="block text-sm font-medium text-gray-700">APR (%) *</label>
              <div class="relative">
                <input id="apr" type="number" inputmode="decimal" min="0" max="1000" step="0.01" value="6.5"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="aprErr" aria-required="true">
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">%</span>
              </div>
              <p id="aprErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="payment" class="block text-sm font-medium text-gray-700">Monthly payment *</label>
              <div class="relative">
                <input id="payment" type="number" inputmode="decimal" min="0" step="0.01" value="450"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="paymentErr" aria-required="true">
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">$</span>
              </div>
              <p id="paymentErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="extra" class="block text-sm font-medium text-gray-700">Extra monthly payment</label>
              <div class="relative">
                <input id="extra" type="number" inputmode="decimal" min="0" step="0.01" value="75"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="extraErr">
                <span id="extraSymbol" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">$</span>
              </div>
              <p id="extraErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="lump" class="block text-sm font-medium text-gray-700">One-time lump sum</label>
              <div class="relative">
                <input id="lump" type="number" inputmode="decimal" min="0" step="0.01" value="1000"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="lumpErr">
                <span id="lumpSymbol" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">$</span>
              </div>
              <p id="lumpErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="startMonth" class="block text-sm font-medium text-gray-700">Start month</label>
              <input id="startMonth" type="month"
                     class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
              <p class="text-xs text-gray-500 mt-1">Used to estimate the payoff month.</p>
            </div>
          </div>

          <div class="mt-6 flex flex-wrap gap-3">
            <button id="calculate" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Calculate
            </button>
            <button id="reset" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-md border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Reset
            </button>
            <button id="example" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-md border border-blue-300 text-blue-700 font-semibold hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Load example
            </button>
          </div>

          <div id="results" class="mt-8 bg-blue-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Results</h3>
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <div class="border-b pb-3">
                <span class="block text-gray-600">Months to payoff</span>
                <span id="monthsValue" class="text-2xl font-extrabold text-blue-700">0</span>
                <span id="monthsBaseline" class="block text-xs text-gray-500 mt-1">Scheduled without extras: 0</span>
              </div>
              <div class="border-b pb-3">
                <span class="block text-gray-600">Estimated payoff date</span>
                <span id="payoffDateValue" class="text-2xl font-extrabold text-blue-700">â€”</span>
                <span id="startEcho" class="block text-xs text-gray-500 mt-1">Start: â€”</span>
              </div>
              <div class="border-b pb-3">
                <span class="block text-gray-600">Total interest (with extras)</span>
                <span id="interestValue" class="text-2xl font-extrabold text-green-700">$0.00</span>
                <span id="interestSavedValue" class="block text-xs text-gray-500 mt-1">Interest saved vs. baseline: $0.00</span>
              </div>
              <div>
                <span class="block text-gray-600">Total interest (baseline)</span>
                <span id="baselineInterestValue" class="text-xl font-semibold text-gray-800">$0.00</span>
                <span class="block text-xs text-gray-500 mt-1">No lump sum or extra payments</span>
              </div>
              <div>
                <span class="block text-gray-600">Lump sum applied</span>
                <span id="lumpEcho" class="text-xl font-semibold text-gray-800">$0.00</span>
              </div>
              <div>
                <span class="block text-gray-600">Extra monthly payment</span>
                <span id="extraEcho" class="text-xl font-semibold text-gray-800">$0.00</span>
              </div>
            </div>
            <div class="mt-4 space-x-2">
              <span id="statusPill" class="result-pill bg-sky-100 text-sky-800">Ready to calculate</span>
            </div>
          </div>

          <section class="mt-8">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-xl font-semibold text-gray-800">Amortization schedule</h2>
              <button id="toggleSchedule" type="button" class="text-sm font-semibold text-blue-600 hover:text-blue-700">
                Show full schedule
              </button>
            </div>
            <div class="overflow-auto border border-gray-200 rounded-lg">
              <table class="min-w-full text-sm">
                <caption class="sr-only">Loan payoff schedule including extra payments and lump sum</caption>
                <thead class="bg-slate-100 text-gray-700">
                  <tr>
                    <th class="py-2 px-3 text-left font-semibold">#</th>
                    <th class="py-2 px-3 text-right font-semibold">Payment</th>
                    <th class="py-2 px-3 text-right font-semibold">Interest</th>
                    <th class="py-2 px-3 text-right font-semibold">Principal</th>
                    <th class="py-2 px-3 text-right font-semibold">Extra</th>
                    <th class="py-2 px-3 text-right font-semibold">Balance</th>
                  </tr>
                </thead>
                <tbody id="scheduleBody">
                  <tr>
                    <td colspan="6" class="py-6 px-3 text-center text-gray-500">Enter loan details to generate the schedule.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </section>

        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>Data Source and Methodology</h2>
          <p>Calculations follow standard amortization math used in Truth in Lending (Regulation Z) Appendix J. Monthly interest is computed as APR Ã· 12, and extra payments are applied directly to principal each period after deducting interest. Lump sums reduce the balance immediately before the first period of the simulation.</p>

          <h2>Formulas Used</h2>
          <div class="formula-box">
            <p><strong>Monthly rate:</strong> \( r = \frac{\text{APR}}{12} \)</p>
            <p><strong>Baseline payment check:</strong> If \( P_{\text{mt}} \leq B \cdot r \) the payment is too small and the balance grows.</p>
            <p><strong>Iteration:</strong></p>
            <ul>
              <li>Interest \( = B_{t-1} \cdot r \)</li>
              <li>Principal \( = \min\big(P_{\text{mt}} + E - \text{Interest},\, B_{t-1}\big) \)</li>
              <li>Balance \( = \max\big(B_{t-1} - \text{Principal},\, 0\big) \)</li>
            </ul>
            <p>Total interest is the sum of interest across periods; the payoff month is reached when the balance becomes zero.</p>
          </div>

          <h2>Worked Example</h2>
          <p>Balance $20,000, APR 6.5%, payment $450, extra $75/month, lump sum $1,000 today:</p>
          <ol>
            <li>Lump sum reduces balance to $19,000 before the first payment.</li>
            <li>Monthly interest initially â‰ˆ $102.92; principal paid â‰ˆ $422.08.</li>
            <li>With the extra $75, payoff occurs in â‰ˆ 43 months instead of 51.</li>
            <li>Total interest drops from â‰ˆ $3,148 to â‰ˆ $2,589, saving â‰ˆ $559.</li>
          </ol>

          <h2>Negative Amortization Warning</h2>
          <p>If your monthly payment is less than the monthly interest, the loan balance increases. The calculator flags this condition and asks for a higher payment or additional lump sum to guarantee payoff.</p>
        </article>

        <section class="bg-white p-6 rounded-lg shadow-md mt-8">
          <h2 class="text-xl font-semibold text-gray-900 mb-3">Need more help?</h2>
          <p class="text-sm text-gray-600 leading-relaxed">
            Explore more tools in the <a href="subcategories/finance-loans-debt.html" class="text-blue-600 hover:underline">Loans &amp; Debt hub</a>
            or visit the <a href="subcategories/finance-personal-loans.html" class="text-blue-600 hover:underline">Personal loans center</a> for budgeting and payoff strategies.
          </p>
        </section>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24">
          <div class="bg-gray-200 rounded-lg mb-6 flex items-center justify-center sticky-ad">
            <p class="text-gray-500">Sticky Ad Unit (300Ã—600)</p>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related calculators</h3>
            <ul class="space-y-3">
              <li><a class="text-blue-600 hover:underline" href="personal-loan.html">Personal Loan Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-prepayment.html">Loan Prepayment Planner</a></li>
              <li><a class="text-blue-600 hover:underline" href="simple-loan.html">Simple Loan Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-amortization.html">Loan Amortization Schedule</a></li>
            </ul>
          </div>
        </div>
      </aside>

    </div>
  </main>

  <footer class="bg-white border-t mt-12">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);

    const els = {
      balance: $('balance'),
      apr: $('apr'),
      payment: $('payment'),
      extra: $('extra'),
      lump: $('lump'),
      startMonth: $('startMonth'),

      balanceErr: $('balanceErr'),
      aprErr: $('aprErr'),
      paymentErr: $('paymentErr'),
      extraErr: $('extraErr'),
      lumpErr: $('lumpErr'),

      monthsValue: $('monthsValue'),
      monthsBaseline: $('monthsBaseline'),
      payoffDateValue: $('payoffDateValue'),
      startEcho: $('startEcho'),
      interestValue: $('interestValue'),
      baselineInterestValue: $('baselineInterestValue'),
      interestSavedValue: $('interestSavedValue'),
      lumpEcho: $('lumpEcho'),
      extraEcho: $('extraEcho'),
      statusPill: $('statusPill'),

      toggleSchedule: $('toggleSchedule'),
      scheduleBody: $('scheduleBody'),

      calculate: $('calculate'),
      reset: $('reset'),
      example: $('example'),
      lastUpdated: $('lastUpdated'),
      ui: $('calculator-ui')
    };

    const fmtCurrency = (value) => {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
    };

    const fmtNumber = (value, digits = 2) => isFinite(value) ? value.toFixed(digits) : '0.00';

    function updateCurrencySymbols() {
      const sym = '$';
      $('balanceSymbol').textContent = sym;
      $('extraSymbol').textContent = sym;
      $('lumpSymbol').textContent = sym;
    }

    let fullSchedule = [];
    let showFullSchedule = false;

    function setError(input, errEl, message) {
      if (!errEl) return;
      if (message) {
        errEl.textContent = message;
        input?.setAttribute('aria-invalid', 'true');
      } else {
        errEl.textContent = '';
        input?.setAttribute('aria-invalid', 'false');
      }
    }

    function validateBalance() {
      const value = parseFloat(els.balance.value);
      if (!(value > 0)) {
        setError(els.balance, els.balanceErr, 'Enter a balance greater than zero.');
        return false;
      }
      setError(els.balance, els.balanceErr, '');
      return true;
    }

    function validateApr() {
      const value = parseFloat(els.apr.value);
      if (!(value >= 0) || value > 1000) {
        setError(els.apr, els.aprErr, 'Enter an APR between 0 and 1000%.');
        return false;
      }
      setError(els.apr, els.aprErr, '');
      return true;
    }

    function validatePayment() {
      const value = parseFloat(els.payment.value);
      if (!(value > 0)) {
        setError(els.payment, els.paymentErr, 'Enter a monthly payment greater than zero.');
        return false;
      }
      setError(els.payment, els.paymentErr, '');
      return true;
    }

    function validateExtra() {
      const value = parseFloat(els.extra.value);
      if (els.extra.value.trim() === '') {
        setError(els.extra, els.extraErr, '');
        return true;
      }
      if (!(value >= 0)) {
        setError(els.extra, els.extraErr, 'Extra payment cannot be negative.');
        return false;
      }
      setError(els.extra, els.extraErr, '');
      return true;
    }

    function validateLump() {
      const value = parseFloat(els.lump.value);
      if (els.lump.value.trim() === '') {
        setError(els.lump, els.lumpErr, '');
        return true;
      }
      if (!(value >= 0)) {
        setError(els.lump, els.lumpErr, 'Lump sum cannot be negative.');
        return false;
      }
      setError(els.lump, els.lumpErr, '');
      return true;
    }

    function parseInputs() {
      const balance = parseFloat(els.balance.value);
      const apr = parseFloat(els.apr.value);
      const payment = parseFloat(els.payment.value);
      const extra = parseFloat(els.extra.value) || 0;
      const lump = parseFloat(els.lump.value) || 0;
      const startVal = els.startMonth.value;
      return { balance, apr, payment, extra, lump, startVal };
    }

    function simulate(balance, apr, payment, extra, lump) {
      let remaining = Math.max(0, balance - lump);
      const rate = (apr / 100) / 12;
      const monthlyPayment = payment;
      const extraPayment = extra;
      const combined = monthlyPayment + extraPayment;

      if (remaining <= 0) {
        return { months: 0, interest: 0, rows: [] };
      }

      if (rate === 0) {
        if (combined <= 0) {
          return { months: Infinity, interest: Infinity, rows: [] };
        }
        const months = Math.ceil(remaining / combined);
        const rows = [];
        const buildRows = months <= 480;
        let balanceTracker = remaining;
        for (let i = 1; i <= months && buildRows; i++) {
          const principal = Math.min(combined, balanceTracker);
          balanceTracker = Math.max(0, balanceTracker - principal);
          rows.push({
            index: i,
            payment: principal,
            interest: 0,
            principal,
            extra: extraPayment,
            balance: balanceTracker
          });
        }
        return { months, interest: 0, rows };
      }

      if (combined <= remaining * rate) {
        return { months: Infinity, interest: Infinity, rows: [] };
      }

      const rows = [];
      const buildRows = true;
      let months = 0;
      let interestAccrued = 0;
      const safetyCap = 2400;

      while (remaining > 0 && months < safetyCap) {
        months += 1;
        const interestPortion = remaining * rate;
        let principalPortion = combined - interestPortion;

        if (principalPortion <= 0) {
          return { months: Infinity, interest: Infinity, rows: [] };
        }
        if (principalPortion > remaining) {
          principalPortion = remaining;
        }

        const totalPayment = principalPortion + interestPortion;
        remaining = Math.max(0, remaining - principalPortion);
        interestAccrued += interestPortion;

        if (buildRows) {
          rows.push({
            index: months,
            payment: totalPayment,
            interest: interestPortion,
            principal: principalPortion,
            extra: extraPayment,
            balance: remaining
          });
        }

        if (remaining <= 0) break;
      }

      if (months >= safetyCap) {
        return { months: Infinity, interest: Infinity, rows: [] };
      }

      return { months, interest: interestAccrued, rows };
    }

    function buildSchedule(rows) {
      const tbody = els.scheduleBody;
      tbody.innerHTML = '';
      if (!rows.length) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'py-6 px-3 text-center text-gray-500';
        td.textContent = 'Enter loan details to generate the schedule.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      const limit = showFullSchedule ? rows.length : Math.min(rows.length, 12);
      rows.slice(0, limit).forEach((row) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3 text-left">${row.index}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.payment)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.interest)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.principal)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.extra)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.balance)}</td>
        `;
        tbody.appendChild(tr);
      });

      if (!showFullSchedule && rows.length > limit) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'py-3 px-3 text-center text-gray-500';
        td.textContent = `Showing the first ${limit} of ${rows.length} payments.`;
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    function compute() {
      const okBalance = validateBalance();
      const okApr = validateApr();
      const okPayment = validatePayment();
      const okExtra = validateExtra();
      const okLump = validateLump();
      const valid = okBalance && okApr && okPayment && okExtra && okLump;

      if (!valid) {
        showFullSchedule = false;
        els.toggleSchedule.textContent = 'Show full schedule';

      fullSchedule = [];
      buildSchedule(fullSchedule);
        els.monthsValue.textContent = '0';
        els.monthsBaseline.textContent = 'Scheduled without extras: 0';
        els.payoffDateValue.textContent = 'â€”';
        els.startEcho.textContent = 'Start: â€”';
        els.interestValue.textContent = fmtCurrency(0);
        els.baselineInterestValue.textContent = fmtCurrency(0);
        els.interestSavedValue.textContent = 'Interest saved vs. baseline: $0.00';
        els.lumpEcho.textContent = fmtCurrency(0);
        els.extraEcho.textContent = fmtCurrency(0);
        els.statusPill.textContent = 'Fix validation errors';
        els.statusPill.className = 'result-pill bg-amber-100 text-amber-800';
        return;
      }

      const { balance, apr, payment, extra, lump, startVal } = parseInputs();
      const baseline = simulate(balance, apr, payment, 0, 0);
      const scenario = simulate(balance, apr, payment, extra, lump);

      if (!isFinite(scenario.months) || !isFinite(scenario.interest)) {
        els.monthsValue.textContent = 'Increase payment';
        els.monthsBaseline.textContent = `Scheduled without extras: ${isFinite(baseline.months) ? baseline.months : 'â€”'}`;
        els.payoffDateValue.textContent = 'â€”';
        els.startEcho.textContent = 'Start: â€”';
        els.interestValue.textContent = 'â€”';
        els.baselineInterestValue.textContent = isFinite(baseline.interest) ? fmtCurrency(baseline.interest) : 'â€”';
        els.interestSavedValue.textContent = 'Interest saved vs. baseline: $0.00';
        els.lumpEcho.textContent = fmtCurrency(lump);
        els.extraEcho.textContent = fmtCurrency(extra);
        els.statusPill.textContent = 'Payment too low to amortize';
        els.statusPill.className = 'result-pill bg-rose-100 text-rose-800';
        fullSchedule = [];
        buildSchedule(fullSchedule);
        return;
      }

      const baselineValid = isFinite(baseline.months) && isFinite(baseline.interest);
      const interestSaved = baselineValid
        ? Math.max(0, baseline.interest - scenario.interest)
        : 0;
      els.monthsValue.textContent = scenario.months.toLocaleString();
      els.monthsBaseline.textContent = baselineValid
        ? `Scheduled without extras: ${baseline.months.toLocaleString()}`
        : 'Scheduled without extras: payment too small';
      els.interestValue.textContent = fmtCurrency(scenario.interest);
      els.baselineInterestValue.textContent = baselineValid ? fmtCurrency(baseline.interest) : 'â€”';
      els.interestSavedValue.textContent = baselineValid
        ? `Interest saved vs. baseline: ${fmtCurrency(interestSaved)}`
        : 'Interest saved vs. baseline: â€”';
      els.lumpEcho.textContent = fmtCurrency(lump);
      els.extraEcho.textContent = fmtCurrency(extra);

      const startDate = (() => {
        if (!startVal) return new Date();
        const [year, month] = startVal.split('-').map(Number);
        const parsed = new Date(year, (month || 1) - 1, 1);
        return Number.isNaN(parsed.valueOf()) ? new Date() : parsed;
      })();

      const payoffDate = new Date(startDate.getFullYear(), startDate.getMonth() + scenario.months, 1);
      const fmtMonthYear = (date) => date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
      els.startEcho.textContent = `Start: ${fmtMonthYear(startDate)}`;
      els.payoffDateValue.textContent = fmtMonthYear(payoffDate);

      if (!baselineValid) {
        els.statusPill.textContent = 'Baseline payment is too low; extras make payoff possible';
        els.statusPill.className = 'result-pill bg-amber-100 text-amber-800';
      } else if (interestSaved > 0) {
        els.statusPill.textContent = `You save ${fmtCurrency(interestSaved)} and finish ${Math.max(0, baseline.months - scenario.months)} month(s) sooner`;
        els.statusPill.className = 'result-pill bg-emerald-100 text-emerald-800';
      } else {
        els.statusPill.textContent = 'No extra savings versus baseline';
        els.statusPill.className = 'result-pill bg-slate-100 text-slate-800';
      }

      fullSchedule = scenario.rows;
      els.toggleSchedule.textContent = showFullSchedule ? 'Show first 12 payments' : 'Show full schedule';
      buildSchedule(fullSchedule);
    }

    function resetForm() {
      els.balance.value = 20000;
      els.apr.value = 6.5;
      els.payment.value = 450;
      els.extra.value = 0;
      els.lump.value = 0;
      const now = new Date();
      els.startMonth.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

      setError(els.balance, els.balanceErr, '');
      setError(els.apr, els.aprErr, '');
      setError(els.payment, els.paymentErr, '');
      setError(els.extra, els.extraErr, '');
      setError(els.lump, els.lumpErr, '');

      showFullSchedule = false;
      els.toggleSchedule.textContent = 'Show full schedule';
      compute();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      $('lastUpdated').textContent = today.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' });

      updateCurrencySymbols();

      if (!els.startMonth.value) {
        const now = new Date();
        els.startMonth.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
      }

      const triggerCompute = () => compute();
      els.ui.addEventListener('input', triggerCompute);

      els.calculate.addEventListener('click', compute);
      els.reset.addEventListener('click', resetForm);
      els.example.addEventListener('click', () => {
        els.balance.value = 20000;
        els.apr.value = 6.5;
        els.payment.value = 450;
        els.extra.value = 75;
        els.lump.value = 1000;
        const now = new Date();
        els.startMonth.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        compute();
      });

      els.toggleSchedule.addEventListener('click', () => {
        if (!fullSchedule.length) return;
        showFullSchedule = !showFullSchedule;
        els.toggleSchedule.textContent = showFullSchedule ? 'Show first 12 payments' : 'Show full schedule';
        buildSchedule(fullSchedule);
      });

      compute();

      const toggle = $('mobile-menu-toggle');
      const menu = $('mobile-menu');
      toggle?.addEventListener('click', () => menu?.classList.toggle('hidden'));
    });
  </script>
</body>
</html>
