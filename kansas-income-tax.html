<!DOCTYPE html>
<html lang="en"><head> 
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta charset="utf-8"/>
<title>Kansas State Income Tax Calculator</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Kansas income tax calculator for 2024. Instantly compute Kansas state tax owed, marginal rate, effective rate, and after-tax income with a transparent bracket breakdown." name="description"/>
<meta content="Ugo Candido" name="author"/>
<link href="https://calcdomain.com/kansas-income-tax.html" rel="canonical"/>
<meta content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" name="robots"/>
<meta content="#005A9C" name="theme-color"/>
<style>
    /* --- Critical, mobile-first CSS (WCAG 2.1 AA, performance-focused) --- */

    /* Design tokens */
    :root{
      --primary-color:#005A9C; --secondary-color:#003F6E; --accent-color:#00A4E4;
      --background-color:#F8F9FA; --surface-color:#FFFFFF;
      --text-color:#212529; --muted-text-color:#5a6772; --border-color:#DEE2E6;
      --success-color:#198754; --error-color:#DC3545;
      --font-sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      --font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --container-max:1200px;
      --radius-card:12px; --radius-input:8px; --touch:48px;
      --shadow-sm:0 1px 2px rgba(0,0,0,.06);
      --shadow-md:0 4px 10px rgba(0,0,0,.08);
    }
    @media (prefers-contrast: more){
      :root{ --primary-color:#000080; --secondary-color:#000; --text-color:#000; --border-color:#000; --background-color:#fff; }
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; scroll-behavior:auto !important; }
    }

    /* Base */
    *{ box-sizing:border-box; }
    html{ font-size:16px; }
    body{
      margin:0; font-family:var(--font-sans); color:var(--text-color); background:var(--background-color);
      line-height:1.6; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    h1,h2,h3{ color:var(--secondary-color); line-height:1.25; margin:.25rem 0 .75rem; font-weight:800; }
    h1{ font-size:clamp(1.6rem,4.5vw,2.25rem); }
    h2{ font-size:clamp(1.25rem,3.5vw,1.75rem); }
    h3{ font-size:clamp(1.1rem,3vw,1.35rem); }
    p{ margin:.75rem 0; max-width:70ch; }
    a{ color:var(--primary-color); text-decoration:none; }
    a:hover{ text-decoration:underline; }
    code,kbd,samp { font-family:var(--font-mono); }

    .container{ max-width:var(--container-max); margin-inline:auto; padding-inline:clamp(1rem,3vw,2rem); }
    .skip-link{
      position:absolute; left:8px; top:-40px; background:var(--primary-color); color:#fff; padding:.5rem .75rem; border-radius:0 0 6px 6px;
      z-index:1000; text-decoration:none; font-weight:700;
    }
    .skip-link:focus{ top:0; }

    /* Header (non-sticky per requirements) */
    header{ background:var(--surface-color); border-bottom:1px solid var(--border-color); box-shadow:var(--shadow-sm); }
    .header-inner{ display:flex; align-items:center; gap:.75rem; padding:.75rem 0; }
    .brand{ font-weight:900; color:var(--primary-color); font-size:1.125rem; letter-spacing:.2px; }
    .site-search{ margin-left:auto; display:flex; align-items:center; gap:.5rem; }
    .site-search input[type="search"]{
      padding:.6rem .75rem; border:1px solid var(--border-color); border-radius:8px; min-height:var(--touch); width:min(70vw,320px);
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
      padding:.7rem 1rem; min-height:var(--touch); min-width:var(--touch);
      border-radius:10px; border:1px solid transparent; font-weight:700; cursor:pointer; text-align:center;
    }
    .btn-primary{ background:var(--primary-color); color:#fff; border-color:var(--primary-color); }
    .btn-secondary{ background:transparent; color:var(--primary-color); border-color:var(--primary-color); }
    .btn-secondary:hover{ background:rgba(0,90,156,.06); }
    .btn:focus{ outline:3px solid var(--primary-color); outline-offset:2px; }

    main{ padding-block:1.25rem 2rem; }

    /* Layout */
    .calculator-layout{
      display:grid; grid-template-columns:1fr; gap:1.5rem; margin-top:.75rem;
    }
    @media (min-width: 992px){
      .calculator-layout{ grid-template-columns: clamp(300px,40vw,430px) 1fr; gap:2rem; }
    }

    /* Card containers */
    .card{
      background:var(--surface-color); border:1px solid var(--border-color); border-radius:var(--radius-card); box-shadow:var(--shadow-md);
      padding:clamp(1rem,2.5vw,1.5rem);
    }

    /* Form */
    .form-group{ margin-bottom:1rem; }
    .form-group label{ display:block; font-weight:750; margin-bottom:.35rem; }
    .label-row{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    .help-btn{
      appearance:none; border:1px solid var(--border-color); background:var(--surface-color); color:var(--secondary-color);
      border-radius:50%; width:var(--touch); height:var(--touch); font-weight:900; cursor:pointer;
    }
    .help-btn:focus{ outline:3px solid var(--primary-color); outline-offset:2px; }
    .tooltip{
      margin-top:.35rem; background:#eef5fb; border:1px solid #cfe3f5; color:#0a3c66; padding:.75rem; border-radius:8px;
    }
    .tooltip[hidden]{ display:none; }
    .input-wrap{ position:relative; }
    .form-control{
      width:100%; min-height:var(--touch); padding:.75rem 1rem; border:1px solid var(--border-color); border-radius:var(--radius-input);
      font-size:1rem; background:#fff;
    }
    .form-control:focus{ outline:3px solid var(--primary-color); outline-offset:2px; }
    .suffix, .prefix{
      position:absolute; top:50%; transform:translateY(-50%); color:var(--muted-text-color); pointer-events:none; font-weight:700;
    }
    .prefix{ left:.75rem; }
    .suffix{ right:.75rem; }
    .with-prefix{ padding-left:2rem; }
    .with-suffix{ padding-right:2.25rem; }
    .error{ color:var(--error-color); font-size:.95rem; margin-top:.35rem; min-height:1.2em; }
    .radio-row{ display:flex; gap:.5rem; flex-wrap:wrap; }
    .choice{
      border:1px solid var(--border-color); padding:.5rem .75rem; border-radius:8px; cursor:pointer;
      display:inline-flex; align-items:center; gap:.5rem; min-height:var(--touch);
    }
    .choice input{ accent-color:var(--primary-color); width:18px; height:18px; }

    /* Results */
    .results-container{
      min-height:260px; background:var(--background-color); border:1px solid var(--border-color);
      border-radius:var(--radius-card); padding:clamp(1rem,2.5vw,1.25rem);
    }
    .results-grid{ display:grid; gap:.75rem; }
    .result-item{ display:flex; align-items:baseline; justify-content:space-between; padding:.5rem 0; border-bottom:1px dashed var(--border-color); }
    .result-item:last-child{ border-bottom:none; }
    .result-label{ color:var(--muted-text-color); }
    .result-value{ font-weight:900; color:var(--success-color); font-size:1.2rem; font-variant-numeric:tabular-nums; }
    .badge{ display:inline-block; background:#e9f7ef; border:1px solid #cde9d6; color:#0f5132; padding:.25rem .5rem; border-radius:999px; font-size:.875rem; font-weight:700; }
    .mono{ font-family:var(--font-mono); }

    /* Content */
    .formula-box{
      background:#eef2f6; border:1px solid #cfd9e3; border-radius:10px; padding:1rem; overflow:auto;
      font-family:var(--font-mono);
    }
    .glossary{ border-collapse:collapse; width:100%; margin:.5rem 0 0; }
    .glossary th,.glossary td{ border:1px solid var(--border-color); padding:.6rem .5rem; text-align:left; vertical-align:top; }
    .author-box{ font-size:.95rem; color:var(--muted-text-color); border-top:1px solid var(--border-color); margin-top:1.25rem; padding-top:1rem; }

    /* Accessibility helpers */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Kansas State Income Tax Calculator",
  "description": "Compute Kansas state income tax for 2024 with an accessible, authoritative calculator. Get tax owed, marginal rate, effective rate, and a bracket-by-bracket breakdown.",
  "url": "https://calcdomain.com/kansas-income-tax.html",
  "inLanguage": "en-US",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "dateModified": "2025-09-13",
  "about": {
    "@type": "Thing",
    "name": "Kansas Individual Income Tax"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step Example",
      "description": "Compute Kansas state income tax for a Single filer with $52,000 taxable income in tax year 2024.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Select Filing Status",
          "text": "Choose Single (or the status that applies to you)."
        },
        {
          "@type": "HowToStep",
          "name": "Enter Kansas Taxable Income",
          "text": "Type 52000 (representing $52,000) in the taxable income field."
        },
        {
          "@type": "HowToStep",
          "name": "Review the Bracket Breakdown",
          "text": "The tool applies 3.1% to the first $15,000, 5.25% to the next $15,000, and 5.7% to the remainder."
        },
        {
          "@type": "HowToStep",
          "name": "Read Results",
          "text": "Tax owed: $2,506.50; Marginal rate: 5.7%; Effective rate: 4.82%."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Which tax year does this calculator use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This calculator uses the Kansas 2024 individual income tax rate schedules published by the Kansas Department of Revenue."
          }
        },
        {
          "@type": "Question",
          "name": "Do the brackets change based on filing status?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. For 2024, Single, Head of Household, and Married Filing Separately share one schedule, while Married Filing Jointly and Qualifying Widow(er) have doubled thresholds."
          }
        },
        {
          "@type": "Question",
          "name": "What income should I enter?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Enter your Kansas taxable income (after Kansas deductions and exemptions). If you only know gross wages, consult your K-40 instructions or a tax professional to derive Kansas taxable income."
          }
        },
        {
          "@type": "Question",
          "name": "Does this include federal taxes or local taxes?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. It only computes Kansas state individual income tax based on the selected filing status and taxable income."
          }
        },
        {
          "@type": "Question",
          "name": "How precise are the results?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Calculations are formula-driven and follow Kansas tax rate schedules for 2024. Rounding to cents is applied; actual tax may vary slightly due to credits, adjustments, or form-level rounding."
          }
        },
        {
          "@type": "Question",
          "name": "Will my marginal rate equal my effective rate?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. The marginal rate applies only to the top portion of your income, while the effective rate is total tax divided by total taxable income."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['$','$'], ['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="/assets/js/page-enhancements.js" as="script">

</head>
<body>

<a class="skip-link" href="#main">Skip to main content</a>
<header role="banner">
<div class="container header-inner">
<a aria-label="CalcDomain home" class="brand" href="/">CalcDomain</a>
<form aria-label="Site search" class="site-search" id="siteSearchForm" role="search">
<label class="sr-only" for="q">Search calculators</label>
<input aria-label="Search calculators" autocomplete="off" id="q" name="q" placeholder="Search calculators…" type="search"/>
<button aria-label="Submit search" class="btn btn-secondary" type="submit">Search</button>
</form>
</div>
</header>
<main class="container" id="main" role="main">
<h1>Kansas State Income Tax Calculator</h1>
<p>
      Use this professional-grade Kansas income tax calculator to estimate your 2024 state individual income tax. Enter your Kansas taxable income and filing status to see your tax owed, marginal rate, effective rate, and a transparent bracket breakdown.
    </p>
<div class="calculator-layout">
<aside>
<section aria-labelledby="calc-heading" class="card" id="ks-calculator">
<h2 id="calc-heading">Calculator</h2>
<div class="form-group">
<label for="filingStatus">Filing status *</label>
<div class="input-wrap">
<select aria-describedby="filingStatusError" aria-required="true" class="form-control" id="filingStatus">
<option value="single">Single</option>
<option value="mfs">Married Filing Separately</option>
<option value="hoh">Head of Household</option>
<option value="mfj">Married Filing Jointly</option>
<option value="qw">Qualifying Widow(er)</option>
</select>
</div>
<div aria-live="polite" class="error" id="filingStatusError" role="alert"></div>
</div>
<div class="form-group">
<div class="label-row">
<label for="taxYear">Tax year</label>
<span aria-label="Supported tax year" class="badge">2024</span>
</div>
<input aria-readonly="true" class="form-control" id="taxYear" inputmode="numeric" readonly="" value="2024"/>
</div>
<div class="form-group">
<div class="label-row">
<label for="taxableIncome">Kansas taxable income (USD) *</label>
<button aria-controls="tiHelp" aria-expanded="false" aria-label="What is Kansas taxable income?" class="help-btn" id="tiHelpBtn" type="button">?</button>
</div>
<div class="input-wrap">
<span aria-hidden="true" class="prefix">$</span>
<input aria-describedby="tiHelp taxableIncomeError" aria-required="true" class="form-control with-prefix" id="taxableIncome" inputmode="decimal" min="0" placeholder="e.g., 52000" step="0.01" type="number"/>
</div>
<div class="tooltip" hidden="" id="tiHelp">
              Kansas taxable income is your income after Kansas-specific adjustments, deductions, and exemptions as determined on Form K‑40. If you only know gross pay, consult K‑40 instructions or a professional to derive this number.
            </div>
<div aria-live="polite" class="error" id="taxableIncomeError" role="alert"></div>
</div>
<div class="form-group">
<fieldset>
<legend class="sr-only">Rounding preference</legend>
<div aria-label="Rounding preference" class="radio-row" role="radiogroup">
<label class="choice"><input checked="" name="rounding" type="radio" value="cents"/> <span>Round to cents</span></label>
<label class="choice"><input name="rounding" type="radio" value="dollar"/> <span>Round to whole dollars</span></label>
</div>
</fieldset>
</div>
<div class="form-group" style="display:flex; gap:.5rem; flex-wrap:wrap;">
<button aria-label="Calculate Kansas tax" class="btn btn-primary" id="calcBtn" type="button">Calculate</button>
<button aria-label="Reset form" class="btn btn-secondary" id="resetBtn" type="button">Reset</button>
</div>
</section>
</aside>
<section aria-labelledby="results-heading" aria-live="polite" class="results-container">
<h2 id="results-heading">Results</h2>
<div class="results-grid">
<div class="result-item">
<span class="result-label">Kansas tax owed</span>
<span class="result-value mono" id="taxOwed">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">Effective tax rate</span>
<span class="result-value mono" id="effectiveRate">0.00%</span>
</div>
<div class="result-item">
<span class="result-label">Marginal tax rate</span>
<span class="result-value mono" id="marginalRate">0.00%</span>
</div>
<div class="result-item">
<span class="result-label">After-tax income (from taxable)</span>
<span class="result-value mono" id="afterTax">$0.00</span>
</div>
</div>
<div id="breakdown" style="margin-top:1rem;">
<h3>Bracket breakdown</h3>
<div class="mono" id="bracketList" style="font-size:.975rem;"></div>
</div>
</section>
</div>
<section class="card" style="margin-top:1.5rem;">
<h2>Data Source and Methodology</h2>
<p>
        Authoritative source: Kansas Department of Revenue — Individual Income Tax, 2024 Rate Schedules (K‑40 Instructions).
        See: <a href="https://www.ksrevenue.gov/" rel="noopener" target="_blank">ksrevenue.gov</a> and K‑40 instructions (2024). Direct resource: <a href="https://www.ksrevenue.gov/taxcalc.html" rel="noopener" target="_blank">Withholding &amp; Tax Calculators</a> and the K‑40 instructions for rate schedules.
        All calculations strictly follow the progressive rate schedules published by KDOR.
      </p>
<p><strong>All computations strictly adhere to the formulas and data provided by this source.</strong></p>
</section>
<section class="card" style="margin-top:1rem;">
<h2>The Formula Explained</h2>
<div aria-label="Formulas in LaTeX" class="formula-box">
        $$ Tax = \sum_{i=1}^{n} r_i \cdot \max\!\left(0,\; \min\!\left(I,\; U_i\right) - L_i \right) $$
        where:
        $$ I = \text{Kansas taxable income} $$
        $$ \{(L_i, U_i, r_i)\} = \text{bracket lower bound, upper bound, and rate for your filing status} $$
        Marginal rate:
        $$ r_{\text{marginal}} = r_j \quad \text{for the bracket } j \text{ that contains } I $$
        Effective rate:
        $$ r_{\text{effective}} = \frac{Tax}{I} \quad (\text{defined as } 0 \text{ if } I = 0) $$
      </div>
<p>For 2024, Kansas applies three progressive rates. Bracket thresholds depend on filing status.</p>
</section>
<section class="card" style="margin-top:1rem;">
<h2>Glossary of Variables</h2>
<table class="glossary" role="table">
<thead>
<tr><th scope="col">Name</th><th scope="col">Meaning</th></tr>
</thead>
<tbody>
<tr><td>Filing status</td><td>Your status for Kansas purposes (Single, MFS, HOH, MFJ, QW).</td></tr>
<tr><td>Kansas taxable income (I)</td><td>Income after Kansas adjustments, deductions, and exemptions as shown on Form K‑40.</td></tr>
<tr><td>Tax owed (Tax)</td><td>Total state income tax due from applying the progressive brackets.</td></tr>
<tr><td>Marginal rate (r_marginal)</td><td>The rate applied to your last dollar of income within your highest active bracket.</td></tr>
<tr><td>Effective rate (r_effective)</td><td>Tax owed divided by taxable income; a measure of your average tax rate.</td></tr>
<tr><td>After‑tax income</td><td>Taxable income minus Kansas tax owed (for reference on the taxable base).</td></tr>
</tbody>
</table>
</section>
<section class="card" style="margin-top:1rem;">
<h2>Worked Example</h2>
<h3>How It Works: A Step‑by‑Step Example</h3>
<p><strong>Scenario:</strong> Single filer, Kansas taxable income I = $52,000 (Tax year 2024).</p>
<ol>
<li>Apply 3.1% to the first $15,000: 0.031 × 15,000 = $465.00.</li>
<li>Apply 5.25% to the next $15,000: 0.0525 × 15,000 = $787.50.</li>
<li>Apply 5.7% to the remainder: 52,000 − 30,000 = 22,000; 0.057 × 22,000 = $1,254.00.</li>
<li>Total tax: $465.00 + $787.50 + $1,254.00 = <strong>$2,506.50</strong>.</li>
<li>Marginal rate: <strong>5.7%</strong>; Effective rate: 2,506.50 / 52,000 ≈ <strong>4.82%</strong>.</li>
</ol>
<div class="formula-box">
        $$ Tax = 0.031 \cdot 15000 \;+\; 0.0525 \cdot 15000 \;+\; 0.057 \cdot (52000-30000) = 2506.5 $$
      </div>
</section>
<section class="card" style="margin-top:1rem;">
<h2>Frequently Asked Questions (FAQ)</h2>
<div>
<h3>Which tax year is covered?</h3>
<p>This tool covers the Kansas 2024 individual income tax rate schedules. Always verify current-year changes on the Kansas Department of Revenue website.</p>
<h3>What rates and thresholds are used?</h3>
<p>For 2024, rates are 3.1%, 5.25%, and 5.7%. Thresholds depend on filing status: Single/HOH/MFS share one schedule; MFJ/QW thresholds are doubled.</p>
<h3>Can I plug in my gross pay?</h3>
<p>Enter Kansas taxable income for the most accurate result. Gross pay differs from taxable income due to adjustments and deductions.</p>
<h3>Does this account for credits?</h3>
<p>No. This calculator applies the progressive bracket formula only. Credits and specialized adjustments are beyond its scope.</p>
<h3>Is the result the same as what appears on my K‑40?</h3>
<p>It should closely match the tax computed from the 2024 rate schedules. Minor differences can arise due to rounding or additional form-specific rules.</p>
<h3>Is Head of Household treated like Single?</h3>
<p>For 2024 brackets, HOH uses the same thresholds as Single in this tool. If KDOR publishes different thresholds, those prevail.</p>
<h3>Who should I contact for personalized advice?</h3>
<p>Consult a qualified tax professional or contact the Kansas Department of Revenue for official guidance.</p>
</div>
</section>
<div class="author-box" role="contentinfo">
<p>
        Tool developed by <strong>Ugo Candido</strong>. Content verified by <strong>CalcDomain Editorial Board</strong>.<br/>
        Last reviewed for accuracy on: <time datetime="2025-09-13">September 13, 2025</time>.
      </p>
</div>
</main>
<!-- Standard Footer --> 
<script defer="">
    (function(){
      'use strict';

      // Elements
      const filingStatusEl = document.getElementById('filingStatus');
      const taxableIncomeEl = document.getElementById('taxableIncome');
      const roundingEls = document.querySelectorAll('input[name="rounding"]');
      const calcBtn = document.getElementById('calcBtn');
      const resetBtn = document.getElementById('resetBtn');

      const taxOwedEl = document.getElementById('taxOwed');
      const effectiveRateEl = document.getElementById('effectiveRate');
      const marginalRateEl = document.getElementById('marginalRate');
      const afterTaxEl = document.getElementById('afterTax');
      const bracketListEl = document.getElementById('bracketList');

      const filingStatusError = document.getElementById('filingStatusError');
      const taxableIncomeError = document.getElementById('taxableIncomeError');

      const tiHelpBtn = document.getElementById('tiHelpBtn');
      const tiHelp = document.getElementById('tiHelp');

      // Accessibility: tooltip toggle
      tiHelpBtn.addEventListener('click', function(){
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', String(!expanded));
        if(expanded){
          tiHelp.hidden = true;
        } else {
          tiHelp.hidden = false;
        }
      });

      // Kansas 2024 brackets (per KDOR schedules)
      // Single, HOH, MFS share Single schedule; MFJ and QW doubled thresholds.
      const BRACKETS_2024 = {
        single: [
          { upTo: 15000, rate: 0.031 },
          { upTo: 30000, rate: 0.0525 },
          { upTo: Infinity, rate: 0.057 }
        ],
        hoh: [
          { upTo: 15000, rate: 0.031 },
          { upTo: 30000, rate: 0.0525 },
          { upTo: Infinity, rate: 0.057 }
        ],
        mfs: [
          { upTo: 15000, rate: 0.031 },
          { upTo: 30000, rate: 0.0525 },
          { upTo: Infinity, rate: 0.057 }
        ],
        mfj: [
          { upTo: 30000, rate: 0.031 },
          { upTo: 60000, rate: 0.0525 },
          { upTo: Infinity, rate: 0.057 }
        ],
        qw: [
          { upTo: 30000, rate: 0.031 },
          { upTo: 60000, rate: 0.0525 },
          { upTo: Infinity, rate: 0.057 }
        ]
      };

      function getRoundingMode(){
        const sel = Array.from(roundingEls).find(r => r.checked);
        return sel ? sel.value : 'cents';
      }

      function formatCurrency(num){
        return num.toLocaleString(undefined, { style:'currency', currency:'USD', maximumFractionDigits:2 });
      }
      function formatPercent(num){
        return `${num.toFixed(2)}%`;
      }

      // Validation
      function validateStatus(){
        if(!filingStatusEl.value){
          filingStatusEl.setAttribute('aria-invalid','true');
          filingStatusError.textContent = 'Please select a filing status.';
          return false;
        }
        filingStatusEl.removeAttribute('aria-invalid');
        filingStatusError.textContent = '';
        return true;
      }

      function validateIncome(){
        const val = taxableIncomeEl.value.trim();
        if(val === ''){
          taxableIncomeEl.setAttribute('aria-invalid','true');
          taxableIncomeError.textContent = 'Enter your Kansas taxable income (a non-negative number).';
          return false;
        }
        const num = Number(val);
        if(!Number.isFinite(num) || num < 0){
          taxableIncomeEl.setAttribute('aria-invalid','true');
          taxableIncomeError.textContent = 'The income value must be a number greater than or equal to 0.';
          return false;
        }
        if(num > 1e8){
          taxableIncomeEl.setAttribute('aria-invalid','true');
          taxableIncomeError.textContent = 'Please enter an amount less than 100,000,000 for performance and practicality.';
          return false;
        }
        taxableIncomeEl.removeAttribute('aria-invalid');
        taxableIncomeError.textContent = '';
        return true;
      }

      filingStatusEl.addEventListener('blur', validateStatus);
      taxableIncomeEl.addEventListener('blur', validateIncome);

      // Calculation
      function computeKansasTax(taxableIncome, statusKey){
        const brackets = BRACKETS_2024[statusKey];
        let tax = 0;
        let lower = 0;
        let marginalRate = 0;
        const parts = [];

        for(const b of brackets){
          const upper = b.upTo;
          const taxableInBracket = Math.max(0, Math.min(taxableIncome, upper) - lower);
          if(taxableInBracket > 0){
            const chunkTax = taxableInBracket * b.rate;
            parts.push({
              range: [lower, Math.min(upper, taxableIncome)],
              rate: b.rate,
              amount: chunkTax
            });
            tax += chunkTax;
            marginalRate = b.rate;
          }
          if(taxableIncome <= upper){ break; }
          lower = upper;
        }

        return { tax, marginalRate, parts };
      }

      function calculateAndRender(){
        const ok = validateStatus() & validateIncome(); // bitwise ok: both run
        if(!ok){ return; }

        const status = filingStatusEl.value;
        const rounding = getRoundingMode();
        const income = Number(taxableIncomeEl.value);

        const { tax, marginalRate, parts } = computeKansasTax(income, status);
        const taxRounded = rounding === 'dollar' ? Math.round(tax) : Math.round(tax * 100) / 100;

        const effRate = income > 0 ? (taxRounded / income) * 100 : 0;
        const afterTax = income - taxRounded;

        taxOwedEl.textContent = formatCurrency(taxRounded);
        effectiveRateEl.textContent = formatPercent(effRate);
        marginalRateEl.textContent = formatPercent(marginalRate * 100);
        afterTaxEl.textContent = formatCurrency(afterTax);

        // Bracket breakdown
        if(parts.length === 0){
          bracketListEl.innerHTML = '<p>No tax due.</p>';
          return;
        }
        const lines = parts.map(p => {
          const base = `$${(p.range[0]).toLocaleString()}–$${(p.range[1]).toLocaleString()}`;
          const ratePct = (p.rate*100).toFixed(2) + '%';
          const amt = formatCurrency(p.amount);
          return `• ${ratePct} on ${base} → ${amt}`;
        });
        bracketListEl.textContent = lines.join('\n');
      }

      // Bind calculate actions
      calcBtn.addEventListener('click', calculateAndRender);
      filingStatusEl.addEventListener('change', calculateAndRender);
      roundingEls.forEach(r => r.addEventListener('change', calculateAndRender));
      taxableIncomeEl.addEventListener('input', function(){
        // Debounced-ish instant feedback for INP without thrashing
        // Simple micro-debounce
        clearTimeout(this._t);
        this._t = setTimeout(calculateAndRender, 120);
      });

      resetBtn.addEventListener('click', () => {
        filingStatusEl.value = 'single';
        taxableIncomeEl.value = '';
        document.querySelector('input[name="rounding"][value="cents"]').checked = true;
        filingStatusEl.removeAttribute('aria-invalid');
        taxableIncomeEl.removeAttribute('aria-invalid');
        filingStatusError.textContent = '';
        taxableIncomeError.textContent = '';
        taxOwedEl.textContent = '$0.00';
        effectiveRateEl.textContent = '0.00%';
        marginalRateEl.textContent = '0.00%';
        afterTaxEl.textContent = '$0.00';
        bracketListEl.innerHTML = '';
      });

      // Progressive enhancement: initial render with defaults
      calculateAndRender();

      // Non-blocking site search noop
      document.getElementById('siteSearchForm').addEventListener('submit', function(e){
        e.preventDefault();
        alert('This is a demo search. Please implement site-wide search on your platform.');
      });
    })();
  </script>

</body></html>