<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ellipse Calculator — Area, Perimeter, Eccentricity, Foci & Equation</title>
  <meta name="description" content="Professional ellipse calculator. Enter any two of: semi-major axis a, semi-minor axis b, eccentricity e, focal distance c, or area A to compute all ellipse properties, including Ramanujan perimeter, foci, directrices, and canonical equation. Accessible, mobile-first, WCAG 2.1 AA." />
  <link rel="canonical" href="https://calcdomain.com/ellipse-calculator.html" />

  <!-- App icons (placeholders safe to keep; swap with your assets when integrating) -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MathJax for LaTeX rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          id="MathJax-script"></script>

  <style>
    /* Base typography + prose */
    body { font-family: ui-sans-serif, system-ui, -apple-system, "Inter", Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"; }
    .prose { max-width: 68ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .prose p, .prose li { line-height: 1.65; }
    .formula-box {
      background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:1rem;
      overflow-x:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    /* Accessible focus ring (3px) */
    :focus-visible { outline: 3px solid #2563eb; outline-offset: 2px; }
    /* CLS prevention for results area */
    #results-area { min-height: 380px; }
    /* Tooltip popover */
    .tip { display:none; }
    .tip[aria-hidden="false"] { display:block; }
    /* Touch targets */
    .tappable { min-height: 48px; min-width: 48px; }
    /* Results cards */
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; }
    .result-card h4 { font-size:0.95rem; color:#6b7280; margin-bottom:0.25rem; }
    .result-card p { font-size:1.5rem; font-weight:800; color:#0f172a; }
    /* Table */
    table.prop { border-collapse: separate; border-spacing:0; width:100%; }
    table.prop th, table.prop td { padding:0.6rem 0.75rem; border-bottom:1px solid #e5e7eb; }
    table.prop th { text-align:left; color:#475569; font-weight:600; background:#f8fafc; }
    /* Print */
    @media print {
      header, nav, aside, .no-print { display:none !important; }
      main { padding:0 !important; }
      #print-section { position: static; box-shadow:none; border:none; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Ellipse Calculator",
    "url":"https://calcdomain.com/ellipse-calculator.html",
    "inLanguage":"en",
    "description":"Compute ellipse properties from any two: semi-major axis, semi-minor axis, eccentricity, focal distance, or area. Outputs perimeter (Ramanujan), foci, directrices, and canonical equation.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Analytic Geometry","item":"https://calcdomain.com/analytic-geometry.html"},
      {"@type":"ListItem","position":4,"name":"Ellipse Calculator","item":"https://calcdomain.com/ellipse-calculator.html"}
    ]
  }
  </script>
  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to compute ellipse parameters",
    "step":[
      {"@type":"HowToStep","name":"Choose two inputs","text":"Provide any two among: semi-major axis a, semi-minor axis b, eccentricity e, focal distance c, or area A."},
      {"@type":"HowToStep","name":"Enter values","text":"Type positive numeric values; keep eccentricity e in [0, 1)."},
      {"@type":"HowToStep","name":"Review results","text":"The calculator derives all remaining parameters and shows the canonical equation and a scaled diagram."},
      {"@type":"HowToStep","name":"Export or print","text":"Print the page or copy the results table for reports."}
    ]
  }
  </script>
  <!-- JSON-LD: SoftwareApplication (Calculator) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Ellipse Calculator",
    "operatingSystem":"Web",
    "applicationCategory":"EducationalApplication",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "author":{"@type":"Person","name":"Ugo Candido"}
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky as required) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700" href="search.html">Search</a>
        <a class="hover:text-blue-700" href="index.html#categories">Categories</a>
        <a class="hover:text-blue-700" href="about.html">About</a>
      </nav>
      <button class="md:hidden tappable p-2 rounded hover:bg-gray-100" aria-label="Open menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div id="print-section" class="max-w-[1100px] mx-auto">
      <!-- Breadcrumbs -->
      <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
        <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
        <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
        <a href="analytic-geometry.html" class="hover:text-blue-700">Analytic Geometry</a> &raquo;
        <span class="text-gray-900">Ellipse Calculator</span>
      </nav>

      <!-- 1. H1 -->
      <h1 class="text-3xl font-extrabold text-gray-900 mb-2">ellipse calculator</h1>

      <!-- 2. Introduction -->
      <p class="text-gray-700 mb-6">
        Enter any <strong>two</strong> ellipse parameters — semi-major axis <em>a</em>, semi-minor axis <em>b</em>, eccentricity <em>e</em>,
        focal distance <em>c</em>, or area <em>A</em> — and this tool will compute the rest:
        canonical equation, foci, directrices, Ramanujan perimeter approximation, and a scaled diagram. Built for students,
        engineers, and educators who need <em>accurate, audit-ready</em> results.
      </p>

      <!-- 3. Calculator -->
      <section id="calculator" class="bg-white p-6 rounded-xl shadow-sm border">
        <h2 class="sr-only">Ellipse input form</h2>
        <form class="grid grid-cols-1 md:grid-cols-2 gap-6" novalidate>
          <!-- a -->
          <div>
            <div class="flex items-center gap-2">
              <label for="a" class="block text-sm font-medium text-gray-800">Semi-major axis a <span class="text-red-600" aria-hidden="true">*</span></label>
              <button type="button" class="tappable ml-1 p-1 rounded hover:bg-gray-100"
                      aria-expanded="false" aria-controls="tip-a" aria-label="Show help for a" data-tip="a">
                ?
              </button>
            </div>
            <input type="number" inputmode="decimal" step="any" min="0" id="a" name="a"
                   aria-required="true" aria-describedby="err-a tip-a"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600 focus:ring-blue-600" />
            <p id="err-a" class="mt-1 text-sm text-red-700"></p>
            <div id="tip-a" class="tip mt-2 text-xs text-gray-600" aria-hidden="true">
              <strong>a</strong> is the semi-major axis (longer semi-axis). Units are arbitrary but consistent.
            </div>
          </div>

          <!-- b -->
          <div>
            <div class="flex items-center gap-2">
              <label for="b" class="block text-sm font-medium text-gray-800">Semi-minor axis b <span class="text-red-600" aria-hidden="true">*</span></label>
              <button type="button" class="tappable ml-1 p-1 rounded hover:bg-gray-100"
                      aria-expanded="false" aria-controls="tip-b" aria-label="Show help for b" data-tip="b">?</button>
            </div>
            <input type="number" inputmode="decimal" step="any" min="0" id="b" name="b"
                   aria-required="true" aria-describedby="err-b tip-b"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600 focus:ring-blue-600" />
            <p id="err-b" class="mt-1 text-sm text-red-700"></p>
            <div id="tip-b" class="tip mt-2 text-xs text-gray-600" aria-hidden="true">
              <strong>b</strong> is the semi-minor axis (shorter semi-axis). For a valid ellipse, 0 &lt; b ≤ a.
            </div>
          </div>

          <!-- e -->
          <div>
            <div class="flex items-center gap-2">
              <label for="e" class="block text-sm font-medium text-gray-800">Eccentricity e</label>
              <button type="button" class="tappable ml-1 p-1 rounded hover:bg-gray-100"
                      aria-expanded="false" aria-controls="tip-e" aria-label="Show help for e" data-tip="e">?</button>
            </div>
            <input type="number" inputmode="decimal" step="any" min="0" max="0.999999" id="e" name="e"
                   aria-describedby="err-e tip-e"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600 focus:ring-blue-600" />
            <p id="err-e" class="mt-1 text-sm text-red-700"></p>
            <div id="tip-e" class="tip mt-2 text-xs text-gray-600" aria-hidden="true">
              Eccentricity <strong>e = c/a</strong> with <strong>0 ≤ e &lt; 1</strong>. Circle if e = 0.
            </div>
          </div>

          <!-- c -->
          <div>
            <div class="flex items-center gap-2">
              <label for="c" class="block text-sm font-medium text-gray-800">Focal distance c</label>
              <button type="button" class="tappable ml-1 p-1 rounded hover:bg-gray-100"
                      aria-expanded="false" aria-controls="tip-c" aria-label="Show help for c" data-tip="c">?</button>
            </div>
            <input type="number" inputmode="decimal" step="any" min="0" id="c" name="c"
                   aria-describedby="err-c tip-c"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600 focus:ring-blue-600" />
            <p id="err-c" class="mt-1 text-sm text-red-700"></p>
            <div id="tip-c" class="tip mt-2 text-xs text-gray-600" aria-hidden="true">
              <strong>c</strong> is the distance from center to each focus. For ellipses, <strong>c = √(a² − b²)</strong>.
            </div>
          </div>

          <!-- Area -->
          <div>
            <div class="flex items-center gap-2">
              <label for="A" class="block text-sm font-medium text-gray-800">Area A</label>
              <button type="button" class="tappable ml-1 p-1 rounded hover:bg-gray-100"
                      aria-expanded="false" aria-controls="tip-A" aria-label="Show help for A" data-tip="A">?</button>
            </div>
            <input type="number" inputmode="decimal" step="any" min="0" id="A" name="A"
                   aria-describedby="err-A tip-A"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600 focus:ring-blue-600" />
            <p id="err-A" class="mt-1 text-sm text-red-700"></p>
            <div id="tip-A" class="tip mt-2 text-xs text-gray-600" aria-hidden="true">
              Area satisfies <strong>A = π a b</strong>. Units squared if a and b carry units.
            </div>
          </div>

          <!-- Mode/help -->
          <div class="md:col-span-2">
            <div class="p-3 rounded-lg bg-blue-50 border border-blue-100 text-sm text-blue-900">
              Provide <strong>any two</strong> fields. The calculator derives the rest automatically.
              Typical pairs: (a,b), (a,e), (a,c), (b,e), (A,a).
            </div>
          </div>
        </form>
      </section>

      <!-- 4. Results -->
      <section id="results-area" class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left: key metrics -->
        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border">
          <h2 class="text-xl font-bold mb-4">Results</h2>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="result-card" role="group" aria-labelledby="metric-a">
              <h4 id="metric-a">Semi-major a</h4>
              <p id="out-a">—</p>
            </div>
            <div class="result-card" role="group" aria-labelledby="metric-b">
              <h4 id="metric-b">Semi-minor b</h4>
              <p id="out-b">—</p>
            </div>
            <div class="result-card" role="group" aria-labelledby="metric-e">
              <h4 id="metric-e">Eccentricity e</h4>
              <p id="out-e">—</p>
            </div>
            <div class="result-card" role="group" aria-labelledby="metric-c">
              <h4 id="metric-c">Focal distance c</h4>
              <p id="out-c">—</p>
            </div>
            <div class="result-card" role="group" aria-labelledby="metric-area">
              <h4 id="metric-area">Area A</h4>
              <p id="out-A">—</p>
            </div>
            <div class="result-card" role="group" aria-labelledby="metric-perim">
              <h4 id="metric-perim">Perimeter (Ramanujan II)</h4>
              <p id="out-P">—</p>
            </div>
          </div>

          <div class="mt-6">
            <h3 class="font-semibold mb-2">Canonical Equation</h3>
            <div class="formula-box text-sm">
              <div>Standard form (assuming <span class="font-semibold">a ≥ b</span>, major axis along x):</div>
              <div class="mt-2">\( \displaystyle \frac{x^{2}}{a^{2}} + \frac{y^{2}}{b^{2}} = 1 \)</div>
              <div class="mt-3">Parametric form: \( \displaystyle x=a\cos t,\quad y=b\sin t,\quad 0\le t&lt;2\pi \)</div>
              <div class="mt-3">Foci: \( (\pm c,\,0) \) with \( c=\sqrt{a^{2}-b^{2}} \). Directrices: \( x=\pm \frac{a}{e} \) for \( e=c/a \).</div>
            </div>
          </div>

          <div class="mt-6 overflow-x-auto">
            <table class="prop text-sm" aria-describedby="table-caption">
              <caption id="table-caption" class="sr-only">Derived ellipse properties</caption>
              <thead><tr><th>Quantity</th><th>Symbol</th><th>Value</th></tr></thead>
              <tbody id="props-body">
                <!-- Filled by script -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Right: Scaled Diagram (SVG) -->
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <h2 class="text-xl font-bold mb-4">Scaled Diagram</h2>
          <figure class="border rounded-lg p-3 bg-gray-50">
            <svg id="ellipse-svg" viewBox="0 0 320 240" role="img" aria-labelledby="svg-title svg-desc"
                 class="w-full h-auto">
              <title id="svg-title">Ellipse diagram</title>
              <desc id="svg-desc">Ellipse scaled to fit the frame, with axes, foci, and directrices (if within frame).</desc>
              <!-- Axes -->
              <line x1="0" y1="120" x2="320" y2="120" stroke="#94a3b8" stroke-width="1" />
              <line x1="160" y1="0" x2="160" y2="240" stroke="#94a3b8" stroke-width="1" />
              <!-- Ellipse path -->
              <ellipse id="ellipse-shape" cx="160" cy="120" rx="0" ry="0" fill="rgba(59,130,246,0.10)" stroke="#2563eb" stroke-width="2"/>
              <!-- Foci -->
              <circle id="focus-left"  cx="160" cy="120" r="0" fill="#ef4444" />
              <circle id="focus-right" cx="160" cy="120" r="0" fill="#ef4444" />
              <!-- Directrices -->
              <line id="dir-left"  x1="-1000" y1="0" x2="-1000" y2="240" stroke="#f59e0b" stroke-dasharray="4 4" stroke-width="1.5" />
              <line id="dir-right" x1="1000"  y1="0" x2="1000"  y2="240" stroke="#f59e0b" stroke-dasharray="4 4" stroke-width="1.5" />
            </svg>
            <figcaption class="mt-2 text-xs text-gray-600">Axes in gray, ellipse in blue, foci in red, directrices in amber.</figcaption>
          </figure>
        </div>
      </section>

      <!-- 5. Authoritative Content Ecosystem -->
      <section class="prose mt-10 bg-white p-6 rounded-xl shadow-sm border">
        <h2>Authoritative data source &amp; methodology</h2>
        <p>
          Primary formulas follow standard analytic geometry. For perimeter we use
          <strong>Ramanujan’s second approximation</strong>:
          \( P \approx \pi (a+b)\left(1+\dfrac{3h}{10+\sqrt{4-3h}}\right) \) where \( h=\dfrac{(a-b)^2}{(a+b)^2} \).
          References:
        </p>
        <ul>
          <li>Ramanujan, S. (1914). Modular equations and approximations to &pi;. <em>Quarterly Journal of Mathematics</em>.</li>
          <li>Weisstein, E. W. “Ellipse.” <em>MathWorld–A Wolfram Web Resource</em>. </li>
        </ul>
        <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

        <h2>The formulas explained</h2>
        <div class="formula-box">
          <div>\( \displaystyle \text{Area:}\ \ A=\pi a b \)</div>
          <div class="mt-2">\( \displaystyle \text{Focal distance:}\ \ c=\sqrt{a^{2}-b^{2}} \)</div>
          <div class="mt-2">\( \displaystyle \text{Eccentricity:}\ \ e=\frac{c}{a}=\sqrt{1-\frac{b^{2}}{a^{2}}} \)</div>
          <div class="mt-2">\( \displaystyle \text{Directrices:}\ \ x=\pm\frac{a}{e}\quad (a\ge b,\ \text{major along }x) \)</div>
          <div class="mt-2">\( \displaystyle \text{Perimeter (Ramanujan II):}\ \ P\approx \pi(a+b)\!\left(1+\frac{3h}{10+\sqrt{4-3h}}\right),\ h=\frac{(a-b)^{2}}{(a+b)^{2}} \)</div>
        </div>

        <h2>Glossary of variables</h2>
        <table class="prop text-sm">
          <thead><tr><th>Symbol</th><th>Name</th><th>Definition / Units</th></tr></thead>
          <tbody>
            <tr><td>a</td><td>Semi-major axis</td><td>Longer semi-axis (a ≥ b); units of length</td></tr>
            <tr><td>b</td><td>Semi-minor axis</td><td>Shorter semi-axis; units of length</td></tr>
            <tr><td>c</td><td>Focal distance</td><td>Center to focus distance; \(c=\sqrt{a^{2}-b^{2}}\)</td></tr>
            <tr><td>e</td><td>Eccentricity</td><td>Shape parameter; \(e=c/a\), with 0 ≤ e &lt; 1</td></tr>
            <tr><td>A</td><td>Area</td><td>\(A=\pi a b\); square units</td></tr>
            <tr><td>P</td><td>Perimeter</td><td>Ramanujan II approximation in length units</td></tr>
          </tbody>
        </table>

        <h2>How it works: a step-by-step example</h2>
        <p><strong>Inputs:</strong> a = 8, b = 5.</p>
        <ol>
          <li>Compute \(c=\sqrt{8^{2}-5^{2}}=\sqrt{64-25}=\sqrt{39}\approx 6.245\).</li>
          <li>Eccentricity \(e=c/a\approx 6.245/8\approx 0.7806\).</li>
          <li>Area \(A=\pi ab=\pi\cdot 8\cdot 5=40\pi\approx 125.6637\).</li>
          <li>Perimeter via Ramanujan II: \(h=((8-5)/(8+5))^{2}=(3/13)^{2}\approx 0.05325\), so \(P\approx \pi(13)\left(1+\dfrac{3h}{10+\sqrt{4-3h}}\right)\approx 41.2\) (units).</li>
          <li>Directrices at \(x=\pm a/e\approx \pm 10.25\).</li>
        </ol>

        <h2>FAQ</h2>
        <details><summary>Which two inputs should I prefer?</summary><p>(a,b) is most direct. If you know shape and scale separately, use (a,e) or (a,A). If you know focus spacing, (a,c) also works.</p></details>
        <details><summary>Is the perimeter exact?</summary><p>No. Ellipse perimeter has no elementary closed form. We use Ramanujan’s highly accurate approximation (usually &lt;0.05% error for typical shapes).</p></details>
        <details><summary>What if I accidentally set b &gt; a?</summary><p>The tool will automatically swap to ensure a ≥ b and inform you in the properties table.</p></details>
        <details><summary>Do units matter?</summary><p>Use consistent units. Area will be squared units; perimeter, a, b, c are in length units.</p></details>
        <details><summary>Can I model a circle?</summary><p>Yes, set a = b (or e = 0). Then A = πa² and P ≈ 2πa (Ramanujan reduces to the circle case).</p></details>
        <details><summary>Where are the foci located?</summary><p>At (±c, 0) for the standard, axis-aligned ellipse centered at the origin, assuming a ≥ b along the x-axis.</p></details>
        <details><summary>What are directrices?</summary><p>Vertical lines x = ± a/e such that the ratio (distance to a focus)/(distance to the directrix) is constant and equals e.</p></details>
      </section>

      <!-- 6. Authorship & Review -->
      <section class="mt-8">
        <div class="bg-white p-5 rounded-xl border shadow-sm text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.</p>
          <p>Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (deferred) -->
  <script defer>
  (function(){
    const $ = (id) => document.getElementById(id);

    const fields = {
      a: $('a'),
      b: $('b'),
      e: $('e'),
      c: $('c'),
      A: $('A')
    };
    const errors = {
      a: $('err-a'),
      b: $('err-b'),
      e: $('err-e'),
      c: $('err-c'),
      A: $('err-A')
    };

    const outs = {
      a: $('out-a'),
      b: $('out-b'),
      e: $('out-e'),
      c: $('out-c'),
      A: $('out-A'),
      P: $('out-P')
    };

    const svg = {
      root: $('ellipse-svg'),
      shape: $('ellipse-shape'),
      fL: $('focus-left'),
      fR: $('focus-right'),
      dL: $('dir-left'),
      dR: $('dir-right')
    };

    const propsBody = $('props-body');

    // Accessible tooltips
    document.querySelectorAll('[data-tip]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = 'tip-' + btn.getAttribute('data-tip');
        const tip = $(id);
        const open = tip.getAttribute('aria-hidden') === 'false';
        tip.setAttribute('aria-hidden', open ? 'true' : 'false');
        btn.setAttribute('aria-expanded', open ? 'false' : 'true');
      });
      btn.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
      });
    });

    // Formatting helpers
    const nf = new Intl.NumberFormat(undefined, { maximumFractionDigits: 8 });
    const pf = (v) => (isFinite(v) ? nf.format(v) : '—');

    // Validation (inline, on blur)
    function validateField(name) {
      const el = fields[name];
      const val = el.value.trim();
      let msg = '';

      if (['a','b'].includes(name)) {
        if (val === '') { msg = ''; } // optional until two provided
        else if (!(+val > 0)) msg = 'Enter a positive number.';
      }
      if (name === 'e') {
        if (val === '') { msg = ''; }
        else {
          const v = +val;
          if (!(v >= 0 && v < 1)) msg = 'Eccentricity must be in [0, 1).';
        }
      }
      if (name === 'c') {
        if (val === '') { msg = ''; }
        else if (!(+val >= 0)) msg = 'Enter a non-negative number.';
      }
      if (name === 'A') {
        if (val === '') { msg = ''; }
        else if (!(+val > 0)) msg = 'Area must be positive.';
      }

      errors[name].textContent = msg;
      return !msg;
    }

    Object.keys(fields).forEach(k=>{
      fields[k].addEventListener('blur', ()=>{ validateField(k); solve(); });
      fields[k].addEventListener('input', ()=>{ solve(); });
    });

    function numericOrNull(v) {
      const t = (v ?? '').toString().trim();
      if (t === '') return null;
      const n = Number(t);
      return isFinite(n) ? n : null;
    }

    function countProvided(vals) {
      return Object.values(vals).reduce((acc,v)=> acc + (v!==null ? 1 : 0), 0);
    }

    function ramanujanPerimeter(a,b){
      const h = ((a-b)*(a-b))/((a+b)*(a+b));
      return Math.PI*(a+b)*(1 + (3*h)/(10 + Math.sqrt(4 - 3*h)));
    }

    function solve(){
      // Read current inputs
      let a = numericOrNull(fields.a.value);
      let b = numericOrNull(fields.b.value);
      let e = numericOrNull(fields.e.value);
      let c = numericOrNull(fields.c.value);
      let A = numericOrNull(fields.A.value);

      // Quick validity bounds (do not block; we compute only when coherent)
      const provided = {a,b,e,c,A};
      if (countProvided(provided) < 2) {
        renderOutputs(null); return;
      }

      // Derivation logic:
      // Priority: (a,b) ⇒ all
      // Else try to compute (a,b) from pairs:
      // (a,e)->b, (a,c)->b, (b,e)->a, (b,c)->a, (A,a)->b, (A,b)->a
      // If ambiguous sets exist, prefer solutions with a ≥ b and e in [0,1).

      // Normalize and derive
      // If both a and b present
      if (a !== null && b !== null) {
        if (a < b) { const tmp=a; a=b; b=tmp; }
        c = Math.sqrt(Math.max(0, a*a - b*b));
        e = (a>0) ? c/a : null;
        A = Math.PI*a*b;
      } else {
        // derive from pairs
        // a & e -> b
        if (a !== null && e !== null && (e>=0 && e<1)) {
          c = a*e;
          const b2 = a*a - c*c;
          if (b2 > 0) b = Math.sqrt(b2);
          A = (b!==null) ? Math.PI*a*b : A;
        }
        // a & c -> b
        if (a !== null && c !== null && c<=a) {
          const b2 = a*a - c*c;
          if (b2 > 0) b = Math.sqrt(b2);
          e = (a>0)? c/a : e;
          A = (b!==null) ? Math.PI*a*b : A;
        }
        // b & e -> a
        if (b !== null && e !== null && e<1) {
          // e = sqrt(1 - (b^2/a^2)) => a = b / sqrt(1-e^2)
          const denom = Math.sqrt(1 - e*e);
          if (denom > 0) a = b / denom;
          c = (a!==null)? a*e : c;
          A = (a!==null)? Math.PI*a*b : A;
        }
        // b & c -> a
        if (b !== null && c !== null) {
          a = Math.sqrt(b*b + c*c);
          e = (a>0)? c/a : e;
          A = Math.PI*a*b;
        }
        // A & a -> b
        if (A !== null && a !== null && a>0) {
          b = A/(Math.PI*a);
          if (b>0) {
            if (a<b) { const t=a;a=b;b=t; } // ensure a ≥ b
            c = Math.sqrt(Math.max(0,a*a - b*b));
            e = (a>0) ? c/a : e;
          }
        }
        // A & b -> a
        if (A !== null && b !== null && b>0) {
          a = A/(Math.PI*b);
          if (a>0) {
            if (a<b) { const t=a;a=b;b=t; } // ensure a ≥ b
            c = Math.sqrt(Math.max(0,a*a - b*b));
            e = (a>0) ? c/a : e;
          }
        }
      }

      // Final coherence checks
      if (a!==null && b!==null && a>0 && b>0) {
        if (a < b) { const t=a; a=b; b=t; } // enforce a ≥ b
        c = Math.sqrt(Math.max(0,a*a - b*b));
        e = (a>0)? c/a : null;
        A = Math.PI*a*b;
      }

      // If still insufficient, clear outputs
      if (!(a>0 && b>0)) { renderOutputs(null); return; }
      const P = ramanujanPerimeter(a,b);

      renderOutputs({a,b,c,e,A,P});
    }

    function renderOutputs(vals){
      if (!vals) {
        Object.values(outs).forEach(el=> el.textContent = '—');
        propsBody.innerHTML = '';
        // Reset SVG
        drawSVG(null);
        return;
      }
      const {a,b,c,e,A,P} = vals;
      outs.a.textContent = pf(a);
      outs.b.textContent = pf(b);
      outs.c.textContent = pf(c);
      outs.e.textContent = pf(e);
      outs.A.textContent = pf(A);
      outs.P.textContent = pf(P);

      const rows = [
        ['Semi-major axis','a',pf(a)],
        ['Semi-minor axis','b',pf(b)],
        ['Focal distance','c',pf(c)],
        ['Eccentricity','e',pf(e)],
        ['Area','A',pf(A)],
        ['Perimeter (Ramanujan II)','P',pf(P)],
        ['Directrix (right)','x = +a/e', (e && e>0) ? `x = ${pf(a/e)}` : '—'],
        ['Directrix (left)','x = −a/e', (e && e>0) ? `x = -${pf(a/e)}` : '—']
      ];
      propsBody.innerHTML = rows.map(r=>`<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>`).join('');

      drawSVG(vals);
      // Re-typeset formulas in case MathJax hasn't processed yet
      if (window.MathJax && window.MathJax.typesetPromise) { MathJax.typesetPromise(); }
    }

    function drawSVG(vals){
      // Frame
      const W=320, H=240, cx=160, cy=120, margin=12;
      if (!vals) {
        svg.shape.setAttribute('rx','0'); svg.shape.setAttribute('ry','0');
        svg.fL.setAttribute('r','0'); svg.fR.setAttribute('r','0');
        svg.dL.setAttribute('x1','-1000'); svg.dL.setAttribute('x2','-1000');
        svg.dR.setAttribute('x1','1000');  svg.dR.setAttribute('x2','1000');
        return;
      }
      const {a,b,c,e} = vals;

      // Scale ellipse to fit inside frame with margins.
      // Map a -> rx, b -> ry via uniform scale factor s.
      const s = Math.min( (W/2 - margin)/a, (H/2 - margin)/b );
      const rx = a*s, ry = b*s;
      svg.shape.setAttribute('rx', String(rx));
      svg.shape.setAttribute('ry', String(ry));
      svg.shape.setAttribute('cx', String(cx));
      svg.shape.setAttribute('cy', String(cy));

      // Foci at ±c along x, scaled
      const fdx = c*s;
      svg.fL.setAttribute('cx', String(cx - fdx));
      svg.fR.setAttribute('cx', String(cx + fdx));
      svg.fL.setAttribute('cy', String(cy));
      svg.fR.setAttribute('cy', String(cy));
      const fr = 3; // radius in px
      svg.fL.setAttribute('r', String(fr));
      svg.fR.setAttribute('r', String(fr));

      // Directrices at x = ± a/e (if e>0); transform to SVG x in pixels
      if (e && e>0) {
        const dir = (a/e)*s;
        const xL = cx - dir;
        const xR = cx + dir;
        const clamp = (x)=> Math.max(-5000, Math.min(5000, x));
        svg.dL.setAttribute('x1', String(clamp(xL)));
        svg.dL.setAttribute('x2', String(clamp(xL)));
        svg.dL.setAttribute('y1', '0'); svg.dL.setAttribute('y2','240');
        svg.dR.setAttribute('x1', String(clamp(xR)));
        svg.dR.setAttribute('x2', String(clamp(xR)));
        svg.dR.setAttribute('y1', '0'); svg.dR.setAttribute('y2','240');
      } else {
        // hide far away
        svg.dL.setAttribute('x1','-10000'); svg.dL.setAttribute('x2','-10000');
        svg.dR.setAttribute('x1','10000');  svg.dR.setAttribute('x2','10000');
      }
    }

    // Initial solve (empty state)
    solve();
  })();
  </script>
</body>
</html>
