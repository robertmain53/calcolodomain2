<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Appointment Calculator – Plan Dates, Business Days, Working Hours</title>
  <meta name="description" content="Calculate the exact appointment date/time by adding days, weeks, or months from a start date. Enforce business days, working hours, custom holidays, recurring meetings, buffers, and export to calendar (.ics)."/>
  <link rel="canonical" href="https://calcdomain.com/appointment-calculator.html"/>
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root { --focus: #2563eb; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1rem; margin-bottom: .5rem; }
    .formula-box {
      background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; text-align:center; }
    .result-card h4 { font-size:.95rem; color:#374151; margin-bottom:.25rem; }
    .result-card p { font-size:1.35rem; font-weight:800; color:#2563eb; word-break: break-word; }
    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
      border:1px solid #1d4ed8; background:#2563eb; color:#fff; border-radius:12px;
      padding:.75rem 1rem; font-weight:600;
      min-height:48px; min-width:48px;
    }
    .btn:focus-visible, .input:focus-visible, select:focus-visible, textarea:focus-visible, button:focus-visible, a:focus-visible {
      outline: 3px solid var(--focus); outline-offset: 2px;
    }
    .btn.secondary { background:#fff; color:#1f2937; border-color:#d1d5db; }
    .badge { display:inline-block; background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe; border-radius:999px; padding:.15rem .5rem; font-size:.75rem; }
    .tooltip-panel { display:none; margin-top:.5rem; background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px; padding:.75rem; }
    .show { display:block; }
    /* Prevent CLS in results area */
    #results { min-height: 18rem; }
    /* Accessible table style */
    table { border-collapse: separate; border-spacing:0; }
    th, td { border-bottom:1px solid #e5e7eb; }
    /* Print */
    @media print {
      header, aside, .no-print { display:none !important; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position:absolute; left:0; top:0; width:100%; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Appointment Calculator",
    "description":"Add days, weeks, or months from a start date/time with business days, working hours, and holidays. Generate recurring appointments and export .ics.",
    "url":"https://calcdomain.com/appointment-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Everyday Life","item":"https://calcdomain.com/lifestyle-everyday.html"},
      {"@type":"ListItem","position":3,"name":"Time and Date","item":"https://calcdomain.com/subcategories/time-date.html"},
      {"@type":"ListItem","position":4,"name":"Appointment Calculator","item":"https://calcdomain.com/appointment-calculator.html"}
    ]
  }
  </script>
  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to calculate an appointment date and time",
    "description": "Start from a given date/time, add an offset, enforce business days and working hours, include holidays, and export to calendar.",
    "step": [
      {"@type":"HowToStep","name":"Enter start date/time","text":"Provide the start date and time and choose a time zone."},
      {"@type":"HowToStep","name":"Add offset","text":"Enter a quantity and unit to add (minutes, hours, days, weeks, or months)."},
      {"@type":"HowToStep","name":"Enforce business rules","text":"Toggle business days only, select working days and hours, and paste holiday dates if needed."},
      {"@type":"HowToStep","name":"Set recurrence","text":"Choose how many occurrences to generate and the repeat interval."},
      {"@type":"HowToStep","name":"Review and export","text":"See the computed appointment(s) and download an .ics for your calendar."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Header (non-sticky as requested) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex items-center justify-between">
        <a class="text-2xl font-extrabold text-blue-700" href="index.html">CalcDomain</a>
        <nav class="hidden md:flex items-center gap-6 text-sm">
          <a class="hover:text-blue-700" href="search.html">Advanced Search</a>
          <a class="hover:text-blue-700" href="index.html#categories">Categories</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
          <a href="lifestyle-everyday.html" class="hover:text-blue-700">Everyday Life</a> &raquo;
          <a href="subcategories/time-date.html" class="hover:text-blue-700">Time and Date</a> &raquo;
          <span class="text-gray-900">Appointment Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-xl shadow-sm">
          <h1 class="text-3xl font-extrabold mb-2">appointment calculator</h1>
          <p class="text-gray-700 mb-6">
            Plan exact appointment dates and times by adding a time offset to a given start date. Enforce business days, working hours, and custom holiday rules, generate recurring meetings, and export to your calendar in one click.
          </p>

          <!-- Calculator UI -->
          <section id="calculator-ui" class="space-y-6">
            <!-- Start -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="startDate" class="block text-sm font-medium text-gray-800">Start Date <span class="text-red-600" aria-hidden="true">*</span></label>
                <input id="startDate" type="date" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-required="true" aria-describedby="startDateHelp startDateError">
                <p id="startDateHelp" class="text-xs text-gray-600 mt-1">The date you start counting from (ISO format).</p>
                <p id="startDateError" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>
              <div>
                <label for="startTime" class="block text-sm font-medium text-gray-800">Start Time <span class="text-red-600" aria-hidden="true">*</span></label>
                <input id="startTime" type="time" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-required="true" aria-describedby="startTimeError">
                <p id="startTimeError" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>
              <div>
                <div class="flex items-center justify-between">
                  <label for="timeZone" class="block text-sm font-medium text-gray-800">Time Zone <span class="text-red-600" aria-hidden="true">*</span></label>
                  <button type="button" class="no-print text-sm underline" data-tooltip="tz-tip" aria-expanded="false" aria-controls="tz-tip">?</button>
                </div>
                <select id="timeZone" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-required="true" aria-describedby="tz-tip timeZoneError">
                  <!-- A curated subset of common IANA TZ IDs -->
                  <option value="Europe/Rome">Europe/Rome (CET/CEST)</option>
                  <option value="UTC">UTC</option>
                  <option value="Europe/London">Europe/London</option>
                  <option value="Europe/Berlin">Europe/Berlin</option>
                  <option value="America/New_York">America/New_York</option>
                  <option value="America/Chicago">America/Chicago</option>
                  <option value="America/Denver">America/Denver</option>
                  <option value="America/Los_Angeles">America/Los_Angeles</option>
                  <option value="Asia/Dubai">Asia/Dubai</option>
                  <option value="Asia/Kolkata">Asia/Kolkata</option>
                  <option value="Asia/Tokyo">Asia/Tokyo</option>
                  <option value="Australia/Sydney">Australia/Sydney</option>
                </select>
                <div id="tz-tip" class="tooltip-panel" role="region" aria-live="polite">
                  The time zone is used to interpret your start date/time and to display results across regions. Output also includes your device’s local time for comparison.
                </div>
                <p id="timeZoneError" class="text-xs text-red-700 mt-1 hidden"></p>
              </div>
            </div>

            <!-- Offset -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="px-2 text-sm font-semibold text-gray-800">Time to Add</legend>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label for="offsetQty" class="block text-sm font-medium text-gray-800">Quantity <span class="text-red-600" aria-hidden="true">*</span></label>
                  <input id="offsetQty" type="number" step="1" min="0" value="3" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-required="true" aria-describedby="offsetQtyError">
                  <p id="offsetQtyError" class="text-xs text-red-700 mt-1 hidden"></p>
                </div>
                <div>
                  <label for="offsetUnit" class="block text-sm font-medium text-gray-800">Unit</label>
                  <select id="offsetUnit" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="minutes">Minutes</option>
                    <option value="hours">Hours</option>
                    <option value="days" selected>Days</option>
                    <option value="weeks">Weeks</option>
                    <option value="months">Months</option>
                  </select>
                </div>
                <div>
                  <label for="meetingDuration" class="block text-sm font-medium text-gray-800">Meeting Duration (min)</label>
                  <input id="meetingDuration" type="number" step="5" min="0" value="60" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-describedby="meetingDurationHelp">
                  <p id="meetingDurationHelp" class="text-xs text-gray-600 mt-1">Used to compute end time & ICS summary.</p>
                </div>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                <div>
                  <label for="bufferBefore" class="block text-sm font-medium text-gray-800">Buffer Before (min)</label>
                  <input id="bufferBefore" type="number" step="5" min="0" value="0" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-describedby="bufferBeforeHelp">
                  <p id="bufferBeforeHelp" class="text-xs text-gray-600 mt-1">Time added before the appointment for prep/travel.</p>
                </div>
                <div>
                  <label for="bufferAfter" class="block text-sm font-medium text-gray-800">Buffer After (min)</label>
                  <input id="bufferAfter" type="number" step="5" min="0" value="0" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </fieldset>

            <!-- Business rules -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="px-2 text-sm font-semibold text-gray-800">Business Rules</legend>
              <div class="flex items-center gap-3">
                <input id="businessOnly" type="checkbox" class="h-5 w-5 border-gray-400 rounded" />
                <label for="businessOnly" class="text-sm font-medium text-gray-800">Business days only</label>
                <span class="badge">Optional</span>
              </div>

              <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-2 mt-3" role="group" aria-label="Working days selector">
                <!-- Weekday checkboxes -->
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="0"><span>Sun</span></label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="1" checked><span>Mon</span></label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="2" checked><span>Tue</span></label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="3" checked><span>Wed</span></label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="4" checked><span>Thu</span></label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="5" checked><span>Fri</span></label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="weekday h-5 w-5" data-day="6"><span>Sat</span></label>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                <div>
                  <label for="workStart" class="block text-sm font-medium text-gray-800">Working Hours Start</label>
                  <input id="workStart" type="time" value="09:00" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label for="workEnd" class="block text-sm font-medium text-gray-800">Working Hours End</label>
                  <input id="workEnd" type="time" value="18:00" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-describedby="workTimeError">
                  <p id="workTimeError" class="text-xs text-red-700 mt-1 hidden"></p>
                </div>
                <div>
                  <div class="flex items-center justify-between">
                    <label for="holidays" class="block text-sm font-medium text-gray-800">Holidays</label>
                    <button type="button" class="no-print text-sm underline" data-tooltip="hol-tip" aria-expanded="false" aria-controls="hol-tip">?</button>
                  </div>
                  <textarea id="holidays" rows="3" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-describedby="hol-tip" placeholder="YYYY-MM-DD, one per line"></textarea>
                  <div id="hol-tip" class="tooltip-panel" role="region" aria-live="polite">
                    Paste holiday dates (YYYY-MM-DD), one per line. These dates will be skipped when ‘Business days only’ is enabled.
                  </div>
                </div>
              </div>
            </fieldset>

            <!-- Recurrence -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="px-2 text-sm font-semibold text-gray-800">Recurrence</legend>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label for="occurrences" class="block text-sm font-medium text-gray-800">Occurrences</label>
                  <input id="occurrences" type="number" min="1" step="1" value="1" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-describedby="occHelp">
                  <p id="occHelp" class="text-xs text-gray-600 mt-1">Set to &ge;2 to generate a series.</p>
                </div>
                <div>
                  <label for="repeatEveryQty" class="block text-sm font-medium text-gray-800">Repeat every</label>
                  <input id="repeatEveryQty" type="number" min="1" step="1" value="1" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label for="repeatEveryUnit" class="block text-sm font-medium text-gray-800">Repeat unit</label>
                  <select id="repeatEveryUnit" class="input mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="days">Days</option>
                    <option value="weeks" selected>Weeks</option>
                    <option value="months">Months</option>
                  </select>
                </div>
              </div>
            </fieldset>

            <!-- Actions -->
            <div class="flex flex-wrap gap-3 mt-2">
              <button id="calcBtn" class="btn" type="button" aria-describedby="calcHint">
                Calculate
              </button>
              <button id="icsBtn" class="btn secondary no-print" type="button" disabled aria-disabled="true" title="Export to calendar">
                Export .ics
              </button>
              <button id="printBtn" class="btn secondary no-print" type="button">Print</button>
              <p id="calcHint" class="sr-only">Press Calculate to compute appointment results and schedule.</p>
            </div>
          </section>

          <!-- Results -->
          <section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-xl p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="result-card">
                <h4>Appointment Start (selected TZ)</h4>
                <p id="rStartMain">—</p>
                <div class="text-xs text-gray-600 mt-1" id="rStartLocal">—</div>
              </div>
              <div class="result-card">
                <h4>Appointment End</h4>
                <p id="rEndMain">—</p>
                <div class="text-xs text-gray-600 mt-1" id="rEndLocal">—</div>
              </div>
              <div class="result-card">
                <h4>Total Buffers</h4>
                <p id="rBuffers">—</p>
                <div class="text-xs text-gray-600 mt-1" id="rDur">—</div>
              </div>
            </div>

            <details class="mt-6 bg-white rounded-xl">
              <summary class="font-semibold px-4 py-3 cursor-pointer">View Schedule</summary>
              <div class="mt-3 overflow-x-auto border-t border-gray-200" id="scheduleContainer">
                <table class="min-w-full text-sm">
                  <thead class="bg-gray-100 text-gray-700 uppercase">
                    <tr>
                      <th class="px-4 py-2 text-left">#</th>
                      <th class="px-4 py-2 text-left">Start (TZ)</th>
                      <th class="px-4 py-2 text-left">End (TZ)</th>
                      <th class="px-4 py-2 text-left">Start (Local)</th>
                      <th class="px-4 py-2 text-left">End (Local)</th>
                    </tr>
                  </thead>
                  <tbody id="scheduleBody"></tbody>
                </table>
              </div>
            </details>
          </section>
        </div>

        <!-- Authoritative content -->
        <article class="bg-white p-6 rounded-xl shadow-sm mt-8 prose">
          <h2>Data Source &amp; Methodology</h2>
          <p><strong>AuthoritativeDataSource:</strong> ISO 8601 (Date and time formats), IANA Time Zone Database (TZ identifiers, daylight saving rules). All calculations strictly follow the formulas and rules derived from these standards.</p>
          <ul>
            <li>ISO 8601 (latest edition) — formatting &amp; parsing of dates and times.</li>
            <li>IANA TZDB — time zone identifiers and offset transitions.</li>
          </ul>

          <h2>The Formula Explained</h2>
          <div class="formula-box">
            <p><strong>Offset addition:</strong></p>
            <p>Let \( t_0 \) be the start datetime, \( \Delta \) the offset, and \( \phi \) the recurrence step. The single appointment start is:</p>
            <p>\[
              t_1 = t_0 + \Delta
            \]</p>
            <p>If <em>business days only</em> is enabled with working-day indicator \( W(d) \in \{0,1\} \) and holiday set \( \mathcal{H} \), advance day-by-day until conditions meet:</p>
            <p>\[
              t_1' = \min \{ t \ge t_1 \mid W(\mathrm{dow}(t))=1,\ \mathrm{date}(t)\notin\mathcal{H},\ \mathrm{time}(t)\in[\tau_s,\tau_e] \}
            \]</p>
            <p>Buffers and duration:</p>
            <p>\[
              t_{\text{start}} = t_1' - b_{\text{before}}, \qquad
              t_{\text{end}} = t_1' + d + b_{\text{after}}
            \]</p>
            <p>Recurrence for occurrence \( k=0,\dots,n-1 \):</p>
            <p>\[
              t_{k} = t_{\text{start}} + k \cdot \phi,\quad
              u_{k} = t_{\text{end}} + k \cdot \phi
            \]</p>
          </div>

          <h2>Variable Glossary</h2>
          <table class="min-w-full text-sm">
            <thead><tr><th class="text-left py-1 pr-4">Variable</th><th class="text-left py-1">Meaning</th></tr></thead>
            <tbody>
              <tr><td>\( t_0 \)</td><td>Start datetime (in selected time zone).</td></tr>
              <tr><td>\( \Delta \)</td><td>Offset to add (minutes/hours/days/weeks/months).</td></tr>
              <tr><td>\( W \)</td><td>Working-day indicator for chosen weekdays.</td></tr>
              <tr><td>\( \mathcal{H} \)</td><td>Set of holiday dates to skip.</td></tr>
              <tr><td>\( \tau_s, \tau_e \)</td><td>Working hours start and end.</td></tr>
              <tr><td>\( b_{\text{before}}, b_{\text{after}} \)</td><td>Buffers before/after the appointment.</td></tr>
              <tr><td>\( d \)</td><td>Meeting duration.</td></tr>
              <tr><td>\( \phi \)</td><td>Recurrence step (days/weeks/months).</td></tr>
            </tbody>
          </table>

          <h2>How It Works: A Step-by-Step Example</h2>
          <p><strong>Goal:</strong> From <em>2025-10-27 10:00</em> in <em>Europe/Rome</em>, add <em>3 days</em>, business days only, working hours 09:00–18:00, skip holiday <em>2025-10-28</em>, duration <em>60 min</em>. No buffers. One occurrence.</p>
          <ol>
            <li>Raw offset: \( t_1 = 2025\text{-}10\text{-}30\ 10{:}00 \) (3 calendar days).</li>
            <li>Enforce business days &amp; holiday: 2025-10-28 is a holiday; the next valid working day/time at or after \( t_1 \) remains 2025-10-30 10:00 (already a Thu and within 09:00–18:00).</li>
            <li>Start = 10:00; End \(=10{:}00+60\ \text{min}=11{:}00\).</li>
          </ol>
          <p><strong>Result:</strong> Appointment on <em>Thu, 30 Oct 2025 10:00–11:00 (Europe/Rome)</em>.</p>

          <h2>Frequently Asked Questions</h2>
          <details>
            <summary>What does “business days only” enforce?</summary>
            <p>It restricts results to your selected weekdays (e.g., Mon–Fri) and skips any holiday dates you list.</p>
          </details>
          <details>
            <summary>How are months handled when adding months or setting monthly repeats?</summary>
            <p>If the target month has fewer days than the source (e.g., adding one month to Jan 31), the date clamps to the last valid day of the month.</p>
          </details>
          <details>
            <summary>Do you account for daylight saving time changes?</summary>
            <p>Yes—rendering uses the selected IANA time zone and your local device’s zone. Offsets reflect DST transitions automatically.</p>
          </details>
          <details>
            <summary>Can I export multiple appointments to my calendar?</summary>
            <p>Yes. Generate a series (Occurrences ≥ 2) and click “Export .ics” to download a multi-event calendar file.</p>
          </details>
          <details>
            <summary>What if my computed time falls outside working hours?</summary>
            <p>The time is pushed forward to the next valid working time window while respecting business days and holidays.</p>
          </details>
          <details>
            <summary>Which time zone is used for the ICS file?</summary>
            <p>Events are exported in UTC with descriptive text of the selected time zone in the summary for broad calendar compatibility.</p>
          </details>
          <details>
            <summary>Can I model prep/travel time?</summary>
            <p>Use Buffer Before/After to block time around the appointment. These are included in the “Total Buffers” metric and end time.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
            Last accuracy review: <time datetime="2025-10-27">October 27, 2025</time></p>
          </div>
        </article>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-gray-200 h-72 rounded-xl flex items-center justify-center text-gray-600">
            Ad Placement (300×600)
          </div>
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="font-bold text-lg mb-3">Why this calculator stands out</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Business-grade rules: weekdays, working hours, holidays.</li>
              <li>Time-zone robust display (selected TZ + your local).</li>
              <li>Recurring series with one-click ICS export.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="font-bold text-lg mb-3">Related planning tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-700 hover:underline" href="date-difference.html">Date Difference Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="business-days-calculator.html">Business Days Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="timezone-converter.html">Time Zone Converter</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  (function(){
    const $ = (id) => document.getElementById(id);
    const els = {
      startDate: $('startDate'),
      startTime: $('startTime'),
      timeZone: $('timeZone'),
      offsetQty: $('offsetQty'),
      offsetUnit: $('offsetUnit'),
      meetingDuration: $('meetingDuration'),
      bufferBefore: $('bufferBefore'),
      bufferAfter: $('bufferAfter'),
      businessOnly: $('businessOnly'),
      weekdays: Array.from(document.querySelectorAll('.weekday')),
      workStart: $('workStart'),
      workEnd: $('workEnd'),
      holidays: $('holidays'),
      occurrences: $('occurrences'),
      repeatEveryQty: $('repeatEveryQty'),
      repeatEveryUnit: $('repeatEveryUnit'),
      calcBtn: $('calcBtn'),
      icsBtn: $('icsBtn'),
      printBtn: $('printBtn'),
      rStartMain: $('rStartMain'),
      rStartLocal: $('rStartLocal'),
      rEndMain: $('rEndMain'),
      rEndLocal: $('rEndLocal'),
      rBuffers: $('rBuffers'),
      rDur: $('rDur'),
      scheduleBody: $('scheduleBody')
    };

    // Accessible tooltips
    document.querySelectorAll('[data-tooltip]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-tooltip');
        const panel = document.getElementById(id);
        const open = panel.classList.toggle('show');
        btn.setAttribute('aria-expanded', String(open));
      });
      btn.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); btn.click(); }
      });
    });

    // Helpers
    const pad = (n) => String(n).padStart(2,'0');
    const parseHHMM = (v) => { const [h,m] = (v||'').split(':').map(Number); return [h||0,m||0]; };
    const clampMonthDay = (y,m,d) => {
      // m: 0..11; d: 1..31 -> return valid Date with clamp to end of month
      const dt = new Date(Date.UTC(y, m, 1));
      dt.setUTCMonth(m+1, 0); // last day of month m
      const last = dt.getUTCDate();
      return Math.min(d, last);
    };
    const addMonthsClamped = (date, months) => {
      const y = date.getUTCFullYear();
      const m = date.getUTCMonth();
      const d = date.getUTCDate();
      const targetM = m + months;
      const targetY = y + Math.floor(targetM/12);
      const modM = ((targetM%12)+12)%12;
      const day = clampMonthDay(targetY, modM, d);
      const out = new Date(Date.UTC(targetY, modM, day, date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()));
      return out;
    };

    const parseHolidays = () => {
      const lines = (els.holidays.value || '').split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);
      const set = new Set(lines);
      return set; // store as YYYY-MM-DD strings in selected TZ date
    };

    const getSelectedWeekdays = () => {
      const days = new Set();
      els.weekdays.forEach(cb => { if(cb.checked) days.add(Number(cb.dataset.day)); });
      return days;
    };

    const fmtInTZ = (date, timeZone, opts={}) => {
      try {
        const fmt = new Intl.DateTimeFormat(undefined, { timeZone, ...{ year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' }, ...opts });
        return fmt.format(date);
      } catch {
        // Fallback to local if TZ invalid
        const fmt = new Intl.DateTimeFormat(undefined, { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' });
        return fmt.format(date);
      }
    };

    const fmtLocal = (date) => {
      const fmt = new Intl.DateTimeFormat(undefined, { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' });
      return fmt.format(date);
    };

    const makeUTCFromLocalTZ = (y,m,d,h,mi, tz) => {
      // Construct a Date interpreted in given IANA TZ, then get equivalent UTC Date
      // We format the desired wall time in tz, then compute the offset by formatting as parts.
      // Approach: create a Date from an ISO string WITH 'Z' after temporarily using the device zone,
      // then adjust by the tz offset computed via formatting a known UTC instant. More robust approach
      // without external libs: use Date.UTC and then correct via tz.
      const approx = new Date(Date.UTC(y,m,d,h,mi,0));
      // Get tz offset at that instant by comparing formatted hour in tz vs UTC
      const tzParts = new Intl.DateTimeFormat('en-US', { timeZone: tz, hour12:false, year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' })
        .formatToParts(approx)
        .reduce((acc,p)=>{ acc[p.type]=p.value; return acc; },{});
      const tzH = Number(tzParts.hour||'0'), tzM = Number(tzParts.minute||'0');
      const utcH = approx.getUTCHours(), utcM = approx.getUTCMinutes();
      // Compute minutes offset so that UTC + offset = tz wall clock
      let offsetMin = (tzH*60+tzM) - (utcH*60+utcM);
      // Normalize to range -720..+840 (rough DST-safe band)
      if (offsetMin > 720) offsetMin -= 1440;
      if (offsetMin < -720) offsetMin += 1440;
      // Apply inverse to get UTC instant corresponding to tz wall time
      const utcMs = approx.getTime() - offsetMin*60*1000;
      return new Date(utcMs);
    };

    const isHolidayTZDate = (dateUTC, tz, holidaySet) => {
      // Compare YYYY-MM-DD in the selected TZ
      const parts = new Intl.DateTimeFormat('en-CA', { timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit' }).format(dateUTC);
      // en-CA yields YYYY-MM-DD
      return holidaySet.has(parts);
    };

    const getTZWeekday = (dateUTC, tz) => {
      // 0..6 Sunday..Saturday in selected TZ
      const s = new Intl.DateTimeFormat('en-US', { timeZone: tz, weekday:'short' }).format(dateUTC);
      // Map short to number
      const map = {Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6};
      return map[s] ?? dateUTC.getUTCDay(); // fallback
    };

    const setTimeInTZ = (dateUTC, tz, hh, mm) => {
      // Returns new UTC Date representing same calendar date in tz at hh:mm
      const ymd = new Intl.DateTimeFormat('en-CA', { timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit' }).format(dateUTC).split('-').map(Number);
      const [y, mo, d] = ymd; // mo is 01..12
      return makeUTCFromLocalTZ(y, mo-1, d, hh, mm, tz);
    };

    const pushToWorkingWindow = (dateUTC, tz, workStart, workEnd) => {
      // If time < start -> set to start; if >= end -> move to next day at start
      const [wsH, wsM] = parseHHMM(workStart), [weH, weM] = parseHHMM(workEnd);
      const atStart = setTimeInTZ(dateUTC, tz, wsH, wsM);
      const atEnd   = setTimeInTZ(dateUTC, tz, weH, weM);
      if (dateUTC < atStart) return atStart;
      if (dateUTC >= atEnd) {
        // next day at start
        const nextDay = new Date(atStart.getTime() + 24*3600*1000);
        return nextDay;
      }
      return dateUTC;
    };

    const addBasic = (dateUTC, qty, unit) => {
      const d = new Date(dateUTC.getTime());
      if (unit === 'minutes') { d.setUTCMinutes(d.getUTCMinutes() + qty); }
      else if (unit === 'hours') { d.setUTCHours(d.getUTCHours() + qty); }
      else if (unit === 'days') { d.setUTCDate(d.getUTCDate() + qty); }
      else if (unit === 'weeks') { d.setUTCDate(d.getUTCDate() + 7*qty); }
      else if (unit === 'months') { return addMonthsClamped(d, qty); }
      return d;
    };

    const nextBusinessCandidate = (dateUTC, tz, workingDays, holidays, workStart, workEnd) => {
      let cur = new Date(dateUTC.getTime());
      while (true) {
        const dow = getTZWeekday(cur, tz);
        if (!workingDays.has(dow)) {
          // move to next day at workStart
          cur = setTimeInTZ(new Date(cur.getTime()+24*3600*1000), tz, ...parseHHMM(workStart));
          continue;
        }
        if (isHolidayTZDate(cur, tz, holidays)) {
          cur = setTimeInTZ(new Date(cur.getTime()+24*3600*1000), tz, ...parseHHMM(workStart));
          continue;
        }
        // Ensure inside working window
        cur = pushToWorkingWindow(cur, tz, workStart, workEnd);
        // Re-check that pushing didn't cross to invalid day
        const dow2 = getTZWeekday(cur, tz);
        if (!workingDays.has(dow2) || isHolidayTZDate(cur, tz, holidays)) {
          cur = setTimeInTZ(new Date(cur.getTime()+24*3600*1000), tz, ...parseHHMM(workStart));
          continue;
        }
        return cur;
      }
    };

    const validate = () => {
      let ok = true;
      const showErr = (id, msg) => { const el = document.getElementById(id); if(!el) return; el.textContent = msg || ''; el.classList.toggle('hidden', !msg); if (msg) ok=false; };

      // Required date/time
      showErr('startDateError', els.startDate.value ? '' : 'Please provide a valid start date (YYYY-MM-DD).');
      showErr('startTimeError', els.startTime.value ? '' : 'Please provide a valid start time (HH:MM).');
      // Offset qty
      const qty = Number(els.offsetQty.value);
      showErr('offsetQtyError', (isNaN(qty) || qty < 0) ? 'Quantity must be a number ≥ 0.' : '');
      // Work hours
      const [wsH, wsM] = parseHHMM(els.workStart.value);
      const [weH, weM] = parseHHMM(els.workEnd.value);
      const wsTot = wsH*60+wsM, weTot = weH*60+weM;
      showErr('workTimeError', weTot <= wsTot ? 'Working hours end must be after start.' : '');
      return ok;
    };

    const compute = () => {
      if (!validate()) { return { rows: [] }; }

      // Parse inputs
      const tz = els.timeZone.value || 'UTC';
      const [stH, stM] = parseHHMM(els.startTime.value);
      const startParts = (els.startDate.value || '').split('-').map(Number);
      const t0UTC = makeUTCFromLocalTZ(startParts[0], startParts[1]-1, startParts[2], stH, stM, tz);

      const qty = Number(els.offsetQty.value||0);
      const unit = els.offsetUnit.value;
      const durMin = Math.max(0, Number(els.meetingDuration.value||0));
      const bBefore = Math.max(0, Number(els.bufferBefore.value||0));
      const bAfter = Math.max(0, Number(els.bufferAfter.value||0));
      const business = els.businessOnly.checked;
      const workStart = els.workStart.value || '09:00';
      const workEnd = els.workEnd.value || '18:00';
      const holidays = parseHolidays();
      const workingDays = getSelectedWeekdays();
      const occ = Math.max(1, Number(els.occurrences.value||1));
      const repQty = Math.max(1, Number(els.repeatEveryQty.value||1));
      const repUnit = els.repeatEveryUnit.value;

      // Base t1 = t0 + Δ
      let t1 = addBasic(t0UTC, qty, unit);

      // Enforce business day/time if requested
      if (business) {
        t1 = nextBusinessCandidate(t1, tz, workingDays, holidays, workStart, workEnd);
      }

      // Core appointment anchor (without buffers)
      const startAnchor = new Date(t1.getTime());
      const endAnchor = new Date(startAnchor.getTime() + durMin*60*1000);

      // Buffers adjust total block (but keep anchor for display)
      const totalStart = new Date(startAnchor.getTime() - bBefore*60*1000);
      const totalEnd = new Date(endAnchor.getTime() + bAfter*60*1000);

      // Recurrence
      const rows = [];
      let curStart = startAnchor, curEnd = endAnchor, curTStart = totalStart, curTEnd = totalEnd;

      for (let k=0; k<occ; k++) {
        // Push each occurrence into business window again if needed
        let aStart = curStart, aEnd = curEnd, tStart = curTStart, tEnd = curTEnd;
        if (business) {
          aStart = nextBusinessCandidate(aStart, tz, workingDays, holidays, workStart, workEnd);
          // Shift ends to preserve duration from (possibly moved) start
          aEnd = new Date(aStart.getTime() + durMin*60*1000);
          tStart = new Date(aStart.getTime() - bBefore*60*1000);
          tEnd = new Date(aEnd.getTime() + bAfter*60*1000);
        }

        rows.push({ idx:k+1, start:aStart, end:aEnd, tstart:tStart, tend:tEnd });

        // Advance by recurrence
        if (repUnit === 'months') {
          curStart = addMonthsClamped(curStart, repQty);
          curEnd   = addMonthsClamped(curEnd,   repQty);
          curTStart= addMonthsClamped(curTStart,repQty);
          curTEnd  = addMonthsClamped(curTEnd,  repQty);
        } else {
          const stepMs = repUnit==='weeks' ? repQty*7*24*3600*1000 : repQty*24*3600*1000;
          curStart = new Date(curStart.getTime()+stepMs);
          curEnd   = new Date(curEnd.getTime()  +stepMs);
          curTStart= new Date(curTStart.getTime()+stepMs);
          curTEnd  = new Date(curTEnd.getTime()  +stepMs);
        }
      }

      // Update top summary with first row
      if (rows.length) {
        const first = rows[0];
        els.rStartMain.textContent = fmtInTZ(first.start, tz);
        els.rStartLocal.textContent = 'Local: ' + fmtLocal(first.start);
        els.rEndMain.textContent = fmtInTZ(first.end, tz);
        els.rEndLocal.textContent = 'Local: ' + fmtLocal(first.end);
        const totalBuf = bBefore + bAfter;
        els.rBuffers.textContent = totalBuf + ' min';
        els.rDur.textContent = 'Duration: ' + durMin + ' min';
      } else {
        els.rStartMain.textContent = els.rEndMain.textContent = '—';
        els.rStartLocal.textContent = els.rEndLocal.textContent = '—';
        els.rBuffers.textContent = els.rDur.textContent = '—';
      }

      // Populate table
      els.scheduleBody.innerHTML = '';
      const frag = document.createDocumentFragment();
      rows.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-2">${r.idx}</td>
          <td class="px-4 py-2">${fmtInTZ(r.start, tz)}</td>
          <td class="px-4 py-2">${fmtInTZ(r.end, tz)}</td>
          <td class="px-4 py-2">${fmtLocal(r.start)}</td>
          <td class="px-4 py-2">${fmtLocal(r.end)}</td>
        `;
        frag.appendChild(tr);
      });
      els.scheduleBody.appendChild(frag);

      // Enable ICS export if we have rows
      els.icsBtn.disabled = rows.length === 0;
      els.icsBtn.setAttribute('aria-disabled', rows.length === 0 ? 'true' : 'false');

      return { rows, tz, durMin };
    };

    // Inline validation on blur
    ['startDate','startTime','offsetQty','workEnd','workStart'].forEach(id=>{
      const el = $(id);
      el.addEventListener('blur', validate);
    });

    els.calcBtn.addEventListener('click', compute);
    els.printBtn.addEventListener('click', () => window.print());

    // ICS export
    els.icsBtn.addEventListener('click', () => {
      const { rows, tz } = compute();
      if (!rows.length) return;

      const esc = (s) => String(s||'').replace(/([,;])/g, '\\$1').replace(/\n/g, '\\n');
      const toICSDate = (d) => {
        // Export as UTC (Z)
        const y = d.getUTCFullYear();
        const m = pad(d.getUTCMonth()+1);
        const da = pad(d.getUTCDate());
        const h = pad(d.getUTCHours());
        const mi = pad(d.getUTCMinutes());
        const s = pad(d.getUTCSeconds());
        return `${y}${m}${da}T${h}${mi}${s}Z`;
      };
      const now = new Date();
      const prodId = '-//CalcDomain//Appointment Calculator//EN';
      let ics = 'BEGIN:VCALENDAR\r\nVERSION:2.0\r\nCALSCALE:GREGORIAN\r\nPRODID:'+prodId+'\r\n';
      rows.forEach((r, idx) => {
        const uid = `appt-${now.getTime()}-${idx}@calcdomain.com`;
        const dtstamp = toICSDate(now);
        const dtstart = toICSDate(r.start);
        const dtend   = toICSDate(r.end);
        const summary = esc(`Appointment (${tz})`);
        ics += 'BEGIN:VEVENT\r\n';
        ics += `UID:${uid}\r\nDTSTAMP:${dtstamp}\r\nDTSTART:${dtstart}\r\nDTEND:${dtend}\r\nSUMMARY:${summary}\r\n`;
        ics += 'END:VEVENT\r\n';
      });
      ics += 'END:VCALENDAR\r\n';

      const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'appointments.ics';
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    // Set sensible defaults
    (function initDefaults(){
      // Default TZ: try detect Europe/Rome if available in list
      try {
        const sysTZ = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
        if ([...els.timeZone.options].some(o => o.value === sysTZ)) {
          els.timeZone.value = sysTZ;
        } else {
          els.timeZone.value = 'Europe/Rome';
        }
      } catch { els.timeZone.value = 'Europe/Rome'; }
      // Default start date/time: today 09:00
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = pad(now.getMonth()+1);
      const dd = pad(now.getDate());
      els.startDate.value = `${yyyy}-${mm}-${dd}`;
      els.startTime.value = '09:00';
    })();

  })();
  </script>
</body>
</html>
