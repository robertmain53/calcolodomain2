<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time Zone Calculator — Convert & Compare World Times</title>
  <meta name="description" content="Instantly convert a date & time between multiple time zones, compare ‘yesterday/today/tomorrow’, view UTC offsets and daylight saving effects. Accessible, mobile-first, and fast." />
  <link rel="canonical" href="https://calcdomain.com/time-zone-calculator.html" />

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MathJax for LaTeX rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root { --ring:#2563eb; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', 'Segoe UI Symbol', sans-serif; }
    .prose { max-width: 70ch; }
    .focusable:focus { outline: 3px solid var(--ring); outline-offset: 2px; }
    .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:8px;padding:1rem;overflow-x:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .result-minh{ min-height: 220px; } /* Prevent CLS when results populate */
    .kbd{border:1px solid #d1d5db;border-bottom-width:2px;border-radius:.375rem;padding:.125rem .375rem;font-size:.8125rem;background:#f9fafb}
    @media print{
      header,aside,.no-print{display:none!important}
      main{padding:0}
      #print-section{position:absolute;left:0;top:0;width:100%}
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Time Zone Calculator",
    "url":"https://calcdomain.com/time-zone-calculator.html",
    "inLanguage":"en",
    "description":"Convert a date & time between multiple time zones with DST awareness and UTC offsets.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Everyday Life","item":"https://calcdomain.com/lifestyle-everyday.html"},
      {"@type":"ListItem","position":3,"name":"Time and Date","item":"https://calcdomain.com/subcategories/time-date.html"},
      {"@type":"ListItem","position":4,"name":"Time Zone Calculator","item":"https://calcdomain.com/time-zone-calculator.html"}
    ]
  }
  </script>
  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to convert times across time zones",
    "description":"Select a source date/time and time zone, add target time zones, and compare results.",
    "step":[
      {"@type":"HowToStep","name":"Enter date and time","text":"Use the date and time pickers to set the source moment."},
      {"@type":"HowToStep","name":"Choose the source time zone","text":"Pick the time zone the source time occurs in."},
      {"@type":"HowToStep","name":"Add target time zones","text":"Add one or more target zones you want to compare."},
      {"@type":"HowToStep","name":"Review results","text":"See converted times, UTC offsets, and day changes (yesterday/today/tomorrow)."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-10">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Main content -->
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="lifestyle-everyday.html" class="hover:text-blue-600">Lifestyle &amp; Everyday Life</a> &raquo;
          <a href="subcategories/time-date.html" class="hover:text-blue-600">Time and date</a> &raquo;
          <span class="text-gray-900">Time Zone Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
          <h1 class="text-3xl font-extrabold text-gray-900 mb-2">time zone calculator</h1>
          <p class="text-gray-700 mb-6">
            Convert any date and time from a source time zone to multiple target zones at once. Perfect for scheduling global meetings,
            travel planning, broadcast releases, or support handoffs.
          </p>

          <!-- CALCULATOR -->
          <section id="calculator" class="space-y-6" aria-labelledby="calculator-title">
            <h2 id="calculator-title" class="sr-only">Time Zone Conversion Inputs</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Date -->
              <div>
                <label for="srcDate" class="block text-sm font-medium text-gray-800">Date <span aria-hidden="true" class="text-red-600">*</span></label>
                <div class="flex items-center gap-2">
                  <input type="date" id="srcDate" required aria-required="true" aria-describedby="dateHelp dateErr"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focusable"
                  />
                  <button type="button" id="btnToday" class="px-3 py-2 rounded-md border bg-gray-50 hover:bg-gray-100 focusable" aria-label="Use today's date">Today</button>
                </div>
                <p id="dateHelp" class="text-xs text-gray-600 mt-1">The calendar date in the source time zone.</p>
                <p id="dateErr" class="text-sm text-red-600 mt-1 hidden"></p>
              </div>

              <!-- Time -->
              <div>
                <label for="srcTime" class="block text-sm font-medium text-gray-800">Time <span aria-hidden="true" class="text-red-600">*</span></label>
                <div class="flex items-center gap-2">
                  <input type="time" id="srcTime" required aria-required="true" aria-describedby="timeHelp timeErr"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focusable" />
                  <button type="button" id="btnNow" class="px-3 py-2 rounded-md border bg-gray-50 hover:bg-gray-100 focusable" aria-label="Use current time">Now</button>
                </div>
                <p id="timeHelp" class="text-xs text-gray-600 mt-1">24-hour format (e.g., 09:30, 18:05).</p>
                <p id="timeErr" class="text-sm text-red-600 mt-1 hidden"></p>
              </div>

              <!-- Source TZ -->
              <div class="md:col-span-2">
                <div class="flex items-center justify-between">
                  <label for="srcZone" class="block text-sm font-medium text-gray-800">Source time zone <span aria-hidden="true" class="text-red-600">*</span></label>
                  <div class="text-xs text-gray-600">
                    Press <span class="kbd">/</span> to search
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <select id="srcZone" aria-required="true" aria-describedby="srcZoneHelp srcZoneErr"
                          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focusable"></select>
                  <button id="btnDetect" type="button" class="px-3 py-2 rounded-md border bg-gray-50 hover:bg-gray-100 focusable">Use my zone</button>
                  <button id="btnSwap" type="button" class="px-3 py-2 rounded-md border bg-gray-50 hover:bg-gray-100 focusable" aria-label="Swap first target with source">Swap</button>
                </div>
                <p id="srcZoneHelp" class="text-xs text-gray-600 mt-1">Choose the time zone the input date/time belongs to.</p>
                <p id="srcZoneErr" class="text-sm text-red-600 mt-1 hidden"></p>
              </div>
            </div>

            <!-- Targets -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold text-gray-900">Target time zones</h3>
                <div class="flex items-center gap-2">
                  <button id="btnAddTarget" type="button" class="px-3 py-2 rounded-md border bg-white hover:bg-gray-100 focusable">Add target</button>
                  <button id="btnClearTargets" type="button" class="px-3 py-2 rounded-md border bg-white hover:bg-gray-100 focusable">Clear</button>
                </div>
              </div>
              <div id="targets" class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3" aria-live="polite" aria-relevant="additions removals"></div>
              <p class="text-xs text-gray-600 mt-2">Tip: include UTC, your colleague’s zone, and the event location to spot ideal overlaps.</p>
            </div>

            <!-- Accessible tooltip example -->
            <div class="text-sm text-gray-700">
              <button id="btnShowDST" type="button" class="underline text-blue-700 focusable" aria-controls="dstTip" aria-expanded="false">What about DST?</button>
              <span id="dstTip" class="hidden ml-2 text-gray-700" role="note">
                Conversions use the IANA Time Zone Database to account for historical and future daylight saving rules where available.
              </span>
            </div>
          </section>

          <!-- RESULTS -->
          <section id="results" class="mt-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-3">Results</h2>
            <div class="result-minh bg-blue-50 border border-blue-100 rounded-lg p-4">
              <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4" role="region" aria-live="polite"></div>
              <div id="emptyState" class="text-sm text-gray-700">Add at least one target time zone to see conversions.</div>
            </div>

            <details class="mt-6 bg-white rounded-lg border border-gray-200">
              <summary class="font-semibold px-4 py-3 cursor-pointer">Week-at-a-glance (same time across next 7 days)</summary>
              <div id="weekTableWrap" class="overflow-x-auto">
                <table class="min-w-full text-sm">
                  <thead class="bg-gray-100 text-gray-700">
                    <tr id="weekHead"></tr>
                  </thead>
                  <tbody id="weekBody"></tbody>
                </table>
              </div>
            </details>
          </section>
        </div>

        <!-- Author / Review -->
        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>Authoritative data source &amp; methodology</h2>
          <p><strong>Primary source:</strong> IANA Time Zone Database (tzdb), maintained by the Internet Assigned Numbers Authority (IANA). Latest release and historical DST rules are applied by your browser’s implementation of
            <code>Intl.DateTimeFormat</code>. See the official project page and releases.</p>
          <ul>
            <li><a class="text-blue-700 underline" href="https://www.iana.org/time-zones" rel="noopener">IANA Time Zone Database</a> (tzdb)</li>
            <li><a class="text-blue-700 underline" href="https://tc39.es/ecma402/#sec-intl-datetimeformat-constructor" rel="noopener">ECMA-402 Intl.DateTimeFormat</a></li>
            <li><a class="text-blue-700 underline" href="https://www.iso.org/iso-8601-date-and-time-format.html" rel="noopener">ISO&nbsp;8601 date and time</a></li>
          </ul>
          <p><em>“Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.”</em></p>

          <h2>The formula explained</h2>
          <div class="formula-box">
            \[
              t_{\text{target}} \;=\; t_{\text{source}} \;+\; \Delta_{\text{UTC}}(\text{target},\, t) \;-\; \Delta_{\text{UTC}}(\text{source},\, t)
            \]
            where \(\Delta_{\text{UTC}}(z, t)\) is the UTC offset (including DST) for time zone \(z\) at instant \(t\).
          </div>

          <h2>Glossary of variables</h2>
          <ul>
            <li><strong>\(t_{\text{source}}\)</strong>: the input wall-clock date and time in the source zone.</li>
            <li><strong>\(t_{\text{target}}\)</strong>: the resulting wall-clock date and time in the target zone.</li>
            <li><strong>\(\Delta_{\text{UTC}}(z, t)\)</strong>: total offset from UTC (e.g., +02:00) for zone <em>z</em> at instant <em>t</em>, accounting for DST.</li>
          </ul>

          <h2>How it works: a step-by-step example</h2>
          <p>Suppose it’s <strong>2025-10-27 09:00</strong> in <strong>Europe/Rome</strong>. Add targets <em>UTC</em> and <em>America/New_York</em>.</p>
          <ol>
            <li>Find the UTC instant corresponding to 2025-10-27 09:00 Europe/Rome using tzdb rules.</li>
            <li>Apply each target’s offset at that instant. If New York observes DST then, its offset is \(-04{:}00\); Rome is \(+01{:}00\) or \(+02{:}00\) depending on DST.</li>
            <li>Compute \(t_{\text{target}}\) for each zone and label yesterday/today/tomorrow relative to the source date.</li>
          </ol>

          <h2>FAQ</h2>
          <details><summary>Does this handle daylight saving time (DST)?</summary><p>Yes. Offsets are read from your browser’s tzdb implementation, which includes historical and future DST transitions.</p></details>
          <details><summary>Why do I see different abbreviations (PDT, PST, CET)?</summary><p>Abbreviations vary by date and region. We show a short time-zone name from the browser (e.g., GMT-7 or PDT) for clarity.</p></details>
          <details><summary>What if my browser lacks a specific time zone?</summary><p>Older browsers may have a reduced tz set. You can still type or select common zones; unsupported ones are hidden.</p></details>
          <details><summary>Is this precise around DST change hours?</summary><p>Ambiguous or skipped times around transitions are resolved using the platform rules. The calculator runs a two-pass alignment to improve accuracy.</p></details>
          <details><summary>Can I export or print?</summary><p>Use your browser’s print function. The page is optimized for clean printing.</p></details>
          <details><summary>What about leap seconds?</summary><p>Consumer systems typically ignore leap seconds; conversions use civil time (UTC) as provided by the OS/browser.</p></details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
            Last accuracy review: <time datetime="2025-10-27">October 27, 2025</time></p>
          </div>
        </article>
      </section>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6 no-print">
          <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-600">Ad Placement (300×600)</div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-3">Why use this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Compare multiple time zones at once.</li>
              <li>See UTC offsets and DST effects clearly.</li>
              <li>Keyboard-friendly and screen-reader accessible.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related everyday tools</h3>
            <ul class="space-y-3 text-sm">
              <li><a class="text-blue-600 hover:underline" href="date-difference-calculator.html">Date Difference Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="meeting-time-finder.html">Meeting Time Finder</a></li>
              <li><a class="text-blue-600 hover:underline" href="countdown-timer.html">Countdown Timer</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic -->
  <script defer>
  (function(){
    const qs = (s, r=document) => r.querySelector(s);
    const qsa = (s, r=document) => Array.from(r.querySelectorAll(s));
    const el = {
      date: qs('#srcDate'),
      time: qs('#srcTime'),
      srcZone: qs('#srcZone'),
      targets: qs('#targets'),
      resultsGrid: qs('#resultsGrid'),
      emptyState: qs('#emptyState'),
      weekHead: qs('#weekHead'),
      weekBody: qs('#weekBody'),
      btnToday: qs('#btnToday'),
      btnNow: qs('#btnNow'),
      btnDetect: qs('#btnDetect'),
      btnSwap: qs('#btnSwap'),
      btnAddTarget: qs('#btnAddTarget'),
      btnClearTargets: qs('#btnClearTargets'),
      dstBtn: qs('#btnShowDST'),
      dstTip: qs('#dstTip'),
      dateErr: qs('#dateErr'),
      timeErr: qs('#timeErr'),
      srcZoneErr: qs('#srcZoneErr'),
    };

    // --- Utilities ---
    const pad = n => String(n).padStart(2, '0');

    function getSupportedZones(){
      if (typeof Intl.supportedValuesOf === 'function') {
        try { return Intl.supportedValuesOf('timeZone'); } catch(e){}
      }
      // Fallback minimal set
      return [
        'UTC','Europe/London','Europe/Rome','Europe/Paris','Europe/Berlin','America/New_York','America/Los_Angeles',
        'America/Chicago','America/Sao_Paulo','Asia/Tokyo','Asia/Shanghai','Asia/Kolkata','Australia/Sydney','Pacific/Auckland'
      ];
    }

    function localZone(){ return Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC'; }

    function fmtWithZone(epochMs, timeZone){
      const fmt = new Intl.DateTimeFormat(undefined, {
        timeZone, year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', hour12:false, timeZoneName:'short'
      });
      const parts = Object.fromEntries(fmt.formatToParts(new Date(epochMs)).map(p=>[p.type,p.value]));
      return {
        label: `${parts.year}-${parts.month}-${parts.day} ${parts.hour}:${parts.minute}`,
        tzName: parts.timeZoneName
      };
    }

    function getOffsetMinutes(epochMs, timeZone){
      // Returns UTC offset in minutes for the given instant in zone
      const fmt = new Intl.DateTimeFormat('en-US', {
        timeZone, year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
      });
      const parts = Object.fromEntries(fmt.formatToParts(new Date(epochMs)).map(p=>[p.type,p.value]));
      // Construct the same formatted local time as if it were UTC to compute offset
      const asUTC = Date.UTC(+parts.year, +parts.month-1, +parts.day, +parts.hour, +parts.minute, +parts.second);
      return (asUTC - epochMs) / 60000;
    }

    function wallTimeToUTCInstant(y, m, d, hh, mm, timeZone){
      // Two-pass alignment to resolve DST ambiguities
      // Start with a naive UTC guess equal to the wall time components
      let guess = Date.UTC(y, m-1, d, hh, mm);
      let off = getOffsetMinutes(guess, timeZone);
      let utc = Date.UTC(y, m-1, d, hh, mm) - off*60000;
      // Second pass
      off = getOffsetMinutes(utc, timeZone);
      return Date.UTC(y, m-1, d, hh, mm) - off*60000;
    }

    function parseDateTimeInputs(){
      const dateVal = el.date.value;
      const timeVal = el.time.value;
      if(!dateVal) return {error:'date'};
      if(!timeVal) return {error:'time'};
      const [Y,M,D] = dateVal.split('-').map(Number);
      const [h,mi] = timeVal.split(':').map(Number);
      return {Y,M,D,h,mi};
    }

    function relativeDayLabel(srcEpoch, targetEpoch, srcZoneId){
      // Compare calendar date in source zone
      const srcParts = fmtWithZone(srcEpoch, srcZoneId); // label contains YYYY-MM-DD
      const [sY,sM,sD] = srcParts.label.slice(0,10).split('-').map(Number);
      const tPartsInSrc = new Intl.DateTimeFormat(undefined, {
        timeZone: srcZoneId, year:'numeric', month:'2-digit', day:'2-digit'
      }).formatToParts(new Date(targetEpoch));
      const tp = Object.fromEntries(tPartsInSrc.map(p=>[p.type,p.value]));
      const tY=+tp.year, tM=+tp.month, tD=+tp.day;

      const srcDate = new Date(Date.UTC(sY, sM-1, sD));
      const tgtDate = new Date(Date.UTC(tY, tM-1, tD));
      const diffDays = Math.round((tgtDate - srcDate)/86400000);
      return diffDays===0 ? 'today' : diffDays===-1 ? 'yesterday' : diffDays===1 ? 'tomorrow' :
             diffDays>1 ? `in ${diffDays} days` : `${Math.abs(diffDays)} days ago`;
    }

    function createTargetRow(value){
      const wrapper = document.createElement('div');
      wrapper.className = 'flex items-center gap-2';
      const sel = document.createElement('select');
      sel.className = 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focusable';
      sel.setAttribute('aria-label','Target time zone');
      populateZones(sel);
      if (value) sel.value = value;
      const del = document.createElement('button');
      del.type='button';
      del.className='px-3 py-2 rounded-md border bg-white hover:bg-gray-100 focusable';
      del.textContent='Remove';
      del.addEventListener('click', () => { wrapper.remove(); compute(); });
      wrapper.appendChild(sel);
      wrapper.appendChild(del);
      // react to change
      sel.addEventListener('change', compute);
      return wrapper;
    }

    function populateZones(selectEl){
      const zones = getSupportedZones();
      // Pin some popular zones on top
      const pinned = ['UTC', localZone(), 'Europe/London','Europe/Rome','America/New_York','America/Los_Angeles','Asia/Tokyo','Australia/Sydney'];
      const uniqPinned = Array.from(new Set(pinned.filter(z=>zones.includes(z))));
      const other = zones.filter(z=>!uniqPinned.includes(z));
      const frag = document.createDocumentFragment();
      const group1 = document.createElement('optgroup'); group1.label='Common';
      uniqPinned.forEach(z=>{ const o=document.createElement('option'); o.value=o.textContent=z; group1.appendChild(o); });
      const group2 = document.createElement('optgroup'); group2.label='All time zones';
      other.forEach(z=>{ const o=document.createElement('option'); o.value=o.textContent=z; group2.appendChild(o); });
      selectEl.innerHTML='';
      selectEl.appendChild(group1);
      selectEl.appendChild(group2);
    }

    // --- Initialization ---
    populateZones(el.srcZone);

    // Defaults
    (function setDefaults(){
      const now = new Date();
      el.date.value = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
      el.time.value = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
      // Seed targets
      ['UTC','America/New_York', localZone()].forEach(z => el.targets.appendChild(createTargetRow(z)));
      el.emptyState.classList.add('hidden');
      compute();
    })();

    // --- Accessible tooltip toggle ---
    el.dstBtn.addEventListener('click', ()=>{
      const open = el.dstTip.classList.toggle('hidden') === false;
      el.dstBtn.setAttribute('aria-expanded', String(open));
    });

    // --- Buttons ---
    el.btnToday.addEventListener('click', ()=>{
      const now = new Date();
      el.date.value = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
      compute();
    });
    el.btnNow.addEventListener('click', ()=>{
      const now = new Date();
      el.time.value = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
      compute();
    });
    el.btnDetect.addEventListener('click', ()=>{
      el.srcZone.value = localZone();
      compute();
    });
    el.btnSwap.addEventListener('click', ()=>{
      const firstTargetSel = el.targets.querySelector('select');
      if(!firstTargetSel) return;
      const tmp = el.srcZone.value;
      el.srcZone.value = firstTargetSel.value;
      firstTargetSel.value = tmp;
      compute();
    });
    el.btnAddTarget.addEventListener('click', ()=>{
      if (el.targets.querySelectorAll('select').length >= 8) return;
      el.targets.appendChild(createTargetRow());
      el.emptyState.classList.add('hidden');
      compute();
    });
    el.btnClearTargets.addEventListener('click', ()=>{
      el.targets.innerHTML='';
      el.emptyState.classList.remove('hidden');
      renderResults([]);
      renderWeek([]);
    });

    // --- Validation (on blur) ---
    function showErr(node, msg){
      node.textContent = msg; node.classList.remove('hidden');
    }
    function hideErr(node){ node.textContent=''; node.classList.add('hidden'); }

    el.date.addEventListener('blur', ()=>{
      if(!el.date.value) showErr(el.dateErr,'Please select a valid date (YYYY-MM-DD).');
      else hideErr(el.dateErr);
    });
    el.time.addEventListener('blur', ()=>{
      if(!el.time.value) showErr(el.timeErr,'Please enter time in HH:MM (24-hour).');
      else hideErr(el.timeErr);
    });
    el.srcZone.addEventListener('blur', ()=>{
      if(!el.srcZone.value) showErr(el.srcZoneErr,'Please choose a source time zone.');
      else hideErr(el.srcZoneErr);
    });

    // Keyboard hint: press "/" to focus search by typing in <select>
    window.addEventListener('keydown', (e)=>{
      if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
        e.preventDefault();
        el.srcZone.focus();
      }
    });

    // Recompute on changes
    ['change','input'].forEach(evt=>{
      el.date.addEventListener(evt, compute);
      el.time.addEventListener(evt, compute);
      el.srcZone.addEventListener(evt, compute);
    });

    // --- Core compute ---
    function compute(){
      hideErr(el.dateErr); hideErr(el.timeErr); hideErr(el.srcZoneErr);
      const parsed = parseDateTimeInputs();
      if (parsed.error === 'date'){ showErr(el.dateErr,'Please select a valid date (YYYY-MM-DD).'); return; }
      if (parsed.error === 'time'){ showErr(el.timeErr,'Please enter time in HH:MM (24-hour).'); return; }
      const {Y,M,D,h,mi} = parsed;
      const srcZ = el.srcZone.value || 'UTC';

      let utc;
      try {
        utc = wallTimeToUTCInstant(Y,M,D,h,mi, srcZ);
      } catch(e){
        showErr(el.srcZoneErr, 'Your browser does not support full time-zone conversions.');
        return;
      }

      const targetSelects = qsa('select', el.targets);
      const rows = targetSelects.map(sel => {
        const zone = sel.value;
        const pretty = fmtWithZone(utc, zone);
        const offMin = getOffsetMinutes(utc, zone);
        const sign = offMin<=0 ? '+' : '-'; // because getOffsetMinutes returns (local - UTC) minutes
        const abs = Math.abs(offMin);
        const hh = pad(Math.floor(abs/60)), mm = pad(abs%60);
        const rel = relativeDayLabel(utc, utc, srcZ); // same instant; rel label computed in src zone context for target display
        const relFromSrc = relativeDayLabel(wallTimeToUTCInstant(Y,M,D,0,0,srcZ), wallTimeToUTCInstant(Y,M,D,h,mi,zone), srcZ);
        return {
          zone,
          label: pretty.label,
          tzName: pretty.tzName,
          offset: `UTC${sign}${hh}:${mm}`,
          dayShift: relFromSrc
        };
      });

      renderResults(rows);
      renderWeek(rows.map(r=>r.zone), utc, srcZ);
    }

    function renderResults(rows){
      el.resultsGrid.innerHTML='';
      if (!rows.length){ el.emptyState.classList.remove('hidden'); return; }
      el.emptyState.classList.add('hidden');
      rows.forEach(r=>{
        const card = document.createElement('div');
        card.className='bg-white border border-gray-200 rounded-lg p-4 result-card';
        card.innerHTML = `
          <div class="text-sm text-gray-500">${r.zone}</div>
          <div class="text-2xl font-bold text-blue-700 mt-1" aria-label="Converted time">${r.label}</div>
          <div class="text-sm text-gray-700 mt-1">${r.tzName} • <span class="font-mono">${r.offset}</span></div>
          <div class="text-xs mt-2 px-2 py-1 inline-block rounded bg-gray-100 text-gray-700">${r.dayShift}</div>
        `;
        el.resultsGrid.appendChild(card);
      });
    }

    function renderWeek(zones, baseUTC=Date.now(), srcZ='UTC'){
      const head = el.weekHead; const body = el.weekBody;
      head.innerHTML=''; body.innerHTML='';
      if (!zones.length) return;

      // Header
      const thEmpty = document.createElement('th');
      thEmpty.className='px-3 py-2 text-left';
      thEmpty.textContent='Zone';
      head.appendChild(thEmpty);
      for (let i=0;i<7;i++){
        const dayUTC = baseUTC + i*86400000;
        const src = fmtWithZone(dayUTC, srcZ).label.slice(0,10);
        const th = document.createElement('th');
        th.className='px-3 py-2 text-left';
        th.textContent = src;
        head.appendChild(th);
      }
      // Rows
      zones.forEach(z=>{
        const tr = document.createElement('tr');
        const tdZ = document.createElement('td'); tdZ.className='px-3 py-2 font-medium'; tdZ.textContent=z; tr.appendChild(tdZ);
        for (let i=0;i<7;i++){
          const dayUTC = baseUTC + i*86400000;
          const label = fmtWithZone(dayUTC, z).label.slice(11,16); // HH:MM
          const td = document.createElement('td'); td.className='px-3 py-2'; td.textContent=label; tr.appendChild(td);
        }
        body.appendChild(tr);
      });
    }

  })();
  </script>
</body>
</html>
