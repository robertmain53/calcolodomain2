<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<title>Debt Consolidation Calculator | Personal Loans | CalcDomain</title>
<meta content="Use our professional Debt Consolidation Calculator to compare your current debts vs. a new consolidation loan. See monthly payment changes, time-to-debt-free, and total interest savings—instantly and accurately." name="description"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Ugo Candido" name="author"/>
<link href="https://calcdomain.com/debt-consolidation.html" rel="canonical"/>
<meta content="#ffffff" name="theme-color"/>
<meta content="Debt Consolidation Calculator" property="og:title"/>
<meta content="Compare your current debt payoff vs. a consolidation loan. See monthly savings, interest savings, and time-to-debt-free." property="og:description"/>
<meta content="https://calcdomain.com/debt-consolidation.html" property="og:url"/>
<meta content="website" property="og:type"/>
<meta content="summary_large_image" name="twitter:card"/>
<!-- Global shared stylesheet + fonts -->
<link crossorigin="" href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<link href="/style.css" rel="stylesheet"/>
<!-- Minimal page-scoped CSS to mirror APR layout paddings/spacing -->
<style>
    /* container width + horizontal padding similar to APR layout */
    .container{max-width:1200px; margin-inline:auto; padding:0 16px}
    /* header grid and vertical rhythm */
    .site-header{position:static}
    .container .header-content{display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center;padding:10px 0}
    .site-logo{font-weight:700}
    .site-search{display:flex;gap:8px;align-items:center}
    .site-search input{min-height:48px;padding:10px 12px}
    .nav-toggle{min-height:48px;min-width:48px}

    /* breadcrumb + headings spacing */
    .breadcrumb{margin:12px 0;font-size:.95rem}
    h1{margin:.5rem 0 .5rem}
    h2{margin:1.25rem 0 .5rem}
    h3{margin:1rem 0 .5rem}

    /* cards and calculator blocks */
    .card{padding:16px;border-radius:12px}
    #calc-root{display:grid;gap:16px;margin-top:.5rem}
    @media (min-width: 992px){ #calc-root{grid-template-columns:1fr 1fr} }

    /* form rows & controls */
    .label-row{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .input{min-height:48px;padding:10px 14px}
    .help-btn{width:32px;height:32px;border-radius:999px}

    /* tooltips follow APR layout show/hide + small margin */
    .tooltip{display:none;margin-top:6px}
    .tooltip[aria-hidden="false"]{display:block}

    /* results section padding + inner cards spacing */
    .results{padding:16px;min-height:320px}
    .grid.grid-3-col > .card{padding:10px 12px}

    /* small utilities */
    .badge{white-space:nowrap}
    .notice{margin-top:10px}
    .site-footer{margin-top:32px}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
  </style>
<!-- JSON-LD -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Debt Consolidation Calculator",
  "url": "https://calcdomain.com/debt-consolidation.html",
  "description": "Compare your current debt payoff vs. a new consolidation loan. See monthly payment differences, time-to-debt-free, and total interest savings.",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain",
    "url": "https://calcdomain.com"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How to use the Debt Consolidation Calculator",
      "description": "Enter your existing debts and the proposed consolidation loan details to see whether consolidating saves money and shortens your payoff time.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "List your current debts",
          "text": "Add each debt with its current balance, APR, and your planned monthly payment."
        },
        {
          "@type": "HowToStep",
          "name": "Enter consolidation loan terms",
          "text": "Provide the new loan APR, term in months, and any origination fee. Choose whether the fee is financed or paid upfront."
        },
        {
          "@type": "HowToStep",
          "name": "Review instant results",
          "text": "Compare monthly payment, total interest, and time-to-debt-free between your current plan and the consolidation loan."
        },
        {
          "@type": "HowToStep",
          "name": "Adjust and optimize",
          "text": "Experiment with different terms or additional principal to find your best outcome."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is debt consolidation?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Debt consolidation combines multiple debts into one new loan with a single payment, ideally at a lower rate and a defined payoff date."
          }
        },
        {
          "@type": "Question",
          "name": "Does consolidating debt always save money?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Not always. Savings depend on the new APR, term length, fees, and your current payments. This calculator shows when consolidation helps or hurts."
          }
        },
        {
          "@type": "Question",
          "name": "What if my payment is less than the monthly interest?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "If a payment is below monthly interest, the balance grows (negative amortization). Increase the payment or APR terms to calculate a valid payoff."
          }
        },
        {
          "@type": "Question",
          "name": "Should I finance the origination fee?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Financing increases the principal and interest paid. Paying fees upfront usually costs less overall, if cash flow allows."
          }
        },
        {
          "@type": "Question",
          "name": "Is the calculator’s math industry standard?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. It uses standard amortization and fixed-payment formulas widely used in banking and consumer finance."
          }
        },
        {
          "@type": "Question",
          "name": "Will consolidation affect my credit score?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "It can. Opening a new account may cause a temporary dip; consistent on-time payments and reduced utilization can help over time."
          }
        }
      ]
    }
  ]
}
  </script>
<!-- MathJax -->
<script defer="" id="mathjax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="/assets/js/page-enhancements.js" as="script">

</head>
<body>
<a class="skip-link" href="#main-content">Skip to main content</a>
<!-- Header (non-sticky, shared pattern) -->

<!-- Overlay Navigation (focus-trap handles interactions) -->
<nav aria-hidden="true" aria-label="Primary" class="main-nav" id="mainNav">
<div class="nav-header">
<strong>Navigation</strong>
<button aria-label="Close menu" id="navClose">Close</button>
</div>
<ul>
<li><a href="https://calcdomain.com/finance.html">Finance</a></li>
<li><a href="https://calcdomain.com/loans.html">Loans</a></li>
<li><a href="https://calcdomain.com/converters.html">Converters</a></li>
<li><a href="https://calcdomain.com/all-calculators.html">All calculators</a></li>
</ul>
</nav>
<main aria-labelledby="page-title" class="container" id="main-content" role="main">
<h1 id="page-title">Debt Consolidation Calculator</h1>
<nav aria-label="Breadcrumb" class="breadcrumb">
<ol>
<li><a href="/">Home</a></li>
<li><a href="https://calcdomain.com/loans.html">Personal Loans</a></li>
<li aria-current="page">Debt Consolidation Calculator</li>
</ol>
</nav>
<p>
      This professional-grade calculator helps you compare paying off your existing debts as-is versus consolidating them into a new personal loan.
      Enter your balances, APRs, and payments, then set the consolidation loan terms to see monthly cash flow changes, time-to-debt-free, and total interest savings.
    </p>
<div id="calc-root">
<!-- Inputs -->
<section aria-labelledby="inputs-heading" class="card">
<h2 id="inputs-heading">Calculator Inputs</h2>
<div class="form-group">
<div class="label-row">
<label for="currency">Currency</label>
</div>
<select aria-label="Currency" class="input currency-select" id="currency">
<option selected="" value="USD">USD – $</option>
<option value="EUR">EUR – €</option>
<option value="GBP">GBP – £</option>
<option value="CAD">CAD – $</option>
<option value="AUD">AUD – $</option>
</select>
</div>
<div class="form-group">
<div class="label-row">
<label id="debts-label">Your Current Debts</label>
<button aria-controls="debts-tip" aria-expanded="false" class="help-btn" type="button">?</button>
</div>
<div aria-hidden="true" class="tooltip" id="debts-tip" role="tooltip">
            Add each debt you plan to consolidate. Use your intended monthly payment for each debt (not the minimum).
          </div>
<div aria-describedby="debts-tip" class="debts" id="debts">
<!-- Debt rows will be injected here -->
</div>
<div class="controls" style="margin-top:.5rem;display:flex;gap:8px;flex-wrap:wrap">
<button aria-label="Add a new debt row" class="btn btn-secondary" id="addDebtBtn" type="button">+ Add Debt</button>
<button aria-label="Reset all debts" class="btn" id="resetDebtsBtn" type="button">Reset</button>
</div>
</div>
<hr/>
<h3>Consolidation Loan</h3>
<div class="form-group">
<div class="label-row">
<label for="loanApr">Loan APR (%) *</label>
<button aria-controls="loanApr-tip" aria-expanded="false" class="help-btn" type="button">?</button>
</div>
<div aria-hidden="true" class="tooltip" id="loanApr-tip" role="tooltip">
            Annual Percentage Rate for the new consolidation loan. Enter the nominal APR (e.g., 9.99).
          </div>
<input aria-describedby="loanAprError loanApr-tip" aria-required="true" class="input" id="loanApr" inputmode="decimal" min="0" placeholder="e.g., 9.99" step="0.01" type="number"/>
<div aria-live="polite" class="error" id="loanAprError" role="alert"></div>
</div>
<div class="form-group">
<div class="label-row">
<label for="loanTerm">Term (months) *</label>
<button aria-controls="loanTerm-tip" aria-expanded="false" class="help-btn" type="button">?</button>
</div>
<div aria-hidden="true" class="tooltip" id="loanTerm-tip" role="tooltip">
            Total number of monthly payments for the consolidation loan (e.g., 36, 48, 60).
          </div>
<input aria-describedby="loanTermError loanTerm-tip" aria-required="true" class="input" id="loanTerm" inputmode="numeric" min="1" placeholder="e.g., 60" step="1" type="number"/>
<div aria-live="polite" class="error" id="loanTermError" role="alert"></div>
</div>
<div class="form-group">
<div class="label-row">
<label for="origFee">Origination Fee (%)</label>
<button aria-controls="origFee-tip" aria-expanded="false" class="help-btn" type="button">?</button>
</div>
<div aria-hidden="true" class="tooltip" id="origFee-tip" role="tooltip">
            Some lenders charge an upfront fee (e.g., 1–8%). Choose whether it is financed into the loan amount.
          </div>
<input aria-describedby="origFee-tip" class="input" id="origFee" inputmode="decimal" min="0" placeholder="e.g., 4" step="0.01" type="number"/>
</div>
<fieldset aria-describedby="feeModeDesc" class="form-group" style="border:1px solid var(--border-color);border-radius:10px;padding:10px">
<legend class="label-row" style="font-weight:700;margin-bottom:.4rem">Fee Handling</legend>
<div class="visually-hidden" id="feeModeDesc">Choose how the origination fee is paid</div>
<div aria-label="Fee handling mode" class="controls" role="radiogroup" style="display:flex;gap:10px;flex-wrap:wrap">
<div>
<input checked="" id="feeFinanced" name="feeMode" type="radio" value="financed"/>
<label for="feeFinanced">Financed (added to loan)</label>
</div>
<div>
<input id="feeUpfront" name="feeMode" type="radio" value="upfront"/>
<label for="feeUpfront">Paid upfront (not financed)</label>
</div>
</div>
</fieldset>
<div class="notice" role="note">
          Tip: If your new monthly payment is lower because of a longer term, consider making an extra principal amount to preserve interest savings.
        </div>
</section>
<!-- Results -->
<section aria-labelledby="results-heading" class="card results" id="results-section">
<h2 id="results-heading">Results</h2>
<!-- Shared grid/cards pattern -->
<div aria-live="polite" class="grid grid-3-col">
<div class="card">
<span class="result-label">Total Current Monthly Payments</span>
<strong class="result-value" id="currentMonthly">$0.00</strong>
</div>
<div class="card">
<span class="result-label">New Consolidation Payment</span>
<strong class="result-value" id="newMonthly">$0.00</strong>
</div>
<div class="card">
<span class="result-label">Monthly Cash Flow Change</span>
<strong class="result-value" id="monthlyDelta">$0.00</strong>
</div>
<div class="card">
<span class="result-label">Total Interest (Keep Current Plan)</span>
<strong class="result-value" id="currentInterest">$0.00</strong>
</div>
<div class="card">
<span class="result-label">Total Interest (Consolidation)</span>
<strong class="result-value" id="newInterest">$0.00</strong>
</div>
<div class="card">
<span class="result-label">Interest Savings</span>
<strong class="result-value" id="interestSavings">$0.00</strong>
</div>
<div class="card">
<span class="result-label">Time to Debt-Free (Current)</span>
<strong class="result-value" id="currentMonths">0 mo</strong>
</div>
<div class="card">
<span class="result-label">Time to Debt-Free (Consolidation)</span>
<strong class="result-value" id="newMonths">0 mo</strong>
</div>
</div>
<p class="notice" hidden="" id="resultNote"></p>
<p><span class="badge" id="totalPrincipalBadge">Total Principal: $0.00</span></p>
</section>
</div>
<section aria-labelledby="authority-heading" class="card">
<h2 id="authority-heading">Data Source and Methodology</h2>
<p>
        Authoritative source: Consumer Financial Protection Bureau (CFPB), “How credit card interest is calculated” (Updated 2024). 
        Direct link: <a href="https://www.consumerfinance.gov/ask-cfpb/how-is-credit-card-interest-calculated-en-45/" rel="noopener" target="_blank">CFPB.gov</a>.
        All amortization and payment formulas align with standard banking mathematics.
      </p>
<p><strong>All calculations strictly follow the formulas and definitions from the cited source.</strong></p>
</section>
<section aria-labelledby="formula-heading" class="card">
<h2 id="formula-heading">The Formulas Explained</h2>
<div class="formula-box">
<p><strong>Monthly rate:</strong> \( r = \frac{\text{APR}}{12 \times 100} \)</p>
<p><strong>Months to payoff (per debt):</strong> 
          if \( r &gt; 0 \): 
          \( n = \frac{-\ln\!\left(1 - \frac{rB}{P}\right)}{\ln(1+r)} \), with \( P &gt; rB \). 
          If \( r = 0 \): \( n = \frac{B}{P} \).
        </p>
<p><strong>Total interest (per debt):</strong> \( I = nP - B \)</p>
<p><strong>Consolidation payment:</strong> for loan amount \( L \), rate \( r_c \), term \( N \):
          if \( r_c &gt; 0 \): 
          \( P_c = \dfrac{L \, r_c}{1 - (1 + r_c)^{-N}} \). 
          If \( r_c = 0 \): \( P_c = \dfrac{L}{N} \).
        </p>
<p><strong>Interest (consolidation):</strong> \( I_c = NP_c - L \)</p>
<p><strong>Monthly change:</strong> \( \Delta P = \sum P_i - P_c \)</p>
<p><strong>Interest savings:</strong> \( S_I = \sum I_i - I_c - F \) where \( F \) is any fee paid upfront. If financed, \( F \) is included in \( L \).</p>
</div>
</section>
<section aria-labelledby="glossary-heading" class="card">
<h2 id="glossary-heading">Glossary of Variables</h2>
<ul>
<li>Balance (B): Current principal you owe on a debt.</li>
<li>APR: Annual Percentage Rate of the debt.</li>
<li>Monthly Payment (P): Amount you intend to pay monthly for that debt.</li>
<li>Months to Payoff (n): Time needed to fully pay the debt under P and APR.</li>
<li>Total Interest (I): Interest paid over the payoff period.</li>
<li>Loan Amount (L): Sum of balances to consolidate, plus any financed fee.</li>
<li>Consolidation Payment (Pc): Monthly payment for the new loan.</li>
<li>Term (N): Number of months in the consolidation loan.</li>
<li>Origination Fee (F): A fee charged by the lender; can be financed or paid upfront.</li>
</ul>
</section>
<section aria-labelledby="example-heading" class="card">
<h2 id="example-heading">How It Works: A Step-by-Step Example</h2>
<p><strong>Inputs</strong>:
        Debt A: B = $5,000, APR = 20%, P = $200.
        Debt B: B = $8,000, APR = 12%, P = $300.
        Consolidation: APR = 9.99%, N = 60 months, Fee = 3% (financed).
      </p>
<p>Totals: Principal = $13,000; financed fee = $390; L = $13,390.</p>
<p>Monthly rates: Debt A r = 0.20/12; Debt B r = 0.12/12; Loan r = 0.0999/12.</p>
<p>Months to payoff per debt:
        \( n_A = \dfrac{-\ln(1 - r_A B_A / P_A)}{\ln(1+r_A)} \),
        \( n_B = \dfrac{-\ln(1 - r_B B_B / P_B)}{\ln(1+r_B)} \).
        The current plan ends when the last debt finishes: \( n_{current} = \max(n_A, n_B) \).
      </p>
<p>Consolidation payment:
        \( P_c = \dfrac{L r}{1 - (1+r)^{-60}} \).
        Compare \( \sum P_i = \$500 \) vs. \( P_c \) to see monthly change. 
        Total interest saved is \( S_I = (I_A + I_B) - I_c \).</p>
<p>This mirrors the live calculator’s logic and will match results (modulo rounding).</p>
</section>
<div class="author-box" style="border-top:1px solid var(--border-color);padding-top:12px;margin-top:16px">
<p>
        Tool developed by <strong>Ugo Candido</strong>. Content verified by <strong>CalcDomain Editorial</strong>.<br/>
        Last reviewed for accuracy on: <time datetime="2025-09-12">September 12, 2025</time>.
      </p>
</div>
</main>
<!-- Standard Footer --> 
<!-- Focus-trap / overlay nav accessibility -->

<!-- Calculator app script (unchanged logic; spacing-only CSS adjustments above) -->
<script defer="">
    (function(){
      'use strict';

      const currencyMap = {
        USD: {symbol: '$', locale: 'en-US'},
        EUR: {symbol: '€', locale: 'en-IE'},
        GBP: {symbol: '£', locale: 'en-GB'},
        CAD: {symbol: '$', locale: 'en-CA'},
        AUD: {symbol: '$', locale: 'en-AU'}
      };

      const els = {
        currency: document.getElementById('currency'),
        debts: document.getElementById('debts'),
        addDebtBtn: document.getElementById('addDebtBtn'),
        resetDebtsBtn: document.getElementById('resetDebtsBtn'),

        loanApr: document.getElementById('loanApr'),
        loanTerm: document.getElementById('loanTerm'),
        origFee: document.getElementById('origFee'),
        feeFinanced: document.getElementById('feeFinanced'),
        feeUpfront: document.getElementById('feeUpfront'),

        currentMonthly: document.getElementById('currentMonthly'),
        newMonthly: document.getElementById('newMonthly'),
        monthlyDelta: document.getElementById('monthlyDelta'),
        currentInterest: document.getElementById('currentInterest'),
        newInterest: document.getElementById('newInterest'),
        interestSavings: document.getElementById('interestSavings'),
        currentMonths: document.getElementById('currentMonths'),
        newMonths: document.getElementById('newMonths'),
        resultNote: document.getElementById('resultNote'),
        totalPrincipalBadge: document.getElementById('totalPrincipalBadge')
      };

      document.querySelectorAll('.tooltip').forEach(t => {
        if (!t.hasAttribute('aria-hidden')) t.setAttribute('aria-hidden','true');
      });

      let debtCounter = 0;

      function fmtCurrency(v){
        const code = els.currency.value;
        const { locale } = currencyMap[code] || currencyMap.USD;
        return new Intl.NumberFormat(locale, {style:'currency', currency: code}).format(isFinite(v)? v : 0);
      }

      function createDebtRow(data = {}){
        const id = ++debtCounter;
        const row = document.createElement('div');
        row.className = 'debt-row card';
        row.setAttribute('data-id', id);
        row.innerHTML = `
          <header class="debt-row-header" style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:.5rem">
            <h3 style="margin:0">Debt #${id} <span class="badge" id="debtBadge-${id}" aria-live="polite"></span></h3>
            <div class="controls" style="display:flex;gap:8px;flex-wrap:wrap">
              <button type="button" class="btn btn-danger remove-debt" aria-label="Remove Debt ${id}">Remove</button>
            </div>
          </header>

          <div class="grid grid-3-col">
            <div class="form-group">
              <div class="label-row">
                <label for="name-${id}">Creditor (optional)</label>
              </div>
              <input id="name-${id}" class="input" type="text" placeholder="e.g., Visa Platinum" value="${data.name || ''}">
            </div>

            <div class="form-group">
              <div class="label-row">
                <label for="bal-${id}">Balance *</label>
                <button type="button" class="help-btn" aria-expanded="false" aria-controls="bal-tip-${id}">?</button>
              </div>
              <div id="bal-tip-${id}" class="tooltip" role="tooltip" aria-hidden="true">Current principal you owe.</div>
              <input id="bal-${id}" class="input debt-balance" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g., 5000" aria-required="true" aria-describedby="bal-error-${id} bal-tip-${id}">
              <div id="bal-error-${id}" class="error" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
              <div class="label-row">
                <label for="apr-${id}">APR (%) *</label>
                <button type="button" class="help-btn" aria-expanded="false" aria-controls="apr-tip-${id}">?</button>
              </div>
              <div id="apr-tip-${id}" class="tooltip" role="tooltip" aria-hidden="true">Annual Percentage Rate (e.g., 19.99).</div>
              <input id="apr-${id}" class="input debt-apr" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g., 19.99" aria-required="true" aria-describedby="apr-error-${id} apr-tip-${id}">
              <div id="apr-error-${id}" class="error" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
              <div class="label-row">
                <label for="pay-${id}">Monthly Payment *</label>
                <button type="button" class="help-btn" aria-expanded="false" aria-controls="pay-tip-${id}">?</button>
              </div>
              <div id="pay-tip-${id}" class="tooltip" role="tooltip" aria-hidden="true">Use your intended payment (must exceed monthly interest).</div>
              <input id="pay-${id}" class="input debt-pay" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g., 200" aria-required="true" aria-describedby="pay-error-${id} pay-tip-${id}">
              <div id="pay-error-${id}" class="error" role="alert" aria-live="polite"></div>
            </div>
          </div>
        `;

        if (data.balance != null) row.querySelector(`#bal-${id}`).value = data.balance;
        if (data.apr != null) row.querySelector(`#apr-${id}`).value = data.apr;
        if (data.payment != null) row.querySelector(`#pay-${id}`).value = data.payment;

        row.querySelectorAll('.help-btn').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const tid = btn.getAttribute('aria-controls');
            const tip = document.getElementById(tid);
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!expanded));
            tip.setAttribute('aria-hidden', String(expanded));
          });
        });

        return row;
      }

      function addDebt(data){ els.debts.appendChild(createDebtRow(data)); }
      function clearDebts(){ els.debts.innerHTML=''; debtCounter=0; }

      function setError(input, msg){
        const errId = (input.getAttribute('aria-describedby') || '').split(' ').find(id => id.includes('error'));
        if (errId){
          const errEl = document.getElementById(errId);
          if (errEl) errEl.textContent = msg || '';
        }
        input.setAttribute('aria-invalid', msg ? 'true' : 'false');
      }

      function validateDebtRow(row){
        let valid = true;
        const id = row.getAttribute('data-id');
        const bal = row.querySelector(`#bal-${id}`);
        const apr = row.querySelector(`#apr-${id}`);
        const pay = row.querySelector(`#pay-${id}`);

        const B = parseFloat(bal.value);
        const A = parseFloat(apr.value);
        const P = parseFloat(pay.value);

        if (!isFinite(B) || B <= 0){ setError(bal, 'Enter a balance greater than 0.'); valid = false; } else setError(bal, '');
        if (!isFinite(A) || A < 0){ setError(apr, 'Enter a non-negative APR (e.g., 19.99).'); valid = false; } else setError(apr, '');
        if (!isFinite(P) || P <= 0){
          setError(pay, 'Enter a monthly payment greater than 0.'); valid = false;
        } else if (isFinite(B) && B > 0 && isFinite(A) && A >= 0){
          const r = (A/100)/12;
          const minPay = r > 0 ? r*B : 0;
          if (r > 0 && P <= minPay + 1e-8){
            setError(pay, `Payment must exceed monthly interest (${fmtCurrency(minPay.toFixed(2))}).`); valid = false;
          } else setError(pay, '');
        }
        return valid;
      }

      function validateLoanInputs(){
        let ok = true;
        const apr = parseFloat(els.loanApr.value);
        const term = parseInt(els.loanTerm.value, 10);

        if (!isFinite(apr) || apr < 0){
          document.getElementById('loanAprError').textContent = 'Enter a non-negative APR (e.g., 9.99).';
          els.loanApr.setAttribute('aria-invalid','true'); ok = false;
        } else {
          document.getElementById('loanAprError').textContent = '';
          els.loanApr.setAttribute('aria-invalid','false');
        }

        if (!isFinite(term) || term < 1){
          document.getElementById('loanTermError').textContent = 'Enter a term of at least 1 month.';
          els.loanTerm.setAttribute('aria-invalid','true'); ok = false;
        } else {
          document.getElementById('loanTermError').textContent = '';
          els.loanTerm.setAttribute('aria-invalid','false');
        }
        return ok;
      }

      function monthsToPayoff(B, APR, P){
        const r = (APR/100)/12;
        if (B <= 0 || P <= 0) return { n: 0, interest: 0, valid: false };
        if (r === 0){
          const n = B / P; const N = Math.ceil(n); const I = P*N - B;
          return { n: N, interest: I, valid: true };
        } else {
          const minPay = r*B; if (P <= minPay) return { n: Infinity, interest: Infinity, valid: false };
          const n = -Math.log(1 - r*B/P) / Math.log(1+r);
          const N = Math.ceil(n);
          const I = P*N - B;
          return { n: N, interest: I, valid: true };
        }
      }

      function paymentFrom(L, APR, N){
        const r = (APR/100)/12;
        if (N <= 0) return 0;
        if (r === 0) return L / N;
        return L * r / (1 - Math.pow(1 + r, -N));
      }

      function sumCurrentMonthly(){
        return Array.from(els.debts.querySelectorAll('.debt-row')).reduce((acc,row)=>{
          const id = row.getAttribute('data-id');
          const p = parseFloat(row.querySelector(`#pay-${id}`).value);
          return acc + (isFinite(p)? p:0);
        }, 0);
      }

      function sumPrincipal(){
        return Array.from(els.debts.querySelectorAll('.debt-row')).reduce((acc,row)=>{
          const id = row.getAttribute('data-id');
          const b = parseFloat(row.querySelector(`#bal-${id}`).value);
          return acc + (isFinite(b)? b:0);
        }, 0);
      }

      function compute(){
        const rows = Array.from(els.debts.querySelectorAll('.debt-row'));
        let totalInterestCurrent = 0, maxMonthsCurrent = 0, anyInvalidPay = false;

        rows.forEach(row=>{
          const ok = validateDebtRow(row);
          const id = row.getAttribute('data-id');
          const B = parseFloat(row.querySelector(`#bal-${id}`).value);
          const A = parseFloat(row.querySelector(`#apr-${id}`).value);
          const P = parseFloat(row.querySelector(`#pay-${id}`).value);
          const badge = row.querySelector(`#debtBadge-${id}`);

          if (ok){
            const res = monthsToPayoff(B,A,P);
            if (!res.valid){ badge.textContent = 'Needs higher payment'; anyInvalidPay = true; }
            else {
              badge.textContent = `${res.n} mo`;
              totalInterestCurrent += isFinite(res.interest) ? res.interest : 0;
              if (res.n > maxMonthsCurrent) maxMonthsCurrent = res.n;
            }
          } else {
            badge.textContent = '';
          }
        });

        const loanOk = validateLoanInputs();
        const L0 = sumPrincipal();
        const feePct = parseFloat(els.origFee.value) || 0;
        const feeAmount = L0 * (feePct/100);
        const financed = els.feeFinanced.checked;
        const L = financed ? (L0 + feeAmount) : L0;

        const aprLoan = parseFloat(els.loanApr.value);
        const term = parseInt(els.loanTerm.value,10);
        const P_new = (loanOk && L>0) ? paymentFrom(L,aprLoan,term) : 0;
        const interest_new = (loanOk && L>0) ? (P_new*term - L) : 0;

        const currentMonthly = sumCurrentMonthly();
        const delta = currentMonthly - P_new;

        els.currentMonthly.textContent = fmtCurrency(currentMonthly);
        els.newMonthly.textContent = fmtCurrency(P_new);
        els.monthlyDelta.textContent = (delta >= 0 ? '+' : '') + fmtCurrency(delta);

        const newInterestWithUpfront = interest_new + (financed ? 0 : feeAmount);
        els.currentInterest.textContent = fmtCurrency(Math.max(0,totalInterestCurrent));
        els.newInterest.textContent = fmtCurrency(Math.max(0,newInterestWithUpfront));

        const savings = Math.max(0,totalInterestCurrent) - Math.max(0,newInterestWithUpfront);
        els.interestSavings.textContent = (savings >= 0 ? '+' : '') + fmtCurrency(savings);

        els.currentMonths.textContent = Math.max(0, maxMonthsCurrent) + ' mo';
        els.newMonths.textContent = (loanOk && L>0) ? (term + ' mo') : '0 mo';
        els.totalPrincipalBadge.textContent = 'Total Principal: ' + fmtCurrency(L0);

        if (anyInvalidPay){
          els.resultNote.hidden = false;
          els.resultNote.textContent = 'At least one debt has a payment at or below monthly interest; increase the payment to avoid negative amortization.';
        } else {
          els.resultNote.hidden = true;
          els.resultNote.textContent = '';
        }
      }

      // Tooltips (section-level)
      document.querySelectorAll('.help-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('aria-controls');
          const tip = document.getElementById(id);
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          tip.setAttribute('aria-hidden', String(expanded));
        });
      });

      // Add/remove rows
      els.addDebtBtn.addEventListener('click', ()=>{ addDebt(); compute(); });
      els.resetDebtsBtn.addEventListener('click', ()=>{ clearDebts(); seedDefaults(); compute(); });

      // Delegate remove
      els.debts.addEventListener('click', (e)=>{
        const btn = e.target.closest('.remove-debt');
        if (!btn) return;
        const row = e.target.closest('.debt-row');
        if (row){ row.remove(); compute(); }
      });

      // Input handlers
      function bindRowEvents(row){
        row.querySelectorAll('input').forEach(inp=>{
          inp.addEventListener('blur', ()=>{ if (row.isConnected) validateDebtRow(row); });
          inp.addEventListener('input', debounce(compute, 100));
        });
      }

      const mo = new MutationObserver(mutations=>{
        for(const m of mutations){
          m.addedNodes.forEach(node=>{
            if (node.nodeType === 1 && node.classList.contains('debt-row')) bindRowEvents(node);
          });
        }
      });
      mo.observe(els.debts, {childList:true});

      [els.loanApr, els.loanTerm, els.origFee].forEach(el=>{
        el.addEventListener('blur', validateLoanInputs);
        el.addEventListener('input', debounce(compute, 100));
      });
      [els.feeFinanced, els.feeUpfront].forEach(r=> r.addEventListener('change', compute));
      els.currency.addEventListener('change', compute);

      function debounce(fn, wait){ let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=>fn.apply(null,args), wait); }; }

      function seedDefaults(){
        addDebt({name:'Credit Card A', balance:5000, apr:20, payment:200});
        addDebt({name:'Credit Card B', balance:8000, apr:12, payment:300});
        els.loanApr.value = 9.99;
        els.loanTerm.value = 60;
        els.origFee.value = 3;
        els.feeFinanced.checked = true;
        document.querySelectorAll('.debt-row').forEach(bindRowEvents);
      }

      // Init
      seedDefaults();
      compute();

    })();
  </script>
<!-- Footer util -->
<script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

</body></html>