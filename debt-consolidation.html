<!DOCTYPE html>
<html lang="en">
<head> 
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
  <meta charset="utf-8"/>
  <title>Debt Consolidation Calculator | Compare Payments &amp; Savings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Compare your current debt payoff plan with a new consolidation loan. See monthly payment changes, payoff timelines, and total interest savings before you refinance."/>
  <meta name="author" content="Ugo Candido"/>
  <link rel="canonical" href="https://calcdomain.com/debt-consolidation.html"/>
  <meta name="theme-color" content="#0b3d69"/>
  <meta name="robots" content="index, follow"/>
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Debt Consolidation Calculator"/>
  <meta property="og:description" content="Compare current debts with a consolidation loan to understand payment changes, payoff dates, and interest savings."/>
  <meta property="og:url" content="https://calcdomain.com/debt-consolidation.html"/>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p { margin-bottom: .9rem; line-height: 1.7; }
    .prose ul { list-style: disc; padding-left: 1.25rem; }
    .prose ol { list-style: decimal; padding-left: 1.25rem; }
    details > summary { cursor: pointer; font-weight: 600; }
    details[open] > summary { margin-bottom: .5rem; }
    .eeat { display:grid; gap:0.75rem; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); font-size:0.875rem; color:#374151; }
    @media (min-width: 768px) { .eeat { grid-template-columns:repeat(4,minmax(0,1fr)); } }
    .eeat span { display:block; background:#f9fafb; border:1px solid #e5e7eb; border-radius:0.5rem; padding:0.75rem 1rem; }
    .result-pill { display:inline-flex; align-items:center; font-size:0.875rem; font-weight:600; padding:0.25rem 0.75rem; border-radius:9999px; }
    .formula-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius:0.75rem; padding:1rem; overflow:auto; }
    .formula-box mjx-container { overflow-x:auto; }
    .sticky-ad { height: 600px; }
  </style>

  <script src="search.js" defer></script>

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Finance","item":"https://calcdomain.com/finance.html"},
      {"@type":"ListItem","position":3,"name":"Loans & Debt","item":"https://calcdomain.com/subcategories/finance-loans-debt.html"},
      {"@type":"ListItem","position":4,"name":"Debt Consolidation Calculator","item":"https://calcdomain.com/debt-consolidation.html"}
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Debt Consolidation Calculator",
    "url":"https://calcdomain.com/debt-consolidation.html",
    "description":"Compare your current debts to a consolidation loan and estimate monthly payment changes, payoff dates, and total interest savings.",
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "author":{"@type":"Person","name":"Ugo Candido"},
    "mainEntity":{
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"Does consolidating always save money?","acceptedAnswer":{"@type":"Answer","text":"Savings depend on the new APR, term, and fees versus your current debts. This calculator reveals the break-even point so you can decide."}},
        {"@type":"Question","name":"What if one debt payment is too low?","acceptedAnswer":{"@type":"Answer","text":"If a payment is below monthly interest, the balance grows (negative amortization). Increase the payment amount to obtain a valid payoff schedule."}},
        {"@type":"Question","name":"Should I finance the origination fee?","acceptedAnswer":{"@type":"Answer","text":"Financing the fee adds it to the loan principal and increases overall interest. Paying upfront usually costs less if cash flow allows."}}
      ]
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to evaluate debt consolidation",
    "description":"Example comparing two credit cards to a $15,000 consolidation loan at 9.5% APR over 48 months.",
    "step":[
      {"@type":"HowToStep","name":"List debts","text":"Card A: $6,000 at 21% APR with a $220 payment. Card B: $4,500 at 17% APR with a $180 payment."},
      {"@type":"HowToStep","name":"Enter consolidation terms","text":"New loan APR 9.5%, term 48 months, 3% fee financed."},
      {"@type":"HowToStep","name":"Review results","text":"Monthly payment decreases by ≈ $45 and interest savings total around $1,980 while finishing in 48 months."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-800">

  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            <input id="search-input" type="search" placeholder="Search for a calculator..."
                   class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>

        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Toggle menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <div id="mobile-menu" class="md:hidden mt-4 hidden">
        <div class="mb-4">
          <div class="relative">
            <input id="mobile-search-input" type="search" placeholder="Search calculators..."
                   class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        <div class="space-y-2">
          <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <section class="w-full lg:w-2/3">
        <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
          <a href="subcategories/finance-loans-debt.html" class="hover:text-blue-600">Loans &amp; Debt</a> &raquo;
          <span class="text-gray-900 font-medium">Debt Consolidation</span>
        </nav>

        <section class="bg-white p-6 rounded-lg shadow-md" aria-labelledby="calc-title">
          <h1 id="calc-title" class="text-3xl font-extrabold mb-2 text-slate-800">Debt Consolidation Calculator</h1>
          <p class="text-gray-600 mb-6">Compare the cost of staying with your current debts versus combining them into one consolidation loan. See new payments, interest savings, and payoff timelines before you apply.</p>

          <div class="eeat mb-6">
            <span><strong>Author:</strong> Ugo Candido</span>
            <span><strong>Reviewed by:</strong> Finance Content Editor</span>
            <span><strong>Last updated:</strong> <time id="lastUpdated"></time></span>
            <span><strong>Category:</strong> Finance → Loans &amp; Debt</span>
          </div>

          <div id="calculator-ui" class="space-y-10">

            <section aria-labelledby="currency-heading" class="border border-gray-200 rounded-lg p-4">
              <h2 id="currency-heading" class="text-lg font-semibold text-gray-800 mb-3">Currency</h2>
              <label for="currency" class="block text-sm font-medium text-gray-700 mb-1">Select currency</label>
              <select id="currency" class="block w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                <option value="USD" selected>USD — $</option>
                <option value="EUR">EUR — €</option>
                <option value="GBP">GBP — £</option>
                <option value="CAD">CAD — $</option>
                <option value="AUD">AUD — $</option>
              </select>
            </section>

            <section aria-labelledby="debts-heading" class="border border-gray-200 rounded-lg p-4">
              <div class="flex items-start justify-between flex-wrap gap-3">
                <div>
                  <h2 id="debts-heading" class="text-lg font-semibold text-gray-800">Your current debts</h2>
                  <p class="text-sm text-gray-600">Add each debt you plan to consolidate with its balance, APR, and monthly payment.</p>
                </div>
                <div class="flex flex-wrap gap-2">
                  <button id="addDebt" type="button" class="inline-flex items-center px-4 py-2 rounded-md border border-blue-500 text-blue-600 font-semibold hover:bg-blue-50">+ Add debt</button>
                  <button id="resetDebts" type="button" class="inline-flex items-center px-4 py-2 rounded-md border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50">Reset</button>
                </div>
              </div>

              <div id="debtsContainer" class="mt-4 space-y-4" aria-live="polite"></div>
            </section>

            <section aria-labelledby="loan-heading" class="border border-gray-200 rounded-lg p-4">
              <h2 id="loan-heading" class="text-lg font-semibold text-gray-800 mb-4">Consolidation loan</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label for="loanApr" class="block text-sm font-medium text-gray-700">Loan APR (%) *</label>
                  <input id="loanApr" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g., 9.99"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                         aria-describedby="loanAprErr" aria-required="true">
                  <p id="loanAprErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
                </div>
                <div>
                  <label for="loanTerm" class="block text-sm font-medium text-gray-700">Term (months) *</label>
                  <input id="loanTerm" type="number" inputmode="numeric" min="1" step="1" placeholder="e.g., 60"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                         aria-describedby="loanTermErr" aria-required="true">
                  <p id="loanTermErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
                </div>
                <div>
                  <label for="origFee" class="block text-sm font-medium text-gray-700">Origination fee (%)</label>
                  <input id="origFee" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g., 4"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                         aria-describedby="origFeeErr">
                  <p id="origFeeErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
                </div>
                <div class="border border-gray-200 rounded-md p-3">
                  <span class="block text-xs font-semibold text-gray-600 uppercase tracking-wide mb-2">Fee handling</span>
                  <div class="flex gap-3">
                    <label class="flex items-center gap-2 text-sm text-gray-700">
                      <input type="radio" name="feeMode" id="feeFinanced" value="financed" class="text-blue-600" checked>
                      <span>Financed (added)</span>
                    </label>
                    <label class="flex items-center gap-2 text-sm text-gray-700">
                      <input type="radio" name="feeMode" id="feeUpfront" value="upfront" class="text-blue-600">
                      <span>Paid upfront</span>
                    </label>
                  </div>
                </div>
              </div>
              <p class="mt-3 text-xs text-gray-500">Financing the fee increases the new loan balance and interest. Paying upfront keeps the balance lower.</p>
            </section>

            <section aria-labelledby="results-heading" class="bg-blue-50 border border-blue-100 rounded-lg p-6">
              <h2 id="results-heading" class="text-lg font-semibold text-blue-900 mb-4">Results</h2>
              <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Current monthly payments</span>
                  <span id="currentMonthlyValue" class="text-2xl font-extrabold text-blue-700">$0.00</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Consolidation payment</span>
                  <span id="newMonthlyValue" class="text-2xl font-extrabold text-blue-700">$0.00</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Monthly cash flow change</span>
                  <span id="monthlyDeltaValue" class="text-2xl font-extrabold text-blue-700">$0.00</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Interest (keep current plan)</span>
                  <span id="currentInterestValue" class="text-2xl font-extrabold text-green-700">$0.00</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Interest (consolidation)</span>
                  <span id="newInterestValue" class="text-2xl font-extrabold text-green-700">$0.00</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Interest savings</span>
                  <span id="interestSavingsValue" class="text-2xl font-extrabold text-green-700">$0.00</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Debt-free with current plan</span>
                  <span id="currentMonthsValue" class="text-xl font-semibold text-gray-800">0 months</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Debt-free with consolidation</span>
                  <span id="newMonthsValue" class="text-xl font-semibold text-gray-800">0 months</span>
                </div>
                <div class="bg-white border rounded-lg p-4">
                  <span class="block text-sm text-gray-500">Total principal consolidated</span>
                  <span id="totalPrincipalValue" class="text-xl font-semibold text-gray-800">$0.00</span>
                </div>
              </div>
              <p id="resultNote" class="mt-4 text-sm text-amber-700 bg-amber-100 border border-amber-200 rounded-md px-3 py-2 hidden"></p>
              <div class="mt-4">
                <span id="statusPill" class="result-pill bg-slate-100 text-slate-800">Ready to calculate</span>
              </div>
            </section>
          </div>
        </section>

        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>Data Source and Methodology</h2>
          <p>The calculator uses the standard amortization identity referenced by the Consumer Financial Protection Bureau (CFPB) and Truth in Lending (Regulation Z) Appendix J. Each debt is amortized separately using your specified payment; the consolidation loan uses the APR and term you enter. Origination fees can be financed (added to the new loan amount) or paid upfront.</p>

          <h2>Formulas Used</h2>
          <div class="formula-box">
            <p><strong>Monthly rate:</strong> \( r = \dfrac{\text{APR}}{12 \times 100} \)</p>
            <p><strong>Months to pay a debt:</strong> \( n = \dfrac{-\ln\left(1 - \dfrac{rB}{P}\right)}{\ln(1+r)} \) if \( r > 0 \); otherwise \( n = \dfrac{B}{P} \)</p>
            <p><strong>Interest paid on a debt:</strong> \( I = n \cdot P - B \)</p>
            <p><strong>Consolidation payment:</strong> \( P_c = \dfrac{L r_c}{1 - (1 + r_c)^{-N}} \) (or \( L/N \) if \( r_c = 0 \))</p>
          </div>

          <h2>Tips before consolidating</h2>
          <ul>
            <li>Verify that the new APR and term truly lower total interest, not just monthly payments.</li>
            <li>Look out for origination fees or prepayment penalties on existing debts.</li>
            <li>Consider continuing to pay extra principal even if the new payment is lower to accelerate payoff.</li>
          </ul>
        </article>

        <section class="bg-white p-6 rounded-lg shadow-md mt-8">
          <h2 class="text-xl font-semibold text-gray-900 mb-3">Need more help?</h2>
          <p class="text-sm text-gray-600 leading-relaxed">
            Explore more tools in the <a href="subcategories/finance-loans-debt.html" class="text-blue-600 hover:underline">Loans &amp; Debt hub</a> or run a full payoff plan with the <a href="loan-payoff.html" class="text-blue-600 hover:underline">Loan Payoff Calculator</a>.
          </p>
        </section>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24">
          <div class="bg-gray-200 rounded-lg mb-6 flex items-center justify-center sticky-ad">
            <p class="text-gray-500">Sticky Ad Unit (300×600)</p>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related calculators</h3>
            <ul class="space-y-3">
              <li><a class="text-blue-600 hover:underline" href="loan-payoff.html">Loan Payoff Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-prepayment.html">Loan Prepayment Planner</a></li>
              <li><a class="text-blue-600 hover:underline" href="simple-loan.html">Simple Loan Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="dti-ratio.html">Debt-to-Income Ratio</a></li>
            </ul>
          </div>
        </div>
      </aside>

    </div>
  </main>

  <footer class="bg-white border-t mt-12">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);

    const CURRENCIES = {
      USD: { code: 'USD', locale: 'en-US', symbol: '$' },
      EUR: { code: 'EUR', locale: 'en-IE', symbol: '€' },
      GBP: { code: 'GBP', locale: 'en-GB', symbol: '£' },
      CAD: { code: 'CAD', locale: 'en-CA', symbol: '$' },
      AUD: { code: 'AUD', locale: 'en-AU', symbol: '$' }
    };

    const els = {
      currency: $('currency'),
      debtsContainer: $('debtsContainer'),
      addDebt: $('addDebt'),
      resetDebts: $('resetDebts'),

      loanApr: $('loanApr'),
      loanTerm: $('loanTerm'),
      origFee: $('origFee'),
      feeFinanced: $('feeFinanced'),
      feeUpfront: $('feeUpfront'),

      loanAprErr: $('loanAprErr'),
      loanTermErr: $('loanTermErr'),
      origFeeErr: $('origFeeErr'),

      currentMonthlyValue: $('currentMonthlyValue'),
      newMonthlyValue: $('newMonthlyValue'),
      monthlyDeltaValue: $('monthlyDeltaValue'),
      currentInterestValue: $('currentInterestValue'),
      newInterestValue: $('newInterestValue'),
      interestSavingsValue: $('interestSavingsValue'),
      currentMonthsValue: $('currentMonthsValue'),
      newMonthsValue: $('newMonthsValue'),
      totalPrincipalValue: $('totalPrincipalValue'),
      statusPill: $('statusPill'),
      resultNote: $('resultNote')
    };

    let debtCounter = 0;
    const fmtCurrency = (value) => {
      const settings = CURRENCIES[els.currency.value] || CURRENCIES.USD;
      return new Intl.NumberFormat(settings.locale, { style: 'currency', currency: settings.code }).format(isFinite(value) ? value : 0);
    };

    function createDebtRow(prefill = {}) {
      const id = ++debtCounter;
      const wrapper = document.createElement('div');
      wrapper.className = 'debt-row bg-white border border-gray-200 rounded-lg p-4 shadow-sm';
      wrapper.setAttribute('data-id', id);
      wrapper.innerHTML = `
        <div class="flex justify-between items-start gap-3 flex-wrap">
          <div>
            <h3 class="text-lg font-semibold text-gray-800">Debt #${id} <span class="text-sm text-blue-600" id="debtBadge-${id}" aria-live="polite"></span></h3>
            <p class="text-xs text-gray-500">Provide balance, APR, and the monthly payment you intend to continue making.</p>
          </div>
          <button type="button" class="inline-flex items-center px-3 py-1.5 rounded-md border border-red-200 text-red-600 text-sm font-semibold hover:bg-red-50 remove-debt">Remove</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
          <div>
            <label for="debtName-${id}" class="block text-sm font-medium text-gray-700">Creditor (optional)</label>
            <input id="debtName-${id}" type="text" value="${prefill.name || ''}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="debtBalance-${id}" class="block text-sm font-medium text-gray-700">Balance *</label>
            <input id="debtBalance-${id}" type="number" inputmode="decimal" min="0" step="0.01" value="${prefill.balance ?? ''}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 debt-balance"
                   aria-describedby="debtBalanceErr-${id}" aria-required="true">
            <p id="debtBalanceErr-${id}" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
          </div>
          <div>
            <label for="debtApr-${id}" class="block text-sm font-medium text-gray-700">APR (%) *</label>
            <input id="debtApr-${id}" type="number" inputmode="decimal" min="0" step="0.01" value="${prefill.apr ?? ''}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 debt-apr"
                   aria-describedby="debtAprErr-${id}" aria-required="true">
            <p id="debtAprErr-${id}" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
          </div>
          <div>
            <label for="debtPayment-${id}" class="block text-sm font-medium text-gray-700">Monthly payment *</label>
            <input id="debtPayment-${id}" type="number" inputmode="decimal" min="0" step="0.01" value="${prefill.payment ?? ''}"
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 debt-payment"
                   aria-describedby="debtPaymentErr-${id}" aria-required="true">
            <p id="debtPaymentErr-${id}" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
          </div>
        </div>
      `;
      els.debtsContainer.appendChild(wrapper);
      bindDebtRowEvents(wrapper);
    }

    function removeDebtRow(node) {
      if (node) {
        node.remove();
      }
    }

    function bindDebtRowEvents(row) {
      row.querySelectorAll('input').forEach((input) => {
        input.addEventListener('input', debounce(compute, 120));
        input.addEventListener('blur', () => validateDebtRow(row));
      });
    }

    function validateDebtRow(row) {
      const id = row.getAttribute('data-id');
      const balanceInput = row.querySelector(`#debtBalance-${id}`);
      const aprInput = row.querySelector(`#debtApr-${id}`);
      const paymentInput = row.querySelector(`#debtPayment-${id}`);
      const balance = parseFloat(balanceInput.value);
      const apr = parseFloat(aprInput.value);
      const payment = parseFloat(paymentInput.value);
      let ok = true;

      if (!(balance > 0)) {
        setError(balanceInput, row.querySelector(`#debtBalanceErr-${id}`), 'Enter a positive balance.');
        ok = false;
      } else setError(balanceInput, row.querySelector(`#debtBalanceErr-${id}`), '');

      if (!(apr >= 0)) {
        setError(aprInput, row.querySelector(`#debtAprErr-${id}`), 'Enter an APR of 0 or more.');
        ok = false;
      } else setError(aprInput, row.querySelector(`#debtAprErr-${id}`), '');

      if (!(payment > 0)) {
        setError(paymentInput, row.querySelector(`#debtPaymentErr-${id}`), 'Enter a monthly payment greater than zero.');
        ok = false;
      } else setError(paymentInput, row.querySelector(`#debtPaymentErr-${id}`), '');

      return ok;
    }

    function setError(input, errEl, message) {
      if (!errEl) return;
      if (message) {
        errEl.textContent = message;
        input?.setAttribute('aria-invalid', 'true');
      } else {
        errEl.textContent = '';
        input?.setAttribute('aria-invalid', 'false');
      }
    }

    function sumPrincipal() {
      let total = 0;
      els.debtsContainer.querySelectorAll('[data-id]').forEach((row) => {
        const id = row.getAttribute('data-id');
        if (!id) return;
        const balance = parseFloat(row.querySelector(`#debtBalance-${id}`).value);
        if (balance > 0) total += balance;
      });
      return total;
    }

    function sumCurrentPayments() {
      let total = 0;
      els.debtsContainer.querySelectorAll('[data-id]').forEach((row) => {
        const id = row.getAttribute('data-id');
        if (!id) return;
        const payment = parseFloat(row.querySelector(`#debtPayment-${id}`).value);
        if (payment > 0) total += payment;
      });
      return total;
    }

    function monthsToPayoff(balance, apr, payment) {
      const rate = (apr / 100) / 12;
      if (balance <= 0 || payment <= 0) return { valid: false };
      if (rate === 0) {
        const months = Math.ceil(balance / payment);
        return { valid: months > 0, months, interest: 0 };
      }
      if (payment <= balance * rate) {
        return { valid: false };
      }
      const numerator = -Math.log(1 - (rate * balance) / payment);
      const denominator = Math.log(1 + rate);
      const months = numerator / denominator;
      const totalPaid = payment * months;
      return { valid: true, months, interest: totalPaid - balance };
    }

    function paymentFrom(principal, apr, term) {
      const rate = (apr / 100) / 12;
      if (term <= 0) return Infinity;
      if (rate === 0) {
        return principal / term;
      }
      const pow = Math.pow(1 + rate, term);
      return principal * rate * pow / (pow - 1);
    }

    function validateLoanInputs() {
      let ok = true;
      const apr = parseFloat(els.loanApr.value);
      const term = parseInt(els.loanTerm.value, 10);
      const fee = parseFloat(els.origFee.value);

      if (!(apr >= 0) || apr > 1000) {
        setError(els.loanApr, els.loanAprErr, 'Enter an APR between 0 and 1000%.');
        ok = false;
      } else setError(els.loanApr, els.loanAprErr, '');

      if (!(term > 0)) {
        setError(els.loanTerm, els.loanTermErr, 'Enter a term greater than zero.');
        ok = false;
      } else setError(els.loanTerm, els.loanTermErr, '');

      if (els.origFee.value.trim() !== '') {
        if (!(fee >= 0) || fee > 100) {
          setError(els.origFee, els.origFeeErr, 'Enter a fee percentage between 0 and 100.');
          ok = false;
        } else setError(els.origFee, els.origFeeErr, '');
      } else {
        setError(els.origFee, els.origFeeErr, '');
      }
      return ok;
    }

    function compute() {
      const rows = Array.from(els.debtsContainer.querySelectorAll('[data-id]'));
      if (!rows.length) {
        els.statusPill.textContent = 'Add at least one debt to begin';
        els.statusPill.className = 'result-pill bg-amber-100 text-amber-800';
        els.currentMonthlyValue.textContent = fmtCurrency(0);
        els.newMonthlyValue.textContent = fmtCurrency(0);
        els.monthlyDeltaValue.textContent = fmtCurrency(0);
        els.currentInterestValue.textContent = fmtCurrency(0);
        els.newInterestValue.textContent = fmtCurrency(0);
        els.interestSavingsValue.textContent = fmtCurrency(0);
        els.currentMonthsValue.textContent = '0 months';
        els.newMonthsValue.textContent = '0 months';
        els.totalPrincipalValue.textContent = fmtCurrency(0);
        els.resultNote.classList.add('hidden');
        return;
      }

      let baselineInterest = 0;
      let maxMonths = 0;
      let negativeAmortization = false;

      rows.forEach((row) => {
        if (!validateDebtRow(row)) {
          negativeAmortization = true;
          return;
        }
        const id = row.getAttribute('data-id');
        const balance = parseFloat(row.querySelector(`#debtBalance-${id}`).value);
        const apr = parseFloat(row.querySelector(`#debtApr-${id}`).value);
        const payment = parseFloat(row.querySelector(`#debtPayment-${id}`).value);

        const badge = row.querySelector(`#debtBadge-${id}`);

        const res = monthsToPayoff(balance, apr, payment);
        if (!res.valid) {
          badge.textContent = 'Payment too low';
          negativeAmortization = true;
        } else {
          badge.textContent = `${Math.ceil(res.months)} mo`;
          baselineInterest += Math.max(0, res.interest);
          if (res.months > maxMonths) maxMonths = res.months;
        }
      });

      const loanInputsValid = validateLoanInputs();
      const totalPrincipal = sumPrincipal();
      const feePct = parseFloat(els.origFee.value) || 0;
      const feeAmount = totalPrincipal * (feePct / 100);
      const financedFee = els.feeFinanced.checked;
      const principalConsolidated = financedFee ? totalPrincipal + feeAmount : totalPrincipal;

      const loanApr = parseFloat(els.loanApr.value);
      const loanTerm = parseInt(els.loanTerm.value, 10);
      const consolidationPayment = loanInputsValid && principalConsolidated > 0
        ? paymentFrom(principalConsolidated, loanApr, loanTerm)
        : 0;
      const consolidationInterest = loanInputsValid && principalConsolidated > 0
        ? consolidationPayment * loanTerm - principalConsolidated
        : 0;
      const consolidationInterestAdjusted = financedFee
        ? consolidationInterest
        : consolidationInterest + feeAmount;

      const currentMonthly = sumCurrentPayments();
      const monthlyDelta = currentMonthly - consolidationPayment;

      els.currentMonthlyValue.textContent = fmtCurrency(currentMonthly);
      els.newMonthlyValue.textContent = fmtCurrency(consolidationPayment);

      const locale = CURRENCIES[els.currency.value]?.locale || 'en-US';
      const deltaFormat = new Intl.NumberFormat(locale, { style: 'currency', currency: CURRENCIES[els.currency.value]?.code || 'USD' });
      const deltaText = deltaFormat.format(monthlyDelta);
      els.monthlyDeltaValue.textContent = monthlyDelta >= 0 ? `+${deltaText.replace(/^\+?/, '')}` : deltaText;

      els.currentInterestValue.textContent = fmtCurrency(baselineInterest);
      if (!loanInputsValid || principalConsolidated <= 0) {
        els.newMonthlyValue.textContent = fmtCurrency(0);
        els.monthlyDeltaValue.textContent = fmtCurrency(currentMonthly);
        els.newInterestValue.textContent = fmtCurrency(0);
        els.interestSavingsValue.textContent = fmtCurrency(0);
        els.newMonthsValue.textContent = '0 months';
        els.totalPrincipalValue.textContent = fmtCurrency(totalPrincipal);
        els.statusPill.textContent = 'Enter consolidation APR and term to compare savings';
        els.statusPill.className = 'result-pill bg-slate-100 text-slate-800';
        els.currentMonthsValue.textContent = maxMonths > 0 ? `${Math.ceil(maxMonths)} months` : '0 months';
        if (negativeAmortization) {
          els.resultNote.classList.remove('hidden');
          els.resultNote.textContent = 'At least one debt has a payment that does not cover monthly interest. Increase that payment to obtain a valid payoff schedule.';
          els.statusPill.textContent = 'Fix payment issues above';
          els.statusPill.className = 'result-pill bg-amber-100 text-amber-800';
        } else {
          els.resultNote.classList.add('hidden');
          els.resultNote.textContent = '';
        }
        return;
      }

      els.newInterestValue.textContent = fmtCurrency(Math.max(0, consolidationInterestAdjusted));
      const interestSaved = baselineInterest - consolidationInterestAdjusted;
      els.interestSavingsValue.textContent = fmtCurrency(interestSaved);

      els.currentMonthsValue.textContent = maxMonths > 0 ? `${Math.ceil(maxMonths)} months` : '0 months';
      els.newMonthsValue.textContent = `${loanTerm} months`;
      els.totalPrincipalValue.textContent = fmtCurrency(totalPrincipal);

      if (negativeAmortization) {
        els.resultNote.classList.remove('hidden');
        els.resultNote.textContent = 'At least one debt has a payment that does not cover monthly interest. Increase that payment to obtain a valid payoff schedule.';
        els.statusPill.textContent = 'Fix payment issues above';
        els.statusPill.className = 'result-pill bg-amber-100 text-amber-800';
      } else {
        els.resultNote.classList.add('hidden');
        els.resultNote.textContent = '';
        if (interestSaved > 0) {
          els.statusPill.textContent = `You save ${fmtCurrency(interestSaved)} with consolidation`;
          els.statusPill.className = 'result-pill bg-emerald-100 text-emerald-800';
        } else if (interestSaved < 0) {
          els.statusPill.textContent = 'Consolidation costs more interest';
          els.statusPill.className = 'result-pill bg-rose-100 text-rose-800';
        } else {
          els.statusPill.textContent = 'Consolidation matches current plan';
          els.statusPill.className = 'result-pill bg-slate-100 text-slate-800';
        }
      }
    }

    function debounce(fn, wait) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn.apply(null, args), wait);
      };
    }

    function resetDebts() {
      els.debtsContainer.innerHTML = '';
      debtCounter = 0;
      createDebtRow({ name: 'Credit Card A', balance: 5000, apr: 20, payment: 200 });
      createDebtRow({ name: 'Credit Card B', balance: 8000, apr: 12, payment: 300 });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      $('lastUpdated').textContent = today.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' });

      resetDebts();
      els.loanApr.value = 9.99;
      els.loanTerm.value = 60;
      els.origFee.value = 3;
      els.feeFinanced.checked = true;
      els.feeUpfront.checked = false;

      els.addDebt.addEventListener('click', () => {
        createDebtRow();
        compute();
      });

      els.resetDebts.addEventListener('click', () => {
        resetDebts();
        compute();
      });

      els.debtsContainer.addEventListener('click', (event) => {
        const removeBtn = event.target.closest('.remove-debt');
        if (!removeBtn) return;
        const row = removeBtn.closest('[data-id]');
        removeDebtRow(row);
        compute();
      });

      [els.currency, els.loanApr, els.loanTerm, els.origFee, els.feeFinanced, els.feeUpfront].forEach((input) => {
        input.addEventListener('input', debounce(compute, 120));
        input.addEventListener('change', debounce(compute, 120));
      });

      compute();

      const toggle = $('mobile-menu-toggle');
      const menu = $('mobile-menu');
      toggle?.addEventListener('click', () => menu?.classList.toggle('hidden'));

      if (window.MathJax) {
        if (window.MathJax.typesetPromise) {
          window.MathJax.typesetPromise();
        } else if (window.MathJax.typeset) {
          window.MathJax.typeset();
        }
      }
    });
  </script>
</body>
</html>
