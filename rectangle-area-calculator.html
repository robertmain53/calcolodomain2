<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta & SEO -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rectangle Area Calculator</title>
  <meta name="description" content="Professional Rectangle Area Calculator with unit conversion (m, cm, mm, in, ft), perimeter & diagonal, accessible UI, formula in LaTeX, worked example, and FAQs." />
  <meta name="keywords" content="rectangle area calculator, rectangle calculator, area of rectangle, geometry area calculator" />
  <link rel="canonical" href="https://calcdomain.com/rectangle-area-calculator.html" />

  <!-- Icons (optional placeholders for site parity) -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- UI libs (fast CDNs) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- MathJax for LaTeX rendering (deferred) -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          id="MathJax-script"></script>

  <!-- Styles (inline = faster first paint, no CLS) -->
  <style>
    :root { --brand:#1d4ed8; --ink:#0f172a; --muted:#64748b; --surface:#ffffff; --bg:#f8fafc; }
    html { scroll-behavior: smooth; }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background: var(--bg); color: var(--ink); }
    .container { max-width: 1100px; }
    .prose { max-width: 72ch; }
    .prose h2 { font-size: 1.375rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p, .prose li { line-height: 1.7; }
    .formula-box { background:#f3f4f6; border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; overflow-x:auto; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; text-align:center }
    .result-card h4 { font-size:.95rem; color:#475569; margin-bottom:.25rem }
    .result-card p { font-size:1.6rem; font-weight:800; color:var(--brand) }
    .kbd:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, a:focus-visible {
      outline: 3px solid #60a5fa; outline-offset: 2px; border-radius: .5rem;
    }
    /* Prevent CLS in results region */
    #results { min-height: 220px; }
    /* Touch targets */
    .tappable { min-height:48px; min-width:48px; }
    /* Print only the central article and results */
    @media print {
      header, nav, aside, footer { display:none !important; }
      main { padding:0 !important; }
      #print-section { position: static !important; box-shadow:none !important; border:none !important; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Rectangle Area Calculator",
    "description":"Compute the area of a rectangle with unit conversions (m, cm, mm, in, ft), plus perimeter and diagonal. Includes formula, worked example, and FAQs.",
    "url":"https://calcdomain.com/rectangle-area-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Geometry","item":"https://calcdomain.com/subcategories/geometry.html"},
      {"@type":"ListItem","position":4,"name":"Rectangle Area Calculator","item":"https://calcdomain.com/rectangle-area-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: SoftwareApplication (calculator) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Rectangle Area Calculator",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "Web",
    "offers": {"@type":"Offer","price":"0","priceCurrency":"USD"},
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "url":"https://calcdomain.com/rectangle-area-calculator.html"
  }
  </script>

  <!-- JSON-LD: HowTo (worked example) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to calculate the area of a rectangle",
    "description":"Enter length and width in your preferred units, then read area, perimeter, and diagonal.",
    "step":[
      {"@type":"HowToStep","name":"Enter length","text":"Input the rectangle length and select its unit (e.g., meters)."},
      {"@type":"HowToStep","name":"Enter width","text":"Input the rectangle width and select its unit (e.g., centimeters)."},
      {"@type":"HowToStep","name":"Read results","text":"The calculator outputs area (with multiple unit conversions), perimeter, and diagonal length."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the formula for the area of a rectangle?","acceptedAnswer":{"@type":"Answer","text":"Area equals length times width: A = l × w."}},
      {"@type":"Question","name":"Which units can I use?","acceptedAnswer":{"@type":"Answer","text":"Meters, centimeters, millimeters, inches, and feet. Results are shown in multiple units, including square meters and square feet."}},
      {"@type":"Question","name":"Can I lock aspect ratio?","acceptedAnswer":{"@type":"Answer","text":"Yes. Toggle the 'Lock aspect ratio' option to keep width proportional to length (or vice versa) when you edit one value."}},
      {"@type":"Question","name":"What other properties are calculated?","acceptedAnswer":{"@type":"Answer","text":"Perimeter and diagonal are computed in addition to the area."}},
      {"@type":"Question","name":"Is the tool accessible?","acceptedAnswer":{"@type":"Answer","text":"Yes. It’s keyboard navigable, has visible focus, accessible labels, descriptive errors, and adheres to WCAG 2.1 AA principles."}},
      {"@type":"Question","name":"How precise are the conversions?","acceptedAnswer":{"@type":"Answer","text":"Conversions use standard exact factors where defined (e.g., 1 in = 25.4 mm exactly) for professional-grade accuracy."}}
    ]
  }
  </script>
</head>
<body class="text-gray-900">
  <!-- Header (non-sticky for maximum mobile viewport) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-700" href="index.html#categories">Categories</a>
      </nav>
      <a class="md:hidden hover:text-blue-700" href="search.html" aria-label="Open search">Search</a>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <!-- Breadcrumbs -->
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
          <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
          <a href="subcategories/geometry.html" class="hover:text-blue-700">Geometry</a> &raquo;
          <span class="text-gray-900">Rectangle Area Calculator</span>
        </nav>

        <!-- Intro + Calculator -->
        <div id="print-section" class="bg-white p-6 rounded-lg shadow-sm">
          <h1 class="text-3xl font-extrabold mb-2">Rectanglimit-calculatorle Area Calculator</h1>
          <p class="text-gray-700 mb-6">
            Enter two sides of a rectangle—length and width—in your preferred units to get the area
            (plus perimeter and diagonal). Built for students, engineers, architects, and anyone
            who needs accurate results with accessible, pro-grade UX.
          </p>

          <!-- CALCULATOR UI -->
          <section id="calculator" class="space-y-6" aria-labelledby="calc-heading">
            <h2 id="calc-heading" class="sr-only">Calculator inputs</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Length -->
              <div>
                <div class="flex items-center justify-between">
                  <label for="lengthValue" class="block text-sm font-medium">Length <span aria-hidden="true" class="text-red-600">*</span></label>
                  <button id="tip-length" class="tappable text-sm text-blue-700 underline" type="button" aria-expanded="false" aria-controls="length-help">
                    ?
                  </button>
                </div>
                <div class="mt-1 flex gap-3">
                  <input inputmode="decimal" type="number" id="lengthValue" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                         step="any" min="0" aria-required="true" aria-describedby="length-error length-help"
                         placeholder="e.g., 3.5" />
                  <select id="lengthUnit" class="tappable px-3 py-2 border border-gray-300 rounded-md" aria-label="Length unit">
                    <option value="m">m</option>
                    <option value="cm">cm</option>
                    <option value="mm">mm</option>
                    <option value="in">in</option>
                    <option value="ft">ft</option>
                  </select>
                </div>
                <p id="length-help" class="mt-1 text-sm text-gray-600 hidden">
                  Length is one side of the rectangle. Use any supported unit; conversions are handled automatically.
                </p>
                <p id="length-error" class="mt-1 text-sm text-red-600" role="alert" aria-live="polite"></p>
              </div>

              <!-- Width -->
              <div>
                <div class="flex items-center justify-between">
                  <label for="widthValue" class="block text-sm font-medium">Width <span aria-hidden="true" class="text-red-600">*</span></label>
                  <button id="tip-width" class="tappable text-sm text-blue-700 underline" type="button" aria-expanded="false" aria-controls="width-help">
                    ?
                  </button>
                </div>
                <div class="mt-1 flex gap-3">
                  <input inputmode="decimal" type="number" id="widthValue" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                         step="any" min="0" aria-required="true" aria-describedby="width-error width-help"
                         placeholder="e.g., 120" />
                  <select id="widthUnit" class="tappable px-3 py-2 border border-gray-300 rounded-md" aria-label="Width unit">
                    <option value="m">m</option>
                    <option value="cm">cm</option>
                    <option value="mm">mm</option>
                    <option value="in">in</option>
                    <option value="ft">ft</option>
                  </select>
                </div>
                <p id="width-help" class="mt-1 text-sm text-gray-600 hidden">
                  Width is the other side of the rectangle. Mixed units are allowed (e.g., length in m, width in cm).
                </p>
                <p id="width-error" class="mt-1 text-sm text-red-600" role="alert" aria-live="polite"></p>
              </div>

              <!-- Aspect lock & precision -->
              <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="flex items-center gap-3">
                  <input id="lockAspect" type="checkbox" class="tappable h-5 w-5 border-gray-300 rounded" />
                  <label for="lockAspect" class="text-sm">Lock aspect ratio (keep width proportional to length)</label>
                </div>

                <div>
                  <label for="precision" class="block text-sm font-medium">Decimal precision</label>
                  <select id="precision" class="tappable mt-1 px-3 py-2 border border-gray-300 rounded-md w-full" aria-label="Decimal precision">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Live diagram -->
            <div class="border rounded-lg p-4">
              <h3 class="font-semibold mb-2">Scaled sketch</h3>
              <div class="flex items-center gap-6">
                <svg id="diagram" width="240" height="160" viewBox="0 0 240 160" role="img" aria-label="Rectangle diagram with length and width">
                  <rect id="rectShape" x="10" y="10" width="160" height="100" fill="#dbeafe" stroke="#1d4ed8" stroke-width="2"></rect>
                  <line x1="10" y1="120" x2="170" y2="120" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)" />
                  <text id="lenLabel" x="90" y="140" text-anchor="middle" font-size="12" fill="#0f172a">length</text>

                  <line x1="180" y1="10" x2="180" y2="110" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)" />
                  <text id="widLabel" transform="rotate(-90 195,60)" x="195" y="60" text-anchor="middle" font-size="12" fill="#0f172a">width</text>

                  <defs>
                    <marker id="arrow" viewBox="0 0 10 10" refX="7" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                      <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748b"></path>
                    </marker>
                  </defs>
                </svg>
                <div class="text-sm text-gray-600">
                  The sketch scales automatically with your inputs and shows which side is “length” vs “width”.
                </div>
              </div>
            </div>

            <!-- Action buttons -->
            <div class="flex flex-wrap gap-3">
              <button id="btnCalculate" class="tappable bg-blue-700 hover:bg-blue-800 text-white font-semibold px-4 py-3 rounded-md">
                Calculate
              </button>
              <button id="btnReset" class="tappable bg-white border border-gray-300 hover:bg-gray-50 text-gray-900 font-semibold px-4 py-3 rounded-md">
                Reset
              </button>
              <button id="btnPrint" class="tappable bg-white border border-gray-300 hover:bg-gray-50 text-gray-900 font-semibold px-4 py-3 rounded-md">
                Print
              </button>
              <button id="btnCopy" class="tappable bg-white border border-gray-300 hover:bg-gray-50 text-gray-900 font-semibold px-4 py-3 rounded-md">
                Copy results
              </button>
            </div>
          </section>

          <!-- RESULTS -->
          <section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Results</h2>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
              <div class="result-card">
                <h4>Area</h4>
                <p id="areaPrimary">—</p>
                <div class="mt-2 text-xs text-gray-600" id="areaConversions"> </div>
              </div>
              <div class="result-card">
                <h4>Perimeter</h4>
                <p id="perimeter">—</p>
              </div>
              <div class="result-card">
                <h4>Diagonal</h4>
                <p id="diagonal">—</p>
              </div>
            </div>

            <div class="mt-4 text-sm text-gray-700" id="diagnostics" aria-live="polite"></div>
          </section>
        </div>

        <!-- AUTHORITATIVE CONTENT ECOSYSTEM -->
        <article class="bg-white p-6 rounded-lg shadow-sm mt-8 prose">
          <h2>Authoritative data source & methodology</h2>
          <p><strong>AuthoritativeDataSource:</strong> Wolfram MathWorld — “Rectangle” (accessed 2025), and NIST Special Publication 811 — “Guide for the Use of the International System of Units (SI)” for exact unit conversions (e.g., 1 in = 25.4 mm). All calculations use standard Euclidean geometry and exact SI/imperial conversion factors. <em>All calculations strictly rely on the formulas and data provided by these sources.</em></p>
          <ul>
            <li>Wolfram MathWorld: Rectangle — definitions and properties</li>
            <li>NIST SP 811: exact conversion constants for inch/mm, etc.</li>
          </ul>

          <h2>The formula explained</h2>
          <div class="formula-box">
            <p>Area of a rectangle:</p>
            <p>\\[ A = \ell \times w \\]</p>
            <p>Perimeter:</p>
            <p>\\[ P = 2(\ell + w) \\]</p>
            <p>Diagonal (Pythagoras):</p>
            <p>\\[ d = \sqrt{\ell^2 + w^2} \\]</p>
          </div>

          <h2>Glossary of variables</h2>
          <table class="w-full text-sm">
            <thead>
              <tr><th class="text-left">Symbol</th><th class="text-left">Meaning</th><th class="text-left">Unit</th></tr>
            </thead>
            <tbody>
              <tr><td><strong>\\(\ell\\)</strong></td><td>Length side</td><td>m, cm, mm, in, ft</td></tr>
              <tr><td><strong>\\(w\\)</strong></td><td>Width side</td><td>m, cm, mm, in, ft</td></tr>
              <tr><td><strong>\\(A\\)</strong></td><td>Area</td><td>m², cm², mm², in², ft²</td></tr>
              <tr><td><strong>\\(P\\)</strong></td><td>Perimeter</td><td>m, cm, mm, in, ft</td></tr>
              <tr><td><strong>\\(d\\)</strong></td><td>Diagonal length</td><td>m, cm, mm, in, ft</td></tr>
            </tbody>
          </table>

          <h2>How it works: a step-by-step example</h2>
          <p>Suppose \\(\ell = 3.2\\,\\text{m}\\) and \\(w = 120\\,\\text{cm} = 1.2\\,\\text{m}\\).</p>
          <ul>
            <li>Convert units to a common base (meters): already done above.</li>
            <li>Compute area: \\(A = 3.2 \\times 1.2 = 3.84\\,\\text{m}^2\\).</li>
            <li>Perimeter: \\(P = 2(3.2 + 1.2) = 8.8\\,\\text{m}\\).</li>
            <li>Diagonal: \\(d = \\sqrt{3.2^2 + 1.2^2} \\approx 3.42\\,\\text{m}\\).</li>
          </ul>

          <h2>Frequently asked questions</h2>
          <details>
            <summary>Can I mix units (e.g., length in feet and width in inches)?</summary>
            <p>Yes. The calculator converts everything to a common base internally and shows results in multiple area units.</p>
          </details>
          <details>
            <summary>What happens if I lock the aspect ratio?</summary>
            <p>When the lock is enabled, editing one side will proportionally adjust the other, preserving \\(\\ell/w\\).</p>
          </details>
          <details>
            <summary>How do you round results?</summary>
            <p>You control rounding via the “Decimal precision” selector. Internally, exact factors (like 25.4 mm per inch) are used before rounding the display.</p>
          </details>
          <details>
            <summary>Is diagonal computed using the Pythagorean theorem?</summary>
            <p>Yes: \\(d = \\sqrt{\\ell^2 + w^2}\\).</p>
          </details>
          <details>
            <summary>Can I print or copy results?</summary>
            <p>Use the “Print” and “Copy results” buttons. Printing hides the navigation and prints a clean report.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
              Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time>
            </p>
          </div>
        </article>
      </section>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-4 space-y-6">
          <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="font-bold text-lg mb-3">Why this calculator stands out</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Mix-and-match units with exact professional conversions.</li>
              <li>Instant, accessible validation and keyboard-first UX.</li>
              <li>Extra outputs: perimeter and diagonal, plus a scaled diagram.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="font-bold text-lg mb-3">Related geometry tools</h3>
            <ul class="text-sm space-y-2">
              <li><a class="text-blue-700 hover:underline" href="square-calculator.html">Square Area Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="triangle-calculator.html">Triangle Area Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="circle-calculator.html">Circle Area Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="rectangular-prism-volume.html">Rectangular Prism (3D) Volume Calculator</a></li>
            </ul>
          </div>
          <div class="bg-gray-100 rounded-lg h-60 flex items-center justify-center text-gray-500">
            Ad Placement (300×250)
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-4 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  (function(){
    // ----- Utilities -----
    const $ = (id) => document.getElementById(id);
    const clamp = (v) => (isFinite(v) ? v : 0);
    const toNum = (el) => parseFloat(el.value);
    const fmt = (v, p) => (isFinite(v) ? v.toFixed(p) : "—");

    // Exact conversion factors
    const unitToMeters = {
      m: 1,
      cm: 0.01,
      mm: 0.001,
      in: 0.0254, // exact
      ft: 0.3048  // exact
    };

    const metersTo = {
      m: 1,
      cm: 100,
      mm: 1000,
      in: 39.37007874015748, // 1/0.0254
      ft: 3.280839895013123  // 1/0.3048
    };

    // Elements
    const lengthValue = $("lengthValue");
    const lengthUnit  = $("lengthUnit");
    const widthValue  = $("widthValue");
    const widthUnit   = $("widthUnit");
    const precision   = $("precision");
    const lockAspect  = $("lockAspect");

    const areaPrimary = $("areaPrimary");
    const areaConversions = $("areaConversions");
    const perimeterEl = $("perimeter");
    const diagonalEl  = $("diagonal");
    const diagnostics = $("diagnostics");

    const lenErr = $("length-error");
    const widErr = $("width-error");

    const tipLenBtn = $("tip-length");
    const tipWidBtn = $("tip-width");
    const lenHelp = $("length-help");
    const widHelp = $("width-help");

    const btnCalc = $("btnCalculate");
    const btnReset = $("btnReset");
    const btnPrint = $("btnPrint");
    const btnCopy  = $("btnCopy");

    const rectShape = $("rectShape");
    const lenLabel = $("lenLabel");
    const widLabel = $("widLabel");

    // Accessibility: tooltip toggles
    function toggleTip(btn, panel) {
      const open = btn.getAttribute("aria-expanded") === "true";
      btn.setAttribute("aria-expanded", String(!open));
      panel.classList.toggle("hidden", open);
    }
    tipLenBtn.addEventListener("click", ()=>toggleTip(tipLenBtn, lenHelp));
    tipWidBtn.addEventListener("click", ()=>toggleTip(tipWidBtn, widHelp));
    tipLenBtn.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") { e.preventDefault(); tipLenBtn.click(); }});
    tipWidBtn.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") { e.preventDefault(); tipWidBtn.click(); }});

    // Validation (on blur) with constructive messages
    function validatePositiveNumber(input, errEl, label){
      const v = toNum(input);
      if (input.value.trim() === "") {
        errEl.textContent = `Please enter a value for ${label}.`;
        return false;
      }
      if (!isFinite(v)) {
        errEl.textContent = `The ${label} must be a number (use digits and a decimal point if needed).`;
        return false;
      }
      if (v <= 0) {
        errEl.textContent = `The ${label} must be greater than 0. Try a small positive value like 0.1.`;
        return false;
      }
      errEl.textContent = "";
      return true;
    }

    lengthValue.addEventListener("blur", ()=>validatePositiveNumber(lengthValue, lenErr, "length"));
    widthValue.addEventListener("blur",  ()=>validatePositiveNumber(widthValue,  widErr, "width"));

    // Aspect ratio lock
    let lastAspect = null; // length / width in meters
    function currentMeters(){
      const Lm = clamp(toNum(lengthValue)) * unitToMeters[lengthUnit.value];
      const Wm = clamp(toNum(widthValue))  * unitToMeters[widthUnit.value];
      return { Lm, Wm };
    }
    function updateAspect(){
      const { Lm, Wm } = currentMeters();
      if (Lm>0 && Wm>0) lastAspect = Lm / Wm;
    }
    [lengthValue, lengthUnit, widthValue, widthUnit].forEach(el=>{
      el.addEventListener("input", ()=>{
        if (lockAspect.checked) {
          // adjust the other side to preserve aspect
          const active = el === lengthValue || el === lengthUnit ? "length" : "width";
          const { Lm, Wm } = currentMeters();
          if (!lastAspect && Lm>0 && Wm>0) lastAspect = Lm / Wm;

          if (lastAspect && (Lm>0 || Wm>0)) {
            if (active==="length" && Lm>0) {
              const targetWm = Lm / lastAspect;
              const factor = metersTo[widthUnit.value];
              const newWidth = targetWm * factor;
              widthValue.value = Number.isFinite(newWidth) ? String(newWidth) : widthValue.value;
            } else if (active==="width" && Wm>0) {
              const targetLm = Wm * lastAspect;
              const factor = metersTo[lengthUnit.value];
              const newLength = targetLm * factor;
              lengthValue.value = Number.isFinite(newLength) ? String(newLength) : lengthValue.value;
            }
          }
        }
      });
      el.addEventListener("change", updateAspect);
    });

    // Diagram scaling
    function updateDiagram(Lm, Wm){
      // map meters to SVG units with a simple scale, keeping margins
      const maxW = 200, maxH = 120; // drawable area inside the 240x160 SVG
      let scale = Math.min(maxW / Lm, maxH / Wm);
      if (!isFinite(scale) || scale <= 0) scale = 1;

      const drawW = Math.max(10, Math.min(maxW, Lm * scale));
      const drawH = Math.max(10, Math.min(maxH, Wm * scale));
      rectShape.setAttribute("width", drawW.toString());
      rectShape.setAttribute("height", drawH.toString());

      // Recenter inside 240x160 with 10px top-left margin
      rectShape.setAttribute("x", "10");
      rectShape.setAttribute("y", "10");

      lenLabel.textContent = "length";
      widLabel.textContent = "width";
    }

    // Main compute
    function compute(){
      const prec = parseInt(precision.value, 10);
      const okL = validatePositiveNumber(lengthValue, lenErr, "length");
      const okW = validatePositiveNumber(widthValue,  widErr, "width");
      if (!okL || !okW) {
        areaPrimary.textContent = "—";
        areaConversions.textContent = "";
        perimeterEl.textContent = "—";
        diagonalEl.textContent = "—";
        diagnostics.textContent = "Please fix the highlighted inputs.";
        return;
      }

      // Convert to meters
      const Lm = clamp(toNum(lengthValue)) * unitToMeters[lengthUnit.value];
      const Wm = clamp(toNum(widthValue))  * unitToMeters[widthUnit.value];

      // Core geometry
      const A_m2 = Lm * Wm;
      const P_m  = 2 * (Lm + Wm);
      const d_m  = Math.sqrt(Lm*Lm + Wm*Wm);

      // Display primary in SI (m² / m)
      areaPrimary.textContent = `${fmt(A_m2, prec)} m²`;
      perimeterEl.textContent = `${fmt(P_m, prec)} m`;
      diagonalEl.textContent  = `${fmt(d_m, prec)} m`;

      // Secondary conversions for area
      const A_cm2 = A_m2 * 1e4;   // 100*100
      const A_mm2 = A_m2 * 1e6;   // 1000*1000
      const A_in2 = A_m2 * (39.37007874015748**2);
      const A_ft2 = A_m2 * (3.280839895013123**2);

      areaConversions.innerHTML = `
        <div class="grid grid-cols-2 gap-x-4 gap-y-1">
          <span class="text-gray-600">= ${fmt(A_cm2, prec)} cm²</span>
          <span class="text-gray-600">= ${fmt(A_mm2, prec)} mm²</span>
          <span class="text-gray-600">= ${fmt(A_in2, prec)} in²</span>
          <span class="text-gray-600">= ${fmt(A_ft2, prec)} ft²</span>
        </div>`;

      diagnostics.textContent = `Computed with exact unit factors (e.g., 1 in = 25.4 mm). Precision: ${prec} decimals.`;

      // Update diagram
      updateDiagram(Lm, Wm);
      // Update aspect memory
      updateAspect();
    }

    // Buttons
    btnCalc.addEventListener("click", compute);
    btnReset.addEventListener("click", ()=>{
      lengthValue.value = "";
      widthValue.value  = "";
      lengthUnit.value = "m";
      widthUnit.value  = "m";
      precision.value  = "2";
      lockAspect.checked = false;
      lenErr.textContent = "";
      widErr.textContent = "";
      areaPrimary.textContent = "—";
      areaConversions.textContent = "";
      perimeterEl.textContent = "—";
      diagonalEl.textContent = "—";
      diagnostics.textContent = "";
      updateDiagram(NaN, NaN);
      lastAspect = null;
    });
    btnPrint.addEventListener("click", ()=>window.print());
    btnCopy.addEventListener("click", async ()=>{
      const text = [
        "Rectangle Area Calculator — Results",
        `Length: ${lengthValue.value || "—"} ${lengthUnit.value}`,
        `Width:  ${widthValue.value  || "—"} ${widthUnit.value}`,
        `Area:   ${areaPrimary.textContent}`,
        `Perimeter: ${perimeterEl.textContent}`,
        `Diagonal:  ${diagonalEl.textContent}`
      ].join("\n");
      try {
        await navigator.clipboard.writeText(text);
        diagnostics.textContent = "Results copied to clipboard.";
      } catch {
        diagnostics.textContent = "Copy failed. Select and copy manually.";
      }
    });

    // Instant feedback on input
    [lengthValue, widthValue, lengthUnit, widthUnit, precision, lockAspect].forEach(el=>{
      el.addEventListener("input", ()=>{ /* passive to avoid jank */ });
      el.addEventListener("change", compute);
    });

    // Initial diagram
    updateDiagram(NaN, NaN);
  })();
  </script>
</body>
</html>
