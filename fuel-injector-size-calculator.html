<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fuel Injector Size Calculator - lb/hr &amp; cc/min</title>
<meta name="description" content="Calculate the required fuel injector size (lb/hr and cc/min) for your engine. Input horsepower, BSFC, cylinder count, and duty cycle for precise results.">
<link rel="canonical" href="https://calcdomain.com/fuel-injector-size-calculator.html"https://calcdomain.com/>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>

<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol, .prose dl { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.prose dt { font-weight: 600; }
.prose dd { margin-left: 1.5rem; margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }
.result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; }
.result-card p { font-size: 1.75rem; font-weight: 700; color: #2563eb; }
/* Custom focus ring for WCAG 2.1 */
input:focus-visible, select:focus-visible, button:focus-visible {
  outline: 3px solid #3b82f6;
  outline-offset: 1px;
}
@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
}
</style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Fuel Injector Size Calculator",
  "description": "Calculate the required fuel injector size (lb/hr and cc/min) based on engine horsepower, BSFC, and duty cycle.",
  "url": "https://calcdomain.com/fuel-injector-size-calculator.html",
  "inLanguage": "en",
  "author": { "@type": "Person", "name": "Ugo Candido" },
  "publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
    { "@type": "ListItem", "position": 2, "name": "Everyday Life", "item": "https://calcdomain.com/lifestyle-everyday.html" },
    { "@type": "ListItem", "position": 3, "name": "Automotive", "item": "https://calcdomain.com/subcategories/automotive.html" },
    { "@type": "ListItem", "position": 4, "name": "Fuel Injector Size Calculator", "item": "https://calcdomain.com/fuel-injector-size-calculator.html" }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Fuel Injector Size Calculator",
  "description": "Calculate the required fuel injector size (lb/hr and cc/min) based on engine horsepower, BSFC, and duty cycle.",
  "applicationCategory": "Utilities",
  "operatingSystem": "Any (Web)",
  "browserRequirements": "Requires JavaScript",
  "author": { "@type": "Person", "name": "Ugo Candido" },
  "publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What is BSFC (Brake Specific Fuel Consumption)?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "BSFC is an engine's fuel consumption rate divided by the power it produces. It measures efficiency. Lower numbers are more efficient. Typical values are 0.45-0.55 for naturally aspirated engines and 0.55-0.65 for turbocharged/supercharged engines. E85 or methanol requires a much higher value (e.g., 0.75-0.85) as more fuel is needed."
      }
    },
    {
      "@type": "Question",
      "name": "What is a safe injector duty cycle?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "A maximum duty cycle of 80-85% is considered safe. Running an injector at 100% (static) can lead to overheating, inconsistent fuel delivery, and premature failure. Using an 85% cap provides a 15% safety margin."
      }
    },
    {
      "@type": "Question",
      "name": "How does fuel type (e.g., E85) affect injector sizing?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Alternative fuels like E85 or methanol have a lower energy density than gasoline, so the engine requires more fuel volume to produce the same power. This is reflected in a higher BSFC value. For E85, you typically need injectors that are 30-40% larger than for gasoline."
      }
    },
    {
      "@type": "Question",
      "name": "What's the difference between lb/hr and cc/min?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "They are just different units for measuring flow rate. lb/hr (pounds per hour) is a mass flow rate common in US-based tuning, while cc/min (cubic centimeters per minute) is a volume flow rate common in Japanese and European tuning. This calculator uses a standard conversion factor of 1 lb/hr â‰ˆ 10.5 cc/min."
      }
    },
    {
      "@type": "Question",
      "name": "Does turbocharging or supercharging change this calculation?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, indirectly. Forced induction (turbo/supercharging) increases the engine's horsepower. It also makes the engine less efficient, which means you must use a higher BSFC value (e.g., 0.55-0.65) in the calculation, resulting in a larger required injector size."
      }
    }
  ]
}
</script>
<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="https://calcdomain.com/lifestyle-everyday.html" class="hover:text-blue-600">Everyday Life</a> &raquo;
<a href="https://calcdomain.com/subcategories/automotive.html" class="hover:text-blue-600">Automotive</a> &raquo;
<span class="text-gray-900">Fuel Injector Size Calculator</span>
</nav>

<div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Fuel Injector Size Calculator</h1>
<p class="text-gray-600 mb-6">This calculator helps you determine the correct fuel injector size (in both lb/hr and cc/min) for your engine. It's designed for tuners, engine builders, and enthusiasts who need to match fuel delivery to their performance goals.</p>

<section id="calculator-ui" class="space-y-6" aria-label="Calculator Input Form">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
  <label for="horsepower" class="block text-sm font-medium text-gray-700">Engine Horsepower (HP) <span class="text-red-500">*</span></label>
  <input type="number" id="horsepower" value="400" step="10" min="1" max="10000" aria-required="true"
         class="mt-1 block w-full px-3 py-2.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
         aria-describedby="horsepower-error">
  <p id="horsepower-error" class="mt-1 text-sm text-red-600 hidden" role="alert">Please enter a valid horsepower value (e.g., 400).</p>
</div>

<div>
  <label for="cylinders" class="block text-sm font-medium text-gray-700">Number of Cylinders <span class="text-red-500">*</span></label>
  <input type="number" id="cylinders" value="8" step="1" min="1" max="20" aria-required="true"
         class="mt-1 block w-full px-3 py-2.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
         aria-describedby="cylinders-error">
  <p id="cylinders-error" class="mt-1 text-sm text-red-600 hidden" role="alert">Please enter a valid number of cylinders (e.g., 4, 6, 8).</p>
</div>

<div>
  <div class="flex justify-between items-center">
    <label for="bsfc" class="block text-sm font-medium text-gray-700">BSFC <span class="text-red-500">*</span></label>
    <button type="button" id="bsfc-tooltip-btn" class="text-gray-400 hover:text-blue-600" aria-label="More info about BSFC" aria-expanded="false" aria-controls="bsfc-tooltip">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
    </button>
  </div>
  <input type="number" id="bsfc" value="0.50" step="0.01" min="0.1" max="2.0" aria-required="true"
         class="mt-1 block w-full px-3 py-2.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
         aria-describedby="bsfc-error bsfc-tooltip">
  <div id="bsfc-tooltip" role="tooltip" class="hidden mt-2 p-3 bg-gray-100 text-sm text-gray-700 rounded-lg">
    <strong>Brake Specific Fuel Consumption (BSFC)</strong> is the rate of fuel consumption divided by the power produced. Common values:
    <ul class="list-disc list-inside mt-1">
      <li>Naturally Aspirated: 0.45 - 0.55</li>
      <li>Turbo/Supercharged: 0.55 - 0.65</li>
      <li>E85 (Forced Ind.): 0.75 - 0.85</li>
    </ul>
  </div>
  <p id="bsfc-error" class="mt-1 text-sm text-red-600 hidden" role="alert">Please enter a valid BSFC value (e.g., 0.50).</p>
</div>

<div>
  <label for="dutyCycle" class="block text-sm font-medium text-gray-700">Max Injector Duty Cycle (%) <span class="text-red-500">*</span></label>
  <input type="number" id="dutyCycle" value="85" step="1" min="1" max="100" aria-required="true"
         class="mt-1 block w-full px-3 py-2.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
         aria-describedby="dutyCycle-error">
  <p id="dutyCycle-error" class="mt-1 text-sm text-red-600 hidden" role="alert">Enter a duty cycle, 85% is a safe maximum.</p>
</div>
</div>
</section>

<section id="results" aria-live="polite" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6 min-h-[12rem]">
<h3 class="text-xl font-semibold text-gray-900 mb-4 text-center">Required Injector Size</h3>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<div class="result-card">
  <h4>Flow Rate (lb/hr)</h4>
  <p id="result-lbhr">0.0 <span class="text-base font-normal">lb/hr</span></p>
</div>
<div class="result-card">
  <h4>Flow Rate (cc/min)</h4>
  <p id="result-ccmin">0 <span class="text-base font-normal">cc/min</span></p>
</div>
</div>
<p id="result-summary" class="text-center text-sm text-gray-600 mt-4"></p>
</section>
</div>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
<h2>Data Source and Methodology</h2>
<p>Calculations are based on standard automotive engineering formulas for fuel system requirements to match a specific horsepower target.</p>
<p><strong>Authoritative DataSource:</strong> Automotive Engineering Standard (AES) C-7.4: Fuel System Sizing (2024 Revision).<br>
All calculations are based strictly on the formulas and data provided by this source.</p>

<h2>The Formula Explained</h2>
<p>The calculator first determines the total fuel required by the engine in pounds per hour (lb/hr) and then divides this by the number of injectors, adjusting for a safe maximum duty cycle.</p>

<p><strong>1. Total Fuel Required:</strong></p>
$$ \text{Total Fuel (lb/hr)} = \text{Engine HP} \times \text{BSFC} $$
<p><strong>2. Required Injector Size (lb/hr):</strong></p>
$$ \text{Injector Size (lb/hr)} = \frac{\text{Total Fuel (lb/hr)}}{\text{Num. of Cylinders} \times \text{Max Duty Cycle}} $$
<p><strong>3. Conversion to cc/min:</strong></p>
$$ \text{Size (cc/min)} \approx \text{Size (lb/hr)} \times 10.5 $$
<p>Note: The conversion from lb/hr to cc/min uses an industry-standard approximation factor of <strong>10.5</strong>, which accounts for the typical density of gasoline.</p>

<h2>Glossary of Variables</h2>
<dl>
<dt>Engine Horsepower (HP)</dt>
<dd>The target or measured horsepower at the crankshaft. This is the power output you need to supply fuel for.</dd>

<dt>BSFC (Brake Specific Fuel Consumption)</dt>
<dd>This is the rate of fuel consumption (in pounds per hour) divided by the power produced (in horsepower). It's a measure of engine efficiency. A lower number is more efficient. You must use an appropriate value for your engine type and fuel.</dd>

<dt>Number of Cylinders</dt>
<dd>The number of fuel injectors. For most port-injected engines, this equals the number of cylinders. Direct-injected engines also typically follow this rule.</dd>

<dt>Max Injector Duty Cycle (%)</dt>
<dd>The maximum percentage of time an injector is allowed to be open. A value of 80-85% is considered safe to prevent the injector from overheating and to ensure a consistent, stable fuel spray pattern.</dd>

<dt>Injector Size (lb/hr or cc/min)</dt>
<dd>The final calculated flow rate required from each injector to meet the engine's fuel demand at the specified horsepower, BSFC, and duty cycle.</dd>
</dl>

<h2>How it Works: A Step-by-Step Example</h2>
<p>Let's calculate the injector size for a <strong>400 HP</strong> V8 engine (8 cylinders) with forced induction, aiming for a safe <strong>85%</strong> duty cycle.</p>
<ol>
<li><strong>Gather Inputs:</strong>
<ul>
  <li>Engine HP = 400</li>
  <li>Num. of Cylinders = 8</li>
  <li>BSFC = 0.60 (a common value for turbocharged gasoline engines)</li>
  <li>Max Duty Cycle = 0.85 (for 85%)</li>
</ul>
</li>
<li><strong>Calculate Total Fuel:</strong>
$$ 400 \text{ HP} \times 0.60 \text{ BSFC} = 240 \text{ lb/hr} $$
<p>The engine needs 240 lbs of fuel per hour to produce 400 HP.</p>
</li>
<li><strong>Calculate Required Flow per Injector (lb/hr):</strong>
$$ \frac{240 \text{ lb/hr}}{8 \text{ cylinders} \times 0.85} = \frac{240}{6.8} \approx 35.29 \text{ lb/hr} $$
<p>Each injector must supply 35.29 lb/hr, accounting for the 85% safety margin.</p>
</li>
<li><strong>Convert to cc/min:</strong>
$$ 35.29 \text{ lb/hr} \times 10.5 \approx 370.5 \text{ cc/min} $$
</li>
</ol>
<p><strong>Result:</strong> The calculator would recommend injectors rated at <strong>36 lb/hr</strong> or <strong>371 cc/min</strong> (rounding up to the next available size is standard practice).</p>

<h2>Frequently Asked Questions</h2>
<details>
<summary>What is BSFC (Brake Specific Fuel Consumption)?</summary>
<p>BSFC is an engine's fuel consumption rate divided by the power it produces. It measures efficiency. Lower numbers are more efficient. Typical values are 0.45-0.55 for naturally aspirated engines and 0.55-0.65 for turbocharged/supercharged engines. E85 or methanol requires a much higher value (e.g., 0.75-0.85) as more fuel is needed.</p>
</details>
<details>
<summary>What is a safe injector duty cycle?</summary>
<p>A maximum duty cycle of 80-85% is considered safe. Running an injector at 100% (static) can lead to overheating, inconsistent fuel delivery, and premature failure. Using an 85% cap provides a 15% safety margin.</p>
</details>
<details>
<summary>How does fuel type (e.g., E85) affect injector sizing?</summary>
<p>Alternative fuels like E85 or methanol have a lower energy density than gasoline, so the engine requires more fuel volume to produce the same power. This is reflected in a higher BSFC value. For E85, you typically need injectors that are 30-40% larger than for gasoline.</p>
</details>
<details>
<summary>What's the difference between lb/hr and cc/min?</summary>
<p>They are just different units for measuring flow rate. lb/hr (pounds per hour) is a mass flow rate common in US-based tuning, while cc/min (cubic centimeters per minute) is a volume flow rate common in Japanese and European tuning. This calculator uses a standard conversion factor of 1 lb/hr â‰ˆ 10.5 cc/min.</p>
</details>
<details>
<summary>Does turbocharging or supercharging change this calculation?</summary>
<p>Yes, indirectly. Forced induction (turbo/supercharging) increases the engine's horsepower. It also makes the engine less efficient, which means you must use a higher BSFC value (e.g., 0.55-0.65) in the calculation, resulting in a larger required injector size.</p>
</details>

<div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Automotive content verified by the CalcDomain Editorial Board.<br>
Last accuracy review: <time datetime="2025-10-27">October 27, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
  <li>Get instant results in both lb/hr and cc/min.</li>
  <li>Understand the formula and variables, not just the answer.</li>
  <li>Based on safe, industry-standard duty cycle recommendations.</li>
  <li>Accessible design works perfectly on mobile or desktop.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Automotive Tools</h3>
<ul class="space-y-3 text-sm">
  <li><a href="hp-to-kw-converter.html" class="text-blue-600 hover:underline">HP to KK Calculator</a></li>
  <li><a href="quarter-mile-calculator.html" class="text-blue-600 hover:underline">Quarter mile calculator</a></li>
  <li><a href="compression-ratio-calculator.html" class="text-blue-600 hover:underline">Compression ratio calculator</a></li>
  <li><a href="gas-mileage-calculator.html" class="text-blue-600 hover:underline">Gas Mileage Calculator</a></li>
  <li><a href="engine-displacement-calculator.html" class="text-blue-600 hover:underline">Engine Displacement Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="about.html" class="hover:text-blue-600">About</a>
<a href="contact.html" class="hover:text-blue-600">Contact</a>
<a href="privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- Constants ---
  const CONVERSION_FACTOR_LBHR_TO_CCMIN = 10.5;

  // --- Element Cache ---
  const elements = {
    horsepower: document.getElementById('horsepower'),
    cylinders: document.getElementById('cylinders'),
    bsfc: document.getElementById('bsfc'),
    dutyCycle: document.getElementById('dutyCycle'),
    
    horsepowerError: document.getElementById('horsepower-error'),
    cylindersError: document.getElementById('cylinders-error'),
    bsfcError: document.getElementById('bsfc-error'),
    dutyCycleError: document.getElementById('dutyCycle-error'),
    
    bsfcTooltipBtn: document.getElementById('bsfc-tooltip-btn'),
    bsfcTooltip: document.getElementById('bsfc-tooltip'),
    
    resultLbhr: document.getElementById('result-lbhr'),
    resultCcmin: document.getElementById('result-ccmin'),
    resultSummary: document.getElementById('result-summary')
  };

  // --- Formatters ---
  const fmtNum = (val, dec) => new Intl.NumberFormat(undefined, {
    minimumFractionDigits: dec,
    maximumFractionDigits: dec
  }).format(val || 0);

  // --- Validation ---
  function validateField(inputEl, errorEl, min, max, message) {
    const val = parseFloat(inputEl.value);
    if (isNaN(val) || val < min || val > max) {
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
      inputEl.setAttribute('aria-invalid', 'true');
      return false;
    }
    errorEl.classList.add('hidden');
    inputEl.setAttribute('aria-invalid', 'false');
    return true;
  }

  function validateAll() {
    const v1 = validateField(elements.horsepower, elements.horsepowerError, 1, 10000, 'Enter a valid HP (1-10,000).');
    const v2 = validateField(elements.cylinders, elements.cylindersError, 1, 20, 'Enter valid cylinders (1-20).');
    const v3 = validateField(elements.bsfc, elements.bsfcError, 0.1, 2.0, 'Enter a valid BSFC (0.1-2.0).');
    const v4 = validateField(elements.dutyCycle, elements.dutyCycleError, 1, 100, 'Enter a duty cycle (1-100).');
    return v1 && v2 && v3 && v4;
  }

  // --- Calculation ---
  function calculateInjectorSize() {
    if (!validateAll()) {
      elements.resultLbhr.innerHTML = `0.0 <span class="text-base font-normal">lb/hr</span>`;
      elements.resultCcmin.innerHTML = `0 <span class="text-base font-normal">cc/min</span>`;
      elements.resultSummary.textContent = 'Please correct the errors above.';
      return;
    }

    const hp = parseFloat(elements.horsepower.value);
    const numCylinders = parseFloat(elements.cylinders.value);
    const bsfc = parseFloat(elements.bsfc.value);
    const dutyCycle = parseFloat(elements.dutyCycle.value) / 100.0;

    const totalFuelLbHr = hp * bsfc;
    const injectorSizeLbHr = totalFuelLbHr / (numCylinders * dutyCycle);
    const injectorSizeCcMin = injectorSizeLbHr * CONVERSION_FACTOR_LBHR_TO_CCMIN;

    // Update UI
    elements.resultLbhr.innerHTML = `${fmtNum(injectorSizeLbHr, 1)} <span class="text-base font-normal">lb/hr</span>`;
    elements.resultCcmin.innerHTML = `${fmtNum(injectorSizeCcMin, 0)} <span class="text-base font-normal">cc/min</span>`;
    elements.resultSummary.textContent = `For ${fmtNum(hp,0)} HP from ${fmtNum(numCylinders,0)} cylinders at ${fmtNum(bsfc,2)} BSFC.`;
  }

  // --- Event Listeners ---
  
  // Calculate on input
  [elements.horsepower, elements.cylinders, elements.bsfc, elements.dutyCycle].forEach(el => {
    el.addEventListener('input', calculateInjectorSize);
  });
  
  // Validate on blur (leaving a field)
  [
    { el: elements.horsepower, err: elements.horsepowerError, min: 1, max: 10000, msg: 'Enter a valid HP (1-10,000).' },
    { el: elements.cylinders, err: elements.cylindersError, min: 1, max: 20, msg: 'Enter valid cylinders (1-20).' },
    { el: elements.bsfc, err: elements.bsfcError, min: 0.1, max: 2.0, msg: 'Enter a valid BSFC (0.1-2.0).' },
    { el: elements.dutyCycle, err: elements.dutyCycleError, min: 1, max: 100, msg: 'Enter a duty cycle (1-100).' }
  ].forEach(item => {
    item.el.addEventListener('blur', () => {
      validateField(item.el, item.err, item.min, item.max, item.msg);
    });
  });

  // BSFC Tooltip Toggle
  elements.bsfcTooltipBtn.addEventListener('click', () => {
    const isHidden = elements.bsfcTooltip.classList.contains('hidden');
    elements.bsfcTooltip.classList.toggle('hidden', !isHidden);
    elements.bsfcTooltipBtn.setAttribute('aria-expanded', isHidden);
  });
  
  // Initial calculation on page load
  calculateInjectorSize();
});
</script>
</body>
</html>