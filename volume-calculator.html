<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Volume Calculator</title>
  <meta name="description" content="Professional volume calculator for common 3D shapes. Compute volume with step-by-step LaTeX formulas, inline validation, and unit conversions to m³, liters, and US gallons.">
  <link rel="canonical" href="https://calcdomain.com/volume-calculator.html">
  <meta name="author" content="Ugo Candido">

  <!-- Icons (optional placeholders to align with site conventions) -->
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png">
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- MathJax for LaTeX -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>

  <style>
    :root { --focus:#2563eb; --border:#d1d5db; }
    body{ font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Helvetica Neue",Arial; }
    .prose{ max-width:70ch; }
    .prose h2{ font-size:1.5rem; font-weight:700; margin-top:2rem; margin-bottom:.75rem; }
    .prose h3{ font-size:1.125rem; font-weight:600; margin-top:1.25rem; margin-bottom:.5rem; }
    .prose p{ margin-bottom:.9rem; line-height:1.65; }
    .prose ul,.prose ol{ margin-left:1.25rem; margin-bottom:.75rem; }
    .formula-box{ background:#f3f4f6; border:1px solid var(--border); border-radius:10px; padding:1rem; overflow:auto;
                  font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
    :is(a,button,input,select,summary,textarea):focus { outline:3px solid var(--focus); outline-offset:2px; }
    .touch-target{ min-height:48px; }
    #results-panel{ min-height:20rem; } /* Prevent CLS */
    @media print{
      #site-aside,#site-nav,#faq,#howto{ display:none!important; }
      body{ background:#fff; }
      main{ padding:0; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Volume Calculator",
    "description":"Compute volume for common 3D shapes with validation, LaTeX formulas, and unit conversions.",
    "url":"https://calcdomain.com/math/geometry/volume-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Geometry","item":"https://calcdomain.com/math/geometry.html"},
      {"@type":"ListItem","position":4,"name":"Volume Calculator","item":"https://calcdomain.com/math/geometry/volume-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: WebApplication (Calculator) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Volume Calculator",
    "applicationCategory":"Calculator",
    "operatingSystem":"Web",
    "url":"https://calcdomain.com/math/geometry/volume-calculator.html",
    "creator":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "featureList":[
      "Multiple shapes (cube, rectangular prism, cylinder, cone, sphere, triangular prism, square pyramid, elliptical cylinder)",
      "Inline validation and accessible tooltips",
      "Unit conversions to m³, liters, and US gallons",
      "LaTeX formulas with methodology and worked example"
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script id="howto-jsonld" type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to use the Volume Calculator",
    "description":"Choose a shape, enter dimensions with a unit, and review volume and conversions.",
    "step":[
      {"@type":"HowToStep","name":"Select shape","text":"Pick the 3D shape that matches your object."},
      {"@type":"HowToStep","name":"Enter dimensions","text":"Provide the required dimensions in consistent units (mm, cm, m, in, ft, yd)."},
      {"@type":"HowToStep","name":"Calculate","text":"The tool applies shape-specific formulas to compute volume."},
      {"@type":"HowToStep","name":"Review conversions","text":"See the result in cubic units, plus m³, liters, and US gallons."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script id="faq-jsonld" type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Which shapes are supported?",
       "acceptedAnswer":{"@type":"Answer","text":"Cube, rectangular prism, cylinder, cone, sphere, triangular prism, square pyramid, and elliptical cylinder."}},
      {"@type":"Question","name":"Which units can I use?",
       "acceptedAnswer":{"@type":"Answer","text":"mm, cm, m, in, ft, or yd. Conversions to m³, liters, and US gallons are provided."}},
      {"@type":"Question","name":"How precise are the results?",
       "acceptedAnswer":{"@type":"Answer","text":"Double-precision calculations with sensible rounding. Minor floating-point round-off may occur."}},
      {"@type":"Question","name":"Do you support irregular shapes?",
       "acceptedAnswer":{"@type":"Answer","text":"No direct support. Approximate by decomposing into supported primitives."}},
      {"@type":"Question","name":"Are results suitable for ordering materials?",
       "acceptedAnswer":{"@type":"Answer","text":"Yes, but always add a safety margin per supplier guidance and project constraints."}},
      {"@type":"Question","name":"Can I convert to gallons?",
       "acceptedAnswer":{"@type":"Answer","text":"Yes, US gallons are shown by default (1 m³ ≈ 264.172 US gal)."}}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky to maximize mobile viewport) -->
  <header class="bg-white border-b">
    <nav id="site-nav" class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <a href="search.html" class="text-sm text-gray-700 hover:text-blue-700">Search</a>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
      <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
      <a href="math/geometry.html" class="hover:text-blue-700">Geometry</a> &raquo;
      <span class="text-gray-900">Volume Calculator</span>
    </nav>

    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <!-- 1) H1 -->
        <h1 class="text-3xl font-extrabold mb-2">Volume Calculator</h1>

        <!-- 2) Intro -->
        <p class="text-gray-700 mb-6">
          Choose a 3D shape, enter dimensions, and get volume instantly—with step-by-step LaTeX formulas and conversions to cubic meters, liters, and US gallons. Designed for students, engineers, contractors, and anyone planning materials or storage capacity.
        </p>

        <!-- 3) Calculator -->
        <section class="bg-white p-6 rounded-lg shadow-sm border" aria-labelledby="calc-heading">
          <h2 id="calc-heading" class="sr-only">Calculator</h2>

          <!-- Shape selector -->
          <div class="mb-4">
            <label for="shape" class="block text-sm font-medium text-gray-900">Shape <span class="text-red-600">*</span></label>
            <select id="shape" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none touch-target"
                    aria-required="true" aria-describedby="shape-help shape-err">
              <option value="cube" selected>Cube</option>
              <option value="rectprism">Rectangular Prism (Box)</option>
              <option value="cylinder">Right Circular Cylinder</option>
              <option value="cone">Right Circular Cone</option>
              <option value="sphere">Sphere</option>
              <option value="triprism">Right Triangular Prism</option>
              <option value="sqpyramid">Square Pyramid</option>
              <option value="elliptcyl">Elliptical Cylinder</option>
            </select>
            <p id="shape-help" class="text-xs text-gray-600 mt-1">Pick the solid that best approximates your object.</p>
            <p id="shape-err" class="text-xs text-red-700 mt-1"></p>
          </div>

          <!-- Units -->
          <div class="mb-4">
            <label for="unit" class="block text-sm font-medium text-gray-900">Length Unit <span class="text-red-600">*</span></label>
            <select id="unit" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none touch-target"
                    aria-required="true" aria-describedby="unit-help unit-err">
              <option value="mm">mm</option>
              <option value="cm" selected>cm</option>
              <option value="m">m</option>
              <option value="in">in</option>
              <option value="ft">ft</option>
              <option value="yd">yd</option>
            </select>
            <p id="unit-help" class="text-xs text-gray-600 mt-1">All dimensions must use the same unit.</p>
            <p id="unit-err" class="text-xs text-red-700 mt-1"></p>
          </div>

          <!-- Dynamic fields -->
          <form id="vol-form" novalidate class="space-y-6" aria-describedby="form-help">
            <p id="form-help" class="text-sm text-gray-600">
              Fields marked with <span aria-hidden="true" class="text-red-600">*</span> are required. Hover/focus the <span aria-hidden="true">?</span> for tips.
            </p>

            <div id="fields-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Default = Cube: side -->
              <div data-field="side" class="js-field">
                <label for="side" class="block text-sm font-medium text-gray-900">Side s <span class="text-red-600">*</span></label>
                <div class="flex items-start gap-2">
                  <input type="number" inputmode="decimal" step="any" min="0" id="side"
                         class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none touch-target"
                         aria-describedby="side-help side-err" placeholder="e.g., 5.2">
                  <button type="button" class="mt-1 px-2 py-2 text-gray-700 border border-gray-300 rounded-md touch-target"
                          aria-label="More info about side length" aria-expanded="false" aria-controls="side-help" data-tooltip="side">?</button>
                </div>
                <p id="side-help" class="text-xs text-gray-600 mt-1 hidden">Edge length of the cube.</p>
                <p id="side-err" class="text-xs text-red-700 mt-1"></p>
              </div>
            </div>

            <div class="flex items-center gap-3">
              <button id="calc-btn" type="button"
                      class="touch-target px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md"
                      aria-describedby="action-help">Calculate</button>
              <button id="clear-btn" type="button"
                      class="touch-target px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-900 font-semibold rounded-md">Clear</button>
              <p id="action-help" class="sr-only">Press Calculate to compute results. Press Clear to reset all fields.</p>
            </div>
          </form>
        </section>

        <!-- 4) Results -->
        <section id="results-panel" class="mt-6 bg-blue-50 border border-blue-100 rounded-lg p-6" aria-live="polite">
          <h2 class="text-xl font-bold mb-4">Results</h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
              <div class="bg-white border rounded-lg p-3 text-center">
                <div class="text-sm text-gray-600">Volume (unit³)</div>
                <div id="res-unit3" class="text-2xl font-bold text-blue-700">—</div>
              </div>
              <div class="bg-white border rounded-lg p-3 text-center">
                <div class="text-sm text-gray-600">Volume (m³)</div>
                <div id="res-m3" class="text-2xl font-bold text-blue-700">—</div>
              </div>
              <div class="bg-white border rounded-lg p-3 text-center">
                <div class="text-sm text-gray-600">Liters (L)</div>
                <div id="res-liters" class="text-2xl font-bold text-blue-700">—</div>
              </div>
              <div class="bg-white border rounded-lg p-3 text-center">
                <div class="text-sm text-gray-600">US Gallons</div>
                <div id="res-gal" class="text-2xl font-bold text-blue-700">—</div>
              </div>
              <div class="bg-white border rounded-lg p-3 text-center">
                <div class="text-sm text-gray-600">Shape</div>
                <div id="res-shape" class="text-lg font-semibold text-blue-700">—</div>
              </div>
            </div>

            <!-- Diagram -->
            <div class="bg-white border rounded-lg p-3">
              <figure aria-labelledby="dia-caption">
                <svg id="dia-svg" viewBox="0 0 260 200" role="img" aria-describedby="dia-desc" class="w-full h-auto">
                  <desc id="dia-desc">Simplified diagram of the selected shape with labeled dimensions.</desc>
                  <!-- Default cube sketch -->
                  <rect x="60" y="50" width="120" height="120" fill="#dbeafe" stroke="#1d4ed8" stroke-width="2">
                  <text id="lab-1" x="120" y="190" font-size="12" fill="#111827" text-anchor="middle">s</text>
                  <text id="lab-2" x="190" y="120" font-size="12" fill="#111827">s</text>
                  <text id="lab-3" x="40" y="40" font-size="12" fill="#111827"></text>
                </svg>
                <figcaption id="dia-caption" class="text-sm text-gray-700 mt-2">Schematic (not to scale). Labels update per shape.</figcaption>
              </figure>
            </div>
          </div>

          <details class="mt-6 bg-white rounded-lg border" id="howto">
            <summary class="px-4 py-3 font-semibold text-gray-900 cursor-pointer">Step-by-step (derivation & checks)</summary>
            <div class="p-4 space-y-3">
              <div class="formula-box" id="formula-box">
                For a cube with side \(s\): \(V = s^3\).
              </div>
              <p id="step-text" class="text-sm text-gray-700"></p>
            </div>
          </details>
        </section>

        <!-- 5) Authoritative content -->
        <section class="prose bg-white p-6 rounded-lg shadow-sm border mt-8">
          <h2>Authoritative data source & methodology</h2>
          <p>
            <strong>AuthoritativeDataSource:</strong> Standard Euclidean solid geometry as compiled in reputable references:
            <a href="https://mathworld.wolfram.com/Volume.html" class="text-blue-700 underline" rel="nofollow">Wolfram MathWorld — Volume</a>,
            <a href="https://dlmf.nist.gov/" class="text-blue-700 underline" rel="nofollow">NIST Digital Library of Mathematical Functions</a>.
            <br/><em>All calculations strictly follow the formulas and definitions provided by this source.</em>
          </p>

          <h2>The formulas explained</h2>
          <div class="formula-box">
            Cube: \(V=s^3\).<br/>
            Rectangular prism: \(V=\ell\cdot w\cdot h\).<br/>
            Cylinder: \(V=\pi r^2 h\).<br/>
            Cone: \(V=\tfrac{1}{3}\pi r^2 h\).<br/>
            Sphere: \(V=\tfrac{4}{3}\pi r^3\).<br/>
            Right triangular prism: \(V=\left(\tfrac{1}{2} b\,h_t\right) L\), where \(b\) and \(h_t\) are the right-triangle base and height, \(L\) is prism length.<br/>
            Square pyramid: \(V=\tfrac{1}{3} a^2 h\), where \(a\) is base edge, \(h\) the vertical height.<br/>
            Elliptical cylinder: \(V=\pi a b h\), where \(a,b\) are semi-axes.
          </div>

          <h2>Glossary of variables</h2>
          <ul>
            <li><strong>s</strong>: side of a cube.</li>
            <li><strong>\(\ell, w, h\)</strong>: length, width, height of a rectangular prism.</li>
            <li><strong>r, h</strong>: radius and height (cylinder, cone).</li>
            <li><strong>a</strong>: edge of square base; <strong>h</strong>: vertical height (pyramid).</li>
            <li><strong>b, \(h_t\)</strong>: base and height of triangular face; <strong>L</strong>: length of prism.</li>
            <li><strong>a, b</strong> (elliptical cylinder): semi-major and semi-minor axes; <strong>h</strong>: height.</li>
          </ul>

          <h2>How it works: a step-by-step example</h2>
          <h3>Come Funziona: Un Esempio Passo-Passo</h3>
          <p><strong>Example:</strong> Cylinder with \(r=0.25\ \text{m}\) and \(h=1.2\ \text{m}\).</p>
          <ol>
            <li>Apply \(V=\pi r^2 h\Rightarrow V=\pi(0.25)^2(1.2)=\pi\cdot0.0625\cdot1.2=0.23562\ \text{m}^3\) (approx).</li>
            <li>Convert to liters: \(1\,\text{m}^3=1000\,\text{L}\Rightarrow 235.62\,\text{L}\) (approx).</li>
            <li>Convert to US gallons: \(1\,\text{m}^3\approx 264.172\,\text{gal}\Rightarrow 62.2\,\text{gal}\) (approx).</li>
          </ol>

          <h2 id="faq">Frequently Asked Questions (FAQ)</h2>
          <details><summary>Why do I need a single consistent unit?</summary>
            <p>Volume scales with the cube of length. Mixing units (e.g., cm and inches) will produce incorrect results. Choose one unit for all inputs.</p>
          </details>
          <details><summary>Can I compute capacity of a tank?</summary>
            <p>Yes—pick the shape that best matches your tank (cylinder or rectangular prism are common) and enter inner dimensions.</p>
          </details>
          <details><summary>Do you support cones with truncated tops (frustums)?</summary>
            <p>Not directly in this version. Approximate by subtracting the volume of the smaller top cone from the larger cone.</p>
          </details>
          <details><summary>How are liters and gallons computed?</summary>
            <p>We convert your result to m³, then multiply by 1000 for liters and by 264.172 for US gallons.</p>
          </details>
          <details><summary>Can I copy results?</summary>
            <p>Yes—tap to select and copy values. Results update live after you press Calculate.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Math content reviewed by the CalcDomain Editorial Board.<br/>
              Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
          </div>
        </section>
      </section>

      <!-- Aside -->
      <aside class="w-full lg:w-1/3" id="site-aside">
        <div class="sticky top-6 space-y-6">
          <div class="bg-white p-6 rounded-lg shadow-sm border">
            <h3 class="font-bold text-lg mb-3">Why this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>WCAG 2.1 AA interface with keyboardable tooltips.</li>
              <li>Multiple shapes with clear LaTeX formulas.</li>
              <li>Smart unit conversions to m³, liters, and US gallons.</li>
            </ul>
          </div>
          <div class="bg-gray-100 rounded-lg h-64 flex items-center justify-center text-gray-500 border">
            Ad Placement (300×600)
          </div>
          <div class="bg-white p-6 rounded-lg shadow-sm border">
            <h3 class="font-bold text-lg mb-3">Related geometry tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-700 hover:underline" href="triangle-calculator.html">Triangle Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="pythagorean-theorem-calculator.html">Pythagorean Theorem</a></li>
              <li><a class="text-blue-700 hover:underline" href="cylinder-volume-calculator.html">Cylinder Volume</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (placed at end for INP) -->
  <script>
  (function(){
    const $ = (id)=>document.getElementById(id);

    const els = {
      shape: $('shape'),
      unit: $('unit'),
      fieldsGrid: $('fields-grid'),
      calcBtn: $('calc-btn'),
      clearBtn: $('clear-btn'),
      resUnit3: $('res-unit3'),
      resM3: $('res-m3'),
      resLiters: $('res-liters'),
      resGal: $('res-gal'),
      resShape: $('res-shape'),
      formulaBox: $('formula-box'),
      stepText: $('step-text'),
      svg: $('dia-svg'),
      lab1: $('lab-1'), lab2: $('lab-2'), lab3: $('lab-3')
    };

    // Accessible tooltip toggles
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-tooltip]');
      if(!btn) return;
      const id = btn.getAttribute('data-tooltip') + '-help';
      const tip = $(id);
      if(!tip) return;
      const hidden = tip.classList.toggle('hidden');
      btn.setAttribute('aria-expanded', (!hidden).toString());
    });
    document.addEventListener('keydown', (e)=>{
      const btn = e.target.closest && e.target.closest('[data-tooltip]');
      if(!btn) return;
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); }
    });

    // Unit conversion to meters
    const toMeters = {
      mm: (v)=>v/1000,
      cm: (v)=>v/100,
      m:  (v)=>v,
      in: (v)=>v*0.0254,
      ft: (v)=>v*0.3048,
      yd: (v)=>v*0.9144
    };

    // Shape definitions: fields, volume function, formula LaTeX, diagram labels
    const shapes = {
      cube: {
        name: 'Cube',
        fields: [
          { key:'side', label:'Side s', help:'Edge length of the cube.', min:0 }
        ],
        formula: '\\(V=s^3\\)',
        calc: ({side}) => Math.pow(side,3),
        diagram: (u)=>{ setCubeDiagram(u); }
      },
      rectprism: {
        name: 'Rectangular Prism',
        fields: [
          { key:'len', label:'Length \\(\\ell\\)', help:'Longest edge.', min:0 },
          { key:'wid', label:'Width w', help:'Shorter horizontal edge.', min:0 },
          { key:'hei', label:'Height h', help:'Vertical edge.', min:0 }
        ],
        formula: '\\(V=\\ell\\,w\\,h\\)',
        calc: ({len,wid,hei}) => len*wid*hei,
        diagram: (u)=>{ setBoxDiagram(u); }
      },
      cylinder: {
        name: 'Right Circular Cylinder',
        fields: [
          { key:'r', label:'Radius r', help:'Half the diameter.', min:0 },
          { key:'h', label:'Height h', help:'Distance between bases.', min:0 }
        ],
        formula: '\\(V=\\pi r^2 h\\)',
        calc: ({r,h}) => Math.PI*r*r*h,
        diagram: (u)=>{ setCylinderDiagram(u); }
      },
      cone: {
        name: 'Right Circular Cone',
        fields: [
          { key:'r', label:'Radius r', help:'Half the base diameter.', min:0 },
          { key:'h', label:'Height h', help:'Perpendicular height.', min:0 }
        ],
        formula: '\\(V=\\tfrac{1}{3}\\pi r^2 h\\)',
        calc: ({r,h}) => (Math.PI*r*r*h)/3,
        diagram: (u)=>{ setConeDiagram(u); }
      },
      sphere: {
        name: 'Sphere',
        fields: [
          { key:'r', label:'Radius r', help:'Distance from center to surface.', min:0 }
        ],
        formula: '\\(V=\\tfrac{4}{3}\\pi r^3\\)',
        calc: ({r}) => (4/3)*Math.PI*Math.pow(r,3),
        diagram: (u)=>{ setSphereDiagram(u); }
      },
      triprism: {
        name: 'Right Triangular Prism',
        fields: [
          { key:'b', label:'Triangle base b', help:'Base of the right triangle face.', min:0 },
          { key:'ht', label:'Triangle height hₜ', help:'Height of the right triangle face.', min:0 },
          { key:'L', label:'Prism length L', help:'Length extruded along the third axis.', min:0 }
        ],
        formula: '\\(V=\\big(\\tfrac{1}{2} b\\,h_t\\big) L\\)',
        calc: ({b,ht,L}) => 0.5*b*ht*L,
        diagram: (u)=>{ setTriPrismDiagram(u); }
      },
      sqpyramid: {
        name: 'Square Pyramid',
        fields: [
          { key:'a', label:'Base edge a', help:'Edge of square base.', min:0 },
          { key:'h', label:'Height h', help:'Vertical height (apex to base plane).', min:0 }
        ],
        formula: '\\(V=\\tfrac{1}{3} a^2 h\\)',
        calc: ({a,h}) => (a*a*h)/3,
        diagram: (u)=>{ setPyramidDiagram(u); }
      },
      elliptcyl: {
        name: 'Elliptical Cylinder',
        fields: [
          { key:'a', label:'Semi-axis a', help:'Half of major axis.', min:0 },
          { key:'b', label:'Semi-axis b', help:'Half of minor axis.', min:0 },
          { key:'h', label:'Height h', help:'Distance between elliptical bases.', min:0 }
        ],
        formula: '\\(V=\\pi a b h\\)',
        calc: ({a,b,h}) => Math.PI*a*b*h,
        diagram: (u)=>{ setElliptCylDiagram(u); }
      }
    };

    // Render fields for current shape
    function renderFields(){
      els.fieldsGrid.innerHTML = '';
      const sh = shapes[els.shape.value];
      sh.fields.forEach(f=>{
        const safeId = f.key;
        const labelText = f.label.replace(/\\\\/g, '\\');
        const block = document.createElement('div');
        block.className = 'js-field';
        block.setAttribute('data-field', f.key);
        block.innerHTML = `
          <label for="${safeId}" class="block text-sm font-medium text-gray-900">${labelText} <span class="text-red-600">*</span></label>
          <div class="flex items-start gap-2">
            <input type="number" inputmode="decimal" step="any" min="${f.min}" id="${safeId}"
                   class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none touch-target"
                   aria-describedby="${safeId}-help ${safeId}-err" placeholder="e.g., 10">
            <button type="button" class="mt-1 px-2 py-2 text-gray-700 border border-gray-300 rounded-md touch-target"
                    aria-label="More info about ${f.key}" aria-expanded="false" aria-controls="${safeId}-help" data-tooltip="${safeId}">?</button>
          </div>
          <p id="${safeId}-help" class="text-xs text-gray-600 mt-1 hidden">${f.help}</p>
          <p id="${safeId}-err" class="text-xs text-red-700 mt-1"></p>
        `;
        els.fieldsGrid.appendChild(block);
        // on-blur validation
        const input = $(safeId);
        const errEl = $(`${safeId}-err`);
        input.addEventListener('blur', ()=>{
          const v = parseFloat(input.value);
          if(input.value!=='' && (!Number.isFinite(v) || v<=0)){
            errEl.textContent = `${f.label.replace(/<[^>]+>/g,'').replace(/\\\(.*?\\\)/g,'').trim()} must be a positive number.`;
          } else errEl.textContent = '';
        });
      });

      // Update formula box and diagram labels
      els.formulaBox.textContent = '';
      els.formulaBox.innerHTML = getFormulaBlock(sh.formula);
      if(window.MathJax && window.MathJax.typesetPromise){ MathJax.typesetPromise(); }
      sh.diagram(els.unit.value);
    }

    function getFormulaBlock(tex){
      return `Using: ${tex}`;
    }

    // SVG helpers for simple schematics (labels only)
    function resetSVG(){
      // Clear by redrawing a neutral rectangle
      els.svg.innerHTML = `
        <desc id="dia-desc">Simplified diagram of the selected shape with labeled dimensions.</desc>
        <rect x="60" y="50" width="120" height="120" fill="#dbeafe" stroke="#1d4ed8" stroke-width="2">
        <text id="lab-1" x="120" y="190" font-size="12" fill="#111827" text-anchor="middle"></text>
        <text id="lab-2" x="210" y="120" font-size="12" fill="#111827"></text>
        <text id="lab-3" x="40" y="40" font-size="12" fill="#111827"></text>
      `;
      els.lab1 = $('lab-1'); els.lab2 = $('lab-2'); els.lab3 = $('lab-3');
    }
    function setCubeDiagram(u){ resetSVG(); els.lab1.textContent = `s (${u})`; els.lab2.textContent = `s`; }
    function setBoxDiagram(u){
      resetSVG();
      els.svg.querySelector('rect').setAttribute('width','140');
      els.svg.querySelector('rect').setAttribute('height','90');
      els.svg.querySelector('rect').setAttribute('x','50');
      els.svg.querySelector('rect').setAttribute('y','70');
      els.lab1.textContent = `ℓ (${u})`; els.lab2.textContent = `h (${u})`; els.lab3.textContent = `w (${u})`;
    }
    function setCylinderDiagram(u){
      resetSVG();
      els.svg.querySelector('rect').setAttribute('rx','60');
      els.lab1.textContent = `r (${u})`; els.lab2.textContent = `h (${u})`;
    }
    function setConeDiagram(u){
      resetSVG();
      els.lab1.textContent = `r (${u})`; els.lab2.textContent = `h (${u})`;
    }
    function setSphereDiagram(u){
      resetSVG();
      els.lab1.textContent = `r (${u})`;
    }
    function setTriPrismDiagram(u){
      resetSVG();
      els.lab1.textContent = `b (${u})`; els.lab2.textContent = `hₜ (${u})`; els.lab3.textContent = `L (${u})`;
    }
    function setPyramidDiagram(u){
      resetSVG();
      els.lab1.textContent = `a (${u})`; els.lab2.textContent = `h (${u})`;
    }
    function setElliptCylDiagram(u){
      resetSVG();
      els.lab1.textContent = `a (${u})`; els.lab2.textContent = `b (${u})`; els.lab3.textContent = `h (${u})`;
    }

    function parsePositive(id){
      const el = $(id), err = $(`${id}-err`);
      const v = parseFloat(el.value);
      if(!Number.isFinite(v) || v<=0){ err.textContent = 'Please enter a positive number.'; return null; }
      err.textContent = ''; return v;
    }

    function unitToMeters(u){ return toMeters[u] || ((v)=>v); }

    function compute(){
      const shapeKey = els.shape.value;
      const unit = els.unit.value;
      const sh = shapes[shapeKey];
      if(!sh){ return; }

      // Gather values and validate
      const values = {};
      for(const f of sh.fields){
        const v = parsePositive(f.key);
        if(v===null){ clearResults(); return; }
        values[f.key] = v;
      }

      // Compute raw volume in input unit^3
      const volUnit3 = sh.calc(values);
      if(!(volUnit3>0)){ clearResults(); return; }

      // Convert to cubic meters
      const conv = unitToMeters(unit);
      // Every linear dimension must be converted to meters first; because we computed in "unit" already,
      // multiply by (k^3) to convert volume to m^3
      const k = conv(1); // meters per unit
      const volM3 = volUnit3 * Math.pow(k,3);

      // Liters and US gallons
      const liters = volM3 * 1000;
      const gallonsUS = volM3 * 264.172052358;

      // Render
      els.resShape.textContent = sh.name;
      els.resUnit3.textContent = fmt(volUnit3) + ` ${unit}³`;
      els.resM3.textContent = fmt(volM3) + ' m³';
      els.resLiters.textContent = fmt(liters) + ' L';
      els.resGal.textContent = fmt(gallonsUS) + ' gal (US)';

      els.formulaBox.innerHTML = getFormulaBlock(sh.formula);
      els.stepText.textContent = stepExplain(shapeKey, values, unit, volUnit3, volM3, liters, gallonsUS);

      if(window.MathJax && window.MathJax.typesetPromise){ MathJax.typesetPromise(); }

      // Update diagram labels for unit
      sh.diagram(unit);
    }

    function stepExplain(shapeKey, v, unit, Vu, Vm3, L, Gal){
      switch(shapeKey){
        case 'cube':
          return `Using V = s^3 with s=${fmt(v.side)} ${unit}: V=${fmt(Vu)} ${unit}³ = ${fmt(Vm3)} m³ = ${fmt(L)} L = ${fmt(Gal)} US gal.`;
        case 'rectprism':
          return `Using V=ℓ·w·h with ℓ=${fmt(v.len)}, w=${fmt(v.wid)}, h=${fmt(v.hei)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        case 'cylinder':
          return `Using V=πr²h with r=${fmt(v.r)}, h=${fmt(v.h)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        case 'cone':
          return `Using V=(1/3)πr²h with r=${fmt(v.r)}, h=${fmt(v.h)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        case 'sphere':
          return `Using V=(4/3)πr³ with r=${fmt(v.r)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        case 'triprism':
          return `Using V=(1/2·b·hₜ)·L with b=${fmt(v.b)}, hₜ=${fmt(v.ht)}, L=${fmt(v.L)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        case 'sqpyramid':
          return `Using V=(1/3)a²h with a=${fmt(v.a)}, h=${fmt(v.h)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        case 'elliptcyl':
          return `Using V=πabh with a=${fmt(v.a)}, b=${fmt(v.b)}, h=${fmt(v.h)} ${unit}: V=${fmt(Vu)} ${unit}³ ⇒ ${fmt(Vm3)} m³.`;
        default: return '';
      }
    }

    function fmt(v){
      if(v==null || !Number.isFinite(v)) return '—';
      const s = Number(v.toFixed(6));
      return (''+s).replace(/(\.\d*?[1-9])0+$|\.0+$/,'$1');
    }

    function clearResults(){
      [els.resUnit3, els.resM3, els.resLiters, els.resGal, els.resShape].forEach(el=>el.textContent='—');
      els.stepText.textContent = '';
    }

    function clearAll(){
      // Reset fields
      renderFields();
      els.unit.value = 'cm';
      els.shape.value = 'cube';
      clearResults();
    }

    // Event wiring
    els.shape.addEventListener('change', renderFields);
    els.unit.addEventListener('change', ()=>{
      // Update diagram unit labels only
      const sh = shapes[els.shape.value];
      if(sh && typeof sh.diagram==='function'){ sh.diagram(els.unit.value); }
    });

    els.calcBtn.addEventListener('click', compute);
    els.clearBtn.addEventListener('click', clearAll);

    // Enter key triggers compute
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && e.target && e.target.tagName==='INPUT'){
        e.preventDefault(); compute();
      }
    });

    // Initial render
    renderFields();
    clearResults();
  })();
  </script>
</body>
</html>
