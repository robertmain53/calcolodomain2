<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quarter Mile Calculator — ET, Trap Speed, & HP</title>
  <meta name="description" content="Estimate 1/4-mile elapsed time (ET), trap speed (MPH), and horsepower from weight, ET, or HP. Includes 1/8-mile conversions, formulas with LaTeX, and authoritative sources." />
  <link rel="canonical" href="https://calcdomain.com/quarter-mile-calculator.html" />
  <meta name="author" content="Ugo Candido">
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MathJax for LaTeX -->
  <script>
    window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <!-- Chart.js (deferred below for logic) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --focus:#2563eb; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-weight:700; font-size:1.375rem; margin-top:1.5rem; margin-bottom:.75rem; }
    .prose h3 { font-weight:600; font-size:1.125rem; margin-top:1rem; margin-bottom:.5rem; }
    .formula-box{ background:#f3f4f6; border:1px solid #d1d5db; border-radius:.75rem; padding:1rem; overflow:auto }
    .result-card{ background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; text-align:center }
    .result-card h4{ font-size:.95rem; color:#4b5563; margin-bottom:.25rem }
    .result-card p{ font-size:1.5rem; font-weight:700; color:#1f2937 }
    .a11y-tip-btn:focus, .a11y-tip-btn:hover, .a11y-tip-btn:active,
    button:focus, select:focus, input:focus { outline: 3px solid var(--focus); outline-offset:2px }
    /* Prevent CLS by reserving space for results */
    #results { min-height: 260px }
    @media (prefers-reduced-motion: no-preference){
      .fade-in{ animation:fade .25s ease-in both }
      @keyframes fade{ from{opacity:0; transform: translateY(2px)} to{opacity:1; transform:none}}
    }
    @media print{
      body * { visibility:hidden }
      #print-section, #print-section * { visibility:visible }
      #print-section { position:absolute; inset:0; width:100% }
      #doughnutWrap { display:none !important }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Quarter Mile Calculator",
    "description":"Estimate quarter-mile elapsed time (ET), trap speed (MPH) and horsepower with empirical drag-racing formulas.",
    "url":"https://calcdomain.com/quarter-mile-calculator.html",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Everyday Life","item":"https://calcdomain.com/lifestyle-everyday.html"},
      {"@type":"ListItem","position":3,"name":"Automotive","item":"https://calcdomain.com/subcategories/automotive.html"},
      {"@type":"ListItem","position":4,"name":"Quarter Mile Calculator","item":"https://calcdomain.com/quarter-mile-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to estimate 1/4-mile ET, trap speed, or horsepower",
    "step":[
      {"@type":"HowToStep","name":"Select mode","text":"Choose whether to calculate ET/MPH from Weight+HP, or estimate HP from Weight+ET."},
      {"@type":"HowToStep","name":"Enter inputs","text":"Provide vehicle weight and horsepower, or weight and elapsed time. Pick unit system."},
      {"@type":"HowToStep","name":"View results","text":"The calculator shows ET, trap speed, and horsepower estimates with a chart and example schedule."},
      {"@type":"HowToStep","name":"Review assumptions","text":"Results use common empirical drag-racing formulas and assume proper traction and tune."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What formulas does this calculator use?","acceptedAnswer":{"@type":"Answer","text":"It uses widely referenced empirical relations such as ET = 5.825 × (Weight/HP)^(1/3) and MPH = 234 × (HP/Weight)^(1/3)."}},
      {"@type":"Question","name":"Are results wheel or flywheel horsepower?","acceptedAnswer":{"@type":"Answer","text":"Formulas generally assume flywheel horsepower. If you have wheel HP, increase by drivetrain loss (e.g., ~10–15%) to estimate flywheel."}},
      {"@type":"Question","name":"Why can trap speed rise while ET gets slower?","acceptedAnswer":{"@type":"Answer","text":"ET is sensitive to launch and traction; trap speed correlates more with power. Poor 60-ft can hurt ET even if power—and MPH—improves."}},
      {"@type":"Question","name":"How accurate are these estimates?","acceptedAnswer":{"@type":"Answer","text":"They are good for ballpark comparisons on typical street/strip cars. Real ET depends on traction, gearing, aero, weather, driver, and track prep."}},
      {"@type":"Question","name":"Can I convert 1/8-mile to 1/4-mile?","acceptedAnswer":{"@type":"Answer","text":"Rules of thumb like ET(1/4) ≈ ET(1/8) × 1.56 are included, but they’re approximations and vary by combo."}},
      {"@type":"Question","name":"Do these equations assume perfect conditions?","acceptedAnswer":{"@type":"Answer","text":"Yes—ideal traction and shift points. Use your own slips to calibrate constants for your setup."}}
    ]
  }
  </script>

  <!-- JSON-LD: MathSolver (lightweight) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"MathSolver",
    "mathExpression":"ET = k_ET * (Weight/HP)^(1/3); MPH = k_MPH * (HP/Weight)^(1/3)",
    "url":"https://calcdomain.com/quarter-mile-calculator.html"
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Simple non-sticky header -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-700" href="index.html#categories">Categories</a>
      </nav>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="max-w-5xl mx-auto">
      <!-- Breadcrumb -->
      <nav aria-label="Breadcrumb" class="text-sm text-gray-600 mb-4">
        <a class="hover:text-blue-700" href="index.html">Home</a> &raquo;
        <a class="hover:text-blue-700" href="lifestyle-everyday.html">Everyday Life</a> &raquo;
        <a class="hover:text-blue-700" href="subcategories/automotive.html">Automotive</a> &raquo;
        <span class="text-gray-900">Quarter Mile Calculator</span>
      </nav>

      <div id="print-section" class="bg-white rounded-xl shadow p-6">
        <h1 class="text-3xl font-extrabold mb-2">Quarter Mile Calculator</h1>
        <p class="text-gray-700 mb-6">Predict 1/4-mile elapsed time (ET) and trap speed from weight and horsepower—or back-calculate horsepower from a time slip. Includes optional 1/8-mile conversions and clear, documented formulas.</p>

        <!-- Calculator Section -->
        <section aria-labelledby="calcTitle" class="space-y-4">
          <h2 id="calcTitle" class="sr-only">Calculator</h2>

          <!-- Mode toggle -->
          <fieldset class="border rounded-lg p-4">
            <legend class="font-semibold">Mode <span class="text-red-600">*</span></legend>
            <p id="modeHelp" class="text-sm text-gray-600 mt-1">Choose what you want to compute.</p>
            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3" role="radiogroup" aria-describedby="modeHelp">
              <label class="flex items-center gap-3 border rounded-lg p-3">
                <input type="radio" name="mode" id="mode-etmph" value="etmph" aria-describedby="modeHelp" checked>
                <span class="font-medium">ET & Trap Speed from Weight + HP</span>
              </label>
              <label class="flex items-center gap-3 border rounded-lg p-3">
                <input type="radio" name="mode" id="mode-hp" value="hp" aria-describedby="modeHelp">
                <span class="font-medium">Horsepower from Weight + ET</span>
              </label>
            </div>
          </fieldset>

          <!-- Units -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <label for="units" class="block text-sm font-medium">Units <span aria-hidden="true" class="text-red-600">*</span></label>
              <select id="units" class="mt-1 w-full border rounded-md px-3 py-2" aria-required="true" aria-describedby="unitsHelp">
                <option value="imperial" selected>Imperial (lb, hp, mph)</option>
                <option value="metric">Metric (kg, kW, km/h)</option>
              </select>
              <p id="unitsHelp" class="text-xs text-gray-600 mt-1">We’ll convert internally.</p>
            </div>

            <div>
              <label for="formulaPreset" class="block text-sm font-medium">Formula set <button type="button" class="a11y-tip-btn text-xs px-2 py-0.5 border rounded ml-1" aria-expanded="false" aria-controls="tip-formulas">?</button></label>
              <select id="formulaPreset" class="mt-1 w-full border rounded-md px-3 py-2" aria-describedby="tip-formulas">
                <option value="hale" selected>Hale (ET 5.825, MPH 234)</option>
                <option value="fox">Fox</option>
                <option value="custom">Custom constants…</option>
              </select>
              <p id="tip-formulas" class="hidden text-xs text-gray-600 mt-1">Common empirical sets from drag-racing references. Use “Custom” to tweak constants to your car.</p>
            </div>

            <div class="grid grid-cols-2 gap-4" id="customConstWrap" hidden>
              <div>
                <label for="kET" class="block text-sm font-medium">k<sub>ET</sub></label>
                <input type="number" id="kET" class="mt-1 w-full border rounded-md px-3 py-2" step="0.001" value="5.825" aria-describedby="kETHelp">
                <p id="kETHelp" class="text-xs text-gray-600 mt-1">Default 5.825</p>
              </div>
              <div>
                <label for="kMPH" class="block text-sm font-medium">k<sub>MPH</sub></label>
                <input type="number" id="kMPH" class="mt-1 w-full border rounded-md px-3 py-2" step="1" value="234" aria-describedby="kMPHHelp">
                <p id="kMPHHelp" class="text-xs text-gray-600 mt-1">Default 234</p>
              </div>
            </div>
          </div>

          <!-- Inputs -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Weight -->
            <div>
              <label for="weight" class="block text-sm font-medium">Vehicle weight <span class="text-red-600">*</span></label>
              <div class="flex items-center gap-2">
                <input type="number" id="weight" inputmode="decimal" min="1" step="1" value="3600"
                  class="mt-1 w-full border rounded-md px-3 py-2" aria-required="true" aria-describedby="weightErr weightTip">
                <button type="button" class="a11y-tip-btn text-xs px-2 py-0.5 border rounded" aria-expanded="false" aria-controls="weightTip">?</button>
              </div>
              <p id="weightTip" class="hidden text-xs text-gray-600 mt-1">Curb weight with driver, fuel, and typical track trim.</p>
              <p id="weightErr" class="text-sm text-red-600 mt-1 hidden"></p>
            </div>

            <!-- HP OR ET -->
            <div id="hpWrap">
              <label for="hp" class="block text-sm font-medium">Horsepower (flywheel) <span class="text-red-600">*</span></label>
              <div class="flex items-center gap-2">
                <input type="number" id="hp" inputmode="decimal" min="1" step="1" value="400"
                  class="mt-1 w-full border rounded-md px-3 py-2" aria-required="true" aria-describedby="hpErr hpTip">
                <button type="button" class="a11y-tip-btn text-xs px-2 py-0.5 border rounded" aria-expanded="false" aria-controls="hpTip">?</button>
              </div>
              <p id="hpTip" class="hidden text-xs text-gray-600 mt-1">If you have wheel HP, add drivetrain loss (e.g., +12%) to approximate flywheel HP.</p>
              <p id="hpErr" class="text-sm text-red-600 mt-1 hidden"></p>
            </div>

            <div id="etWrap" hidden>
              <label for="et" class="block text-sm font-medium">Elapsed time (ET, 1/4-mile, s) <span class="text-red-600">*</span></label>
              <input type="number" id="et" inputmode="decimal" min="1" step="0.01" value="12.5"
                class="mt-1 w-full border rounded-md px-3 py-2" aria-required="true" aria-describedby="etErr">
              <p id="etErr" class="text-sm text-red-600 mt-1 hidden"></p>
            </div>

            <!-- Optional: 1/8 inputs -->
            <div>
              <label for="eighth" class="block text-sm font-medium">Known 1/8-mile ET (optional)</label>
              <input type="number" id="eighth" inputmode="decimal" min="1" step="0.01" class="mt-1 w-full border rounded-md px-3 py-2" aria-describedby="eighthHelp">
              <p id="eighthHelp" class="text-xs text-gray-600 mt-1">We’ll estimate 1/4-mile ET ≈ 1/8 ET × 1.56 (rule of thumb).</p>
            </div>

            <!-- Action -->
            <div class="flex items-end">
              <button id="calcBtn" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-semibold px-4 py-3 rounded-md">Calculate</button>
            </div>
          </div>
        </section>

        <!-- Results Section -->
        <section aria-labelledby="resultsTitle" id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-xl p-6 fade-in">
          <h2 id="resultsTitle" class="sr-only">Results</h2>
          <div class="flex flex-col lg:flex-row gap-6">
            <div class="w-full lg:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="result-card">
                <h4>Estimated ET (1/4-mile)</h4>
                <p id="outET">—</p>
              </div>
              <div class="result-card">
                <h4>Trap Speed (MPH)</h4>
                <p id="outMPH">—</p>
              </div>
              <div class="result-card">
                <h4>Estimated HP</h4>
                <p id="outHP">—</p>
              </div>
              <div class="result-card">
                <h4>Power-to-Weight</h4>
                <p id="outPw">—</p>
              </div>
            </div>
            <div id="doughnutWrap" class="w-full lg:w-1/3">
              <canvas id="pwChart" aria-label="Power to weight visualization"></canvas>
            </div>
          </div>

          <details class="mt-6 bg-white rounded-lg">
            <summary class="font-semibold text-gray-800 px-4 py-3">1/8-mile conversion & notes</summary>
            <div class="p-4 text-sm text-gray-700">
              <div class="grid sm:grid-cols-3 gap-3">
                <div><span class="font-medium">Estimated 1/8 ET</span><div id="outEighthET">—</div></div>
                <div><span class="font-medium">Estimated 1/8 MPH</span><div id="outEighthMPH">—</div></div>
                <div><span class="font-medium">Rule used</span><div>ET(1/4) ≈ ET(1/8) × 1.56</div></div>
              </div>
              <p class="mt-3">Track prep, DA (density altitude), gearing and traction can shift these by noticeable margins; use your slips to refine constants.</p>
            </div>
          </details>
        </section>
      </div>

      <!-- Authoritative Content -->
      <section class="bg-white rounded-xl shadow p-6 mt-8 prose">
        <h2>Authoritative data source & methodology</h2>
        <p>
          <strong>NHRA — “NHRA 101”</strong> (definitions of elapsed time and speed measurement in the 66-ft trap at the finish). 
          <a class="text-blue-700 underline" href="https://www.nhra.com/nhra-101" rel="noopener">Official reference</a>. 
          <br/>Widely used empirical relations for street/strip estimates:
          <ul class="list-disc ml-6">
            <li>Hale constants: \( ET = 5.825\,\big(\tfrac{W}{HP}\big)^{1/3} \), \( MPH = 234\,\big(\tfrac{HP}{W}\big)^{1/3} \)</li>
            <li>Alternative sets (Fox, others) vary slightly in constants (e.g., 6.269 / 230)</li>
          </ul>
          Representative sources discussing these forms:
          <a class="text-blue-700 underline" href="https://www.omnicalculator.com/physics/quarter-mile" rel="noopener">Omni Calculator</a>,
          <a class="text-blue-700 underline" href="https://www.gregraven.org/hotwater/calculators/qm-from-wt-hp.html" rel="noopener">Greg R. quarter-mile calculator</a>,
          <a class="text-blue-700 underline" href="https://www.speedwaymotors.com/the-toolbox/drag-racing-calculator-1-4-mile-and-1-8-mile-et-mph-and-horsepower/145871" rel="noopener">Speedway Motors tech article</a>.
        </p>
        <p class="p-3 border rounded-lg bg-gray-50"><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          <p><strong>Primary (Hale) relations</strong></p>
          <p>$$ ET = k_{ET}\,\left(\frac{W}{HP}\right)^{1/3}, \qquad MPH = k_{MPH}\,\left(\frac{HP}{W}\right)^{1/3} $$</p>
          <p>Default constants: \(k_{ET}=5.825\), \(k_{MPH}=234\). Choose alternative sets or customize for your combo.</p>
          <p><strong>HP back-calculation</strong> from ET and weight:</p>
          <p>$$ HP \approx W \left(\frac{k_{ET}}{ET}\right)^3 $$</p>
          <p><strong>1/8-mile heuristic</strong> (rule of thumb): \( ET_{1/4} \approx 1.56 \times ET_{1/8} \).</p>
        </div>

        <h2>Glossary of variables</h2>
        <table class="w-full text-sm">
          <thead><tr><th class="text-left">Symbol</th><th class="text-left">Meaning</th><th class="text-left">Units</th></tr></thead>
          <tbody>
            <tr><td><code>W</code></td><td>Total race weight (car + driver + fuel)</td><td>lb (or kg)</td></tr>
            <tr><td><code>HP</code></td><td>Engine flywheel horsepower</td><td>hp (or kW)</td></tr>
            <tr><td><code>ET</code></td><td>Elapsed time for 1/4-mile</td><td>seconds</td></tr>
            <tr><td><code>MPH</code></td><td>Trap speed at the finish line</td><td>mph (or km/h)</td></tr>
            <tr><td><code>k<sub>ET</sub>, k<sub>MPH</sub></code></td><td>Empirical constants</td><td>—</td></tr>
          </tbody>
        </table>

        <h2>How it works: a step-by-step example</h2>
        <p><strong>Goal:</strong> Estimate ET and trap speed for a 3,600 lb car making 400 hp (Hale constants).</p>
        <ol>
          <li>Compute \( \frac{W}{HP} = \frac{3600}{400} = 9 \). Cube root \(= 9^{1/3}\approx 2.0801\).</li>
          <li>\( ET = 5.825 \times 2.0801 \approx 12.12 \) s.</li>
          <li>Compute \( \frac{HP}{W} = \frac{400}{3600} = 0.111\overline{1} \). Cube root \(\approx 0.4807\).</li>
          <li>\( MPH = 234 \times 0.4807 \approx 112.5 \) mph.</li>
        </ol>

        <h2>Frequently asked questions</h2>
        <details><summary>Do these constants match every car?</summary><p>No. They’re averages for typical street/strip cars. Aero, gearing, traction, weather and driver can shift results. Use “Custom constants” to fit your slips.</p></details>
        <details><summary>Wheel vs flywheel HP?</summary><p>Formulas assume flywheel HP. If you only have wheel HP, divide by (1 − driveline loss) to estimate flywheel (e.g., wheel 350 hp at 12% loss → flywheel ≈ 398 hp).</p></details>
        <details><summary>What exactly is “trap speed”?</summary><p>The average speed over the final 66 ft of the run, measured at the finish (per NHRA timing rules).</p></details>
        <details><summary>My 1/8 and 1/4 times don’t match the 1.56 rule</summary><p>That ratio is a heuristic; cars with strong back-half power or poor 60-ft will deviate.</p></details>
        <details><summary>Can I model DA or track prep?</summary><p>Not directly here; use custom constants as a proxy or compare against your actual slips to tune.</p></details>

        <div class="mt-6 p-4 bg-gray-50 border rounded-lg text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content reviewed by CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-27">October 27, 2025</time></p>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (deferred) -->
  <script defer>
  (function(){
    const $ = (id) => document.getElementById(id);
    const els = {
      modeRadios: Array.from(document.querySelectorAll('input[name="mode"]')),
      units: $('units'),
      formulaPreset: $('formulaPreset'),
      customConstWrap: $('customConstWrap'),
      kET: $('kET'),
      kMPH: $('kMPH'),
      weight: $('weight'),
      hp: $('hp'),
      hpWrap: $('hpWrap'),
      et: $('et'),
      etWrap: $('etWrap'),
      eighth: $('eighth'),
      calcBtn: $('calcBtn'),
      outET: $('outET'),
      outMPH: $('outMPH'),
      outHP: $('outHP'),
      outPw: $('outPw'),
      outEighthET: $('outEighthET'),
      outEighthMPH: $('outEighthMPH'),
      pwChart: $('pwChart'),
      tips: Array.from(document.querySelectorAll('.a11y-tip-btn')),
      weightErr: $('weightErr'),
      hpErr: $('hpErr'),
      etErr: $('etErr'),
      tipFormulas: $('tip-formulas'),
      weightTip: $('weightTip'),
      hpTip: $('hpTip')
    };

    // Accessible tooltips
    els.tips.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('aria-controls');
        const tgt = $(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', !expanded);
        tgt.classList.toggle('hidden');
      });
    });

    // Mode switching
    function setMode(){
      const mode = els.modeRadios.find(r=>r.checked).value;
      if(mode === 'etmph'){
        els.hpWrap.hidden = false; els.etWrap.hidden = true;
      }else{
        els.hpWrap.hidden = true; els.etWrap.hidden = false;
      }
      validateAll();
    }
    els.modeRadios.forEach(r=>r.addEventListener('change', setMode));

    // Preset switching
    function applyPreset(){
      const p = els.formulaPreset.value;
      const custom = (p === 'custom');
      els.customConstWrap.hidden = !custom;

      // Preset values drawn from common references (Hale / Fox)
      if(p === 'hale'){ els.kET.value = 5.825; els.kMPH.value = 234; }
      else if(p === 'fox'){ els.kET.value = 6.269; els.kMPH.value = 230; }
    }
    els.formulaPreset.addEventListener('change', applyPreset);

    // Validation helpers
    function showErr(el, errEl, msg){
      if(msg){ errEl.textContent = msg; errEl.classList.remove('hidden'); el.setAttribute('aria-invalid','true'); }
      else{ errEl.textContent = ''; errEl.classList.add('hidden'); el.removeAttribute('aria-invalid'); }
    }
    function validateWeight(){
      const v = +els.weight.value;
      if(!isFinite(v) || v <= 0) { showErr(els.weight, els.weightErr, 'Enter a positive weight.'); return false; }
      showErr(els.weight, els.weightErr, ''); return true;
    }
    function validateHP(){
      if(els.hpWrap.hidden) return true;
      const v = +els.hp.value;
      if(!isFinite(v) || v <= 0) { showErr(els.hp, els.hpErr, 'Enter a positive horsepower.'); return false; }
      showErr(els.hp, els.hpErr, ''); return true;
    }
    function validateET(){
      if(els.etWrap.hidden) return true;
      const v = +els.et.value;
      if(!isFinite(v) || v <= 0) { showErr(els.et, els.etErr, 'Enter a positive elapsed time.'); return false; }
      showErr(els.et, els.etErr, ''); return true;
    }
    function validateAll(){ return validateWeight() & validateHP() & validateET(); }
    ['blur','input'].forEach(evt=>{
      els.weight.addEventListener(evt, validateWeight);
      els.hp.addEventListener(evt, validateHP);
      els.et.addEventListener(evt, validateET);
    });

    // Unit conversions
    function toImperial({units, weight, hp, mph}){
      let W = weight, HP = hp, MPH = mph;
      if(units === 'metric'){
        // kg -> lb, kW -> hp, km/h -> mph
        if(W != null) W = W * 2.2046226218;
        if(HP != null) HP = HP * 1.34102209;
        if(MPH != null) MPH = MPH * 0.621371192;
      }
      return { W, HP, MPH };
    }

    // Core formulas
    function calcET(W, HP, kET){ return kET * Math.cbrt(W/HP); }
    function calcMPH(W, HP, kMPH){ return kMPH * Math.cbrt(HP/W); }
    function calcHPfromET(W, ET, kET){ return W * Math.pow(kET/ET, 3); }

    // Output formatting
    const nf2 = new Intl.NumberFormat(undefined,{maximumFractionDigits:2});
    const nf1 = new Intl.NumberFormat(undefined,{maximumFractionDigits:1});
    function fmt(v, d=2){ return (v==null || !isFinite(v)) ? '—' : new Intl.NumberFormat(undefined,{maximumFractionDigits:d}).format(v); }

    // Chart
    let chart;
    function renderChart(powerPerWeight){
      if(!els.pwChart) return;
      const data = {
        labels:['Power per 1000 lb','—'],
        datasets:[{data:[powerPerWeight, Math.max(0, 400 - powerPerWeight)], borderWidth:0}]
      };
      if(chart){ chart.data = data; chart.update(); }
      else{
        chart = new Chart(els.pwChart, {
          type:'doughnut',
          data, options:{ plugins:{legend:{display:false}}, responsive:true, maintainAspectRatio:false }
        });
      }
    }

    // Main compute
    function compute(){
      if(!validateAll()) return;

      const mode = els.modeRadios.find(r=>r.checked).value;
      const units = els.units.value;
      const W_in  = parseFloat(els.weight.value);
      const HP_in = els.hpWrap.hidden ? null : parseFloat(els.hp.value);
      const ET_in = els.etWrap.hidden ? null : parseFloat(els.et.value);
      const kET = parseFloat(els.kET.value);
      const kMPH = parseFloat(els.kMPH.value);

      // Convert to imperial for formula
      const {W, HP} = toImperial({units, weight:W_in, hp:HP_in});

      let ET=null, MPH=null, HPest=null;

      if(mode === 'etmph'){
        ET = calcET(W, HP, kET);
        MPH = calcMPH(W, HP, kMPH);
        HPest = HP; // not an estimate in this mode
      } else {
        HPest = calcHPfromET(W, ET_in, kET);
        ET = ET_in;
        MPH = calcMPH(W, HPest, kMPH);
      }

      // Convert outputs back to chosen units
      let mphOut = MPH, hpOut = HPest, pw = null;
      if(units === 'metric'){
        mphOut = MPH * 1.609344;      // mph -> km/h
        hpOut = HPest * 0.745699872;  // hp -> kW
      }
      pw = (units === 'metric')
        ? (hpOut / (W_in/1000)) // kW per 1000 kg (approx)
        : (hpOut / (W_in/1000)); // hp per 1000 lb

      els.outET.textContent = fmt(ET,2) + ' s';
      els.outMPH.textContent = fmt(mphOut,1) + (units==='metric' ? ' km/h' : ' mph');
      els.outHP.textContent = (units==='metric' ? fmt(hpOut,1)+' kW' : fmt(hpOut,0)+' hp');
      els.outPw.textContent = (units==='metric' ? fmt(pw,1)+' kW / 1000 kg' : fmt(pw,1)+' hp / 1000 lb');
      renderChart(pw ?? 0);

      // 1/8-mile quick estimates
      const eighthETin = parseFloat(els.eighth.value);
      let e8 = null, e8mph = null;
      if(isFinite(eighthETin)){
        const qtrET = eighthETin * 1.56;
        e8 = eighthETin;
        // back-of-envelope mph scaling (not exact): MPH_1/8 ≈ MPH_1/4 * 0.8
        e8mph = (mphOut!=null && isFinite(mphOut)) ? mphOut * 0.8 : null;
        els.outEighthET.textContent = fmt(e8,2) + ' s → 1/4 ≈ ' + fmt(qtrET,2) + ' s';
        els.outEighthMPH.textContent = e8mph ? (fmt(e8mph,1) + (units==='metric' ? ' km/h' : ' mph')) : '—';
      } else {
        // If no input, estimate 1/8 from current 1/4 ET
        if(ET && isFinite(ET)){
          e8 = ET/1.56;
          e8mph = (mphOut!=null && isFinite(mphOut)) ? mphOut * 0.8 : null;
          els.outEighthET.textContent = fmt(e8,2) + ' s';
          els.outEighthMPH.textContent = e8mph ? (fmt(e8mph,1) + (units==='metric' ? ' km/h' : ' mph')) : '—';
        } else {
          els.outEighthET.textContent = '—';
          els.outEighthMPH.textContent = '—';
        }
      }
    }

    // Events
    $('calcBtn').addEventListener('click', (e)=>{ e.preventDefault(); compute(); });
    ['units','weight','hp','et','eighth','kET','kMPH','formulaPreset'].forEach(id=>{
      const el = $(id); if(el) el.addEventListener('input', compute);
    });

    // Init
    applyPreset();
    setMode();
    compute();
  })();
  </script>
</body>
</html>
