<!DOCTYPE html>
<html lang="en"><head> 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
<meta charset="utf-8">
<title>NEC Grounding Electrode Conductor (GEC) Sizing Calculator</title>
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="Professional NEC Grounding Electrode Conductor (GEC) sizing calculator. Compute minimum copper or aluminum GEC sizes per NEC 2023 Table 250.66, including parallel conductors and electrode-specific caps." name="description">
<meta content="Ugo Candido" name="author">
<link href="https://calcdomain.com/gec-sizing.html" rel="canonical">
<meta content="#0b4a7a" name="theme-color">
<meta content="NEC Grounding Electrode Conductor (GEC) Sizing Calculator" property="og:title">
<meta content="Compute NEC-compliant GEC sizes for copper or aluminum, including parallel conductors and electrode caps per NEC 250.66(A)-(C)." property="og:description">
<meta content="website" property="og:type">
<meta content="https://calcdomain.com/engineering/electrical-us-nec/gec-sizing-calculator" property="og:url">
<style>
    /* Critical, mobile-first CSS (WCAG 2.1 AA) */
    :root{
      --primary:#0b4a7a; --primary-600:#08365a; --secondary:#0a2d45;
      --bg:#f7f9fc; --surface:#ffffff; --text:#1f2937; --muted:#64748b;
      --border:#dbe3ef; --success:#157f3d; --danger:#b42318; --warning:#a15c00;
      --radius:12px; --radius-sm:8px; --shadow:0 6px 20px rgba(0,0,0,.08);
      --focus:3px solid #1363b3;
      --touch:48px;
    }
    *{box-sizing:border-box}
    html{font-size:16px}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.55}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}
    .skip-link{position:absolute;left:8px;top:-40px;background:#0b4a7a;color:#fff;padding:.5rem .75rem;border-radius:6px;z-index:1000}
    .skip-link:focus{top:8px}
    header{background:var(--surface);border-bottom:1px solid var(--border)}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}
    .site-header-inner{display:flex;gap:12px;align-items:center;min-height:64px}
    .brand{font-weight:800;color:var(--primary);font-size:1.125rem}
    .main{padding:1.25rem 0 2rem}
    h1{font-size:1.65rem;line-height:1.25;color:var(--secondary);margin:0 0 .5rem}
    p{margin:.5rem 0 1rem;max-width:75ch}

    /* Layout */
    .layout{display:grid;gap:1rem}
    @media (min-width: 992px){
      .layout{grid-template-columns:420px 1fr;gap:1.5rem}
    }

    /* Calculator card */
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;box-shadow:var(--shadow)}
    .card h2{font-size:1.25rem;margin:.25rem 0 1rem;color:var(--secondary)}
    .form-group{margin-bottom:1rem}
    label{display:block;font-weight:700;margin:0 0 .45rem}
    .help-inline{display:inline-flex;align-items:center;gap:.35rem;margin-left:.35rem}
    .help-btn{appearance:none;border:1px solid var(--border);background:var(--surface);color:var(--primary);border-radius:999px;min-width:var(--touch);min-height:var(--touch);width:var(--touch);height:var(--touch);font-weight:800;cursor:pointer}
    .help-btn:focus{outline:var(--focus)}
    .tooltip{margin:.5rem 0 0;background:#eef4fb;border:1px solid #cfe2f6;color:#0b3a63;padding:.75rem;border-radius:8px}
    .control{width:100%;min-height:var(--touch);padding:.75rem .9rem;border:1px solid var(--border);border-radius:10px;font-size:1rem;background:#fff}
    .control:focus{outline:var(--focus)}
    .inline{display:flex;gap:.5rem;flex-wrap:wrap}
    .radio-group{display:flex;gap:.5rem;flex-wrap:wrap}
    .radio-pill{position:relative}
    .radio-pill input{position:absolute;opacity:0;inset:0}
    .radio-pill label{display:inline-flex;align-items:center;justify-content:center;min-height:var(--touch);padding:.6rem .9rem;border:1px solid var(--border);border-radius:999px;cursor:pointer;background:#fff;color:#0a2740;font-weight:600}
    .radio-pill input:checked + label{background:var(--primary);color:#fff;border-color:var(--primary)}
    .error{color:var(--danger);font-size:.9rem;margin-top:.35rem}
    .add-row{display:inline-flex;align-items:center;gap:.5rem}
    .btn{appearance:none;border:1px solid var(--primary);background:var(--primary);color:#fff;min-height:var(--touch);padding:.65rem 1rem;border-radius:10px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--primary)}
    .btn:focus{outline:var(--focus)}
    .row-list{display:grid;gap:.5rem}
    .row{display:grid;grid-template-columns:1fr auto;gap:.5rem}
    .row .remove{border:1px solid #d33;color:#fff;background:#d33}
    .row .remove.secondary{background:#fff;color:#d33}
    .dim{color:var(--muted);font-size:.95rem}

    /* Results */
    .results{background:#0b1530; color:#e8f0ff; border-radius:var(--radius); padding:1rem; border:1px solid #1f2b5c; min-height:260px}
    .results h3{margin:0 0 .75rem;color:#a9c8ff;font-size:1.1rem}
    .kv{display:flex;justify-content:space-between;gap:1rem;padding:.6rem 0;border-bottom:1px solid #243366}
    .kv:last-child{border-bottom:none}
    .k{color:#a9b7d0}
    .v{font-weight:800}
    .badge{display:inline-flex;align-items:center;gap:.35rem;border:1px solid #3752b3;border-radius:999px;padding:.25rem .6rem;background:#15245c;color:#cfe1ff;font-size:.9rem}
    .note{margin-top:.75rem;color:#fbd38d}
    .warn{color:#ffd1cf}

    /* Content sections */
    section.content h2{font-size:1.3rem;color:var(--secondary);margin-top:1.25rem;padding-top:.75rem;border-top:1px solid var(--border)}
    .formula{background:#eef2f8;border:1px solid #d8e1f0;border-radius:10px;padding:1rem;overflow:auto}
    ul{padding-left:1.25rem}
    li{margin:.35rem 0}

    footer{margin-top:2rem;padding:1.25rem 0;border-top:1px solid var(--border);color:#475569}
    .author{font-size:.95rem}

    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto;transition:none !important;animation:none !important}
    }
  </style>
<!-- MathJax (deferred) for LaTeX rendering -->
<script crossorigin="anonymous" defer="" integrity="sha384-LWc0Jc4mK1jY0c9zA+4K1doyrU7xq4a2qCSyG7GQFJj56q7F+0t7n1Z9kq0zZl9y" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "NEC Grounding Electrode Conductor (GEC) Sizing Calculator",
  "description": "Compute the minimum copper or aluminum Grounding Electrode Conductor (GEC) size per NEC 2023 Table 250.66, including parallel conductors and electrode-specific caps.",
  "url": "https://calcdomain.com/gec-sizing.html",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How to size a Grounding Electrode Conductor (NEC Table 250.66)",
      "description": "Determine the GEC size using the largest ungrounded conductor (or equivalent area for parallel) and apply electrode-specific caps from NEC 250.66(A)-(C).",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Collect service/feeder data",
          "text": "Identify the ungrounded conductor material (copper or aluminum) and the size(s) per phase; if in parallel, note each conductor size."
        },
        {
          "@type": "HowToStep",
          "name": "Compute equivalent area",
          "text": "Sum circular mil areas for all parallel conductors of one phase."
        },
        {
          "@type": "HowToStep",
          "name": "Find the NEC Table 250.66 row",
          "text": "Compare the equivalent area against the copper or aluminum thresholds matching your ungrounded conductor material."
        },
        {
          "@type": "HowToStep",
          "name": "Apply electrode caps",
          "text": "If connecting to a rod/pipe/plate, concrete-encased electrode, or ground ring, apply the specific maximum GEC size limitations per 250.66(A)-(C)."
        },
        {
          "@type": "HowToStep",
          "name": "Check material restrictions",
          "text": "Aluminum or copper-clad aluminum grounding conductors are not permitted where in direct contact with earth or concrete (NEC 250.62(A))."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Does the GEC size depend on the system amperage?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. GEC sizing per NEC Table 250.66 is based on the size of the largest ungrounded service (or derived system) conductor or the equivalent area for parallel conductors, not on overcurrent device rating."
          }
        },
        {
          "@type": "Question",
          "name": "How do I handle parallel conductors?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Sum the circular mil area of all parallel ungrounded conductors for one phase to get the equivalent area, then use Table 250.66 with the appropriate material thresholds."
          }
        },
        {
          "@type": "Question",
          "name": "Are there special caps for certain electrodes?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. Per 250.66(A) rod/pipe/plate are capped at 6 AWG Cu (4 AWG Al); 250.66(B) concrete-encased electrode is not required larger than 4 AWG Cu; 250.66(C) ground ring is not required larger than 2 AWG Cu."
          }
        },
        {
          "@type": "Question",
          "name": "Can I use aluminum for the GEC?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Aluminum or copper-clad aluminum grounding conductors are not permitted where in direct contact with earth, concrete, or in corrosive locations per 250.62(A). Many GEC terminations to electrodes occur outdoors where aluminum is not allowed."
          }
        },
        {
          "@type": "Question",
          "name": "Does this apply to separately derived systems (SDS)?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. NEC 250.30(A)(5) references Table 250.66 for sizing the grounding electrode conductor for SDS, using the largest derived ungrounded conductors."
          }
        },
        {
          "@type": "Question",
          "name": "What about bonding jumpers to building steel and water pipe?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Sizing for bonding jumpers to metal water pipe and building steel also references Table 250.66, with additional rules in 250.66 and 250.104. See AHJ-approved details for your installation."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['$','$'], ['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script">

</head>
<body>

<a class="skip-link" href="#main">Skip to main content</a>
<header>
<div class="container">
<div aria-label="Utility" class="site-header-inner" role="navigation">
<a class="brand" href="https://calcdomain.com/">CalcDomain</a>
</div>
</div>
</header>
<main class="main" id="main">
<div class="container">
<h1>NEC Grounding Electrode Conductor (GEC) Sizing Calculator</h1>
<p>This professional tool determines the minimum Grounding Electrode Conductor (GEC) size per NEC 2023 Table 250.66. It supports service/feeder and separately derived systems, parallel conductors, copper or aluminum options, and automatically applies electrode-specific caps from 250.66(A)–(C).</p>
<div class="layout" id="calculator">
<section aria-labelledby="calc-title" class="card">
<h2 id="calc-title">Calculator</h2>
<div aria-labelledby="system-type-label" class="form-group" role="group">
<span class="sr-only" id="system-type-label">System type</span>
<label>System Type *</label>
<div aria-label="System type" class="radio-group" role="radiogroup">
<div class="radio-pill">
<input checked="" id="sys-service" name="systemType" type="radio" value="service">
<label for="sys-service">Service/Feeder (NEC 250.66)</label>
</div>
<div class="radio-pill">
<input id="sys-sds" name="systemType" type="radio" value="sds">
<label for="sys-sds">Separately Derived System (NEC 250.30)</label>
</div>
</div>
</div>
<div class="form-group">
<label for="ungroundedMaterial">Ungrounded Conductor Material *</label>
<select aria-describedby="ungroundedMaterial-hint ungroundedMaterial-err" aria-required="true" class="control" id="ungroundedMaterial">
<option value="cu">Copper</option>
<option value="al">Aluminum or Copper-Clad Aluminum</option>
</select>
<p class="dim" id="ungroundedMaterial-hint">Select the material of the largest ungrounded conductor(s) feeding the service or SDS.</p>
<div aria-live="polite" class="error" id="ungroundedMaterial-err" role="alert"></div>
</div>
<div class="form-group">
<div class="inline" style="align-items:center;justify-content:space-between">
<label for="electrodeType">Electrode Type *</label>
<span class="help-inline">
<button aria-controls="electrode-tooltip" aria-expanded="false" aria-label="Toggle electrode type help" class="help-btn" id="et-help" type="button">?</button>
</span>
</div>
<select aria-describedby="electrode-tooltip electrodeType-err" aria-required="true" class="control" id="electrodeType">
<option value="general">General electrode (no special cap)</option>
<option value="rod">Rod / Pipe / Plate [250.66(A)]</option>
<option value="cee">Concrete-Encased Electrode (CEE) [250.66(B)]</option>
<option value="ring">Ground Ring [250.66(C)]</option>
<option value="steel">Structural Steel</option>
<option value="water">Metal Underground Water Pipe</option>
</select>
<div class="tooltip" hidden="" id="electrode-tooltip">
              Caps per NEC:
              <ul>
<li>Rod/Pipe/Plate: not required larger than 6 AWG Cu or 4 AWG Al.</li>
<li>CEE: not required larger than 4 AWG Cu; aluminum not permitted in contact with concrete.</li>
<li>Ground ring: not required larger than 2 AWG Cu; ring itself must be copper.</li>
</ul>
</div>
<div aria-live="polite" class="error" id="electrodeType-err" role="alert"></div>
</div>
<div class="form-group">
<div class="inline" style="align-items:center;justify-content:space-between">
<label>Largest Ungrounded Conductor(s) Per Phase *</label>
<span class="help-inline">
<button aria-controls="parallel-tooltip" aria-expanded="false" aria-label="Toggle parallel help" class="help-btn" id="parallel-help" type="button">?</button>
</span>
</div>
<div class="tooltip" hidden="" id="parallel-tooltip">
              For parallel conductors, sum the circular mil area of all parallel ungrounded conductors in one phase. The calculator does this automatically when you add rows.
            </div>
<div aria-describedby="rows-err" class="row-list" id="rows"></div>
<div class="add-row" style="margin-top:.5rem">
<button class="btn secondary" id="addRow" type="button">+ Add parallel conductor</button>
</div>
<div aria-live="polite" class="error" id="rows-err" role="alert"></div>
</div>
<div class="form-group">
<label for="gecMaterial">Desired GEC Material *</label>
<select aria-describedby="gecMaterial-hint gecMaterial-err" aria-required="true" class="control" id="gecMaterial">
<option value="cu">Copper</option>
<option value="al">Aluminum or Copper-Clad Aluminum</option>
</select>
<p class="dim" id="gecMaterial-hint">The tool reports the minimum size for both materials, then applies electrode caps to your chosen material.</p>
<div aria-live="polite" class="error" id="gecMaterial-err" role="alert"></div>
</div>
</section>
<section aria-atomic="true" aria-live="polite" class="results">
<h3>Results</h3>
<div class="kv">
<div class="k">Equivalent Area (one phase)</div>
<div class="v" id="eqArea">0 cmil</div>
</div>
<div class="kv">
<div class="k">Minimum GEC (Copper)</div>
<div class="v" id="minCu">—</div>
</div>
<div class="kv">
<div class="k">Minimum GEC (Aluminum/Cu-Clad Al)</div>
<div class="v" id="minAl">—</div>
</div>
<div class="kv">
<div class="k">Your Selection</div>
<div class="v"><span class="badge" id="finalBadge">—</span></div>
</div>
<div class="note" hidden="" id="capNote"></div>
<div class="warn" hidden="" id="restrictionNote"></div>
</section>
</div>
<section aria-labelledby="datasource" class="content">
<h2 id="datasource">Authoritative Data Source and Methodology</h2>
<p><strong>Primary Reference:</strong> NFPA 70 — National Electrical Code (NEC), 2023 Edition, Article 250, specifically Table 250.66 and Sections 250.66(A)–(C), 250.30(A)(5), and 250.62(A). Access via NFPA: <a href="https://www.nfpa.org/codes-and-standards/all-codes-and-standards/list-of-codes-and-standards/detail?code=70" rel="noopener" target="_blank">NFPA 70 (free access portal)</a>.</p>
<p>All calculations are strictly based on the formulas and data provided by this source.</p>
</section>
<section aria-labelledby="formula" class="content">
<h2 id="formula">The Formula Explained</h2>
<div class="formula">
<p>For parallel ungrounded conductors of one phase, compute the equivalent circular mil area:</p>
<p>$$A_{eq}=\sum_{i=1}^{n} A_i$$</p>
<p>Determine the minimum GEC size by locating the row in NEC Table 250.66 that matches your ungrounded conductor material and equivalent area. Conceptually:</p>
<p>
            $$\text{GEC}_{Cu}=\begin{cases}
              8\ \text{AWG}, &amp; A_{eq}\le A_{Cu}(2\ \text{AWG})\\
              6\ \text{AWG}, &amp; A_{Cu}(2\ \text{AWG})<a_{eq}\le &="" 0)<a_{eq}\le="" 0)\\="" 0\="" 1="" 1{,}100{,}000\\="" 2="" 2\="" 3="" 350{,}000<="" 350{,}000\\="" 3\="" 4\="" 600{,}000<="" 600{,}000\\="" \text{awg},="" a_{cu}(1="" a_{cu}(2="" a_{cu}(3="" a_{eq}="" a_{eq}\le="">1{,}100{,}000
            \end{cases}$$
          </a_{eq}\le></p>
<p>Similarly for aluminum/copper-clad aluminum thresholds (1/0, 3/0, 4/0, 250 kcmil, 600 kcmil, 1000 kcmil, 1750 kcmil):</p>
<p>
            $$\text{GEC}_{Al}=\{6,4,2,1,1/0,3/0,4/0,250\ \text{kcmil}\} \text{ per matching row.}$$
          </p>
<p>Electrode-specific caps are then applied:</p>
<p>
            $$\text{Rod/Pipe/Plate}: \text{GEC}\le
            \begin{cases}
              6\ \text{AWG Cu}\\
              4\ \text{AWG Al}
            \end{cases}\quad
            \text{CEE}: \text{GEC}\le 4\ \text{AWG Cu}\quad
            \text{Ring}: \text{GEC}\le 2\ \text{AWG Cu}.$$
          </p>
</div>
</section>
<section aria-labelledby="glossary" class="content">
<h2 id="glossary">Glossary of Variables and Fields</h2>
<ul>
<li><strong>System Type:</strong> Service/Feeder (NEC 250.66) or SDS (NEC 250.30) — both reference Table 250.66.</li>
<li><strong>Ungrounded Conductor Material:</strong> Copper or Aluminum/Cu-Clad Al of the largest ungrounded conductors feeding the system.</li>
<li><strong>Largest Ungrounded Conductor(s) Per Phase:</strong> AWG/kcmil sizes; if parallel, list each conductor. The tool sums areas.</li>
<li><strong>Equivalent Area (A_eq):</strong> Sum of circular mils of the parallel ungrounded conductors for one phase.</li>
<li><strong>Electrode Type:</strong> Determines if caps from 250.66(A)–(C) apply (rod/pipe/plate, CEE, ground ring).</li>
<li><strong>Desired GEC Material:</strong> Copper or Aluminum/Cu-Clad Al for the grounding electrode conductor being sized.</li>
<li><strong>Minimum GEC (Copper/Aluminum):</strong> Result from Table 250.66 before caps.</li>
<li><strong>Your Selection:</strong> The final recommended GEC size after applying any caps and material restrictions.</li>
</ul>
</section>
<section aria-labelledby="example" class="content">
<h2 id="example">How It Works: A Step-by-Step Example</h2>
<p><strong>Scenario:</strong> Service with two parallel 350 kcmil aluminum ungrounded conductors per phase, connecting to a driven ground rod. GEC material desired: copper.</p>
<ol>
<li>Material: Aluminum. Conductor sizes per phase: 350 kcmil + 350 kcmil.</li>
<li>Equivalent area: A_eq = 350,000 + 350,000 = 700,000 cmil.</li>
<li>NEC Table 250.66 (aluminum thresholds): 700,000 ≤ 1,000,000 cmil ⇒ row that yields GEC = 3/0 AWG aluminum, or 1/0 AWG copper.</li>
<li>Electrode: Rod ⇒ per 250.66(A), copper GEC not required larger than 6 AWG.</li>
<li>Final: Although table suggests 1/0 Cu, the rod cap applies; recommended GEC = 6 AWG copper.</li>
</ol>
</section>
<section aria-labelledby="faq" class="content">
<h2 id="faq">Frequently Asked Questions (FAQ)</h2>
<div>
<h3>Do I use conductor ampacity or physical size?</h3>
<p>Use the physical size (AWG/kcmil) of the largest ungrounded conductors, or the equivalent area for parallel conductors. GEC sizing is independent of OCPD ampacity.</p>
<h3>What if phases have different sizes?</h3>
<p>Use the largest ungrounded conductor(s) of any phase. When in parallel, sum the areas of the parallel conductors for that largest phase.</p>
<h3>Can I mix copper and aluminum in parallel?</h3>
<p>No. NEC 310.10(H) requires parallel conductors to be the same length, gauge, material, insulation, and termination. This calculator assumes one material per phase.</p>
<h3>Is aluminum allowed outdoors for the GEC?</h3>
<p>Aluminum or copper-clad aluminum grounding conductors are not permitted in direct contact with earth or concrete, or in corrosive locations (250.62(A)). Many outdoor GEC runs to electrodes therefore must be copper.</p>
<h3>Does the rod/pipe/plate cap always apply?</h3>
<p>Yes, but it applies to the GEC that connects to that electrode. If a single GEC interconnects multiple electrodes, the largest required size among them may govern the common portion.</p>
<h3>Does this tool cover bonding jumpers?</h3>
<p>This tool is focused on the GEC. For bonding jumpers, see 250.66, 250.102, and 250.104 as applicable, and confirm with your AHJ.</p>
</div>
</section>
<section class="content author">
<p>
          Tool developed by <strong>Ugo Candido</strong>. Content verified by <strong>CalcDomain Electrical Engineering Editorial Board</strong>.<br/>
          Last reviewed for accuracy on: <time datetime="2025-09-14">September 14, 2025</time>.
        </p>
</section>
</div>
</main>
<!-- Standard Footer --> 
<script defer="">
    (function(){
      'use strict';

      // Accessible tooltip toggles
      function makeToggle(btnId, panelId){
        const btn = document.getElementById(btnId);
        const panel = document.getElementById(panelId);
        if(!btn || !panel) return;
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          panel.hidden = expanded;
        });
        btn.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            btn.click();
          }
        });
      }
      makeToggle('parallel-help', 'parallel-tooltip');
      makeToggle('et-help', 'electrode-tooltip');

      // Circular mil areas (AWG and common kcmil sizes)
      const CM = {
        '14 AWG': 4107, '12 AWG': 6530, '10 AWG': 10380, '8 AWG': 16510, '6 AWG': 26240,
        '4 AWG': 41740, '3 AWG': 52620, '2 AWG': 66360, '1 AWG': 83690,
        '1/0 AWG': 105600, '2/0 AWG': 133100, '3/0 AWG': 167800, '4/0 AWG': 211600,
        '250 kcmil': 250000, '300 kcmil': 300000, '350 kcmil': 350000, '400 kcmil': 400000,
        '500 kcmil': 500000, '600 kcmil': 600000, '700 kcmil': 700000, '750 kcmil': 750000,
        '800 kcmil': 800000, '900 kcmil': 900000, '1000 kcmil': 1000000, '1100 kcmil': 1100000,
        '1250 kcmil': 1250000, '1500 kcmil': 1500000, '1750 kcmil': 1750000, '2000 kcmil': 2000000
      };

      // Thresholds and resulting GEC sizes per NEC Table 250.66
      // Each entry = {cuMax, alMax, gecCu, gecAl}
      const TABLE = [
        { cuMax: CM['2 AWG'],         alMax: CM['1/0 AWG'],  gecCu: '8 AWG',  gecAl: '6 AWG' },
        { cuMax: CM['1/0 AWG'],       alMax: CM['3/0 AWG'],  gecCu: '6 AWG',  gecAl: '4 AWG' },
        { cuMax: CM['2/0 AWG'],       alMax: CM['4/0 AWG'],  gecCu: '4 AWG',  gecAl: '2 AWG' },
        { cuMax: CM['3/0 AWG'],       alMax: CM['250 kcmil'],gecCu: '3 AWG',  gecAl: '1 AWG' },
        { cuMax: CM['350 kcmil'],     alMax: CM['600 kcmil'],gecCu: '2 AWG',  gecAl: '1/0 AWG' },
        { cuMax: CM['600 kcmil'],     alMax: CM['1000 kcmil'],gecCu: '1/0 AWG',gecAl: '3/0 AWG' },
        { cuMax: CM['1100 kcmil'],    alMax: CM['1750 kcmil'],gecCu: '2/0 AWG',gecAl: '4/0 AWG' },
        { cuMax: Infinity,            alMax: Infinity,        gecCu: '3/0 AWG',gecAl: '250 kcmil' }
      ];

      // DOM refs
      const rowsEl = document.getElementById('rows');
      const addRowBtn = document.getElementById('addRow');
      const ungroundedMaterial = document.getElementById('ungroundedMaterial');
      const electrodeType = document.getElementById('electrodeType');
      const gecMaterial = document.getElementById('gecMaterial');

      const eqAreaEl = document.getElementById('eqArea');
      const minCuEl = document.getElementById('minCu');
      const minAlEl = document.getElementById('minAl');
      const finalBadge = document.getElementById('finalBadge');
      const capNote = document.getElementById('capNote');
      const restrictionNote = document.getElementById('restrictionNote');

      const rowsErr = document.getElementById('rows-err');

      function fmt(num){
        return num.toLocaleString(undefined);
      }

      function mkSizeOptions(){
        const opts = [];
        const awgs = ['4/0 AWG','3/0 AWG','2/0 AWG','1/0 AWG','1 AWG','2 AWG','3 AWG','4 AWG','6 AWG','8 AWG','10 AWG','12 AWG','14 AWG'];
        const kcs = ['2000 kcmil','1750 kcmil','1500 kcmil','1250 kcmil','1100 kcmil','1000 kcmil','900 kcmil','800 kcmil','750 kcmil','700 kcmil','600 kcmil','500 kcmil','400 kcmil','350 kcmil','300 kcmil','250 kcmil'];
        [...kcs, ...awgs].forEach(s => {
          if(CM[s]) opts.push(`<option value="${s}">${s}</option>`);
        });
        opts.push('<option value="custom">Custom (kcmil)…</option>');
        return opts.join('');
      }
      const SIZE_OPTIONS_HTML = mkSizeOptions();

      function addRow(sizeValue){
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div>
            <label class="sr-only" for="">Conductor size</label>
            <select class="control size-select" aria-label="Conductor size">
              ${SIZE_OPTIONS_HTML}
            </select>
            <div class="inline" style="margin-top:.5rem" hidden>
              <input type="number" min="1" step="1" class="control custom-kcmil" placeholder="Enter kcmil (e.g., 600000)" aria-label="Custom kcmil value">
            </div>
            <div class="error" role="alert" aria-live="polite"></div>
          </div>
          <div>
            <button type="button" class="btn remove secondary" aria-label="Remove conductor row">Remove</button>
          </div>
        `;
        rowsEl.appendChild(row);
        const select = row.querySelector('.size-select');
        const customWrap = row.querySelector('.inline');
        const customInput = row.querySelector('.custom-kcmil');
        const err = row.querySelector('.error');

        if(sizeValue){
          if(sizeValue === 'custom'){
            select.value = 'custom';
            customWrap.hidden = false;
          }else{
            select.value = sizeValue;
          }
        }

        select.addEventListener('change', () => {
          if(select.value === 'custom'){
            customWrap.hidden = false;
            customInput.focus();
          }else{
            customWrap.hidden = true;
            err.textContent = '';
            compute();
          }
        });

        function validateRow(){
          err.textContent = '';
          if(select.value === 'custom'){
            const v = Number(customInput.value);
            if(!Number.isFinite(v) || v <= 0){
              err.textContent = 'Enter a positive kcmil value (e.g., 600000).';
              return false;
            }
          }else if(!CM[select.value]){
            err.textContent = 'Select a valid size.';
            return false;
          }
          return true;
        }

        customInput.addEventListener('blur', () => { validateRow(); compute(); });
        select.addEventListener('blur', () => { validateRow(); });
        row.querySelector('.remove').addEventListener('click', () => {
          row.remove();
          compute();
        });

        return row;
      }

      // Initialize with one row
      addRow('350 kcmil');

      addRowBtn.addEventListener('click', () => {
        addRow();
      });

      [ungroundedMaterial, electrodeType, gecMaterial].forEach(el=>{
        el.addEventListener('change', compute);
        el.addEventListener('blur', compute);
      });

      function getRowAreas(){
        const areas = [];
        let valid = true;
        rowsErr.textContent = '';
        rowsEl.querySelectorAll('.row').forEach(row=>{
          const select = row.querySelector('.size-select');
          const customInput = row.querySelector('.custom-kcmil');
          const err = row.querySelector('.error');
          err.textContent = '';
          if(select.value === 'custom'){
            const v = Number(customInput.value);
            if(!Number.isFinite(v) || v <= 0){
              err.textContent = 'Enter a positive kcmil value.';
              valid = false;
            }else{
              areas.push(v);
            }
          }else{
            const key = select.value;
            if(!CM[key]){
              err.textContent = 'Select a valid size.';
              valid = false;
            }else{
              areas.push(CM[key]);
            }
          }
        });
        if(areas.length === 0){
          rowsErr.textContent = 'Add at least one conductor size.';
          valid = false;
        }
        return {areas, valid};
      }

      function tableLookup(eq, material){
        // material: 'cu' or 'al' (refers to UNGROUNDED conductor material for thresholds)
        for(const row of TABLE){
          if(material === 'cu'){
            if(eq <= row.cuMax) return {gecCu: row.gecCu, gecAl: row.gecAl, limitMax: row.cuMax};
          }else{
            if(eq <= row.alMax) return {gecCu: row.gecCu, gecAl: row.gecAl, limitMax: row.alMax};
          }
        }
        // Fallback (should not hit due to Infinity in table)
        return {gecCu: '3/0 AWG', gecAl: '250 kcmil', limitMax: Infinity};
      }

      function applyCaps(gecCu, gecAl, electrode, chosen){
        // Return final display size and cap note if any
        let capCu = null, capAl = null, note = '';
        if(electrode === 'rod'){
          capCu = '6 AWG'; capAl = '4 AWG';
          note = 'Rod/Pipe/Plate cap applied per NEC 250.66(A).';
        }else if(electrode === 'cee'){
          capCu = '4 AWG'; // aluminum not permitted to CEE
          note = 'CEE cap applied per NEC 250.66(B). Aluminum GEC not permitted in contact with concrete.';
        }else if(electrode === 'ring'){
          capCu = '2 AWG';
          note = 'Ground ring cap applied per NEC 250.66(C). Ground ring must be copper.';
        }
        // Helper to pick the larger between requirement and cap: but "not required to be larger than"
        // means final = min(required, cap) where cap is maximum allowed requirement.
        function minSize(required, cap){
          if(!cap) return required;
          // Compare by area
          const reqArea = toArea(required);
          const capArea = toArea(cap);
          return (reqArea <= capArea) ? required : cap;
        }
        const finalCu = minSize(gecCu, capCu);
        const finalAl = minSize(gecAl, capAl);
        const finalChosen = chosen === 'cu' ? finalCu : finalAl;
        const hasCap = (electrode === 'rod' || electrode === 'cee' || electrode === 'ring');
        return {finalCu, finalAl, finalChosen, note: hasCap ? note : ''};
      }

      // Convert a size label to area (for comparing which is "bigger")
      function toArea(label){
        if(CM[label]) return CM[label];
        // parse like "250 kcmil"
        const m = String(label).match(/^(\d+)\s*kcmil$/i);
        if(m) return Number(m[1]) * 1000;
        // AWG not in the map fallback rough: treat larger AWG number as smaller
        return Infinity;
      }

      function materialRestrictionMessages(electrode, chosenMaterial){
        // NEC 250.62(A) restriction on aluminum
        // Not permitted where in direct contact with earth, concrete, or corrosive.
        // For rod, ring, and CEE this typically means aluminum is not allowed.
        if(chosenMaterial === 'al'){
          if(electrode === 'rod' || electrode === 'ring' || electrode === 'cee'){
            return 'Aluminum or copper-clad aluminum grounding conductors are not permitted where in contact with earth or concrete (NEC 250.62(A)). Use copper for this electrode.';
          }
        }
        return '';
      }

      function compute(){
        const {areas, valid} = getRowAreas();
        if(!valid){ // clear outputs but keep previous context minimal
          eqAreaEl.textContent = '—';
          minCuEl.textContent = '—';
          minAlEl.textContent = '—';
          finalBadge.textContent = '—';
          capNote.hidden = true;
          restrictionNote.hidden = true;
          return;
        }
        const eq = areas.reduce((a,b)=>a+b,0);
        const ungrMat = ungroundedMaterial.value; // 'cu' or 'al'
        const electrode = electrodeType.value;
        const chosen = gecMaterial.value; // 'cu' or 'al'

        const base = tableLookup(eq, ungrMat);
        const capped = applyCaps(base.gecCu, base.gecAl, electrode, chosen);

        // Populate results
        eqAreaEl.textContent = fmt(eq) + ' cmil';
        minCuEl.textContent = base.gecCu;
        minAlEl.textContent = base.gecAl;
        finalBadge.textContent = (chosen === 'cu' ? capped.finalCu : capped.finalAl) + ' ' + (chosen === 'cu' ? '(Cu)' : '(Al/Cu-Clad Al)');

        if(capped.note){
          capNote.hidden = false;
          const capSize = chosen === 'cu' ? capped.finalCu : capped.finalAl;
          capNote.textContent = `${capped.note} Final recommendation limited to ${capSize} for your selected material.`;
        }else{
          capNote.hidden = true;
        }

        const restr = materialRestrictionMessages(electrode, chosen);
        if(restr){
          restrictionNote.hidden = false;
          restrictionNote.textContent = restr;
        }else{
          restrictionNote.hidden = true;
        }
      }

      // Recompute on any changes to rows container via event delegation
      rowsEl.addEventListener('input', (e)=> {
        const t = e.target;
        if(t.classList.contains('size-select') || t.classList.contains('custom-kcmil')){
          compute();
        }
      });

      // Initial compute
      compute();
    })();
  </script>

</body></html>