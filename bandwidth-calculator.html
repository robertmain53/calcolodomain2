<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bandwidth Calculator — Estimate Internet Speed Needs & File Transfer Time</title>
<meta name="description" content="Professional bandwidth calculator: estimate household or office internet speed needs by activities and users, plus compute file transfer time with protocol overhead and efficiency. Includes formulas, glossary, and FAQs." />
<link rel="canonical" href="https://calcdomain.com/bandwidth-calculator.html" />

<!-- Icons / PWA (safe fallbacks if not present) -->
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />

<!-- Tailwind (CDN) -->
<script src="https://cdn.tailwindcss.com" defer></script>

<!-- MathJax for LaTeX (lightweight config) -->
<script defer>
  window.MathJax = {
    tex: { inlineMath: [['\\(','\\)'], ['$', '$']] },
    svg: { fontCache: 'global' }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>

<style>
  /* Base typography and prose width */
  body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; }
  .prose { max-width: 70ch; }
  .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow-x:auto; }
  /* Visible focus ring */
  :where(a, button, input, select, textarea, summary):focus-visible { outline: 3px solid #2563eb; outline-offset: 2px; }
  /* Touch targets */
  button, .btn { min-height: 48px; min-width: 48px; }
  /* Results min-height to avoid CLS */
  #results, #ftt-results { min-height: 220px; }
  /* Error text */
  .error-text { color:#b91c1c; font-size:0.875rem; margin-top:0.375rem; }
  /* Tooltip popover */
  .tip { display:none; }
  .tip[aria-hidden="false"] { display:block; }
  @media print {
    body * { visibility: hidden; }
    #print-section, #print-section * { visibility: visible; }
    #print-section { position: absolute; left: 0; top: 0; width: 100%; }
  }
</style>

<!-- JSON-LD: WebPage -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebPage",
  "name":"Bandwidth Calculator",
  "description":"Estimate internet bandwidth by activities and users, plus compute file transfer time with protocol overhead and efficiency.",
  "url":"https://calcdomain.com/bandwidth-calculator.html",
  "inLanguage":"en",
  "author":{"@type":"Person","name":"Ugo Candido"},
  "publisher":{"@type":"Organization","name":"CalcDomain"}
}
</script>

<!-- JSON-LD: Breadcrumbs -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
    {"@type":"ListItem","position":2,"name":"Lifestyle Everyday","item":"https://calcdomain.com/everyday.html"},
    {"@type":"ListItem","position":3,"name":"Miscellaneous","item":"https://calcdomain.com/subcategories/miscellaneous.html"},
    {"@type":"ListItem","position":4,"name":"Bandwidth Calculator","item":"https://calcdomain.com/bandwidth-calculator.html"}
  ]
}
</script>

<!-- JSON-LD: HowTo -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"HowTo",
  "name":"How to estimate bandwidth for your home or office",
  "description":"Steps to calculate required internet bandwidth from users and activities, plus how to estimate file transfer time.",
  "step":[
    {"@type":"HowToStep","name":"Choose mode","text":"Pick 'Activity-based' to size your internet plan or 'File transfer time' to estimate a download/upload time."},
    {"@type":"HowToStep","name":"Enter inputs","text":"For Activity-based: add activities and concurrent users, set concurrency and safety margin. For File transfer: enter file size, link speed, and efficiency."},
    {"@type":"HowToStep","name":"Review results","text":"See required download/upload bandwidth, recommended plan speed, and estimated times."},
    {"@type":"HowToStep","name":"Refine","text":"Adjust assumptions (efficiency, overhead, concurrency) to stress-test your scenario."}
  ]
}
</script>

<!-- JSON-LD: FAQPage -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {"@type":"Question","name":"What’s the difference between Mbps and MB/s?","acceptedAnswer":{"@type":"Answer","text":"Mbps is megabits per second; MB/s is megabytes per second. 1 byte = 8 bits. Network speeds are usually advertised in Mbps."}},
    {"@type":"Question","name":"What concurrency should I use?","acceptedAnswer":{"@type":"Answer","text":"Concurrency is the share of users active at once. Homes often see 30–50%; busy offices peak higher. Use a conservative value to avoid congestion."}},
    {"@type":"Question","name":"What is protocol efficiency?","acceptedAnswer":{"@type":"Answer","text":"It’s the fraction of link capacity available to payload after overhead (TCP/IP headers, Wi-Fi/ethernet framing). Typical 70–95%, depending on medium and conditions."}},
    {"@type":"Question","name":"Why add a safety margin?","acceptedAnswer":{"@type":"Answer","text":"Bandwidth demand is spiky. A margin helps absorb peaks, background updates, and QoS variability so apps stay smooth."}},
    {"@type":"Question","name":"Does upload speed matter for video calls?","acceptedAnswer":{"@type":"Answer","text":"Yes. Video conferencing needs both downlink and uplink. Ensure the upload requirement meets or exceeds your codec’s bitrate."}},
    {"@type":"Question","name":"Will Wi-Fi reduce my real throughput?","acceptedAnswer":{"@type":"Answer","text":"Often yes. Shared medium, signal quality, and interference lower efficiency versus wired links. Prefer ethernet for critical tasks."}},
    {"@type":"Question","name":"How accurate is file transfer time?","acceptedAnswer":{"@type":"Answer","text":"It’s an estimate. Real times vary with server limits, congestion, disk speed, and protocol behavior (e.g., TCP slow start)."}}
  ]
}
</script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky, compact for mobile space) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <div class="text-sm hidden md:flex gap-6">
        <a href="search.html" class="hover:text-blue-700">Advanced Search</a>
        <a href="index.html#categories" class="hover:text-blue-700">Categories</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div id="print-section" class="max-w-none">
      <!-- 1. H1 -->
      <h1 class="text-3xl font-extrabold mb-2">bandwidth calculator</h1>

      <!-- 2. Intro -->
      <p class="text-gray-700 mb-6 prose">
        Quickly size the internet speed you really need—at home or in a small office—based on simultaneous activities and users.
        Or estimate file transfer time given a link speed. Includes protocol efficiency, overhead, concurrency, and a safety margin.
      </p>

      <!-- 3. Calculator -->
      <section aria-labelledby="calc-heading" class="bg-white p-6 rounded-xl shadow-sm">
        <h2 id="calc-heading" class="sr-only">Interactive bandwidth calculator</h2>

        <!-- Mode Switch -->
        <div class="flex flex-col sm:flex-row gap-3 mb-6" role="tablist" aria-label="Calculator mode">
          <button id="tab-activity" role="tab" aria-selected="true" aria-controls="panel-activity"
                  class="btn px-4 py-2 rounded-lg border border-blue-600 text-blue-700 font-semibold focus-visible:outline-offset-2">
            Activity-based
          </button>
          <button id="tab-ftt" role="tab" aria-selected="false" aria-controls="panel-ftt"
                  class="btn px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:border-blue-400 focus-visible:outline-offset-2">
            File transfer time
          </button>
        </div>

        <!-- Activity-based Panel -->
        <div id="panel-activity" role="tabpanel" aria-labelledby="tab-activity">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left column: inputs -->
            <div class="space-y-5">
              <!-- Concurrency -->
              <div>
                <label for="concurrency" class="block text-sm font-medium text-gray-800">
                  Concurrency (%)*</label>
                <div class="flex items-start gap-2">
                  <input type="number" inputmode="decimal" id="concurrency" min="1" max="100" value="40"
                         aria-required="true" aria-describedby="concurrency-tip concurrency-err"
                         class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                  <button class="px-3 py-2 border rounded-md" data-tip-for="concurrency-tip" aria-expanded="false" aria-controls="concurrency-tip" aria-label="Help: concurrency">?</button>
                </div>
                <p id="concurrency-tip" class="tip text-gray-600 mt-1" aria-hidden="true">
                  Share of users active at once. Homes: 30–50%; busy teams: 50–80%.
                </p>
                <p id="concurrency-err" class="error-text" aria-live="polite"></p>
              </div>

              <!-- Safety margin -->
              <div>
                <label for="margin" class="block text-sm font-medium text-gray-800">
                  Safety margin (%)*</label>
                <div class="flex items-start gap-2">
                  <input type="number" inputmode="decimal" id="margin" min="0" max="200" value="25"
                         aria-required="true" aria-describedby="margin-tip margin-err"
                         class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                  <button class="px-3 py-2 border rounded-md" data-tip-for="margin-tip" aria-expanded="false" aria-controls="margin-tip" aria-label="Help: safety margin">?</button>
                </div>
                <p id="margin-tip" class="tip text-gray-600 mt-1" aria-hidden="true">
                  Extra headroom for peaks, background updates, Wi-Fi variability.
                </p>
                <p id="margin-err" class="error-text" aria-live="polite"></p>
              </div>

              <!-- Protocol efficiency -->
              <div>
                <label for="efficiency" class="block text-sm font-medium text-gray-800">
                  Protocol efficiency (%)*</label>
                <div class="flex items-start gap-2">
                  <input type="number" inputmode="decimal" id="efficiency" min="1" max="100" value="85"
                         aria-required="true" aria-describedby="efficiency-tip efficiency-err"
                         class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                  <button class="px-3 py-2 border rounded-md" data-tip-for="efficiency-tip" aria-expanded="false" aria-controls="efficiency-tip" aria-label="Help: protocol efficiency">?</button>
                </div>
                <p id="efficiency-tip" class="tip text-gray-600 mt-1" aria-hidden="true">
                  Payload share after overhead (headers, framing, retransmissions). Wired ~90–95%, Wi-Fi ~60–90%.
                </p>
                <p id="efficiency-err" class="error-text" aria-live="polite"></p>
              </div>

              <!-- Activities table -->
              <fieldset class="mt-4">
                <legend class="text-sm font-semibold text-gray-900 mb-2">Activities & users</legend>
                <div class="overflow-x-auto border rounded-lg">
                  <table class="min-w-full text-sm">
                    <thead class="bg-gray-100 text-gray-700">
                      <tr>
                        <th class="text-left px-3 py-2">Activity</th>
                        <th class="text-right px-3 py-2">Download (Mbps)</th>
                        <th class="text-right px-3 py-2">Upload (Mbps)</th>
                        <th class="text-right px-3 py-2">Users</th>
                        <th class="px-3 py-2">Remove</th>
                      </tr>
                    </thead>
                    <tbody id="activity-rows"></tbody>
                  </table>
                </div>
                <div class="mt-3 flex gap-2">
                  <button id="add-row" class="btn px-4 py-2 border rounded-md font-medium hover:border-blue-500">Add activity</button>
                  <button id="reset-defaults" class="btn px-4 py-2 border rounded-md font-medium hover:border-blue-500">Load sensible defaults</button>
                </div>
              </fieldset>
            </div>

            <!-- Right column: results -->
            <div id="results" class="bg-blue-50 border border-blue-100 rounded-xl p-5">
              <h3 class="font-semibold text-blue-900 mb-3">Required bandwidth</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-white border rounded-lg p-4 text-center">
                  <p class="text-sm text-gray-600">Download required</p>
                  <p id="dl-required" class="text-2xl font-extrabold text-blue-700">—</p>
                </div>
                <div class="bg-white border rounded-lg p-4 text-center">
                  <p class="text-sm text-gray-600">Upload required</p>
                  <p id="ul-required" class="text-2xl font-extrabold text-blue-700">—</p>
                </div>
                <div class="bg-white border rounded-lg p-4 text-center sm:col-span-2">
                  <p class="text-sm text-gray-600">Plan recommendation (rounded up)</p>
                  <p id="plan-suggestion" class="text-xl font-bold">—</p>
                </div>
              </div>
              <details class="mt-4">
                <summary class="font-medium">Show assumptions</summary>
                <ul class="list-disc list-inside text-sm text-gray-700 mt-2" id="assumptions-list"></ul>
              </details>
              <div class="mt-4">
                <button id="print-btn" class="btn px-4 py-2 border rounded-md font-medium hover:border-blue-500">Print results</button>
              </div>
            </div>
          </div>
        </div>

        <!-- File Transfer Time Panel -->
        <div id="panel-ftt" role="tabpanel" aria-labelledby="tab-ftt" hidden>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Inputs -->
            <div class="space-y-5">
              <div>
                <label for="file-size" class="block text-sm font-medium text-gray-800">File size*</label>
                <div class="grid grid-cols-[1fr_auto] gap-2">
                  <input type="number" id="file-size" min="0.000001" value="5" aria-required="true" aria-describedby="filesize-err"
                         class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" />
                  <select id="file-unit" class="mt-1 px-3 py-2 border border-gray-300 rounded-md" aria-label="File unit">
                    <option value="MB">MB</option>
                    <option value="MiB">MiB</option>
                    <option value="GB" selected>GB</option>
                    <option value="GiB">GiB</option>
                    <option value="TB">TB</option>
                  </select>
                </div>
                <p id="filesize-err" class="error-text" aria-live="polite"></p>
              </div>

              <div>
                <label for="link-speed" class="block text-sm font-medium text-gray-800">Link speed (Mbps)*</label>
                <input type="number" id="link-speed" min="0.01" value="100"
                       aria-required="true" aria-describedby="linkspeed-err"
                       class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" />
                <p id="linkspeed-err" class="error-text" aria-live="polite"></p>
              </div>

              <div>
                <label for="ftt-eff" class="block text-sm font-medium text-gray-800">Protocol efficiency (%)*</label>
                <input type="number" id="ftt-eff" min="1" max="100" value="85"
                       aria-required="true" aria-describedby="ftt-eff-err"
                       class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" />
                <p id="ftt-eff-err" class="error-text" aria-live="polite"></p>
              </div>
            </div>

            <!-- Results -->
            <div id="ftt-results" class="bg-blue-50 border border-blue-100 rounded-xl p-5">
              <h3 class="font-semibold text-blue-900 mb-3">Estimated transfer time</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-white border rounded-lg p-4 text-center">
                  <p class="text-sm text-gray-600">Time (hh:mm:ss)</p>
                  <p id="ftt-time" class="text-2xl font-extrabold text-blue-700">—</p>
                </div>
                <div class="bg-white border rounded-lg p-4 text-center">
                  <p class="text-sm text-gray-600">Effective throughput</p>
                  <p id="ftt-throughput" class="text-2xl font-extrabold text-blue-700">—</p>
                </div>
              </div>
              <details class="mt-4">
                <summary class="font-medium">Show calculation</summary>
                <pre class="text-xs text-gray-800 mt-2 overflow-x-auto"><code id="ftt-steps"></code></pre>
              </details>
            </div>
          </div>
        </div>
      </section>

      <!-- 4. Results section anchor (already integrated above for CLS control) -->

      <!-- 5. Authoritative Content Ecosystem -->
      <section class="mt-10 bg-white p-6 rounded-xl shadow-sm prose">
        <h2>Data source and methodology</h2>
        <ul>
          <li><strong>IEC 80000-13</strong> — Quantities and units of information science (binary/decimal prefixes). <a href="https://www.iec.ch/" rel="nofollow">IEC</a></li>
          <li><strong>IETF RFC 6349</strong> — Framework for TCP Throughput Testing (efficiency considerations). <a href="https://www.rfc-editor.org/rfc/rfc6349" rel="nofollow">RFC-editor</a></li>
          <li><strong>ITU-T G.1010</strong> — End-user multimedia QoS categories and bitrates (application ranges). <a href="https://www.itu.int/" rel="nofollow">ITU</a></li>
        </ul>
        <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          <p><strong>Activity-based bandwidth (download or upload):</strong></p>
          <p>\[
            B_{\text{req}} = \frac{\alpha}{\eta}\; \Big( c \cdot \sum_{i=1}^{N} n_i \, r_i \Big)
          \]</p>
          <p>where \(n_i\) is users on activity \(i\), \(r_i\) its bitrate (Mbps), \(c\) the concurrency (0–1), \(\eta\) protocol efficiency (0–1), and \(\alpha\) the safety margin (1+margin).</p>
          <p><strong>File transfer time:</strong></p>
          <p>\[
            t = \frac{S_{\text{bits}}}{R_{\text{link}} \cdot \eta} \quad,\quad
            S_{\text{bits}} = S \times \kappa
          \]</p>
          <p>with \(S\) the file size, \(\kappa\) the unit factor (e.g., \(1\text{ GB}=10^9\) bytes), \(R_{\text{link}}\) in bits/s, and \(\eta\) efficiency.</p>
        </div>

        <h2>Glossary of variables</h2>
        <ul>
          <li><strong>Concurrency</strong> — Share of users active at once (e.g., 0.4 = 40%).</li>
          <li><strong>Safety margin</strong> — Headroom to absorb peaks; \(\alpha = 1 + \text{margin}\).</li>
          <li><strong>Protocol efficiency</strong> — Payload fraction after overhead, \(\eta\).</li>
          <li><strong>Bitrate (r<sub>i</sub>)</strong> — Mbps per activity (down/up).</li>
          <li><strong>Required bandwidth</strong> — Minimum Mbps to avoid congestion under assumptions.</li>
          <li><strong>Effective throughput</strong> — \(R_{\text{link}}\cdot \eta\) accounting for overhead.</li>
        </ul>

        <h2>How it works: a step-by-step example</h2>
        <p><strong>Scenario.</strong> 2× 4K streaming (25/5 Mbps), 2× HD video call (2.5/2.5), 1× gaming (3/1), concurrency 50%, efficiency 85%, margin 20%.</p>
        <ol>
          <li>Sum raw demand (down): \(2\cdot25 + 2\cdot2.5 + 1\cdot3 = 58\) Mbps.</li>
          <li>Apply concurrency: \(58 \times 0.5 = 29\) Mbps.</li>
          <li>Apply safety: \(\alpha=1.2 \Rightarrow 29 \times 1.2 = 34.8\) Mbps.</li>
          <li>Account for efficiency: \(34.8 / 0.85 \approx 40.9\) Mbps down. Do the same for upload.</li>
          <li>Round up to plan tiers (e.g., 100/20 Mbps) to guarantee headroom.</li>
        </ol>

        <h2>Frequently asked questions</h2>
        <details><summary>What activity bitrates should I use?</summary><p>Use vendor guidance when available. As a rule of thumb: SD stream 3 Mbps, HD 5 Mbps, 4K 25 Mbps; video call SD 1–1.5, HD 2–3; gaming 3–6; web 1; music 0.3–0.6. Adjust if quality/resolution differs.</p></details>
        <details><summary>Decimal vs binary units?</summary><p>GB (decimal) uses 10<sup>9</sup> bytes; GiB (binary) uses 2<sup>30</sup> bytes. For network links, decimal is common; for filesystems, binary is frequent (IEC 80000-13).</p></details>
        <details><summary>Why do tests show lower speed than my plan?</summary><p>Wi-Fi conditions, ISP shaping, shared backhaul, server caps, and protocol overhead reduce measured throughput vs the advertised tier.</p></details>
        <details><summary>Is latency/jitter considered?</summary><p>No, this calculator focuses on throughput. Real-time apps may need QoS and low latency; check your router/ISP features.</p></details>
        <details><summary>How big should my safety margin be?</summary><p>Homes: 15–30%. Small offices or content creators: 25–50%+. Increase if many 4K streams or cloud syncs occur together.</p></details>
        <details><summary>Does upload speed affect cloud backups?</summary><p>Yes—large backups are upload-bound. Use the File transfer tool with your upstream tier and efficiency.</p></details>
        <details><summary>Can I use this for CCTV sizing?</summary><p>Yes—treat each camera’s average bitrate as an activity and sum them. For precise CCTV engineering, add motion profiles and VBR headroom.</p></details>
      </section>

      <!-- 6. Author & Review -->
      <section class="mt-6">
        <div class="bg-gray-50 border rounded-xl p-4 text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content reviewed by the CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-26">October 26, 2025</time></p>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (defer by placement) -->
  <script>
  (function(){
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    /* ------- Tabs ------- */
    const tabActivity = $('#tab-activity');
    const tabFtt = $('#tab-ftt');
    const panelActivity = $('#panel-activity');
    const panelFtt = $('#panel-ftt');

    function switchTab(to) {
      const isActivity = to === 'activity';
      tabActivity.setAttribute('aria-selected', String(isActivity));
      tabFtt.setAttribute('aria-selected', String(!isActivity));
      panelActivity.hidden = !isActivity;
      panelFtt.hidden = isActivity;

      (isActivity ? tabActivity : tabFtt).focus();
    }
    tabActivity.addEventListener('click', () => switchTab('activity'));
    tabFtt.addEventListener('click', () => switchTab('ftt'));

    /* ------- Accessible tooltips ------- */
    $$('#panel-activity [data-tip-for]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-tip-for');
        const tip = document.getElementById(id);
        const visible = tip.getAttribute('aria-hidden') === 'false';
        tip.setAttribute('aria-hidden', visible ? 'true' : 'false');
        btn.setAttribute('aria-expanded', String(!visible));
      });
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const id = btn.getAttribute('data-tip-for');
          const tip = document.getElementById(id);
          tip.setAttribute('aria-hidden','true');
          btn.setAttribute('aria-expanded','false');
        }
      });
    });

    /* ------- Activity Rows ------- */
    const tbody = $('#activity-rows');
    const defaults = [
      { name:'4K streaming', dl:25, ul:5, users:1 },
      { name:'HD video call', dl:2.5, ul:2.5, users:2 },
      { name:'Gaming', dl:3, ul:1, users:1 },
      { name:'Web browsing', dl:1, ul:0.2, users:2 }
    ];

    function rowTemplate({name='', dl=5, ul=1, users=1}) {
      const id = 'r' + Math.random().toString(36).slice(2,8);
      return `
        <tr>
          <td class="px-3 py-2">
            <input type="text" value="${name}" aria-label="Activity name"
              class="w-full px-2 py-2 border border-gray-300 rounded-md">
          </td>
          <td class="px-3 py-2 text-right">
            <input type="number" inputmode="decimal" min="0" step="0.1" value="${dl}"
              aria-label="Download Mbps"
              class="w-full text-right px-2 py-2 border border-gray-300 rounded-md">
          </td>
          <td class="px-3 py-2 text-right">
            <input type="number" inputmode="decimal" min="0" step="0.1" value="${ul}"
              aria-label="Upload Mbps"
              class="w-full text-right px-2 py-2 border border-gray-300 rounded-md">
          </td>
          <td class="px-3 py-2 text-right">
            <input type="number" inputmode="numeric" min="0" step="1" value="${users}"
              aria-label="Number of users on this activity"
              class="w-full text-right px-2 py-2 border border-gray-300 rounded-md">
          </td>
          <td class="px-3 py-2 text-center">
            <button class="remove-row px-3 py-2 border rounded-md" aria-label="Remove activity">✕</button>
          </td>
        </tr>
      `;
    }

    function renderDefaults() {
      tbody.innerHTML = defaults.map(rowTemplate).join('');
      recalcActivity();
    }
    renderDefaults();

    $('#add-row').addEventListener('click', () => {
      tbody.insertAdjacentHTML('beforeend', rowTemplate({}));
      recalcActivity();
    });
    $('#reset-defaults').addEventListener('click', renderDefaults);
    tbody.addEventListener('click', (e) => {
      if (e.target.closest('.remove-row')) {
        e.target.closest('tr').remove();
        recalcActivity();
      }
    });
    tbody.addEventListener('input', recalcActivity);

    /* ------- Inline validation on blur ------- */
    function setErr(id, msg) { const el = document.getElementById(id); if (el) el.textContent = msg || ''; }
    function valPercent(id, min, max) {
      const el = document.getElementById(id);
      const v = parseFloat(el.value);
      if (isNaN(v) || v < min || v > max) {
        setErr(id + '-err', `Enter a value between ${min} and ${max}.`);
        return null;
      }
      setErr(id + '-err','');
      return v;
    }
    ['concurrency','margin','efficiency','file-size','link-speed','ftt-eff'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('blur', () => {
        if (id === 'file-size') { valPercent(id, 0.000001, 1e9); recalcFTT(); return; }
        if (id === 'link-speed') { valPercent(id, 0.01, 10_000); recalcFTT(); return; }
        if (id === 'ftt-eff') { valPercent(id, 1, 100); recalcFTT(); return; }
        if (id === 'concurrency') { valPercent(id, 1, 100); recalcActivity(); return; }
        if (id === 'margin') { valPercent(id, 0, 200); recalcActivity(); return; }
        if (id === 'efficiency') { valPercent(id, 1, 100); recalcActivity(); return; }
      });
    });

    /* ------- Activity calculation ------- */
    function sumDemand() {
      let dl = 0, ul = 0;
      tbody.querySelectorAll('tr').forEach(tr => {
        const [nameEl, dlEl, ulEl, usersEl] = tr.querySelectorAll('input');
        const d = Math.max(0, parseFloat(dlEl.value) || 0);
        const u = Math.max(0, parseFloat(ulEl.value) || 0);
        const n = Math.max(0, parseInt(usersEl.value,10) || 0);
        dl += d * n;
        ul += u * n;
      });
      return { dl, ul };
    }

    function tierSuggestion(d, u) {
      // Round up to common advertised plan tiers (down/up)
      const tiers = [10, 20, 30, 50, 75, 100, 200, 300, 500, 600, 800, 1000, 2000];
      const upTiers = [1, 2, 5, 10, 20, 30, 50, 100, 200, 500, 1000];

      const dTier = tiers.find(t => t >= d) ?? Math.ceil(d);
      const uTier = upTiers.find(t => t >= u) ?? Math.ceil(u);
      return `${dTier} Mbps down / ${uTier} Mbps up`;
    }

    function recalcActivity() {
      const conc = valPercent('concurrency', 1, 100) ?? 40;
      const margin = valPercent('margin', 0, 200) ?? 25;
      const eff = valPercent('efficiency', 1, 100) ?? 85;

      const { dl, ul } = sumDemand(); // Mbps
      const c = conc / 100;
      const alpha = 1 + (margin/100);
      const eta = eff / 100;

      const dlReq = (alpha / eta) * (c * dl);
      const ulReq = (alpha / eta) * (c * ul);

      $('#dl-required').textContent = dlReq > 0 ? dlReq.toFixed(1) + ' Mbps' : '—';
      $('#ul-required').textContent = ulReq > 0 ? ulReq.toFixed(1) + ' Mbps' : '—';
      $('#plan-suggestion').textContent = (dlReq>0 || ulReq>0) ? tierSuggestion(Math.ceil(dlReq), Math.ceil(ulReq)) : '—';

      // Assumptions
      const items = [
        `Concurrency: ${conc}%`,
        `Safety margin: ${margin}%`,
        `Protocol efficiency: ${eff}%`,
        `Raw summed demand (before concurrency): ${dl.toFixed(1)} Mbps down, ${ul.toFixed(1)} Mbps up`
      ];
      const ulEl = $('#assumptions-list');
      ulEl.innerHTML = items.map(x=>`<li>${x}</li>`).join('');
    }

    /* ------- Print ------- */
    $('#print-btn').addEventListener('click', () => window.print());

    /* ------- File Transfer Time ------- */
    const unitFactors = {
      'MB': 1e6, 'GB': 1e9, 'TB': 1e12,
      'MiB': Math.pow(2,20), 'GiB': Math.pow(2,30)
    };

    function fmtTime(seconds) {
      seconds = Math.max(0, Math.round(seconds));
      const h = Math.floor(seconds/3600);
      const m = Math.floor((seconds%3600)/60);
      const s = seconds%60;
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    function recalcFTT() {
      const size = valPercent('file-size', 0.000001, 1e12) ?? 5;
      const unit = $('#file-unit').value;
      const link = valPercent('link-speed', 0.01, 10000) ?? 100;
      const eff = valPercent('ftt-eff', 1, 100) ?? 85;

      const bytes = size * (unitFactors[unit] || 1e9);
      const bits = bytes * 8;
      const linkbps = link * 1e6; // Mbps -> bps
      const eta = eff / 100;

      const effRate = linkbps * eta;
      const seconds = bits / effRate;

      $('#ftt-time').textContent = fmtTime(seconds);
      const mbpsEff = effRate / 1e6;
      $('#ftt-throughput').textContent = mbpsEff.toFixed(1) + ' Mbps';
      $('#ftt-steps').textContent =
`Size = ${size} ${unit}
Bytes = ${bytes.toLocaleString()} B
Bits = ${bits.toLocaleString()} b
Link = ${link} Mbps, Efficiency = ${eff}%
Effective rate = ${(mbpsEff).toFixed(1)} Mbps
Time = ${fmtTime(seconds)} (hh:mm:ss)`;
    }

    $('#file-unit').addEventListener('change', recalcFTT);
    ['file-size','link-speed','ftt-eff'].forEach(id => {
      document.getElementById(id).addEventListener('input', recalcFTT);
    });

    /* ------- Initialize ------- */
    recalcActivity();
    recalcFTT();
  })();
  </script>
</body>
</html>
