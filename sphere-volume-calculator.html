<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta & SEO -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Sphere Volume Calculator</title>
  <meta name="description" content="Professional Sphere Volume Calculator. Enter radius, diameter, circumference, or surface area to compute exact volume with unit conversions (m³, L, gal). Accessible, mobile-first, and formula-driven." />
  <link rel="canonical" href="https://calcdomain.com/sphere-volume-calculator.html" />

  <!-- Icons -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="preload" as="style" onload="this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--focus:#2563eb}
    html,body{height:100%}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';}
    .prose{max-width:70ch}
    .prose h2{font-size:1.5rem;font-weight:700;margin-top:1.75rem;margin-bottom:.75rem}
    .prose h3{font-size:1.125rem;font-weight:700;margin-top:1.25rem;margin-bottom:.5rem}
    .prose p{margin-bottom:.9rem;line-height:1.7}
    .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:10px;padding:1rem;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .result-grid{min-height:180px} /* prevent CLS */
    :focus-visible{outline:3px solid var(--focus);outline-offset:2px;border-radius:8px}
    .btn{min-height:48px;min-width:48px}
    .field-help[hidden]{display:none}
    details>summary{cursor:pointer;font-weight:600}
    @media print{
      header,nav,aside,.no-print{display:none!important}
      main{padding:0}
      #print-section{position:absolute;left:0;top:0;width:100%}
    }
  </style>

  <!-- MathJax for LaTeX -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          id="MathJax-script"></script>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "@id":"https://calcdomain.com/sphere-volume-calculator.html#webpage",
    "url":"https://calcdomain.com/sphere-volume-calculator.html",
    "name":"Sphere Volume Calculator",
    "inLanguage":"en",
    "description":"Compute the volume of a sphere from radius, diameter, circumference, or surface area with unit conversions.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Geometry","item":"https://calcdomain.com/subcategories/math-geometry.html"},
      {"@type":"ListItem","position":4,"name":"Sphere Volume Calculator","item":"https://calcdomain.com/sphere-volume-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: WebApplication (Calculator) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Sphere Volume Calculator",
    "applicationCategory":"Calculator",
    "operatingSystem":"Any",
    "url":"https://calcdomain.com/sphere-volume-calculator.html",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}
  }
  </script>

  <!-- JSON-LD: FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the formula for the volume of a sphere?",
       "acceptedAnswer":{"@type":"Answer","text":"The volume of a sphere is V = (4/3)·π·r^3, where r is the radius."}},
      {"@type":"Question","name":"How do I calculate volume from diameter?",
       "acceptedAnswer":{"@type":"Answer","text":"First compute r = d/2, then use V = (4/3)·π·r^3 = (π·d^3)/6."}},
      {"@type":"Question","name":"How accurate is this calculator?",
       "acceptedAnswer":{"@type":"Answer","text":"All results use IEEE-754 double precision. You can select result precision up to 10 decimal places."}},
      {"@type":"Question","name":"Which units are supported?",
       "acceptedAnswer":{"@type":"Answer","text":"Input in mm, cm, m, in, or ft. Outputs include the chosen unit³, m³, liters, and US gallons."}},
      {"@type":"Question","name":"What if I only know the surface area or circumference?",
       "acceptedAnswer":{"@type":"Answer","text":"Choose the corresponding input mode. The tool derives the radius from A = 4·π·r^2 or C = 2·π·r and computes volume accordingly."}},
      {"@type":"Question","name":"What is the difference between liters and cubic meters?",
       "acceptedAnswer":{"@type":"Answer","text":"1 m³ = 1,000 liters. The calculator converts m³ to liters automatically."}},
      {"@type":"Question","name":"Can I use this for real-world tanks or balls?",
       "acceptedAnswer":{"@type":"Answer","text":"Yes, if the object is approximately spherical. For vessels with fittings or thick walls, treat this as an ideal approximation."}}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky for mobile viewport efficiency) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a href="search.html" class="hover:text-blue-700">Search</a>
        <a href="index.html#categories" class="hover:text-blue-700">Categories</a>
      </nav>
      <button class="md:hidden p-2 rounded btn" aria-label="Open menu"
              onclick="document.getElementById('mobileMenu').classList.toggle('hidden')">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
    <div id="mobileMenu" class="md:hidden hidden border-t">
      <div class="container mx-auto px-4 py-3 space-y-2">
        <a href="search.html" class="block py-2">Search</a>
        <a href="index.html#categories" class="block py-2">Categories</a>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
      <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
      <a href="subcategories/geometry.html" class="hover:text-blue-700">Geometry</a> &raquo;
      <span class="text-gray-900">Sphere Volume Calculator</span>
    </nav>

    <div id="print-section" class="bg-white p-6 rounded-xl shadow">
      <!-- 1) Title -->
      <h1 class="text-3xl font-extrabold tracking-tight mb-2">Sphere Volume Calculator</h1>

      <!-- 2) Introduction -->
      <p class="text-gray-700 mb-6">
        Compute the exact volume of a sphere from <strong>radius</strong>, <strong>diameter</strong>,
        <strong>circumference</strong>, or <strong>surface area</strong>. Designed for engineers,
        educators, and students, this tool provides precise results with unit conversions
        (m³, liters, US gal) and a clear formula breakdown.
      </p>

      <!-- 3) Calculator UI -->
      <section id="calculator-ui" class="space-y-6" aria-labelledby="calcHeading">
        <h2 id="calcHeading" class="sr-only">Calculator Input</h2>

        <!-- Mode & Units -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label for="given" class="block text-sm font-medium text-gray-800">Given*</label>
            <div class="mt-1 relative">
              <select id="given" class="w-full border rounded-lg px-3 py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600"
                      aria-required="true" aria-describedby="given-help">
                <option value="radius" selected>Radius (r)</option>
                <option value="diameter">Diameter (d)</option>
                <option value="circumference">Circumference (C)</option>
                <option value="surfaceArea">Surface area (A)</option>
              </select>
              <p id="given-help" class="text-xs text-gray-600 mt-1">Choose which quantity you know.</p>
            </div>
          </div>

          <div>
            <div class="flex items-center justify-between">
              <label for="lengthUnit" class="block text-sm font-medium text-gray-800">Length unit*</label>
              <button class="ml-2 text-xs text-blue-700 underline btn"
                      aria-expanded="false" aria-controls="unit-tip" id="unitTipBtn">?</button>
            </div>
            <select id="lengthUnit" class="mt-1 w-full border rounded-lg px-3 py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600"
                    aria-required="true" aria-describedby="unit-tip">
              <option value="mm">millimeters (mm)</option>
              <option value="cm">centimeters (cm)</option>
              <option value="m" selected>meters (m)</option>
              <option value="in">inches (in)</option>
              <option value="ft">feet (ft)</option>
            </select>
            <p id="unit-tip" class="field-help text-xs text-gray-600 mt-1" hidden>
              The chosen length unit applies to radius/diameter/circumference/surface area consistently.
            </p>
          </div>

          <div>
            <label for="precision" class="block text-sm font-medium text-gray-800">Result precision</label>
            <input id="precision" type="number" inputmode="numeric" class="mt-1 w-full border rounded-lg px-3 py-2 focus-visible:ring-2 focus-visible:ring-blue-600"
                   value="4" step="1" min="0" max="10" aria-describedby="precision-help">
            <p id="precision-help" class="text-xs text-gray-600 mt-1">Decimal places (0–10).</p>
          </div>
        </div>

        <!-- Dynamic Field -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <div class="flex items-center justify-between">
              <label for="valueInput" class="block text-sm font-medium text-gray-800" id="valueLabel">Radius*</label>
              <button class="ml-2 text-xs text-blue-700 underline btn"
                      aria-expanded="false" aria-controls="value-tip" id="valueTipBtn">?</button>
            </div>
            <input id="valueInput" type="number" inputmode="decimal" step="any" min="0"
                   class="mt-1 w-full border rounded-lg px-3 py-2 focus-visible:ring-2 focus-visible:ring-blue-600"
                   aria-required="true" aria-describedby="value-err value-tip">
            <p id="value-err" class="mt-1 text-sm text-red-600" role="alert" hidden></p>
            <p id="value-tip" class="field-help text-xs text-gray-600 mt-1" hidden>
              Enter a non-negative number. Units follow the selected length unit.
            </p>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="autoCalc" class="block text-sm font-medium text-gray-800">Auto calculate</label>
              <select id="autoCalc" class="mt-1 w-full border rounded-lg px-3 py-2 focus-visible:ring-2 focus-visible:ring-blue-600"
                      aria-describedby="auto-help">
                <option value="on" selected>On input</option>
                <option value="off">Manual</option>
              </select>
              <p id="auto-help" class="text-xs text-gray-600 mt-1">Choose manual to use the Calculate button.</p>
            </div>
            <div class="flex items-end">
              <button id="calcBtn" class="w-full btn px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-300 disabled:opacity-40"
                      aria-label="Calculate sphere volume">Calculate</button>
            </div>
          </div>
        </div>

        <!-- Utilities -->
        <div class="flex flex-wrap gap-3 no-print">
          <button id="copyBtn" class="btn px-4 py-2 border rounded-lg hover:bg-gray-50"
                  aria-label="Copy results to clipboard">Copy results</button>
          <button id="resetBtn" class="btn px-4 py-2 border rounded-lg hover:bg-gray-50"
                  aria-label="Reset inputs">Reset</button>
          <button id="printBtn" class="btn px-4 py-2 border rounded-lg hover:bg-gray-50"
                  aria-label="Print results">Print</button>
        </div>
      </section>

      <!-- 4) Results -->
      <section id="results" class="mt-8" aria-labelledby="resultsHeading">
        <h2 id="resultsHeading" class="text-xl font-bold mb-3">Results</h2>
        <div class="result-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="border rounded-lg p-4 text-center">
            <h3 class="text-sm text-gray-600">Volume (selected unit³)</h3>
            <p id="volPrimary" class="text-2xl font-extrabold text-blue-700">—</p>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <h3 class="text-sm text-gray-600">Volume (m³)</h3>
            <p id="volM3" class="text-2xl font-extrabold text-blue-700">—</p>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <h3 class="text-sm text-gray-600">Liters (L)</h3>
            <p id="volL" class="text-2xl font-extrabold text-blue-700">—</p>
          </div>
          <div class="border rounded-lg p-4 text-center">
            <h3 class="text-sm text-gray-600">US Gallons (gal)</h3>
            <p id="volGal" class="text-2xl font-extrabold text-blue-700">—</p>
          </div>
        </div>

        <details class="mt-6 bg-gray-50 border rounded-lg p-4">
          <summary>Derived geometry</summary>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
            <div class="border rounded-lg p-4 text-center bg-white">
              <h3 class="text-sm text-gray-600">Radius (r)</h3>
              <p id="outR" class="text-xl font-bold">—</p>
            </div>
            <div class="border rounded-lg p-4 text-center bg-white">
              <h3 class="text-sm text-gray-600">Diameter (d)</h3>
              <p id="outD" class="text-xl font-bold">—</p>
            </div>
            <div class="border rounded-lg p-4 text-center bg-white">
              <h3 class="text-sm text-gray-600">Circumference (C)</h3>
              <p id="outC" class="text-xl font-bold">—</p>
            </div>
            <div class="border rounded-lg p-4 text-center bg-white">
              <h3 class="text-sm text-gray-600">Surface area (A)</h3>
              <p id="outA" class="text-xl font-bold">—</p>
            </div>
          </div>
        </details>
      </section>

      <!-- 5) Authoritative Content Ecosystem -->
      <section class="prose mt-10">
        <h2>Authoritative data source & methodology</h2>
        <p>
          Primary reference: <a class="text-blue-700 underline" rel="noopener"
          href="https://mathworld.wolfram.com/Sphere.html">Wolfram MathWorld — Sphere</a>
          (accessed 2025). <br>
          <em>“All calculations strictly follow the formulas and definitions provided by this source.”</em>
        </p>

        <h2>The formula explained</h2>
        <div class="formula-box" aria-label="Sphere volume formula">
          \( V = \frac{4}{3}\,\pi\,r^{3} \) <br/>
          Using other givens: <br/>
          \( r = \frac{d}{2} \Rightarrow V = \frac{\pi d^{3}}{6} \) <br/>
          \( r = \frac{C}{2\pi} \Rightarrow V = \frac{C^{3}}{6\pi^{2}} \) <br/>
          \( r = \sqrt{\frac{A}{4\pi}} \Rightarrow V = \frac{A^{3/2}}{6\sqrt{\pi}} \)
        </div>

        <h2>Glossary of variables</h2>
        <ul>
          <li><strong>r</strong> — radius (half the diameter).</li>
          <li><strong>d</strong> — diameter (twice the radius).</li>
          <li><strong>C</strong> — circumference of a great circle \( (2\pi r) \).</li>
          <li><strong>A</strong> — sphere surface area \( (4\pi r^{2}) \).</li>
          <li><strong>V</strong> — volume \( \left(\frac{4}{3}\pi r^{3}\right) \).</li>
        </ul>

        <h2>How it works: a step-by-step example</h2>
        <p><strong>Goal:</strong> Find the volume when the <em>diameter</em> is 0.50 m.</p>
        <ol>
          <li>Convert to radius: \( r = d/2 = 0.25 \,\text{m} \).</li>
          <li>Apply \( V = \frac{4}{3}\pi r^{3} = \frac{4}{3}\pi (0.25)^3 \approx 0.06545\,\text{m}^3 \).</li>
          <li>Convert: \( 0.06545\,\text{m}^3 \approx 65.45\,\text{L} \approx 17.29\,\text{US gal} \).</li>
        </ol>

        <h2>Frequently asked questions</h2>
        <details>
          <summary>Does unit choice affect accuracy?</summary>
          <p>No—calculations are performed in SI internally. Inputs in imperial are converted to meters, then results are converted back.</p>
        </details>
        <details>
          <summary>Why do I sometimes see tiny rounding differences?</summary>
          <p>This calculator uses double precision floating-point and the selected decimal places. Minor rounding differences are expected versus symbolic math.</p>
        </details>
        <details>
          <summary>Can I input negative values?</summary>
          <p>No. Physical dimensions must be non-negative. The form validates and explains how to fix errors inline.</p>
        </details>
        <details>
          <summary>How do I compute volume from surface area?</summary>
          <p>Use \( r = \sqrt{A/(4\pi)} \) then \( V = \frac{4}{3}\pi r^{3} \). Select “surface area” as the given and enter A with the correct unit.</p>
        </details>
        <details>
          <summary>What precision should I use?</summary>
          <p>Match the significant figures of your inputs. For engineering use, 3–4 decimals are often sufficient unless tolerances demand more.</p>
        </details>
      </section>

      <!-- 6) Authorship & Review -->
      <section class="mt-8 p-4 bg-gray-50 border rounded-lg text-sm text-gray-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content technically reviewed by the CalcDomain Editorial Board.</p>
        <p>Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All rights reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer-ready) -->
  <script defer>
    (() => {
      const $ = (id) => document.getElementById(id);

      // Elements
      const givenEl = $('given');
      const unitEl = $('lengthUnit');
      const precisionEl = $('precision');
      const valueEl = $('valueInput');
      const valueErr = $('value-err');
      const valueLabel = $('valueLabel');
      const unitTipBtn = $('unitTipBtn');
      const valueTipBtn = $('valueTipBtn');
      const unitTip = $('unit-tip');
      const valueTip = $('value-tip');
      const autoCalcEl = $('autoCalc');
      const calcBtn = $('calcBtn');
      const copyBtn = $('copyBtn');
      const resetBtn = $('resetBtn');
      const printBtn = $('printBtn');

      const out = {
        primary: $('volPrimary'),
        m3: $('volM3'),
        L: $('volL'),
        gal: $('volGal'),
        r: $('outR'),
        d: $('outD'),
        c: $('outC'),
        a: $('outA')
      };

      // Accessible tooltips
      function toggleTip(btn, tip) {
        const open = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!open));
        tip.hidden = open;
      }
      unitTipBtn.addEventListener('click', () => toggleTip(unitTipBtn, unitTip));
      valueTipBtn.addEventListener('click', () => toggleTip(valueTipBtn, valueTip));

      // Units to meters
      const toMeters = {
        mm: (x) => x / 1000,
        cm: (x) => x / 100,
        m: (x) => x,
        in: (x) => x * 0.0254,
        ft: (x) => x * 0.3048
      };
      const fromMeters = {
        mm: (x) => x * 1000,
        cm: (x) => x * 100,
        m: (x) => x,
        in: (x) => x / 0.0254,
        ft: (x) => x / 0.3048
      };

      // Formatting
      const clampPrec = (n) => Math.min(10, Math.max(0, Number.isFinite(n) ? n : 4));
      const fmt = (x, p) => Number.isFinite(x) ? x.toFixed(p) : '—';

      // State helpers
      function currentLabel() {
        switch (givenEl.value) {
          case 'radius': return 'Radius*';
          case 'diameter': return 'Diameter*';
          case 'circumference': return 'Circumference*';
          case 'surfaceArea': return 'Surface area*';
          default: return 'Value*';
        }
      }

      function updateLabelAndPlaceholder() {
        valueLabel.textContent = currentLabel();
        const unit = unitEl.value;
        switch (givenEl.value) {
          case 'radius':
            valueEl.placeholder = `e.g., 0.25 ${unit}`;
            break;
          case 'diameter':
            valueEl.placeholder = `e.g., 0.50 ${unit}`;
            break;
          case 'circumference':
            valueEl.placeholder = `e.g., 3.1416 ${unit}`;
            break;
          case 'surfaceArea':
            valueEl.placeholder = `e.g., 3.14 ${unit}²`;
            break;
        }
      }

      // Validation (on blur)
      valueEl.addEventListener('blur', () => validate());
      precisionEl.addEventListener('blur', () => {
        const p = clampPrec(Number(precisionEl.value));
        precisionEl.value = String(p);
      });

      function validate() {
        valueErr.hidden = true;
        valueErr.textContent = '';
        const v = Number(valueEl.value);
        if (!Number.isFinite(v)) {
          showErr('Please enter a valid number.');
          return false;
        }
        if (v < 0) {
          showErr('Value must be non-negative. Enter 0 or a positive number.');
          return false;
        }
        if (givenEl.value === 'surfaceArea' && v === 0) {
          showErr('Surface area cannot be zero for a sphere.');
          return false;
        }
        return true;
      }

      function showErr(msg) {
        valueErr.hidden = false;
        valueErr.textContent = msg;
      }

      // Core calculation
      function calculate() {
        if (!validate()) { renderEmpty(); return; }

        const p = clampPrec(Number(precisionEl.value));
        const unit = unitEl.value;
        const val = Number(valueEl.value);
        if (!Number.isFinite(val)) { renderEmpty(); return; }

        // Compute radius in meters
        let r_m;
        const to_m = toMeters[unit];
        switch (givenEl.value) {
          case 'radius': {
            const r = to_m(val);
            r_m = r;
            break;
          }
          case 'diameter': {
            const d = to_m(val);
            r_m = d / 2;
            break;
          }
          case 'circumference': {
            const c = to_m(val);
            r_m = c / (2 * Math.PI);
            break;
          }
          case 'surfaceArea': {
            // val given in unit^2 -> convert to m^2
            const a_m2 = to_m(1) * to_m(1) * val / (to_m(1) * to_m(1)); // cancel if unit == m; clearer below:
            const u = to_m(1); // unit to meters
            const A = val * (u * u); // now m^2
            r_m = Math.sqrt(A / (4 * Math.PI));
            break;
          }
          default:
            renderEmpty(); return;
        }

        if (!(r_m > 0 || (r_m === 0 && givenEl.value === 'radius'))) {
          renderEmpty(); return;
        }

        // Volume in m^3
        const V_m3 = (4/3) * Math.PI * Math.pow(r_m, 3);

        // Derived geometry back in chosen unit
        const from_m = fromMeters[unit];
        const r_u = from_m(r_m);
        const d_u = 2 * r_u;
        const c_u = 2 * Math.PI * r_u;
        const A_u2 = 4 * Math.PI * r_u * r_u;

        // Volume in chosen unit^3
        const u = to_m(1);           // meters per unit
        const V_u3 = V_m3 / Math.pow(u, 3);

        // Conversions
        const liters = V_m3 * 1000;
        const gallonsUS = liters * 0.264172052; // exact enough

        // Render
        out.primary.textContent = `${fmt(V_u3, p)} ${unit}³`;
        out.m3.textContent = `${fmt(V_m3, p)} m³`;
        out.L.textContent = `${fmt(liters, p)} L`;
        out.gal.textContent = `${fmt(gallonsUS, p)} gal`;

        out.r.textContent = `${fmt(r_u, p)} ${unit}`;
        out.d.textContent = `${fmt(d_u, p)} ${unit}`;
        out.c.textContent = `${fmt(c_u, p)} ${unit}`;
        out.a.textContent = `${fmt(A_u2, p)} ${unit}²`;
      }

      function renderEmpty() {
        ['primary','m3','L','gal'].forEach(k => out[k].textContent = '—');
        ['r','d','c','a'].forEach(k => out[k].textContent = '—');
      }

      // Auto/manual calculate
      function syncAuto() {
        const isAuto = autoCalcEl.value === 'on';
        calcBtn.disabled = isAuto;
      }

      // Events
      ['change','input'].forEach(ev => {
        givenEl.addEventListener(ev, () => { updateLabelAndPlaceholder(); if (autoCalcEl.value==='on') calculate(); });
        unitEl.addEventListener(ev, () => { updateLabelAndPlaceholder(); if (autoCalcEl.value==='on') calculate(); });
        precisionEl.addEventListener(ev, () => { if (autoCalcEl.value==='on') calculate(); });
        valueEl.addEventListener(ev, () => { if (autoCalcEl.value==='on') calculate(); });
        autoCalcEl.addEventListener(ev, () => { syncAuto(); if (autoCalcEl.value==='on') calculate(); });
      });

      calcBtn.addEventListener('click', calculate);

      copyBtn.addEventListener('click', async () => {
        const text = [
          `Sphere Volume Results`,
          `Given: ${currentLabel().replace('*','')} = ${valueEl.value} ${unitEl.value}`,
          out.primary.textContent !== '—' ? `Volume (unit³): ${out.primary.textContent}` : '',
          out.m3.textContent !== '—' ? `Volume (m³): ${out.m3.textContent}` : '',
          out.L.textContent !== '—' ? `Liters: ${out.L.textContent}` : '',
          out.gal.textContent !== '—' ? `US Gallons: ${out.gal.textContent}` : '',
          out.r.textContent !== '—' ? `Radius: ${out.r.textContent}` : '',
          out.d.textContent !== '—' ? `Diameter: ${out.d.textContent}` : '',
          out.c.textContent !== '—' ? `Circumference: ${out.c.textContent}` : '',
          out.a.textContent !== '—' ? `Surface area: ${out.a.textContent}` : ''
        ].filter(Boolean).join('\n');
        try {
          await navigator.clipboard.writeText(text);
          copyBtn.textContent = 'Copied!';
          setTimeout(()=>copyBtn.textContent='Copy results',1200);
        } catch {
          alert('Copy failed. Select and copy manually.');
        }
      });

      resetBtn.addEventListener('click', () => {
        givenEl.value = 'radius';
        unitEl.value = 'm';
        precisionEl.value = '4';
        valueEl.value = '';
        valueErr.hidden = true;
        valueErr.textContent = '';
        autoCalcEl.value = 'on';
        syncAuto();
        updateLabelAndPlaceholder();
        renderEmpty();
      });

      printBtn.addEventListener('click', () => window.print());

      // Init
      syncAuto();
      updateLabelAndPlaceholder();
      renderEmpty();
    })();
  </script>
</body>
</html>
