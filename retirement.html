<!DOCTYPE html>
<html lang="en">
<head> 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
  <meta charset="utf-8">
  <title>Retirement Calculator | Plan Savings & Income</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Project your retirement nest egg, estimate sustainable income, and see how much to save each month—adjusted for inflation and Social Security.">
  <meta name="author" content="Ugo Candido">
  <link rel="canonical" href="https://calcdomain.com/retirement.html">
  <meta name="theme-color" content="#0b3d69">
  <meta name="robots" content="index,follow">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Retirement Calculator">
  <meta property="og:description" content="Estimate retirement savings, sustainable withdrawals, and contribution goals in today’s pounds.">
  <meta property="og:url" content="https://calcdomain.com/retirement.html">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="search.js" defer></script>
  <style>
    body { font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif; }
    .prose { max-width:72ch; }
    .prose h2 { font-size:1.5rem; font-weight:700; margin-top:2rem; margin-bottom:.75rem; }
    .prose h3 { font-size:1.125rem; font-weight:700; margin-top:1.25rem; margin-bottom:.5rem; }
    .prose p { margin-bottom:.9rem; line-height:1.7; }
    .prose ul { list-style:disc; padding-left:1.25rem; }
    .prose ol { list-style:decimal; padding-left:1.25rem; }
    .eeat { display:grid; gap:.75rem; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); font-size:.875rem; color:#374151; }
    .eeat span { display:block; background:#f9fafb; border:1px solid #e5e7eb; border-radius:.5rem; padding:.75rem 1rem; }
    .result-pill { display:inline-flex; align-items:center; font-size:.875rem; font-weight:600; padding:.25rem .75rem; border-radius:9999px; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.5rem 1rem; border-radius:.5rem; border:1px solid transparent; font-weight:600; min-height:44px; transition:background-color .2s ease,color .2s ease,border-color .2s ease; }
    .btn-primary { background:#2563eb; color:#fff; border-color:#2563eb; }
    .btn-secondary { background:#fff; color:#2563eb; border-color:#2563eb; }
    .btn-ghost { background:transparent; color:#1f2937; border-color:#e2e8f0; }
    .btn:hover { filter:brightness(.95); }
    .grid-form { display:grid; gap:1.5rem; grid-template-columns:repeat(1,minmax(0,1fr)); }
    @media (min-width:768px){ .grid-form { grid-template-columns:repeat(2,minmax(0,1fr)); } }
    .field label { display:block; font-size:.875rem; font-weight:600; color:#374151; margin-bottom:.25rem; }
    .field input, .field select { width:100%; padding:.5rem .75rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:1rem; }
    .helper { font-size:.75rem; color:#6b7280; margin-top:.25rem; }
    .table { width:100%; border-collapse:collapse; }
    .table th, .table td { border:1px solid #e2e8f0; padding:.5rem; text-align:right; }
    .table th:first-child, .table td:first-child { text-align:left; }
    .sticky-ad { height:600px; }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Finance","item":"https://calcdomain.com/finance.html"},
      {"@type":"ListItem","position":3,"name":"Retirement","item":"https://calcdomain.com/subcategories/finance-retirement.html"},
      {"@type":"ListItem","position":4,"name":"Retirement Calculator","item":"https://calcdomain.com/retirement.html"}
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Retirement Calculator",
    "description":"Project retirement savings, sustainable withdrawals, and required savings rate with inflation and Social Security adjustments.",
    "url":"https://calcdomain.com/retirement.html",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "mainEntity":{
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"Are results in today’s pounds?","acceptedAnswer":{"@type":"Answer","text":"Yes. We inflation-adjust your nest egg and income so everything is expressed in today’s purchasing power."}},
        {"@type":"Question","name":"What return assumptions should I use?","acceptedAnswer":{"@type":"Answer","text":"Consider long-term diversified portfolio assumptions aligned with your risk tolerance. Many planners use 4–7% before retirement and 3–4% during retirement."}},
        {"@type":"Question","name":"Can the tool include Social Security?","acceptedAnswer":{"@type":"Answer","text":"Enter your estimated monthly benefit (today’s pounds). We add it to the sustainable withdrawal."}},
        {"@type":"Question","name":"What if returns are near zero?","acceptedAnswer":{"@type":"Answer","text":"The calculator gracefully falls back to arithmetic sums when real returns are close to zero to avoid divide-by-zero artifacts."}}
      ]
    }
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">

  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            <input id="search-input" type="search" placeholder="Search for a calculator..."
                   class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>

        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <div id="mobile-menu" class="md:hidden mt-4 hidden">
        <div class="mb-4">
          <div class="relative">
            <input id="mobile-search-input" type="search" placeholder="Search calculators..."
                   class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                   aria-label="Search calculators">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        <div class="space-y-2">
          <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <section class="w-full lg:w-2/3">
        <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
          <a href="subcategories/finance-retirement.html" class="hover:text-blue-600">Retirement</a> &raquo;
          <span class="text-gray-900 font-medium">Retirement Calculator</span>
        </nav>

        <section class="bg-white p-6 rounded-lg shadow-md">
          <h1 class="text-3xl font-bold mb-2">Retirement Calculator</h1>
          <p class="text-gray-600 mb-4">
            Forecast your retirement savings, estimate sustainable withdrawals, and see how much to save each month.
            All results are shown in today’s pounds using your inflation assumption.
          </p>

          <div class="eeat mb-6">
            <span><strong>Author:</strong> Ugo Candido</span>
            <span><strong>Reviewed by:</strong> Retirement Planning Editor</span>
            <span><strong>Last updated:</strong> <time id="lastUpdated"></time></span>
            <span><strong>Category:</strong> Finance → Retirement</span>
          </div>

          <div class="grid-form">
            <div class="field">
              <label for="currentAge">Current age *</label>
              <input id="currentAge" type="number" min="16" max="80" step="1" value="35">
            </div>
            <div class="field">
              <label for="retireAge">Retirement age *</label>
              <input id="retireAge" type="number" min="40" max="80" step="1" value="67">
              <p class="helper">Must be greater than current age.</p>
            </div>
            <div class="field">
              <label for="yearsRetired">Years in retirement *</label>
              <input id="yearsRetired" type="number" min="5" max="40" step="1" value="25">
            </div>
            <div class="field">
              <label for="currentSavings">Current retirement savings (£)</label>
              <input id="currentSavings" type="number" min="0" step="1000" value="50000">
            </div>
            <div class="field">
              <label for="monthlyContribution">Monthly contribution (£)</label>
              <input id="monthlyContribution" type="number" min="0" step="10" value="500">
            </div>
            <div class="field">
              <label for="monthlyMatch">Employer contribution per month (£)</label>
              <input id="monthlyMatch" type="number" min="0" step="10" value="100">
            </div>
            <div class="field">
              <label for="preReturn">Expected annual return before retirement (%)</label>
              <input id="preReturn" type="number" step="0.1" value="6">
            </div>
            <div class="field">
              <label for="postReturn">Expected annual return during retirement (%)</label>
              <input id="postReturn" type="number" step="0.1" value="4">
            </div>
            <div class="field">
              <label for="inflation">Inflation assumption (%)</label>
              <input id="inflation" type="number" step="0.1" value="2.5">
            </div>
            <div class="field">
              <label for="desiredIncome">Desired annual income (today’s £)</label>
              <input id="desiredIncome" type="number" min="0" step="1000" value="40000">
            </div>
            <div class="field">
              <label for="socialSecurity">Estimated monthly Social Security / pension (today’s £)</label>
              <input id="socialSecurity" type="number" min="0" step="50" value="800">
            </div>
          </div>

          <div class="mt-4 flex flex-wrap gap-2">
            <button id="calcBtn" type="button" class="btn btn-primary">Calculate</button>
            <button id="exampleBtn" type="button" class="btn btn-secondary">Load example</button>
            <button id="resetBtn" type="button" class="btn btn-ghost">Reset</button>
          </div>

          <section aria-live="polite" aria-atomic="true" class="mt-6 bg-blue-50 p-6 rounded-lg">
            <h2 class="text-lg font-semibold text-gray-800 mb-2">Results (today’s £)</h2>
            <div class="grid sm:grid-cols-2 gap-3">
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Years to retirement</span>
                <span id="yearsToRetire" class="text-xl font-bold">—</span>
              </div>
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Projected nest egg (nominal)</span>
                <span id="nestEggNominal" class="text-xl font-bold text-green-700">£0</span>
              </div>
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Projected nest egg (real)</span>
                <span id="nestEggReal" class="text-xl font-bold">£0</span>
              </div>
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Sustainable income (annual)</span>
                <span id="incomeAnnual" class="text-xl font-bold text-green-700">£0</span>
              </div>
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Sustainable income (monthly)</span>
                <span id="incomeMonthly" class="text-xl font-bold">£0</span>
              </div>
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Total income incl. Social Security</span>
                <span id="totalIncome" class="text-xl font-bold">£0</span>
              </div>
              <div class="flex items-baseline justify-between border-b pb-2">
                <span class="text-gray-600">Income gap vs goal</span>
                <span id="incomeGap" class="text-xl font-bold text-red-600">£0</span>
              </div>
              <div class="flex items-baseline justify-between">
                <span class="text-gray-600">Suggested monthly savings</span>
                <span id="suggestedSavings" class="text-xl font-bold">£0</span>
              </div>
            </div>
            <div class="mt-3 space-x-2">
              <span class="result-pill bg-sky-100 text-sky-800" id="pillYears">Years: —</span>
              <span class="result-pill bg-violet-100 text-violet-800" id="pillRealRate">Real return: —</span>
              <span class="result-pill bg-emerald-100 text-emerald-800" id="pillTarget">Goal status: —</span>
            </div>
          </section>

          <section class="mt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Sensitivity (±1% around pre-retirement return)</h3>
            <div class="overflow-x-auto">
              <table class="table text-sm">
                <thead>
                  <tr>
                    <th>Return assumption</th>
                    <th>Nest egg (nominal)</th>
                  </tr>
                </thead>
                <tbody id="sensBody">
                  <tr><td class="p-2 text-center text-gray-500" colspan="2">Adjust inputs to see projection range…</td></tr>
                </tbody>
              </table>
            </div>
          </section>
        </section>

        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>How This Retirement Calculator Works</h2>
          <p>We compound today’s savings and future contributions until retirement, discounting results by your inflation assumption.
             During retirement, we estimate sustainable withdrawals using a real return (post-retirement return minus inflation).</p>

          <h2>Key Formulas</h2>
          <div class="formula-box">
            <p><strong>Future value of current savings</strong></p>
            <div>\[
              FV_{\text{savings}} = P_0 (1 + r_{\text{pre}})^{T}
            \]</div>
            <p><strong>Future value of monthly contributions (with employer match)</strong></p>
            <div>\[
              FV_{\text{contrib}} =
              \begin{cases}
                C \cdot \dfrac{(1+i)^{n}-1}{i}, & i \ne 0 \\
                C \cdot n, & i = 0
              \end{cases}
            \]
            where \(C\) is total monthly contribution and \(i\) the monthly return.</div>
            <p><strong>Sustainable real withdrawal (monthly) over \(N\) months</strong></p>
            <div>\[
              W = \begin{cases}
                \dfrac{FV_{\text{real}} \cdot r_{\text{real}}}{1-(1+r_{\text{real}})^{-N}}, & r_{\text{real}} \ne 0 \\\\[6pt]
                \dfrac{FV_{\text{real}}}{N}, & r_{\text{real}} = 0
              \end{cases}
            \]</div>
          </div>

          <h2>How to Use</h2>
          <ol>
            <li>Enter your current age, planned retirement age, and years you expect to spend in retirement.</li>
            <li>Add today’s savings, monthly contribution, and any employer contribution.</li>
            <li>Set return assumptions and inflation. We use them to grow balances and convert to real pounds.</li>
            <li>Provide your desired annual income (today’s pounds) and estimated Social Security or defined-benefit income.</li>
            <li>Review projected nest egg, sustainable withdrawals, total income, and the contribution needed to close any gap.</li>
          </ol>

          <h2>Frequently Asked Questions</h2>
          <h3>Does this include taxes?</h3>
          <p>No. Results are pre-tax. Adjust for your effective tax rate or consult a financial professional.</p>
          <h3>How often should I revisit my plan?</h3>
          <p>Review at least annually or whenever your income, contributions, or goals change significantly.</p>
          <h3>What if my employer match changes?</h3>
          <p>Update the employer contribution field to see how it affects your projected nest egg and suggested savings.</p>
          <h3>What assumptions does the sensitivity table use?</h3>
          <p>It varies the pre-retirement return by ±1% while holding other inputs constant to show how sensitive your nest egg is to market returns.</p>
        </article>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-gray-200 rounded-lg h-72 flex items-center justify-center text-gray-500">
            Ad Placement (300×600)
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related Retirement Tools</h3>
            <ul class="space-y-3 text-sm">
              <li><a class="text-blue-600 hover:underline" href="sipp.html">SIPP (UK) Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="pension.html">Defined Benefit Pension Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="sip-calculator.html">Systematic Investment Plan</a></li>
              <li><a class="text-blue-600 hover:underline" href="inflation.html">Inflation Calculator</a></li>
            </ul>
          </div>
        </div>
      </aside>

    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600">
      <p>&copy; <span id="year">2025</span> CalcDomain. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    const els = {
      currentAge: document.getElementById('currentAge'),
      retireAge: document.getElementById('retireAge'),
      yearsRetired: document.getElementById('yearsRetired'),
      currentSavings: document.getElementById('currentSavings'),
      monthlyContribution: document.getElementById('monthlyContribution'),
      monthlyMatch: document.getElementById('monthlyMatch'),
      preReturn: document.getElementById('preReturn'),
      postReturn: document.getElementById('postReturn'),
      inflation: document.getElementById('inflation'),
      desiredIncome: document.getElementById('desiredIncome'),
      socialSecurity: document.getElementById('socialSecurity'),
      yearsToRetire: document.getElementById('yearsToRetire'),
      nestEggNominal: document.getElementById('nestEggNominal'),
      nestEggReal: document.getElementById('nestEggReal'),
      incomeAnnual: document.getElementById('incomeAnnual'),
      incomeMonthly: document.getElementById('incomeMonthly'),
      totalIncome: document.getElementById('totalIncome'),
      incomeGap: document.getElementById('incomeGap'),
      suggestedSavings: document.getElementById('suggestedSavings'),
      pillYears: document.getElementById('pillYears'),
      pillRealRate: document.getElementById('pillRealRate'),
      pillTarget: document.getElementById('pillTarget'),
      sensBody: document.getElementById('sensBody'),
      calcBtn: document.getElementById('calcBtn'),
      exampleBtn: document.getElementById('exampleBtn'),
      resetBtn: document.getElementById('resetBtn'),
      lastUpdated: document.getElementById('lastUpdated'),
      year: document.getElementById('year')
    };

    const fmtGBP = (v) => {
      try {
        return new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP',maximumFractionDigits:0}).format(v);
      } catch {
        const sign = v < 0 ? '-' : '';
        return sign + '£' + Math.abs(v).toFixed(0);
      }
    };
    const fmtGBP2 = (v) => {
      try {
        return new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP',maximumFractionDigits:2}).format(v);
      } catch {
        const sign = v < 0 ? '-' : '';
        return sign + '£' + Math.abs(v).toFixed(2);
      }
    };
    const fmtPercent = (x) => Number.isFinite(x) ? (x*100).toFixed(2) + '%' : '—';

    function monthsToRetire(age, retireAge){
      return Math.max(0, (retireAge - age) * 12);
    }

    function monthlyRate(annual){
      return Math.pow(1 + annual, 1/12) - 1;
    }

    function fvMonthly(pmt, rate, n){
      if (Math.abs(rate) < 1e-9) return pmt * n;
      return pmt * ((Math.pow(1 + rate, n) - 1) / rate);
    }

    function pvFromWithdrawal(withdrawal, rate, months){
      if (Math.abs(rate) < 1e-9) return withdrawal * months;
      return withdrawal * (1 - Math.pow(1 + rate, -months)) / rate;
    }

    function resetOutputs(){
      els.yearsToRetire.textContent = '—';
      els.nestEggNominal.textContent = fmtGBP(0);
      els.nestEggReal.textContent = fmtGBP(0);
      els.incomeAnnual.textContent = fmtGBP(0);
      els.incomeMonthly.textContent = fmtGBP(0);
      els.totalIncome.textContent = fmtGBP(0);
      els.incomeGap.textContent = fmtGBP(0);
      els.suggestedSavings.textContent = fmtGBP(0);
      els.pillYears.textContent = 'Years: —';
      els.pillRealRate.textContent = 'Real return: —';
      els.pillTarget.textContent = 'Goal status: —';
      els.sensBody.innerHTML = '<tr><td class="p-2 text-center text-gray-500" colspan="2">Adjust inputs to see projection range…</td></tr>';
    }

    function buildSensitivity(params){
      els.sensBody.innerHTML = '';
      [-0.01, 0, 0.01].forEach(delta => {
        const adjPre = Math.max(-0.99, params.pre + delta);
        const monthly = monthlyRate(adjPre);
        const fvContrib = fvMonthly(params.contribution, monthly, params.months);
        const fvSavings = params.currentSavings * Math.pow(1 + adjPre, params.years);
        const total = fvSavings + fvContrib;
        const tr = document.createElement('tr');
        const tdRate = document.createElement('td'); tdRate.className = 'p-2 text-left'; tdRate.textContent = fmtPercent(adjPre);
        const tdValue = document.createElement('td'); tdValue.className = 'p-2 text-right'; tdValue.textContent = fmtGBP(total);
        tr.append(tdRate, tdValue);
        els.sensBody.appendChild(tr);
      });
    }

    function calculate(){
      resetOutputs();
      const age = Number(els.currentAge.value);
      const retireAge = Number(els.retireAge.value);
      if (!Number.isFinite(age) || !Number.isFinite(retireAge) || retireAge <= age){
        return;
      }

      const months = monthsToRetire(age, retireAge);
      const years = months / 12;
      const yearsRetired = Math.max(1, Number(els.yearsRetired.value) || 0);
      const currentSavings = Math.max(0, Number(els.currentSavings.value) || 0);
      const monthlyContribution = Math.max(0, Number(els.monthlyContribution.value) || 0);
      const monthlyMatch = Math.max(0, Number(els.monthlyMatch.value) || 0);
      const totalContribution = monthlyContribution + monthlyMatch;
      const preReturn = Math.max(-99, Number(els.preReturn.value) || 0) / 100;
      const postReturn = Math.max(-99, Number(els.postReturn.value) || 0) / 100;
      const inflation = Math.max(0, Number(els.inflation.value) || 0) / 100;
      const desiredIncome = Math.max(0, Number(els.desiredIncome.value) || 0);
      const socialSecurityMonthly = Math.max(0, Number(els.socialSecurity.value) || 0);
      const socialSecurityAnnual = socialSecurityMonthly * 12;

      const monthlyPre = monthlyRate(preReturn);
      const fvSavings = currentSavings * Math.pow(1 + preReturn, years);
      const fvContrib = fvMonthly(totalContribution, monthlyPre, months);
      const nestEggNominal = fvSavings + fvContrib;
      const nestEggReal = nestEggNominal / Math.pow(1 + inflation, years);

      const realReturn = ((1 + postReturn) / (1 + inflation)) - 1;
      const realMonthly = monthlyRate(realReturn);
      const retirementMonths = yearsRetired * 12;
      const sustainableMonthlyReal = (Math.abs(realMonthly) < 1e-9)
        ? (nestEggReal / retirementMonths)
        : (nestEggReal * realMonthly) / (1 - Math.pow(1 + realMonthly, -retirementMonths));
      const sustainableAnnualReal = sustainableMonthlyReal * 12;
      const totalIncomeReal = sustainableAnnualReal + socialSecurityAnnual;
      const incomeGap = desiredIncome - totalIncomeReal;

      const targetWithdrawal = Math.max(0, desiredIncome - socialSecurityAnnual);
      const targetNestEggReal = (Math.abs(realMonthly) < 1e-9)
        ? targetWithdrawal * yearsRetired
        : pvFromWithdrawal(targetWithdrawal / 12, realMonthly, retirementMonths);
      const targetNestEggNominal = targetNestEggReal * Math.pow(1 + inflation, years);
      const fvNeededFromContrib = Math.max(0, targetNestEggNominal - fvSavings);
      const totalNeededContribution = (Math.abs(monthlyPre) < 1e-9)
        ? fvNeededFromContrib / months
        : fvNeededFromContrib * monthlyPre / (Math.pow(1 + monthlyPre, months) - 1);
      const userNeeded = Math.max(0, totalNeededContribution - monthlyMatch);
      els.yearsToRetire.textContent = years.toFixed(1);
      els.nestEggNominal.textContent = fmtGBP(nestEggNominal);
      els.nestEggReal.textContent = fmtGBP(nestEggReal);
      els.incomeAnnual.textContent = fmtGBP2(sustainableAnnualReal);
      els.incomeMonthly.textContent = fmtGBP2(sustainableMonthlyReal);
      els.totalIncome.textContent = fmtGBP2(totalIncomeReal);
      els.incomeGap.textContent = fmtGBP2(incomeGap);
      els.suggestedSavings.textContent = fmtGBP2(Math.max(0, userNeeded));

      els.pillYears.textContent = `Years: ${years.toFixed(1)}`;
      els.pillRealRate.textContent = `Real return: ${fmtPercent(realReturn)}`;
      els.pillTarget.textContent = incomeGap > 0 ? 'Goal status: Shortfall' : 'Goal status: On track';

      buildSensitivity({
        pre: preReturn,
        contribution: totalContribution,
        months,
        years,
        currentSavings
      });
    }

    function loadExample(){
      els.currentAge.value = 35;
      els.retireAge.value = 67;
      els.yearsRetired.value = 25;
      els.currentSavings.value = 50000;
      els.monthlyContribution.value = 500;
      els.monthlyMatch.value = 100;
      els.preReturn.value = 6;
      els.postReturn.value = 4;
      els.inflation.value = 2.5;
      els.desiredIncome.value = 40000;
      els.socialSecurity.value = 800;
      calculate();
    }

    function resetForm(){
      els.currentAge.value = '';
      els.retireAge.value = '';
      els.yearsRetired.value = 25;
      els.currentSavings.value = '';
      els.monthlyContribution.value = '';
      els.monthlyMatch.value = '';
      els.preReturn.value = 6;
      els.postReturn.value = 4;
      els.inflation.value = 2.5;
      els.desiredIncome.value = '';
      els.socialSecurity.value = '';
      resetOutputs();
    }

    els.calcBtn.addEventListener('click', calculate);
    els.exampleBtn.addEventListener('click', loadExample);
    els.resetBtn.addEventListener('click', resetForm);

    document.addEventListener('DOMContentLoaded', () => {
      const d = new Date();
      if (els.lastUpdated) {
        els.lastUpdated.textContent = d.toLocaleDateString('en-GB',{year:'numeric',month:'long',day:'numeric'});
      }
      if (els.year) {
        els.year.textContent = d.getFullYear();
      }
      loadExample();

      const toggle = document.getElementById('mobile-menu-toggle');
      const menu = document.getElementById('mobile-menu');
      toggle?.addEventListener('click', () => { menu?.classList.toggle('hidden'); });
    });
  </script>
</body>
</html>
