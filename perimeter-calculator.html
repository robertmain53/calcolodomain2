<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perimeter Calculator — Fast, Accessible & Accurate</title>
  <meta name="description" content="Compute the perimeter of common shapes (rectangle, square, triangle, circle, regular polygon) with step-by-step examples, LaTeX formulas, and WCAG-accessible UI." />
  <link rel="canonical" href="https://calcdomain.com/perimeter-calculator.html" />
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- MathJax for LaTeX rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          id="MathJax-script"></script>
  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --focus-ring: 3px solid #2563eb;
    }
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    /* Content width */
    .prose { max-width: 70ch; }
    .formula-box {
      background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
      overflow-x:auto; font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    }
    /* Visible focus */
    :where(a, button, [role="button"], input, select, textarea, summary):focus {
      outline: var(--focus-ring);
      outline-offset: 2px;
    }
    /* Minimum result height to prevent CLS */
    #results-panel { min-height: 220px; }
    /* 48x48 touch targets for primary buttons */
    .touch-target { min-height: 48px; min-width: 48px; }
    /* Error text */
    .field-error { color: #b91c1c; }
    details>summary { cursor: pointer; }
    details[open]>summary { margin-bottom: .5rem; }
    @media print {
      body { background: #fff; }
      #results-chart, .no-print { display: none !important; }
      #print-section { position: static; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Perimeter Calculator",
    "url":"https://calcdomain.com/perimeter-calculator.html",
    "inLanguage":"en",
    "description":"Compute the perimeter of rectangles, squares, triangles, circles, and regular polygons with formulas, glossary, and worked examples.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: WebApplication (Calculator) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Perimeter Calculator",
    "applicationCategory":"EducationalApplication",
    "operatingSystem":"Any",
    "url":"https://calcdomain.com/perimeter-calculator.html",
    "creator":{"@type":"Person","name":"Ugo Candido"}
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Perimeter Calculator","item":"https://calcdomain.com/perimeter-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to calculate perimeter",
    "description":"Choose a shape and enter its dimensions to compute perimeter.",
    "step":[
      {"@type":"HowToStep","name":"Select shape","text":"Pick rectangle, square, triangle, circle, or regular polygon."},
      {"@type":"HowToStep","name":"Enter dimensions","text":"Provide sides, radius, or number of sides as required."},
      {"@type":"HowToStep","name":"Get perimeter","text":"The calculator computes and shows the perimeter instantly."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is perimeter?","acceptedAnswer":{"@type":"Answer","text":"Perimeter is the total length around a 2D shape, measured by summing the lengths of its boundary."}},
      {"@type":"Question","name":"Which units can I use?","acceptedAnswer":{"@type":"Answer","text":"Any consistent length units (e.g., m, cm, in, ft). The result is returned in the same unit."}},
      {"@type":"Question","name":"How do I find triangle perimeter from sides?","acceptedAnswer":{"@type":"Answer","text":"Use P = a + b + c. Ensure the three lengths satisfy triangle inequality."}},
      {"@type":"Question","name":"What is the circle perimeter formula?","acceptedAnswer":{"@type":"Answer","text":"Circumference P = 2πr or P = πd."}},
      {"@type":"Question","name":"How do I compute a regular polygon's perimeter?","acceptedAnswer":{"@type":"Answer","text":"For n sides of length s, P = n·s. If you know circumradius R, use s = 2R·sin(π/n)."}},
      {"@type":"Question","name":"Is perimeter the same as area?","acceptedAnswer":{"@type":"Answer","text":"No. Perimeter measures boundary length; area measures surface extent. They use different formulas."}},
      {"@type":"Question","name":"Why does validation block my input?","acceptedAnswer":{"@type":"Answer","text":"To prevent impossible or ambiguous shapes (e.g., negative lengths or triangle inequality violations). Fix inputs as suggested in the inline error."}}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky as required) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a href="search.html" class="hover:text-blue-600">Search</a>
        <a href="math.html" class="hover:text-blue-600">Math</a>
        <a href="index.html#categories" class="hover:text-blue-600">All categories</a>
      </div>
      <button class="md:hidden p-2 rounded hover:bg-gray-100" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
      <a href="math.html" class="hover:text-blue-600">Math</a> &raquo;
      <span class="text-gray-900">Perimeter Calculator</span>
    </nav>

    <!-- 1) H1 -->
    <h1 class="text-3xl font-extrabold mb-2">perimeter calculator</h1>

    <!-- 2) Intro -->
    <p class="text-gray-700 mb-6">
      Compute the perimeter of common shapes—rectangle, square, triangle, circle, and regular polygon—with an
      accessible, mobile-first interface. Built for students, engineers, and professionals who need accurate,
      fast results with clear formulas and validation.
    </p>

    <div id="print-section" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- 3) Calculator -->
      <section class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md" aria-label="Perimeter calculator">
        <form id="calc-form" novalidate class="space-y-6">
          <!-- Shape selector -->
          <div>
            <label for="shape" class="block text-sm font-semibold text-gray-800 mb-1">
              Shape <span aria-hidden="true" class="text-red-600">*</span>
            </label>
            <div class="flex items-center gap-3">
              <select id="shape" name="shape" aria-required="true"
                      class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none"
                      aria-describedby="shape-help">
                <option value="rectangle" selected>Rectangle</option>
                <option value="square">Square</option>
                <option value="triangle">Triangle (3 sides)</option>
                <option value="circle">Circle</option>
                <option value="regularPolygon">Regular polygon</option>
              </select>
              <button type="button" class="touch-target px-3 py-2 rounded border"
                      aria-expanded="false" aria-controls="shape-help" data-tooltip="shape-help">?</button>
            </div>
            <p id="shape-help" class="text-sm text-gray-600 mt-1 hidden">
              Choose the shape. The form adapts to request only the necessary dimensions.
            </p>
            <p id="shape-error" class="field-error text-sm mt-1 hidden"></p>
          </div>

          <!-- Dynamic fields container -->
          <div id="fields" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>

          <!-- Actions -->
          <div class="flex flex-wrap items-center gap-3">
            <button id="calc-btn" type="button"
                    class="touch-target inline-flex items-center justify-center px-5 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 focus:outline-none"
                    aria-label="Calculate perimeter">
              Calculate
            </button>
            <button id="reset-btn" type="reset"
                    class="touch-target inline-flex items-center justify-center px-5 py-3 rounded-lg border font-semibold hover:bg-gray-50 focus:outline-none"
                    aria-label="Reset form">
              Reset
            </button>
          </div>
        </form>
      </section>

      <!-- 4) Results -->
      <section id="results-panel" class="bg-blue-50 p-6 rounded-lg border border-blue-100 lg:col-span-1">
        <h2 class="text-xl font-bold text-blue-800 mb-3">Results</h2>
        <div class="grid gap-4">
          <div class="bg-white border rounded-lg p-4 text-center">
            <h3 class="text-sm text-gray-500 mb-1">Perimeter</h3>
            <p id="perimeter-out" class="text-2xl font-extrabold text-blue-700">—</p>
          </div>
          <div class="bg-white border rounded-lg p-4">
            <h3 class="text-sm text-gray-500 mb-2">Formula used</h3>
            <div id="formula-used" class="text-sm text-gray-800"></div>
          </div>
          <div class="bg-white border rounded-lg p-4">
            <h3 class="text-sm text-gray-500 mb-2">Notes</h3>
            <ul id="result-notes" class="list-disc list-inside text-sm text-gray-700 space-y-1"></ul>
          </div>
        </div>
      </section>
    </div>

    <!-- 5) Authoritative content -->
    <section class="mt-10 space-y-8">
      <!-- a) Data source & methodology -->
      <article class="bg-white p-6 rounded-lg shadow-md prose">
        <h2>Authoritative data source & methodology</h2>
        <p>
          Primary references:
          <ul>
            <li><a class="text-blue-600 hover:underline" href="https://dlmf.nist.gov/" target="_blank" rel="noopener">NIST Digital Library of Mathematical Functions (2010–)</a>.</li>
            <li><a class="text-blue-600 hover:underline" href="https://mathworld.wolfram.com/" target="_blank" rel="noopener">Wolfram MathWorld</a> — entries on polygon, circle, and triangle perimeter.</li>
          </ul>
        </p>
        <p><strong>All calculations strictly follow the formulas and definitions provided by these sources.</strong></p>
      </article>

      <!-- b) The formula explained -->
      <article class="bg-white p-6 rounded-lg shadow-md prose">
        <h2>The formula explained</h2>
        <div class="formula-box">
          <p><strong>Rectangle</strong>: \\(P = 2(L + W)\\)</p>
          <p><strong>Square</strong>: \\(P = 4s\\)</p>
          <p><strong>Triangle (sides \\(a,b,c\\))</strong>: \\(P = a + b + c\\)</p>
          <p><strong>Circle (circumference)</strong>: \\(P = 2\\pi r = \\pi d\\)</p>
          <p><strong>Regular polygon</strong> (\\(n\\) sides, side \\(s\\)): \\(P = n\\,s\\). With circumradius \\(R\\): \\(s = 2R\\sin(\\pi/n)\\).</p>
        </div>
      </article>

      <!-- c) Glossary -->
      <article class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-3">Glossary of variables</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-gray-100 text-gray-700">
              <tr>
                <th class="text-left px-4 py-2">Symbol</th>
                <th class="text-left px-4 py-2">Meaning</th>
                <th class="text-left px-4 py-2">Units</th>
              </tr>
            </thead>
            <tbody>
              <tr><td class="px-4 py-2">\\(P\\)</td><td class="px-4 py-2">Perimeter (total boundary length)</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(L\\)</td><td class="px-4 py-2">Rectangle length</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(W\\)</td><td class="px-4 py-2">Rectangle width</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(s\\)</td><td class="px-4 py-2">Side length (square or polygon)</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(a,b,c\\)</td><td class="px-4 py-2">Triangle side lengths</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(r\\)</td><td class="px-4 py-2">Circle radius</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(d\\)</td><td class="px-4 py-2">Circle diameter</td><td class="px-4 py-2">Length</td></tr>
              <tr><td class="px-4 py-2">\\(n\\)</td><td class="px-4 py-2">Number of sides (regular polygon, integer \\(\\ge 3\\))</td><td class="px-4 py-2">—</td></tr>
              <tr><td class="px-4 py-2">\\(R\\)</td><td class="px-4 py-2">Circumradius (center to vertex, regular polygon)</td><td class="px-4 py-2">Length</td></tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- d) Worked example -->
      <article class="bg-white p-6 rounded-lg shadow-md prose">
        <h2>How it works: a step-by-step example</h2>
        <h3>Example — Regular hexagon from circumradius</h3>
        <p>Given a regular hexagon (\\(n=6\\)) with circumradius \\(R=10\\,\\text{cm}\\). The side is \\(s = 2R\\sin(\\pi/n) = 2\\cdot10\\cdot\\sin(\\pi/6)=10\\,\\text{cm}\\). Then</p>
        <p class="formula-box">\\(P = n\\,s = 6\\cdot10 = 60\\,\\text{cm}.\\)</p>
      </article>

      <!-- e) FAQs -->
      <article class="bg-white p-6 rounded-lg shadow-md prose">
        <h2>Frequently asked questions</h2>
        <details>
          <summary>Does unit choice matter?</summary>
          <p>Use any single length unit. The result is expressed in the same unit as your inputs.</p>
        </details>
        <details>
          <summary>Can I check triangle validity?</summary>
          <p>Yes—this tool enforces the triangle inequality: each side must be less than the sum of the other two.</p>
        </details>
        <details>
          <summary>Can I compute from polygon circumradius?</summary>
          <p>Yes. Provide \\(n\\) and \\(R\\); the tool converts \\(R\\) to side length with \\(s=2R\\sin(\\pi/n)\\).</p>
        </details>
        <details>
          <summary>Is diameter accepted for circles?</summary>
          <p>Yes—enter either radius or diameter; the unused field can be left blank.</p>
        </details>
        <details>
          <summary>What about concave polygons?</summary>
          <p>This calculator covers <em>regular</em> polygons (all sides equal, convex). For arbitrary polygons, sum all edge lengths.</p>
        </details>
        <details>
          <summary>How precise is \\(\\pi\\)?</summary>
          <p>We use JavaScript’s <code>Math.PI</code>, which is double-precision floating point—sufficient for engineering use.</p>
        </details>
      </article>
    </section>

    <!-- 6) Authorship & review -->
    <section class="mt-8">
      <div class="bg-gray-50 border rounded-lg p-4 text-sm text-gray-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.</p>
        <p>Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
      </div>
    </section>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer by default at end of body) -->
  <script>
  (function () {
    // Utility: money not needed; use plain numbers with unit echo
    const byId = (id) => document.getElementById(id);

    // Dynamic field specs per shape
    const FIELD_TEMPLATES = {
      rectangle: [
        { id:"len", label:"Length (L)", step:"any", min:"0", required:true, help:"Longest side of the rectangle." },
        { id:"wid", label:"Width (W)", step:"any", min:"0", required:true, help:"Shorter side of the rectangle." }
      ],
      square: [
        { id:"s", label:"Side (s)", step:"any", min:"0", required:true, help:"Any side of the square; all sides are equal." }
      ],
      triangle: [
        { id:"a", label:"Side a", step:"any", min:"0", required:true, help:"First side length." },
        { id:"b", label:"Side b", step:"any", min:"0", required:true, help:"Second side length." },
        { id:"c", label:"Side c", step:"any", min:"0", required:true, help:"Third side length." }
      ],
      circle: [
        { id:"r", label:"Radius (r)", step:"any", min:"0", required:false, help:"Distance from center to boundary." },
        { id:"d", label:"Diameter (d)", step:"any", min:"0", required:false, help:"Distance across the circle. If provided, radius is ignored." }
      ],
      regularPolygon: [
        { id:"n", label:"Number of sides (n ≥ 3)", type:"number", step:"1", min:"3", required:true, help:"Integer number of sides for a regular polygon." },
        { id:"ps", label:"Side length (s)", step:"any", min:"0", required:false, help:"Length of one side. If omitted, use circumradius R instead." },
        { id:"R", label:"Circumradius (R)", step:"any", min:"0", required:false, help:"Center-to-vertex distance. Used if side length is empty." }
      ]
    };

    const shapeEl = byId("shape");
    const fieldsWrap = byId("fields");
    const perimeterOut = byId("perimeter-out");
    const formulaUsed = byId("formula-used");
    const notesEl = byId("result-notes");
    const calcBtn = byId("calc-btn");
    const resetBtn = byId("reset-btn");

    // Tooltip toggles
    document.querySelectorAll('[data-tooltip]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-tooltip');
        const panel = byId(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        panel.classList.toggle('hidden', expanded);
      });
    });

    function renderFields(shape) {
      fieldsWrap.innerHTML = "";
      const specs = FIELD_TEMPLATES[shape] || [];
      specs.forEach(spec => {
        const type = spec.type || "number";
        const fieldId = spec.id;
        const errId = fieldId + "-err";
        const helpId = fieldId + "-help";

        const wrapper = document.createElement("div");
        wrapper.innerHTML = `
          <label for="${fieldId}" class="block text-sm font-semibold text-gray-800 mb-1">
            ${spec.label} ${spec.required ? '<span aria-hidden="true" class="text-red-600">*</span>' : ''}
          </label>
          <div class="flex items-center gap-3">
            <input id="${fieldId}" name="${fieldId}" type="${type}"
              inputmode="decimal"
              class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none"
              ${spec.step ? `step="${spec.step}"` : ""}
              ${spec.min ? `min="${spec.min}"` : ""}
              ${spec.required ? `aria-required="true"` : ""}
              aria-describedby="${helpId} ${errId}"
            />
            <button type="button" class="touch-target px-3 py-2 rounded border"
                    aria-expanded="false" aria-controls="${helpId}" data-tooltip="${helpId}">?</button>
          </div>
          <p id="${helpId}" class="text-sm text-gray-600 mt-1 hidden">${spec.help}</p>
          <p id="${errId}" class="field-error text-sm mt-1 hidden"></p>
        `;
        fieldsWrap.appendChild(wrapper);
      });

      // attach blur validation
      specs.forEach(spec => {
        const input = byId(spec.id);
        input.addEventListener("blur", () => validateField(spec));
      });

      // connect tooltips for new fields
      fieldsWrap.querySelectorAll('[data-tooltip]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-tooltip');
          const panel = byId(id);
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          panel.classList.toggle('hidden', expanded);
        });
      });
    }

    function showError(id, msg) {
      const el = byId(id);
      if (!el) return;
      el.textContent = msg;
      el.classList.remove("hidden");
    }
    function clearError(id) {
      const el = byId(id);
      if (!el) return;
      el.textContent = "";
      el.classList.add("hidden");
    }

    function validateField(spec) {
      const input = byId(spec.id);
      const val = input.value.trim();
      const errId = spec.id + "-err";
      clearError(errId);

      if (spec.required && val === "") {
        showError(errId, "This field is required. Please enter a value greater than zero.");
        return false;
      }
      if (val !== "") {
        const num = Number(val);
        if (!isFinite(num) || num < 0) {
          showError(errId, "Please enter a valid non-negative number.");
          return false;
        }
        if (spec.id === "n" && (!Number.isInteger(num) || num < 3)) {
          showError(errId, "Number of sides must be an integer ≥ 3.");
          return false;
        }
      }
      return true;
    }

    function validateAll(shape) {
      let ok = true;
      const specs = FIELD_TEMPLATES[shape] || [];
      specs.forEach(spec => {
        if (!validateField(spec)) ok = false;
      });

      // additional shape-specific checks
      if (shape === "triangle") {
        const a = Number(byId("a").value || 0);
        const b = Number(byId("b").value || 0);
        const c = Number(byId("c").value || 0);
        const ae = "a-err", be = "b-err", ce = "c-err";
        [ae, be, ce].forEach(clearError);

        if (a <= 0 || b <= 0 || c <= 0) {
          const msg = "All three sides must be greater than zero.";
          showError(ae, msg); showError(be, msg); showError(ce, msg);
          ok = false;
        } else if (!(a + b > c && a + c > b && b + c > a)) {
          const msg = "Triangle inequality not satisfied: each side must be less than the sum of the other two.";
          showError(ae, msg); showError(be, msg); showError(ce, msg);
          ok = false;
        }
      }

      if (shape === "circle") {
        const r = byId("r").value.trim();
        const d = byId("d").value.trim();
        if (r === "" && d === "") {
          showError("r-err", "Enter radius or diameter.");
          showError("d-err", "Enter diameter or radius.");
          ok = false;
        }
      }

      if (shape === "regularPolygon") {
        const ps = byId("ps").value.trim();
        const R  = byId("R").value.trim();
        if (ps === "" && R === "") {
          showError("ps-err", "Provide side length or circumradius.");
          showError("R-err",  "Provide circumradius or side length.");
          ok = false;
        }
      }
      return ok;
    }

    function setResults(perimeter, formula, notes) {
      perimeterOut.textContent = (perimeter ?? perimeter === 0)
        ? String(perimeter)
        : "—";
      formulaUsed.innerHTML = formula || "";
      notesEl.innerHTML = "";
      (notes || []).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        notesEl.appendChild(li);
      });
      // Ask MathJax to typeset any new LaTeX
      if (window.MathJax && window.MathJax.typesetPromise) {
        MathJax.typesetPromise();
      }
    }

    function calculate() {
      const shape = shapeEl.value;
      if (!validateAll(shape)) {
        setResults(null, "", []);
        return;
      }

      let P = null;     // perimeter
      let formula = ""; // LaTeX snippet
      const notes = [];

      switch (shape) {
        case "rectangle": {
          const L = Number(byId("len").value);
          const W = Number(byId("wid").value);
          P = 2 * (L + W);
          formula = "\\(P = 2(L + W)\\)";
          break;
        }
        case "square": {
          const s = Number(byId("s").value);
          P = 4 * s;
          formula = "\\(P = 4s\\)";
          break;
        }
        case "triangle": {
          const a = Number(byId("a").value);
          const b = Number(byId("b").value);
          const c = Number(byId("c").value);
          P = a + b + c;
          formula = "\\(P = a + b + c\\)";
          break;
        }
        case "circle": {
          const rStr = byId("r").value.trim();
          const dStr = byId("d").value.trim();
          if (dStr !== "") {
            const d = Number(dStr);
            P = Math.PI * d;
            formula = "\\(P = \\pi d\\)";
            notes.push("Computed from diameter.");
          } else {
            const r = Number(rStr || "0");
            P = 2 * Math.PI * r;
            formula = "\\(P = 2\\pi r\\)";
            notes.push("Computed from radius.");
          }
          // Round to sensible precision
          P = +P.toFixed(6);
          break;
        }
        case "regularPolygon": {
          const n = Number(byId("n").value);
          const psStr = byId("ps").value.trim();
          const RStr  = byId("R").value.trim();
          let sVal;
          if (psStr !== "") {
            sVal = Number(psStr);
            notes.push("Used side length.");
          } else {
            const R = Number(RStr);
            sVal = 2 * R * Math.sin(Math.PI / n);
            notes.push("Converted circumradius to side: \\(s = 2R\\sin(\\pi/n)\\).");
          }
          P = n * sVal;
          formula = "\\(P = n\\,s\\)";
          P = +P.toFixed(6);
          break;
        }
      }
      setResults(P, formula, notes);
    }

    shapeEl.addEventListener("change", () => {
      renderFields(shapeEl.value);
      setResults(null, "", []);
    });
    byId("calc-btn").addEventListener("click", calculate);
    byId("reset-btn").addEventListener("click", () => {
      renderFields(shapeEl.value);
      setResults(null, "", []);
      // Clear all global errors
      ["shape-error"].forEach(clearError);
    });

    // Initial render
    renderFields(shapeEl.value);
  })();
  </script>
</body>
</html>
