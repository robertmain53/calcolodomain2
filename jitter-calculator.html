<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/jitter-calculator.html">





<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jitter Calculator — Convert Phase Noise to RMS/pp Jitter</title>
<meta name="description" content="Convert phase noise (dBc/Hz) to RMS jitter, peak-to-peak jitter, phase jitter, percent UI, and jitter-limited SNR. Enter carrier frequency and phase-noise points, choose integration limits, and get instant results.">
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root { --focus: #2563eb; }
  body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; }
  .prose { max-width: 72ch; }
  .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
  .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
  .formula-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius: .75rem; padding: 1rem; overflow:auto; }
  .result-card { background:#fff; border:1px solid #e5e7eb; border-radius: .75rem; padding: 1rem; }
  .result-card h4 { font-size:.9rem; color:#4b5563; margin-bottom:.25rem; }
  .result-card p { font-size:1.4rem; font-weight:800; color:#1d4ed8; }
  .btn { display:inline-flex; align-items:center; justify-content:center; padding:.75rem 1rem; border-radius:.75rem; border:1px solid #d1d5db; background:#fff; }
  .btn-primary { background:#1d4ed8; color:#fff; border-color:#1d4ed8; }
  .btn:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible, button:focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; }
  .input { width:100%; padding:.65rem .75rem; border:1px solid #cbd5e1; border-radius:.5rem; }
  label .req::after { content:" *"; color:#dc2626; }
  .err { color:#b91c1c; font-size:.85rem; margin-top:.25rem; }
  [aria-live="polite"] { min-height: 1.25rem; } /* keeps space for error text, prevents CLS */
  #results-card-wrap { min-height: 9rem; } /* results block height to avoid CLS */
  table { border-collapse: collapse; width: 100%; }
  th, td { padding:.6rem .5rem; border-bottom:1px solid #e5e7eb; text-align: right; }
  th:first-child, td:first-child, th:nth-child(2), td:nth-child(2) { text-align:left; }
  details > summary { cursor:pointer; font-weight:600; }
  /* Touch targets */
  button, .btn, input, select { min-height: 48px; }
  /* Print */
  @media print {
    body * { visibility: hidden; }
    #print-section, #print-section * { visibility: visible; }
    #print-section { position:absolute; left:0; top:0; width:100%; }
  }
</style>

<!-- JSON-LD: WebPage -->
<script type="application/ld+json">
{
 "@context": "https://schema.org",
 "@type": "WebPage",
 "name": "Jitter Calculator — Convert Phase Noise to RMS/pp Jitter",
 "description": "Engineering-grade jitter calculator that converts phase noise (dBc/Hz) to RMS jitter, peak-to-peak jitter, %UI, phase jitter, and jitter-limited SNR.",
 "url": "https://calcdomain.com/jitter-calculator.html",
 "inLanguage": "en",
 "author": { "@type": "Person", "name": "Ugo Candido" },
 "publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>

<!-- JSON-LD: Breadcrumbs -->
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Lifestyle & Everyday",
      "item": "https://calcdomain.com/lifestyle-everyday.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Miscellaneous",
      "item": "https://calcdomain.com/subcategories/miscellaneous.html"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Jitter Calculator",
      "item": "https://calcdomain.com/jitter-calculator.html"
    }
  ]
}</script>

<!-- JSON-LD: HowTo (high-level) -->
<script type="application/ld+json">
{
 "@context": "https://schema.org",
 "@type": "HowTo",
 "name": "How to Convert Phase Noise to RMS Jitter",
 "description": "Steps to compute RMS jitter from single-sideband phase noise data.",
 "step": [
   {"@type": "HowToStep", "name": "Enter Carrier", "text": "Provide the carrier/clock frequency f0 and choose units."},
   {"@type": "HowToStep", "name": "Phase-Noise Points", "text": "Enter offset frequency and L(f) in dBc/Hz; add rows as needed."},
   {"@type": "HowToStep", "name": "Integration Band", "text": "Set lower and upper integration limits (Hz)."},
   {"@type": "HowToStep", "name": "Compute", "text": "Calculator integrates Sφ(f)=2·10^{L/10} over [f1,f2] and returns σ_t = (1/(2π f0))·√∫Sφ(f)df."}
 ]
}
</script>


<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body class="bg-gray-50 text-gray-900">
<!-- Header (non-sticky as requested) -->
<header class="bg-white border-b">
  <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
    <a href="index.html" class="text-2xl font-extrabold text-blue-600">CalcDomain</a>
    <div class="hidden md:flex items-center gap-6 text-sm">
      <a href="search.html" class="hover:text-blue-700">Advanced Search</a>
      Categories
    </div>
  </nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-8">
  <div class="flex flex-col lg:flex-row gap-8">
    <!-- Main content -->
    <section class="w-full lg:w-2/3">
      <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
        <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
        <a href="lifestyle-everyday.html" class="hover:text-blue-700">Lifestyle &amp; Everyday</a> &raquo;
        <a href="subcategories/miscellaneous.html" class="hover:text-blue-700">Miscellaneous</a> &raquo;
        <span class="text-gray-900">Jitter Calculator</span>
      </nav>

      <div id="print-section" class="bg-white rounded-xl shadow-sm border p-6">
        <h1 class="text-3xl font-extrabold mb-2">Jitter Calculator</h1>
        <p class="text-gray-700 mb-6">
          Convert single-sideband phase noise <em>L(f)</em> (dBc/Hz) into time-domain jitter metrics.
          Engineering-grade results for RF/clock designers: RMS jitter, N-sigma peak-to-peak, phase jitter, %UI,
          and jitter-limited SNR.
        </p>

        <!-- Calculator UI -->
        <section aria-labelledby="calc-title" class="space-y-6" id="calculator-ui">
          <h2 id="calc-title" class="sr-only">Calculator Inputs</h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Carrier frequency -->
            <div>
              <label for="f0" class="block text-sm font-semibold text-gray-800"><span class="req">Carrier Frequency</span></label>
              <div class="flex gap-2">
                <input type="number" id="f0" class="input" inputmode="decimal" step="any" min="0" aria-required="true" aria-describedby="f0-help f0-err">
                <select id="f0Unit" class="input w-28 md:w-32" aria-label="Carrier frequency unit">
                  <option value="Hz">Hz</option>
                  <option value="kHz">kHz</option>
                  <option value="MHz" selected>MHz</option>
                  <option value="GHz">GHz</option>
                </select>
              </div>
              <div id="f0-help" class="text-sm text-gray-600 mt-1">Clock or carrier frequency \(f_0\).</div>
              <div id="f0-err" class="err" aria-live="polite"></div>
            </div>

            <!-- Data rate (for %UI) -->
            <div>
              <label for="rb" class="block text-sm font-semibold text-gray-800">Data Rate (for %UI)</label>
              <div class="flex gap-2">
                <input type="number" id="rb" class="input" inputmode="decimal" step="any" min="0" aria-describedby="rb-help rb-err">
                <select id="rbUnit" class="input w-28 md:w-32" aria-label="Data rate unit">
                  <option value="Hz">Hz</option>
                  <option value="kHz">kHz</option>
                  <option value="MHz">MHz</option>
                  <option value="Gbps" selected>Gbps</option>
                </select>
              </div>
              <div id="rb-help" class="text-sm text-gray-600 mt-1">Optional: for percent-UI calculation. UI = 1/R<sub>b</sub>.</div>
              <div id="rb-err" class="err" aria-live="polite"></div>
            </div>

            <!-- Sine frequency for SNR -->
            <div>
              <label for="fin" class="block text-sm font-semibold text-gray-800">Signal Frequency for SNR (optional)</label>
              <div class="flex gap-2">
                <input type="number" id="fin" class="input" inputmode="decimal" step="any" min="0" aria-describedby="fin-help fin-err">
                <select id="finUnit" class="input w-28 md:w-32" aria-label="Signal frequency unit">
                  <option value="Hz">Hz</option>
                  <option value="kHz">kHz</option>
                  <option value="MHz" selected>MHz</option>
                </select>
              </div>
              <div id="fin-help" class="text-sm text-gray-600 mt-1">For jitter-limited SNR: \( \mathrm{SNR_{jitter}} = -20\log_{10}(2\pi f_{\mathrm{in}} \sigma_t) \).</div>
              <div id="fin-err" class="err" aria-live="polite"></div>
            </div>

            <!-- N-sigma selection -->
            <div>
              <label for="nsigma" class="block text-sm font-semibold text-gray-800">Peak-to-Peak Multiplier</label>
              <div class="flex gap-2 items-center">
                <select id="nsigma" class="input" aria-describedby="nsigma-help">
                  <option value="6">6σ (≈ BER ~ 2×10⁻⁹)</option>
                  <option value="12.7">12.7σ (≈ BER ~ 10⁻⁹)</option>
                  <option value="14.1" selected>14.1σ (≈ BER ~ 10⁻¹²)</option>
                  <option value="15.9">15.9σ (≈ BER ~ 10⁻¹⁴)</option>
                </select>
                <button type="button" id="tipN" class="btn" aria-expanded="false" aria-controls="nsigma-tip" aria-label="Explain N-sigma">?</button>
              </div>
              <div id="nsigma-tip" class="text-sm text-gray-600 mt-1 hidden">For Gaussian random jitter, peak-to-peak ≈ N·σ<sub>t</sub>, where N depends on desired BER (tail probability). Values above are common industry heuristics.</div>
            </div>

            <!-- Integration limits -->
            <div>
              <label class="block text-sm font-semibold text-gray-800"><span class="req">Integration Band (Hz)</span></label>
              <div class="flex gap-2">
                <input type="number" id="f1" class="input" inputmode="decimal" step="any" min="0" placeholder="f1 (low)" aria-required="true" aria-describedby="band-help band-err">
                <input type="number" id="f2" class="input" inputmode="decimal" step="any" min="0" placeholder="f2 (high)" aria-required="true" aria-describedby="band-help band-err">
              </div>
              <div id="band-help" class="text-sm text-gray-600 mt-1">Calculator integrates \( S_\phi(f) = 2\cdot 10^{L(f)/10} \) over [f1, f2].</div>
              <div id="band-err" class="err" aria-live="polite"></div>
            </div>
          </div>

          <!-- Phase noise table -->
          <div aria-labelledby="pn-title" class="mt-2">
            <div class="flex items-center justify-between">
              <h3 id="pn-title" class="font-bold text-lg">Phase Noise Points</h3>
              <div class="flex gap-2">
                <button type="button" id="addRow" class="btn" aria-label="Add row">Add row</button>
                <button type="button" id="clearRows" class="btn" aria-label="Clear rows">Clear</button>
              </div>
            </div>
            <div class="overflow-x-auto border border-gray-200 rounded-lg mt-2" role="group" aria-label="Phase noise table">
              <table class="min-w-full text-sm">
                <thead class="bg-gray-100 text-gray-700 uppercase">
                  <tr>
                    <th class="text-left">#</th>
                    <th class="text-left">Offset (Hz)</th>
                    <th class="text-left">L(f) [dBc/Hz]</th>
                    <th class="text-left">Action</th>
                  </tr>
                </thead>
                <tbody id="pnBody"></tbody>
              </table>
            </div>
            <p class="text-sm text-gray-600 mt-2">Enter at least two points spanning the integration band; values are linearly interpolated in the log-frequency domain.</p>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap gap-3">
            <button type="button" id="btnCompute" class="btn-primary">Compute jitter</button>
            <button type="button" id="btnExample" class="btn">Load example</button>
            <button type="button" id="btnPrint" class="btn">Print results</button>
          </div>
        </section>

        <!-- Results -->
        <section aria-labelledby="results-title" class="mt-8">
          <h2 id="results-title" class="sr-only">Results</h2>
          <div id="results-card-wrap" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="result-card">
              <h4>RMS Jitter (σ<sub>t</sub>)</h4>
              <p id="jitRms">—</p>
              <div class="text-sm text-gray-600" id="jitRmsPs">—</div>
            </div>
            <div class="result-card">
              <h4>Peak-to-Peak (N·σ)</h4>
              <p id="jitPp">—</p>
              <div class="text-sm text-gray-600" id="jitPpPs">—</div>
            </div>
            <div class="result-card">
              <h4>Phase Jitter (σ<sub>φ</sub>)</h4>
              <p id="phiRms">—</p>
              <div class="text-sm text-gray-600">radians rms</div>
            </div>
            <div class="result-card">
              <h4>Percent UI</h4>
              <p id="percentUI">—</p>
              <div class="text-sm text-gray-600">Requires data rate</div>
            </div>
            <div class="result-card">
              <h4>Jitter-Limited SNR</h4>
              <p id="snrJit">—</p>
              <div class="text-sm text-gray-600">dB @ f<sub>in</sub></div>
            </div>
            <div class="result-card">
              <h4>Integration Status</h4>
              <p id="intStatus">—</p>
              <div class="text-sm text-gray-600">#points / band</div>
            </div>
          </div>
        </section>
      </div>

      <!-- Authoritative content -->
      <article class="bg-white rounded-xl shadow-sm border p-6 mt-8 prose">
        <section>
          <h2>Data Source &amp; Methodology</h2>
          <ul>
            <li><strong>IEEE Std 1139-2022</strong> — <em>Standard Definitions for Fundamental Frequency and Time Metrology—Random Instabilities</em>. Methods and quantities for phase/frequency instability and time-domain measures. <a href="https://antena.fe.uni-lj.si/literatura/Razno/VFtehnika/AndrejLavric/1139-2022.pdf" rel="nofollow">Standard access</a>.</li>
            <li><strong>Analog Devices MT-008</strong> — <em>Converting Oscillator Phase Noise to Time Jitter</em>, W. Kester. Derivation and practical integration guidance. <a href="https://www.analog.com/media/en/training-seminars/tutorials/MT-008.pdf" rel="nofollow">PDF</a>.</li>
            <li><strong>Analog Devices (article)</strong> — <em>Clock Jitter and Phase Noise Conversion</em>. <a href="https://www.analog.com/en/resources/technical-articles/clock-clk-jitter-and-phase-noise-conversion.html" rel="nofollow">Link</a>.</li>
            <li><strong>Skyworks AN279</strong> — <em>Estimating Period Jitter from Phase Noise</em>. <a href="https://www.skyworksinc.com/-/media/Skyworks/SL/documents/public/application-notes/AN279.pdf" rel="nofollow">PDF</a>.</li>
          </ul>
          <p><strong>All calculations strictly follow the formulas and data definitions provided by these sources.</strong></p>
        </section>

        <section>
          <h2>The Formula Explained</h2>
          <div class="formula-box">
            <p>Single-sideband phase noise \(L(f)\) [dBc/Hz] relates to phase-noise spectral density \(S_\phi(f)\) [rad\(^2\)/Hz] as:</p>
            <p>\[
              S_\phi(f) \;=\; 2 \cdot 10^{\,L(f)/10}
            \]</p>
            <p>The RMS time jitter is:</p>
            <p>\[
              \sigma_t \;=\; \frac{1}{2\pi f_0}\;\sqrt{ \int_{f_1}^{f_2} S_\phi(f)\, df }
              \;=\; \frac{1}{2\pi f_0}\;\sqrt{ \int_{f_1}^{f_2} 2\cdot 10^{L(f)/10} \, df } \;.
            \]</p>
            <p>Additional conversions:</p>
            <p>\[
              \sigma_\phi \;=\; 2\pi f_0 \,\sigma_t,\qquad
              \text{pp jitter} \approx N\,\sigma_t,\qquad
              \%UI = 100 \cdot \sigma_t \cdot R_b,
            \]</p>
            <p>For a sinusoid at \( f_{\text{in}} \):</p>
            <p>\[
              \mathrm{SNR_{jitter}} \,[\mathrm{dB}] \;=\; -20 \log_{10} \!\big( 2\pi f_{\text{in}} \sigma_t \big).
            \]</p>
          </div>
        </section>

        <section>
          <h2>Glossary of Variables</h2>
          <ul>
            <li>\(f_0\): carrier/clock frequency (Hz).</li>
            <li>\(L(f)\): single-sideband phase noise at offset \(f\) (dBc/Hz).</li>
            <li>\(S_\phi(f)\): phase-noise spectral density (rad\(^2\)/Hz), \(=2\cdot 10^{L/10}\).</li>
            <li>\([f_1,f_2]\): integration band (Hz).</li>
            <li>\(\sigma_t\): RMS time jitter (s).</li>
            <li>\(\sigma_\phi\): RMS phase jitter (radians).</li>
            <li>\(R_b\): data rate (Hz) for UI conversion.</li>
            <li>\(N\): sigma multiplier for peak-to-peak estimate (Gaussian RJ assumption).</li>
          </ul>
        </section>

        <section>
          <h2>How It Works: A Step-by-Step Example</h2>
          <p><strong>Given:</strong> \(f_0=100\;\mathrm{MHz}\); integrate from \(10^3\) to \(10^7\) Hz; phase-noise points: (1k, −90), (10k, −110), (100k, −130), (1M, −150), (10M, −160) dBc/Hz.</p>
          <ol>
            <li>Interpolate \(L(f)\) between points in the log-frequency domain; convert to \(S_\phi(f)=2\cdot10^{L/10}\).</li>
            <li>Numerically integrate \(S_\phi(f)\) over \([10^3,10^7]\) Hz (trapezoidal rule on linear \(f\)).</li>
            <li>Compute \(\sigma_t = \frac{1}{2\pi f_0}\sqrt{\int S_\phi(f) df}\).</li>
            <li>For \(N=14.1\), get peak-to-peak \(= N\sigma_t\). For \(R_b=10\;\mathrm{Gb/s}\), \(\%UI=100\,\sigma_t\,R_b\).</li>
            <li>At \(f_{\text{in}}=10\,\mathrm{MHz}\), compute \(\mathrm{SNR_{jitter}}\).</li>
          </ol>
          <p>The live calculator reproduces these steps precisely.</p>
        </section>

        <section>
          <h2>FAQ</h2>
          <details>
            <summary>Which integration limits should I pick?</summary>
            <p>It depends on your signal chain and any filtering. Common choices: from a few Hz or kHz up to a fraction of the carrier, the ADC Nyquist rate, or clock bandwidth. See IEEE 1139 and vendor notes for context.</p>
          </details>
          <details>
            <summary>Why is there a factor of 2 in \(S_\phi(f)=2\cdot10^{L/10}\)?</summary>
            <p>Because \(L(f)\) is single-sideband (SSB) phase noise. Converting to two-sided phase-noise spectral density in rad\(^2\)/Hz introduces the factor of two.</p>
          </details>
          <details>
            <summary>Is peak-to-peak jitter well-defined?</summary>
            <p>Not for unbounded Gaussian noise. Engineers quote a multiple of σ (e.g., 14.1σ for BER≈10⁻¹²). Use N-sigma appropriate for your target BER.</p>
          </details>
          <details>
            <summary>Does this include deterministic jitter (DJ)?</summary>
            <p>No—this integration computes random jitter from phase noise. Budget DJ separately (e.g., ISI, periodic interference) and combine as appropriate.</p>
          </details>
          <details>
            <summary>Can I input integrated phase noise directly?</summary>
            <p>Enter two points bounding your band and use a flat L(f) (or several flat segments) to approximate; future versions may add direct input for integrated values.</p>
          </details>
          <details>
            <summary>Why log-domain interpolation?</summary>
            <p>Phase-noise plots are usually on log-frequency with slopes in dB/decade; log-domain interpolation better matches typical spectra between measured offsets.</p>
          </details>
        </section>

        <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Technical content reviewed by CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-26">October 26, 2025</time></p>
        </div>
      </article>
    </section>

    <!-- Sidebar -->
    <aside class="w-full lg:w-1/3">
      <div class="sticky top-6 space-y-6">
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h3 class="font-bold text-lg mb-3">Why this calculator</h3>
          <ul class="text-sm text-gray-700 list-disc list-inside space-y-2">
            <li>Standards-aligned method (IEEE 1139; ADI MT-008).</li>
            <li>Inline validation and accessible UI (WCAG 2.1 AA).</li>
            <li>Outputs include %UI and jitter-limited SNR for quick SI checks.</li>
          </ul>
        </div>
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <h3 class="font-bold text-lg mb-4">Related tools</h3>
          <ul class="space-y-2 text-sm">
            <li>RMS ↔ Peak-to-Peak Jitter</li>
            <li>SNR from Jitter</li>
            <li>Phase Noise Plotter</li>
          </ul>
        </div>
      </div>
    </aside>
  </div>
</main>

<footer class="bg-white border-t">
  <div class="container mx-auto px-4 lg:px-6 py-8 text-center text-gray-600 text-sm">
    <p>&copy; 2025 CalcDomain. All rights reserved.</p>
    <div class="mt-3 space-x-4">
      <a href="about.html" class="hover:text-blue-700">About</a>
      <a href="contact.html" class="hover:text-blue-700">Contact</a>
      <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
      <a href="terms.html" class="hover:text-blue-700">Terms</a>
    </div>
  </div>
</footer>

<!-- JS (defer, end of body) -->
<script defer>
/* Utilities */
const $ = (id) => document.getElementById(id);
const nf = (v, d=3) => (isFinite(v) ? Number(v).toLocaleString(undefined, {maximumFractionDigits:d}) : "—");
const fmtSI = (x, unit="s") => {
  if (!isFinite(x) || x<=0) return "—";
  const abs = Math.abs(x);
  const tbl = [
    {k:1e-12, s:"ps"}, {k:1e-9, s:"ns"}, {k:1e-6, s:"µs"}, {k:1e-3, s:"ms"}
  ];
  for (const t of tbl) if (abs < t.k*1000) return (x/t.k).toLocaleString(undefined,{maximumFractionDigits:3}) + " " + t.s;
  return x.toLocaleString(undefined,{maximumFractionDigits:3}) + " " + unit;
};
const unitFactor = (u) => ({Hz:1, kHz:1e3, MHz:1e6, GHz:1e9, Gbps:1e9}[u] || 1);

/* Elements */
const el = {
  f0: $('f0'), f0Unit: $('f0Unit'),
  rb: $('rb'), rbUnit: $('rbUnit'),
  fin: $('fin'), finUnit: $('finUnit'),
  f1: $('f1'), f2: $('f2'),
  nsigma: $('nsigma'), tipN: $('tipN'),
  pnBody: $('pnBody'), addRow: $('addRow'), clearRows: $('clearRows'),
  btnCompute: $('btnCompute'), btnExample: $('btnExample'), btnPrint: $('btnPrint'),
  // errors
  f0Err: $('f0-err'), rbErr: $('rb-err'), finErr: $('fin-err'), bandErr: $('band-err'),
  // results
  jitRms: $('jitRms'), jitRmsPs: $('jitRmsPs'), jitPp: $('jitPp'), jitPpPs: $('jitPpPs'),
  phiRms: $('phiRms'), percentUI: $('percentUI'), snrJit: $('snrJit'), intStatus: $('intStatus'),
  nsigmaTip: $('nsigma-tip')
};

/* Accessible tooltip toggle */
el.tipN.addEventListener('click', () => {
  const open = el.nsigmaTip.classList.toggle('hidden');
  el.tipN.setAttribute('aria-expanded', String(!open));
});

/* Phase-noise table helpers */
function addPnRow(offsetHz="", Ldbc="") {
  const idx = el.pnBody.children.length + 1;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${idx}</td>
    <td><input type="number" class="input" inputmode="decimal" step="any" min="0" aria-label="Offset frequency (Hz)" value="${offsetHz}"></td>
    <td><input type="number" class="input" inputmode="decimal" step="any" aria-label="L(f) dBc/Hz" value="${Ldbc}"></td>
    <td><button type="button" class="btn" aria-label="Remove row">Remove</button></td>
  `;
  tr.querySelector('button').addEventListener('click', () => { tr.remove(); renumber(); });
  el.pnBody.appendChild(tr);
}
function renumber() {
  [...el.pnBody.children].forEach((tr, i) => tr.children[0].textContent = i+1);
}

/* Validation on blur (inline, specific, ARIA-described) */
function setErr(elErr, msg) { elErr.textContent = msg || ""; }
function validate() {
  let ok = true;
  const f0 = Number(el.f0.value) * unitFactor(el.f0Unit.value);
  if (!(f0>0)) { setErr(el.f0Err, "Enter a positive carrier frequency."); ok=false; } else setErr(el.f0Err,"");

  const f1 = Number(el.f1.value), f2 = Number(el.f2.value);
  if (!(f1>0 && f2>0 && f2>f1)) { setErr(el.bandErr, "Set valid integration limits: f1 > 0 and f2 > f1."); ok=false; } else setErr(el.bandErr,"");

  const rb = Number(el.rb.value) * unitFactor(el.rbUnit.value);
  if (el.rb.value && !(rb>0)) { setErr(el.rbErr, "Enter a positive data rate or leave empty."); ok=false; } else setErr(el.rbErr,"");

  const fin = Number(el.fin.value) * unitFactor(el.finUnit.value);
  if (el.fin.value && !(fin>0)) { setErr(el.finErr, "Enter a positive sine frequency or leave empty."); ok=false; } else setErr(el.finErr,"");

  // Need ≥2 PN points spanning band
  const rows = getPnRowsSorted();
  if (rows.length < 2) { ok=false; setErr(el.bandErr, "Add at least two phase-noise points covering your band."); }
  else {
    const minOff = rows[0].f, maxOff = rows[rows.length-1].f;
    if (!(f1 >= minOff && f2 <= maxOff)) {
      setErr(el.bandErr, `Integration band must lie within entered offsets [${minOff} .. ${maxOff}] Hz.`);
      ok=false;
    }
  }
  return ok;
}
['f0','f1','f2','rb','fin'].forEach(id => $(id).addEventListener('blur', validate));

/* Read PN rows (sorted by offset) */
function getPnRowsSorted() {
  const arr = [];
  [...el.pnBody.querySelectorAll('tr')].forEach(tr => {
    const f = Number(tr.children[1].querySelector('input').value);
    const L = Number(tr.children[2].querySelector('input').value);
    if (isFinite(f) && isFinite(L) && f>0) arr.push({f, L});
  });
  arr.sort((a,b)=>a.f-b.f);
  return arr;
}

/* Log-domain interpolation of L(f) between known points */
function Linterp(f, rows) {
  // find segment
  for (let i=0;i<rows.length-1;i++){
    const a=rows[i], b=rows[i+1];
    if (f>=a.f && f<=b.f) {
      const lx = Math.log10(f), lxa = Math.log10(a.f), lxb = Math.log10(b.f);
      const t = (lx - lxa) / (lxb - lxa);
      return a.L + t*(b.L - a.L);
    }
  }
  return null;
}

/* Numeric integration (trapezoid on linear f of Sphi(f)) */
function integrateSphi(f1, f2, rows) {
  // choose ~N samples per decade for stability
  const decades = Math.log10(f2) - Math.log10(f1);
  const N = Math.max(200, Math.floor(decades*400)); // dense sampling
  const fl = new Float64Array(N+1);
  const df = (f2 - f1) / N;
  for (let i=0;i<=N;i++) fl[i] = f1 + i*df;

  let acc = 0;
  for (let i=0;i<N;i++){
    const fA = fl[i], fB = fl[i+1];
    const LA = Linterp(fA, rows), LB = Linterp(fB, rows);
    if (LA===null || LB===null) return {ok:false, area:NaN};
    const SA = 2 * Math.pow(10, LA/10);
    const SB = 2 * Math.pow(10, LB/10);
    acc += 0.5 * (SA + SB) * (fB - fA);
  }
  return {ok:true, area:acc};
}

/* Main compute */
function compute() {
  if (!validate()) { status("Validation needed"); return; }

  const f0 = Number(el.f0.value) * unitFactor(el.f0Unit.value);
  const rb = el.rb.value ? Number(el.rb.value) * unitFactor(el.rbUnit.value) : NaN;
  const fin = el.fin.value ? Number(el.fin.value) * unitFactor(el.finUnit.value) : NaN;
  const f1 = Number(el.f1.value), f2 = Number(el.f2.value);
  const ns = Number(el.nsigma.value);
  const rows = getPnRowsSorted();

  const integ = integrateSphi(f1, f2, rows);
  if (!integ.ok) { status("Integration error"); return; }
  const area = integ.area; // ∫ Sphi df  [rad^2]
  const sigma_t = (1/(2*Math.PI*f0)) * Math.sqrt(area); // seconds
  const sigma_phi = 2*Math.PI*f0*sigma_t; // radians
  const pp = ns * sigma_t;

  // Outputs
  el.jitRms.textContent = nf(sigma_t, 6) + " s";
  el.jitRmsPs.textContent = fmtSI(sigma_t);
  el.jitPp.textContent = nf(pp, 6) + " s";
  el.jitPpPs.textContent = fmtSI(pp);
  el.phiRms.textContent = nf(sigma_phi, 4);

  if (isFinite(rb)) {
    const pui = 100 * sigma_t * rb;
    el.percentUI.textContent = nf(pui, 4) + " %";
  } else { el.percentUI.textContent = "—"; }

  if (isFinite(fin)) {
    const snr = -20*Math.log10(2*Math.PI*fin*sigma_t);
    el.snrJit.textContent = isFinite(snr) ? nf(snr, 2) + " dB" : "—";
  } else { el.snrJit.textContent = "—"; }

  el.intStatus.textContent = `${rows.length} pts; [${nf(f1,0)}..${nf(f2,0)}] Hz`;
  status("OK");
}

/* Status helper */
function status(msg){ /* reserved for future UI */ }

/* Example dataset */
function loadExample() {
  el.f0.value = 100; el.f0Unit.value = 'MHz';
  el.f1.value = 1e3; el.f2.value = 1e7;
  el.rb.value = 10; el.rbUnit.value = 'Gbps';
  el.fin.value = 10; el.finUnit.value = 'MHz';
  // Rows
  el.pnBody.innerHTML = "";
  [
    [1e3, -90],
    [1e4, -110],
    [1e5, -130],
    [1e6, -150],
    [1e7, -160]
  ].forEach(([f,L]) => addPnRow(f, L));
  compute();
}

/* Events */
el.addRow.addEventListener('click', ()=>addPnRow("", ""));
el.clearRows.addEventListener('click', ()=>{ el.pnBody.innerHTML=""; });
el.btnCompute.addEventListener('click', compute);
el.btnExample.addEventListener('click', loadExample);
el.btnPrint.addEventListener('click', ()=>window.print());

/* Init with a minimal set of rows to guide users */
addPnRow(1e3, -90);
addPnRow(1e4, -110);
addPnRow(1e5, -130);
addPnRow(1e6, -150);
addPnRow(1e7, -160);

</script>
</body>
</html>
