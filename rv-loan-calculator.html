<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RV Loan Calculator — Payment, Total Interest & Amortization</title>
  <meta name="description" content="Estimate RV loan payments with taxes, fees, trade-in, and extra principal. See total interest, payoff date, and full amortization schedule.">
  <link rel="canonical" href="https://calcdomain.com/rv-loan-calculator.html" />

  <!-- Icons/Manifest -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind (utility-first, mobile-first) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --focus: #2563eb; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol"; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.15rem; font-weight: 600; margin-top: 1.2rem; margin-bottom: .5rem; }
    .prose p, .prose li { line-height: 1.65; }
    .result-card { background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;text-align:center }
    .result-card h4 { font-size:.9rem;color:#4b5563;margin-bottom:.25rem }
    .result-card p { font-size:1.5rem;font-weight:800;color:#1d4ed8 }
    .kbd-focus:focus { outline: 3px solid var(--focus); outline-offset: 2px; }
    .tooltip-panel[hidden] { display: none; }
    [aria-invalid="true"] { border-color: #dc2626 !important; }
    .error-msg { color:#b91c1c; font-size:.85rem; margin-top:.375rem }
    /* Prevent CLS when results update */
    #results { min-height: 17rem; }
    @media (prefers-reduced-motion: no-preference) {
      .fade-in { animation: fade .25s ease-out; }
      @keyframes fade { from {opacity:.001} to {opacity:1} }
    }
    /* Print cleanly (hide chart) */
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; left:0; top:0; width:100%; }
      #chartWrap { display: none !important; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"RV Loan Calculator",
    "url":"https://calcdomain.com/rv-loan-calculator.html",
    "description":"Estimate RV loan payments with taxes, fees, trade-in, and extra principal. See total interest, payoff date, and full amortization schedule.",
    "inLanguage":"en",
    "dateModified":"2025-10-30",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Finance","item":"https://calcdomain.com/finance.html"},
      {"@type":"ListItem","position":3,"name":"Loans & Debt","item":"https://calcdomain.com/subcategories/finance-loans-debt.html"},
      {"@type":"ListItem","position":4,"name":"RV Loan Calculator","item":"https://calcdomain.com/rv-loan-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to estimate your RV loan payment",
    "description":"Step-by-step process to compute RV payments with taxes, fees, trade-in, and extra principal.",
    "step":[
      {"@type":"HowToStep","name":"Enter RV price and down payment","text":"Input purchase price, down payment, and trade-in details."},
      {"@type":"HowToStep","name":"Include taxes & fees","text":"Add your state/local sales tax rate and any doc/title fees."},
      {"@type":"HowToStep","name":"Set APR and term","text":"Enter the Annual Percentage Rate and term in months."},
      {"@type":"HowToStep","name":"(Optional) Add extra principal","text":"See how extra monthly principal accelerates payoff and reduces interest."},
      {"@type":"HowToStep","name":"Review amortization","text":"View payment, total interest, payoff date, and download the schedule."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Do RV loans include sales tax?","acceptedAnswer":{"@type":"Answer","text":"Many lenders finance sales tax and certain fees into the loan. Use the tax and fees fields to estimate a financed total."}},
      {"@type":"Question","name":"What are typical RV loan terms?","acceptedAnswer":{"@type":"Answer","text":"Common terms range from 60 to 180 months, with some lenders offering up to 240 months on larger balances, subject to credit and RV age."}},
      {"@type":"Question","name":"Is the APR the same as the interest rate?","acceptedAnswer":{"@type":"Answer","text":"APR reflects the cost of credit on a yearly basis and can include certain fees, per CFPB and Regulation Z."}},
      {"@type":"Question","name":"Can I pay biweekly or weekly?","acceptedAnswer":{"@type":"Answer","text":"Yes. This tool supports monthly, biweekly, and weekly schedules to illustrate interest and payoff timing."}},
      {"@type":"Question","name":"Will extra principal help?","acceptedAnswer":{"@type":"Answer","text":"Yes. Extra principal reduces the balance faster, lowering total interest and shortening the payoff time."}},
      {"@type":"Question","name":"Can I estimate trade-in and payoff?","acceptedAnswer":{"@type":"Answer","text":"Enter trade-in value and any outstanding payoff. The calculator nets these to reduce the financed amount."}}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky, simple) -->
  <header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-700 kbd-focus">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700 kbd-focus" href="search.html">Search</a>
        <a class="hover:text-blue-700 kbd-focus" href="finance.html">Finance</a>
        <a class="hover:text-blue-700 kbd-focus" href="subcategories/finance-loans-debt.html">Loans &amp; Debt</a>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Main content -->
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-700">Finance</a> &raquo;
          <a href="subcategories/finance-loans-debt.html" class="hover:text-blue-700">Loans &amp; Debt</a> &raquo;
          <span class="text-gray-900">RV Loan Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-xl shadow">
          <h1 class="text-3xl font-extrabold mb-2">RV Loan Calculator</h1>
          <p class="text-gray-700 mb-6">Estimate payments for motorhomes, trailers, and campers. Factor in taxes, fees, trade-in, payoff, and extra principal. Ideal for realistic “out-the-door” budgeting and lender comparisons.</p>

          <!-- Calculator UI -->
          <section id="calculator-ui" class="space-y-6" aria-labelledby="calcHeading">
            <h2 id="calcHeading" class="sr-only">Calculator inputs</h2>

            <!-- Price & credits -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="price" class="block text-sm font-medium text-gray-800">Purchase Price (RV) <span aria-hidden="true" class="text-red-600">*</span></label>
                <div class="flex items-center gap-2">
                  <input id="price" name="price" type="number" inputmode="decimal" min="0" step="100"
                         class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                         aria-required="true" aria-describedby="priceTip priceErr" value="65000">
                  <button type="button" class="px-2 py-1 border rounded-md kbd-focus"
                          aria-expanded="false" aria-controls="priceTip">?</button>
                </div>
                <p id="priceTip" class="tooltip-panel text-sm text-gray-600 mt-1" hidden>Sticker or agreed purchase price before down payment and after dealer discounts.</p>
                <p id="priceErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="down" class="block text-sm font-medium text-gray-800">Down Payment</label>
                <input id="down" type="number" inputmode="decimal" min="0" step="100"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-describedby="downTip downErr" value="10000">
                <p id="downTip" class="text-sm text-gray-600 mt-1">Cash you’ll pay upfront. Not taxed.</p>
                <p id="downErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="trade" class="block text-sm font-medium text-gray-800">Trade-in Value</label>
                <input id="trade" type="number" inputmode="decimal" min="0" step="100"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-describedby="tradeTip tradeErr" value="0">
                <p id="tradeTip" class="text-sm text-gray-600 mt-1">Dealer credit for your current RV/vehicle (may reduce taxable amount in many states).</p>
                <p id="tradeErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="payoff" class="block text-sm font-medium text-gray-800">Trade-in Payoff (if owed)</label>
                <input id="payoff" type="number" inputmode="decimal" min="0" step="100"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-describedby="payoffTip payoffErr" value="0">
                <p id="payoffTip" class="text-sm text-gray-600 mt-1">Outstanding balance on your trade-in. This increases the amount you finance.</p>
                <p id="payoffErr" class="error-msg" aria-live="polite"></p>
              </div>
            </div>

            <!-- Taxes & fees -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label for="taxRate" class="block text-sm font-medium text-gray-800">Sales Tax Rate (%)</label>
                <div class="flex items-center gap-2">
                  <input id="taxRate" type="number" inputmode="decimal" min="0" step="0.01"
                         class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                         aria-describedby="taxTip taxErr" value="7.00">
                  <button type="button" class="px-2 py-1 border rounded-md kbd-focus" aria-expanded="false" aria-controls="taxTip">?</button>
                </div>
                <p id="taxTip" class="tooltip-panel text-sm text-gray-600 mt-1" hidden>Enter your combined state + local tax on RV purchases. Many states tax (price − trade-in).</p>
                <p id="taxErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="fees" class="block text-sm font-medium text-gray-800">Doc/Title/Other Fees</label>
                <input id="fees" type="number" inputmode="decimal" min="0" step="10"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-describedby="feesTip feesErr" value="600">
                <p id="feesTip" class="text-sm text-gray-600 mt-1">Dealer and DMV fees that may be financed.</p>
                <p id="feesErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="ins" class="block text-sm font-medium text-gray-800">Optional Add-ons (warranties, etc.)</label>
                <input id="ins" type="number" inputmode="decimal" min="0" step="10"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-describedby="insTip insErr" value="0">
                <p id="insTip" class="text-sm text-gray-600 mt-1">Any additional financed products.</p>
                <p id="insErr" class="error-msg" aria-live="polite"></p>
              </div>
            </div>

            <!-- Rate/term/frequency -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label for="apr" class="block text-sm font-medium text-gray-800">APR (%) <span aria-hidden="true" class="text-red-600">*</span></label>
                <div class="flex items-center gap-2">
                  <input id="apr" type="number" inputmode="decimal" min="0" step="0.01"
                         class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                         aria-required="true" aria-describedby="aprTip aprErr" value="7.99">
                  <button type="button" class="px-2 py-1 border rounded-md kbd-focus" aria-expanded="false" aria-controls="aprTip">?</button>
                </div>
                <p id="aprTip" class="tooltip-panel text-sm text-gray-600 mt-1" hidden>APR is the yearly cost of credit, potentially including some fees (Reg Z/CFPB). It differs from note rate when fees are financed.</p>
                <p id="aprErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="term" class="block text-sm font-medium text-gray-800">Term (months) <span aria-hidden="true" class="text-red-600">*</span></label>
                <input id="term" type="number" inputmode="numeric" min="12" max="240" step="1"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-required="true" aria-describedby="termErr" value="144">
                <p id="termErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="freq" class="block text-sm font-medium text-gray-800">Payment Frequency</label>
                <select id="freq" class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus" aria-describedby="freqTip">
                  <option value="monthly" selected>Monthly</option>
                  <option value="biweekly">Biweekly</option>
                  <option value="weekly">Weekly</option>
                </select>
                <p id="freqTip" class="text-sm text-gray-600 mt-1">Changing the schedule shifts the number of payments per year.</p>
              </div>
            </div>

            <!-- Extras -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label for="extra" class="block text-sm font-medium text-gray-800">Extra Principal / mo</label>
                <input id="extra" type="number" inputmode="decimal" min="0" step="10"
                       class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus"
                       aria-describedby="extraTip extraErr" value="0">
                <p id="extraTip" class="text-sm text-gray-600 mt-1">Added to each payment; reduces interest and payoff time.</p>
                <p id="extraErr" class="error-msg" aria-live="polite"></p>
              </div>

              <div>
                <label for="start" class="block text-sm font-medium text-gray-800">First Payment Month</label>
                <input id="start" type="month" class="mt-1 w-full px-3 py-2 border rounded-md kbd-focus" aria-describedby="startTip">
                <p id="startTip" class="text-sm text-gray-600 mt-1">Used to label the schedule timeline.</p>
              </div>

              <div class="flex items-end">
                <button id="resetBtn" type="button" class="w-full py-3 border rounded-md font-semibold kbd-focus">Reset</button>
              </div>
            </div>
          </section>

          <!-- Results -->
          <section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-xl p-6">
            <div class="flex flex-col md:flex-row gap-6">
              <div class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="result-card">
                  <h4>Payment per Period</h4>
                  <p id="pmt">$0.00</p>
                </div>
                <div class="result-card">
                  <h4>Total Interest</h4>
                  <p id="intTotal">$0.00</p>
                </div>
                <div class="result-card">
                  <h4>Total Cost</h4>
                  <p id="totalCost">$0.00</p>
                </div>
                <div class="result-card">
                  <h4>Payoff Date</h4>
                  <p id="payoffDate">—</p>
                </div>
              </div>
              <div id="chartWrap" class="w-full md:w-1/3">
                <canvas id="breakdownChart" aria-label="Principal vs interest breakdown doughnut chart"></canvas>
              </div>
            </div>

            <div class="mt-4 text-sm text-gray-700">
              <p><strong>Financed Amount:</strong> <span id="financed">$0.00</span> &middot; <strong>Tax:</strong> <span id="taxOut">$0.00</span> &middot; <strong>Fees/Add-ons:</strong> <span id="feesOut">$0.00</span></p>
            </div>

            <div class="mt-6 flex flex-col sm:flex-row gap-3">
              <button id="toggleSchedule" class="px-4 py-3 rounded-md bg-white border kbd-focus w-full sm:w-auto" aria-expanded="false" aria-controls="scheduleWrap">View Payment Schedule</button>
              <button id="downloadCsv" class="px-4 py-3 rounded-md bg-white border kbd-focus w-full sm:w-auto">Download CSV</button>
              <button id="printBtn" class="px-4 py-3 rounded-md bg-white border kbd-focus w-full sm:w-auto">Print</button>
              <button id="shareBtn" class="px-4 py-3 rounded-md bg-white border kbd-focus w-full sm:w-auto">Copy Shareable Link</button>
            </div>

            <details id="scheduleWrap" class="mt-4 bg-white rounded-lg border" open>
              <summary class="px-4 py-3 font-semibold cursor-pointer">Payment Schedule</summary>
              <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-right">
                  <thead class="bg-gray-100 text-gray-700 uppercase">
                    <tr>
                      <th class="px-4 py-2 text-left">#</th>
                      <th class="px-4 py-2 text-left">Date</th>
                      <th class="px-4 py-2">Payment</th>
                      <th class="px-4 py-2">Interest</th>
                      <th class="px-4 py-2">Principal</th>
                      <th class="px-4 py-2">Balance</th>
                    </tr>
                  </thead>
                  <tbody id="schedBody"></tbody>
                </table>
              </div>
            </details>
          </section>
        </div>

        <!-- Authoritative Content -->
        <article class="bg-white p-6 rounded-xl shadow mt-8 prose">
          <h2>Authoritative data source & methodology</h2>
          <p><strong>Primary reference:</strong> Consumer Financial Protection Bureau (CFPB) &amp; Regulation Z (Truth in Lending Act). See <a class="text-blue-700 underline" href="https://www.consumerfinance.gov/rules-policy/regulations/1026/22">§1026.22 APR determination</a> and <a class="text-blue-700 underline" href="https://www.consumerfinance.gov/consumer-tools/auto-loans/answers/key-terms/">Auto loan key terms</a>. “Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.”</p>
          <p>We compute payments with the standard amortization formula using APR as the nominal annual rate, adjusted to your payment frequency (monthly/biweekly/weekly). Taxes are estimated as <em>taxable base × tax rate</em>; in many states, trade-in value reduces the taxable base. Fees and add-ons are assumed financed unless you adjust down payment.</p>

          <h2>The formula explained</h2>
          <div class="formula-box">
            For an amortizing loan with periodic rate \( i \) and number of payments \( n \):<br/>
            \[
              \text{Payment} = P \cdot \frac{i}{1-(1+i)^{-n}}
            \]
            where \( P \) is the financed principal (price − down − trade\_in + payoff + tax + fees + add\text{-}ons).<br/>
            Periodic rate \( i = \frac{\text{APR}}{m} \), with \( m \) payments per year (12, 26, or 52).
          </div>

          <h2>Glossary of inputs & outputs</h2>
          <ul>
            <li><strong>Purchase Price</strong>: Agreed RV price before tax; discounts applied.</li>
            <li><strong>Down Payment</strong>: Cash paid upfront; lowers amount financed.</li>
            <li><strong>Trade-in Value / Payoff</strong>: Dealer credit and any loan you still owe; payoff increases amount financed.</li>
            <li><strong>Sales Tax Rate</strong>: Combined rate; taxable base often equals (price − trade-in).</li>
            <li><strong>Fees/Add-ons</strong>: Doc/title and optional products financed.</li>
            <li><strong>APR</strong>: Yearly cost of credit (Reg Z); used to derive periodic rate.</li>
            <li><strong>Term</strong>: Number of months to repay.</li>
            <li><strong>Payment</strong>: Amount due each period; principal + interest.</li>
            <li><strong>Total Interest / Total Cost</strong>: Sum of interest across the term; total of payments.</li>
          </ul>

          <h2>How it works: a step-by-step example</h2>
          <p><em>Example:</em> Price \$65,000; down \$10,000; trade-in \$8,000 with \$3,000 payoff; tax 7%; fees \$600; APR 7.99%; term 144 months; monthly payments; extra principal \$50/month.</p>
          <ol>
            <li>Taxable base = \$65,000 − \$8,000 = \$57,000; tax = \$3,990.</li>
            <li>Financed principal \( P = 65,000 - 10,000 - 8,000 + 3,000 + 3,990 + 600 = \$54,590 \).</li>
            <li>Periodic rate \( i = 0.0799 / 12 \); \( n = 144 \). Apply the amortization formula to get the monthly payment.</li>
            <li>Apply extra principal each month; schedule shows earlier payoff and reduced interest.</li>
          </ol>

          <h2>FAQs</h2>
          <details><summary>What terms are common for RV loans?</summary><p>Many lenders offer 60–180 months; some extend to 240 months for larger balances. Longer terms lower the payment but raise total interest.</p></details>
          <details><summary>Does trade-in reduce sales tax?</summary><p>Frequently yes, but this is state-specific. This tool models tax on (price − trade-in) by default.</p></details>
          <details><summary>APR vs interest rate?</summary><p>APR is the yearly cost of credit and can include certain fees; it is the standardized measure for comparisons (Reg Z).</p></details>
          <details><summary>Can I finance fees and add-ons?</summary><p>Often yes; we include them in the financed amount so you see their impact on payment and interest.</p></details>
          <details><summary>Biweekly payments?</summary><p>26 payments/year at half the monthly payment accelerates payoff and can cut interest if your lender applies payments as received.</p></details>
          <details><summary>Finding fair RV values?</summary><p>Consult J.D. Power (formerly NADA) or RV Trader for market context before negotiating.</p></details>

          <div class="mt-6 p-4 bg-gray-50 border rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
              Last accuracy review: <time datetime="2025-10-30">October 30, 2025</time></p>
          </div>
        </article>
      </section>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="lg:sticky lg:top-20 space-y-6">
          <div class="bg-gray-200 h-72 rounded-xl flex items-center justify-center text-gray-600">Ad Placement (300×600)</div>
          <div class="bg-white p-6 rounded-xl shadow">
            <h3 class="font-bold text-lg mb-3">Why this beats typical RV calculators</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Models trade-in, payoff, taxes, fees, and add-ons (many tools omit 1–3 of these).</li>
              <li>Biweekly/weekly options + extra principal to visualize payoff acceleration.</li>
              <li>Downloadable amortization CSV for proposals and audits.</li>
              <li>Clear LaTeX formulas, sources (CFPB/Reg Z) and accessible UI.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-xl shadow">
            <h3 class="font-bold text-lg mb-3">Related tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-700 hover:underline" href="loan-amortization.html">Loan Amortization Schedule</a></li>
              <li><a class="text-blue-700 hover:underline" href="apr.html">APR Calculator</a></li>
              <li><a class="text-blue-700 hover:underline" href="loan-prepayment.html">Loan Prepayment Planner</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="max-w-7xl mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Scripts (deferred, placed before </body> for CWV) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer>
  // MathJax (LaTeX rendering)
  window.MathJax = { tex: { inlineMath: [['\\(','\\)'],['$','$']] }, svg: {fontCache:'global'} };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <script defer>
  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const el = (id) => document.getElementById(id);
    const inputs = {
      price: el('price'), down: el('down'), trade: el('trade'), payoff: el('payoff'),
      taxRate: el('taxRate'), fees: el('fees'), ins: el('ins'),
      apr: el('apr'), term: el('term'), freq: el('freq'),
      extra: el('extra'), start: el('start')
    };
    const outs = {
      pmt: el('pmt'), intTotal: el('intTotal'), totalCost: el('totalCost'),
      payoffDate: el('payoffDate'), financed: el('financed'), taxOut: el('taxOut'), feesOut: el('feesOut'),
      schedBody: el('schedBody')
    };
    const buttons = {
      reset: el('resetBtn'), toggleSchedule: el('toggleSchedule'),
      dl: el('downloadCsv'), print: el('printBtn'), share: el('shareBtn')
    };

    // Tooltip toggles (accessible)
    document.querySelectorAll('button[aria-controls]').forEach(btn => {
      btn.addEventListener('click', () => {
        const panel = el(btn.getAttribute('aria-controls'));
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        panel.hidden = expanded;
      });
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') { const panel = el(btn.getAttribute('aria-controls')); btn.setAttribute('aria-expanded','false'); panel.hidden = true; }
      });
    });

    let chart;
    const cur = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' });
    const num = new Intl.NumberFormat();

    function periodsPerYear(freq) { return freq === 'weekly' ? 52 : (freq === 'biweekly' ? 26 : 12); }
    function clamp(v, min=0) { return isFinite(v) ? Math.max(min, v) : 0; }

    // Inline validation on blur
    function setError(id, msg, invalid) {
      const input = inputs[id];
      const err = el(id + 'Err');
      if (!err) return;
      err.textContent = msg || '';
      input.setAttribute('aria-invalid', invalid ? 'true' : 'false');
    }
    function validateField(id, rules) {
      const v = parseFloat(inputs[id].value || '0');
      if (rules.required && !(v > 0)) return setError(id, 'Please enter a value greater than 0.', true);
      if (rules.min != null && v < rules.min) return setError(id, `Value must be ≥ ${rules.min}.`, true);
      if (rules.max != null && v > rules.max) return setError(id, `Value must be ≤ ${rules.max}.`, true);
      setError(id, '', false);
    }
    const blurRules = {
      price: {required:true, min:0.01},
      apr: {required:true, min:0},
      term: {required:true, min:1, max:240},
      taxRate: {min:0, max:25},
      down: {min:0}, trade:{min:0}, payoff:{min:0}, fees:{min:0}, ins:{min:0}, extra:{min:0}
    };
    Object.keys(blurRules).forEach(id => inputs[id].addEventListener('blur', () => validateField(id, blurRules[id])));

    // Shareable URL params
    function readParams() {
      const p = new URLSearchParams(location.search);
      Object.keys(inputs).forEach(k => {
        if (p.has(k)) inputs[k].value = p.get(k);
      });
    }
    function copyShareLink() {
      const p = new URLSearchParams();
      Object.keys(inputs).forEach(k => p.set(k, inputs[k].value || ''));
      const url = `${location.origin}${location.pathname}?${p.toString()}`;
      navigator.clipboard.writeText(url).then(() => {
        buttons.share.textContent = 'Link Copied ✓';
        setTimeout(()=>buttons.share.textContent='Copy Shareable Link', 2000);
      });
    }

    function computeFinanced() {
      const price = clamp(parseFloat(inputs.price.value));
      const down = clamp(parseFloat(inputs.down.value));
      const trade = clamp(parseFloat(inputs.trade.value));
      const payoff = clamp(parseFloat(inputs.payoff.value));
      const taxRate = clamp(parseFloat(inputs.taxRate.value)) / 100;
      const fees = clamp(parseFloat(inputs.fees.value));
      const addOns = clamp(parseFloat(inputs.ins.value));

      // taxable base commonly = price - trade
      const taxableBase = Math.max(0, price - trade);
      const tax = taxableBase * taxRate;

      // financed principal
      const principal = Math.max(0, price - down - trade + payoff + tax + fees + addOns);

      return { price, down, trade, payoff, tax, fees: fees + addOns, principal };
    }

    function pmt(periodicRate, n, principal) {
      if (periodicRate === 0) return principal / n;
      const x = Math.pow(1 + periodicRate, -n);
      return principal * (periodicRate / (1 - x));
    }

    function buildSchedule(P, apr, freq, termMonths, extraMonthly, startMonthStr) {
      const m = periodsPerYear(freq);
      const n = Math.round(termMonths * (m/12));
      const i = apr / 100 / m;

      // Payment-per-period is based on periodicity (if biweekly/weekly).
      let basePayment = pmt(i, n, P);
      // Extra principal is specified per month; convert to per period equivalent.
      const extraPerPeriod = (extraMonthly || 0) * (12 / m);

      const schedule = [];
      let bal = P;

      const start = startMonthStr ? new Date(startMonthStr + '-01') : new Date();
      const stepDays = Math.round(365 / m);

      let totalInterest = 0;
      for (let k = 1; k <= n && bal > 0.005; k++) {
        const interest = i * bal;
        let principalPay = basePayment - interest + extraPerPeriod;

        if (principalPay > bal) { // last payment adjustment
          principalPay = bal;
        }
        const pay = principalPay + interest;

        bal = Math.max(0, bal - principalPay);

        const dt = new Date(start);
        dt.setDate(start.getDate() + k * stepDays);

        schedule.push({
          k, date: dt, payment: pay, interest, principal: principalPay, balance: bal
        });
        totalInterest += interest;
      }
      return { schedule, totalInterest, periods: schedule.length, paymentPerPeriod: schedule.length ? schedule[0].payment - schedule[0].interest - extraPerPeriod + schedule[0].interest : basePayment, periodicRate:i };
    }

    function render() {
      // Validate key required fields gently
      validateField('price', blurRules.price);
      validateField('apr', blurRules.apr);
      validateField('term', blurRules.term);

      const freq = inputs.freq.value;
      const termMonths = clamp(parseFloat(inputs.term.value), 1);
      const extraMonthly = clamp(parseFloat(inputs.extra.value), 0);

      const f = computeFinanced();
      const { schedule, totalInterest, periods, paymentPerPeriod } =
        buildSchedule(f.principal, clamp(parseFloat(inputs.apr.value)), freq, termMonths, extraMonthly, inputs.start.value);

      // Outputs
      const totalPaid = schedule.reduce((s, r) => s + r.payment, 0);
      const payoffDt = schedule.length ? schedule[schedule.length - 1].date : null;

      outs.pmt.textContent = cur.format(schedule.length ? schedule[0].payment : 0);
      outs.intTotal.textContent = cur.format(totalInterest || 0);
      outs.totalCost.textContent = cur.format(totalPaid || 0);
      outs.financed.textContent = cur.format(f.principal);
      outs.taxOut.textContent = cur.format(f.tax);
      outs.feesOut.textContent = cur.format(f.fees);

      outs.schedBody.innerHTML = '';
      const df = new Intl.DateTimeFormat(undefined, { year:'numeric', month:'short' });
      schedule.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-2 text-left">${r.k}</td>
          <td class="px-4 py-2 text-left">${df.format(r.date)}</td>
          <td class="px-4 py-2">${cur.format(r.payment)}</td>
          <td class="px-4 py-2">${cur.format(r.interest)}</td>
          <td class="px-4 py-2">${cur.format(r.principal)}</td>
          <td class="px-4 py-2">${cur.format(r.balance)}</td>
        `;
        outs.schedBody.appendChild(tr);
      });

      outs.payoffDate.textContent = payoffDt ? df.format(payoffDt) : '—';

      // Chart
      const principalPortion = Math.max(0, f.principal);
      const interestPortion = Math.max(0, totalInterest);
      const ctx = document.getElementById('breakdownChart');
      if (ctx) {
        const data = { labels:['Principal','Interest'], datasets:[{ data:[principalPortion, interestPortion] }] };
        if (chart) { chart.data = data; chart.update(); }
        else {
          chart = new Chart(ctx, {
            type:'doughnut',
            data,
            options:{ plugins:{ legend:{ position:'bottom' } }, responsive:true, maintainAspectRatio:false }
          });
        }
      }
    }

    // CSV export
    function downloadCsv() {
      const rows = [['#','Date','Payment','Interest','Principal','Balance']];
      outs.schedBody.querySelectorAll('tr').forEach(tr => {
        const cells = Array.from(tr.children).map(td => td.textContent.replace(/[,]/g,''));
        rows.push(cells);
      });
      const blob = new Blob([rows.map(r => r.join(',')).join('\n')], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'rv-loan-schedule.csv';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // Controls
    Object.values(inputs).forEach(i => i.addEventListener('input', render));
    buttons.reset.addEventListener('click', () => { Object.values(inputs).forEach(i => i.value = i.defaultValue || ''); render(); });
    buttons.dl.addEventListener('click', downloadCsv);
    buttons.print.addEventListener('click', () => window.print());
    buttons.share.addEventListener('click', copyShareLink);

    const details = document.getElementById('scheduleWrap');
    buttons.toggleSchedule.addEventListener('click', () => {
      const open = details.hasAttribute('open');
      if (open) details.removeAttribute('open'); else details.setAttribute('open','');
      buttons.toggleSchedule.setAttribute('aria-expanded', String(!open));
      buttons.toggleSchedule.textContent = open ? 'View Payment Schedule' : 'Hide Payment Schedule';
    });

    // Init
    readParams();
    render();
  });
  </script>
</body>
</html>
