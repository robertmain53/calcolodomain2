<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/normal-line-calculator.html">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Normal Line Calculator — Math & Geometry</title>
<meta name="description" content="Compute the normal line to a curve y=f(x) at a given x₀. Get tangent slope, normal slope, and the line equation in point–slope, slope–intercept, and standard form with a quick plot.">

<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="manifest" href="/site.webmanifest">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.js" defer></script>
<script>
  // Tailwind tweak: enforce visible custom focus ring for A11y
  tailwind.config = {
    theme: {
      extend: {
        colors: { brand: { DEFAULT: '#2563eb' } }
      }
    }
  }
</script>
<style>
  :root { --focus: #2563eb; }
  body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  .prose { max-width: 68ch; }
  .focus-ring:focus { outline: 3px solid var(--focus); outline-offset: 2px; }
  .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:.5rem; padding:1rem; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
  .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; }
  .result-card h4 { font-size:.95rem; color:#4b5563; }
  .result-card p { font-weight:700; font-size:1.15rem; color:#111827; word-break: break-word; }
  /* Prevent CLS when results render */
  #results { min-height: 320px; }
  /* Print */
  @media print {
    header, nav[aria-label="Breadcrumb"], aside, .no-print { display:none !important; }
    main { padding:0 !important; }
    #print-section { position: static !important; box-shadow: none !important; }
  }
  /* Tooltip panel visibility (for SR and keyboard) */
  .tip[aria-hidden="true"] { display:none; }
  .tip[aria-hidden="false"] { display:block; }
</style>

<!-- Core structured data -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebPage",
  "name":"Normal Line Calculator",
  "description":"Find the normal line to a curve y=f(x) at x0. Returns tangent slope, normal slope, and line equation in multiple forms with a quick plot and worked example.",
  "url":"https://calcdomain.com/normal-line-calculator.html",
  "inLanguage":"en",
  "author":{"@type":"Person","name":"Ugo Candido"},
  "publisher":{"@type":"Organization","name":"CalcDomain"}
}
</script>
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Math & Conversions",
      "item": "https://calcdomain.com/math-conversions.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Geometry",
      "item": "https://calcdomain.com/subcategories/geometry.html"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Normal Line Calculator",
      "item": "https://calcdomain.com/normal-line-calculator.html"
    }
  ]
}</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"SoftwareApplication",
  "name":"Normal Line Calculator",
  "applicationCategory":"EducationalApplication",
  "operatingSystem":"Web",
  "creator":{"@type":"Person","name":"Ugo Candido"},
  "featureList":[
    "Symbolic derivative with math.js",
    "Tangent & normal slope",
    "Multiple equation forms",
    "Accessible on-blur validation",
    "Quick plot of curve, tangent, and normal"
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"HowTo",
  "name":"How to find the normal line to y=f(x) at x0",
  "step":[
    {"@type":"HowToStep","name":"Enter the function","text":"Type y=f(x) using standard syntax, e.g., x^3-2x or sin(x)."},
    {"@type":"HowToStep","name":"Set the point of tangency","text":"Provide x0. The calculator evaluates y0=f(x0)."},
    {"@type":"HowToStep","name":"Compute the derivative","text":"The tool computes f'(x0)."},
    {"@type":"HowToStep","name":"Build the normal line","text":"Slope m_n = -1/m_t unless m_t=0 (then normal is horizontal? actually vertical)."},
    {"@type":"HowToStep","name":"Read the line forms","text":"Results include point–slope, slope–intercept, and standard form, plus a plot."}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {"@type":"Question","name":"What is a normal line?","acceptedAnswer":{"@type":"Answer","text":"A normal line to a curve at a point is the line perpendicular to the tangent line at that point."}},
    {"@type":"Question","name":"How do you compute the normal slope?","acceptedAnswer":{"@type":"Answer","text":"If the tangent slope is m_t, the normal slope is m_n = -1/m_t, provided m_t is not 0 or undefined. If m_t=0, the normal is vertical (x=x0). If the tangent is vertical, the normal is horizontal (y=y0)."}},
    {"@type":"Question","name":"Can I use trig and exponentials?","acceptedAnswer":{"@type":"Answer","text":"Yes. Use sin(x), cos(x), tan(x), exp(x), ln(x), and powers like x^2."}},
    {"@type":"Question","name":"What if the derivative does not exist at x0?","acceptedAnswer":{"@type":"Answer","text":"The tangent may be undefined (cusp/vertical tangent). The tool detects this and reports the appropriate normal (horizontal if tangent vertical) or warns if no unique normal exists."}},
    {"@type":"Question","name":"Does it support implicit curves?","acceptedAnswer":{"@type":"Answer","text":"This version focuses on explicit y=f(x). For implicit F(x,y)=0 you can often solve for y near the point and use this tool; a dedicated implicit version is planned."}},
    {"@type":"Question","name":"How accurate is the derivative?","acceptedAnswer":{"@type":"Answer","text":"Derivatives are computed symbolically via math.js when possible, with numeric fallback for robustness."}}
  ]
}
</script>
<!-- MathJax for LaTeX rendering -->
<script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky as requested) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-600 focus-ring">CalcDomain</a>
      <div class="hidden md:block w-full max-w-md mx-6">
        <label class="sr-only" for="site-search">Search</label>
        <input id="site-search" type="search" placeholder="Search calculators…" class="w-full px-4 py-2 border rounded-full focus-ring" />
      </div>
      <div class="hidden md:flex gap-6 text-sm">
        <a href="search.html" class="hover:text-blue-600 focus-ring">Advanced Search</a>
        Categories
      </div>
      <button class="md:hidden p-2 focus-ring" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600 focus-ring">Home</a> &raquo;
          <a href="math.html" class="hover:text-blue-600 focus-ring">Math</a> &raquo;
          <a href="subcategories/geometry.html" class="hover:text-blue-600 focus-ring">Geometry</a> &raquo;
          <span class="text-gray-900">Normal Line Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-lg shadow">
          <h1 class="text-3xl font-extrabold mb-2">normal line calculator</h1>
          <p class="text-gray-700 mb-6">Enter a function \(y=f(x)\) and a point \(x_0\). The tool computes the tangent slope \(m_t=f'(x_0)\), the normal slope \(m_n=-1/m_t\) (with vertical/horizontal edge cases handled), and the normal line equation in multiple forms—plus a quick plot.</p>

          <!-- Calculator (Section 3) -->
          <section aria-labelledby="calc-heading" class="space-y-6">
            <h2 id="calc-heading" class="text-xl font-bold">Calculator</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Function input -->
              <div>
                <label for="fn" class="block text-sm font-semibold text-gray-800">Function f(x) <span aria-hidden="true" class="text-red-600">*</span></label>
                <div class="flex items-start gap-2">
                  <input id="fn" aria-required="true" aria-describedby="fn-help fn-err" type="text" inputmode="text" placeholder="e.g., x^3 - 2x + sin(x)" class="mt-1 w-full px-3 py-2 border rounded-md focus-ring" value="x^3 - 2x">
                  <button type="button" class="no-print mt-1 px-3 py-2 border rounded-md focus-ring" aria-expanded="false" aria-controls="fn-help" id="fn-tip-btn" title="What can I type?" aria-label="Show help for function syntax">?</button>
                </div>
                <p id="fn-help" class="tip text-sm text-gray-600 mt-2" aria-hidden="true">
                  Use <code>^</code> for powers (e.g., <code>x^2</code>), <code>sin(x)</code>, <code>cos(x)</code>, <code>tan(x)</code>, <code>exp(x)</code>, <code>ln(x)</code>. Multiplication: <code>2*x</code>.
                </p>
                <p id="fn-err" class="text-sm text-red-700 mt-2" role="alert"></p>
              </div>

              <!-- x0 input -->
              <div>
                <label for="x0" class="block text-sm font-semibold text-gray-800">Point of tangency \(x_0\) <span aria-hidden="true" class="text-red-600">*</span></label>
                <input id="x0" aria-required="true" aria-describedby="x0-err" type="number" step="any" class="mt-1 w-full px-3 py-2 border rounded-md focus-ring" value="1">
                <p id="x0-err" class="text-sm text-red-700 mt-2" role="alert"></p>
              </div>

              <!-- y0 display (computed) -->
              <div>
                <label for="y0" class="block text-sm font-semibold text-gray-800">Computed \(y_0=f(x_0)\)</label>
                <input id="y0" type="text" class="mt-1 w-full px-3 py-2 border rounded-md bg-gray-100" readonly value="—">
              </div>

              <!-- Precision -->
              <div>
                <label for="precision" class="block text-sm font-semibold text-gray-800">Decimal precision</label>
                <input id="precision" type="number" min="0" max="12" step="1" class="mt-1 w-full px-3 py-2 border rounded-md focus-ring" value="6" aria-describedby="prec-help">
                <p id="prec-help" class="text-sm text-gray-600 mt-2">Controls rounding in results and plot labels.</p>
              </div>
            </div>

            <div class="flex flex-wrap gap-3">
              <button id="calcBtn" class="px-4 py-3 bg-blue-600 text-white rounded-lg focus-ring" type="button">Compute normal line</button>
              <button id="resetBtn" class="px-4 py-3 border rounded-lg focus-ring" type="button">Reset</button>
              <button id="printBtn" class="px-4 py-3 border rounded-lg focus-ring no-print" type="button">Print</button>
            </div>
          </section>

          <!-- Results (Section 4) -->
          <section aria-labelledby="results-heading" id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6" aria-live="polite">
            <h2 id="results-heading" class="text-xl font-bold mb-4">Results</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
              <div class="result-card">
                <h4>Tangent slope \(m_t\)</h4>
                <p id="mt">—</p>
              </div>
              <div class="result-card">
                <h4>Normal slope \(m_n\)</h4>
                <p id="mn">—</p>
              </div>
              <div class="result-card">
                <h4>Point \((x_0,y_0)\)</h4>
                <p id="pt">—</p>
              </div>
            </div>

            <div class="mt-6 grid grid-cols-1 gap-3">
              <div class="result-card">
                <h4>Point–slope form</h4>
                <p id="eqPointSlope" class="break-words">—</p>
              </div>
              <div class="result-card">
                <h4>Slope–intercept form</h4>
                <p id="eqSlopeIntercept" class="break-words">—</p>
              </div>
              <div class="result-card">
                <h4>Standard form</h4>
                <p id="eqStandard" class="break-words">—</p>
              </div>
            </div>

            <div class="mt-6">
              <div class="h-64" id="plot-wrap">
                <canvas id="plot" aria-label="Plot of function, tangent and normal at x0"></canvas>
              </div>
            </div>
          </section>
        </div>

        <!-- Authoritative content ecosystem -->
        <article class="bg-white p-6 rounded-lg shadow mt-8 prose">
          <h2>Data source &amp; methodology</h2>
          <p><strong>Authoritative source:</strong> OpenStax, <em>Calculus Volume 1</em>, Section on Tangent Lines and Derivatives (latest edition). Available free under CC BY 4.0. 
            <a href="https://openstax.org/details/books/calculus-volume-1" rel="noopener">Direct link</a>. <br>
            <em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em>
          </p>

          <h2>The formula explained</h2>
          <div class="formula-box">
            For a differentiable function \(y=f(x)\) at \(x_0\):<br><br>
            Tangent slope: \(m_t = f'(x_0)\).<br>
            Normal slope (if \(m_t \neq 0\) and finite): \(m_n = -\dfrac{1}{m_t}\).<br><br>
            Point–slope form of the normal line through \((x_0,y_0)\):<br>
            \[
              y - y_0 = m_n\,(x - x_0), \qquad y_0 = f(x_0).
            \]<br>
            Edge cases:<br>
            If \(m_t = 0\) (horizontal tangent), the normal is vertical: \(x = x_0\).<br>
            If the tangent is vertical (undefined \(m_t\)), the normal is horizontal: \(y = y_0\).
          </div>

          <h2>Glossary of variables</h2>
          <ul>
            <li>\(f(x)\): the input function.</li>
            <li>\(x_0\): point of tangency on the x-axis.</li>
            <li>\(y_0=f(x_0)\): function value at \(x_0\).</li>
            <li>\(f'(x_0)\): derivative at \(x_0\) (tangent slope).</li>
            <li>\(m_t\): tangent slope; \(m_n\): normal slope.</li>
          </ul>

          <h2>How it works: a step-by-step example</h2>
          <p>Let \(f(x)=x^3-2x\) and \(x_0=1\). Then \(f'(x)=3x^2-2\), so \(f'(1)=1\), hence \(m_t=1\) and \(m_n=-1\). Also \(y_0=f(1)=1-2=-1\). The normal line is:</p>
          <div class="formula-box">
            Point–slope: \(\;y+1=-1\,(x-1)\;<br>\)
            Slope–intercept: \(\;y=-x+0\;<br>\)
            Standard: \(\;x+y=0\).
          </div>

          <h2>FAQs</h2>
          <details>
            <summary>What inputs are required?</summary>
            <p>A function \(f(x)\) and a numeric value for \(x_0\). The tool evaluates \(y_0=f(x_0)\) automatically.</p>
          </details>
          <details>
            <summary>How are derivatives computed?</summary>
            <p>Symbolically via math.js where possible; if symbolic differentiation fails, a high-accuracy numerical fallback is used.</p>
          </details>
          <details>
            <summary>What about non-differentiable points?</summary>
            <p>If \(f'(x_0)\) does not exist or is infinite, the calculator reports vertical tangent and uses a horizontal normal \(y=y_0\), if appropriate.</p>
          </details>
          <details>
            <summary>Can I copy the equation?</summary>
            <p>Yes—select any equation text and copy; line breaks are added only for readability.</p>
          </details>
          <details>
            <summary>Units?</summary>
            <p>Purely mathematical; no units are imposed.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
            Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
          </div>
        </article>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-lg mb-3">Why this tool stands out</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Accessible UI (WCAG 2.1 AA): labels, focus, keyboard tips.</li>
              <li>Edge-case handling: vertical/horizontal tangents.</li>
              <li>Multiple equation forms + quick plot.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-lg mb-3">Related math tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-600 hover:underline" href="tangent-line-calculator.html">Tangent Line Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="derivative.html">Derivative Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="slope.html">Slope Calculator</a></li>
            </ul>
          </div>
          <div class="bg-gray-200 rounded-lg h-64 flex items-center justify-center text-gray-600">Ad Placement (300×600)</div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600 focus-ring">About</a>
        <a href="contact.html" class="hover:text-blue-600 focus-ring">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600 focus-ring">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600 focus-ring">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Logic (defer loaded libs live above) -->
  <script defer>
  (function(){
    'use strict';

    // Elements
    const E = (id)=>document.getElementById(id);
    const fnInput = E('fn');
    const x0Input = E('x0');
    const y0Field = E('y0');
    const precInput = E('precision');
    const mtEl = E('mt'), mnEl = E('mn'), ptEl = E('pt');
    const eqPS = E('eqPointSlope'), eqSI = E('eqSlopeIntercept'), eqStd = E('eqStandard');
    const plotCanvas = E('plot');
    const calcBtn = E('calcBtn'), resetBtn = E('resetBtn'), printBtn = E('printBtn');
    const fnErr = E('fn-err'), x0Err = E('x0-err');
    const tipBtn = E('fn-tip-btn'), tipPanel = E('fn-help');

    let chart;

    // Tooltip toggle (accessible)
    tipBtn?.addEventListener('click', ()=>{
      const expanded = tipBtn.getAttribute('aria-expanded') === 'true';
      tipBtn.setAttribute('aria-expanded', String(!expanded));
      tipPanel.setAttribute('aria-hidden', String(expanded));
    });

    // Validation helpers
    function setError(el, errEl, msg){
      errEl.textContent = msg || '';
      if(msg){
        el.setAttribute('aria-invalid','true');
      } else {
        el.removeAttribute('aria-invalid');
      }
    }

    fnInput.addEventListener('blur', validateFn);
    x0Input.addEventListener('blur', validateX0);

    function validateFn(){
      const v = fnInput.value.trim();
      if(!v){
        setError(fnInput, fnErr, 'Please enter a function f(x). Example: x^3 - 2x + sin(x)');
        return false;
      }
      try{
        // Parse to ensure it’s valid
        math.parse(v);
        setError(fnInput, fnErr, '');
        return true;
      }catch(e){
        setError(fnInput, fnErr, 'Invalid function syntax. Check operators, parentheses, and use * for multiplication.');
        return false;
      }
    }

    function validateX0(){
      const v = x0Input.value;
      if(v === '' || isNaN(Number(v))){
        setError(x0Input, x0Err, 'Please enter a numeric value for x₀.');
        return false;
      }
      setError(x0Input, x0Err, '');
      return true;
    }

    // Compute derivative at x0: try symbolic, fallback to numeric
    function derivativeAt(fstr, x0){
      try{
        const x = math.parse('x');
        const f = math.parse(fstr);
        const df = math.derivative(f, x);
        const compiled = df.compile();
        const mt = compiled.evaluate({x:x0});
        if (!isFinite(mt)) throw new Error('non-finite');
        return { mt, method:'symbolic' };
      } catch(_e){
        // Numeric central difference
        const h = 1e-6 * (1 + Math.abs(x0));
        const f = math.compile(fstr);
        const y1 = f.evaluate({x:x0 + h});
        const y2 = f.evaluate({x:x0 - h});
        const mt = (y1 - y2) / (2*h);
        return { mt, method:'numeric' };
      }
    }

    function fmt(n, p){
      if (n === null || n === undefined) return '—';
      if (!isFinite(n)) return (n>0?'∞':'-∞');
      return Number(n).toFixed(p);
    }

    function simplifyStandard(A,B,C,prec){
      // Scale to integers if close; otherwise keep decimals
      const scale = 10 ** Math.min(prec, 6);
      const Ai = Math.round(A*scale), Bi = Math.round(B*scale), Ci = Math.round(C*scale);
      if (Math.abs(Ai/scale - A)<1e-9 && Math.abs(Bi/scale - B)<1e-9 && Math.abs(Ci/scale - C)<1e-9){
        // Normalize sign
        let g = (v)=>Math.abs(v);
        const sign = (Ai<0|| (Ai===0 && Bi<0)) ? -1: 1;
        return `${sign*Ai}x + ${sign*Bi}y + ${sign*Ci} = 0`;
      }
      // decimal fallback
      const sA = (A>=0?'':'-') + Math.abs(A).toFixed(prec);
      const sB = (B>=0?' + ':' - ') + Math.abs(B).toFixed(prec);
      const sC = (C>=0?' + ':' - ') + Math.abs(C).toFixed(prec);
      return `${sA.replace('--','-')}x${sB}y${sC} = 0`;
    }

    function compute(){
      if (!validateFn() | !validateX0()) return;

      const fstr = fnInput.value.trim();
      const x0 = Number(x0Input.value);
      const prec = Math.max(0, Math.min(12, Number(precInput.value) || 6));

      let y0, mt, mn, note = '';
      try {
        const f = math.compile(fstr);
        y0 = f.evaluate({x:x0});
        if (!isFinite(y0)) throw new Error('Non-finite y0');
        y0Field.value = fmt(y0, prec);

        // Derivative
        const d = derivativeAt(fstr, x0);
        mt = d.mt;

        // Handle vertical tangent (|mt| huge or non-finite)
        const VERT_EPS = 1e12;
        let verticalTangent = !isFinite(mt) || Math.abs(mt) > VERT_EPS;

        // Edge cases
        if (verticalTangent){
          mn = 0; // normal horizontal
          note = 'Vertical tangent detected. Normal is horizontal: y = y0.';
        } else if (Math.abs(mt) < 1e-12){
          mn = Infinity; // normal vertical
          note = 'Horizontal tangent detected. Normal is vertical: x = x0.';
        } else {
          mn = -1/mt;
        }

        // Present results
        mtEl.textContent = verticalTangent ? '∞ (vertical tangent)' : fmt(mt, prec);
        mnEl.textContent = (mn===Infinity) ? '∞ (vertical normal)' : (mn===-Infinity ? '-∞' : fmt(mn, prec));
        ptEl.textContent = `(${fmt(x0, prec)}, ${fmt(y0, prec)})`;

        // Equations
        let eqPointSlope, eqSlopeInt, eqStandard;

        if (mn===Infinity){
          // Normal vertical: x = x0
          eqPointSlope = `x = ${fmt(x0, prec)}`;
          eqSlopeInt  = `x = ${fmt(x0, prec)}`;
          eqStandard  = `1·x + 0·y + ${fmt(-x0, prec)} = 0`;
        } else if (Math.abs(mn) < 1e-12){
          // Normal horizontal: y = y0
          eqPointSlope = `y = ${fmt(y0, prec)}`;
          eqSlopeInt  = `y = ${fmt(y0, prec)}`;
          eqStandard  = `0·x + 1·y + ${fmt(-y0, prec)} = 0`;
        } else {
          // General
          const b = y0 - mn*x0;
          eqPointSlope = `y - ${fmt(y0, prec)} = ${fmt(mn, prec)} (x - ${fmt(x0, prec)})`;
          eqSlopeInt   = `y = ${fmt(mn, prec)} x + ${fmt(b, prec)}`;
          // Standard: Ax + By + C = 0  =>  mx - y + b = 0
          const A = mn, B = -1, C = b;
          eqStandard = simplifyStandard(A,B,C,prec);
        }

        eqPS.textContent = eqPointSlope;
        eqSI.textContent = eqSlopeInt;
        eqStd.textContent = eqStandard;

        drawPlot(fstr, x0, y0, mt, mn);

        if (note){
          // Append a small advisory
          const advisory = document.createElement('p');
          advisory.className = 'text-sm text-gray-700 mt-2';
          advisory.textContent = note;
          eqStd.parentElement.appendChild(advisory);
        }

        // Re-render MathJax (for inline headings/labels), safely ignored if not needed
        if (window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();

      } catch (err){
        setError(fnInput, fnErr, 'Could not evaluate f(x) at x₀. Check domain (e.g., sqrt of negative) and syntax.');
      }
    }

    function drawPlot(fstr, x0, y0, mt, mn){
      // Build data series for f(x), tangent, and normal
      const f = math.compile(fstr);

      // Domain around x0
      const span = 5;
      const N = 200;
      const xs = [];
      const ys = [];
      const left = x0 - span;
      const right = x0 + span;

      for (let i=0;i<=N;i++){
        const x = left + (right-left)*i/N;
        let y = NaN;
        try { y = f.evaluate({x}); } catch(_){}
        xs.push(x);
        ys.push(y);
      }

      // Tangent line (if finite mt)
      const tan = [];
      if (isFinite(mt)){
        for (let i=0;i<=N;i++){
          const x = left + (right-left)*i/N;
          tan.push({x, y: y0 + mt*(x - x0)});
        }
      }

      // Normal line (if not vertical∞)
      const nor = [];
      if (mn===Infinity){
        // Vertical line x=x0: sample y around y0
        for (let i=0;i<=N;i++){
          const y = (y0 - span) + (2*span)*i/N;
          nor.push({x: x0, y});
        }
      } else {
        for (let i=0;i<=N;i++){
          const x = left + (right-left)*i/N;
          nor.push({x, y: y0 + mn*(x - x0)});
        }
      }

      const funcData = xs.map((x,i)=>({x, y: ys[i]})).filter(p=>isFinite(p.y));

      const ds = [
        {label:'f(x)', data: funcData, borderWidth:2, showLine:true, parsing:false, pointRadius:0},
        {label:'Tangent', data: tan, borderWidth:2, borderDash:[6,4], showLine:true, parsing:false, pointRadius:0},
        {label:'Normal', data: nor, borderWidth:2, borderDash:[2,2], showLine:true, parsing:false, pointRadius:0}
      ];

      const cfg = {
        type: 'scatter',
        data: { datasets: ds },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          animation:false,
          scales:{
            x:{ type:'linear', title:{display:true, text:'x'} },
            y:{ type:'linear', title:{display:true, text:'y'} }
          },
          plugins:{ legend:{ position:'bottom' } }
        }
      };

      if (chart){ chart.destroy(); }
      chart = new Chart(plotCanvas, cfg);
    }

    // Buttons
    calcBtn.addEventListener('click', compute);
    resetBtn.addEventListener('click', ()=>{
      fnInput.value = 'x^3 - 2x';
      x0Input.value = '1';
      precInput.value = '6';
      setError(fnInput, fnErr, ''); setError(x0Input, x0Err, '');
      E('mt').textContent = '—';
      E('mn').textContent = '—';
      E('pt').textContent = '—';
      E('eqPointSlope').textContent = '—';
      E('eqSlopeIntercept').textContent = '—';
      E('eqStandard').textContent = '—';
      y0Field.value = '—';
      if (chart){ chart.destroy(); chart = null; }
    });
    printBtn.addEventListener('click', ()=>window.print());

    // Initial compute for demo defaults
    window.addEventListener('load', compute);
  })();
  </script>
</body>
</html>
