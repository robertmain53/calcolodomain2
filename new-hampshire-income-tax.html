<!DOCTYPE html>
<html lang="en"><head> 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
<meta charset="utf-8">
<title>New Hampshire State Income Tax Calculator</title>
<meta content="Accurately calculate New Hampshire state income tax for interest and dividends by year. Understand NH’s 2025 repeal, exemptions, and effective rates with an accessible, mobile-first tool." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="Ugo Candido" name="author">
<link href="https://calcdomain.com/new-hampshire-income-tax.html" rel="canonical">
<meta content="index,follow,max-image-preview:large" name="robots">
<meta content="New Hampshire State Income Tax Calculator" property="og:title">
<meta content="Instant, accessible New Hampshire income tax calculator focused on interest &amp; dividends. Updated for the 2025 repeal, with transparent formulas and methodology." property="og:description">
<meta content="website" property="og:type">
<meta content="https://calcdomain.com/taxation/us/new-hampshire-income-tax-calculator" property="og:url">
<meta content="CalcDomain" property="og:site_name">
<meta content="summary_large_image" name="twitter:card">
<meta content="#005A9C" name="theme-color">
<!-- Non-critical global styles (asynchronously loaded) -->
<noscript></noscript>
<style>
    /* Critical, above-the-fold CSS (mobile-first) */
    :root{
      --primary-color:#005A9C; --secondary-color:#003F6E; --background-color:#F8F9FA; --surface-color:#FFFFFF;
      --text-color:#212529; --muted-text-color:#6C757D; --border-color:#DEE2E6; --success-color:#198754; --danger-color:#DC3545;
      --touch:48px;
    }
    *{box-sizing:border-box}
    html{font-size:16px}
    body{margin:0;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;line-height:1.6;color:var(--text-color);background:var(--background-color)}
    a{color:var(--primary-color);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1200px;margin:0 auto;padding:0 1rem}
    .skip-link{position:absolute;left:8px;top:-40px;background:#000;color:#fff;padding:.5rem .75rem;border-radius:4px;z-index:1000}
    .skip-link:focus{top:8px}
    header.site-header{background:var(--surface-color);border-bottom:1px solid var(--border-color)}
    .header-content{display:grid;grid-template-columns:auto 1fr auto;gap:.75rem;align-items:center;padding:.75rem 0}
    .logo{font-weight:700;color:var(--primary-color)}
    .site-search{display:flex;gap:.5rem;align-items:center}
    .site-search input{flex:1;min-width:0;padding:.6rem .75rem;border:1px solid var(--border-color);border-radius:8px}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:.7rem 1rem;border-radius:8px;border:1px solid var(--primary-color);color:var(--primary-color);background:#fff;min-height:var(--touch);min-width:var(--touch);font-weight:600;cursor:pointer}
    .btn-primary{background:var(--primary-color);color:#fff}
    .btn:focus{outline:3px solid var(--primary-color);outline-offset:2px}
    nav.main-nav{display:none}
    main{padding:1.5rem 0}
    nav[aria-label="breadcrumb"]{font-size:.9rem;color:var(--muted-text-color);margin-bottom:1rem}
    h1,h2,h3{color:var(--secondary-color);margin:.25rem 0 .5rem}
    p{max-width:70ch}
    .layout{display:grid;grid-template-columns:1fr;gap:1.5rem}
    @media(min-width:992px){.layout{grid-template-columns:420px 1fr}}
    .card{background:var(--surface-color);border:1px solid var(--border-color);border-radius:12px;padding:1.25rem}
    .form-group{margin-bottom:1rem}
    .form-group label{display:block;font-weight:600;margin-bottom:.45rem}
    .input-group{position:relative}
    .form-control{width:100%;min-height:48px;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:8px;font-size:1rem}
    .form-control:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px;border-color:var(--primary-color)}
    .form-control[aria-invalid="true"]{border-color:var(--danger-color)}
    .input-affix{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);color:var(--muted-text-color);pointer-events:none}
    fieldset{border:0;padding:0;margin:0}
    .help-inline{display:inline-flex;gap:.5rem;align-items:center}
    .tooltip-btn{appearance:none;border:1px solid var(--border-color);background:#fff;border-radius:50%;width:28px;height:28px;line-height:1;color:#333;font-weight:700;cursor:pointer}
    .tooltip-btn:focus{outline:3px solid var(--primary-color);outline-offset:2px}
    .tooltip{display:none;margin-top:.5rem;background:#eef5fb;border:1px solid #cfe3f7;color:#0b3d62;padding:.75rem;border-radius:8px}
    .tooltip[aria-hidden="false"]{display:block}
    .error-message{color:var(--danger-color);font-size:.9rem;margin-top:.35rem}
    .results{margin-top:1rem;padding:1rem;border:1px solid var(--border-color);border-radius:12px;background:#f7fafc;min-height:260px}
    .result-row{display:flex;justify-content:space-between;gap:1rem;padding:.55rem 0;border-bottom:1px solid var(--border-color)}
    .result-row:last-child{border-bottom:none}
    .result-label{color:var(--muted-text-color)}
    .result-value{font-weight:700}
    .result-strong{color:var(--success-color);font-size:1.15rem}
    .notice{border-left:4px solid var(--success-color);background:#e9f7ef;padding:.75rem 1rem;border-radius:8px;margin:.5rem 0}
    .formula-box{background:#e9ecef;border-radius:8px;padding:1rem;font-family:"Source Code Pro",monospace;overflow-x:auto}
    .author-box{margin-top:1.5rem;color:var(--muted-text-color);border-top:1px solid var(--border-color);padding-top:1rem;font-size:.95rem}
    footer.site-footer{background:var(--secondary-color);color:#fff;margin-top:2.5rem}
    .footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.25rem;padding:2rem 0}
    .footer-bottom{text-align:center;border-top:1px solid rgba(255,255,255,.25);padding:1rem 0;color:#e1e1e1}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "New Hampshire State Income Tax Calculator",
  "description": "Professional, accessible New Hampshire income tax calculator for interest & dividends. Updated for the 2025 repeal with transparent formulas, glossary, and FAQs.",
  "url": "https://calcdomain.com/new-hampshire-income-tax.html",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step Example",
      "description": "Calculate New Hampshire interest & dividends tax for a given year, factoring in exemptions.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Choose the tax year",
          "text": "Select the filing year to load the correct NH interest & dividends tax rate. For 2025 and later the rate is 0%."
        },
        {
          "@type": "HowToStep",
          "name": "Enter your incomes",
          "text": "Wages/salary (NH does not tax wages), plus your annual interest and dividend income."
        },
        {
          "@type": "HowToStep",
          "name": "Apply exemptions",
          "text": "Enter your total allowed exemptions for interest & dividends. The calculator subtracts this from your I&D income."
        },
        {
          "@type": "HowToStep",
          "name": "Review results",
          "text": "We compute taxable I&D, apply the year's rate, and show total NH state income tax and your effective NH rate."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Does New Hampshire tax wages or salaries?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. New Hampshire does not levy a state income tax on earned wages or salaries."
          }
        },
        {
          "@type": "Question",
          "name": "What income did NH tax before 2025?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Historically, NH taxed interest and dividend income (I&D) at a flat rate with exemptions. Starting with tax years beginning in 2025, this I&D tax is repealed and the rate is 0%."
          }
        },
        {
          "@type": "Question",
          "name": "How are exemptions handled?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Enter your total allowed I&D exemptions. The calculator subtracts exemptions from interest plus dividends to determine taxable I&D. If exemptions exceed I&D income, taxable I&D is zero."
          }
        },
        {
          "@type": "Question",
          "name": "Which NH tax rates does this tool use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "It uses published NH I&D tax rates by year: 5% for 2022 and prior, 4% for 2023, 3% for 2024, and 0% for 2025 onward, per NH Department of Revenue Administration guidance."
          }
        },
        {
          "@type": "Question",
          "name": "Does NH tax capital gains, Social Security, or pensions?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. New Hampshire does not tax capital gains, Social Security benefits, or pension income at the state level."
          }
        },
        {
          "@type": "Question",
          "name": "Is this calculator a substitute for tax advice?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. This is an educational tool. Always consult official NH DRA publications or a qualified tax professional for your specific situation."
          }
        },
        {
          "@type": "Question",
          "name": "How accurate are the results?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The math follows NH’s published formulas and rates. Accuracy depends on inputs (e.g., correct exemption amounts) and whether your facts match NH DRA rules."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['$','$'], ['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script">

</head>
<body>
<a class="skip-link" href="#main-content">Skip to main content</a>

<main class="container" id="main-content" role="main">
<nav aria-label="breadcrumb">
<a href="https://calcdomain.com/">Home</a> / <a href="https://calcdomain.com/finance.html">Finance</a> / <a href="https://calcdomain.com/taxation.html">US Taxation (State)</a> / New Hampshire State Income Tax Calculator
    </nav>
<h1>New Hampshire State Income Tax Calculator</h1>
<p>
      This authoritative, mobile-first New Hampshire income tax calculator helps residents and investors estimate their state tax on interest and dividend income by year. It clarifies that NH does not tax wages, applies the correct I&amp;D rate for the selected year, and factors in your exemptions.
    </p>
<div class="layout">
<!-- Calculator -->
<aside aria-labelledby="calc-heading" class="card">
<section aria-live="polite" id="calculator">
<h2 id="calc-heading">Interactive Calculator</h2>
<div class="form-group">
<label for="taxYear">Tax year *</label>
<select aria-describedby="taxYearError" aria-required="true" class="form-control" id="taxYear">
<option selected="" value="2025">2025 (I&amp;D repealed)</option>
<option value="2024">2024</option>
<option value="2023">2023</option>
<option value="2022">2022</option>
<option value="2021">2021</option>
</select>
<div aria-live="polite" class="error-message" id="taxYearError" role="alert"></div>
</div>
<div class="form-group">
<label for="filingStatus">Filing status *</label>
<select aria-describedby="filingStatusError" aria-required="true" class="form-control" id="filingStatus">
<option selected="" value="single">Single</option>
<option value="married_joint">Married filing jointly</option>
<option value="married_separate">Married filing separately</option>
<option value="head_household">Head of household</option>
</select>
<div aria-live="polite" class="error-message" id="filingStatusError" role="alert"></div>
</div>
<div class="form-group">
<label for="wages">Annual wages/salary (NH taxes wages at 0%)</label>
<div class="input-group">
<input aria-describedby="wagesTip wagesError wagesAffix" class="form-control" id="wages" inputmode="decimal" min="0" placeholder="e.g., 60000" step="0.01" type="number">
<span class="input-affix" id="wagesAffix">$</span>
</div>
<div class="help-inline" style="margin-top:.35rem;">
<button aria-controls="wagesTip" aria-expanded="false" aria-label="More info about wages" class="tooltip-btn" id="wagesTipBtn" type="button">?</button>
<div aria-hidden="true" class="tooltip" id="wagesTip" role="tooltip">
                New Hampshire does not impose a state income tax on earned wages or salaries. Your wage entry is used only to show an effective NH rate across your total income.
              </div>
</div>
<div aria-live="polite" class="error-message" id="wagesError" role="alert"></div>
</div>
<div class="form-group">
<label for="interest">Annual taxable interest *</label>
<div class="input-group">
<input aria-describedby="interestError interestAffix" aria-required="true" class="form-control" id="interest" inputmode="decimal" min="0" placeholder="e.g., 1500" step="0.01" type="number">
<span class="input-affix" id="interestAffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="interestError" role="alert"></div>
</div>
<div class="form-group">
<label for="dividends">Annual dividends *</label>
<div class="input-group">
<input aria-describedby="dividendsError dividendsAffix" aria-required="true" class="form-control" id="dividends" inputmode="decimal" min="0" placeholder="e.g., 1200" step="0.01" type="number">
<span class="input-affix" id="dividendsAffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="dividendsError" role="alert"></div>
</div>
<div class="form-group">
<label class="help-inline" for="exemptions">I&amp;D exemptions total
              <button aria-controls="exemptionsTip" aria-expanded="false" aria-label="Explain I&amp;D exemptions" class="tooltip-btn" id="exemptionsTipBtn" type="button">?</button>
</label>
<div class="input-group">
<input aria-describedby="exemptionsTip exemptionsError exemptionsAffix" class="form-control" id="exemptions" inputmode="decimal" min="0" step="0.01" type="number" value="0">
<span class="input-affix" id="exemptionsAffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="exemptionsTip" role="tooltip">
              Enter your total allowed Interest &amp; Dividends exemptions per NH rules for the selected year. Typical baselines (verify with NH DRA):
              Single ≈ $2,400; Married filing jointly ≈ $4,800; add-ons may apply for age 65+ or blindness. This tool uses whatever total you enter.
            </div>
<div aria-live="polite" class="error-message" id="exemptionsError" role="alert"></div>
</div>
<div aria-atomic="true" aria-live="polite" class="results">
<div class="notice" id="yearNotice" role="status"></div>
<h3>Results</h3>
<div class="result-row">
<span class="result-label">NH I&amp;D tax rate</span>
<span class="result-value" id="rateOut">0%</span>
</div>
<div class="result-row">
<span class="result-label">Interest + Dividends</span>
<span class="result-value" id="idTotalOut">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">Minus exemptions</span>
<span class="result-value" id="exemptionsOut">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">NH taxable I&amp;D</span>
<span class="result-value" id="taxableIDOut">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">NH tax on wages</span>
<span class="result-value" id="wageTaxOut">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">NH I&amp;D tax</span>
<span class="result-value" id="idTaxOut">$0.00</span>
</div>
<div class="result-row">
<span class="result-label"><strong>Total NH state income tax</strong></span>
<span class="result-value result-strong" id="totalNHOut">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">Effective NH tax rate (vs. total income)</span>
<span class="result-value" id="effectiveRateOut">0.00%</span>
</div>
</div>
</section>
</aside>
<!-- Authoritative content -->
<article class="card">
<section class="content">
<h2>Data Source and Methodology</h2>
<p>
            Authoritative data: New Hampshire Department of Revenue Administration (DRA), “Taxes at a Glance” and Interest &amp; Dividends Tax guidance. See:
          </p>
<ul>
<li>
              New Hampshire DRA — Taxes at a Glance (accessed 2024–2025):
              <a href="https://www.revenue.nh.gov/taxes-glance" rel="noopener" target="_blank">https://www.revenue.nh.gov/taxes-glance</a>
</li>
<li>
              NH Revised Statutes Annotated (RSA) 77 — Interest and Dividends Tax:
              <a href="https://www.gencourt.state.nh.us/rsa/html/NHTOC/NHTOC-V-77.htm" rel="noopener" target="_blank">RSA 77</a>
</li>
<li>
              NH DRA I&amp;D FAQs:
              <a href="https://www.revenue.nh.gov/help/faqs/interest-dividends.htm" rel="noopener" target="_blank">https://www.revenue.nh.gov/help/faqs/interest-dividends.htm</a>
</li>
</ul>
<p><strong>All calculations are strictly based on the formulas and data provided by this source.</strong></p>
<h2>The Formula Explained</h2>
<div aria-label="Calculation formulas in LaTeX" class="formula-box">
            $$ \text{I\&amp;D Income} = \text{Interest} + \text{Dividends} $$
            <br/>
            $$ \text{Taxable I\&amp;D} = \max\left(0, \; \text{I\&amp;D Income} - \text{Exemptions}\right) $$
            <br/>
            $$ \text{NH I\&amp;D Tax} = \text{Taxable I\&amp;D} \times r_{\text{year}} $$
            <br/>
            $$ \text{Total NH State Income Tax} = \text{NH I\&amp;D Tax} + 0 \cdot \text{Wages} $$
            <br/>
            $$ \text{Effective NH Rate} = \frac{\text{Total NH State Income Tax}}{\max(1,\; \text{Wages} + \text{I\&amp;D Income})} $$
          </div>
<h2>Glossary of Variables</h2>
<ul>
<li><strong>Tax year:</strong> The filing year that sets the applicable NH I&amp;D tax rate r_year (0% for 2025+).</li>
<li><strong>Filing status:</strong> Your filing category (for exemptions guidance; NH wage tax remains 0%).</li>
<li><strong>Wages/salary:</strong> Earned income; NH state tax on wages is 0%.</li>
<li><strong>Interest:</strong> Annual taxable interest income subject to NH I&amp;D rules.</li>
<li><strong>Dividends:</strong> Annual dividend income subject to NH I&amp;D rules.</li>
<li><strong>Exemptions:</strong> Total allowed deduction from I&amp;D income per NH rules for the selected year and your circumstances.</li>
<li><strong>NH taxable I&amp;D:</strong> Interest + Dividends − Exemptions, floored at zero.</li>
<li><strong>NH I&amp;D tax:</strong> Taxable I&amp;D multiplied by the year’s NH rate.</li>
<li><strong>Effective NH rate:</strong> Total NH tax divided by total income (wages + I&amp;D).</li>
</ul>
<h2>How It Works: A Step-by-Step Example</h2>
<p>
            Suppose tax year = 2024, filing status = Single, wages = $60,000, interest = $1,500, dividends = $1,200, exemptions = $2,400.
          </p>
<ol>
<li>I&amp;D Income = 1,500 + 1,200 = 2,700</li>
<li>Taxable I&amp;D = max(0, 2,700 − 2,400) = 300</li>
<li>r_year (2024) = 3% = 0.03</li>
<li>NH I&amp;D Tax = 300 × 0.03 = $9.00</li>
<li>NH wage tax = 0% × 60,000 = $0</li>
<li>Total NH State Income Tax = 9 + 0 = $9</li>
<li>Effective NH Rate = 9 ÷ (60,000 + 2,700) ≈ 0.0145%</li>
</ol>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>Does New Hampshire tax wages?</summary>
<p>No. NH does not levy a state income tax on earned wages or salaries.</p>
</details>
<details>
<summary>What is taxed in New Hampshire?</summary>
<p>
              Historically, NH taxed interest and dividends. For tax years beginning in 2025 and later, the I&amp;D tax rate is 0% (repealed). Always confirm with NH DRA for your filing year.
            </p>
</details>
<details>
<summary>What rate does this calculator use?</summary>
<p>It uses NH’s published I&amp;D rates by year: 5% (2022 and prior), 4% (2023), 3% (2024), and 0% (2025+).</p>
</details>
<details>
<summary>How should I enter exemptions?</summary>
<p>
              Enter your total allowed I&amp;D exemptions for the selected year based on NH rules for your filing status and any age/blindness additions. If unsure, check “Taxes at a Glance” and NH DRA FAQs.
            </p>
</details>
<details>
<summary>Are capital gains taxed by NH?</summary>
<p>No. NH does not tax capital gains at the state level.</p>
</details>
<details>
<summary>Is Social Security or pension income taxed?</summary>
<p>No. NH does not tax Social Security benefits or pension income.</p>
</details>
<details>
<summary>Is this calculator tax advice?</summary>
<p>No. It is an educational tool. For personal advice, consult NH DRA publications or a qualified tax professional.</p>
</details>
<div class="author-box">
            Tool developed by <strong>Ugo Candido</strong>. Content verified by <strong>CalcDomain Editorial</strong>.<br/>
            Last reviewed for accuracy on: September 13, 2025.
          </div>
</section>
</article>
</div>
</main>
<!-- Standard Footer --> 
<script defer="">
    (function(){
      'use strict';

      // State
      const yearRateMap = {
        2021: 0.05,
        2022: 0.05,
        2023: 0.04,
        2024: 0.03,
        2025: 0.00
      };

      // Elements
      const taxYearEl = document.getElementById('taxYear');
      const filingEl = document.getElementById('filingStatus');
      const wagesEl = document.getElementById('wages');
      const interestEl = document.getElementById('interest');
      const dividendsEl = document.getElementById('dividends');
      const exemptionsEl = document.getElementById('exemptions');

      const yearNotice = document.getElementById('yearNotice');
      const rateOut = document.getElementById('rateOut');
      const idTotalOut = document.getElementById('idTotalOut');
      const exemptionsOut = document.getElementById('exemptionsOut');
      const taxableIDOut = document.getElementById('taxableIDOut');
      const wageTaxOut = document.getElementById('wageTaxOut');
      const idTaxOut = document.getElementById('idTaxOut');
      const totalNHOut = document.getElementById('totalNHOut');
      const effectiveRateOut = document.getElementById('effectiveRateOut');

      const wagesTipBtn = document.getElementById('wagesTipBtn');
      const wagesTip = document.getElementById('wagesTip');
      const exemptionsTipBtn = document.getElementById('exemptionsTipBtn');
      const exemptionsTip = document.getElementById('exemptionsTip');

      // Errors
      const taxYearError = document.getElementById('taxYearError');
      const filingStatusError = document.getElementById('filingStatusError');
      const wagesError = document.getElementById('wagesError');
      const interestError = document.getElementById('interestError');
      const dividendsError = document.getElementById('dividendsError');
      const exemptionsError = document.getElementById('exemptionsError');

      // Utils
      const money = new Intl.NumberFormat('en-US', {style:'currency', currency:'USD', maximumFractionDigits:2});
      const pct = new Intl.NumberFormat('en-US', {style:'percent', minimumFractionDigits:2, maximumFractionDigits:2});

      function parseNum(input){
        const v = (input.value || '').trim();
        if (v === '') return 0;
        const n = Number(v);
        return Number.isFinite(n) ? n : NaN;
      }

      function setError(inputEl, errorEl, msg){
        if (msg){
          inputEl.setAttribute('aria-invalid', 'true');
          errorEl.textContent = msg;
        } else {
          inputEl.removeAttribute('aria-invalid');
          errorEl.textContent = '';
        }
      }

      function validateNonNegative(inputEl, errorEl, label){
        const n = parseNum(inputEl);
        if (Number.isNaN(n)){
          setError(inputEl, errorEl, `${label} must be a number. Example: 1500`);
          return null;
        }
        if (n < 0){
          setError(inputEl, errorEl, `${label} cannot be negative. Enter 0 or a positive amount.`);
          return null;
        }
        if (n > 1e12){
          setError(inputEl, errorEl, `${label} seems unusually large. Please check the value.`);
          return null;
        }
        setError(inputEl, errorEl, '');
        return n;
      }

      function currentRate(year){
        const y = Number(year);
        if (y >= 2025) return 0;
        return yearRateMap[y] ?? 0.05; // default to 5% for older years
      }

      function updateNotice(year){
        const y = Number(year);
        if (y >= 2025){
          yearNotice.innerHTML = '<strong>Good news:</strong> For tax years beginning in 2025 and later, New Hampshire\'s Interest &amp; Dividends tax is repealed. Your statewide income tax is $0 unless law changes.';
        } else {
          yearNotice.textContent = '';
        }
      }

      function calculate(){
        // Validate required selects
        if (!taxYearEl.value){
          setError(taxYearEl, taxYearError, 'Please choose a tax year.');
          return;
        } else setError(taxYearEl, taxYearError, '');

        if (!filingEl.value){
          setError(filingEl, filingStatusError, 'Please choose your filing status.');
          return;
        } else setError(filingEl, filingStatusError, '');

        // Numeric validations
        const wages = validateNonNegative(wagesEl, wagesError, 'Wages/salary');
        const interest = validateNonNegative(interestEl, interestError, 'Interest');
        const dividends = validateNonNegative(dividendsEl, dividendsError, 'Dividends');
        const exemptions = validateNonNegative(exemptionsEl, exemptionsError, 'Exemptions');

        if ([wages, interest, dividends, exemptions].some(v => v === null)) return;

        const year = Number(taxYearEl.value);
        const rate = currentRate(year);

        const idIncome = interest + dividends;
        const taxableID = Math.max(0, idIncome - exemptions);
        const idTax = taxableID * rate;
        const wageTax = 0; // NH does not tax wages
        const totalNHTax = idTax + wageTax;
        const totalIncome = Math.max(1, wages + idIncome);
        const effRate = totalNHTax / totalIncome;

        // Outputs
        updateNotice(year);
        rateOut.textContent = pct.format(rate);
        idTotalOut.textContent = money.format(idIncome);
        exemptionsOut.textContent = money.format(exemptions);
        taxableIDOut.textContent = money.format(taxableID);
        wageTaxOut.textContent = money.format(wageTax);
        idTaxOut.textContent = money.format(idTax);
        totalNHOut.textContent = money.format(totalNHTax);
        effectiveRateOut.textContent = (effRate * 100).toFixed(2) + '%';
      }

      // Tooltip handlers (accessible)
      function toggleTooltip(btn, tip){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tip.setAttribute('aria-hidden', String(expanded));
      }
      wagesTipBtn.addEventListener('click', () => toggleTooltip(wagesTipBtn, wagesTip));
      exemptionsTipBtn.addEventListener('click', () => toggleTooltip(exemptionsTipBtn, exemptionsTip));

      // Inline validation on blur
      wagesEl.addEventListener('blur', () => validateNonNegative(wagesEl, wagesError, 'Wages/salary'));
      interestEl.addEventListener('blur', () => validateNonNegative(interestEl, interestError, 'Interest'));
      dividendsEl.addEventListener('blur', () => validateNonNegative(dividendsEl, dividendsError, 'Dividends'));
      exemptionsEl.addEventListener('blur', () => validateNonNegative(exemptionsEl, exemptionsError, 'Exemptions'));

      // Recalculate on input changes
      [taxYearEl, filingEl, wagesEl, interestEl, dividendsEl, exemptionsEl].forEach(el=>{
        el.addEventListener('input', calculate, {passive:true});
        el.addEventListener('change', calculate, {passive:true});
      });

      // Initial compute
      calculate();
    })();
  </script>

</body></html>