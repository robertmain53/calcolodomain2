<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="canonical" href="https://calcdomain.com/greenshields-model" />
    <title>Greenshields Model Calculator (2024 Guide) | CalcDomain</title>
    <meta name="description" content="Calculate Greenshields Model Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Greenshields Model Calculator (2024 Guide) | CalcDomain" />
    <meta property="og:description" content="Calculate Greenshields Model Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />
    <meta property="og:url" content="https://calcdomain.com/greenshields-model" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Greenshields Model Calculator (2024 Guide) | CalcDomain" />
    <meta name="twitter:description" content="Calculate Greenshields Model Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />

    
    <link rel="preload" href="https://calcdomain.com/assets/tailwind.min.css" as="style">
    <link rel="stylesheet" href="https://calcdomain.com/assets/tailwind.min.css">
    <!-- Google tag (gtag.js) -->
    
    
    
    
    

    <script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/"}, {"@type": "ListItem", "position": 2, "name": "Math Calculators", "item": "https://calcdomain.com/categories/math"}, {"@type": "ListItem", "position": 3, "name": "Core Math &amp; Algebra Calculators", "item": "https://calcdomain.com/subcategories/core-math-algebra"}, {"@type": "ListItem", "position": 4, "name": "Greenshields Model Traffic Flow Calculator", "item": "https://calcdomain.com/greenshields-model"}]}</script>
  
    <style>
      body { margin: 0; }
      .mb-10 { margin-bottom: 2.5rem; }
      .mt-10 { margin-top: 2.5rem; }
    </style>
    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ugo Candido",
        "url": "https://www.linkedin.com/in/ugocandido92821/",
        "sameAs": ["https://www.linkedin.com/in/ugocandido92821/"],
        "email": "info@calcdomain.com",
        "description": "Ugo Candido builds calculators and educational resources to help readers make better decisions with transparent, practical models."
      }</script>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9476637732224939"
      crossorigin="anonymous"
    ></script>

    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a
            href="https://calcdomain.com"
            class="text-2xl font-bold text-blue-600"
            >CalcDomain</a
          >
          <div class="w-full max-w-md hidden md:block mx-8">
            <div class="relative">
              <input
                type="search"
                id="search-input"
                placeholder="Search for a calculator..."
                class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                autocomplete="off"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
              <div
                id="search-results"
                class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"
              ></div>
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a
              href="https://calcdomain.com/search"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Categories</a
            >
          </div>
          <button
            id="mobile-menu-toggle"
            class="md:hidden p-2"
            aria-controls="mobile-menu"
            aria-expanded="false"
            aria-label="Open menu"
            type="button"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
        <nav
          id="mobile-menu"
          class="md:hidden mt-4 hidden"
          aria-label="Mobile menu"
          role="navigation"
        >
          <div class="mb-4">
            <div class="relative">
              <input
                type="search"
                id="mobile-search-input"
                placeholder="Search calculators..."
                class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
            </div>
          </div>
          <div class="space-y-2">
            <a
              href="https://calcdomain.com/search"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Categories</a
            >
          </div>
        </nav>
      </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
      <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600">
  <ol class="flex flex-wrap items-center gap-1">
    <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/categories/math" class="text-blue-600 hover:underline">Math Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/subcategories/core-math-algebra" class="text-blue-600 hover:underline">Core Math &amp;amp; Algebra Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><span class="text-gray-800">Greenshields Model Traffic Flow Calculator</span></li>
  </ol>
</nav>
      <div class="flex flex-col lg:flex-row gap-8">
        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <header class="mb-6">
              <h1 class="text-2xl md:text-3xl font-bold mb-2">
                Greenshields Model Traffic Flow Calculator
              </h1>
              <p class="text-gray-700">
                Compute speed, density, and flow using the Greenshields traffic
                flow model, find capacity and critical density, and visualize
                the fundamental diagrams for a highway or arterial.
              </p>
            </header>

            <!-- Calculator UI -->
            <section
              aria-labelledby="greenshields-calculator-heading"
              class="mb-8"
            >
              <h2
                id="greenshields-calculator-heading"
                class="text-xl font-semibold mb-4"
              >
                Greenshields Model Calculator
              </h2>

              <!-- Unit system toggle -->
              <div class="mb-4 flex flex-wrap items-center gap-3">
                <span class="font-medium mr-2">Units:</span>
                <button
                  type="button"
                  data-unit="metric"
                  class="unit-toggle px-3 py-1 rounded-full border text-sm font-medium bg-blue-600 text-white border-blue-600"
                >
                  Metric (km, veh/km)
                </button>
                <button
                  type="button"
                  data-unit="imperial"
                  class="unit-toggle px-3 py-1 rounded-full border text-sm font-medium bg-white text-gray-700 border-gray-300"
                >
                  US (mi, veh/mi)
                </button>
              </div>

              <form id="greenshields-form" class="space-y-4">
                <!-- Model parameters -->
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label
                      for="vf"
                      class="block text-sm font-medium text-gray-700"
                      >Free-flow speed \(v_f\)</label
                    >
                    <div class="mt-1 flex rounded-md shadow-sm">
                      <input
                        type="number"
                        id="vf"
                        name="vf"
                        step="0.1"
                        min="1"
                        value="100"
                        class="flex-1 block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:ring-blue-500 focus:border-blue-500"
                        required
                      />
                      <span
                        id="vf-unit"
                        class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm"
                        >km/h</span
                      >
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                      Typical freeway: 80–120 km/h (50–75 mph).
                    </p>
                  </div>

                  <div>
                    <label
                      for="kj"
                      class="block text-sm font-medium text-gray-700"
                      >Jam density \(k_j\)</label
                    >
                    <div class="mt-1 flex rounded-md shadow-sm">
                      <input
                        type="number"
                        id="kj"
                        name="kj"
                        step="1"
                        min="1"
                        value="150"
                        class="flex-1 block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:ring-blue-500 focus:border-blue-500"
                        required
                      />
                      <span
                        id="kj-unit"
                        class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm"
                        >veh/km/lane</span
                      >
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                      Bumper-to-bumper density per lane (e.g., 120–180
                      veh/km/lane).
                    </p>
                  </div>
                </div>

                <!-- What to solve for -->
                <fieldset class="border border-gray-200 rounded-md p-3">
                  <legend class="text-sm font-medium text-gray-700 px-1">
                    Known variable
                  </legend>
                  <div class="mt-2 grid md:grid-cols-3 gap-2 text-sm">
                    <label class="inline-flex items-center gap-2">
                      <input
                        type="radio"
                        name="knownType"
                        value="density"
                        class="known-type h-4 w-4 text-blue-600 border-gray-300"
                        checked
                      />
                      <span>Density \(k\)</span>
                    </label>
                    <label class="inline-flex items-center gap-2">
                      <input
                        type="radio"
                        name="knownType"
                        value="speed"
                        class="known-type h-4 w-4 text-blue-600 border-gray-300"
                      />
                      <span>Speed \(v\)</span>
                    </label>
                    <label class="inline-flex items-center gap-2">
                      <input
                        type="radio"
                        name="knownType"
                        value="flow"
                        class="known-type h-4 w-4 text-blue-600 border-gray-300"
                      />
                      <span>Flow \(q\)</span>
                    </label>
                  </div>
                </fieldset>

                <!-- Known value input -->
                <div id="known-density-group">
                  <label for="k" class="block text-sm font-medium text-gray-700"
                    >Density \(k\)</label
                  >
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      type="number"
                      id="k"
                      name="k"
                      step="0.1"
                      min="0"
                      value="20"
                      class="flex-1 block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                    <span
                      id="k-unit"
                      class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm"
                      >veh/km/lane</span
                    >
                  </div>
                </div>

                <div id="known-speed-group" class="hidden">
                  <label for="v" class="block text-sm font-medium text-gray-700"
                    >Speed \(v\)</label
                  >
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      type="number"
                      id="v"
                      name="v"
                      step="0.1"
                      min="0"
                      value="80"
                      class="flex-1 block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                    <span
                      id="v-unit"
                      class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm"
                      >km/h</span
                    >
                  </div>
                </div>

                <div id="known-flow-group" class="hidden">
                  <label for="q" class="block text-sm font-medium text-gray-700"
                    >Flow \(q\)</label
                  >
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      type="number"
                      id="q"
                      name="q"
                      step="1"
                      min="0"
                      value="1500"
                      class="flex-1 block w-full rounded-l-md border border-gray-300 px-3 py-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                    <span
                      id="q-unit"
                      class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm"
                      >veh/h/lane</span
                    >
                  </div>
                </div>

                <!-- Buttons -->
                <div class="flex flex-wrap gap-3 pt-2">
                  <button
                    type="button"
                    id="calculate-btn"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
                  >
                    Calculate
                  </button>
                  <button
                    type="button"
                    id="reset-btn"
                    class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
                  >
                    Reset
                  </button>
                </div>
              </form>

              <!-- Result summary -->
              <div
                id="results-card"
                class="mt-6 p-4 rounded-md border border-gray-200 bg-gray-50 hidden"
              >
                <h3 class="text-lg font-semibold mb-2">Results</h3>
                <div
                  id="results-warning"
                  class="hidden mb-2 text-sm text-yellow-800 bg-yellow-50 border border-yellow-200 rounded-md px-3 py-2"
                ></div>
                <dl class="grid md:grid-cols-2 gap-x-6 gap-y-2 text-sm">
                  <div>
                    <dt class="font-medium text-gray-700">Speed \(v\)</dt>
                    <dd id="res-speed" class="text-gray-900">–</dd>
                  </div>
                  <div>
                    <dt class="font-medium text-gray-700">Density \(k\)</dt>
                    <dd id="res-density" class="text-gray-900">–</dd>
                  </div>
                  <div>
                    <dt class="font-medium text-gray-700">Flow \(q\)</dt>
                    <dd id="res-flow" class="text-gray-900">–</dd>
                  </div>
                  <div>
                    <dt class="font-medium text-gray-700">
                      Space mean headway
                    </dt>
                    <dd id="res-headway" class="text-gray-900">–</dd>
                  </div>
                </dl>

                <hr class="my-3" />

                <h4 class="font-semibold text-sm mb-1">
                  Model characteristics
                </h4>
                <dl
                  class="grid md:grid-cols-2 gap-x-6 gap-y-1 text-xs md:text-sm"
                >
                  <div>
                    <dt class="font-medium text-gray-700">
                      Critical density \(k_c\)
                    </dt>
                    <dd id="res-kc" class="text-gray-900">–</dd>
                  </div>
                  <div>
                    <dt class="font-medium text-gray-700">
                      Capacity (max flow) \(q_{max}\)
                    </dt>
                    <dd id="res-qmax" class="text-gray-900">–</dd>
                  </div>
                  <div>
                    <dt class="font-medium text-gray-700">Speed at capacity</dt>
                    <dd id="res-vc" class="text-gray-900">–</dd>
                  </div>
                  <div>
                    <dt class="font-medium text-gray-700">Relative density</dt>
                    <dd id="res-relative" class="text-gray-900">–</dd>
                  </div>
                </dl>
              </div>
            </section>

            <!-- Charts -->
            <section
              aria-labelledby="greenshields-charts-heading"
              class="mb-10"
            >
              <h2
                id="greenshields-charts-heading"
                class="text-xl font-semibold mb-3"
              >
                Fundamental Diagrams
              </h2>
              <p class="text-sm text-gray-600 mb-4">
                These plots are generated from your chosen free-flow speed and
                jam density. Capacity and critical density are highlighted.
              </p>

              <div class="grid gap-4">
                <div class="bg-white border border-gray-200 rounded-md p-3">
                  <h3 class="text-sm font-semibold mb-1">
                    Speed–Density diagram \(v(k)\)
                  </h3>
                  <canvas
                    id="chart-vk"
                    aria-label="Speed versus density chart"
                  ></canvas>
                </div>
                <div class="bg-white border border-gray-200 rounded-md p-3">
                  <h3 class="text-sm font-semibold mb-1">
                    Flow–Density diagram \(q(k)\)
                  </h3>
                  <canvas
                    id="chart-qk"
                    aria-label="Flow versus density chart"
                  ></canvas>
                </div>
                <div class="bg-white border border-gray-200 rounded-md p-3">
                  <h3 class="text-sm font-semibold mb-1">
                    Speed–Flow diagram \(v(q)\)
                  </h3>
                  <canvas
                    id="chart-vq"
                    aria-label="Speed versus flow chart"
                  ></canvas>
                </div>
              </div>
            </section>

            <!-- Theory & explanation -->
            <section class="prose">
              <h2>Greenshields traffic flow model – theory and formulas</h2>
              <p>
                The Greenshields model is one of the earliest and simplest
                macroscopic traffic flow models. It assumes a
                <strong>linear relationship between speed and density</strong>
                on an uninterrupted facility such as a freeway:
              </p>
              <div class="formula-box">
                <p>Speed–density relationship:</p>
                <p>\[ v(k) = v_f \left(1 - \frac{k}{k_j}\right) \]</p>
                <ul>
                  <li>\(v\) – mean speed (km/h or mph)</li>
                  <li>\(k\) – density (veh/km/lane or veh/mi/lane)</li>
                  <li>\(v_f\) – free-flow speed</li>
                  <li>\(k_j\) – jam density</li>
                </ul>
              </div>

              <p>Flow \(q\) is defined as the product of density and speed:</p>
              <div class="formula-box">
                <p>Flow–density relationship:</p>
                <p>
                  \[ q(k) = k \cdot v(k) = v_f k \left(1 - \frac{k}{k_j}\right)
                  \]
                </p>
              </div>

              <h3>Critical density and capacity</h3>
              <p>
                The <strong>critical density</strong> \(k_c\) is the density at
                which flow is maximized (capacity). To find it, differentiate
                \(q(k)\) with respect to \(k\) and set the derivative to zero:
              </p>
              <div class="formula-box">
                <p>\[ q(k) = v_f k \left(1 - \frac{k}{k_j}\right) \]</p>
                <p>
                  \[ \frac{dq}{dk} = v_f \left(1 - 2\frac{k}{k_j}\right) = 0
                  \quad\Rightarrow\quad k_c = \frac{k_j}{2} \]
                </p>
              </div>
              <p>The corresponding <strong>speed at capacity</strong> is:</p>
              <div class="formula-box">
                <p>
                  \[ v_c = v(k_c) = v_f \left(1 - \frac{k_c}{k_j}\right) = v_f
                  \left(1 - \frac{1}{2}\right) = \frac{v_f}{2} \]
                </p>
              </div>
              <p>The <strong>maximum flow (capacity)</strong> is then:</p>
              <div class="formula-box">
                <p>
                  \[ q_{\max} = q(k_c) = v_f \cdot \frac{k_j}{2} \left(1 -
                  \frac{1}{2}\right) = \frac{v_f k_j}{4} \]
                </p>
              </div>

              <h3>Headway and spacing</h3>
              <p>
                Density is the inverse of average spacing between vehicles. If
                \(k\) is in veh/km/lane, the average spacing \(s\) in meters is:
              </p>
              <div class="formula-box">
                <p>\[ s = \frac{1000}{k} \quad [\text{m/veh}] \]</p>
              </div>
              <p>
                The <strong>space mean headway</strong> (time between vehicles
                at a point) is:
              </p>
              <div class="formula-box">
                <p>
                  \[ h = \frac{1}{q} \quad [\text{h/veh}] \quad\Rightarrow\quad
                  h_s = \frac{3600}{q} \quad [\text{s/veh}] \]
                </p>
              </div>

              <h2>How to interpret the diagrams</h2>
              <h3>Speed–density diagram</h3>
              <p>
                The speed–density line starts at \((k=0, v=v_f)\) and decreases
                linearly to \((k=k_j, v=0)\). At low densities, vehicles travel
                close to free-flow speed. As density increases, interactions
                grow and speed drops.
              </p>

              <h3>Flow–density diagram</h3>
              <p>
                The flow–density curve is a concave parabola opening downward.
                It:
              </p>
              <ul>
                <li>Starts at \(q=0\) when \(k=0\) (no vehicles, no flow).</li>
                <li>Reaches a maximum at \(k_c = k_j/2\) (capacity).</li>
                <li>
                  Returns to \(q=0\) at \(k=k_j\) (jammed traffic, zero speed).
                </li>
              </ul>
              <p>
                Densities below \(k_c\) correspond to
                <strong>under-saturated</strong> conditions (stable flow), while
                densities above \(k_c\) indicate
                <strong>congested</strong> conditions.
              </p>

              <h3>Speed–flow diagram</h3>
              <p>
                The speed–flow diagram shows two possible speeds for a given
                flow (except at capacity):
              </p>
              <ul>
                <li>
                  A <strong>higher speed, lower density</strong> operating point
                  (stable, free-flow regime).
                </li>
                <li>
                  A <strong>lower speed, higher density</strong> operating point
                  (congested regime).
                </li>
              </ul>
              <p>
                In practice, traffic tends to operate on the stable branch until
                disturbances push it into congestion.
              </p>

              <h2>Typical parameter values</h2>
              <ul>
                <li>
                  <strong>Free-flow speed \(v_f\)</strong>: 90–120 km/h (55–75
                  mph) on freeways; 60–80 km/h (35–50 mph) on arterials.
                </li>
                <li>
                  <strong>Jam density \(k_j\)</strong>: 120–180 veh/km/lane
                  (190–290 veh/mi/lane), depending on lane width and vehicle
                  mix.
                </li>
                <li>
                  <strong>Capacity \(q_{\max}\)</strong>: often 1800–2400
                  veh/h/lane for freeways, which you can check with \(q_{\max} =
                  v_f k_j / 4\).
                </li>
              </ul>

              <h2>Limitations of the Greenshields model</h2>
              <p>
                While the Greenshields model is widely used for teaching and
                quick estimates, it has several limitations:
              </p>
              <ul>
                <li>
                  The linear speed–density assumption may not fit real data
                  well, especially near jam density.
                </li>
                <li>
                  It is a <strong>macroscopic</strong> model and does not
                  capture individual vehicle behavior or lane-changing.
                </li>
                <li>
                  It assumes homogeneous traffic and roadway conditions (no
                  bottlenecks, signals, or ramps).
                </li>
              </ul>
              <p>
                For detailed design or operational analysis, engineers often
                calibrate more flexible models (e.g., Greenberg, Underwood,
                Drake) or use microscopic simulation tools.
              </p>
            </section>

            <!-- FAQ -->
            <section id="faq" class="prose mt-10">
              <h2>Greenshields model – frequently asked questions</h2>

              <h3>Is the Greenshields model realistic enough for design?</h3>
              <p>
                It is adequate for
                <strong>conceptual design, teaching, and quick checks</strong>,
                but not for final design of critical facilities. For
                design-level work, you should calibrate the model with local
                data or use more advanced models and simulation that reflect
                driver behavior, lane distribution, and control devices.
              </p>

              <h3>How do I choose jam density \(k_j\)?</h3>
              <p>
                Jam density depends on lane width, vehicle size, and driver
                behavior. A common rule of thumb is:
              </p>
              <ul>
                <li>
                  Passenger-car only freeway: 140–180 veh/km/lane (225–290
                  veh/mi/lane).
                </li>
                <li>Mixed traffic or narrow lanes: slightly lower values.</li>
              </ul>
              <p>
                If you have field data, you can estimate \(k_j\) from observed
                maximum densities during severe congestion.
              </p>

              <h3>Can this calculator handle multiple lanes?</h3>
              <p>
                Yes. All calculations are done <strong>per lane</strong>. To get
                total flow for a multi-lane facility, multiply the per-lane flow
                \(q\) or capacity \(q_{\max}\) by the number of lanes, assuming
                lanes are used evenly.
              </p>

              <h3>
                What is the difference between time mean speed and space mean
                speed?
              </h3>
              <p>
                The Greenshields model uses <strong>space mean speed</strong>,
                which is the harmonic mean of individual speeds over a road
                segment. Time mean speed is the arithmetic mean of speeds
                observed at a point. In uncongested conditions they are similar,
                but they diverge as variability increases.
              </p>
            </section>
          </div>



            <section class="mt-10" id="author">
              <h2 class="text-xl font-semibold mb-4">About the author</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  <a href="https://www.linkedin.com/in/ugocandido92821/" class="text-blue-600 hover:underline" target="_blank" rel="noopener">Ugo Candido</a>
                  builds financial tools and educational resources to help
                  readers make better money decisions. He focuses on practical,
                  transparent models that reflect how lenders calculate
                  payments and total cost of ownership.
                </p>
                <p class="text-sm text-gray-700 mt-3">
                  Contact: <a href="mailto:info@calcdomain.com" class="text-blue-600 hover:underline">info@calcdomain.com</a>
                </p>
              </div>
            </section>

            <section class="mt-10" id="editorial-policy">
              <h2 class="text-xl font-semibold mb-4">Editorial policy</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  CalcDomain content is created for educational purposes and is
                  reviewed for clarity, accuracy, and transparency. We do not
                  accept paid placements that influence calculator outputs.
                  Inputs and assumptions are shown directly in the interface so
                  you can verify how results are produced.
                </p>
              </div>
            </section>

            <section class="mt-10" id="methodology">
              <h2 class="text-xl font-semibold mb-4">Methodology</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  Results use standard formulas and the values you provide.
                  Figures are estimates and may differ from lender quotes.
                  For decisions that require professional guidance, consult a
                  licensed advisor.
                </p>
              </div>
            </section>

        
            <section class="mt-10" id="sources">
              <h2 class="text-xl font-semibold mb-4">Sources</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                  <li>
                    <a href="https://www.nist.gov/pml/owm/metric-si/si-units" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      NIST: The International System of Units (SI)
                    </a>
                  </li>
                  <li>
                    <a href="https://openstax.org/details/books/college-algebra" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      OpenStax: College Algebra
                    </a>
                  </li>
                </ul>
              </div>
            </section>

        





<section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Free-flow speed \(v_f\) km/h Typical freeway: 80–120 km/h (50–75 mph). Jam density \(k_j\) veh/km/lane Bumper-to-bumper density per lane (e.g., 120–180 veh/km/lane). Known variable Density \(k\)</li><li>Speed \(v\)</li><li>Flow \(q\)</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Operational notes</h2><p class="text-sm text-gray-700">Fill in realistic values and keep units and timeframes consistent.</p><p class="text-sm text-gray-700 mt-2">Key entities: Greenshields, Model, Free-flow speed \(v_f\) km/h Typical freeway: 80–120 km/h (50–75 mph). Jam density \(k_j\) veh/km/lane Bumper-to-bumper density per lane (e.g., 120–180 veh/km/lane). Known variable Density \(k\), Speed \(v\), Flow \(q\).</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Free-flow speed \(v_f\) km/h Typical freeway: 80–120 km/h (50–75 mph). Jam density \(k_j\) veh/km/lane Bumper-to-bumper density per lane (e.g., 120–180 veh/km/lane). Known variable Density \(k\)</li><li>Speed \(v\)</li><li>Flow \(q\)</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><!-- %%EEAT_STRIP%% -->
<!-- %%QUALITY_BLOCKS%% -->
<!-- %%FAQ_JSONLD%% -->
</main>
        <aside class="w-full lg:w-1/3">
          <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-3">
              Related Engineering Calculators
            </h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/reynolds-number"
                  class="text-blue-600 hover:underline"
                  >Reynolds Number</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bernoulli-equation"
                  class="text-blue-600 hover:underline"
                  >Bernoulli's Equation</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/manning-s-equation-calculator"
                  class="text-blue-600 hover:underline"
                  >Manning's Equation</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/traffic-signal-timing"
                  class="text-blue-600 hover:underline"
                  >Traffic Signal Timing</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/rational-method"
                  class="text-blue-600 hover:underline"
                  >Rational Method Runoff</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/time-of-concentration"
                  class="text-blue-600 hover:underline"
                  >Time of Concentration</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/greenshields-model"
                  class="text-blue-600 hover:underline font-medium"
                  >Traffic Flow (Greenshields Model)</a
                >
              </li>
            </ul>
          </div>

          <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">
              Popular Engineering Tools
            </h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/moment-of-inertia"
                  class="text-blue-600 hover:underline"
                  >Moment of Inertia</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/beam-deflection"
                  class="text-blue-600 hover:underline"
                  >Beam Deflection</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/ohm-s-law-calculator"
                  class="text-blue-600 hover:underline"
                  >Ohm's Law</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/hazen-williams"
                  class="text-blue-600 hover:underline"
                  >Pipe Flow (Hazen–Williams)</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/darcy-weisbach"
                  class="text-blue-600 hover:underline"
                  >Pipe Flow (Darcy–Weisbach)</a
                >
              </li>
            </ul>
          </div>
        </aside>
      </div>
    </div>
    <footer class="bg-gray-900 text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
            <p class="text-gray-400 mb-4">
              Your trusted source for free online calculators. Accurate, fast,
              and reliable calculations for every need.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Categories</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/finance"
                  class="text-gray-400 hover:text-white"
                  >Finance</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/health-fitness"
                  class="text-gray-400 hover:text-white"
                  >Health & Fitness</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/math-conversions"
                  class="text-gray-400 hover:text-white"
                  >Math & Conversions</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/lifestyle-everyday"
                  class="text-gray-400 hover:text-white"
                  >Lifestyle & Everyday</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/construction-diy"
                  class="text-gray-400 hover:text-white"
                  >Construction & DIY</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/mortgage-payment"
                  class="text-gray-400 hover:text-white"
                  >Mortgage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percentage-calculator"
                  class="text-gray-400 hover:text-white"
                  >Percentage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bmi-calculator"
                  class="text-gray-400 hover:text-white"
                  >BMI Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/auto-loan-calculator"
                  class="text-gray-400 hover:text-white"
                  >Auto Loan Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/house-affordability"
                  class="text-gray-400 hover:text-white"
                  >House Affordability</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/about"
                  class="text-gray-400 hover:text-white"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/contact"
                  class="text-gray-400 hover:text-white"
                  >Contact</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/privacy"
                  class="text-gray-400 hover:text-white"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/terms"
                  class="text-gray-400 hover:text-white"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/sitemap.xml"
                  class="text-gray-400 hover:text-white"
                  >Site Map</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>
            &copy; 2025 CalcDomain. All Rights Reserved. | Free Online
            Calculators for Everyone
          </p>
        </div>
      </div>
    </footer>

    <script src="/assets/js/mobile-menu.js"></script>
    <script src="/search.js"></script>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["\\(", "\\)"],
            ["$", "$"],
          ],
          displayMath: [
            ["$", "$"],
            ["\\[", "\\]"],
          ],
        },
        svg: { fontCache: "global" },
      };
    </script>
    <script>
  (function () {
    var loadMathJax = function () {
      if (window.__mathjaxLoading) return;
      window.__mathjaxLoading = true;
      var script = document.createElement("script");
      script.id = "MathJax-script";
      script.async = true;
      script.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js";
      document.head.appendChild(script);
    };

    var target = document.querySelector(
      ".formula-box, .mathjax, .math, .formula, [data-mathjax]"
    );

    if (!target) return;

    if ("IntersectionObserver" in window) {
      var observer = new IntersectionObserver(
        function (entries) {
          if (entries.some(function (entry) { return entry.isIntersecting; })) {
            observer.disconnect();
            loadMathJax();
          }
        },
        { rootMargin: "200px" }
      );
      observer.observe(target);
    } else {
      window.addEventListener(
        "load",
        function () {
          setTimeout(loadMathJax, 1000);
        },
        { once: true }
      );
    }
  })();
</script>

    <!-- Chart.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
      (function () {
        const unitButtons = document.querySelectorAll(".unit-toggle");
        const vfInput = document.getElementById("vf");
        const kjInput = document.getElementById("kj");
        const kInput = document.getElementById("k");
        const vInput = document.getElementById("v");
        const qInput = document.getElementById("q");

        const vfUnitSpan = document.getElementById("vf-unit");
        const kjUnitSpan = document.getElementById("kj-unit");
        const kUnitSpan = document.getElementById("k-unit");
        const vUnitSpan = document.getElementById("v-unit");
        const qUnitSpan = document.getElementById("q-unit");

        const knownTypeRadios = document.querySelectorAll(".known-type");
        const knownDensityGroup = document.getElementById(
          "known-density-group"
        );
        const knownSpeedGroup = document.getElementById("known-speed-group");
        const knownFlowGroup = document.getElementById("known-flow-group");

        const calcBtn = document.getElementById("calculate-btn");
        const resetBtn = document.getElementById("reset-btn");

        const resultsCard = document.getElementById("results-card");
        const resSpeed = document.getElementById("res-speed");
        const resDensity = document.getElementById("res-density");
        const resFlow = document.getElementById("res-flow");
        const resHeadway = document.getElementById("res-headway");
        const resKc = document.getElementById("res-kc");
        const resQmax = document.getElementById("res-qmax");
        const resVc = document.getElementById("res-vc");
        const resRelative = document.getElementById("res-relative");
        const resWarning = document.getElementById("results-warning");

        let currentUnit = "metric"; // 'metric' or 'imperial'
        let chartVK, chartQK, chartVQ;

        function setUnitSystem(unit) {
          if (unit === currentUnit) return;
          // Convert existing numeric values between systems
          const toImperialSpeed = (v) => v * 0.621371;
          const toMetricSpeed = (v) => v / 0.621371;
          const toImperialDensity = (k) => k * 1.60934;
          const toMetricDensity = (k) => k / 1.60934;
          const toImperialFlow = (q) => q * 0.621371;
          const toMetricFlow = (q) => q / 0.621371;

          let vfVal = parseFloat(vfInput.value);
          let kjVal = parseFloat(kjInput.value);
          let kVal = parseFloat(kInput.value);
          let vVal = parseFloat(vInput.value);
          let qVal = parseFloat(qInput.value);

          if (unit === "imperial") {
            if (!isNaN(vfVal))
              vfInput.value = toImperialSpeed(vfVal).toFixed(1);
            if (!isNaN(kjVal))
              kjInput.value = toImperialDensity(kjVal).toFixed(1);
            if (!isNaN(kVal)) kInput.value = toImperialDensity(kVal).toFixed(1);
            if (!isNaN(vVal)) vInput.value = toImperialSpeed(vVal).toFixed(1);
            if (!isNaN(qVal)) qInput.value = toImperialFlow(qVal).toFixed(0);

            vfUnitSpan.textContent = "mph";
            kjUnitSpan.textContent = "veh/mi/lane";
            kUnitSpan.textContent = "veh/mi/lane";
            vUnitSpan.textContent = "mph";
            qUnitSpan.textContent = "veh/h/lane";
          } else {
            if (!isNaN(vfVal)) vfInput.value = toMetricSpeed(vfVal).toFixed(1);
            if (!isNaN(kjVal))
              kjInput.value = toMetricDensity(kjVal).toFixed(1);
            if (!isNaN(kVal)) kInput.value = toMetricDensity(kVal).toFixed(1);
            if (!isNaN(vVal)) vInput.value = toMetricSpeed(vVal).toFixed(1);
            if (!isNaN(qVal)) qInput.value = toMetricFlow(qVal).toFixed(0);

            vfUnitSpan.textContent = "km/h";
            kjUnitSpan.textContent = "veh/km/lane";
            kUnitSpan.textContent = "veh/km/lane";
            vUnitSpan.textContent = "km/h";
            qUnitSpan.textContent = "veh/h/lane";
          }

          currentUnit = unit;
          unitButtons.forEach((btn) => {
            if (btn.dataset.unit === unit) {
              btn.classList.add("bg-blue-600", "text-white", "border-blue-600");
              btn.classList.remove(
                "bg-white",
                "text-gray-700",
                "border-gray-300"
              );
            } else {
              btn.classList.remove(
                "bg-blue-600",
                "text-white",
                "border-blue-600"
              );
              btn.classList.add("bg-white", "text-gray-700", "border-gray-300");
            }
          });

          if (!resultsCard.classList.contains("hidden")) {
            calculate(); // refresh results and charts
          } else {
            updateCharts();
          }
        }

        unitButtons.forEach((btn) => {
          btn.addEventListener("click", () => setUnitSystem(btn.dataset.unit));
        });

        function updateKnownTypeUI() {
          let selected = "density";
          knownTypeRadios.forEach((r) => {
            if (r.checked) selected = r.value;
          });
          knownDensityGroup.classList.toggle("hidden", selected !== "density");
          knownSpeedGroup.classList.toggle("hidden", selected !== "speed");
          knownFlowGroup.classList.toggle("hidden", selected !== "flow");
        }
        knownTypeRadios.forEach((r) =>
          r.addEventListener("change", updateKnownTypeUI)
        );

        function calculate() {
          const vf = parseFloat(vfInput.value);
          const kj = parseFloat(kjInput.value);
          if (!(vf > 0) || !(kj > 0)) {
            alert(
              "Please enter positive values for free-flow speed and jam density."
            );
            return;
          }

          let knownType = "density";
          knownTypeRadios.forEach((r) => {
            if (r.checked) knownType = r.value;
          });

          let v = NaN,
            k = NaN,
            q = NaN;
          resWarning.classList.add("hidden");
          resWarning.textContent = "";

          if (knownType === "density") {
            k = parseFloat(kInput.value);
            if (!(k >= 0)) {
              alert("Please enter a non-negative density.");
              return;
            }
            v = vf * (1 - k / kj);
            if (v < 0) {
              resWarning.textContent =
                "Warning: density exceeds jam density; the linear Greenshields model is not valid here.";
              resWarning.classList.remove("hidden");
              v = 0;
            }
            q = k * v;
          } else if (knownType === "speed") {
            v = parseFloat(vInput.value);
            if (!(v >= 0)) {
              alert("Please enter a non-negative speed.");
              return;
            }
            if (v > vf) {
              resWarning.textContent =
                "Warning: speed exceeds free-flow speed; results are extrapolated beyond the model range.";
              resWarning.classList.remove("hidden");
            }
            // v = vf (1 - k/kj) => k = kj (1 - v/vf)
            k = kj * (1 - v / vf);
            q = k * v;
          } else {
            q = parseFloat(qInput.value);
            if (!(q >= 0)) {
              alert("Please enter a non-negative flow.");
              return;
            }
            const qmax = (vf * kj) / 4;
            if (q > qmax) {
              resWarning.textContent =
                "Warning: requested flow exceeds theoretical capacity q_max; no real solution in Greenshields model.";
              resWarning.classList.remove("hidden");
              resultsCard.classList.remove("hidden");
              resSpeed.textContent = "–";
              resDensity.textContent = "–";
              resFlow.textContent = formatFlow(q);
              resHeadway.textContent = "–";
              const kc = kj / 2;
              const vc = vf / 2;
              resKc.textContent = formatDensity(kc);
              resQmax.textContent = formatFlow(qmax);
              resVc.textContent = formatSpeed(vc);
              resRelative.textContent = "q / q_max = " + (q / qmax).toFixed(2);
              updateCharts();
              return;
            }
            // Solve q = vf k (1 - k/kj) = vf(k - k^2/kj)
            // => (vf/kj) k^2 - vf k + q = 0
            const a = vf / kj;
            const b = -vf;
            const c = q;
            const disc = b * b - 4 * a * c;
            if (disc < 0) {
              resWarning.textContent =
                "No real solution for the given flow with current parameters.";
              resWarning.classList.remove("hidden");
              return;
            }
            const sqrtD = Math.sqrt(disc);
            const k1 = (-b + sqrtD) / (2 * a);
            const k2 = (-b - sqrtD) / (2 * a);
            // choose the lower-density (stable) branch by default
            k = Math.min(k1, k2);
            v = vf * (1 - k / kj);
          }

          if (k < 0) k = 0;
          if (v < 0) v = 0;
          if (q < 0) q = 0;

          const headwaySec = q > 0 ? 3600 / q : NaN;
          const kc = kj / 2;
          const vc = vf / 2;
          const qmax = (vf * kj) / 4;
          const relDensity = k / kj;

          resultsCard.classList.remove("hidden");
          resSpeed.textContent = formatSpeed(v);
          resDensity.textContent = formatDensity(k);
          resFlow.textContent = formatFlow(q);
          resHeadway.textContent = isFinite(headwaySec)
            ? headwaySec.toFixed(1) + " s/veh"
            : "–";
          resKc.textContent = formatDensity(kc);
          resQmax.textContent = formatFlow(qmax);
          resVc.textContent = formatSpeed(vc);
          resRelative.textContent = "k / k_j = " + relDensity.toFixed(2);

          updateCharts();
        }

        function formatSpeed(v) {
          return v.toFixed(1) + (currentUnit === "metric" ? " km/h" : " mph");
        }
        function formatDensity(k) {
          return (
            k.toFixed(1) +
            (currentUnit === "metric" ? " veh/km/lane" : " veh/mi/lane")
          );
        }
        function formatFlow(q) {
          return q.toFixed(0) + " veh/h/lane";
        }

        function resetForm() {
          currentUnit = "metric";
          vfInput.value = 100;
          kjInput.value = 150;
          kInput.value = 20;
          vInput.value = 80;
          qInput.value = 1500;
          vfUnitSpan.textContent = "km/h";
          kjUnitSpan.textContent = "veh/km/lane";
          kUnitSpan.textContent = "veh/km/lane";
          vUnitSpan.textContent = "km/h";
          qUnitSpan.textContent = "veh/h/lane";
          unitButtons.forEach((btn) => {
            if (btn.dataset.unit === "metric") {
              btn.classList.add("bg-blue-600", "text-white", "border-blue-600");
              btn.classList.remove(
                "bg-white",
                "text-gray-700",
                "border-gray-300"
              );
            } else {
              btn.classList.remove(
                "bg-blue-600",
                "text-white",
                "border-blue-600"
              );
              btn.classList.add("bg-white", "text-gray-700", "border-gray-300");
            }
          });
          knownTypeRadios.forEach((r) => {
            r.checked = r.value === "density";
          });
          updateKnownTypeUI();
          resultsCard.classList.add("hidden");
          resWarning.classList.add("hidden");
          resWarning.textContent = "";
          updateCharts();
        }

        calcBtn.addEventListener("click", calculate);
        resetBtn.addEventListener("click", resetForm);

        // Charts
        function createOrUpdateChart(ctx, existingChart, config) {
          if (existingChart) {
            existingChart.data = config.data;
            existingChart.options = config.options;
            existingChart.update();
            return existingChart;
          } else {
            return new Chart(ctx, config);
          }
        }

        function updateCharts() {
          const vf = parseFloat(vfInput.value);
          const kj = parseFloat(kjInput.value);
          if (!(vf > 0) || !(kj > 0)) return;

          const kc = kj / 2;
          const vc = vf / 2;
          const qmax = (vf * kj) / 4;

          const n = 50;
          const kValues = [];
          const vValues = [];
          const qValues = [];
          for (let i = 0; i <= n; i++) {
            const k = (kj * i) / n;
            const v = vf * (1 - k / kj);
            const q = k * v;
            kValues.push(k);
            vValues.push(v);
            qValues.push(q);
          }

          const densityLabel =
            currentUnit === "metric"
              ? "Density k (veh/km/lane)"
              : "Density k (veh/mi/lane)";
          const speedLabel =
            currentUnit === "metric" ? "Speed v (km/h)" : "Speed v (mph)";
          const flowLabel = "Flow q (veh/h/lane)";

          // Speed-density chart
          const ctxVK = document.getElementById("chart-vk").getContext("2d");
          chartVK = createOrUpdateChart(ctxVK, chartVK, {
            type: "line",
            data: {
              labels: kValues,
              datasets: [
                {
                  label: "v(k)",
                  data: vValues,
                  borderColor: "#2563eb",
                  backgroundColor: "rgba(37,99,235,0.1)",
                  tension: 0,
                  pointRadius: 0,
                },
                {
                  label: "Critical point",
                  data: [{ x: kc, y: vc }],
                  borderColor: "#dc2626",
                  backgroundColor: "#dc2626",
                  type: "scatter",
                  pointRadius: 4,
                  pointHoverRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: { title: { display: true, text: densityLabel } },
                y: {
                  title: { display: true, text: speedLabel },
                  beginAtZero: true,
                },
              },
              plugins: {
                legend: { display: true },
                tooltip: { mode: "nearest", intersect: false },
              },
            },
          });

          // Flow-density chart
          const ctxQK = document.getElementById("chart-qk").getContext("2d");
          chartQK = createOrUpdateChart(ctxQK, chartQK, {
            type: "line",
            data: {
              labels: kValues,
              datasets: [
                {
                  label: "q(k)",
                  data: qValues,
                  borderColor: "#16a34a",
                  backgroundColor: "rgba(22,163,74,0.1)",
                  tension: 0,
                  pointRadius: 0,
                },
                {
                  label: "Capacity",
                  data: [{ x: kc, y: qmax }],
                  borderColor: "#dc2626",
                  backgroundColor: "#dc2626",
                  type: "scatter",
                  pointRadius: 4,
                  pointHoverRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: { title: { display: true, text: densityLabel } },
                y: {
                  title: { display: true, text: flowLabel },
                  beginAtZero: true,
                },
              },
              plugins: {
                legend: { display: true },
                tooltip: { mode: "nearest", intersect: false },
              },
            },
          });

          // Speed-flow chart
          const ctxVQ = document.getElementById("chart-vq").getContext("2d");
          chartVQ = createOrUpdateChart(ctxVQ, chartVQ, {
            type: "line",
            data: {
              labels: qValues,
              datasets: [
                {
                  label: "v(q)",
                  data: vValues,
                  borderColor: "#7c3aed",
                  backgroundColor: "rgba(124,58,237,0.1)",
                  tension: 0,
                  pointRadius: 0,
                },
                {
                  label: "Capacity",
                  data: [{ x: qmax, y: vc }],
                  borderColor: "#dc2626",
                  backgroundColor: "#dc2626",
                  type: "scatter",
                  pointRadius: 4,
                  pointHoverRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: { title: { display: true, text: flowLabel } },
                y: {
                  title: { display: true, text: speedLabel },
                  beginAtZero: true,
                },
              },
              plugins: {
                legend: { display: true },
                tooltip: { mode: "nearest", intersect: false },
              },
            },
          });
        }

        // Initialize
        updateKnownTypeUI();
        updateCharts();
      })();
    </script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
<script>
  window.__cmpLoadQueued = window.__cmpLoadQueued || [];
  window.addEventListener("load", function () {
    var loadCmp = function () {
      var s1 = document.createElement("script");
      s1.src = "https://cmp.gatekeeperconsent.com/min.js";
      s1.async = true;
      s1.setAttribute("data-cfasync", "false");
      document.head.appendChild(s1);

      var s2 = document.createElement("script");
      s2.src = "https://the.gatekeeperconsent.com/cmp.min.js";
      s2.async = true;
      s2.setAttribute("data-cfasync", "false");
      document.head.appendChild(s2);
    };

    if ("requestIdleCallback" in window) {
      requestIdleCallback(loadCmp, { timeout: 2000 });
    } else {
      setTimeout(loadCmp, 1000);
    }
  });
</script>
<script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
<script>
      window.ezstandalone = window.ezstandalone || {};
      ezstandalone.cmd = ezstandalone.cmd || [];
    </script>
</body>
</html>
