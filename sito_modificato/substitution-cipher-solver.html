<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Substitution Cipher Solver â€” Simple Substitution Decoder</title>
    <meta name="description" content="Interactive substitution cipher solver. Paste ciphertext, try frequency analysis, edit the letter mapping, auto-suggest keys with hill-climb heuristic and decode messages client-side.">
    <link rel="canonical" href="https://calcdomain.com/substitution-cipher-solver">

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose { max-width: 65ch; margin-left: auto; margin-right: auto; }
        .formula-box { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 8px; padding: 1rem; overflow-x: auto; margin: 1rem 0; }
        .kbd { background:#111827;color:white;padding:2px 6px;border-radius:4px;font-size:.8rem }
        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
        textarea { min-height:140px; }
        .letter-cell { width:2.2rem; height:2.2rem; display:inline-flex; align-items:center; justify-content:center; border-radius:6px; border:1px solid #e5e7eb; background:#fff; cursor:pointer; user-select:none; }
        .letter-cell.fixed { background:#f3f4f6; }
        .letter-input { width:40px; text-align:center; border:1px solid #e5e7eb; border-radius:6px; padding:.25rem; }
        .btn { background:#2563eb; color:white; padding:.5rem .75rem; border-radius:6px; font-weight:600; }
    </style>

    <!-- Google tag (gtag.js) -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
    <script>
      (function() {

        'use strict';

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7MB5V1LZRN');
    

      })();</script>

    <meta name="google-site-verification" content="_tiTZ9ivAdtXcAS9CMnTNJ549Sg39WVqP_ZFbWgglNA">

    <script>
        (function() {

          'use strict';

        window.ezstandalone = window.ezstandalone || {};
        ezstandalone.cmd = ezstandalone.cmd || [];
    

        })();</script>

    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://calcdomain.com"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "General",
          "item": "https://calcdomain.com/categories/general"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Miscellaneous",
          "item": "https://calcdomain.com/subcategories/miscellaneous"
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is a substitution cipher?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "A substitution cipher replaces each letter of plaintext with another letter. A 'simple' substitution uses a fixed permutation of the alphabet."
          }
        },
        {
          "@type": "Question",
          "name": "Can this tool break substitution ciphers automatically?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This tool uses frequency analysis plus a heuristic hill-climbing routine to propose likely keys; success depends on ciphertext length and language content."
          }
        }
      ]
    }
  ]
}
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
.auditspine-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:600;
  border:1px solid #e5e7eb;
  background:#f8fafc;
  color:#0f172a;
}
.auditspine-badge-warn{
  background:#fff7ed;
  border-color:#fed7aa;
  color:#9a3412;
}
</style>
</head>
<body class="bg-gray-50 text-gray-800"><header id="siteHeader">
  <div class="nav container">
    <a class="brand" href="https://calcdomain.com">CalcDomain</a>
    <div class="navRight">
      <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
      <span class="pill">Categories</span>
    </div>
  </div>
</header><div class="container">
  <main style="margin:24px 0 40px;" id="mainContent">
    <h1 id="pageTitle">Substitution Cipher Solver</h1>
    <p class="sub" id="pageSub">Interactive substitution cipher solver. Paste ciphertext, try frequency analysis, edit the letter mapping, auto-suggest keys with hill-climb heuristic and decode messages client-side.</p>
    <div id="errorBox" class="alert" role="alert" aria-live="polite"></div>

    <div class="calc-hero" id="calcHero">
      <section class="card" id="inputsCard" aria-label="Calculator inputs"><button id="mobile-menu-toggle" class="md:hidden p-2" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open menu" type="button">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
          </button>
<div data-canon-btnrow="1" style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
<button id="calcBtn" type="button" class="btn">Calculate</button>

<button id="resetBtn" type="button" class="btn btnSecondary">Reset</button>
</div>
</section>
      <section class="card sticky-box" id="resultsCard" aria-label="Calculator results"></section>
    </div>

    <section class="card content-card" id="howToUse" aria-label="How to use and methodology">
      <h2>Full original guide (expanded)</h2>
    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a href="https://calcdomain.com" class="text-2xl font-bold text-blue-600">CalcDomain</a>
          <div class="hidden md:flex items-center space-x-6">
            <a href="https://calcdomain.com/search" class="text-gray-700 hover:text-blue-600 transition-colors">Advanced Search</a>
            <a href="https://calcdomain.com/#categories" class="text-gray-700 hover:text-blue-600 transition-colors">Categories</a>
          </div>
          
        </div>
      </nav>
    </header><div class="container mx-auto px-4 py-8">

      <!-- breadcrumb (generated from sitemap) -->
      <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> Â» <a href="https://calcdomain.com/categories/general" class="hover:text-blue-600">General</a> Â» <a href="https://calcdomain.com/subcategories/miscellaneous" class="hover:text-blue-600">Miscellaneous</a></nav>

      <div class="flex flex-col lg:flex-row gap-8">

        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h1 class="text-3xl font-bold mb-3">Substitution Cipher Solver</h1>
            <p class="text-gray-700 mb-4">Paste your ciphertext below and either edit the letter mapping manually or use <span class="kbd">Auto-suggest</span> to try a best-fit solution. The solver provides frequency analysis, decode preview, and a basic hill-climbing optimizer that seeks a key maximizing common English word matches.</p>

            <label class="block mb-2 font-semibold">Ciphertext</label>
            <textarea id="cipher-input" class="w-full border border-gray-300 rounded-md px-3 py-2 mono" placeholder="Paste ciphertext here...">Gsrh rh z hvxivg nvhhztv</textarea>

            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
              <button id="btn-frequency" class="btn">Frequency analysis</button>
              <button id="btn-auto" class="btn">Auto-suggest key</button>
              <button id="btn-hill" class="btn">Hill-climb refine (fast)</button>
            </div>

            <div class="mt-6">
              <h2 class="text-lg font-semibold mb-2">Letter mapping (cipher â†’ plaintext)</h2>
              <p class="text-xs text-gray-500 mb-2">Click a target letter to change mapping; use Reset to restore identity mapping or Frequency to seed mapping.</p>
              <div id="mapping-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
              <div class="mt-3 flex gap-2">
                <button id="btn-apply" class="btn">Apply mapping</button>
                <button id="btn-reset" class="px-3 py-2 border rounded-md">Reset</button>
                <button id="btn-random" class="px-3 py-2 border rounded-md">Random key</button>
                <button id="btn-copy" class="px-3 py-2 border rounded-md">Copy plaintext</button>
              </div>
            </div>

            <div class="mt-6">
              <h2 class="text-lg font-semibold mb-2">Decoded preview</h2>
              <div id="decoded-preview" class="bg-gray-50 border border-gray-200 rounded-md p-4 mono min-h-[120px]"></div>
            </div>

            <div class="mt-6 prose">
              <h2>How it works</h2>
              <p>The substitution solver supports manual mapping and two automated helpers:</p>
              <ol>
                <li><strong>Frequency seed:</strong> maps the most frequent ciphertext letters to the most frequent English letters (ETAOIN SHRDLU...), a good starting point.</li>
                <li><strong>Hill-climb refine:</strong> performs many small random swaps in the candidate key and keeps swaps that increase a simple score (number of recognized common words) â€” this heuristic often converges to readable plaintext for medium/long ciphertexts.</li>
              </ol>

              <h3>Limitations</h3>
              <p>Short ciphertext or non-standard language reduces success rate. This tool is intended for learning and quick solving â€” for hardened cryptanalysis you may want statistical models and larger corpora.</p>
            </div>

          </div>
        
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge auditspine-badge-warn">Audit: Needs review</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      <br><strong>Note:</strong> This page needs review to confirm formulas and sources.
    </div>
    <div class="auditspine-formula">
      <em>No formulas provided in audit spec.</em>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><em>No variables provided in audit spec.</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>NIST â€” Weights and measures</strong> â€” nist.gov Â· Accessed 2026-01-19<br><a href="https://www.nist.gov/pml/weights-and-measures" target="_blank" rel="nofollow noopener">https://www.nist.gov/pml/weights-and-measures</a></li>
<li><strong>FTC â€” Consumer advice</strong> â€” consumer.ftc.gov Â· Accessed 2026-01-19<br><a href="https://consumer.ftc.gov/" target="_blank" rel="nofollow noopener">https://consumer.ftc.gov/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> Â· 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verification pending</strong> Â· Last code update: 2026-01-19</div>
</section>
<!-- AUDIT_SPINE_END -->


</main>

        <aside class="w-full lg:w-1/3">
          <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">Related ciphers &amp; tools</h2>
            <ul class="space-y-2">
              <li><a href="https://calcdomain.com/atbash-cipher" class="text-blue-600 hover:underline">Atbash Cipher (encode/decode)</a></li>
              <li><a href="https://calcdomain.com/caesar-cipher" class="text-blue-600 hover:underline">Caesar Cipher</a></li>
              <li><a href="https://calcdomain.com/rot13" class="text-blue-600 hover:underline">ROT13</a></li>
              <li><a href="https://calcdomain.com/vigenere-cipher" class="text-blue-600 hover:underline">VigenÃ¨re Cipher</a></li>
              <li><a href="https://calcdomain.com/hill-cipher" class="text-blue-600 hover:underline">Hill Cipher</a></li>
            </ul>
            <p class="text-xs text-gray-500 mt-3">Links generated from sitemap (used to determine category &amp; related pages). :contentReference[oaicite:1]{index=1}</p>
          </div>

          <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-lg font-semibold mb-4">Tips</h2>
            <ul class="text-sm text-gray-700 space-y-2">
              <li>Look for short common words (the, and, of) and repeated patterns â€” these help identify mappings.</li>
              <li>Use the mapping grid to 'lock' letters you are sure about (click the padlock icon) so automated routines don't change them.</li>
              <li>For long ciphertexts the hill-climber is much more effective.</li>
            </ul>
          </div>
        </aside>

      </div>
    </div><footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                                                                                                                                                        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction &amp; DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health &amp; Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle &amp; Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math &amp; Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>Â© 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer></section>

    <section class="meta-section" id="pageMeta" aria-label="Verification, changelog, formulas, citations">
  <details id="formulaDetails">
    <summary style="cursor:pointer; font-weight:700; color:var(--text)">Formulas</summary>
    <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
      <p style="margin:0;">(Formulas preserved from original page content, if present.)</p>
    </div>
  </details>

  

  

  <div class="badge-row" id="badgeRow">
    <div class="badge" id="versionBadge">Version 0.1.0-draft</div>
  </div>

<details id="citationDetails" style="margin-top:10px;">
  <summary style="cursor:pointer; font-weight:700; color:var(--text)">Citations</summary>
  <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
    <p style="margin:0;">Add authoritative sources relevant to this calculator (standards bodies, manuals, official docs).</p>
  </div>
</details>

<details id="changelogDetails" style="margin-top:10px;">
  <summary style="cursor:pointer; font-weight:700; color:var(--text)">Changelog</summary>
  <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
    <ul style="padding-left:18px; margin:0;">
      <li>0.1.0-draft â€” 2026-01-19: Initial draft (review required).</li>
    </ul>
  </div>
</details>
</section>
  </main>
</div><footer id="siteFooter" class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
      <p>Â© 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer><script>
    (function() {

      'use strict';

    (function(){
      // Utilities
      const ALPH = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      function sanitizeLetters(s){ return (s||"").toUpperCase().replace(/[^A-Z]/g,''); }
      function countFreq(text){
        const freq = {};
        for(const c of ALPH) freq[c]=0;
        for(const ch of sanitizeLetters(text)) freq[ch] = (freq[ch]||0)+1;
        return freq;
      }
      function englishFreqOrder(){ return "ETAOINSHRDLCUMWFGYPBVKJXQZ"; }

      // DOM refs
      const cipherInput = document.getElementById('cipher-input');
      const mappingGrid = document.getElementById('mapping-grid');
      const decodedPreview = document.getElementById('decoded-preview');
      const btnFreq = document.getElementById('btn-frequency');
      const btnAuto = document.getElementById('btn-auto');
      const btnHill = document.getElementById('btn-hill');
      const btnApply = document.getElementById('btn-apply');
      const btnReset = document.getElementById('btn-reset');
      const btnRandom = document.getElementById('btn-random');
      const btnCopy = document.getElementById('btn-copy');

      // Small English dictionary for scoring (common words)
      const commonWords = ["THE","BE","TO","OF","AND","A","IN","THAT","HAVE","I","IT","FOR","NOT","ON","WITH","HE","AS","YOU","DO","AT","THIS","BUT","HIS","BY","FROM","THEY","WE","SAY","HER","SHE","OR","AN","WILL","MY","ONE","ALL","WOULD","THERE","THEIR","WHAT","SO","UP","OUT","IF","ABOUT","WHO","GET","WHICH","GO","ME"];

      // State: current key as mapping object cipher->plain (A->X means cipher 'A' maps to plaintext 'X')
      let key = {}; // object mapping 'A'..'Z' => 'A'..'Z'
      let locked = {}; // locked letters that automated routines won't change (cipher letter locked)

      // Initialize identity mapping
      function initIdentity(){
        key = {};
        locked = {};
        for(const c of ALPH) { key[c]=c; locked[c]=false; }
      }

      function renderMappingGrid(){
        mappingGrid.innerHTML = "";
        // two columns: show cipher letter and input for plaintext
        for(const c of ALPH){
          const row = document.createElement('div');
          row.className = "flex items-center gap-3";
          const cell = document.createElement('div');
          cell.className = "letter-cell";
          cell.textContent = c;
          row.appendChild(cell);

          const input = document.createElement('input');
          input.className = "letter-input mono";
          input.value = key[c] || '';
          input.maxLength = 1;
          input.dataset.cipher = c;
          input.addEventListener('input', (e)=>{
            const v = (e.target.value || "").toUpperCase().replace(/[^A-Z]/g,'').slice(0,1);
            e.target.value = v;
            key[c] = v || '';
            updateDecoded();
          });
          row.appendChild(input);

          const lockBtn = document.createElement('button');
          lockBtn.title = "Lock/Unlock letter (automated routines won't change locked mappings)";
          lockBtn.className = "px-2 py-1 border rounded-md text-sm";
          lockBtn.dataset.cipher = c;
          updateLockBtn(lockBtn, c);
          lockBtn.addEventListener('click', ()=>{
            locked[c] = !locked[c];
            updateLockBtn(lockBtn, c);
          });
          row.appendChild(lockBtn);

          mappingGrid.appendChild(row);
        }
      }
      function updateLockBtn(btn, cipher){
        btn.textContent = locked[cipher] ? "ðŸ”’" : "ðŸ”“";
      }

      function applyFrequencySeed(){
        const text = cipherInput.value;
        const freq = countFreq(text);
        // sort cipher letters by frequency desc
        const cipherSorted = Object.keys(freq).sort((a,b)=>freq[b]-freq[a]);
        const eng = englishFreqOrder();
        // map top frequent cipher letters to english frequency order
        for(let i=0;i<cipherSorted.length;i++){
          const c = cipherSorted[i];
          if(locked[c]) continue;
          key[c] = eng[i] || '';
        }
        // fill remaining unmapped with unused letters
        fillRemaining();
        renderMappingGrid(); // update inputs
        updateDecoded();
      }

      function fillRemaining(){
        // find used plaintext letters
        const used = new Set(Object.values(key).filter(Boolean));
        const unused = ALPH.split('').filter(l=>!used.has(l));
        for(const c of ALPH){
          if(!key[c] || key[c]===''){
            if(locked[c]) continue;
            key[c] = unused.shift() || '';
          }
        }
      }

      function decodeWithKey(k){
        const txt = cipherInput.value;
        let out = '';
        for(const ch of txt){
          const up = ch.toUpperCase();
          if(/[A-Z]/.test(up)){
            const mapped = (k[up] || '?');
            // preserve case
            out += (ch === up) ? mapped : mapped.toLowerCase();
          } else {
            out += ch;
          }
        }
        return out;
      }

      function updateDecoded(){
        decodedPreview.textContent = decodeWithKey(key);
        // also update inputs grid values to reflect key (in case changed programmatically)
        const inputs = mappingGrid.querySelectorAll('input.letter-input');
        inputs.forEach(inp => {
          const c = inp.dataset.cipher;
          inp.value = key[c] || '';
        });
      }

      function resetKey(){
        initIdentity();
        renderMappingGrid();
        updateDecoded();
      }

      function randomizeKey(){
        const pool = ALPH.split('');
        // shuffle
        for(let i=pool.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [pool[i], pool[j]] = [pool[j], pool[i]];
        }
        for(let i=0;i<ALPH.length;i++){
          const c = ALPH[i];
          if(locked[c]) continue;
          key[c] = pool.shift();
        }
        renderMappingGrid();
        updateDecoded();
      }

      // scoring function based on number of common words found
      function scorePlaintext(plain){
        const tokens = plain.toUpperCase().split(/[^A-Z]+/).filter(Boolean);
        let score = 0;
        for(const w of tokens){
          if(commonWords.includes(w)) score += 2;
          if(w.length>3 && commonWords.includes(w.slice(0,3))) score += 0.5;
        }
        // also penalize non-letters or many '?' placeholders
        const qCount = (plain.match(/\?/g) || []).length;
        score -= qCount*0.25;
        return score;
      }

      // hill-climb: try random swaps among unmapped/unlocked cipher->plain assignments
      function hillClimb(iterations=1000, callbackProgress){
        // working copy
        let currentKey = Object.assign({}, key);
        let currentScore = scorePlaintext(decodeWithKey(currentKey));
        const letters = ALPH.split('');
        for(let it=0; it<iterations; it++){
          // choose two cipher letters to swap their mapped plaintexts, but avoid locked ones
          const free = letters.filter(l=>!locked[l]);
          if(free.length < 2) break;
          const i = Math.floor(Math.random()*free.length);
          let j = Math.floor(Math.random()*free.length);
          while(j===i) j = Math.floor(Math.random()*free.length);
          const a = free[i], b = free[j];
          // swap plaintext mapping for a and b
          const tmp = currentKey[a]; currentKey[a] = currentKey[b]; currentKey[b] = tmp;
          const newScore = scorePlaintext(decodeWithKey(currentKey));
          if(newScore >= currentScore){
            currentScore = newScore;
            // accept swap
            // reflect to global key as improvement
            key[a] = currentKey[a];
            key[b] = currentKey[b];
            if(callbackProgress && (it % 50 === 0)) callbackProgress(it, currentScore);
          } else {
            // revert
            const tmp2 = currentKey[a]; currentKey[a] = currentKey[b]; currentKey[b] = tmp2;
          }
        }
        // final apply
        fillRemaining();
        renderMappingGrid();
        updateDecoded();
      }

      // Auto-suggest: frequency seed + short hill climb
      function autoSuggest(){
        applyFrequencySeed();
        // small local hill climb to refine
        hillClimb(600, (it, score)=>{ /* progress optional */ });
      }

      // Event handlers
      btnFreq.addEventListener('click', ()=>{ applyFrequencySeed(); });
      btnAuto.addEventListener('click', ()=>{ autoSuggest(); });
      btnHill.addEventListener('click', ()=>{ 
        // run longer hill climb but keep UI responsive
        const iterations = 2500;
        // run in small chunks to avoid blocking for very long
        const chunk = 300;
        let done = 0;
        function step(){
          if(done >= iterations){
            // finished
            return;
          }
          hillClimb(chunk);
          done += chunk;
          setTimeout(step, 20);
        }
        step();
      });
      btnApply.addEventListener('click', () => { updateDecoded(); });
      btnReset.addEventListener('click', ()=>{ resetKey(); });
      btnRandom.addEventListener('click', ()=>{ randomizeKey(); });
      btnCopy.addEventListener('click', ()=>{
        const txt = decodedPreview.textContent;
        navigator.clipboard?.writeText(txt).then(()=>alert('Plaintext copied to clipboard'), ()=>alert('Copy failed'));
      });

      // On first load
      initIdentity();
      renderMappingGrid();
      updateDecoded();

      // Seed example mapping when user pastes long input: optional behaviour handled via freq button.

      // Allow mapping grid clicks to focus inputs
      mappingGrid.addEventListener('click', (e)=>{
        const inp = e.target.closest('input.letter-input');
        if(inp) inp.focus();
      });

    })();
    

    })();</script></body></html>