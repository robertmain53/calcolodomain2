<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="canonical" href="https://calcdomain.com/molecular-formula" />
    <title>Molecular Formula Calculator (2024 Guide) | CalcDomain</title>
    <meta name="description" content="Calculate Molecular Formula Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Molecular Formula Calculator (2024 Guide) | CalcDomain" />
    <meta property="og:description" content="Calculate Molecular Formula Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />
    <meta property="og:url" content="https://calcdomain.com/molecular-formula" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Molecular Formula Calculator (2024 Guide) | CalcDomain" />
    <meta name="twitter:description" content="Calculate Molecular Formula Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />

    
    <link rel="preload" href="https://calcdomain.com/assets/tailwind.min.css" as="style">
    <link rel="stylesheet" href="https://calcdomain.com/assets/tailwind.min.css">
    <!-- Google tag (gtag.js) -->
    
    
    
    
    

    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Molecular Formula Calculator",
        "url": "https://calcdomain.com/molecular-formula",
        "description": "Interactive molecular formula calculator that determines the molecular formula from an empirical formula and molar mass or from elemental composition (% by mass), with step-by-step explanation and worked examples.",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://calcdomain.com"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Science",
              "item": "https://calcdomain.com/categories/science"
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": "Molecular Formula Calculator",
              "item": "https://calcdomain.com/molecular-formula"
            }
          ]
        },
        "mainEntity": {
          "@type": "FAQPage",
          "name": "Molecular Formula Calculator – FAQ",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "What is a molecular formula?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "A molecular formula shows the exact number of atoms of each element in a single molecule of a compound. For example, C6H12O6 tells you that one molecule contains 6 carbon, 12 hydrogen, and 6 oxygen atoms. It may be a multiple of the empirical formula, which only shows the simplest whole-number ratio of elements."
              }
            },
            {
              "@type": "Question",
              "name": "How do you find a molecular formula from an empirical formula?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "1) Determine the empirical formula and its molar mass (M_emp). 2) Divide the compound\u2019s experimental molar mass (M_exp) by M_emp to get n = M_exp / M_emp. 3) Multiply all subscripts in the empirical formula by n to get the molecular formula. n must be a whole number (within experimental error)."
              }
            },
            {
              "@type": "Question",
              "name": "Can you get a molecular formula directly from percent composition?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Yes. First convert the percent composition to an empirical formula by assuming 100 g of sample, converting each element\u2019s mass to moles, and dividing by the smallest number of moles to get whole-number ratioslar formula using n = M_exp / M_emp."
              }
            },
            {
              "@type": "Question",
              "name": "What is the difference between empirical and molecular formulas?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "The empirical formula shows the simplest whole-number ratio of elements in a compound, while the molecular formula shows the actual number of atoms of each element in a molecule. For example, the empirical formula of glucose is CH2O, but its molecular formula is C6H12O6 (a 6\u00d7 multiple). For some compounds, such as H2O or CO2, the empirical and molecular formulas are the same."
              }
            },
            {
              "@type": "Question",
              "name": "Why does the calculator ask for molar mass to get the molecular formula?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Many different molecular formulas can share the same empirical formula. For example, CH2O could represent formaldehyde (CH2O), acetic acid (C2H4O2), or glucose (C6H12O6). Knowing the compound\u2019s experimental molar mass lets you determine which multiple of the empirical formula is correct."
              }
            }
          ]
        }
      }</script>
  
    <style>
      body { margin: 0; }
      .mb-10 { margin-bottom: 2.5rem; }
      .mt-10 { margin-top: 2.5rem; }
    </style>
    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ugo Candido",
        "url": "https://www.linkedin.com/in/ugocandido92821/",
        "sameAs": ["https://www.linkedin.com/in/ugocandido92821/"],
        "email": "info@calcdomain.com",
        "description": "Ugo Candido builds calculators and educational resources to help readers make better decisions with transparent, practical models."
      }</script>
  <script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/"}, {"@type": "ListItem", "position": 2, "name": "Lifestyle & Everyday Calculators", "item": "https://calcdomain.com/categories/lifestyle-everyday"}, {"@type": "ListItem", "position": 3, "name": "Miscellaneous Calculators", "item": "https://calcdomain.com/subcategories/miscellaneous"}, {"@type": "ListItem", "position": 4, "name": "Molecular Formula Calculator", "item": "https://calcdomain.com/molecular-formula"}]}</script>
</head>
  <body class="bg-gray-50 text-gray-800">
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9476637732224939"
      crossorigin="anonymous"
    ></script>

    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a
            href="https://calcdomain.com"
            class="text-2xl font-bold text-blue-600"
            >CalcDomain</a
          >
          <div class="w-full max-w-md hidden md:block mx-8">
            <div class="relative">
              <input
                type="search"
                id="search-input"
                placeholder="Search for a calculator..."
                class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                autocomplete="off"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
              <div
                id="search-results"
                class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"
              ></div>
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a
              href="https://calcdomain.com/search"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Categories</a
            >
          </div>
          <button
            id="mobile-menu-toggle"
            class="md:hidden p-2"
            aria-controls="mobile-menu"
            aria-expanded="false"
            aria-label="Open menu"
            type="button"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
        <nav
          id="mobile-menu"
          class="md:hidden mt-4 hidden"
          aria-label="Mobile menu"
          role="navigation"
        >
          <div class="mb-4">
            <div class="relative">
              <input
                type="search"
                id="mobile-search-input"
                placeholder="Search calculators..."
                class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
            </div>
          </div>
          <div class="space-y-2">
            <a
              href="https://calcdomain.com/search"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Categories</a
            >
          </div>
        </nav>
      </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
      <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600">
  <ol class="flex flex-wrap items-center gap-1">
    <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-blue-600 hover:underline">Lifestyle &amp; Everyday Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/subcategories/miscellaneous" class="text-blue-600 hover:underline">Miscellaneous Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><span class="text-gray-800">Molecular Formula Calculator</span></li>
  </ol>
</nav>
      <div class="flex flex-col lg:flex-row gap-8">
        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <header class="mb-6">
              <h1 class="text-2xl font-bold mb-2">
                Molecular Formula Calculator
              </h1>
              <p class="text-gray-700">
                Determine the molecular formula of a compound from its empirical
                formula and molar mass, or directly from elemental composition
                (% by mass). Includes step‑by‑step working and intermediate
                results.
              </p>
            </header>

            <!-- Tabs -->
            <div class="mb-4 border-b border-gray-200">
              <nav
                class="flex flex-wrap gap-2"
                aria-label="Molecular formula modes"
              >
                <button
                  id="tab-empirical"
                  class="px-3 py-2 text-sm font-medium border-b-2 border-transparent tab-active rounded-t-md"
                  type="button"
                >
                  From empirical formula + molar mass
                </button>
                <button
                  id="tab-composition"
                  class="px-3 py-2 text-sm font-medium border-b-2 border-transparent rounded-t-md"
                  type="button"
                >
                  From percent composition
                </button>
              </nav>
            </div>

            <!-- Panel: Empirical + Molar Mass -->
            <section id="panel-empirical" aria-labelledby="tab-empirical">
              <div class="space-y-4">
                <div>
                  <label
                    for="empirical-input"
                    class="block text-sm font-medium text-gray-700 mb-1"
                  >
                    Empirical formula
                  </label>
                  <input
                    id="empirical-input"
                    type="text"
                    placeholder="e.g. CH2O, C2H5Cl"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                  <p class="text-xs text-gray-500 mt-1">
                    Use element symbols with optional integer subscripts (e.g.
                    C6H6N2O, Fe2O3). Case sensitive: use capital letters for
                    element symbols.
                  </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label
                      for="molar-mass-input"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Experimental molar mass
                      <span class="text-gray-500 text-xs">(g/mol)</span>
                    </label>
                    <input
                      id="molar-mass-input"
                      type="number"
                      step="0.01"
                      min="0"
                      placeholder="e.g. 180.16"
                      class="w-full border border-gray-300 rounded-md px-3 py-2 input-small focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </div>
                  <div>
                    <label
                      for="empirical-mass-output"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Empirical formula mass
                      <span class="text-gray-500 text-xs">(g/mol)</span>
                    </label>
                    <input
                      id="empirical-mass-output"
                      type="text"
                      readonly
                      class="w-full border border-gray-200 bg-gray-50 rounded-md px-3 py-2 text-gray-700"
                    />
                  </div>
                </div>

                <div class="flex flex-wrap gap-3 mt-2">
                  <button
                    id="btn-calc-empirical"
                    type="button"
                    class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700"
                  >
                    Calculate molecular formula
                  </button>
                  <button
                    id="btn-clear-empirical"
                    type="button"
                    class="inline-flex items-center px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200"
                  >
                    Clear
                  </button>
                </div>

                <div
                  id="empirical-error"
                  class="hidden mt-2 text-sm text-red-600"
                ></div>

                <div class="mt-4 border-t pt-4">
                  <h2 class="text-lg font-semibold mb-2">Result</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                      <span
                        class="block text-xs uppercase tracking-wide text-gray-500"
                        >Molecular formula</span
                      >
                      <div
                        id="molecular-formula-output"
                        class="mt-1 text-xl font-semibold text-blue-700 break-all"
                      >
                        –
                      </div>
                    </div>
                    <div>
                      <span
                        class="block text-xs uppercase tracking-wide text-gray-500"
                        >Scaling factor n = M<sub>exp</sub> / M<sub
                          >emp</sub
                        ></span
                      >
                      <div
                        id="scaling-factor-output"
                        class="mt-1 text-lg font-semibold text-gray-800"
                      >
                        –
                      </div>
                    </div>
                  </div>

                  <details class="mt-2">
                    <summary
                      class="cursor-pointer text-sm text-blue-700 hover:underline"
                    >
                      Show step‑by‑step working
                    </summary>
                    <div
                      id="empirical-steps"
                      class="mt-2 text-sm text-gray-800 space-y-1"
                    ></div>
                  </details>
                </div>
              </div>
            </section>

            <!-- Panel: Percent Composition -->
            <section
              id="panel-composition"
              class="hidden"
              aria-labelledby="tab-composition"
            >
              <div class="space-y-4">
                <p class="text-sm text-gray-700">
                  Enter each element and its percent by mass. The calculator
                  will determine the empirical formula and, if you also provide
                  the molar mass, the molecular formula.
                </p>

                <div class="overflow-x-auto scrollbar-thin">
                  <table
                    class="min-w-full text-sm border border-gray-200 rounded-md overflow-hidden"
                  >
                    <thead class="bg-gray-50">
                      <tr>
                        <th
                          class="px-2 py-2 text-left font-medium text-gray-700 w-32"
                        >
                          Element
                        </th>
                        <th
                          class="px-2 py-2 text-left font-medium text-gray-700 w-32"
                        >
                          % by mass
                        </th>
                        <th
                          class="px-2 py-2 text-left font-medium text-gray-700 w-32"
                        >
                          Moles
                        </th>
                        <th
                          class="px-2 py-2 text-left font-medium text-gray-700 w-32"
                        >
                          Relative
                        </th>
                        <th
                          class="px-2 py-2 text-left font-medium text-gray-700 w-24"
                        >
                          Actions
                        </th>
                      </tr>
                    </thead>
                    <tbody
                      id="composition-rows"
                      class="divide-y divide-gray-100"
                    >
                      <!-- Rows injected by JS -->
                    </tbody>
                  </table>
                </div>

                <div class="flex flex-wrap gap-3 mt-2">
                  <button
                    id="btn-add-row"
                    type="button"
                    class="inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-800 text-xs font-medium rounded-md hover:bg-gray-200"
                  >
                    + Add element
                  </button>
                  <button
                    id="btn-reset-rows"
                    type="button"
                    class="inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-800 text-xs font-medium rounded-md hover:bg-gray-200"
                  >
                    Reset table
                  </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                  <div>
                    <label
                      for="composition-molar-mass"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Experimental molar mass (optional, g/mol)
                    </label>
                    <input
                      id="composition-molar-mass"
                      type="number"
                      step="0.01"
                      min="0"
                      placeholder="e.g. 180.16"
                      class="w-full border border-gray-300 rounded-md px-3 py-2 input-small focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                    <p class="text-xs text-gray-500 mt-1">
                      If provided, the calculator will scale the empirical
                      formula to the molecular formula.
                    </p>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      Percent total
                    </label>
                    <input
                      id="percent-total"
                      type="text"
                      readonly
                      class="w-full border border-gray-200 bg-gray-50 rounded-md px-3 py-2 text-gray-700"
                    />
                    <p class="text-xs text-gray-500 mt-1">
                      Ideally, the total should be close to 100%. Small
                      deviations are tolerated.
                    </p>
                  </div>
                </div>

                <div class="flex flex-wrap gap-3 mt-2">
                  <button
                    id="btn-calc-composition"
                    type="button"
                    class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700"
                  >
                    Calculate formula
                  </button>
                  <button
                    id="btn-clear-composition"
                    type="button"
                    class="inline-flex items-center px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200"
                  >
                    Clear
                  </button>
                </div>

                <div
                  id="composition-error"
                  class="hidden mt-2 text-sm text-red-600"
                ></div>

                <div class="mt-4 border-t pt-4">
                  <h2 class="text-lg font-semibold mb-2">Result</h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                      <span
                        class="block text-xs uppercase tracking-wide text-gray-500"
                        >Empirical formula</span
                      >
                      <div
                        id="empirical-from-comp-output"
                        class="mt-1 text-lg font-semibold text-blue-700 break-all"
                      >
                        –
                      </div>
                    </div>
                    <div>
                      <span
                        class="block text-xs uppercase tracking-wide text-gray-500"
                        >Molecular formula</span
                      >
                      <div
                        id="molecular-from-comp-output"
                        class="mt-1 text-lg font-semibold text-blue-700 break-all"
                      >
                        –
                      </div>
                    </div>
                  </div>

                  <details class="mt-2">
                    <summary
                      class="cursor-pointer text-sm text-blue-700 hover:underline"
                    >
                      Show step‑by‑step working
                    </summary>
                    <div
                      id="composition-steps"
                      class="mt-2 text-sm text-gray-800 space-y-1"
                    ></div>
                  </details>
                </div>
              </div>
            </section>

            <!-- Explanatory content -->
            <section class="prose mt-8">
              <h2>How this molecular formula calculator works</h2>
              <p>
                This tool is designed to mirror how chemists determine molecular
                formulas in the lab. It supports two common workflows:
              </p>
              <ul>
                <li>
                  <strong
                    >Empirical formula + molar mass → molecular formula</strong
                  >
                </li>
                <li>
                  <strong
                    >Percent composition → empirical formula → molecular
                    formula</strong
                  >
                </li>
              </ul>

              <h3>1. From empirical formula and molar mass</h3>
              <p>
                Suppose you already know the empirical formula of a compound
                (e.g. CH<sub>2</sub>O) and you have measured its molar mass
                experimentally. The steps are:
              </p>
              <ol>
                <li>
                  Compute the empirical formula mass \(M_{\text{emp}}\) by
                  summing atomic masses.
                </li>
                <li>
                  Compute the ratio \[ n = \frac{M_{\text{exp}}}{M_{\text{emp}}}
                  \] where \(M_{\text{exp}}\) is the experimental molar mass.
                </li>
                <li>
                  Round \(n\) to the nearest whole number (within experimental
                  error).
                </li>
                <li>
                  Multiply all subscripts in the empirical formula by \(n\) to
                  get the molecular formula.
                </li>
              </ol>

              <div class="formula-box">
                <p class="font-semibold mb-1">Example</p>
                <p>
                  Empirical formula: CH<sub>2</sub>O<br />
                  Experimental molar mass: 180.16 g/mol
                </p>
                <p>
                  Empirical mass \(M_{\text{emp}} = 12.01 + 2 \times 1.008 +
                  16.00 \approx 30.03\) g/mol
                </p>
                <p>\(n = 180.16 / 30.03 \approx 6.00\)</p>
                <p>
                  Molecular formula = (CH<sub>2</sub>O)\(_6\) =
                  C<sub>6</sub>H<sub>12</sub>O<sub>6</sub>
                </p>
              </div>

              <h3>2. From percent composition</h3>
              <p>
                When you only know the mass percent of each element, you first
                determine the empirical formula:
              </p>
              <ol>
                <li>
                  Assume 100 g of sample, so the percent values become grams.
                </li>
                <li>
                  Convert each element's mass to moles: \[ n_i = \frac{m_i}{M_i}
                  \] where \(m_i\) is the mass and \(M_i\) is the atomic mass.
                </li>
                <li>
                  Divide all \(n_i\) by the smallest value to get a mole ratio.
                </li>
                <li>
                  Round to the nearest whole numbers (or simple fractions like
                  1.5, 2.5, etc., then multiply to clear fractions) to get
                  subscripts.
                </li>
                <li>That gives the <strong>empirical formula</strong>.</li>
                <li>
                  If you also know the molar mass, apply the same scaling step
                  as above to get the <strong>molecular formula</strong>.
                </li>
              </ol>

              <div class="formula-box">
                <p class="font-semibold mb-1">Example</p>
                <p>
                  A compound is 40.0% C, 6.7% H, and 53.3% O by mass. Molar mass
                  is 180 g/mol.
                </p>
                <ul>
                  <li>Assume 100 g: 40.0 g C, 6.7 g H, 53.3 g O.</li>
                  <li>
                    Moles: C = 40.0 / 12.01 ≈ 3.33; H = 6.7 / 1.008 ≈ 6.65; O =
                    53.3 / 16.00 ≈ 3.33.
                  </li>
                  <li>
                    Divide by smallest (3.33): C ≈ 1, H ≈ 2, O ≈ 1 → empirical
                    formula CH<sub>2</sub>O.
                  </li>
                  <li>
                    Empirical mass ≈ 30.03 g/mol; \(n = 180 / 30.03 ≈ 6\).
                  </li>
                  <li>
                    Molecular formula =
                    C<sub>6</sub>H<sub>12</sub>O<sub>6</sub>.
                  </li>
                </ul>
              </div>

              <h2>Empirical vs molecular formula</h2>
              <p>
                Many different compounds can share the same empirical formula.
                For example, CH<sub>2</sub>O is the empirical formula for
                formaldehyde (CH<sub>2</sub>O), acetic acid
                (C<sub>2</sub>H<sub>4</sub>O<sub>2</sub>), and glucose
                (C<sub>6</sub>H<sub>12</sub>O<sub>6</sub>). Only when you know
                the molar mass can you distinguish between these possibilities.
              </p>
              <p>
                Some compounds, such as H<sub>2</sub>O or CO<sub>2</sub>, have
                the same empirical and molecular formulas because their simplest
                ratio already matches the actual number of atoms.
              </p>

              <h2>Tips for using the calculator correctly</h2>
              <ul>
                <li>
                  Use correct element symbols (e.g. <code>Na</code>,
                  <code>Cl</code>, <code>Fe</code>, <code>Mg</code>), with
                  proper capitalization.
                </li>
                <li>
                  Subscripts are optional; if omitted, a subscript of 1 is
                  assumed (e.g. <code>CH2O</code> =
                  C<sub>1</sub>H<sub>2</sub>O<sub>1</sub>).
                </li>
                <li>
                  Percent composition does not need to sum exactly to 100%—small
                  rounding errors are acceptable.
                </li>
                <li>
                  If the scaling factor \(n\) is not close to a whole number,
                  double‑check your empirical formula and molar mass.
                </li>
              </ul>

              <h2>Educational use</h2>
              <p>
                This calculator is intended for educational and problem‑solving
                use in general chemistry, analytical chemistry, and exam
                preparation (e.g. AP, IB, MCAT). It uses standard atomic weights
                and simple rounding rules, which are appropriate for most
                classroom and textbook problems.
              </p>
            </section>
          </div>



            <section class="mt-10" id="author">
              <h2 class="text-xl font-semibold mb-4">About the author</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  <a href="https://www.linkedin.com/in/ugocandido92821/" class="text-blue-600 hover:underline" target="_blank" rel="noopener">Ugo Candido</a>
                  builds financial tools and educational resources to help
                  readers make better money decisions. He focuses on practical,
                  transparent models that reflect how lenders calculate
                  payments and total cost of ownership.
                </p>
                <p class="text-sm text-gray-700 mt-3">
                  Contact: <a href="mailto:info@calcdomain.com" class="text-blue-600 hover:underline">info@calcdomain.com</a>
                </p>
              </div>
            </section>

            <section class="mt-10" id="editorial-policy">
              <h2 class="text-xl font-semibold mb-4">Editorial policy</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  CalcDomain content is created for educational purposes and is
                  reviewed for clarity, accuracy, and transparency. We do not
                  accept paid placements that influence calculator outputs.
                  Inputs and assumptions are shown directly in the interface so
                  you can verify how results are produced.
                </p>
              </div>
            </section>

            <section class="mt-10" id="methodology">
              <h2 class="text-xl font-semibold mb-4">Methodology</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  Results use standard formulas and the values you provide.
                  Figures are estimates and may differ from lender quotes.
                  For decisions that require professional guidance, consult a
                  licensed advisor.
                </p>
              </div>
            </section>

        
            <section class="mt-10" id="sources">
              <h2 class="text-xl font-semibold mb-4">Sources</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                  <li>
                    <a href="https://www.nist.gov/pml/owm/metric-si/si-units" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      NIST: The International System of Units (SI)
                    </a>
                  </li>
                  <li>
                    <a href="https://openstax.org/details/books/college-algebra" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      OpenStax: College Algebra
                    </a>
                  </li>
                </ul>
              </div>
            </section>

        





<section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Empirical formula</li><li>Experimental molar mass (g/mol)</li><li>Empirical formula mass (g/mol)</li><li>Experimental molar mass (optional, g/mol)</li><li>Percent total</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Operational notes</h2><p class="text-sm text-gray-700">Fill in realistic values and keep units and timeframes consistent.</p><p class="text-sm text-gray-700 mt-2">Key entities: Molecular, Formula, Empirical formula, Experimental molar mass (g/mol), Empirical formula mass (g/mol), Experimental molar mass (optional, g/mol), Percent total.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Empirical formula</li><li>Experimental molar mass (g/mol)</li><li>Empirical formula mass (g/mol)</li><li>Experimental molar mass (optional, g/mol)</li><li>Percent total</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><!-- %%EEAT_STRIP%% -->
<!-- %%QUALITY_BLOCKS%% -->
<!-- %%FAQ_JSONLD%% -->
</main>
        <aside class="w-full lg:w-1/3">
          <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-3">Related Science Tools</h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/molar-mass"
                  class="text-blue-600 hover:underline"
                  >Molar Mass Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/molarity"
                  class="text-blue-600 hover:underline"
                  >Molarity Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percent-composition"
                  class="text-blue-600 hover:underline"
                  >Percent Composition</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/stoichiometry"
                  class="text-blue-600 hover:underline"
                  >Stoichiometry Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/empirical-formula"
                  class="text-blue-600 hover:underline"
                  >Empirical Formula Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/limiting-reactant"
                  class="text-blue-600 hover:underline"
                  >Limiting Reactant</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percent-yield"
                  class="text-blue-600 hover:underline"
                  >Percent Yield</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/ideal-gas-law"
                  class="text-blue-600 hover:underline"
                  >Ideal Gas Law</a
                >
              </li>
            </ul>
          </div>
          <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">
              More Chemistry Calculators
            </h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/chemical-equation-balancer"
                  class="text-blue-600 hover:underline"
                  >Chemical Equation Balancer</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/empirical-formula"
                  class="text-blue-600 hover:underline"
                  >Empirical Formula</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/beer-lambert-law"
                  class="text-blue-600 hover:underline"
                  >Beer–Lambert Law</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/henderson-hasselbalch"
                  class="text-blue-600 hover:underline"
                  >Henderson–Hasselbalch</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/nernst-equation"
                  class="text-blue-600 hover:underline"
                  >Nernst Equation</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/molarity"
                  class="text-blue-600 hover:underline"
                  >Solution Molarity</a
                >
              </li>
            </ul>
          </div>
        </aside>
      </div>
    </div>
    <footer class="bg-gray-900 text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
            <p class="text-gray-400 mb-4">
              Your trusted source for free online calculators. Accurate, fast,
              and reliable calculations for every need.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Categories</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/finance"
                  class="text-gray-400 hover:text-white"
                  >Finance</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/health-fitness"
                  class="text-gray-400 hover:text-white"
                  >Health & Fitness</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/math-conversions"
                  class="text-gray-400 hover:text-white"
                  >Math & Conversions</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/lifestyle-everyday"
                  class="text-gray-400 hover:text-white"
                  >Lifestyle & Everyday</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/construction-diy"
                  class="text-gray-400 hover:text-white"
                  >Construction & DIY</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/mortgage-payment"
                  class="text-gray-400 hover:text-white"
                  >Mortgage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percentage-calculator"
                  class="text-gray-400 hover:text-white"
                  >Percentage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bmi-calculator"
                  class="text-gray-400 hover:text-white"
                  >BMI Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/auto-loan-calculator"
                  class="text-gray-400 hover:text-white"
                  >Auto Loan Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/house-affordability"
                  class="text-gray-400 hover:text-white"
                  >House Affordability</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/about"
                  class="text-gray-400 hover:text-white"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/contact"
                  class="text-gray-400 hover:text-white"
                  >Contact</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/privacy"
                  class="text-gray-400 hover:text-white"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/terms"
                  class="text-gray-400 hover:text-white"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/sitemap.xml"
                  class="text-gray-400 hover:text-white"
                  >Site Map</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>
            &copy; 2025 CalcDomain. All Rights Reserved. | Free Online
            Calculators for Everyone
          </p>
        </div>
      </div>
    </footer>

    <script src="/assets/js/mobile-menu.js"></script>
    <script src="/search.js"></script>

    <script>
      // --- Atomic weights (IUPAC average atomic masses, 2–3 sig figs) ---
      const ATOMIC_WEIGHTS = {
        H: 1.008,
        He: 4.0026,
        Li: 6.94,
        Be: 9.0122,
        B: 10.81,
        C: 12.01,
        N: 14.01,
        O: 16.0,
        F: 19.0,
        Ne: 20.18,
        Na: 22.99,
        Mg: 24.31,
        Al: 26.98,
        Si: 28.09,
        P: 30.97,
        S: 32.06,
        Cl: 35.45,
        Ar: 39.95,
        K: 39.1,
        Ca: 40.08,
        Sc: 44.96,
        Ti: 47.87,
        V: 50.94,
        Cr: 52.0,
        Mn: 54.94,
        Fe: 55.85,
        Co: 58.93,
        Ni: 58.69,
        Cu: 63.55,
        Zn: 65.38,
        Ga: 69.72,
        Ge: 72.63,
        As: 74.92,
        Se: 78.97,
        Br: 79.9,
        Kr: 83.8,
        Rb: 85.47,
        Sr: 87.62,
        Y: 88.91,
        Zr: 91.22,
        Nb: 92.91,
        Mo: 95.95,
        Tc: 98,
        Ru: 101.07,
        Rh: 102.91,
        Pd: 106.42,
        Ag: 107.87,
        Cd: 112.41,
        In: 114.82,
        Sn: 118.71,
        Sb: 121.76,
        Te: 127.6,
        I: 126.9,
        Xe: 131.29,
        Cs: 132.91,
        Ba: 137.33,
        La: 138.91,
        Ce: 140.12,
        Pr: 140.91,
        Nd: 144.24,
        Sm: 150.36,
        Eu: 151.96,
        Gd: 157.25,
        Tb: 158.93,
        Dy: 162.5,
        Ho: 164.93,
        Er: 167.26,
        Tm: 168.93,
        Yb: 173.05,
        Lu: 174.97,
        Hf: 178.49,
        Ta: 180.95,
        W: 183.84,
        Re: 186.21,
        Os: 190.23,
        Ir: 192.22,
        Pt: 195.08,
        Au: 196.97,
        Hg: 200.59,
        Tl: 204.38,
        Pb: 207.2,
        Bi: 208.98,
        Po: 209,
        At: 210,
        Rn: 222,
        Fr: 223,
        Ra: 226,
        Ac: 227,
        Th: 232.04,
        Pa: 231.04,
        U: 238.03,
      };

      // --- Utility functions ---
      function parseFormula(formula) {
        if (!formula || typeof formula !== "string") {
          throw new Error("Please enter an empirical formula.");
        }
        const cleaned = formula.replace(/\s+/g, "");
        if (!/^[A-Za-z0-9]+$/.test(cleaned)) {
          throw new Error(
            "Formula may only contain letters and digits (no parentheses or charges)."
          );
        }
        const tokens = [];
        let i = 0;
        while (i < cleaned.length) {
          const ch = cleaned[i];
          if (!/[A-Za-z]/.test(ch)) {
            throw new Error(
              "Each element must start with a letter (e.g. C, H, O, Na)."
            );
          }
          let symbol = ch;
          i++;
          if (i < cleaned.length && /[a-z]/.test(cleaned[i])) {
            symbol += cleaned[i];
            i++;
          }
          if (!ATOMIC_WEIGHTS.hasOwnProperty(symbol)) {
            throw new Error(`Unknown element symbol "${symbol}".`);
          }
          let numStr = "";
          while (i < cleaned.length && /[0-9]/.test(cleaned[i])) {
            numStr += cleaned[i];
            i++;
          }
          const count = numStr ? parseInt(numStr, 10) : 1;
          if (!Number.isFinite(count) || count <= 0) {
            throw new Error(`Invalid subscript for element "${symbol}".`);
          }
          tokens.push({ element: symbol, count });
        }
        const composition = {};
        for (const t of tokens) {
          composition[t.element] = (composition[t.element] || 0) + t.count;
        }
        return composition;
      }

      function compositionToFormula(composition) {
        const elements = Object.keys(composition).sort((a, b) => {
          if (a === "C") return -1;
          if (b === "C") return 1;
          if (a === "H" && b !== "C") return -1;
          if (b === "H" && a !== "C") return 1;
          return a.localeCompare(b);
        });
        return elements
          .map((el) => {
            const n = composition[el];
            return el + (n === 1 ? "" : n.toString());
          })
          .join("");
      }

      function empiricalMass(composition) {
        let mass = 0;
        for (const [el, n] of Object.entries(composition)) {
          const aw = ATOMIC_WEIGHTS[el];
          if (!aw)
            throw new Error(`Missing atomic weight for element "${el}".`);
          mass += aw * n;
        }
        return mass;
      }

      function gcd(a, b) {
        a = Math.abs(a);
        b = Math.abs(b);
        while (b > 1e-8) {
          const t = b;
          b = a % b;
          a = t;
        }
        return a;
      }

      function simplifyIntegerRatios(values, tolerance = 1e-2) {
        const scaled = values.slice();
        const minVal = Math.min(...scaled.filter((v) => v > 0));
        if (!isFinite(minVal) || minVal <= 0) {
          throw new Error("All mole amounts must be positive.");
        }
        for (let i = 0; i < scaled.length; i++) {
          scaled[i] / minVal;
        }
        const candidates = [1, 2, 3, 4, 5, 6, 8, 10];
        let bestFactor = 1;
        let bestError = Infinity;
        for (const f of candidates) {
          let err = 0;
          for (const v of scaled) {
            const r = v * f;
            err += Math.abs(r - Math.round(r));
          }
          if (err < bestError) {
            bestError = err;
            bestFactor = f;
          }
        }
        const ints = scaled.map((v) => Math.round(v * bestFactor));
        const back = ints.map((v) => v / bestFactor);
        let maxRelErr = 0;
        for (let i = 0; i < scaled.length; i++) {
          const rel = Math.abs(back[i] - scaled[i]) / scaled[i];
          if (rel > maxRelErr) maxRelErr = rel;
        }
        if (maxRelErr > tolerance) {
          throw new Error(
            "Could not convert mole ratios to simple whole numbers. Check your input."
          );
        }
        let g = ints[0];
        for (let i = 1; i < ints.length; i++) {
          g = gcd(g, ints[i]);
        }
        return ints.map((v) => v / g);
      }

      // --- Tab switching ---
      const tabEmpirical = document.getElementById("tab-empirical");
      const tabComposition = document.getElementById("tab-composition");
      const panelEmpirical = document.getElementById("panel-empirical");
      const panelComposition = document.getElementById("panel-composition");

      function activateTab(tab) {
        if (tab === "empirical") {
          tabEmpirical.classList.add("tab-active");
          tabComposition.classList.remove("tab-active");
          panelEmpirical.classList.remove("hidden");
          panelComposition.classList.add("hidden");
        } else {
          tabComposition.classList.add("tab-active");
          tabEmpirical.classList.remove("tab-active");
          panelComposition.classList.remove("hidden");
          panelEmpirical.classList.add("hidden");
        }
      }

      tabEmpirical.addEventListener("click", () => activateTab("empirical"));
      tabComposition.addEventListener("click", () =>
        activateTab("composition")
      );

      // --- Empirical + molar mass mode ---
      const empiricalInput = document.getElementById("empirical-input");
      const molarMassInput = document.getElementById("molar-mass-input");
      const empiricalMassOutput = document.getElementById(
        "empirical-mass-output"
      );
      const molecularFormulaOutput = document.getElementById(
        "molecular-formula-output"
      );
      const scalingFactorOutput = document.getElementById(
        "scaling-factor-output"
      );
      const empiricalError = document.getElementById("empirical-error");
      const empiricalSteps = document.getElementById("empirical-steps");

      document
        .getElementById("btn-calc-empirical")
        .addEventListener("click", () => {
          empiricalError.classList.add("hidden");
          empiricalError.textContent = "";
          empiricalSteps.innerHTML = "";
          molecularFormulaOutput.textContent = "–";
          scalingFactorOutput.textContent = "–";
          empiricalMassOutput.value = "";

          try {
            const formula = empiricalInput.value.trim();
            const Mexp = parseFloat(molarMassInput.value);
            if (!formula) throw new Error("Please enter an empirical formula.");
            if (!Number.isFinite(Mexp) || Mexp <= 0) {
              throw new Error(
                "Please enter a positive experimental molar mass."
              );
            }
            const comp = parseFormula(formula);
            const Memp = empiricalMass(comp);
            empiricalMassOutput.value = Memp.toFixed(3);

            const nRaw = Mexp / Memp;
            const nRounded = Math.round(nRaw);
            if (Math.abs(nRaw - nRounded) > 0.05) {
              throw new Error(
                `The ratio M_exp / M_emp = ${nRaw.toFixed(
                  3
                )} is not close to a whole number. Check your empirical formula and molar mass.`
              );
            }
            const n = nRounded;
            const molecularComp = {};
            for (const [el, count] of Object.entries(comp)) {
              molecularComp[el] = count * n;
            }
            const molecularFormula = compositionToFormula(molecularComp);
            molecularFormulaOutput.textContent = molecularFormula;
            scalingFactorOutput.textContent = `${n} (from ${nRaw.toFixed(3)})`;

            const steps = [];
            steps.push(
              `1. Parsed empirical formula as: ${compositionToFormula(comp)}`
            );
            const massTerms = Object.entries(comp).map(
              ([el, c]) => `${c} × ${ATOMIC_WEIGHTS[el].toFixed(3)} (${el})`
            );
            steps.push(
              `2. Empirical formula mass M_emp = ${massTerms.join(
                " + "
              )} = ${Memp.toFixed(3)} g/mol`
            );
            steps.push(
              `3. Experimental molar mass M_exp = ${Mexp.toFixed(3)} g/mol`
            );
            steps.push(
              `4. Ratio n = M_exp / M_emp = ${Mexp.toFixed(3)} / ${Memp.toFixed(
                3
              )} = ${nRaw.toFixed(3)} ≈ ${n}`
            );
            steps.push(
              `5. Molecular formula = (empirical formula) × n = (${compositionToFormula(
                comp
              )}) × ${n} = ${molecularFormula}`
            );
            empiricalSteps.innerHTML = steps.map((s) => `<p>${s}</p>`).join("");
          } catch (err) {
            empiricalError.textContent = err.message;
            empiricalError.classList.remove("hidden");
          }
        });

      document
        .getElementById("btn-clear-empirical")
        .addEventListener("click", () => {
          empiricalInput.value = "";
          molarMassInput.value = "";
          empiricalMassOutput.value = "";
          molecularFormulaOutput.textContent = "–";
          scalingFactorOutput.textContent = "–";
          empiricalSteps.innerHTML = "";
          empiricalError.textContent = "";
          empiricalError.classList.add("hidden");
        });

      // --- Percent composition mode ---
      const compositionTbody = document.getElementById("composition-rows");
      const percentTotalInput = document.getElementById("percent-total");
      const compositionError = document.getElementById("composition-error");
      const empiricalFromCompOutput = document.getElementById(
        "empirical-from-comp-output"
      );
      const molecularFromCompOutput = document.getElementById(
        "molecular-from-comp-output"
      );
      const compositionSteps = document.getElementById("composition-steps");
      const compositionMolarMassInput = document.getElementById(
        "composition-molar-mass"
      );

      function addCompositionRow(element = "", percent = "") {
        const tr = document.createElement("tr");

        const tdEl = document.createElement("td");
        tdEl.className = "px-2 py-1.5";
        const elInput = document.createElement("input");
        elInput.type = "text";
        elInput.value = element;
        elInput.placeholder = "e.g. C";
        elInput.className =
          "w-full border border-gray-300 rounded px-2 py-1 text-sm";
        tdEl.appendChild(elInput);

        const tdPct = document.createElement("td");
        tdPct.className = "px-2 py-1.5";
        const pctInput = document.createElement("input");
        pctInput.type = "number";
        pctInput.step = "0.01";
        pctInput.min = "0";
        pctInput.value = percent;
        pctInput.placeholder = "e.g. 40.0";
        pctInput.className =
          "w-full border border-gray-300 rounded px-2 py-1 text-sm input-small";
        tdPct.appendChild(pctInput);

        const tdMoles = document.createElement("td");
        tdMoles.className = "px-2 py-1.5 text-gray-700";
        const molesSpan = document.createElement("span");
        molesSpan.textContent = "–";
        tdMoles.appendChild(molesSpan);

        const tdRel = document.createElement("td");
        tdRel.className = "px-2 py-1.5 text-gray-700";
        const relSpan = document.createElement("span");
        relSpan.textContent = "–";
        tdRel.appendChild(relSpan);

        const tdActions = document.createElement("td");
        tdActions.className = "px-2 py-1.5";
        const delBtn = document.createElement("button");
        delBtn.type = "button";
        delBtn.textContent = "Remove";
        delBtn.className = "text-xs text-red-600 hover:underline";
        delBtn.addEventListener("click", () => {
          tr.remove();
          updatePercentTotal();
        });
        tdActions.appendChild(delBtn);

        tr.appendChild(tdEl);
        tr.appendChild(tdPct);
        tr.appendChild(tdMoles);
        tr.appendChild(tdRel);
        tr.appendChild(tdActions);

        compositionTbody.appendChild(tr);

        pctInput.addEventListener("input", updatePercentTotal);
      }

      function updatePercentTotal() {
        let total = 0;
        const rows = compositionTbody.querySelectorAll("tr");
        rows.forEach((row) => {
          const pctInput = row.querySelector("td:nth-child(2) input");
          const v = parseFloat(pctInput.value);
          if (Number.isFinite(v) && v >= 0) total += v;
        });
        percentTotalInput.value = total ? total.toFixed(2) + " %" : "";
      }

      function resetCompositionTable() {
        compositionTbody.innerHTML = "";
        addCompositionRow("C", "");
        addCompositionRow("H", "");
        addCompositionRow("O", "");
        updatePercentTotal();
      }

      document
        .getElementById("btn-add-row")
        .addEventListener("click", () => addCompositionRow());
      document
        .getElementById("btn-reset-rows")
        .addEventListener("click", resetCompositionTable);

      document
        .getElementById("btn-calc-composition")
        .addEventListener("click", () => {
          compositionError.classList.add("hidden");
          compositionError.textContent = "";
          compositionSteps.innerHTML = "";
          empiricalFromCompOutput.textContent = "–";
          molecularFromCompOutput.textContent = "–";

          const rows = Array.from(compositionTbody.querySelectorAll("tr"));
          if (rows.length === 0) {
            compositionError.textContent =
              "Please add at least one element row.";
            compositionError.classList.remove("hidden");
            return;
          }

          try {
            const elements = [];
            const percents = [];
            rows.forEach((row) => {
              const elInput = row.querySelector("td:nth-child(1) input");
              const pctInput = row.querySelector("td:nth-child(2) input");
              const el = elInput.value.trim();
              const pct = parseFloat(pctInput.value);
              if (!el && !pctInput.value) return;
              if (!el)
                throw new Error(
                  "Each non-empty percent row must have an element symbol."
                );
              if (!ATOMIC_WEIGHTS.hasOwnProperty(el)) {
                throw new Error(`Unknown element symbol "${el}".`);
              }
              if (!Number.isFinite(pct) || pct <= 0) {
                throw new Error(
                  `Percent for element "${el}" must be a positive number.`
                );
              }
              elements.push(el);
              percents.push(pct);
            });

            if (elements.length === 0) {
              throw new Error(
                "Please enter at least one element with a positive percent."
              );
            }

            const totalPct = percents.reduce((a, b) => a + b, 0);
            if (totalPct < 99 || totalPct > 101) {
              // Not fatal, but warn in steps instead of throwing
            }

            const moles = percents.map((pct, i) => {
              const mass = pct;
              const aw = ATOMIC_WEIGHTS[elements[i]];
              return mass / aw;
            });

            const minMoles = Math.min(...moles);
            if (!isFinite(minMoles) || minMoles <= 0) {
              throw new Error("All mole amounts must be positive.");
            }

            const rel = moles.map((n) => n / minMoles);
            const subscripts = simplifyIntegerRatios(rel);

            const empiricalComp = {};
            elements.forEach((el, i) => {
              empiricalComp[el] = (empiricalComp[el] || 0) + subscripts[i];
            });
            const empiricalFormula = compositionToFormula(empiricalComp);
            empiricalFromCompOutput.textContent = empiricalFormula;

            // Update table with moles and relative values
            rows.forEach((row, idx) => {
              const elInput = row.querySelector("td:nth-child(1) input");
              const pctInput = row.querySelector("td:nth-child(2) input");
              const el = elInput.value.trim();
              const pct = parseFloat(pctInput.value);
              const molesCell = row.querySelector("td:nth-child(3) span");
              const relCell = row.querySelector("td:nth-child(4) span");
              const indexInList = elements.indexOf(el);
              if (indexInList !== -1) {
                molesCell.textContent = moles[indexInList].toFixed(3);
                relCell.textContent =
                  rel[indexInList].toFixed(3) + " → " + subscripts[indexInList];
              } else {
                molesCell.textContent = "–";
                relCell.textContent = "–";
              }
            });

            const steps = [];
            steps.push(
              `1. Assumed 100 g sample, so percent values become grams (m_i).`
            );
            steps.push(
              `2. Converted each element's mass to moles: n_i = m_i / M_i (atomic mass).`
            );
            steps.push(
              `3. Divided all n_i by the smallest to get mole ratios, then converted to simple whole numbers to obtain the empirical formula: ${empiricalFormula}.`
            );

            const Mexp = parseFloat(compositionMolarMassInput.value);
            if (Number.isFinite(Mexp) && Mexp > 0) {
              const Memp = empiricalMass(empiricalComp);
              const nRaw = Mexp / Memp;
              const nRounded = Math.round(nRaw);
              if (Math.abs(nRaw - nRounded) > 0.05) {
                steps.push(
                  `4. Experimental molar mass M_exp = ${Mexp.toFixed(
                    3
                  )} g/mol, empirical mass M_emp = ${Memp.toFixed(3)} g/mol.`
                );
                steps.push(
                  `   The ratio n = M_exp / M_emp = ${nRaw.toFixed(
                    3
                  )} is not close to a whole number, so a unique molecular formula cannot be assigned.`
                );
                molecularFromCompOutput.textContent = "–";
              } else {
                const n = nRounded;
                const molecularComp = {};
                for (const [el, count] of Object.entries(empiricalComp)) {
                  molecularComp[el] = count * n;
                }
                const molecularFormula = compositionToFormula(molecularComp);
                molecularFromCompOutput.textContent = molecularFormula;
                steps.push(
                  `4. Experimental molar mass M_exp = ${Mexp.toFixed(
                    3
                  )} g/mol, empirical mass M_emp = ${Memp.toFixed(3)} g/mol.`
                );
                steps.push(
                  `   Ratio n = M_exp / M_emp = ${nRaw.toFixed(3)} ≈ ${n}.`
                );
                steps.push(
                  `5. Molecular formula = (empirical formula) × n = (${empiricalFormula}) × ${n} = ${molecularFormula}.`
                );
              }
            } else {
              steps.push(
                `4. No molar mass provided, so only the empirical formula can be determined. To obtain the molecular formula, supply the compound's experimental molar mass.`
              );
            }

            if (totalPct < 99 || totalPct > 101) {
              steps.unshift(
                `Note: The total percent is ${totalPct.toFixed(
                  2
                )}%, which deviates from 100%. This may be due to rounding in the data.`
              );
            }

            compositionSteps.innerHTML = steps
              .map((s) => `<p>${s}</p>`)
              .join("");
          } catch (err) {
            compositionError.textContent = err.message;
            compositionError.classList.remove("hidden");
          }
        });

      document
        .getElementById("btn-clear-composition")
        .addEventListener("click", () => {
          resetCompositionTable();
          compositionMolarMassInput.value = "";
          percentTotalInput.value = "";
          compositionError.textContent = "";
          compositionError.classList.add("hidden");
          empiricalFromCompOutput.textContent = "–";
          molecularFromCompOutput.textContent = "–";
          compositionSteps.innerHTML = "";
        });

      // Initialize composition table on load
      resetCompositionTable();

      window.MathJax = {
        tex: {
          inlineMath: [
            ["\\(", "\\)"],
            ["$", "$"],
          ],
          displayMath: [
            ["$", "$"],
            ["\\[", "\\]"],
          ],
        },
        svg: { fontCache: "global" },
      };
    </script>
    <script>
  (function () {
    var loadMathJax = function () {
      if (window.__mathjaxLoading) return;
      window.__mathjaxLoading = true;
      var script = document.createElement("script");
      script.id = "MathJax-script";
      script.async = true;
      script.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js";
      document.head.appendChild(script);
    };

    var target = document.querySelector(
      ".formula-box, .mathjax, .math, .formula, [data-mathjax]"
    );

    if (!target) return;

    if ("IntersectionObserver" in window) {
      var observer = new IntersectionObserver(
        function (entries) {
          if (entries.some(function (entry) { return entry.isIntersecting; })) {
            observer.disconnect();
            loadMathJax();
          }
        },
        { rootMargin: "200px" }
      );
      observer.observe(target);
    } else {
      window.addEventListener(
        "load",
        function () {
          setTimeout(loadMathJax, 1000);
        },
        { once: true }
      );
    }
  })();
</script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
<script>
  window.__cmpLoadQueued = window.__cmpLoadQueued || [];
  window.addEventListener("load", function () {
    var loadCmp = function () {
      var s1 = document.createElement("script");
      s1.src = "https://cmp.gatekeeperconsent.com/min.js";
      s1.async = true;
      s1.setAttribute("data-cfasync", "false");
      document.head.appendChild(s1);

      var s2 = document.createElement("script");
      s2.src = "https://the.gatekeeperconsent.com/cmp.min.js";
      s2.async = true;
      s2.setAttribute("data-cfasync", "false");
      document.head.appendChild(s2);
    };

    if ("requestIdleCallback" in window) {
      requestIdleCallback(loadCmp, { timeout: 2000 });
    } else {
      setTimeout(loadCmp, 1000);
    }
  });
</script>
<script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
<script>
      window.ezstandalone = window.ezstandalone || {};
      ezstandalone.cmd = ezstandalone.cmd || [];
    </script>
</body>
</html>
