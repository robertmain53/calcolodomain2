<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bandwidth Calculator — Estimate Internet Speed Needs &amp; File Transfer Time</title>
  <meta name="description" content="Professional bandwidth calculator: estimate household or office internet speed needs by activities and users, plus compute file transfer time with protocol overhead and efficiency. Includes formulas, glossary, and FAQs.">
  <link rel="canonical" href="https://calcdomain.com/bandwidth-calculator">

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <script src="https://cdn.tailwindcss.com" defer=""></script>

  <script>
    (function() {
      'use strict';
      window.MathJax = {
        tex: { inlineMath: [['\\(', '\\)'], ['$', '$']] },
        svg: { fontCache: 'global' }
      };
    })();
  </script>
  <script async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e5e7eb;
      --primary:#2563eb;
      --primary2:#1d4ed8;
      --shadow:0 10px 25px rgba(2,6,23,.08);
      --radius:14px;
      --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,"Apple Color Emoji","Segoe UI Emoji";
      --surface-subtle:#f8fafc;
      --danger:#b91c1c;
      --dangerBg:#fef2f2;
      --ok:#15803d;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:var(--bg);
      line-height:1.6;
    }
    a{ color:var(--primary); text-decoration:none; }
    a:hover{text-decoration:underline;}
    .container{ max-width:1120px; margin:0 auto; padding:18px; }
    header{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,.92);
      backdrop-filter:blur(8px);
      border-bottom:1px solid var(--line);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding:12px 18px;
    }
    .brand{ font-weight:800; letter-spacing:.2px; font-size:20px; color:var(--text); }
    .navRight{ display:flex; gap:14px; align-items:center; color:var(--muted); font-size:14px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line); background:#fff;
      padding:8px 10px; border-radius:999px; font-size:13px;
    }

    .calc-hero{
      display:grid;
      grid-template-columns:1.2fr 1fr;
      gap:24px;
      margin-top:24px;
      align-items:start;
    }
    @media (max-width:900px){ .calc-hero{ grid-template-columns:1fr; } }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:24px;
    }

    h1{ margin:0 0 8px; font-size:28px; line-height:1.2; }
    .sub{ margin:0 0 20px; color:var(--muted); font-size:15px; }
    .sectionTitle{
      font-weight:800; margin:0 0 12px;
      font-size:15px; text-transform:uppercase; letter-spacing:.5px; color:var(--muted);
    }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
    @media (max-width:500px){ .grid2{ grid-template-columns:1fr; } }
    label{ display:block; font-size:13px; font-weight:600; color:var(--muted); margin:0 0 6px; }
    input, select{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:10px;
      background:#fff;
      font-size:15px;
      outline:none;
      transition:border-color .2s;
    }
    input:focus, select:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(37,99,235,0.15);
    }
    .sticky-box{ position:sticky; top:90px; }
    .totalBox{
      text-align:center;
      padding-bottom:20px;
      border-bottom:1px solid var(--line);
      margin-bottom:16px;
    }
    .totalBox .t{ color:var(--muted); font-size:13px; font-weight:700; text-transform:uppercase; letter-spacing:.5px; }
    .totalBox .v{ font-size:32px; font-weight:900; margin-top:4px; color:var(--text); }
    .kpi{ display:flex; justify-content:space-between; margin-bottom:10px; font-size:14px; }
    .kpi span:first-child{ color:var(--muted); }
    .kpi span:last-child{ font-weight:700; color:var(--text); }
    .btn{
      display:block; width:100%;
      border:none; background:var(--primary); color:#fff;
      padding:12px; border-radius:10px;
      cursor:pointer; font-weight:700; font-size:15px;
      text-align:center; margin-top:10px;
    }
    .btn:hover{ background:var(--primary2); text-decoration:none; }
    .btnSecondary{ background:#fff; border:1px solid var(--line); color:var(--text); }
    .btnSecondary:hover{ background:#f8fafc; }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .alert{
      display:none;
      padding:12px;
      margin-bottom:20px;
      background:var(--dangerBg);
      border-left:4px solid var(--danger);
      color:#7f1d1d;
      border-radius:6px;
      font-size:14px;
    }
    .activity-table{
      width:100%;
      border-collapse:collapse;
      margin-bottom:16px;
    }
    .activity-table th, .activity-table td{
      border-bottom:1px solid var(--line);
      padding:10px;
      text-align:left;
      font-size:14px;
    }
    .activity-table th{
      background:var(--surface-subtle);
      text-transform:uppercase;
      letter-spacing:.5px;
      font-size:12px;
      color:var(--muted);
    }
    .activity-table input{
      font-size:14px;
      border-radius:8px;
      border:1px solid var(--line);
      padding:6px 8px;
    }
    .row-controls{
      display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px;
    }
    .row-controls button{
      flex:1 1 180px;
      border-radius:10px;
      padding:10px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:600;
      cursor:pointer;
      transition:background .2s;
    }
    .row-controls button:hover{ background:#f8fafc; }
    .assumption-list{ margin:0; padding-left:18px; color:var(--text); }
    .assumption-list li{ margin-bottom:6px; }
    pre{ white-space:pre-wrap; background:var(--surface-subtle); padding:12px; border-radius:10px; border:1px solid var(--line); font-size:13px; }
    .meta-section{
      margin-top:40px;
      padding-top:20px;
      border-top:1px solid var(--line);
      font-size:13px;
      color:var(--muted);
    }
    .badge-row{ display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--line); padding:4px 10px;
      border-radius:20px; background:#fff;
    }
  </style>

  <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://calcdomain.com"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Engineering",
        "item": "https://calcdomain.com/categories/engineering"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "Electrical",
        "item": "https://calcdomain.com/subcategories/electrical"
      }
    ]
  }</script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to estimate bandwidth for your home or office",
    "description": "Steps to calculate required internet bandwidth from users and activities, plus how to estimate file transfer time.",
    "step": [
      {
        "@type": "HowToStep",
        "name": "Choose mode",
        "text": "Pick 'Activity-based' to size your internet plan or 'File transfer time' to estimate a download/upload time."
      },
      {
        "@type": "HowToStep",
        "name": "Enter inputs",
        "text": "For Activity-based: add activities and concurrent users, set concurrency and safety margin. For File transfer: enter file size, link speed, and efficiency."
      },
      {
        "@type": "HowToStep",
        "name": "Review results",
        "text": "See required download/upload bandwidth, recommended plan speed, and estimated times."
      },
      {
        "@type": "HowToStep",
        "name": "Refine",
        "text": "Adjust assumptions (efficiency, overhead, concurrency) to stress-test your scenario."
      }
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What’s the difference between Mbps and MB/s?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Mbps is megabits per second; MB/s is megabytes per second. 1 byte = 8 bits. Network speeds are usually advertised in Mbps."
        }
      },
      {
        "@type": "Question",
        "name": "What concurrency should I use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Concurrency is the share of users active at once. Homes often see 30–50%; busy offices peak higher. Use a conservative value to avoid congestion."
        }
      },
      {
        "@type": "Question",
        "name": "What is protocol efficiency?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It’s the fraction of link capacity available to payload after overhead (TCP/IP headers, Wi-Fi/ethernet framing). Typical 70–95%, depending on medium and conditions."
        }
      },
      {
        "@type": "Question",
        "name": "Why add a safety margin?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Bandwidth demand is spiky. A margin helps absorb peaks, background updates, and QoS variability so apps stay smooth."
        }
      },
      {
        "@type": "Question",
        "name": "Does upload speed matter for video calls?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. Video conferencing needs both downlink and uplink. Ensure the upload requirement meets or exceeds your codec’s bitrate."
        }
      },
      {
        "@type": "Question",
        "name": "Will Wi-Fi reduce my real throughput?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Often yes. Shared medium, signal quality, and interference lower efficiency versus wired links. Prefer ethernet for critical tasks."
        }
      },
      {
        "@type": "Question",
        "name": "How accurate is file transfer time?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It’s an estimate. Real times vary with server limits, congestion, disk speed, and protocol behavior (e.g., TCP slow start)."
        }
      }
    ]
  }
  </script>
</head>
<body>
  <header id="siteHeader">
    <div class="nav container">
      <a class="brand" href="https://calcdomain.com">CalcDomain</a>
      <div class="navRight">
        <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
        <span class="pill">Categories</span>
      </div>
    </div>
  </header>

  <div class="container">
    <main style="margin:24px 0 40px;" id="mainContent">
      <h1 id="pageTitle">Bandwidth Calculator — Estimate Internet Speed Needs &amp; File Transfer Time</h1>
      <p class="sub" id="pageSub">
        Professional bandwidth calculator: estimate household or office internet speed needs by activities and users, plus compute file transfer time with protocol overhead and efficiency.
      </p>

      <div id="errorBox" class="alert" role="alert" aria-live="polite"></div>

      <div class="calc-hero" id="calcHero">
        <section class="card" id="inputsCard" aria-label="Calculator inputs">
          <div class="sectionTitle">Activity-based bandwidth</div>
          <p style="margin:0 0 12px; color:var(--muted); font-size:14px;">
            Define the active activities and how many concurrent users participate. The calculator sums traffic and applies concurrency, margin, and efficiency assumptions.
          </p>
          <div style="overflow-x:auto;">
            <table class="activity-table" aria-label="Activity rows">
              <thead>
                <tr>
                  <th style="width:30%;">Activity</th>
                  <th style="width:18%;">Download (Mbps)</th>
                  <th style="width:18%;">Upload (Mbps)</th>
                  <th style="width:18%;">Users</th>
                  <th style="width:16%;">Action</th>
                </tr>
              </thead>
              <tbody id="activityRows"></tbody>
            </table>
          </div>
          <div class="row-controls">
            <button id="addRowBtn" type="button">Add activity</button>
            <button id="resetRowsBtn" type="button">Reset defaults</button>
          </div>

          <div class="grid2">
            <div>
              <label for="concurrency">Concurrency (%)</label>
              <input id="concurrency" type="number" value="40" min="1" max="100" step="1" inputmode="decimal">
            </div>
            <div>
              <label for="margin">Safety margin (%)</label>
              <input id="margin" type="number" value="25" min="0" max="200" step="1" inputmode="decimal">
            </div>
          </div>
          <div class="grid2">
            <div>
              <label for="efficiency">Protocol efficiency (%)</label>
              <input id="efficiency" type="number" value="85" min="1" max="100" step="1" inputmode="decimal">
            </div>
            <div>
              <label for="ftt-direction">File transfer target</label>
              <select id="ftt-direction">
                <option value="download">Download</option>
                <option value="upload">Upload</option>
              </select>
            </div>
          </div>

          <div class="sectionTitle" style="margin-top:16px;">File transfer time</div>
          <div class="grid2">
            <div>
              <label for="file-size">File size</label>
              <input id="file-size" type="number" value="5" min="0.0001" step="0.1" inputmode="decimal">
            </div>
            <div>
              <label for="file-unit">Unit</label>
              <select id="file-unit">
                <option value="GB" selected="">GB</option>
                <option value="MB">MB</option>
                <option value="TB">TB</option>
                <option value="MiB">MiB</option>
                <option value="GiB">GiB</option>
              </select>
            </div>
          </div>
          <div class="grid2">
            <div>
              <label for="link-speed">Link speed (Mbps)</label>
              <input id="link-speed" type="number" value="100" min="0.01" step="0.1" inputmode="decimal">
            </div>
            <div>
              <label for="ftt-eff">Transfer efficiency (%)</label>
              <input id="ftt-eff" type="number" value="85" min="1" max="100" step="1" inputmode="decimal">
            </div>
          </div>

          <div style="display:flex; gap:12px; margin-top:24px;">
            <button class="btn" id="calcBtn" type="button">Calculate</button>
            <button class="btn btnSecondary" id="resetBtn" type="button">Reset</button>
          </div>
        
<div data-canon-btnrow="1" style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;"></div>
</section>

        <section class="card sticky-box" id="resultsCard" aria-label="Calculator results">
          <div class="totalBox">
            <div class="t">Required bandwidth (after safety margin)</div>
            <div class="v" id="dlRequired">—</div>
          </div>
          <div class="kpi">
            <span>Download required</span>
            <span id="dlSecondary">—</span>
          </div>
          <div class="kpi">
            <span>Upload required</span>
            <span id="ulRequired">—</span>
          </div>
          <div class="kpi">
            <span>Plan suggestion</span>
            <span id="planSuggestion">—</span>
          </div>

          <div style="border-top:1px solid var(--line); margin:16px 0;"></div>
          <div class="sectionTitle" style="margin-bottom:8px;">File transfer estimate</div>
          <div class="kpi">
            <span id="fttLabel">Transfer time</span>
            <span id="fttTime">—</span>
          </div>
          <div class="kpi">
            <span>Effective throughput</span>
            <span id="fttThroughput">—</span>
          </div>
          <div>
            <div style="font-size:12px; color:var(--muted); margin-bottom:6px;">Calculation steps</div>
            <pre id="fttSteps">—</pre>
          </div>

          <div style="border-top:1px solid var(--line); margin:16px 0;"></div>
          <div class="sectionTitle" style="margin-bottom:12px;">Assumptions</div>
          <ul id="assumptionsList" class="assumption-list">
            <li>Concurrency: 40%</li>
            <li>Safety margin: 25%</li>
            <li>Efficiency: 85%</li>
          </ul>
        </section>
      </div>

      <section class="card content-card" id="howToUse" aria-label="How to use and methodology">
        <h2>How to use</h2>
        <p>
          Add the activities you expect on the network, specifying how many people use each simultaneously and what each activity consumes in Mbps.
          The calculator combines concurrency, margin, and efficiency assumptions to produce a recommended downlink/upload target and a friendly plan suggestion.
        </p>
        <p>
          For a file transfer estimate, enter the file size, desired direction, and link speed plus protocol efficiency to see how long the transfer will take and the effective throughput.
        </p>
        <h2>Methodology</h2>
        <p>
          Activity-based demand multiplies each activity’s bitrate by the number of concurrent users, then scales the sum by the assumed concurrency rate,
          safety margin, and protocol efficiency. The result rounds up to common plan tiers for ease of purchasing.
        </p>
        <p>
          File transfer times convert the file size to bits, adjust for the efficiency of the protocol, and divide by the ambient link throughput to produce a deterministic hh:mm:ss estimate.
        </p>
      </section>

      <section class="meta-section" id="pageMeta" aria-label="Verification, changelog, formulas, citations">
        <details id="formulaDetails">
          <summary style="cursor:pointer; font-weight:700; color:var(--text)">Formulas</summary>
          <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
            <p><strong>Activity-based bandwidth:</strong></p>
            <p>\[B_{\text{req}} = \frac{\alpha}{\eta}\; \Big( c \cdot \sum_{i=1}^{N} n_i \, r_i \Big)\]</p>
            <ul style="margin:8px 0 0 18px; padding-left:0;">
              <li> \(n_i\): concurrent users on activity \(i\)</li>
              <li> \(r_i\): bitrate required for activity \(i\)</li>
              <li> \(c\): concurrency fraction (percent / 100)</li>
              <li> \(\alpha = 1 + \text{safety margin}\)</li>
              <li> \(\eta\): protocol efficiency fraction</li>
            </ul>
            <p style="margin-top:12px;"><strong>File transfer time:</strong></p>
            <p>\[ t = \frac{S_{\text{bits}}}{R_{\text{link}} \cdot \eta} \quad,\quad S_{\text{bits}} = S \times \kappa \]</p>
            <ul style="margin:8px 0 0 18px; padding-left:0;">
              <li> \(S\): file size in selected unit</li>
              <li> \(\kappa\): bytes per unit (e.g., GB = \(10^9\) B)</li>
              <li> \(R_{\text{link}}\): link speed in bits/s</li>
              <li> \(\eta\): transfer efficiency</li>
            </ul>
          </div>
        </details>

        <details id="citationDetails" style="margin-top:10px;">
          <summary style="cursor:pointer; font-weight:700; color:var(--text)">Citations</summary>
          <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
            <ul style="margin:0; padding-left:18px;">
              <li>IEC — <a href="https://www.iec.ch/" target="_blank" rel="noopener">https://www.iec.ch/</a> (accessed 2026-01-19)</li>
              <li>RFC-editor — <a href="https://www.rfc-editor.org/rfc/rfc6349" target="_blank" rel="noopener">https://www.rfc-editor.org/rfc/rfc6349</a> (accessed 2026-01-19)</li>
              <li>ITU — <a href="https://www.itu.int/" target="_blank" rel="noopener">https://www.itu.int/</a> (accessed 2026-01-19)</li>
            </ul>
          </div>
        </details>

        <details id="changelogDetails" style="margin-top:10px;">
          <summary style="cursor:pointer; font-weight:700; color:var(--text)">Changelog</summary>
          <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
            <ul style="padding-left:18px; margin:0;">
              <li>0.1.0-draft — 2026-01-19: Initial audit-spec draft and code consolidation.</li>
            </ul>
          </div>
        </details>

        <div class="badge-row" id="badgeRow">
          <div class="badge" id="verifiedBadge">
            <span style="color:var(--ok); font-weight:800;">✓</span> Verified by Ugo Candido
          </div>
          <div class="badge" id="lastUpdatedBadge">Last Updated: 2026-01-19</div>
          <div class="badge" id="versionBadge">Version 0.1.0-draft</div>
        </div>
      </section>
    </main>
  </div>

  <footer id="siteFooter" class="bg-gray-900 text-white py-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
          <p class="text-gray-400 mb-4">
            Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
          </p>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4">Categories</h4>
          <ul class="space-y-2">
            <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
            <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction &amp; DIY</a></li>
            <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
            <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
            <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
            <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health &amp; Fitness</a></li>
            <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle &amp; Everyday</a></li>
            <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
            <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math &amp; Conversions</a></li>
            <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
          <ul class="space-y-2">
            <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
            <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
            <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
            <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
            <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4">Support</h4>
          <ul class="space-y-2">
            <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
            <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
            <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
            <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
            <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
        <p>© 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
      </div>
    </div>
  </footer>

  <script>
    (function() {
      'use strict';

      const defaults = [
        { name: '4K streaming', dl: 25, ul: 5, users: 1 },
        { name: 'HD video call', dl: 2.5, ul: 2.5, users: 2 },
        { name: 'Gaming', dl: 3, ul: 1, users: 1 },
        { name: 'Web browsing', dl: 1, ul: 0.2, users: 2 }
      ];

      const unitFactors = {
        MB: 1e6, GB: 1e9, TB: 1e12,
        MiB: Math.pow(2, 20), GiB: Math.pow(2, 30)
      };

      const tierDown = [10,20,30,50,75,100,200,300,500,600,800,1000,2000];
      const tierUp = [1,2,5,10,20,30,50,100,200,500,1000];

      const els = {
        activityRows: document.getElementById('activityRows'),
        addRowBtn: document.getElementById('addRowBtn'),
        resetRowsBtn: document.getElementById('resetRowsBtn'),
        concurrency: document.getElementById('concurrency'),
        margin: document.getElementById('margin'),
        efficiency: document.getElementById('efficiency'),
        fileSize: document.getElementById('file-size'),
        fileUnit: document.getElementById('file-unit'),
        linkSpeed: document.getElementById('link-speed'),
        fttEff: document.getElementById('ftt-eff'),
        fttDirection: document.getElementById('ftt-direction'),
        dlRequired: document.getElementById('dlRequired'),
        dlSecondary: document.getElementById('dlSecondary'),
        ulRequired: document.getElementById('ulRequired'),
        planSuggestion: document.getElementById('planSuggestion'),
        assumptionsList: document.getElementById('assumptionsList'),
        fttTime: document.getElementById('fttTime'),
        fttThroughput: document.getElementById('fttThroughput'),
        fttSteps: document.getElementById('fttSteps'),
        fttLabel: document.getElementById('fttLabel'),
        errorBox: document.getElementById('errorBox'),
        calcBtn: document.getElementById('calcBtn'),
        resetBtn: document.getElementById('resetBtn'),
        inputsCard: document.getElementById('inputsCard')
      };

      const debounce = (fn, delay = 100) => {
        let t;
        return (...args) => {
          clearTimeout(t);
          t = setTimeout(() => fn(...args), delay);
        };
      };

      const round1 = (val) => Math.round((val + Number.EPSILON) * 10) / 10;
      const fmtMbps = (val) => Number.isFinite(val) ? `${round1(val)} Mbps` : '—';

      function renderActivityRows(rows) {
        const html = rows.map(({ name, dl, ul, users }) => `
          <tr>
            <td><input type="text" value="${name}" aria-label="Activity name"></td>
            <td><input type="number" inputmode="decimal" min="0" step="0.1" value="${dl}"></td>
            <td><input type="number" inputmode="decimal" min="0" step="0.1" value="${ul}"></td>
            <td><input type="number" inputmode="numeric" min="0" step="1" value="${users}"></td>
            <td style="text-align:center;">
              <button type="button" class="btnSecondary" data-remove>Remove</button>
            </td>
          </tr>
        `).join('');
        els.activityRows.innerHTML = html;
      }

      function resetRows() {
        renderActivityRows(defaults);
      }

      function toNumber(value) {
        const n = parseFloat(value);
        return Number.isFinite(n) ? n : NaN;
      }

      function parseInputs() {
        const activities = Array.from(els.activityRows.querySelectorAll('tr')).map((tr) => {
          const inputs = tr.querySelectorAll('input');
          return {
            name: inputs[0].value.trim() || 'Activity',
            dl: toNumber(inputs[1].value),
            ul: toNumber(inputs[2].value),
            users: toNumber(inputs[3].value)
          };
        });

        return {
          activities,
          concurrency: toNumber(els.concurrency.value),
          margin: toNumber(els.margin.value),
          efficiency: toNumber(els.efficiency.value),
          fileSize: toNumber(els.fileSize.value),
          fileUnit: els.fileUnit.value,
          linkSpeed: toNumber(els.linkSpeed.value),
          fttEff: toNumber(els.fttEff.value),
          fttDirection: els.fttDirection.value
        };
      }

      function validate(inputs) {
        const errors = [];
        if (!Number.isFinite(inputs.concurrency) || inputs.concurrency < 1 || inputs.concurrency > 100) {
          errors.push('Concurrency must be between 1 and 100%.');
        }
        if (!Number.isFinite(inputs.margin) || inputs.margin < 0 || inputs.margin > 200) {
          errors.push('Safety margin must be between 0 and 200%.');
        }
        if (!Number.isFinite(inputs.efficiency) || inputs.efficiency < 1 || inputs.efficiency > 100) {
          errors.push('Protocol efficiency must be between 1 and 100%.');
        }
        if (!Number.isFinite(inputs.fileSize) || inputs.fileSize <= 0) {
          errors.push('File size must be greater than 0.');
        }
        if (!Number.isFinite(inputs.linkSpeed) || inputs.linkSpeed <= 0) {
          errors.push('Link speed must be greater than 0.');
        }
        if (!Number.isFinite(inputs.fttEff) || inputs.fttEff < 1 || inputs.fttEff > 100) {
          errors.push('Transfer efficiency must be between 1 and 100%.');
        }

        const validActivities = inputs.activities.every((row) =>
          Number.isFinite(row.dl) && row.dl >= 0 &&
          Number.isFinite(row.ul) && row.ul >= 0 &&
          Number.isFinite(row.users) && row.users >= 0
        );
        if (!validActivities) {
          errors.push('Activity rows require non-negative Mbps and user counts.');
        }

        return { ok: errors.length === 0, errors };
      }

      function tierSuggestion(dl, ul) {
        const down = tierDown.find((t) => t >= dl) ?? Math.ceil(dl);
        const up = tierUp.find((t) => t >= ul) ?? Math.ceil(ul);
        if (!Number.isFinite(down) || !Number.isFinite(up)) return '—';
        return `${down} Mbps down / ${up} Mbps up`;
      }

      function fmtTime(seconds) {
        if (!Number.isFinite(seconds) || seconds < 0) return '—';
        const s = Math.max(0, Math.round(seconds));
        const hours = Math.floor(s / 3600);
        const minutes = Math.floor((s % 3600) / 60);
        const secs = s % 60;
        return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }

      function compute(inputs) {
        const conc = inputs.concurrency / 100;
        const alpha = 1 + inputs.margin / 100;
        const eta = inputs.efficiency / 100;

        let dlSum = 0;
        let ulSum = 0;
        inputs.activities.forEach(({ dl, ul, users }) => {
          dlSum += Math.max(0, dl) * Math.max(0, users);
          ulSum += Math.max(0, ul) * Math.max(0, users);
        });

        const dlReq = (alpha / eta) * (conc * dlSum);
        const ulReq = (alpha / eta) * (conc * ulSum);

        const plan = (dlReq > 0 || ulReq > 0) ? tierSuggestion(Math.ceil(dlReq), Math.ceil(ulReq)) : '—';

        const assumptions = [
          `Concurrency: ${round1(inputs.concurrency)}%`,
          `Safety margin: ${round1(inputs.margin)}%`,
          `Protocol efficiency: ${round1(inputs.efficiency)}%`,
          `Raw load: ${dlSum.toFixed(1)} Mbps down, ${ulSum.toFixed(1)} Mbps up`
        ];

        const sizeBytes = inputs.fileSize * (unitFactors[inputs.fileUnit] || 1e9);
        const bits = sizeBytes * 8;
        const linkBps = inputs.linkSpeed * 1e6;
        const effRate = linkBps * (inputs.fttEff / 100);
        const seconds = effRate > 0 ? bits / effRate : NaN;
        const throughput = effRate / 1e6;

        const steps = [
          `Size = ${inputs.fileSize} ${inputs.fileUnit}`,
          `Bytes = ${Math.round(sizeBytes).toLocaleString()} B`,
          `Bits = ${Math.round(bits).toLocaleString()} b`,
          `Link = ${round1(inputs.linkSpeed)} Mbps, Efficiency = ${round1(inputs.fttEff)}%`,
          `Effective rate = ${fmtMbps(throughput)}`,
          `Time = ${fmtTime(seconds)} (hh:mm:ss)`
        ].join('\n');

        return {
          computed: {
            dlReq,
            ulReq,
            plan,
            throughput,
            seconds
          },
          assumptions,
          steps,
          direction: inputs.fttDirection
        };
      }

      function format({ computed, assumptions, steps, direction }) {
        return {
          dlText: fmtMbps(computed.dlReq),
          ulText: fmtMbps(computed.ulReq),
          planText: computed.plan,
          dlSecondary: direction === 'download' ? 'Priority: download' : 'Priority: upload',
          fttTime: fmtTime(computed.seconds),
          fttThroughput: fmtMbps(computed.throughput),
          stepsText: steps,
          assumptionsList: assumptions
        };
      }

      function render(formatted) {
        els.dlRequired.textContent = formatted.dlText;
        els.dlSecondary.textContent = formatted.dlSecondary;
        els.ulRequired.textContent = formatted.ulText;
        els.planSuggestion.textContent = formatted.planText;
        els.assumptionsList.innerHTML = formatted.assumptionsList.map((item) => `<li>${item}</li>`).join('');
        els.fttTime.textContent = formatted.fttTime;
        els.fttThroughput.textContent = formatted.fttThroughput;
        els.fttSteps.textContent = formatted.stepsText;
      }

      function renderError(errors) {
        if (!errors || errors.length === 0) {
          els.errorBox.style.display = 'none';
          els.errorBox.textContent = '';
          return;
        }
        els.errorBox.style.display = 'block';
        els.errorBox.textContent = errors.join(' ');
      }

      function update() {
        const inputs = parseInputs();
        const validation = validate(inputs);
        if (!validation.ok) {
          renderError(validation.errors);
          return;
        }
        renderError([]);

        const result = compute(inputs);
        const formatted = format(result);
        render(formatted);
      }

      const debouncedUpdate = debounce(update, 100);

      document.querySelectorAll('#inputsCard input, #inputsCard select, #inputsCard textarea')
        .forEach((el) => {
          el.addEventListener('input', debouncedUpdate);
          el.addEventListener('change', debouncedUpdate);
        });

      els.addRowBtn.addEventListener('click', () => {
        const html = `
          <tr>
            <td><input type="text" value="New activity" aria-label="Activity name"></td>
            <td><input type="number" inputmode="decimal" min="0" step="0.1" value="0"></td>
            <td><input type="number" inputmode="decimal" min="0" step="0.1" value="0"></td>
            <td><input type="number" inputmode="numeric" min="0" step="1" value="1"></td>
            <td style="text-align:center;">
              <button type="button" class="btnSecondary" data-remove>Remove</button>
            </td>
          </tr>`;
        els.activityRows.insertAdjacentHTML('beforeend', html);
      });

      els.resetRowsBtn.addEventListener('click', () => {
        resetRows();
        update();
      });

      els.activityRows.addEventListener('click', (event) => {
        const btn = event.target.closest('[data-remove]');
        if (!btn) return;
        btn.closest('tr').remove();
        update();
      });

      els.inputsCard.addEventListener('input', debouncedUpdate);
      els.inputsCard.addEventListener('change', debouncedUpdate);

      els.calcBtn.addEventListener('click', update);
      els.resetBtn.addEventListener('click', () => {
        resetRows();
        els.concurrency.value = '40';
        els.margin.value = '25';
        els.efficiency.value = '85';
        els.fileSize.value = '5';
        els.fileUnit.value = 'GB';
        els.linkSpeed.value = '100';
        els.fttEff.value = '85';
        els.fttDirection.value = 'download';
        update();
      });

      resetRows();
      update();
    })();
  </script>

</body></html>
