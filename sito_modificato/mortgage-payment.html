<div id="errorBox" class="alert"></div>

  <div class="calc-hero">
    <section class="card">
      <div class="sectionTitle">Regional & Logic Settings</div>
      <div class="grid2">
        <div>
          <label for="countryLogic">Country Logic</label>
          <select id="countryLogic">
            <option value="US">USA (Monthly Comp.)</option>
            <option value="CA">Canada (Semi-Annual Comp.)</option>
            <option value="UK">UK (Monthly Comp. + SDLT)</option>
            <option value="ES">Spain (Regional ITP)</option>
          </select>
        </div>
        <div style="display:flex; align-items:center; gap:8px; margin-top:20px;">
          <input type="checkbox" id="nonResident" style="width:20px;">
          <label for="nonResident" style="margin:0;">Non-Resident / Expat?</label>
        </div>
      </div>

      <div class="sectionTitle">Loan Details</div>
      <div class="grid2">
        <div>
          <label for="loanAmount">Loan Amount</label>
          <input id="loanAmount" type="number" value="350000">
        </div>
        <div>
          <label for="interestRate">Interest Rate (%)</label>
          <input id="interestRate" type="number" value="6.5" step="0.1">
        </div>
      </div>

      <div class="grid2">
        <div>
          <label for="loanTermYears">Term (Years)</label>
          <input id="loanTermYears" type="number" value="30">
        </div>
        <div>
          <label for="grossIncome">Monthly Gross Income</label>
          <input id="grossIncome" type="number" value="8000" placeholder="For DTI calculation">
        </div>
      </div>

      <div class="optional-box">
        <div class="sectionTitle" style="font-size:11px;">Currency Stress Test (Volatility Risk)</div>
        <label for="volatility">Exchange Rate Drop (%)</label>
        <input type="range" id="volatility" min="0" max="30" value="10" style="margin-bottom:8px;">
        <div style="font-size:12px; color:var(--muted);">Simulate impact if your home currency devalues by <span id="volVal">10</span>%.</div>
      </div>

      <div style="display:flex; gap:12px;">
        <button class="btn" id="calcBtn">Calculate Impact</button>
        <button class="btn btnSecondary" id="resetBtn">Reset</button>
      </div>
    </section>

    <section class="card" style="position:sticky; top:100px;">
      <div class="totalBox">
        <div style="font-size:12px; font-weight:700; color:var(--muted); text-transform:uppercase;">Monthly Equivalent</div>
        <div class="v" id="totalMonthly">$0.00</div>
      </div>

      <div class="kpi">
        <span>P&I Payment</span>
        <span id="piMonthly">$0.00</span>
      </div>
      <div class="kpi">
        <span>DTI Ratio</span>
        <span id="dtiRatio">0%</span>
      </div>
      
      <div id="stressResult" class="stress-box" style="display:none;">
        <strong>Currency Risk Alert:</strong>
        If your income devalues, your effective monthly payment becomes <span id="stressedPay">$0.00</span>.
      </div>

      <div class="sectionTitle" style="margin-top:20px;">Closing Cost Estimate</div>
      <div class="kpi">
        <span id="taxLabel">Standard Transfer Tax</span>
        <span id="taxCost">$0.00</span>
      </div>
      <div class="kpi" id="nrSurchargeRow" style="display:none; color:var(--danger);">
        <span>Non-Resident Surcharge</span>
        <span id="nrSurchargeCost">$0.00</span>
      </div>
      <div class="kpi bold">
        <span>Estimated Total Cash Needed</span>
        <span id="totalCash">$0.00</span>
      </div>
      
      <button class="btn btnSecondary" id="toggleSchedule">View Full Schedule</button>
    </section>
  </div>

  <div id="scheduleWrap" class="tableWrap">
    <table>
      <thead>
        <tr><th>#</th><th>Interest</th><th>Principal</th><th>Balance</th></tr>
      </thead>
      <tbody id="scheduleBody"></tbody>
    </table>
  </div>

  <section class="card" style="margin-top:24px;">
    <h2>Global Methodology</h2>
    <p><strong>US vs. Canada Compounding:</strong> US mortgages compound monthly. Per Canadian regulations, fixed-rate mortgages compound semi-annually.[1, 2] We use the conversion formula \( i = ((1 + r/c)^{c/p}) - 1 \) where \( c=2 \) for Canada.[1]</p>
    <p><strong>Regulatory Compliance (2025-2026):</strong> This tool incorporates the UK’s April 2025 SDLT threshold shifts (£125k nil-rate) and the mandatory 2% non-resident surcharge.[3, 4] For Spain, it calculates regional ITP (approx. 7-11%).[5]</p>
    <p><strong>DTI and Currency Risk:</strong> International lenders typically cap Debt-to-Income (DTI) at 33-35% for expats.[6, 7] We visualize "Currency Risk" using a 90% income haircut or dynamic stress testing common in 2026 underwriting.[8, 9]</p>
  </section>

  <section class="meta-section">
    <div class="badge-row">
      <div class="badge">Last Updated: 2026-02-08</div>
      <div class="badge">Version 2.0.0 (International)</div>
      <div class="badge">✓ Verified Audit</div>
    </div>
    <details style="margin-top:15px;">
      <summary>Changelog</summary>
      <ul>
        <li>v2.0.0 — Added Canada semi-annual compounding logic.[1]</li>
        <li>v2.0.0 — Added UK SDLT 2025 rules and Non-Resident 2% surcharge.[4]</li>
        <li>v2.0.0 — Integrated Currency Volatility Stress Test and DTI monitoring.[8, 7]</li>
        <li>v1.0.0 — Original US-only monthly release.</li>
      </ul>
    </details>
  </section>
</main>