<html lang="en"><head><style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --text:#0f172a;
    --muted:#475569;
    --line:#e5e7eb;
    --primary:#2563eb;
    --primary2:#1d4ed8;
    --danger:#b91c1c;
    --dangerBg:#fef2f2;
    --ok:#166534;
    --okBg:#f0fdf4;
    --shadow: 0 10px 25px rgba(2,6,23,.08);
    --radius:14px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: var(--sans);
    color:var(--text);
    background:var(--bg);
    line-height:1.5;
  }
  a{color:var(--primary); text-decoration:none}
  a:hover{text-decoration:underline}
  .container{max-width:1120px; margin:0 auto; padding:18px}
  header{
    position:sticky; top:0; z-index:10;
    background:rgba(255,255,255,.92);
    backdrop-filter: blur(8px);
    border-bottom:1px solid var(--line);
  }
  .nav{
    display:flex; align-items:center; justify-content:space-between; gap:14px;
    padding:12px 18px;
  }
  .brand{font-weight:800; letter-spacing:.2px; font-size:20px}
  .navRight{display:flex; gap:14px; align-items:center; color:var(--muted); font-size:14px}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    border:1px solid var(--line); background:#fff;
    padding:8px 10px; border-radius:999px;
  }
  .layout{display:grid; grid-template-columns: 2fr 1fr; gap:18px; margin-top:18px}
  @media (max-width: 980px){ .layout{grid-template-columns:1fr} header{position:static} }
  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  .cardPad{padding:18px}
  .breadcrumbs{font-size:13px; color:var(--muted); padding:0 0 10px}
  .breadcrumbs a{color:var(--muted)}
  h1{margin:0 0 8px; font-size:28px; line-height:1.2}
  .sub{margin:0 0 12px; color:var(--muted)}
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media (max-width: 640px){ .grid2{grid-template-columns:1fr} }
  label{display:block; font-size:13px; color:var(--muted); margin:0 0 6px}
  input, select{
    width:100%;
    padding:10px 12px;
    border:1px solid var(--line);
    border-radius:12px;
    background:#fff;
    font-size:14px;
    outline:none;
  }
  input:focus, select:focus{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.12)}
  .req{color:var(--danger); font-weight:700}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .btn{
    border:1px solid transparent;
    background:var(--primary);
    color:#fff;
    padding:10px 14px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    font-size:14px;
  }
  .btn:hover{background:var(--primary2)}
  .btnSecondary{
    background:#fff;
    border-color:var(--line);
    color:var(--text);
  }
  .btnSecondary:hover{background:#f8fafc}
  .btn:disabled{opacity:.55; cursor:not-allowed}
  .sectionTitle{
    font-weight:800; margin:12px 0 10px;
    font-size:16px;
  }
  .divider{border-top:1px solid var(--line); margin:14px 0}
  .alert{
    border:1px solid var(--line);
    border-left:5px solid var(--danger);
    background:var(--dangerBg);
    padding:12px 12px;
    border-radius:12px;
    color:#7f1d1d;
    display:none;
  }
  .alert strong{display:block; margin-bottom:4px}
  .kpis{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media (max-width: 640px){ .kpis{grid-template-columns:1fr} }
  .kpi{
    background:#fff;
    border:1px solid var(--line);
    border-radius:12px;
    padding:12px;
  }
  .kpi .t{font-size:12px; color:var(--muted)}
  .kpi .v{font-size:22px; font-weight:900; margin-top:2px}
  .totalBox{
    margin-top:12px;
    background:linear-gradient(135deg, #eef2ff, #eff6ff);
    border:1px solid #c7d2fe;
    border-radius:14px;
    padding:14px;
  }
  .totalBox .t{color:var(--muted); font-size:12px}
  .totalBox .v{font-size:34px; font-weight:900; margin-top:2px}
  .metaRow{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px}
  .metaRow .m{font-size:13px; color:var(--muted)}
  .metaRow .m span{color:var(--text); font-weight:700; margin-left:6px}
  .tableWrap{overflow-x:auto; margin-top:10px; display:none}
  table{width:100%; border-collapse:collapse; background:#fff; border:1px solid var(--line); border-radius:12px; overflow:hidden}
  th,td{padding:10px 10px; border-bottom:1px solid var(--line); font-size:13px; text-align:left; white-space:nowrap}
  th{background:#f1f5f9; font-size:12px; letter-spacing:.2px; text-transform:none}
  tr:nth-child(even) td{background:#fafafa}
  details{border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:#fff}
  details summary{cursor:pointer; font-weight:800}
  .mono{font-family:var(--mono)}
  .note{
    border:1px solid var(--line);
    background:#fff;
    border-radius:12px;
    padding:12px;
    color:var(--muted);
    font-size:13px;
  }
  .badge{
    display:inline-flex; align-items:center; gap:8px;
    background:#fff;
    border:1px solid var(--line);
    border-radius:999px;
    padding:8px 10px;
    font-size:13px;
    color:var(--muted);
  }
  .badge strong{color:var(--text)}
  .sidebarList{padding-left:18px; margin:10px 0}
  .sidebarList li{margin:8px 0}
  .prose h2{margin:18px 0 8px; font-size:18px}
  .prose p{margin:10px 0; color:var(--muted)}
  .prose ul, .prose ol{color:var(--muted)}
  .prose li{margin:6px 0}
  .formulaBox{
    margin:10px 0;
    background:#0b1220;
    color:#e5e7eb;
    border-radius:12px;
    padding:12px;
    border:1px solid rgba(255,255,255,.12);
    overflow-x:auto;
  }
  .formulaBox code{font-family:var(--mono); font-size:13px}
  .changelog{
    border-left:5px solid #334155;
    background:#fff;
    border:1px solid var(--line);
    border-left-width:5px;
    border-radius:12px;
    padding:12px;
    font-size:13px;
    color:var(--muted);
  }
  .changelog strong{color:var(--text)}
  footer{margin:26px 0 18px; color:var(--muted); font-size:13px; text-align:center}
</style>



  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="https://calcdomain.com/mortgage-payment">
  <title>Mortgage Payment Calculator (PITI + Extra Payments) | CalcDomain</title>
  <meta name="description" content="Compute monthly mortgage payment (principal &amp; interest) and optional monthly escrow costs (taxes, insurance) plus PMI and HOA. Includes amortization schedule and extra principal analysis, with transparent formulas and sources.">

  <!-- Minimal favicon set (keep your existing if needed) -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- MathJax for LaTeX (optional but useful for formula transparency) -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <!-- JSON-LD (single set; avoid duplicates) -->
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Mortgage Payment Calculator",
  "url": "https://calcdomain.com/mortgage-payment",
  "isPartOf": {
    "@type": "WebSite",
    "name": "CalcDomain",
    "url": "https://calcdomain.com"
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "CalcDomain",
        "item": "https://calcdomain.com"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Finance",
        "item": "https://calcdomain.com/categories/finance"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "Mortgage Payment Calculator",
        "item": "https://calcdomain.com/mortgage-payment"
      }
    ]
  },
  "reviewedBy": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "dateModified": "2026-01-19"
}</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>

<body>
  <header>
    <div class="nav container">
      <a class="brand" href="https://calcdomain.com">CalcDomain</a>
      <div class="navRight">
        <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
        <span class="pill">Categories</span>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="layout">
      <main>
        <div class="breadcrumbs">
          <a href="https://calcdomain.com">Home</a> »
          <a href="https://calcdomain.com/finance">Finance</a> »
          <a href="https://calcdomain.com/subcategories/mortgage-real-estate">Mortgages</a> »
          <span>Mortgage Payment Calculator</span>
        </div>

        <section class="card">
          <div class="cardPad">
            <h1>Mortgage Payment Calculator</h1>
            <p class="sub">
              Estimate monthly principal &amp; interest (P&amp;I) for a fixed-rate mortgage, then optionally add monthly escrow-style costs
              (taxes, insurance) plus PMI and HOA. Includes amortization schedule and extra principal analysis.
            </p>

            <!-- Verification block (the “signature meaning” is precise and auditable) -->
            <div class="row" style="margin:10px 0 0">
              <div class="badge">
                <strong>Verified by</strong> <span>Ugo Candido</span>
              </div>
              <div class="badge">
                <strong>Verification date</strong> <span id="verifiedDateText">—</span>
              </div>
              <div class="badge">
                <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a>
                <span>·</span>
                <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
              </div>
            </div>

            <div class="note" style="margin-top:10px">
              This tool is an estimator. “Verified” means: (1) the displayed formulas match the code used for calculations,
              (2) inputs are validated with explicit units, and (3) outputs are regression-tested against a small set of reference cases.
              Real lender payments can differ due to escrow adjustments, rounding conventions, fees, and lender-specific policies.
            </div>

            <div class="divider"></div>

            <!-- Errors -->
            <div id="errorBox" class="alert" role="alert" aria-live="polite"></div>

            <!-- Calculator UI -->
            <section id="calculator-ui" aria-label="Mortgage calculator inputs">
              <div class="grid2">
                <div>
                  <label for="currency">Currency</label>
                  <select id="currency">
                    <option value="USD" selected="">USD — $</option>
                    <option value="EUR">EUR — €</option>
                    <option value="GBP">GBP — £</option>
                    <option value="CAD">CAD — $</option>
                    <option value="AUD">AUD — $</option>
                  </select>
                </div>
                <div>
                  <label for="paymentsPerYear">Payments per year</label>
                  <select id="paymentsPerYear">
                    <option value="12" selected="">12 (monthly)</option>
                    <option value="26">26 (biweekly)</option>
                    <option value="52">52 (weekly)</option>
                  </select>
                </div>
              </div>

              <div class="sectionTitle">Core inputs</div>
              <div class="grid2">
                <div>
                  <label for="loanAmount">Loan amount <span class="req">*</span></label>
                  <input id="loanAmount" type="number" inputmode="decimal" step="1000" value="350000">
                </div>
                <div>
                  <label for="interestRate">Interest rate (annual %) <span class="req">*</span></label>
                  <input id="interestRate" type="number" inputmode="decimal" step="0.001" value="6.5">
                </div>
                <div>
                  <label for="loanTermYears">Loan term (years) <span class="req">*</span></label>
                  <input id="loanTermYears" type="number" inputmode="numeric" min="1" max="50" step="1" value="30">
                </div>
                <div>
                  <label for="extraPrincipal">Extra principal (per payment)</label>
                  <input id="extraPrincipal" type="number" inputmode="decimal" step="10" value="0">
                </div>
              </div>

              <div class="sectionTitle">Optional monthly costs</div>
              <div class="grid2">
                <div>
                  <label for="annualTax">Property tax (annual)</label>
                  <input id="annualTax" type="number" inputmode="decimal" step="100" value="0">
                </div>
                <div>
                  <label for="annualInsurance">Home insurance (annual)</label>
                  <input id="annualInsurance" type="number" inputmode="decimal" step="100" value="0">
                </div>
                <div>
                  <label for="monthlyPMI">PMI (monthly)</label>
                  <input id="monthlyPMI" type="number" inputmode="decimal" step="10" value="0">
                </div>
                <div>
                  <label for="monthlyHOA">HOA dues (monthly)</label>
                  <input id="monthlyHOA" type="number" inputmode="decimal" step="10" value="0">
                </div>
              </div>

              <div class="row" style="margin-top:12px">
                <button class="btn" id="calcBtn" type="button">Calculate</button>
                <button class="btn btnSecondary" id="resetBtn" type="button">Reset</button>
                <span class="note" style="padding:10px 12px; flex:1; min-width:240px">
                  Tip: if you choose biweekly/weekly, the schedule will reflect that frequency (same annual rate, more frequent payments).
                </span>
              </div>
            </section>

            <div class="divider"></div>

            <!-- Results -->
            <section id="results" aria-label="Mortgage results">
              <div class="sectionTitle">Monthly payment breakdown (estimated)</div>

              <div class="kpis">
                <div class="kpi">
                  <div class="t">Principal &amp; interest (P&amp;I)</div>
                  <div class="v" id="piMonthly">$0.00</div>
                </div>
                <div class="kpi">
                  <div class="t">Taxes + insurance + PMI + HOA</div>
                  <div class="v" id="tiMonthly">$0.00</div>
                </div>
              </div>

              <div class="totalBox">
                <div class="t">Total monthly payment (PITI + HOA)</div>
                <div class="v" id="totalMonthly">$0.00</div>
              </div>

              <div class="metaRow">
                <div class="m">Total interest (loan only): <span id="totalInterest">$0.00</span></div>
                <div class="m">Total loan cost (principal + interest): <span id="totalCost">$0.00</span></div>
                <div class="m">Payoff time (loan only): <span id="payoffTime">—</span></div>
                <div class="m">First payment interest share: <span id="firstIntShare">—</span></div>
              </div>

              <div class="row" style="margin-top:12px">
                <button class="btn" id="toggleSchedule" type="button">View amortization schedule</button>
                <button class="btn" id="downloadCsv" type="button" disabled="">Download CSV</button>
                <button class="btn btnSecondary" id="copySummary" type="button">Copy summary</button>
              </div>

              <div id="scheduleWrap" class="tableWrap" aria-label="Amortization schedule">
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Payment</th>
                      <th>Interest</th>
                      <th>Principal</th>
                      <th>Extra</th>
                      <th>Balance</th>
                    </tr>
                  </thead>
                  <tbody id="scheduleBody"></tbody>
                </table>
                <div class="note" style="margin-top:10px">
                  Schedule shows up to the first 360 rows for performance. CSV contains the full schedule.
                </div>
              </div>
            </section>

            <div class="divider"></div>

            <!-- Formula + source dropdown (raw LaTeX + citation) -->
            <details id="formulaDetails">
              <summary>Formula &amp; source (raw LaTeX + variables)</summary>
              <div style="margin-top:10px">
                <p class="note">
                  These are the exact formulas used by the calculator engine. The rendered equation is shown first, followed by raw LaTeX
                  and variable/units definitions.
                </p>

                <div class="formulaBox">
                  <div style="margin-bottom:8px">
                    <div><strong>Rendered (fixed-rate amortizing loan payment):</strong></div>
                    <div style="margin-top:6px">
                      \[
                      M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1}
                      \]
                      \[
                      \text{If } r=0,\;\; M=\frac{P}{n}
                      \]
                    </div>
                  </div>
                  <div><strong>Raw LaTeX used:</strong></div>
                  <pre class="mono" style="margin:8px 0 0; white-space:pre-wrap">M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1}
If r=0: M=\frac{P}{n}</pre>

                  <div style="margin-top:10px"><strong>Variables and units:</strong></div>
                  <ul style="margin:8px 0 0 18px; color:#e5e7eb">
                    <li><span class="mono">P</span> = principal / loan amount (currency units)</li>
                    <li><span class="mono">r</span> = periodic interest rate (annual rate ÷ payments per year)</li>
                    <li><span class="mono">n</span> = total number of payments (years × payments per year)</li>
                    <li><span class="mono">M</span> = periodic payment for principal + interest (currency units)</li>
                  </ul>

                  <div style="margin-top:10px"><strong>Total interest (loan only):</strong></div>
                  <pre class="mono" style="margin:8px 0 0; white-space:pre-wrap">TotalInterest = Σ Interest_t
TotalCost = P + TotalInterest</pre>

                  <div style="margin-top:10px"><strong>Monthly “all-in” estimate:</strong></div>
                  <pre class="mono" style="margin:8px 0 0; white-space:pre-wrap">MonthlyAllIn = MonthlyPI + (AnnualTax + AnnualInsurance)/12 + MonthlyPMI + MonthlyHOA</pre>
                </div>

                <div class="note">
                  <strong>Citation source:</strong> Consumer Financial Protection Bureau (CFPB) explainer on mortgage payment components (principal,
                  interest, taxes, insurance). Use as an authoritative reference for the components of a typical payment.
                  <div style="margin-top:6px">
                    <a href="https://www.consumerfinance.gov/ask-cfpb/how-is-a-mortgage-payment-calculated-en-1907/" target="_blank" rel="nofollow noopener">
                      CFPB: How is a mortgage payment calculated?
                    </a>
                  </div>
                </div>
              </div>
            </details>

            <div class="divider"></div>

            <!-- Changelog -->
            <div class="changelog" id="changelog">
              <strong>Changelog</strong><br>
              <div style="margin-top:6px">
                <div><strong>Version:</strong> <span id="verText">1.0.0</span></div>
                <div><strong>Last code update:</strong> <span id="lastUpdateText">2026-01-19</span></div>
                <div style="margin-top:6px">
                  <strong>What changed:</strong>
                  <ul style="margin:6px 0 0 18px">
                    <li>Made formula-to-code traceable via dropdown with raw LaTeX, variables, units, and citation.</li>
                    <li>Introduced strict input validation and fail-closed error handling (no silent coercions).</li>
                    <li>Separated engine logic from UI to support auditing and regression tests.</li>
                    <li>Added amortization schedule that matches payment frequency (monthly/biweekly/weekly).</li>
                    <li>Standardized verification attribution and removed generic editorial claims.</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- How to Use (Information Gain: scenario-based, not generic definitions) -->
            <article class="card cardPad prose" style="margin-top:18px">
              <h2>How to use this mortgage payment calculator (high-signal workflow)</h2>
              <p>
                Mortgage payments are typically composed of (1) a loan payment for principal and interest (P&amp;I) and (2) additional
                housing costs that are often escrowed monthly (taxes and insurance), plus possible PMI and HOA dues. This tool
                calculates the P&amp;I exactly from the amortization equation, then adds the optional items you provide to estimate your
                “all-in” monthly outflow.
              </p>
              <ol>
                <li><strong>Enter the loan amount (P), interest rate, and term.</strong> These three numbers determine the fixed P&amp;I payment.</li>
                <li><strong>Choose payment frequency.</strong> Monthly is standard; biweekly/weekly schedules are useful when you want to model more frequent principal reduction.</li>
                <li><strong>Add optional costs only if you want an all-in estimate.</strong> Taxes and insurance are entered as annual amounts and converted to monthly; PMI and HOA are monthly inputs.</li>
                <li><strong>Use “Extra principal” to test payoff acceleration.</strong> Extra payments reduce balance faster and typically reduce total interest; the schedule and payoff time will update accordingly.</li>
              </ol>

              <h2>Interpretation rules (to avoid common mistakes)</h2>
              <ul>
                <li><strong>Note rate vs APR:</strong> this calculator uses the note rate for amortization (standard). APR includes fees; lenders may disclose both.</li>
                <li><strong>Escrow variability:</strong> taxes/insurance can change over time; your lender can adjust escrow collections periodically.</li>
                <li><strong>PMI modeling:</strong> PMI is treated as a constant monthly amount; actual PMI can change or end under lender rules.</li>
              </ul>

              <h2>Methodology and scope</h2>
              <p>
                The core loan payment uses the standard amortization formula. Optional costs are combined arithmetically into a monthly estimate.
                For a conceptual overview of mortgage payment components, see the cited CFPB resource in the Formula &amp; source dropdown.
              </p>

              <div class="note">
                <strong>Verified by Ugo Candido on <span id="verifiedDateText2">—</span></strong><br>
                <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
                <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
              </div>
            
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\\]</div>
  <pre class="auditspine-mono">','\</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1}\]</div>
  <pre class="auditspine-mono">M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{If } r=0,\;\; M=\frac{P}{n}\]</div>
  <pre class="auditspine-mono">\text{If } r=0,\;\; M=\frac{P}{n}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Rendered (fixed-rate amortizing loan payment): \[ M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1} \] \[ \text{If } r=0,\;\; M=\frac{P}{n} \] Raw LaTeX used: M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1} If r=0: M=\frac{P}{n} Variables and units: P = principal / loan amount (currency units) r = periodic interest rate (annual rate ÷ payments per year) n = total number of payments (years × payments per year) M = periodic payment for principal + interest (currency units) Total interest (loan only): TotalInterest = Σ Interest_t TotalCost = P + TotalInterest Monthly “all-in” estimate: MonthlyAllIn = MonthlyPI + (AnnualTax + AnnualInsurance)/12 + MonthlyPMI + MonthlyHOA</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">P</span> = principal (loan amount) <em>(currency)</em></li>
<li><span class="auditspine-mono">r</span> = periodic interest rate (annual rate ÷ payments per year) <em>(1)</em></li>
<li><span class="auditspine-mono">n</span> = total number of payments (years × payments per year) <em>(count)</em></li>
<li><span class="auditspine-mono">M</span> = periodic payment for principal + interest <em>(currency)</em></li>
<li><span class="auditspine-mono">E</span> = extra principal payment per period <em>(currency)</em></li>
<li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
<li><span class="auditspine-mono">I</span> = homeowners insurance (annual or monthly depending on input) <em>(currency)</em></li>
<li><span class="auditspine-mono">PMI</span> = private mortgage insurance (monthly) <em>(currency)</em></li>
<li><span class="auditspine-mono">HOA</span> = homeowners association dues (monthly) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>CFPB: How is a mortgage payment calculated?</strong> — consumerfinance.gov · Accessed 2026-01-19<br><a href="https://www.consumerfinance.gov/ask-cfpb/how-is-a-mortgage-payment-calculated-en-1907/" target="_blank" rel="nofollow noopener">https://www.consumerfinance.gov/ask-cfpb/how-is-a-mortgage-payment-calculated-en-1907/</a></li>
<li><strong>Home</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/" target="_blank" rel="nofollow noopener">https://calcdomain.com/</a></li>
<li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>Mortgages</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/mortgage-real-estate" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/mortgage-real-estate</a></li>
<li><strong>Profile</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/ugocandido" target="_blank" rel="nofollow noopener">https://calcdomain.com/ugocandido</a></li>
<li><strong>LinkedIn</strong> — linkedin.com · Accessed 2026-01-19<br><a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="nofollow noopener">https://www.linkedin.com/in/ugocandido92821/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
          </div>
        </section>
      </main>

      <aside>
        <div class="card cardPad">
          <div class="sectionTitle">Related mortgage tools</div>
          <ul class="sidebarList">
            <li><a href="https://calcdomain.com/mortgage-affordability-calculator">Mortgage Affordability Calculator</a></li>
            <li><a href="https://calcdomain.com/15-vs-30-year-mortgage">15 vs 30 Year Mortgage Comparison</a></li>
            <li><a href="https://calcdomain.com/refinance-calculator">Refinance Calculator</a></li>
            <li><a href="https://calcdomain.com/debt-to-income-ratio">Debt-to-Income Ratio Calculator</a></li>
            <li><a href="https://calcdomain.com/loan-amortization">Loan Amortization Calculator</a></li>
          </ul>

          <div class="divider"></div>

          <div class="sectionTitle">Quality controls (auditable)</div>
          <div class="note">
            <ul style="margin:0 0 0 18px">
              <li>Fail-closed validation (no results for invalid inputs)</li>
              <li>Formula-to-code traceability (LaTeX matches engine)</li>
              <li>Regression checks (small reference test set)</li>
              <li>No competitor brand references</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>

    <footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                                <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction & DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health & Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle & Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math & Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer>

















  </div>



<script>
(() => {
  'use strict';

  // =============================
  // Configuration (auditable)
  // =============================
  const META = {
    version: '1.0.0',
    lastCodeUpdateISO: '2026-01-19',
    verifiedByName: 'Ugo Candido',
    verifiedProfileUrl: 'https://calcdomain.com/ugocandido',
    verifiedLinkedInUrl: 'https://www.linkedin.com/in/ugocandido92821/'
  };

  // =============================
  // Utilities
  // =============================
  function clamp(n, min, max){ return Math.min(max, Math.max(min, n)); }

  function isFiniteNumber(x){
    return typeof x === 'number' && Number.isFinite(x);
  }

  function fmtCurrency(value, currency){
    // Keep formatting deterministic; use en-US separators for consistency across pages
    try {
      return new Intl.NumberFormat('en-US', { style:'currency', currency, maximumFractionDigits: 2 }).format(value);
    } catch {
      // Fallback if currency code unsupported
      return '$' + (Math.round(value * 100) / 100).toFixed(2);
    }
  }

  function fmtPercent(value){
    return (Math.round(value * 1000) / 10).toFixed(1) + '%';
  }

  function monthsToHuman(totalPayments, paymentsPerYear){
    // Convert number of payments to months/years approximation for display.
    // If paymentsPerYear=12, it's exact months; else it becomes "X years Y months (equiv)"
    const years = totalPayments / paymentsPerYear;
    const wholeYears = Math.floor(years);
    const remYears = years - wholeYears;
    const remMonths = Math.round(remYears * 12);
    if (wholeYears <= 0) return `${remMonths} months (equivalent)`;
    if (remMonths <= 0) return `${wholeYears} years`;
    return `${wholeYears} years ${remMonths} months (equivalent)`;
  }

  // =============================
  // Engine (pure)
  // =============================
  function periodicPaymentFixedRate({ principal, annualRatePct, years, paymentsPerYear }){
    // Returns periodic (per-payment) P&I payment M
    const P = principal;
    const n = Math.round(years * paymentsPerYear);
    const r = (annualRatePct / 100) / paymentsPerYear;

    if (n <= 0) return { M: NaN, r, n };
    if (r === 0) return { M: P / n, r, n };

    const pow = Math.pow(1 + r, n);
    const M = P * r * pow / (pow - 1);
    return { M, r, n };
  }

  function amortizationSchedule({
    principal,
    annualRatePct,
    years,
    paymentsPerYear,
    extraPrincipalPerPayment
  }){
    const { M, r, n } = periodicPaymentFixedRate({ principal, annualRatePct, years, paymentsPerYear });
    if (!isFiniteNumber(M)) return { schedule: [], totalInterest: NaN, M, r, n };

    const extra = Math.max(0, extraPrincipalPerPayment);
    const schedule = [];

    let balance = principal;
    let totalInterest = 0;
    let k = 0;

    // Guardrail to prevent infinite loops if inputs are weird
    const maxIter = n + Math.max(1200, n);

    while (balance > 0.01 && k < maxIter) {
      k++;

      const interest = r * balance;
      let principalPaid = M - interest;
      if (principalPaid < 0) principalPaid = 0; // fail-safe for extreme rates (still validated elsewhere)

      let extraPaid = extra;

      // Prevent overpaying beyond remaining balance
      const maxPayable = balance;
      const totalPrincipalThisPeriod = principalPaid + extraPaid;

      if (totalPrincipalThisPeriod > maxPayable) {
        // Reduce extra first; then principal if needed
        extraPaid = Math.max(0, maxPayable - principalPaid);
        if (principalPaid > maxPayable) principalPaid = maxPayable;
      }

      balance = Math.max(0, balance - principalPaid - extraPaid);
      totalInterest += interest;

      schedule.push({
        paymentNumber: k,
        paymentPI: M,
        interest,
        principal: principalPaid,
        extra: extraPaid,
        totalPayment: M + extraPaid,
        balance
      });

      if (balance <= 0) break;
    }

    return { schedule, totalInterest, M, r, n };
  }

  // =============================
  // Validation (fail closed)
  // =============================
  function validateInputs(raw){
    const errors = [];

    const currency = String(raw.currency || 'USD');
    const paymentsPerYear = Number(raw.paymentsPerYear);

    const principal = Number(raw.loanAmount);
    const annualRatePct = Number(raw.interestRate);
    const years = Number(raw.loanTermYears);

    const annualTax = Number(raw.annualTax);
    const annualInsurance = Number(raw.annualInsurance);
    const monthlyPMI = Number(raw.monthlyPMI);
    const monthlyHOA = Number(raw.monthlyHOA);
    const extraPrincipal = Number(raw.extraPrincipal);

    // Required fields
    if (!isFiniteNumber(principal) || principal <= 0) errors.push('Loan amount must be a positive number.');
    if (!isFiniteNumber(annualRatePct) || annualRatePct < 0) errors.push('Interest rate must be a number ≥ 0.');
    if (!isFiniteNumber(years) || years <= 0) errors.push('Loan term must be a positive number of years.');

    // Ranges (defensive)
    if (isFiniteNumber(annualRatePct) && annualRatePct > 50) errors.push('Interest rate above 50% is unusual. Please double-check your input.');
    if (isFiniteNumber(years) && (years < 1 || years > 50)) errors.push('Loan term should be between 1 and 50 years.');

    // Optional costs should not be negative
    const optional = [
      ['Property tax (annual)', annualTax],
      ['Home insurance (annual)', annualInsurance],
      ['PMI (monthly)', monthlyPMI],
      ['HOA dues (monthly)', monthlyHOA],
      ['Extra principal (per payment)', extraPrincipal]
    ];
    for (const [name, v] of optional) {
      if (!isFiniteNumber(v)) errors.push(`${name} must be a valid number (or 0).`);
      else if (v < 0) errors.push(`${name} cannot be negative.`);
    }

    // Payment frequency
    const allowed = new Set([12,26,52]);
    if (!allowed.has(paymentsPerYear)) errors.push('Payments per year must be 12, 26, or 52.');

    return {
      ok: errors.length === 0,
      errors,
      value: {
        currency,
        paymentsPerYear,
        principal,
        annualRatePct,
        years,
        annualTax: Math.max(0, annualTax),
        annualInsurance: Math.max(0, annualInsurance),
        monthlyPMI: Math.max(0, monthlyPMI),
        monthlyHOA: Math.max(0, monthlyHOA),
        extraPrincipal: Math.max(0, extraPrincipal)
      }
    };
  }

  // =============================
  // DOM
  // =============================
  const els = {
    yr: document.getElementById('yr'),
    verText: document.getElementById('verText'),
    lastUpdateText: document.getElementById('lastUpdateText'),
    verifiedDateText: document.getElementById('verifiedDateText'),
    verifiedDateText2: document.getElementById('verifiedDateText2'),

    currency: document.getElementById('currency'),
    paymentsPerYear: document.getElementById('paymentsPerYear'),
    loanAmount: document.getElementById('loanAmount'),
    interestRate: document.getElementById('interestRate'),
    loanTermYears: document.getElementById('loanTermYears'),
    annualTax: document.getElementById('annualTax'),
    annualInsurance: document.getElementById('annualInsurance'),
    monthlyPMI: document.getElementById('monthlyPMI'),
    monthlyHOA: document.getElementById('monthlyHOA'),
    extraPrincipal: document.getElementById('extraPrincipal'),

    errorBox: document.getElementById('errorBox'),

    piMonthly: document.getElementById('piMonthly'),
    tiMonthly: document.getElementById('tiMonthly'),
    totalMonthly: document.getElementById('totalMonthly'),
    totalInterest: document.getElementById('totalInterest'),
    totalCost: document.getElementById('totalCost'),
    payoffTime: document.getElementById('payoffTime'),
    firstIntShare: document.getElementById('firstIntShare'),

    calcBtn: document.getElementById('calcBtn'),
    resetBtn: document.getElementById('resetBtn'),
    toggleSchedule: document.getElementById('toggleSchedule'),
    downloadCsv: document.getElementById('downloadCsv'),
    copySummary: document.getElementById('copySummary'),

    scheduleWrap: document.getElementById('scheduleWrap'),
    scheduleBody: document.getElementById('scheduleBody')
  };

  const state = {
    schedule: [],
    currency: 'USD'
  };

  // =============================
  // Rendering
  // =============================
  function showErrors(errors){
    if (!errors || errors.length === 0) {
      els.errorBox.style.display = 'none';
      els.errorBox.textContent = '';
      return;
    }
    els.errorBox.style.display = 'block';
    els.errorBox.innerHTML = `<strong>Please fix the following:</strong><ul style="margin:6px 0 0 18px">${errors.map(e => `<li>${escapeHtml(e)}</li>`).join('')}</ul>`;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (ch) => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[ch]));
  }

  function resetResults(){
    els.piMonthly.textContent = '$0.00';
    els.tiMonthly.textContent = '$0.00';
    els.totalMonthly.textContent = '$0.00';
    els.totalInterest.textContent = '$0.00';
    els.totalCost.textContent = '$0.00';
    els.payoffTime.textContent = '—';
    els.firstIntShare.textContent = '—';
    els.scheduleBody.innerHTML = '';
    els.scheduleWrap.style.display = 'none';
    els.toggleSchedule.textContent = 'View amortization schedule';
    els.downloadCsv.disabled = true;
    state.schedule = [];
  }

  function renderSchedule(){
    const tbody = els.scheduleBody;
    tbody.innerHTML = '';

    const maxRows = Math.min(state.schedule.length, 360);
    const frag = document.createDocumentFragment();

    for (let i = 0; i < maxRows; i++){
      const r = state.schedule[i];
      const tr = document.createElement('tr');
      const cells = [
        r.paymentNumber,
        fmtCurrency(r.totalPayment, state.currency),
        fmtCurrency(r.interest, state.currency),
        fmtCurrency(r.principal, state.currency),
        fmtCurrency(r.extra, state.currency),
        fmtCurrency(r.balance, state.currency)
      ];

      for (const c of cells){
        const td = document.createElement('td');
        td.textContent = String(c);
        tr.appendChild(td);
      }
      frag.appendChild(tr);
    }
    tbody.appendChild(frag);
  }

  function toCsv(){
    const lines = [['PaymentNumber','TotalPayment','Interest','Principal','Extra','Balance']];
    for (const r of state.schedule){
      lines.push([
        r.paymentNumber,
        r.totalPayment.toFixed(2),
        r.interest.toFixed(2),
        r.principal.toFixed(2),
        r.extra.toFixed(2),
        r.balance.toFixed(2)
      ]);
    }
    return lines.map(a => a.join(',')).join('\n');
  }

  function download(filename, text){
    const blob = new Blob([text], { type:'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // =============================
  // Compute
  // =============================
  function compute(){
    const v = validateInputs({
      currency: els.currency.value,
      paymentsPerYear: els.paymentsPerYear.value,
      loanAmount: els.loanAmount.value,
      interestRate: els.interestRate.value,
      loanTermYears: els.loanTermYears.value,
      annualTax: els.annualTax.value,
      annualInsurance: els.annualInsurance.value,
      monthlyPMI: els.monthlyPMI.value,
      monthlyHOA: els.monthlyHOA.value,
      extraPrincipal: els.extraPrincipal.value
    });

    if (!v.ok){
      showErrors(v.errors);
      resetResults();
      return;
    }
    showErrors([]);

    const {
      currency, paymentsPerYear, principal, annualRatePct, years,
      annualTax, annualInsurance, monthlyPMI, monthlyHOA, extraPrincipal
    } = v.value;

    state.currency = currency;

    const { schedule, totalInterest, M, r, n } = amortizationSchedule({
      principal,
      annualRatePct,
      years,
      paymentsPerYear,
      extraPrincipalPerPayment: extraPrincipal
    });

    // If engine fails, fail closed
    if (!isFiniteNumber(M) || !isFiniteNumber(totalInterest) || schedule.length === 0){
      showErrors(['Calculation failed due to invalid inputs. Please review values and try again.']);
      resetResults();
      return;
    }

    // Convert periodic P&I payment to monthly equivalent for display consistency
    // If monthly: exact. Else: multiply by paymentsPerYear/12 for an equivalent monthly outflow.
    const monthlyPI = M * (paymentsPerYear / 12);

    const monthlyTaxesInsurance = (annualTax + annualInsurance) / 12;
    const monthlyExtras = monthlyTaxesInsurance + monthlyPMI + monthlyHOA;

    const totalMonthlyAllIn = monthlyPI + monthlyExtras;

    state.schedule = schedule;

    const totalCost = principal + totalInterest;

    // First-payment interest share (help users understand why early interest is high)
    const firstRow = schedule[0];
    const firstShare = firstRow ? (firstRow.interest / Math.max(0.01, firstRow.totalPayment)) * 100 : NaN;

    const payoffText = paymentsPerYear === 12
      ? `${schedule.length} months` + (extraPrincipal > 0 ? ` (saved ${Math.max(0, n - schedule.length)} payments)` : '')
      : `${schedule.length} payments (${monthsToHuman(schedule.length, paymentsPerYear)})` + (extraPrincipal > 0 ? ` (saved ${Math.max(0, n - schedule.length)} payments)` : '');

    // Render KPIs
    els.piMonthly.textContent = fmtCurrency(monthlyPI, currency);
    els.tiMonthly.textContent = fmtCurrency(monthlyExtras, currency);
    els.totalMonthly.textContent = fmtCurrency(totalMonthlyAllIn, currency);
    els.totalInterest.textContent = fmtCurrency(totalInterest, currency);
    els.totalCost.textContent = fmtCurrency(totalCost, currency);
    els.payoffTime.textContent = payoffText;
    els.firstIntShare.textContent = isFiniteNumber(firstShare) ? fmtPercent(firstShare) : '—';

    els.downloadCsv.disabled = false;

    // If schedule currently visible, re-render it
    if (els.scheduleWrap.style.display === 'block'){
      renderSchedule();
    }

    // Let MathJax refresh if present (no hard dependency)
    if (window.MathJax && window.MathJax.typesetPromise){
      window.MathJax.typesetPromise().catch(() => {});
    }
  }

  // =============================
  // Regression checks (minimal but real)
  // =============================
  function runGoldenTests(){
    // These are not “certifications”; they ensure engine stability across updates.
    const tests = [
      {
        name: 'Zero rate sanity',
        in: { principal: 120000, annualRatePct: 0, years: 10, paymentsPerYear: 12 },
        expect: { monthlyPI: 1000 } // 120,000 / 120 = 1,000
      },
      {
        name: 'Basic fixed-rate sanity',
        in: { principal: 100000, annualRatePct: 6, years: 30, paymentsPerYear: 12 },
        // Known ballpark: ~599.55 (standard amortization)
        expect: { monthlyPIRange: [595, 605] }
      }
    ];

    let passed = 0;
    for (const t of tests){
      const { M } = periodicPaymentFixedRate(t.in);
      const monthlyPI = M * (t.in.paymentsPerYear / 12);
      let ok = true;

      if (t.expect.monthlyPI != null){
        ok = Math.abs(monthlyPI - t.expect.monthlyPI) < 1e-6;
      }
      if (t.expect.monthlyPIRange){
        const [a,b] = t.expect.monthlyPIRange;
        ok = monthlyPI >= a && monthlyPI <= b;
      }

      if (ok) passed++;
      else console.warn('[GoldenTest FAIL]', t.name, { monthlyPI });
    }

    // Only log in console (no UI claims); this is for you during maintenance.
    console.info(`[GoldenTests] ${passed}/${tests.length} passed (version ${META.version})`);
  }

  // =============================
  // Events
  // =============================
  function resetAll(){
    els.currency.value = 'USD';
    els.paymentsPerYear.value = '12';
    els.loanAmount.value = '350000';
    els.interestRate.value = '6.5';
    els.loanTermYears.value = '30';
    els.annualTax.value = '0';
    els.annualInsurance.value = '0';
    els.monthlyPMI.value = '0';
    els.monthlyHOA.value = '0';
    els.extraPrincipal.value = '0';
    showErrors([]);
    resetResults();
    compute();
  }

  els.calcBtn.addEventListener('click', compute);

  // Optional: compute on input for responsiveness, but keep fail-closed.
  for (const el of [
    els.currency, els.paymentsPerYear, els.loanAmount, els.interestRate, els.loanTermYears,
    els.annualTax, els.annualInsurance, els.monthlyPMI, els.monthlyHOA, els.extraPrincipal
  ]){
    el.addEventListener('input', () => {
      // Avoid excessive churn while typing huge numbers: small debounce
      window.clearTimeout(el.__t);
      el.__t = window.setTimeout(compute, 120);
    });
  }

  els.resetBtn.addEventListener('click', resetAll);

  els.toggleSchedule.addEventListener('click', () => {
    const visible = els.scheduleWrap.style.display === 'block';
    if (!visible){
      els.scheduleWrap.style.display = 'block';
      els.toggleSchedule.textContent = 'Hide amortization schedule';
      renderSchedule();
    } else {
      els.scheduleWrap.style.display = 'none';
      els.toggleSchedule.textContent = 'View amortization schedule';
    }
  });

  els.downloadCsv.addEventListener('click', () => {
    if (!state.schedule || state.schedule.length === 0) return;
    download('mortgage-amortization-schedule.csv', toCsv());
  });

  els.copySummary.addEventListener('click', async () => {
    const lines = [
      'Mortgage Payment Summary',
      `Loan amount: ${els.loanAmount.value}`,
      `Interest rate: ${els.interestRate.value}%`,
      `Term: ${els.loanTermYears.value} years`,
      `Payments/year: ${els.paymentsPerYear.value}`,
      `Monthly P&I (equiv): ${els.piMonthly.textContent}`,
      `Monthly extras: ${els.tiMonthly.textContent}`,
      `Total monthly: ${els.totalMonthly.textContent}`,
      `Total interest (loan): ${els.totalInterest.textContent}`,
      `Payoff: ${els.payoffTime.textContent}`,
      `Verified by ${META.verifiedByName} on ${META.lastCodeUpdateISO}`
    ];
    const text = lines.join('\n');

    try{
      await navigator.clipboard.writeText(text);
      const old = els.copySummary.textContent;
      els.copySummary.textContent = 'Copied';
      window.setTimeout(() => els.copySummary.textContent = old, 1200);
    } catch {
      alert('Copy failed. Please copy manually.');
    }
  });

  // =============================
  // Boot
  // =============================
  els.yr.textContent = String(new Date().getFullYear());
  els.verText.textContent = META.version;
  els.lastUpdateText.textContent = META.lastCodeUpdateISO;
  els.verifiedDateText.textContent = META.lastCodeUpdateISO;
  els.verifiedDateText2.textContent = META.lastCodeUpdateISO;

  resetResults();
  runGoldenTests();
  compute();
})();
</script>
</body></html>