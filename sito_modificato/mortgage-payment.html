<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mortgage Payment Calculator (PITI + Amortization) | CalcDomain</title>
  <meta name="description" content="Calculate monthly mortgage payments including principal, interest, taxes, insurance, and HOA. Features interactive amortization schedule and payoff analysis.">
  
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    :root {
      /* Palette */
      --bg: #f8fafc;
      --surface: #ffffff;
      --surface-subtle: #f1f5f9;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --border: #e2e8f0;
      --focus-ring: rgba(37, 99, 235, 0.2);
      
      /* Spacing & Radius */
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-sans);
      color: var(--text-main);
      background: var(--bg);
      line-height: 1.5;
    }

    /* Layout Utilities */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    
    header {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 50;
    }
    
    .nav { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }
    .brand { font-weight: 800; font-size: 20px; color: var(--primary); text-decoration: none; }
    
    /* Main Grid Layout */
    .page-layout {
      display: grid;
      grid-template-columns: 1fr 300px; /* Main content vs Sidebar */
      gap: 24px;
      margin-top: 24px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 900px) {
      .page-layout { grid-template-columns: 1fr; }
    }

    /* Calculator Specific Grid */
    .calc-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr; /* Inputs vs Results */
      gap: 24px;
      align-items: start;
    }

    @media (max-width: 768px) {
      .calc-grid { grid-template-columns: 1fr; }
    }

    /* Cards */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
    }

    /* Form Elements */
    h1 { margin: 0 0 10px; font-size: 26px; letter-spacing: -0.5px; }
    h2 { font-size: 18px; margin: 20px 0 10px; color: var(--text-main); }
    .sub-text { color: var(--text-muted); font-size: 15px; margin-bottom: 20px; }
    
    label { display: block; font-size: 13px; font-weight: 500; color: var(--text-muted); margin-bottom: 6px; }
    
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    @media (max-width: 500px) { .input-row { grid-template-columns: 1fr; } }
    
    input, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.2s;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--focus-ring);
    }

    /* Special Sections */
    .optional-costs {
      background: var(--surface-subtle);
      padding: 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-bottom: 16px;
    }

    .settings-details summary {
      cursor: pointer;
      color: var(--primary);
      font-size: 14px;
      font-weight: 600;
      padding: 8px 0;
      list-style: none; /* Hide default triangle in some browsers */
    }
    .settings-details summary::-webkit-details-marker { display: none; }
    .settings-details[open] summary { margin-bottom: 10px; }

    /* Results Column */
    .sticky-results {
      position: sticky;
      top: 90px; /* Offset for header */
    }

    .total-box {
      text-align: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .total-label { font-size: 13px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; }
    .total-value { font-size: 42px; font-weight: 800; color: var(--text-main); line-height: 1.1; margin-top: 8px; }

    .kpi-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; }
    .kpi-row span:last-child { font-weight: 700; }
    
    .divider { height: 1px; background: var(--border); margin: 20px 0; }

    /* Buttons */
    .btn {
      width: 100%;
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
    }
    .btn:hover { background: var(--primary-hover); }
    
    .btn-secondary {
      background: white;
      color: var(--text-main);
      border: 1px solid var(--border);
      margin-top: 10px;
    }
    .btn-secondary:hover { background: var(--surface-subtle); }
    .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Error Handling */
    .alert {
      display: none;
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      color: #991b1b;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    /* Amortization Table */
    .table-container {
      margin-top: 30px;
      overflow-x: auto;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      display: none; /* Hidden by default */
    }
    table { width: 100%; border-collapse: collapse; font-size: 14px; background: var(--surface); }
    th { background: var(--surface-subtle); text-align: left; padding: 12px; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--border); }
    td { padding: 12px; border-bottom: 1px solid var(--border); white-space: nowrap; }
    tr:nth-child(even) { background: #f8fafc; }

    /* Footer / Meta / Prose */
    .prose { margin-top: 40px; }
    .prose h3 { font-size: 18px; margin-bottom: 10px; }
    .prose p { color: var(--text-muted); font-size: 15px; }
    
    .meta-footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border); font-size: 13px; color: var(--text-muted); }
    .badge { display: inline-flex; align-items: center; gap: 6px; background: white; border: 1px solid var(--border); padding: 4px 10px; border-radius: 20px; margin-right: 10px; }

    /* Utilities */
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
    .text-right { text-align: right; }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <nav class="nav">
        <a href="/" class="brand">CalcDomain</a>
        <div style="font-size:14px; color:var(--text-muted);">Finance / Mortgages</div>
      </nav>
    </div>
  </header>

  <div class="container">
    <div class="page-layout">
      
      <main>
        <h1>Mortgage Payment Calculator</h1>
        <p class="sub-text">Calculate your monthly P&I, include taxes and insurance, and view your amortization schedule.</p>

        <div id="errorBox" class="alert"></div>

        <div class="calc-grid">
          
          <div class="card">
            
            <div class="input-row">
              <div>
                <label for="loanAmount">Loan Amount</label>
                <input type="number" id="loanAmount" value="350000" step="1000">
              </div>
              <div>
                <label for="interestRate">Interest Rate (%)</label>
                <input type="number" id="interestRate" value="6.5" step="0.125">
              </div>
            </div>
            
            <div class="input-row">
              <div>
                <label for="loanTermYears">Loan Term (Years)</label>
                <input type="number" id="loanTermYears" value="30">
              </div>
              <div>
                <label for="extraPrincipal">Extra Principal / Mo</label>
                <input type="number" id="extraPrincipal" value="0" placeholder="Optional">
              </div>
            </div>

            <div class="optional-costs">
              <div style="font-weight:600; font-size:14px; margin-bottom:12px;">Escrow & Fees (Optional)</div>
              
              <div class="input-row">
                <div>
                  <label for="annualTax">Property Tax (Annual)</label>
                  <input type="number" id="annualTax" value="0" placeholder="0">
                </div>
                <div>
                  <label for="annualInsurance">Home Insurance (Annual)</label>
                  <input type="number" id="annualInsurance" value="0" placeholder="0">
                </div>
              </div>
              
              <div class="input-row" style="margin-bottom:0">
                <div>
                  <label for="monthlyPMI">PMI (Monthly)</label>
                  <input type="number" id="monthlyPMI" value="0" placeholder="0">
                </div>
                <div>
                  <label for="monthlyHOA">HOA Dues (Monthly)</label>
                  <input type="number" id="monthlyHOA" value="0" placeholder="0">
                </div>
              </div>
            </div>

            <details class="settings-details">
              <summary>‚öôÔ∏è Advanced Settings (Currency, Frequency)</summary>
              <div class="input-row" style="margin-top:10px;">
                <div>
                  <label for="currency">Currency</label>
                  <select id="currency">
                    <option value="USD" selected>USD ($)</option>
                    <option value="EUR">EUR (‚Ç¨)</option>
                    <option value="GBP">GBP (¬£)</option>
                    <option value="CAD">CAD ($)</option>
                  </select>
                </div>
                <div>
                  <label for="paymentsPerYear">Payment Frequency</label>
                  <select id="paymentsPerYear">
                    <option value="12" selected>Monthly (12/yr)</option>
                    <option value="26">Bi-Weekly (26/yr)</option>
                    <option value="52">Weekly (52/yr)</option>
                  </select>
                </div>
              </div>
            </details>

            <div style="margin-top:24px; display:flex; gap:12px;">
              <button id="calcBtn" class="btn">Calculate Payment</button>
              <button id="resetBtn" class="btn btn-secondary" style="width:auto; margin-top:0;">Reset</button>
            </div>
          </div>

          <div class="card sticky-results">
            <div class="total-box">
              <div class="total-label">Estimated Monthly Payment</div>
              <div class="total-value" id="totalMonthly">$0.00</div>
            </div>

            <div class="kpi-row">
              <span style="color:var(--text-muted)">Principal & Interest</span>
              <span id="piMonthly">$0.00</span>
            </div>
            <div class="kpi-row">
              <span style="color:var(--text-muted)">Taxes / Ins / HOA</span>
              <span id="tiMonthly">$0.00</span>
            </div>

            <div class="divider"></div>

            <div class="kpi-row">
              <span style="color:var(--text-muted)">Total Interest Cost</span>
              <span id="totalInterest">$0.00</span>
            </div>
            <div class="kpi-row">
              <span style="color:var(--text-muted)">Payoff Date</span>
              <span id="payoffTime">‚Äî</span>
            </div>

            <button id="toggleSchedule" class="btn btn-secondary">View Amortization Schedule</button>
            <button id="downloadCsv" class="btn btn-secondary" disabled>Download CSV</button>
          </div>

        </div> <div id="scheduleWrap" class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Total Payment</th>
                <th>Interest</th>
                <th>Principal</th>
                <th>Extra</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody id="scheduleBody"></tbody>
          </table>
          <div style="padding:12px; font-size:13px; color:var(--text-muted); background:#f8fafc;">
            Showing first 360 payments for performance. Download CSV for full schedule.
          </div>
        </div>

        <div class="prose">
          <h3>How to use this calculator</h3>
          <p>
            This tool computes your <strong>Principal & Interest (P&I)</strong> based on the standard amortization formula. 
            You can optionally add "Escrow" items (Property Tax, Homeowners Insurance) and monthly fees (HOA, PMI) to see your total "out-the-door" monthly cost.
          </p>
          <p>
            <strong>Note on Extra Payments:</strong> Entering a value in "Extra Principal" assumes you pay that amount <em>every month</em> on top of your regular payment. This reduces your loan term and total interest paid.
          </p>
        </div>

        <div class="meta-footer">
          <details style="margin-bottom:12px;">
            <summary style="cursor:pointer; color:var(--primary);"><strong>View Formula & Sources</strong></summary>
            <div style="margin-top:10px; background:white; padding:15px; border:1px solid var(--border); border-radius:8px;">
              <p>Standard Amortization Formula:</p>
              \[ M = P \cdot \frac{r(1+r)^{n}}{(1+r)^{n}-1} \]
              <ul style="margin-top:10px; padding-left:20px;">
                <li>$P$: Loan Principal</li>
                <li>$r$: Monthly Interest Rate (Annual Rate / 12)</li>
                <li>$n$: Total Number of Payments (Years √ó 12)</li>
              </ul>
              <p>Source: <a href="https://www.consumerfinance.gov/" target="_blank" rel="nofollow">Consumer Financial Protection Bureau (CFPB)</a></p>
            </div>
          </details>

          <div style="display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
             <span class="badge">‚úÖ Verified by Ugo Candido</span>
             <span class="badge">üìÖ Updated: 2026-01-19</span>
             <span class="badge">v1.0.0</span>
          </div>
        </div>

      </main>

      <aside>
        <div class="card">
          <h3 style="margin-top:0; font-size:16px;">Related Tools</h3>
          <ul style="list-style:none; padding:0; margin:0; line-height:2;">
            <li><a href="#" style="color:var(--primary); text-decoration:none;">Mortgage Affordability</a></li>
            <li><a href="#" style="color:var(--primary); text-decoration:none;">Refinance Calculator</a></li>
            <li><a href="#" style="color:var(--primary); text-decoration:none;">Debt-to-Income Ratio</a></li>
            <li><a href="#" style="color:var(--primary); text-decoration:none;">Rent vs. Buy</a></li>
          </ul>
        </div>
      </aside>

    </div>
  </div>

<script>
(() => {
  'use strict';

  // --- Utility Functions ---
  function isFiniteNumber(x) { return typeof x === 'number' && Number.isFinite(x); }
  
  function fmtCurrency(value, currency) {
    try {
      return new Intl.NumberFormat('en-US', { style:'currency', currency, maximumFractionDigits: 2 }).format(value);
    } catch {
      return '$' + (Math.round(value * 100) / 100).toFixed(2);
    }
  }

  function monthsToHuman(totalPayments, paymentsPerYear) {
    const years = totalPayments / paymentsPerYear;
    const wholeYears = Math.floor(years);
    const remMonths = Math.round((years - wholeYears) * 12);
    if (wholeYears <= 0) return `${remMonths} months`;
    if (remMonths <= 0) return `${wholeYears} years`;
    return `${wholeYears} yrs ${remMonths} mos`;
  }

  // --- Calculation Engine ---
  function periodicPaymentFixedRate({ principal, annualRatePct, years, paymentsPerYear }) {
    const P = principal;
    const n = Math.round(years * paymentsPerYear);
    const r = (annualRatePct / 100) / paymentsPerYear;

    if (n <= 0) return { M: NaN, r, n };
    if (r === 0) return { M: P / n, r, n };

    const pow = Math.pow(1 + r, n);
    const M = P * r * pow / (pow - 1);
    return { M, r, n };
  }

  function amortizationSchedule({ principal, annualRatePct, years, paymentsPerYear, extraPrincipalPerPayment }) {
    const { M, r, n } = periodicPaymentFixedRate({ principal, annualRatePct, years, paymentsPerYear });
    if (!isFiniteNumber(M)) return { schedule: [], totalInterest: NaN, M, r, n };

    const extra = Math.max(0, extraPrincipalPerPayment);
    const schedule = [];
    let balance = principal;
    let totalInterest = 0;
    let k = 0;
    const maxIter = n + 1200; // Safety break

    while (balance > 0.01 && k < maxIter) {
      k++;
      const interest = r * balance;
      let principalPaid = M - interest;
      if (principalPaid < 0) principalPaid = 0;

      let extraPaid = extra;
      const maxPayable = balance;
      const totalPrincipal = principalPaid + extraPaid;

      // Adjust final payment
      if (totalPrincipal > maxPayable) {
        extraPaid = Math.max(0, maxPayable - principalPaid);
        if (principalPaid > maxPayable) principalPaid = maxPayable;
      }

      balance = Math.max(0, balance - principalPaid - extraPaid);
      totalInterest += interest;

      schedule.push({
        paymentNumber: k,
        totalPayment: M + extraPaid, // Note: This simplifies final payment logic slightly for display
        interest,
        principal: principalPaid,
        extra: extraPaid,
        balance
      });
    }

    return { schedule, totalInterest, M, r, n };
  }

  // --- Input Validation ---
  function validateInputs(raw) {
    const errors = [];
    const val = (id) => {
      const el = document.getElementById(id);
      return el ? Number(el.value) : 0;
    };

    const inputs = {
      currency: document.getElementById('currency').value,
      paymentsPerYear: val('paymentsPerYear'),
      principal: val('loanAmount'),
      annualRatePct: val('interestRate'),
      years: val('loanTermYears'),
      annualTax: val('annualTax'),
      annualInsurance: val('annualInsurance'),
      monthlyPMI: val('monthlyPMI'),
      monthlyHOA: val('monthlyHOA'),
      extraPrincipal: val('extraPrincipal')
    };

    if (inputs.principal <= 0) errors.push('Loan amount must be positive.');
    if (inputs.years <= 0 || inputs.years > 50) errors.push('Loan term must be between 1 and 50 years.');
    if (inputs.annualRatePct < 0) errors.push('Interest rate cannot be negative.');

    return { ok: errors.length === 0, errors, value: inputs };
  }

  // --- UI Interaction ---
  const els = {
    errorBox: document.getElementById('errorBox'),
    piMonthly: document.getElementById('piMonthly'),
    tiMonthly: document.getElementById('tiMonthly'),
    totalMonthly: document.getElementById('totalMonthly'),
    totalInterest: document.getElementById('totalInterest'),
    payoffTime: document.getElementById('payoffTime'),
    scheduleWrap: document.getElementById('scheduleWrap'),
    scheduleBody: document.getElementById('scheduleBody'),
    downloadCsv: document.getElementById('downloadCsv'),
    toggleSchedule: document.getElementById('toggleSchedule')
  };

  let currentSchedule = [];
  let currentCurrency = 'USD';

  function renderSchedule() {
    els.scheduleBody.innerHTML = '';
    const maxRows = Math.min(currentSchedule.length, 360);
    const frag = document.createDocumentFragment();

    for (let i = 0; i < maxRows; i++) {
      const r = currentSchedule[i];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.paymentNumber}</td>
        <td>${fmtCurrency(r.totalPayment, currentCurrency)}</td>
        <td>${fmtCurrency(r.interest, currentCurrency)}</td>
        <td>${fmtCurrency(r.principal, currentCurrency)}</td>
        <td>${fmtCurrency(r.extra, currentCurrency)}</td>
        <td>${fmtCurrency(r.balance, currentCurrency)}</td>
      `;
      frag.appendChild(tr);
    }
    els.scheduleBody.appendChild(frag);
  }

  function compute() {
    const v = validateInputs();
    
    if (!v.ok) {
      els.errorBox.style.display = 'block';
      els.errorBox.innerHTML = v.errors.join('<br>');
      return;
    }
    els.errorBox.style.display = 'none';

    const d = v.value;
    currentCurrency = d.currency;

    const res = amortizationSchedule({
      principal: d.principal,
      annualRatePct: d.annualRatePct,
      years: d.years,
      paymentsPerYear: d.paymentsPerYear,
      extraPrincipalPerPayment: d.extraPrincipal
    });

    if (isNaN(res.M)) return;

    currentSchedule = res.schedule;

    // Monthly Equivalents for Display
    const monthlyPI = res.M * (d.paymentsPerYear / 12);
    const monthlyEscrow = (d.annualTax + d.annualInsurance) / 12 + d.monthlyPMI + d.monthlyHOA;
    const totalMonth = monthlyPI + monthlyEscrow;

    // Update DOM
    els.piMonthly.textContent = fmtCurrency(monthlyPI, d.currency);
    els.tiMonthly.textContent = fmtCurrency(monthlyEscrow, d.currency);
    els.totalMonthly.textContent = fmtCurrency(totalMonth, d.currency);
    els.totalInterest.textContent = fmtCurrency(res.totalInterest, d.currency);
    
    const payoffLabel = d.paymentsPerYear === 12 
      ? monthsToHuman(res.schedule.length, 12) 
      : `${res.schedule.length} payments`;
    els.payoffTime.textContent = payoffLabel;

    els.downloadCsv.disabled = false;
    
    if (els.scheduleWrap.style.display === 'block') renderSchedule();
  }

  // --- Events ---
  document.getElementById('calcBtn').addEventListener('click', compute);
  document.getElementById('resetBtn').addEventListener('click', () => {
    document.querySelectorAll('input').forEach(i => i.value = i.defaultValue);
    compute();
  });

  // Auto-calc on input (debounced)
  let timeout;
  document.querySelectorAll('input, select').forEach(el => {
    el.addEventListener('input', () => {
      clearTimeout(timeout);
      timeout = setTimeout(compute, 200);
    });
  });

  els.toggleSchedule.addEventListener('click', () => {
    const isHidden = els.scheduleWrap.style.display === 'none' || els.scheduleWrap.style.display === '';
    els.scheduleWrap.style.display = isHidden ? 'block' : 'none';
    els.toggleSchedule.textContent = isHidden ? 'Hide Amortization Schedule' : 'View Amortization Schedule';
    if(isHidden) renderSchedule();
  });

  els.downloadCsv.addEventListener('click', () => {
    const header = ['No,TotalPayment,Interest,Principal,Extra,Balance'];
    const rows = currentSchedule.map(r => 
      `${r.paymentNumber},${r.totalPayment.toFixed(2)},${r.interest.toFixed(2)},${r.principal.toFixed(2)},${r.extra.toFixed(2)},${r.balance.toFixed(2)}`
    );
    const csvContent = "data:text/csv;charset=utf-8," + header.concat(rows).join("\n");
    const link = document.createElement("a");
    link.setAttribute("href", encodeURI(csvContent));
    link.setAttribute("download", "mortgage_schedule.csv");
    document.body.appendChild(link);
    link.click();
    link.remove();
  });

  // Init
  compute();

})();
</script>
</body>
</html>