<!DOCTYPE html><html lang="en"><head>
    <link rel="canonical" href="https://calcdomain.com/bai">
    <title>Body Adiposity Index (BAI) Calculator | CalcDomain</title>
    <meta name="description" content="Calculate your Body Adiposity Index (BAI) to understand body fat percentage. Ideal for health enthusiasts and medical diagnostics.">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <meta property="og:type" content="website">
    <meta property="og:title" content="Body Adiposity Index (BAI) Calculator | CalcDomain">
    <meta property="og:description" content="Calculate your Body Adiposity Index (BAI) to understand body fat percentage. Ideal for health enthusiasts and medical diagnostics.">
    <meta property="og:url" content="https://calcdomain.com/bai">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Body Adiposity Index (BAI) Calculator | CalcDomain">
    <meta name="twitter:description" content="Calculate your Body Adiposity Index (BAI) to understand body fat percentage. Ideal for health enthusiasts and medical diagnostics.">

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root {
        --surface: #ffffff;
        --muted: #6b7280;
        --border: #e5e7eb;
        --brand: #2563eb;
        --brand-dark: #1d4ed8;
        --shadow: 0 10px 25px -10px rgba(15, 23, 42, 0.15);
      }
      body {
        font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
        background: #f8fafc;
        color: #111827;
        margin: 0;
      }
      .container { max-width: 1200px; }
      .nav { display: flex; justify-content: space-between; align-items: center; }
      .brand { font-size: 1.5rem; font-weight: 700; color: var(--brand); }
      .navRight { display: flex; gap: 1rem; align-items: center; }
      .pill { color: #4b5563; font-weight: 600; }
      .calc-hero { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 1.5rem; }
      @media (max-width: 1024px) { .calc-hero { grid-template-columns: 1fr; } }
      .card { background: var(--surface); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; box-shadow: var(--shadow); }
      .sticky-box { position: sticky; top: 1rem; }
      .calc-input { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.95rem; }
      .calc-input:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); }
      .calc-label { display: block; font-size: 0.85rem; font-weight: 600; color: #475569; margin-bottom: 0.35rem; }
      .btn { border: none; font-size: 0.95rem; font-weight: 700; border-radius: 0.65rem; }
      .btn-primary { background: var(--brand); color: #fff; padding: 0.9rem 1rem; cursor: pointer; }
      .btn-primary:hover { background: var(--brand-dark); }
      .btn-secondary { border: 1px solid var(--border); background: #fff; padding: 0.9rem 1rem; color: #111827; cursor: pointer; }
      .btn-secondary:hover { background: #f1f5f9; }
      .btnSecondary { }
      .alert { border-radius: 0.75rem; padding: 0.75rem 1rem; font-size: 0.95rem; margin-top: 0.5rem; border: 1px solid transparent; }
      .alert-error { background: #fef2f2; border-color: #fecdd3; color: #991b1b; display: none; }
      .result-box { background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border: 1px solid #c7d2fe; border-radius: 1rem; padding: 1.5rem; text-align: center; }
      .result-value { font-size: 2.75rem; font-weight: 800; color: #1e3a8a; }
      .kpi-row { display: flex; justify-content: space-between; padding: 0.65rem 0; border-bottom: 1px solid #e5e7eb; font-size: 0.9rem; }
      .kpi-row:last-child { border-bottom: none; }
      .kpi-label { color: #475569; }
      .kpi-value { font-weight: 700; color: #111827; }
      .schedule-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
      .schedule-table th, .schedule-table td { border-bottom: 1px solid #e5e7eb; padding: 0.75rem; text-align: left; }
      .schedule-table th { background: #f8fafc; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
      .sub { font-size: 1.1rem; color: #475569; max-width: 70ch; }
      .meta-section { background: #fff; }
      .content-card { background: #fff; }
      .formula-box { background: #0b1220; color: #e5e7eb; padding: 1rem; border-radius: 0.75rem; font-family: ui-monospace, Menlo, Consolas; overflow-x: auto; }
    </style>

    <script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Body Adiposity Index (BAI) Calculator",
      "description": "Calculate your Body Adiposity Index (BAI) to understand body fat percentage.",
      "url": "https://calcdomain.com/bai",
      "mainEntity": {
        "@type": "WebPageElement",
        "name": "BAI Calculator"
      },
      "reviewedBy": {
        "@type": "Person",
        "name": "Ugo Candido"
      },
      "dateModified": "2026-01-19"
    }</script>

  </head>
  <body class="bg-gray-50 text-gray-900">
    <header id="siteHeader" class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="nav container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a class="brand" href="https://calcdomain.com">CalcDomain</a>
          <div class="navRight hidden md:flex items-center gap-6">
            <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
            <span class="pill">Categories</span>
          </div>
          <button id="mobile-menu-toggle" class="md:hidden p-2" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open menu" type="button">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
        <nav id="mobile-menu" class="md:hidden mt-4 hidden" aria-label="Mobile menu" role="navigation">
          <div class="mb-4">
            <div class="relative">
              <input type="search" placeholder="Search calculators..." class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="off">
            </div>
          </div>
          <div class="space-y-2">
            <a href="https://calcdomain.com/search" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
            <a href="https://calcdomain.com/#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
          </div>
        </nav>
      </nav>
    </header>

    <main id="mainContent" class="container mx-auto px-4 py-8">
      <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600">
        <ol class="flex flex-wrap items-center gap-1">
          <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
          <li class="text-gray-400">/</li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-blue-600 hover:underline">Health &amp; Fitness Calculators</a></li>
          <li class="text-gray-400">/</li>
          <li><span class="text-gray-800">Body Adiposity Index (BAI) Calculator</span></li>
        </ol>
      </nav>

      <div class="space-y-3">
        <h1 id="pageTitle" class="text-3xl font-bold text-gray-900">Body Adiposity Index (BAI) Calculator</h1>
        <p id="pageSub" class="sub">Calculate your Body Adiposity Index (BAI) to understand body fat percentage. Ideal for health enthusiasts and medical diagnostics.</p>
        <div id="errorBox" class="alert alert-error" role="alert" aria-live="polite"></div>
      </div>

      <div class="calc-hero mt-8" id="calcHero" aria-label="Calculator hero">
        <section class="card" id="inputsCard" aria-label="Calculator inputs">
          <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
            <h3 class="text-lg font-bold text-gray-700 mb-4 mt-0">Your Measurements</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="hipCircumference" class="calc-label">Hip Circumference (cm)</label>
                <input id="hipCircumference" class="calc-input" type="number" value="95" min="0" step="0.1" inputmode="decimal">
              </div>
              <div>
                <label for="height" class="calc-label">Height (m)</label>
                <input id="height" class="calc-input" type="number" value="1.75" min="0" step="0.01" inputmode="decimal">
              </div>
            </div>
            <div class="flex gap-3 mt-6">
              <button class="btn btn-primary flex-1" id="calcBtn" type="button">Calculate</button>
              <button class="btn btn-secondary flex-1 btnSecondary" id="resetBtn" type="button">Reset</button>
            </div>
          </div>
          <div data-canon-btnrow="1" style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;"></div>
        </section>

        <section class="card sticky-box" id="resultsCard" aria-label="Calculator results">
          <div class="result-box mb-4">
            <div class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Body Adiposity Index (BAI)</div>
            <div class="result-value" id="baiResult">—</div>
            <p class="text-sm text-gray-600 mt-2" id="baiCategory">Enter your measurements above and hit Calculate.</p>
          </div>
          <div class="bg-white border border-gray-200 rounded-lg p-4">
            <div class="kpi-row">
              <span class="kpi-label">Hip Circumference</span>
              <span class="kpi-value" id="hipSummary">— cm</span>
            </div>
            <div class="kpi-row">
              <span class="kpi-label">Height</span>
              <span class="kpi-value" id="heightSummary">— m</span>
            </div>
            <div class="kpi-row">
              <span class="kpi-label">Formula</span>
              <span class="kpi-value">Hip / Height¹·⁵ − 18</span>
            </div>
          </div>
          <div class="flex gap-3 mt-4">
            <button class="btn btn-secondary flex-1" id="toggleSchedule" type="button">View Calculation Breakdown</button>
            <button class="btn btn-secondary flex-1" id="downloadCsv" type="button" disabled>Download CSV</button>
          </div>
        </section>
      </div>

      <div id="scheduleWrap" class="mt-6 overflow-x-auto border border-gray-200 rounded-lg tableWrap" style="display: none;" aria-label="Calculation breakdown">
        <table class="schedule-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Metric</th>
              <th>Value</th>
              <th>Unit</th>
              <th>Formula</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="scheduleBody"></tbody>
        </table>
        <div class="p-3 text-gray-500 text-sm bg-gray-50">Displays the inputs, intermediate steps, and computed BAI. Download CSV for a reference copy.</div>
      </div>

      <section class="mt-10">
        <section class="card content-card space-y-6" id="howToUse" aria-label="How to use and methodology">
          <h2 class="text-2xl font-semibold">How to Use This Calculator</h2>
          <p>Enter your hip circumference and height as measured in metric units. Click Calculate to see your Body Adiposity Index (BAI), which approximates body fat percentage without using weight.</p>
          <h2 class="text-2xl font-semibold mt-6">Methodology</h2>
          <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
            <p>The calculator applies the formula published by Richard N. Bergman and colleagues: the hip circumference (in centimeters) is divided by height (meters) to the power of 1.5, then 18 is subtracted to yield the BAI.</p>
          </div>
          <p class="text-sm text-gray-600">Results are rounded to two decimal places and are intended for personal insight; consult a medical professional for clinical assessments.</p>

          <section>
            <h3 class="text-xl font-semibold">Full original guide (expanded)</h3>
            <p>Use this calculator to determine your Body Adiposity Index (BAI), which helps you measure body fat percentage based on your height and hip circumference.</p>
            <section class="mt-4">
              <h4 class="text-lg font-semibold">Source and Methodology</h4>
              <p>All calculations are based on the research by Richard N. Bergman et al., which provides a mathematical model to estimate body fat percentage using hip circumference and height. <a href="https://www.ncbi.nlm.nih.gov/pubmed/21285606" target="_blank" rel="noopener" class="text-blue-600 hover:underline">Read more about the study here</a>.</p>
            </section>
            <section class="mt-4">
              <h4 class="text-lg font-semibold">The Formula Explained</h4>
              <p>The BAI is calculated using the following formula:</p>
              <div class="formula-box">\[ \text{BAI} = \frac{\text{Hip Circumference in cm}}{\text{Height in m}^{1.5}} - 18 \]</div>
            </section>
            <section class="mt-4">
              <h4 class="text-lg font-semibold">Glossary of Terms</h4>
              <ul class="list-disc list-inside text-gray-700">
                <li><strong>Hip Circumference:</strong> The measurement around the widest part of your hips.</li>
                <li><strong>Height:</strong> Your height in meters.</li>
                <li><strong>BAI:</strong> Body Adiposity Index, an estimate of body fat percentage.</li>
              </ul>
            </section>
            <section class="mt-4">
              <h4 class="text-lg font-semibold">How It Works: A Step-by-Step Example</h4>
              <p>For example, if your hip circumference is 95 cm and your height is 1.75 m, your BAI is calculated as:</p>
              <p>\[ \text{BAI} = \frac{95}{1.75^{1.5}} - 18 \]</p>
              <p>This results in a BAI of approximately 24.8, indicating a healthy range.</p>
            </section>
            <section class="mt-4">
              <h4 class="text-lg font-semibold">Frequently Asked Questions (FAQ)</h4>
              <div>
                <h5 class="font-semibold">What is the Body Adiposity Index (BAI)?</h5>
                <p>BAI is a method for estimating body fat percentage using hip circumference and height, without needing weight measurements.</p>
                <h5 class="font-semibold mt-2">How accurate is the BAI?</h5>
                <p>While BAI can provide a general estimation, it may not be as precise as other methods like DXA scans.</p>
                <h5 class="font-semibold mt-2">Can BAI be used for all age groups?</h5>
                <p>BAI is generally suitable for adults but may not be accurate for children or elderly individuals.</p>
                <h5 class="font-semibold mt-2">How does BAI compare to BMI?</h5>
                <p>BAI considers body fat distribution, while BMI only considers weight and height, potentially offering more insight into body composition.</p>
                <h5 class="font-semibold mt-2">Is BAI a replacement for professional medical advice?</h5>
                <p>No, BAI is a tool for personal insight and should not replace professional health evaluations.</p>
              </div>
            </section>
          </section>
        </section>

        <section class="card meta-section space-y-4" id="pageMeta" aria-label="Verification, changelog, formulas, citations">
          <details id="formulaDetails">
            <summary class="cursor-pointer font-bold text-gray-800">Formulas</summary>
            <div class="mt-3 p-3 bg-white border border-gray-200 rounded-lg text-sm">
              <p><strong>BAI formula:</strong></p>
              <p class="font-mono mt-2">\( \text{BAI} = \dfrac{\text{Hip Circumference in cm}}{\text{Height in m}^{1.5}} - 18 \)</p>
              <ul class="list-disc list-inside mt-2 text-gray-600">
                <li>Hip circumference in centimeters</li>
                <li>Height in meters to the 1.5 power</li>
                <li>Subtract 18 to align with percentage estimates</li>
              </ul>
            </div>
          </details>
          <details class="mt-3" id="citationDetails">
            <summary class="cursor-pointer font-bold text-gray-800">Citations</summary>
            <div class="mt-3 p-3 bg-white border border-gray-200 rounded-lg text-sm">
              <p>Study by Bergman et al.: <a href="https://www.ncbi.nlm.nih.gov/pubmed/21285606" target="_blank" rel="noopener" class="text-blue-600 hover:underline">https://www.ncbi.nlm.nih.gov/pubmed/21285606</a></p>
            </div>
          </details>
          <details class="mt-3" id="changelogDetails">
            <summary class="cursor-pointer font-bold text-gray-800">Changelog</summary>
            <div class="mt-3 p-3 bg-white border border-gray-200 rounded-lg text-sm">
              <ul class="list-disc list-inside">
                <li>0.1.0-draft — Initial audit spec draft generated from HTML extraction (review required).</li>
                <li>2026-01-19 — Verified BAI formula and sources, kept graphic layout consistent with CalcDomain design.</li>
              </ul>
            </div>
          </details>
          <div class="flex gap-2 mt-4 flex-wrap">
            <span class="inline-flex items-center gap-1 border border-gray-200 px-3 py-1 rounded-full bg-white text-sm">
              <span class="text-green-600 font-bold">✓</span> Verified by Ugo Candido
            </span>
            <span class="inline-flex items-center border border-gray-200 px-3 py-1 rounded-full bg-white text-sm">Last Updated: 2026-01-19</span>
            <span class="inline-flex items-center border border-gray-200 px-3 py-1 rounded-full bg-white text-sm">Version 0.1.0-draft</span>
          </div>
        
          <div class="badge" id="versionBadge">Version 1.5.0</div></section>
      </section>
    </main>

    <footer id="siteFooter" class="bg-gray-900 text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
            <p class="text-gray-400 mb-4">Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.</p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Categories</h4>
            <ul class="space-y-2">
              <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
              <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health &amp; Fitness</a></li>
              <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math &amp; Conversions</a></li>
              <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle &amp; Everyday</a></li>
              <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction &amp; DIY</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
            <ul class="space-y-2">
              <li><a href="https://calcdomain.com/body-adiposity-index" class="text-gray-400 hover:text-white">Body Adiposity Index</a></li>
              <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
              <li><a href="https://calcdomain.com/body-fat" class="text-gray-400 hover:text-white">Body Fat Calculator</a></li>
              <li><a href="https://calcdomain.com/waist-hip" class="text-gray-400 hover:text-white">Waist to Hip Ratio</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
              <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
              <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
              <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
              <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
            </ul>
          </div>
        </div>
        <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
          <p>© 2026 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
        </div>
      </div>
    </footer>

    <script src="/assets/js/mobile-menu.js"></script>
    <script src="/search.js"></script>

    <script>
      window.MathJax = {
        tex: { inlineMath: [['\\(', '\\)'], ['$', '$']], displayMath: [['$', '$'], ['\\[', '\\]']] },
        svg: { fontCache: 'global' }
      };
    </script>
    <script>
      (function () {
        var loadMathJax = function () {
          if (window.__mathjaxLoading) return;
          window.__mathjaxLoading = true;
          var script = document.createElement('script');
          script.id = 'MathJax-script';
          script.async = true;
          script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js';
          document.head.appendChild(script);
        };
        var target = document.querySelector('.formula-box, .mathjax, .math, .formula, [data-mathjax]');
        if (!target) return;
        if ('IntersectionObserver' in window) {
          var observer = new IntersectionObserver(function (entries) {
            if (entries.some(function (entry) { return entry.isIntersecting; })) {
              observer.disconnect();
              loadMathJax();
            }
          }, { rootMargin: '200px' });
          observer.observe(target);
        } else {
          window.addEventListener('load', function () { setTimeout(loadMathJax, 1000); }, { once: true });
        }
      })();
    </script>

    <script>
      (function () {
        'use strict';

        const defaults = {
          hipCircumference: '95',
          height: '1.75'
        };

        const els = {
          hipCircumference: document.getElementById('hipCircumference'),
          height: document.getElementById('height'),
          calcBtn: document.getElementById('calcBtn'),
          resetBtn: document.getElementById('resetBtn'),
          toggleSchedule: document.getElementById('toggleSchedule'),
          downloadCsv: document.getElementById('downloadCsv'),
          errorBox: document.getElementById('errorBox'),
          baiResult: document.getElementById('baiResult'),
          baiCategory: document.getElementById('baiCategory'),
          hipSummary: document.getElementById('hipSummary'),
          heightSummary: document.getElementById('heightSummary'),
          scheduleWrap: document.getElementById('scheduleWrap'),
          scheduleBody: document.getElementById('scheduleBody')
        };

        const debounce = (fn, delay = 100) => {
          let timer;
          return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => fn(...args), delay);
          };
        };

        const round2 = (value) => Math.round((value + Number.EPSILON) * 100) / 100;

        let currentDetails = [];
        let scheduleVisible = false;

        function parseInputs() {
          return {
            hipCircumference: parseFloat(els.hipCircumference.value),
            height: parseFloat(els.height.value)
          };
        }

        function validate(i) {
          const errors = [];
          if (!Number.isFinite(i.hipCircumference) || i.hipCircumference <= 0) {
            errors.push('Hip circumference must be greater than 0.');
          }
          if (!Number.isFinite(i.height) || i.height <= 0) {
            errors.push('Height must be greater than 0.');
          }
          return { ok: errors.length === 0, errors };
        }

        function compute(inputs) {
          const bai = inputs.hipCircumference / Math.pow(inputs.height, 1.5) - 18;
          return { bai: round2(bai) };
        }

        function categorize(bai) {
          if (bai < 18) return 'Lower than average body fat';
          if (bai < 25) return 'Healthy range for most adults';
          if (bai < 30) return 'Above average body fat';
          return 'High body fat estimate';
        }

        function format(outputs, inputs) {
          return {
            formattedBAI: outputs.bai.toFixed(2),
            category: categorize(outputs.bai),
            hipText: `${round2(inputs.hipCircumference)} cm`,
            heightText: `${round2(inputs.height)} m`
          };
        }

        function renderTable() {
          els.scheduleBody.innerHTML = '';
          if (!currentDetails.length) return;
          const frag = document.createDocumentFragment();
          currentDetails.forEach((row) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${row.step}</td>
              <td>${row.metric}</td>
              <td>${row.value}</td>
              <td>${row.unit}</td>
              <td>${row.formula}</td>
              <td>${row.note}</td>
            `;
            frag.appendChild(tr);
          });
          els.scheduleBody.appendChild(frag);
        }

        function render(formatted, errors) {
          if (!errors) errors = [];
          if (errors.length > 0) {
            els.errorBox.style.display = 'block';
            els.errorBox.textContent = errors.join(' ');
            els.baiResult.textContent = '—';
            els.baiCategory.textContent = 'Enter your measurements above and hit Calculate.';
            els.hipSummary.textContent = '— cm';
            els.heightSummary.textContent = '— m';
            els.downloadCsv.disabled = true;
            return;
          }
          els.errorBox.style.display = 'none';
          els.errorBox.textContent = '';
          els.baiResult.textContent = formatted.formattedBAI;
          els.baiCategory.textContent = formatted.category;
          els.hipSummary.textContent = formatted.hipText;
          els.heightSummary.textContent = formatted.heightText;
          currentDetails = [
            { step: 1, metric: 'Hip Circumference', value: formatted.hipText, unit: 'cm', formula: '', note: 'Input' },
            { step: 2, metric: 'Height', value: formatted.heightText, unit: 'm', formula: '', note: 'Input' },
            { step: 3, metric: 'BAI Result', value: formatted.formattedBAI, unit: '%', formula: 'Hip / Height¹·⁵ − 18', note: formatted.category }
          ];
          els.downloadCsv.disabled = false;
          if (scheduleVisible) renderTable();
        }

        function update() {
          const inputs = parseInputs();
          const validation = validate(inputs);
          if (!validation.ok) {
            render({}, validation.errors);
            return;
          }
          const outputs = compute(inputs);
          if (!Number.isFinite(outputs.bai)) {
            render({}, ['Calculation failed. Please review your inputs.']);
            return;
          }
          const formatted = format(outputs, inputs);
          render(formatted, []);
        }

        els.calcBtn.addEventListener('click', update);
        els.resetBtn.addEventListener('click', () => {
          els.hipCircumference.value = defaults.hipCircumference;
          els.height.value = defaults.height;
    const debouncedUpdate = debounce(update, 100);

    document.querySelectorAll('#inputsCard input, #inputsCard select, #inputsCard textarea')
      .forEach((el) => {
        el.addEventListener('input', debouncedUpdate);
        el.addEventListener('change', debouncedUpdate);
      });

          update();
        });

        els.toggleSchedule.addEventListener('click', () => {
          scheduleVisible = !scheduleVisible;
          els.scheduleWrap.style.display = scheduleVisible ? 'block' : 'none';
          els.toggleSchedule.textContent = scheduleVisible ? 'Hide Calculation Breakdown' : 'View Calculation Breakdown';
          if (scheduleVisible) renderTable();
        });

        els.downloadCsv.addEventListener('click', () => {
          if (!currentDetails.length) return;
          let csv = 'Step,Metric,Value,Unit,Formula,Notes\n';
          currentDetails.forEach((row) => {
            const safe = [row.step, row.metric, row.value, row.unit, row.formula, row.note].map((val) => `"${String(val).replace(/"/g, '""')}"`);
            csv += safe.join(',') + '\n';
          });
          const blob = new Blob([csv], { type: 'text/csv' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'bai-breakdown.csv';
          a.click();
          URL.revokeObjectURL(url);
        });

        el.addEventListener('change', debouncedUpdate);
          });

        update();
      })();
    </script>
  </body></html>
