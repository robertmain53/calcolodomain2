<!DOCTYPE html><html lang="en"><head>
<link rel="canonical" href="https://calcdomain.com/commercial-real-estate">





  <!-- Meta & Icons -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commercial Real Estate Calculator – DSCR, Cap Rate, Cash-on-Cash</title>
  <meta name="description" content="Professional-grade commercial real estate calculator: computes NOI, DSCR, LTV, cap rate, monthly debt service, balloon balance, and cash-on-cash return with an exportable table and clear formulas.">
  
  <meta name="author" content="Ugo Candido">

  <!-- Favicons -->
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg">
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png">
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest">

  <!-- Tailwind & Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer=""></script>

  <!-- MathJax for LaTeX -->
  <script defer="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Fonts & Base Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root{--focus:#2563eb}
    body{font-family:'Inter',system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif}
    .prose{max-width:68ch}
    .prose h2{font-size:1.5rem;font-weight:700;margin-top:2rem;margin-bottom:0.75rem}
    .prose h3{font-size:1.15rem;font-weight:600;margin-top:1.25rem;margin-bottom:0.5rem}
    .prose p{line-height:1.7;margin-bottom:0.9rem}
    .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:10px;padding:1rem;overflow:auto}
    .result-card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;text-align:center}
    .result-card h4{font-size:.9rem;color:#6b7280;margin-bottom:.25rem}
    .result-card p{font-size:1.45rem;font-weight:800;color:#1d4ed8}
    .btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid #cbd5e1;border-radius:10px;padding:.65rem 1rem;font-weight:600}
    .btn-primary{background:#1d4ed8;border-color:#1d4ed8;color:#fff}
    .btn:focus-visible, input:focus-visible, select:focus-visible, button:focus-visible, summary:focus-visible{
      outline:3px solid var(--focus); outline-offset:2px
    }
    .tooltip-panel[hidden]{display:none}
    .error-text{color:#b91c1c}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    /* Prevent CLS in results */
    #results-wrap{min-height:340px}
    @media (min-width:768px){#results-wrap{min-height:280px}}
    @media print{
      body{color:#000}
      header, aside, .no-print{display:none !important}
      #print-section{display:block}
      #resultsChart{display:none !important}
    }
  </style>

  <!-- Structured Data -->
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Commercial Real Estate Calculator",
  "inLanguage": "en",
  "url": "https://calcdomain.com/commercial-real-estate",
  "description": "Compute NOI, DSCR, cap rate, LTV, debt service, balloon balance and cash-on-cash return for commercial properties.",
  "reviewedBy": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "dateModified": "2026-01-19"
}</script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Finance",
      "item": "https://calcdomain.com/categories/finance"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Business Small Biz",
      "item": "https://calcdomain.com/subcategories/business-small-biz"
    }
  ]
}
</script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to analyze a commercial real estate deal",
  "description": "Step-by-step to compute NOI, DSCR, and cash-on-cash using this calculator.",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Enter purchase and income",
      "text": "Fill purchase price, market rent or gross income and vacancy."
    },
    {
      "@type": "HowToStep",
      "name": "Add operating expenses",
      "text": "Input taxes, insurance, management, maintenance and other OPEX."
    },
    {
      "@type": "HowToStep",
      "name": "Set loan terms",
      "text": "Choose LTV or loan amount, interest rate, amortization years and loan term."
    },
    {
      "@type": "HowToStep",
      "name": "Review metrics",
      "text": "Read NOI, DSCR, cap rate, monthly payment, balloon balance and cash-on-cash."
    }
  ]
}
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
      
      </section>
    </section>

    <!-- Sidebar (optional promos/related) -->
    <aside class="mt-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2"></div>
        <div class="bg-white p-6 rounded-lg border">
          <h3 class="font-bold text-lg mb-3">Related finance tools</h3>
          <ul class="space-y-2 text-sm">
            <li><a href="https://calcdomain.com/loan-amortization" class="text-blue-600 hover:underline">Loan Amortization Schedule</a></li>
            <li><a href="https://calcdomain.com/apr" class="text-blue-600 hover:underline">APR Calculator</a></li>
            <li><a href="https://calcdomain.com/cap-rate" class="text-blue-600 hover:underline">Cap Rate Calculator</a></li>
            <li><a href="https://calcdomain.com/dscr" class="text-blue-600 hover:underline">DSCR Calculator</a></li>
          </ul>
        </div>
      </div>
    </aside>
  
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{EGI} = \text{Gross Income} \times (1 - \text{Vacancy})\]</div>
  <pre class="auditspine-mono">\text{EGI} = \text{Gross Income} \times (1 - \text{Vacancy})</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{OPEX} = \text{Taxes}+\text{Insurance}+\text{Utilities}+\text{Repairs}+\text{Management}\ (\% \times \text{EGI})+\text{Other}\]</div>
  <pre class="auditspine-mono">\text{OPEX} = \text{Taxes}+\text{Insurance}+\text{Utilities}+\text{Repairs}+\text{Management}\ (\% \times \text{EGI})+\text{Other}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{NOI} = \text{EGI} + \text{Other Income} - \text{OPEX}\]</div>
  <pre class="auditspine-mono">\text{NOI} = \text{EGI} + \text{Other Income} - \text{OPEX}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{Cap Rate} = \frac{\text{NOI}}{\text{Price}}\]</div>
  <pre class="auditspine-mono">\text{Cap Rate} = \frac{\text{NOI}}{\text{Price}}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{DSCR} = \frac{\text{NOI}}{\text{Annual Debt Service}}\]</div>
  <pre class="auditspine-mono">\text{DSCR} = \frac{\text{NOI}}{\text{Annual Debt Service}}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[PMT = L \cdot \frac{i}{1-(1+i)^{-n}},\quad \text{Balloon at term }(t)= L(1+i)^t - PMT\cdot \frac{(1+i)^t - 1}{i}\]</div>
  <pre class="auditspine-mono">PMT = L \cdot \frac{i}{1-(1+i)^{-n}},\quad \text{Balloon at term }(t)= L(1+i)^t - PMT\cdot \frac{(1+i)^t - 1}{i}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">\[ \text{EGI} = \text{Gross Income} \times (1 - \text{Vacancy}) \] \[ \text{OPEX} = \text{Taxes}+\text{Insurance}+\text{Utilities}+\text{Repairs}+\text{Management}\ (\% \times \text{EGI})+\text{Other} \] \[ \text{NOI} = \text{EGI} + \text{Other Income} - \text{OPEX} \] \[ \text{Cap Rate} = \frac{\text{NOI}}{\text{Price}} \] \[ \text{DSCR} = \frac{\text{NOI}}{\text{Annual Debt Service}} \] \[ PMT = L \cdot \frac{i}{1-(1+i)^{-n}},\quad \text{Balloon at term }(t)= L(1+i)^t - PMT\cdot \frac{(1+i)^t - 1}{i} \] \[ \text{Cash-on-Cash} = \frac{\text{NOI} - \text{Annual Debt Service}}{\text{Cash Invested}} \]</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">P</span> = principal (loan amount) <em>(currency)</em></li>
<li><span class="auditspine-mono">r</span> = periodic interest rate (annual rate ÷ payments per year) <em>(1)</em></li>
<li><span class="auditspine-mono">n</span> = total number of payments (years × payments per year) <em>(count)</em></li>
<li><span class="auditspine-mono">M</span> = periodic payment for principal + interest <em>(currency)</em></li>
<li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
<li><span class="auditspine-mono">I</span> = homeowners insurance (annual or monthly depending on input) <em>(currency)</em></li>
<li><span class="auditspine-mono">HOA</span> = homeowners association dues (monthly) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Home</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/" target="_blank" rel="nofollow noopener">https://calcdomain.com/</a></li>
<li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>Business Small Biz</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/business-small-biz" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/business-small-biz</a></li>
<li><strong>Official OCC resource</strong> — occ.treas.gov · Accessed 2026-01-19<br><a href="https://www.occ.treas.gov/publications-and-resources/publications/comptrollers-handbook/files/commercial-real-estate-lending/index-commercial-real-estate-lending.html" target="_blank" rel="nofollow noopener">https://www.occ.treas.gov/publications-and-resources/publications/comptrollers-handbook/files/commercial-real-estate-lending/index-commercial-real-estate-lending.html</a></li>
<li><strong>Loan Amortization Schedule</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/loan-amortization" target="_blank" rel="nofollow noopener">https://calcdomain.com/loan-amortization</a></li>
<li><strong>APR Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/apr" target="_blank" rel="nofollow noopener">https://calcdomain.com/apr</a></li>
<li><strong>Cap Rate Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/cap-rate" target="_blank" rel="nofollow noopener">https://calcdomain.com/cap-rate</a></li>
<li><strong>DSCR Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/dscr" target="_blank" rel="nofollow noopener">https://calcdomain.com/dscr</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</main>

  <footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                                                                                                <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction & DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health & Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle & Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math & Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer>


























  <!-- Calculator Logic (defer) -->
  <script defer="">
  // Helpers
  const $ = (id)=>document.getElementById(id);
  const nf0 = new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
  const nfc = new Intl.NumberFormat(undefined,{style:'currency',currency:'USD'});
  const nfp = new Intl.NumberFormat(undefined,{style:'percent',maximumFractionDigits:2});
  const nfn = new Intl.NumberFormat();

  // Elements
  const els = {
    purchasePrice: $('purchasePrice'),
    grossIncome: $('grossIncome'),
    vacancyRate: $('vacancyRate'),
    otherIncome: $('otherIncome'),
    taxes: $('taxes'),
    insurance: $('insurance'),
    managementPct: $('managementPct'),
    repairs: $('repairs'),
    utilities: $('utilities'),
    hoa: $('hoa'),
    capexReserve: $('capexReserve'),
    ltv: $('ltv'),
    loanAmount: $('loanAmount'),
    rate: $('rate'),
    amortYears: $('amortYears'),
    loanTermYears: $('loanTermYears'),
    closingCosts: $('closingCosts'),

    // results
    noiOut: $('noiOut'),
    capRateOut: $('capRateOut'),
    loanOut: $('loanOut'),
    pmtOut: $('pmtOut'),
    dscrOut: $('dscrOut'),
    balloonOut: $('balloonOut'),
    cashNeededOut: $('cashNeededOut'),
    cocOut: $('cocOut'),
    oerOut: $('oerOut'),
    ioTableBody: $('ioTableBody'),

    // buttons
    calcBtn: $('calcBtn'),
    resetBtn: $('resetBtn'),
    printBtn: $('printBtn'),
    menuBtn: $('menuBtn'),
    mobileNav: $('mobileNav')
  };

  // Accessible mobile menu
  els.menuBtn?.addEventListener('click', ()=>{
    const expanded = els.menuBtn.getAttribute('aria-expanded') === 'true';
    els.menuBtn.setAttribute('aria-expanded', String(!expanded));
    els.mobileNav.classList.toggle('hidden');
  });

  // Accessible tooltips
  document.querySelectorAll('[data-tooltip]').forEach(btn=>{
    const sel = btn.getAttribute('data-tooltip');
    const panel = document.querySelector(sel);
    btn.addEventListener('click', ()=>{
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      panel.hidden = expanded;
    });
    btn.addEventListener('keydown', (e)=>{
      if(e.key==='Escape'){ btn.setAttribute('aria-expanded','false'); panel.hidden = true; }
    });
  });

  // Validation on blur
  const rules = {
    purchasePrice: v => v>0 || 'Enter a purchase price greater than 0.',
    grossIncome: v => v>=0 || 'Gross income cannot be negative.',
    vacancyRate: v => (v>=0&&v<=100) || 'Vacancy must be between 0% and 100%.',
    taxes: v => v>=0 || 'Taxes cannot be negative.',
    insurance: v => v>=0 || 'Insurance cannot be negative.',
    managementPct: v => (v>=0&&v<=20) || 'Management % typically 0–20%.',
    repairs: v => v>=0 || 'Repairs cannot be negative.',
    utilities: v => v>=0 || 'Utilities cannot be negative.',
    rate: v => v>=0 || 'Rate cannot be negative.',
    amortYears: v => v>=1 || 'Amortization must be at least 1 year.',
    loanTermYears: v => v>=1 || 'Loan term must be at least 1 year.',
    closingCosts: v => v>=0 || 'Closing costs cannot be negative.'
  };
  function bindValidation(id){
    const input = els[id];
    const err = document.getElementById(id+'Err');
    input.addEventListener('blur', ()=>{
      const v = parseFloat(input.value||'0');
      const rule = rules[id];
      if(rule){
        const ok = rule(v);
        if(ok!==true){
          err.textContent = ok;
          input.setAttribute('aria-invalid','true');
        }else{
          err.textContent = '';
          input.removeAttribute('aria-invalid');
        }
      }
    });
  }
  Object.keys(rules).forEach(bindValidation);

  // Core math
  function pmt(ratePerPeriod, n, pv){
    if(ratePerPeriod===0){ return pv / n; }
    const i = ratePerPeriod;
    return pv * (i / (1 - Math.pow(1+i, -n)));
  }
  function balloonAfterMonths(pv, i, payment, months){
    if(i===0){ return Math.max(0, pv - payment*months); }
    const a = Math.pow(1+i, months);
    return pv*a - payment*((a-1)/i);
  }

  // Calculate
  let chart;
  function calculate(){
    // Inputs
    const price = +els.purchasePrice.value || 0;
    const gi = +els.grossIncome.value || 0;
    const vac = (+els.vacancyRate.value || 0)/100;
    const otherInc = +els.otherIncome.value || 0;

    const taxes = +els.taxes.value || 0;
    const insurance = +els.insurance.value || 0;
    const utilities = +els.utilities.value || 0;
    const repairs = +els.repairs.value || 0;

    const egi = gi * (1 - vac);
    const mgmt = egi * ((+els.managementPct.value || 0)/100);
    const otherOpex = +els.hoa.value || 0;

    const opex = taxes + insurance + utilities + repairs + mgmt + otherOpex;
    const noi = egi + otherInc - opex;
    const oer = (egi>0)? (opex / (egi + otherInc)) : 0;

    // Loan sizing
    const ltv = (+els.ltv.value || 0)/100;
    let loan = +els.loanAmount.value || 0;
    if(!(loan>0) && price>0 && ltv>0){ loan = price * ltv; }

    const rate = (+els.rate.value || 0)/100;
    const i = rate/12;
    const amortYears = Math.max(1, +els.amortYears.value || 25);
    const n = amortYears*12;
    const termYears = Math.max(1, +els.loanTermYears.value || amortYears);
    const termMonths = Math.min(n, termYears*12);

    let mPmt = 0, annualDS = 0, balloon = 0;
    if(loan>0){
      mPmt = pmt(i, n, loan);
      annualDS = mPmt*12;
      balloon = balloonAfterMonths(loan, i, mPmt, termMonths);
    }

    const dscr = (annualDS>0)? (noi/annualDS) : 0;
    const capRate = (price>0)? (noi/price) : 0;

    const closing = +els.closingCosts.value || 0;
    const down = (price>loan)? (price - loan) : Math.max(0, price - loan);
    const cashNeeded = down + closing;
    const coc = (cashNeeded>0)? ((noi - annualDS)/cashNeeded) : 0;

    // Update cards
    els.noiOut.textContent = nfc.format(noi);
    els.capRateOut.textContent = (capRate>0)? nfp.format(capRate) : '—';
    els.loanOut.textContent = loan>0? nf0.format(loan): '—';
    els.pmtOut.textContent = loan>0? nfc.format(mPmt): '—';
    els.dscrOut.textContent = (dscr>0)? dscr.toFixed(2)+'×' : '—';
    els.balloonOut.textContent = loan>0? nf0.format(Math.max(0, balloon)):'—';
    els.cashNeededOut.textContent = nf0.format(Math.max(0, cashNeeded));
    els.cocOut.textContent = (cashNeeded>0)? nfp.format(coc): '—';
    els.oerOut.textContent = (oer>0)? nfp.format(oer): '—';

    // Table
    const rows = [
      ['Gross Scheduled Income', gi, gi/12],
      ['Vacancy & Credit Loss', -gi*vac, -(gi*vac)/12],
      ['Effective Gross Income (EGI)', egi, egi/12],
      ['Other Income', otherInc, otherInc/12],
      ['Taxes', -taxes, -taxes/12],
      ['Insurance', -insurance, -insurance/12],
      ['Utilities', -utilities, -utilities/12],
      ['Repairs & Maintenance', -repairs, -repairs/12],
      ['Management', -mgmt, -mgmt/12],
      ['Other OPEX', -otherOpex, -otherOpex/12],
      ['NOI', noi, noi/12],
      ['Debt Service (annual)', -annualDS, -annualDS/12],
      ['Pre-Tax Cash Flow', (noi-annualDS), (noi-annualDS)/12],
      ['Capital Reserve (not in NOI)', -(+els.capexReserve.value||0), -((+els.capexReserve.value||0)/12)]
    ];
    els.ioTableBody.innerHTML = rows.map(([k,a,m])=>`
      <tr class="odd:bg-white even:bg-gray-50">
        <td class="px-4 py-2 text-left">${k}</td>
        <td class="px-4 py-2">${nfc.format(a)}</td>
        <td class="px-4 py-2">${nfc.format(m)}</td>
      </tr>
    `).join('');

    // Chart (Income vs OPEX vs Debt)
    const data = {
      labels:['NOI','OPEX','Debt Service'],
      datasets:[{data:[
        Math.max(0, noi),
        Math.max(0, opex),
        Math.max(0, annualDS)
      ]}]
    };
    const ctx = document.getElementById('resultsChart').getContext('2d');
    if(chart){ chart.data = data; chart.update(); }
    else{
      chart = new Chart(ctx, {
        type:'doughnut',
        data,
        options:{plugins:{legend:{position:'bottom'}}, responsive:true, maintainAspectRatio:false}
      });
    }
  }

  // Bind buttons
  els.calcBtn.addEventListener('click', calculate);
  els.resetBtn.addEventListener('click', ()=>{
    document.querySelectorAll('#calculator input[type="number"]').forEach(inp=>{
      const def = inp.getAttribute('value');
      inp.value = def ?? '';
    });
    document.querySelectorAll('.error-text').forEach(n=>n.textContent='');
    calculate();
  });
  els.printBtn.addEventListener('click', ()=>window.print());

  // Auto-calc on input (but validate on blur)
  document.querySelectorAll('#calculator input[type="number"]').forEach(inp=>{
    inp.addEventListener('input', ()=>{ /* lightweight live update */ calculate(); });
  });

  // Initial
  calculate();
  </script>


</body></html>