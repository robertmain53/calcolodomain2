<!DOCTYPE html><html lang="en"><head>
<link rel="canonical" href="https://calcdomain.com/new-mexico-income-tax">





 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg">
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png">
<link rel="manifest" href="https://calcdomain.com/site.webmanifest">
<meta charset="utf-8">
<title>New Mexico State Income Tax Calculator</title>
<meta content="Authoritative New Mexico income tax calculator for 2024. Estimate your NM state tax by filing status, taxable income, or from gross pay with standard/itemized deductions. Fast, accessible, and mobile-first." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="Ugo Candido" name="author">

<meta content="#ffffff" name="theme-color">
<meta content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" name="robots">
<meta content="website" property="og:type">
<meta content="New Mexico State Income Tax Calculator" property="og:title">
<meta content="Accurate NM state income tax calculator for 2024 with filing status, standard deduction, and per-paycheck estimates. WCAG 2.1 AA accessible and mobile-first." property="og:description">
<meta content="https://calcdomain.com/tax/new-mexico-income-tax-calculator" property="og:url">
<meta content="CalcDomain" property="og:site_name">
<meta content="Finance" name="category">
<meta content="CalcDomain" name="application-name">
<style>
    /* Critical, mobile-first CSS (WCAG 2.1 AA-oriented) */
    :root{
      --primary:#0B5CAB;
      --primary-600:#094b8a;
      --surface:#fff;
      --bg:#f8f9fa;
      --text:#1c2630;
      --muted:#576071;
      --border:#d7dbe1;
      --success:#157347;
      --danger:#b42318;
      --warning:#b68200;
      --radius:12px;
      --radius-sm:8px;
      --shadow:0 2px 10px rgba(0,0,0,.06);
      --focus-ring:3px solid rgba(11,92,171,.4);
      --touch:48px;
    }
    *{box-sizing:border-box}
    html{font-size:16px}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      color:var(--text); background:var(--bg); line-height:1.6;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a.skip-link{
      position:absolute; left:0; top:-100px; background:var(--primary); color:#fff; padding:.5rem 1rem;
      border-radius:0 0 6px 6px; z-index:1000; text-decoration:none; font-weight:600;
    }
    a.skip-link:focus{ top:0 }
    .container{max-width:1200px;margin:0 auto;padding:0 1rem}
    header.site-header{
      background:var(--surface); border-bottom:1px solid var(--border);
      box-shadow:var(--shadow);
    }
    .header-content{display:grid;grid-template-columns:auto 1fr auto;gap:.75rem;align-items:center;padding:.75rem 0}
    .logo{font-weight:800; color:var(--primary); text-decoration:none; font-size:1.125rem}
    .site-search{display:flex;gap:.5rem; align-items:center; width:100%}
    .site-search input[type="search"]{
      flex:1 1 auto; min-width:0; padding:.7rem .85rem; border:1px solid var(--border); border-radius:8px; background:#fff
    }
    .site-search input[type="search"]:focus{outline:none; box-shadow:0 0 0 3px rgba(11,92,171,.15); border-color:var(--primary)}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; min-height:var(--touch); min-width:var(--touch);
      padding:.7rem 1rem; border-radius:10px; border:1px solid transparent; font-weight:700; cursor:pointer; text-decoration:none;
    }
    .btn-secondary{background:transparent; color:var(--primary); border-color:var(--primary)}
    .btn-secondary:hover{background:var(--primary); color:#fff}
    .nav-toggle{
      appearance:none; background:#fff; border:1px solid var(--border); border-radius:10px; padding:.5rem .75rem; cursor:pointer; min-height:var(--touch)
    }
    .main-nav{display:none}
    /* Breadcrumbs */
    .breadcrumb{margin:1rem 0; font-size:.9375rem; color:var(--muted)}
    .breadcrumb a{color:var(--primary); text-decoration:none}
    .breadcrumb a:hover{text-decoration:underline}
    /* Layout */
    .calculator-layout{display:grid; grid-template-columns:1fr; gap:1.5rem}
    @media(min-width:992px){ .calculator-layout{ grid-template-columns:420px 1fr } }
    .card{
      background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:1.25rem; box-shadow:var(--shadow)
    }
    h1,h2,h3{color:#0c2238}
    h1{font-size:1.75rem;margin:.25rem 0 .5rem}
    h2{font-size:1.35rem;margin:1.75rem 0 .75rem}
    h3{font-size:1.1rem;margin:1.25rem 0 .5rem}
    p{margin:.75rem 0; color:var(--text)}
    /* Form */
    .form-group{margin-bottom:1rem}
    label{display:block; font-weight:700; margin-bottom:.35rem}
    .label-row{display:flex; align-items:center; gap:.5rem; flex-wrap:wrap}
    .form-control{
      width:100%; min-height:var(--touch); padding:.7rem .9rem; border:1px solid var(--border); border-radius:10px; background:#fff; color:var(--text);
    }
    .form-control:focus{outline:var(--focus-ring); border-color:var(--primary)}
    .input-group{position:relative}
    .input-suffix{
      position:absolute; right:.75rem; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none
    }
    fieldset{border:0; padding:0; margin:0}
    .radio-row{display:flex; gap:.5rem; flex-wrap:wrap}
    .choice{position:relative}
    .choice input[type="radio"]{position:absolute; opacity:0}
    .choice label{border:1px solid var(--border); border-radius:8px; padding:.55rem .8rem; min-height:var(--touch); display:inline-flex; align-items:center; gap:.5rem; cursor:pointer; color:#0c2238}
    .choice input[type="radio"]:checked + label{background:var(--primary); color:#fff; border-color:var(--primary)}
    .choice input[type="radio"]:focus + label{outline:var(--focus-ring)}
    .help-btn{
      appearance:none; border:1px solid var(--border); background:#fff; color:#0c2238; border-radius:50%; width:32px; height:32px;
      display:inline-flex; align-items:center; justify-content:center; font-weight:800; cursor:pointer
    }
    .help-btn:focus{outline:var(--focus-ring)}
    .tooltip{
      display:none; margin-top:.4rem; padding:.6rem .75rem; background:#eef5ff; border:1px solid #cfe2ff; color:#0b2850; border-radius:8px
    }
    .tooltip[aria-hidden="false"]{display:block}
    .error-message{color:var(--danger); font-size:.9375rem; margin-top:.25rem; min-height:1rem}
    .results-container{margin-top:1rem; padding:1rem; background:#f4f6f8; border:1px solid var(--border); border-radius:12px; min-height:260px}
    .result-item{display:flex; justify-content:space-between; gap:1rem; padding:.6rem 0; border-bottom:1px dashed var(--border)}
    .result-item:last-child{border-bottom:0}
    .result-label{color:var(--muted)}
    .result-value{font-weight:800; color:#0c2238}
    .result-accent{color:var(--success)}
    .formula-box{background:#eef1f5; border:1px solid var(--border); border-radius:10px; padding:1rem; overflow-x:auto}
    code.formula{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:1rem; display:block; white-space:pre-wrap}
    ul{padding-left:1.1rem}
    li{margin:.4rem 0}
    .author-box{font-size:.95rem; color:var(--muted); border-top:1px solid var(--border); margin-top:2rem; padding-top:1rem}
    footer.site-footer{background:#0c2238; color:#d8e1ec; margin-top:2rem}
    .footer-content{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1.25rem; padding:1.25rem 0}
    .site-footer a{color:#fff; text-decoration:underline}
    .sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "New Mexico State Income Tax Calculator",
  "description": "Accurate New Mexico income tax calculator for 2024. Compute state tax by filing status using official brackets, or estimate from gross pay with standard/itemized deductions. WCAG 2.1 AA accessible and mobile-first.",
  "url": "https://calcdomain.com/new-mexico-income-tax",
  "inLanguage": "en",
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step Example",
      "description": "Walkthrough for estimating New Mexico state income tax from gross pay with the 2024 standard deduction.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Choose filing status and input mode",
          "text": "Select Single, Married Filing Jointly, Married Filing Separately, or Head of Household. Choose whether to enter taxable income directly or estimate from gross pay."
        },
        {
          "@type": "HowToStep",
          "name": "Enter your income",
          "text": "If estimating, enter annual gross pay and any pre-tax deductions (401(k), HSA, etc.). The tool applies the 2024 standard deduction for your status."
        },
        {
          "@type": "HowToStep",
          "name": "We compute taxable income",
          "text": "Taxable Income = max(0, Gross Pay − Pre-tax Deductions − Standard/Itemized Deduction)."
        },
        {
          "@type": "HowToStep",
          "name": "We apply official NM brackets",
          "text": "The calculator applies New Mexico’s 2024 marginal tax brackets for your filing status and sums tax owed across tiers."
        },
        {
          "@type": "HowToStep",
          "name": "Review results",
          "text": "See state tax due, marginal rate, effective rate, and optional per-paycheck estimates."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Which tax year does this calculator use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "By default it uses New Mexico’s 2024 personal income tax brackets and federal standard deduction amounts to estimate taxable income if you choose the estimation mode."
          }
        },
        {
          "@type": "Question",
          "name": "Does it include federal taxes or payroll taxes?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. This tool focuses on New Mexico state personal income tax only. Federal income tax and FICA (Social Security and Medicare) are not included."
          }
        },
        {
          "@type": "Question",
          "name": "What if I itemize deductions?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Select the itemized option and enter your total itemized deductions to replace the standard deduction when estimating taxable income."
          }
        },
        {
          "@type": "Question",
          "name": "Are the results guaranteed?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Results are estimates based on the official 2024 brackets and simple assumptions. Your actual liability can vary due to credits, exemptions, and other adjustments. Always review New Mexico TRD guidance or consult a tax professional."
          }
        },
        {
          "@type": "Question",
          "name": "How do you calculate marginal and effective rates?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Marginal rate is the rate that applies to your last dollar of taxable income. Effective rate is total tax divided by taxable income."
          }
        },
        {
          "@type": "Question",
          "name": "Do you tax Social Security benefits?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "New Mexico exclusions may apply to Social Security benefits based on income thresholds and recent law changes. This simplified tool does not separately model those exclusions."
          }
        }
      ]
    }
  ],
  "reviewedBy": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "dateModified": "2026-01-19"
}</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer=""></script>
<!-- MathJax for LaTeX formulas -->
<script>
  (function() {

    'use strict';

  window.MathJax = { tex: { inlineMath: [['\\(','\\)'], [',
    svg: { fontCache: 'global' }
  };


  })();</script>
<script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script">


<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "General",
      "item": "https://calcdomain.com/categories/general"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Miscellaneous",
      "item": "https://calcdomain.com/subcategories/miscellaneous"
    }
  ]
}
</script>
</head>
<body><header id="siteHeader">
  <div class="nav container">
    <a class="brand" href="https://calcdomain.com">CalcDomain</a>
    <div class="navRight">
      <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
      <span class="pill">Categories</span>
    </div>
  </div>
</header><div class="container">
  <main style="margin:24px 0 40px;" id="mainContent">
    <h1 id="pageTitle">New Mexico State Income Tax Calculator</h1>
    <p class="sub" id="pageSub">Authoritative New Mexico income tax calculator for 2024. Estimate your NM state tax by filing status, taxable income, or from gross pay with standard/itemized deductions. Fast, accessible, and mobile-first.</p>
    <div id="errorBox" class="alert" role="alert" aria-live="polite"></div>

    <div class="calc-hero" id="calcHero">
      <section class="card" id="inputsCard" aria-label="Calculator inputs"><main class="main-content w-full lg:w-2/3" id="main-content" role="main">
<div class="container">
<nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> » <a href="https://calcdomain.com/categories/general" class="hover:text-blue-600">General</a> » <a href="https://calcdomain.com/subcategories/miscellaneous" class="hover:text-blue-600">Miscellaneous</a></nav>
<h1>New Mexico State Income Tax Calculator</h1>
<p>
        This professional-grade calculator estimates your New Mexico personal income tax for tax year 2024. It’s designed for residents, nonresidents with NM-source income, and financial planners who need quick, transparent estimates by filing status. Enter taxable income directly or estimate it from gross pay using standard or itemized deductions.
      </p>
<div class="calculator-layout">
<aside aria-labelledby="calc-heading" class="card w-full lg:w-1/3">
<section aria-describedby="calc-intro" id="tax-calculator">
<h2 id="calc-heading" style="margin-top:0">Calculator</h2>
<p class="sr-only" id="calc-intro">Enter your filing status and income to estimate New Mexico state income tax. All required fields are marked with an asterisk.</p>
<div class="form-group">
<fieldset>
<legend class="sr-only">Input mode</legend>
<div class="label-row">
<span id="modeLabel">Choose input mode *</span>
</div>
<div aria-labelledby="modeLabel" class="radio-row" role="radiogroup">
<div class="choice">
<input checked="" id="modeTaxable" name="mode" type="radio" value="taxable">
<label for="modeTaxable">Enter taxable income</label>
</div>
<div class="choice">
<input id="modeEstimate" name="mode" type="radio" value="estimate">
<label for="modeEstimate">Estimate from gross pay</label>
</div>
</div>
</fieldset>
</div>
<div class="form-group">
<label for="filingStatus">Filing status *</label>
<select aria-describedby="filingStatusError" aria-required="true" class="form-control" id="filingStatus">
<option value="single">Single</option>
<option value="mfj">Married Filing Jointly / Qualifying Surviving Spouse</option>
<option value="mfs">Married Filing Separately</option>
<option value="hoh">Head of Household</option>
</select>
<div aria-live="polite" class="error-message" id="filingStatusError" role="alert"></div>
</div>
<div class="form-group">
<label for="taxYear">Tax year</label>
<select aria-describedby="taxYearTip" class="form-control" id="taxYear">
<option selected="" value="2024">2024</option>
</select>
<div aria-hidden="true" class="error-message" id="taxYearTip"></div>
</div>
<div class="form-group" id="groupTaxable">
<div class="label-row">
<label for="taxableIncome">New Mexico taxable income (annual) *</label>
<button aria-controls="tiHelp" aria-expanded="false" aria-label="What is taxable income?" class="help-btn" id="tiHelpBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="tiHelp taxableIncomeError" aria-required="true" class="form-control" id="taxableIncome" inputmode="decimal" min="0" placeholder="e.g., 60000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="tiHelp" role="note">
                Taxable income is your income after adjustments and deductions as defined for New Mexico personal income tax. If unsure, use “Estimate from gross pay”.
              </div>
<div aria-live="polite" class="error-message" id="taxableIncomeError" role="alert"></div>
</div>
<div aria-live="off" class="card" id="groupEstimate" style="display:none; padding:1rem; border:1px dashed var(--border)">
<h3 style="margin-top:0">Estimate from gross pay</h3>
<div class="form-group">
<div class="label-row">
<label for="grossPay">Annual gross pay *</label>
<button aria-controls="gpHelp" aria-expanded="false" aria-label="What is gross pay?" class="help-btn" id="gpHelpBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="gpHelp grossPayError" aria-required="true" class="form-control" id="grossPay" inputmode="decimal" min="0" placeholder="e.g., 85000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="gpHelp" role="note">
                  Gross pay is your total income before any deductions or taxes for the year.
                </div>
<div aria-live="polite" class="error-message" id="grossPayError" role="alert"></div>
</div>
<div class="form-group">
<label for="preTax">Pre-tax deductions (401(k), HSA, FSA, cafeteria plan)</label>
<div class="input-group">
<input aria-describedby="preTaxError" class="form-control" id="preTax" inputmode="decimal" min="0" placeholder="e.g., 12000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="preTaxError" role="alert"></div>
</div>
<fieldset class="form-group">
<legend class="sr-only">Deduction method</legend>
<div class="label-row">
<span id="deductionLabel">Deduction method *</span>
</div>
<div aria-labelledby="deductionLabel" class="radio-row" role="radiogroup">
<div class="choice">
<input checked="" id="dedStd" name="deductionMethod" type="radio" value="standard">
<label for="dedStd">Standard deduction (2024)</label>
</div>
<div class="choice">
<input id="dedItem" name="deductionMethod" type="radio" value="itemized">
<label for="dedItem">Itemized deduction (enter amount)</label>
</div>
</div>
</fieldset>
<div class="form-group" id="stdRow">
<label for="stdDeduction">Standard deduction (auto by filing status)</label>
<div class="input-group">
<input aria-readonly="true" class="form-control" id="stdDeduction" inputmode="decimal" min="0" readonly="" step="1" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
</div>
<div class="form-group" id="itmRow" style="display:none">
<label for="itemized">Itemized deduction amount *</label>
<div class="input-group">
<input aria-describedby="itemizedError" class="form-control" id="itemized" inputmode="decimal" min="0" placeholder="Enter your itemized total" step="1" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="itemizedError" role="alert"></div>
</div>
</div>
<div class="form-group">
<label for="payFreq">Optional: pay frequency (for per‑paycheck estimate)</label>
<select aria-describedby="payFreqTip" class="form-control" id="payFreq">
<option value="">-- None --</option>
<option value="52">Weekly (52)</option>
<option value="26">Biweekly (26)</option>
<option value="24">Semimonthly (24)</option>
<option value="12">Monthly (12)</option>
<option value="1">Annually (1)</option>
</select>
<div aria-hidden="true" class="error-message" id="payFreqTip"></div>
</div>
<div aria-atomic="false" aria-live="polite" class="results-container">
<h3>Results</h3>
<div class="result-item">
<span class="result-label" id="riLabel">Taxable Income</span>
<span class="result-value" id="riValue">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">New Mexico State Tax</span>
<span class="result-value result-accent" id="taxValue">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">Marginal Rate</span>
<span class="result-value" id="marginalValue">0%</span>
</div>
<div class="result-item">
<span class="result-label">Effective Rate</span>
<span class="result-value" id="effectiveValue">0%</span>
</div>
<div class="result-item" id="perPayRow" style="display:none">
<span class="result-label">Per‑paycheck NM Tax</span>
<span class="result-value" id="perPayValue">$0.00</span>
</div>
<div class="result-item" id="takeHomeRow" style="display:none">
<span class="result-label">Approx. Take‑Home After NM Tax</span>
<span class="result-value" id="takeHomeValue">$0.00</span>
</div>
</div>
</section>
</aside>
<article class="card">
<section>
<h2>Data Source and Methodology</h2>
<p>
              Primary source: New Mexico Taxation and Revenue Department — Personal Income Tax (PIT) Rates and PIT-1 Instructions (Tax Year 2024). See:
            </p>
<ul>
<li>
                New Mexico TRD, “Personal Income Tax,” PIT Rates and Forms (accessed 2024–2025).
                Link: <a href="https://www.tax.newmexico.gov/individuals/personal-income-tax/" rel="nofollow noopener">https://www.tax.newmexico.gov/individuals/personal-income-tax/</a>
</li>
<li>
                New Mexico PIT-1 Instructions (TY 2024) — tax rate tables and guidance.
              </li>
</ul>
<p><strong>All calculations strictly follow the formulas and data provided by this source.</strong></p>
<p>
              Notes: Brackets used here represent the statutory marginal rates for 2024, including the 5.9% top bracket introduced in recent legislative updates. The estimator mode uses the 2024 federal standard deduction as a proxy because New Mexico generally conforms to federal standard/itemized deductions. Credits, exemptions, exclusions (e.g., Social Security adjustments), and special rules are not modeled.
            </p>
</section>
<section>
<h2>The Formula Explained</h2>
<div aria-labelledby="formula-title" class="formula-box">
<p class="sr-only" id="formula-title">Tax formulas in LaTeX format</p>
<code class="formula">
For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n:

(1)  T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr)

Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k.

If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized):

(2)  \text{TaxableIncome} = \max(0,\; G - P - D)

Effective rate:

(3)  \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0
              </code>
</div>
</section>
<section>
<h2>Glossary of Variables</h2>
<ul>
              - Filing status: Single, Married Filing Jointly (MFJ), Married Filing Separately (MFS), Head of Household (HOH).
              - Taxable Income (x): Income after adjustments and deductions subject to NM PIT.
              - Gross Pay (G): Total pre‑tax annual compensation.
              - Pre‑tax Deductions (P): Amounts excluded before tax (401(k), HSA, FSA, cafeteria plan, etc.).
              - Deduction (D): Standard deduction (2024: Single/MFS $14,600; MFJ $29,200; HOH $21,900) or itemized deductions.
              - T(x): Total New Mexico state tax before credits.
              - Marginal Rate: The tax rate that applies to your last dollar of taxable income.
              - Effective Rate: T(x) divided by taxable income.
            </ul>
</section>
<section>
<h2>How It Works: A Step-by-Step Example</h2>
<p><strong>Scenario:</strong> Single filer, gross pay $85,000, pre‑tax deductions $12,000, standard deduction.</p>
<ol>
<li>Compute taxable income using (2): Taxable = max(0, 85,000 − 12,000 − 14,600) = 58,400.</li>
<li>Apply 2024 NM Single brackets using (1):
                <ul>
<li>1.7% on first $5,500 → $93.50</li>
<li>3.2% on next $5,500 (5,500–11,000) → $176.00</li>
<li>4.7% on next $5,000 (11,000–16,000) → $235.00</li>
<li>4.9% on remaining $42,400 (16,000–58,400) → $2,077.60</li>
</ul>
                Total T(58,400) ≈ $2,582.10.
              </li>
<li>Marginal rate: 4.9%. Effective rate: 2,582.10 / 58,400 ≈ 4.42%.</li>
</ol>
<p>Per‑paycheck estimates divide total NM tax by your pay frequency (e.g., 26 for biweekly).</p>
</section>
<section>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>Which tax year does the calculator support?</summary>
<p>It uses New Mexico’s 2024 tax brackets. The estimation mode applies 2024 federal standard deductions by status as a proxy for NM conformity.</p>
</details>
<details>
<summary>Does it include local income taxes?</summary>
<p>No. New Mexico has a state personal income tax. Local sales and other taxes are separate and not included here.</p>
</details>
<details>
<summary>How accurate is the “estimate from gross pay” mode?</summary>
<p>It’s a high-quality approximation for many filers but does not model credits, exclusions (e.g., certain Social Security treatment), or complex adjustments. For precise results, use your NM taxable income or consult a professional.</p>
</details>
<details>
<summary>Can I model itemized deductions?</summary>
<p>Yes. Choose “Itemized deduction” and enter your total to replace the standard deduction in the taxable income estimate.</p>
</details>
<details>
<summary>What is the difference between marginal and effective rates?</summary>
<p>The marginal rate applies to your last dollar of taxable income. The effective rate is your total NM tax divided by your taxable income.</p>
</details>
<details>
<summary>Is my data stored?</summary>
<p>No. All calculations run locally in your browser. We don’t store or transmit your inputs.</p>
</details>
</section>
<div class="author-box">
<p>
            </p>
</div>

<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\]</div>
  <pre class="auditspine-mono">','</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Tax formulas in LaTeX format For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n: (1) T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr) Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k. If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized): (2) \text{TaxableIncome} = \max(0,\; G - P - D) Effective rate: (3) \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n: (1) T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr) Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k. If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized): (2) \text{TaxableIncome} = \max(0,\; G - P - D) Effective rate: (3) \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>US Taxation (State)</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/taxes" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/taxes</a></li>
<li><strong>https://www.tax.newmexico.gov/individuals/personal-income-tax/</strong> — tax.newmexico.gov · Accessed 2026-01-19<br><a href="https://www.tax.newmexico.gov/individuals/personal-income-tax/" target="_blank" rel="nofollow noopener">https://www.tax.newmexico.gov/individuals/personal-income-tax/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
</div>
</div>


</main>
<div data-canon-btnrow="1" style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
<button id="calcBtn" type="button" class="btn">Calculate</button>

<button id="resetBtn" type="button" class="btn btnSecondary">Reset</button>
</div>
</section>
      <section class="card sticky-box" id="resultsCard" aria-label="Calculator results"></section>
    </div>

    <section class="card content-card" id="howToUse" aria-label="How to use and methodology">
      <h2>Full original guide (expanded)</h2>
    <a class="skip-link" href="#main-content">Skip to main content</a><link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script"><link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script"><style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style><a class="skip-link" href="#main-content">Skip to main content</a><main class="main-content" id="main-content" role="main">
<div class="container">
<nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> » <a href="https://calcdomain.com/categories/general" class="hover:text-blue-600">General</a> » <a href="https://calcdomain.com/subcategories/miscellaneous" class="hover:text-blue-600">Miscellaneous</a></nav>
<h1>New Mexico State Income Tax Calculator</h1>
<p>
        This professional-grade calculator estimates your New Mexico personal income tax for tax year 2024. It’s designed for residents, nonresidents with NM-source income, and financial planners who need quick, transparent estimates by filing status. Enter taxable income directly or estimate it from gross pay using standard or itemized deductions.
      </p>
<div class="calculator-layout">
<aside aria-labelledby="calc-heading" class="card">
<section aria-describedby="calc-intro" id="tax-calculator">
<h2 id="calc-heading" style="margin-top:0">Calculator</h2>
<p class="sr-only" id="calc-intro">Enter your filing status and income to estimate New Mexico state income tax. All required fields are marked with an asterisk.</p>
<div class="form-group">
<fieldset>
<legend class="sr-only">Input mode</legend>
<div class="label-row">
<span id="modeLabel">Choose input mode *</span>
</div>
<div aria-labelledby="modeLabel" class="radio-row" role="radiogroup">
<div class="choice">
<input checked="" id="modeTaxable" name="mode" type="radio" value="taxable">
<label for="modeTaxable">Enter taxable income</label>
</div>
<div class="choice">
<input id="modeEstimate" name="mode" type="radio" value="estimate">
<label for="modeEstimate">Estimate from gross pay</label>
</div>
</div>
</fieldset>
</div>
<div class="form-group">
<label for="filingStatus">Filing status *</label>
<select aria-describedby="filingStatusError" aria-required="true" class="form-control" id="filingStatus">
<option value="single">Single</option>
<option value="mfj">Married Filing Jointly / Qualifying Surviving Spouse</option>
<option value="mfs">Married Filing Separately</option>
<option value="hoh">Head of Household</option>
</select>
<div aria-live="polite" class="error-message" id="filingStatusError" role="alert"></div>
</div>
<div class="form-group">
<label for="taxYear">Tax year</label>
<select aria-describedby="taxYearTip" class="form-control" id="taxYear">
<option selected="" value="2024">2024</option>
</select>
<div aria-hidden="true" class="error-message" id="taxYearTip"></div>
</div>
<div class="form-group" id="groupTaxable">
<div class="label-row">
<label for="taxableIncome">New Mexico taxable income (annual) *</label>
<button aria-controls="tiHelp" aria-expanded="false" aria-label="What is taxable income?" class="help-btn" id="tiHelpBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="tiHelp taxableIncomeError" aria-required="true" class="form-control" id="taxableIncome" inputmode="decimal" min="0" placeholder="e.g., 60000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="tiHelp" role="note">
                Taxable income is your income after adjustments and deductions as defined for New Mexico personal income tax. If unsure, use “Estimate from gross pay”.
              </div>
<div aria-live="polite" class="error-message" id="taxableIncomeError" role="alert"></div>
</div>
<div aria-live="off" class="card" id="groupEstimate" style="display:none; padding:1rem; border:1px dashed var(--border)">
<h3 style="margin-top:0">Estimate from gross pay</h3>
<div class="form-group">
<div class="label-row">
<label for="grossPay">Annual gross pay *</label>
<button aria-controls="gpHelp" aria-expanded="false" aria-label="What is gross pay?" class="help-btn" id="gpHelpBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="gpHelp grossPayError" aria-required="true" class="form-control" id="grossPay" inputmode="decimal" min="0" placeholder="e.g., 85000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="gpHelp" role="note">
                  Gross pay is your total income before any deductions or taxes for the year.
                </div>
<div aria-live="polite" class="error-message" id="grossPayError" role="alert"></div>
</div>
<div class="form-group">
<label for="preTax">Pre-tax deductions (401(k), HSA, FSA, cafeteria plan)</label>
<div class="input-group">
<input aria-describedby="preTaxError" class="form-control" id="preTax" inputmode="decimal" min="0" placeholder="e.g., 12000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="preTaxError" role="alert"></div>
</div>
<fieldset class="form-group">
<legend class="sr-only">Deduction method</legend>
<div class="label-row">
<span id="deductionLabel">Deduction method *</span>
</div>
<div aria-labelledby="deductionLabel" class="radio-row" role="radiogroup">
<div class="choice">
<input checked="" id="dedStd" name="deductionMethod" type="radio" value="standard">
<label for="dedStd">Standard deduction (2024)</label>
</div>
<div class="choice">
<input id="dedItem" name="deductionMethod" type="radio" value="itemized">
<label for="dedItem">Itemized deduction (enter amount)</label>
</div>
</div>
</fieldset>
<div class="form-group" id="stdRow">
<label for="stdDeduction">Standard deduction (auto by filing status)</label>
<div class="input-group">
<input aria-readonly="true" class="form-control" id="stdDeduction" inputmode="decimal" min="0" readonly="" step="1" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
</div>
<div class="form-group" id="itmRow" style="display:none">
<label for="itemized">Itemized deduction amount *</label>
<div class="input-group">
<input aria-describedby="itemizedError" class="form-control" id="itemized" inputmode="decimal" min="0" placeholder="Enter your itemized total" step="1" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="itemizedError" role="alert"></div>
</div>
</div>
<div class="form-group">
<label for="payFreq">Optional: pay frequency (for per‑paycheck estimate)</label>
<select aria-describedby="payFreqTip" class="form-control" id="payFreq">
<option value="">-- None --</option>
<option value="52">Weekly (52)</option>
<option value="26">Biweekly (26)</option>
<option value="24">Semimonthly (24)</option>
<option value="12">Monthly (12)</option>
<option value="1">Annually (1)</option>
</select>
<div aria-hidden="true" class="error-message" id="payFreqTip"></div>
</div>
<div aria-atomic="false" aria-live="polite" class="results-container">
<h3>Results</h3>
<div class="result-item">
<span class="result-label" id="riLabel">Taxable Income</span>
<span class="result-value" id="riValue">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">New Mexico State Tax</span>
<span class="result-value result-accent" id="taxValue">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">Marginal Rate</span>
<span class="result-value" id="marginalValue">0%</span>
</div>
<div class="result-item">
<span class="result-label">Effective Rate</span>
<span class="result-value" id="effectiveValue">0%</span>
</div>
<div class="result-item" id="perPayRow" style="display:none">
<span class="result-label">Per‑paycheck NM Tax</span>
<span class="result-value" id="perPayValue">$0.00</span>
</div>
<div class="result-item" id="takeHomeRow" style="display:none">
<span class="result-label">Approx. Take‑Home After NM Tax</span>
<span class="result-value" id="takeHomeValue">$0.00</span>
</div>
</div>
</section>
</aside>
<article class="card">
<section>
<h2>Data Source and Methodology</h2>
<p>
              Primary source: New Mexico Taxation and Revenue Department — Personal Income Tax (PIT) Rates and PIT-1 Instructions (Tax Year 2024). See:
            </p>
<ul>
<li>
                New Mexico TRD, “Personal Income Tax,” PIT Rates and Forms (accessed 2024–2025).
                Link: <a href="https://www.tax.newmexico.gov/individuals/personal-income-tax/" rel="nofollow noopener">https://www.tax.newmexico.gov/individuals/personal-income-tax/</a>
</li>
<li>
                New Mexico PIT-1 Instructions (TY 2024) — tax rate tables and guidance.
              </li>
</ul>
<p><strong>All calculations strictly follow the formulas and data provided by this source.</strong></p>
<p>
              Notes: Brackets used here represent the statutory marginal rates for 2024, including the 5.9% top bracket introduced in recent legislative updates. The estimator mode uses the 2024 federal standard deduction as a proxy because New Mexico generally conforms to federal standard/itemized deductions. Credits, exemptions, exclusions (e.g., Social Security adjustments), and special rules are not modeled.
            </p>
</section>
<section>
<h2>The Formula Explained</h2>
<div aria-labelledby="formula-title" class="formula-box">
<p class="sr-only" id="formula-title">Tax formulas in LaTeX format</p>
<code class="formula">
For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n:

(1)  T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr)

Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k.

If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized):

(2)  \text{TaxableIncome} = \max(0,\; G - P - D)

Effective rate:

(3)  \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0
              </code>
</div>
</section>
<section>
<h2>Glossary of Variables</h2>
<ul>
              - Filing status: Single, Married Filing Jointly (MFJ), Married Filing Separately (MFS), Head of Household (HOH).
              - Taxable Income (x): Income after adjustments and deductions subject to NM PIT.
              - Gross Pay (G): Total pre‑tax annual compensation.
              - Pre‑tax Deductions (P): Amounts excluded before tax (401(k), HSA, FSA, cafeteria plan, etc.).
              - Deduction (D): Standard deduction (2024: Single/MFS $14,600; MFJ $29,200; HOH $21,900) or itemized deductions.
              - T(x): Total New Mexico state tax before credits.
              - Marginal Rate: The tax rate that applies to your last dollar of taxable income.
              - Effective Rate: T(x) divided by taxable income.
            </ul>
</section>
<section>
<h2>How It Works: A Step-by-Step Example</h2>
<p><strong>Scenario:</strong> Single filer, gross pay $85,000, pre‑tax deductions $12,000, standard deduction.</p>
<ol>
<li>Compute taxable income using (2): Taxable = max(0, 85,000 − 12,000 − 14,600) = 58,400.</li>
<li>Apply 2024 NM Single brackets using (1):
                <ul>
<li>1.7% on first $5,500 → $93.50</li>
<li>3.2% on next $5,500 (5,500–11,000) → $176.00</li>
<li>4.7% on next $5,000 (11,000–16,000) → $235.00</li>
<li>4.9% on remaining $42,400 (16,000–58,400) → $2,077.60</li>
</ul>
                Total T(58,400) ≈ $2,582.10.
              </li>
<li>Marginal rate: 4.9%. Effective rate: 2,582.10 / 58,400 ≈ 4.42%.</li>
</ol>
<p>Per‑paycheck estimates divide total NM tax by your pay frequency (e.g., 26 for biweekly).</p>
</section>
<section>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>Which tax year does the calculator support?</summary>
<p>It uses New Mexico’s 2024 tax brackets. The estimation mode applies 2024 federal standard deductions by status as a proxy for NM conformity.</p>
</details>
<details>
<summary>Does it include local income taxes?</summary>
<p>No. New Mexico has a state personal income tax. Local sales and other taxes are separate and not included here.</p>
</details>
<details>
<summary>How accurate is the “estimate from gross pay” mode?</summary>
<p>It’s a high-quality approximation for many filers but does not model credits, exclusions (e.g., certain Social Security treatment), or complex adjustments. For precise results, use your NM taxable income or consult a professional.</p>
</details>
<details>
<summary>Can I model itemized deductions?</summary>
<p>Yes. Choose “Itemized deduction” and enter your total to replace the standard deduction in the taxable income estimate.</p>
</details>
<details>
<summary>What is the difference between marginal and effective rates?</summary>
<p>The marginal rate applies to your last dollar of taxable income. The effective rate is your total NM tax divided by your taxable income.</p>
</details>
<details>
<summary>Is my data stored?</summary>
<p>No. All calculations run locally in your browser. We don’t store or transmit your inputs.</p>
</details>
</section>
<div class="author-box">
<p>
            </p>
</div>

<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\]</div>
  <pre class="auditspine-mono">','</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Tax formulas in LaTeX format For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n: (1) T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr) Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k. If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized): (2) \text{TaxableIncome} = \max(0,\; G - P - D) Effective rate: (3) \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n: (1) T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr) Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k. If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized): (2) \text{TaxableIncome} = \max(0,\; G - P - D) Effective rate: (3) \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>US Taxation (State)</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/taxes" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/taxes</a></li>
<li><strong>https://www.tax.newmexico.gov/individuals/personal-income-tax/</strong> — tax.newmexico.gov · Accessed 2026-01-19<br><a href="https://www.tax.newmexico.gov/individuals/personal-income-tax/" target="_blank" rel="nofollow noopener">https://www.tax.newmexico.gov/individuals/personal-income-tax/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
</div>
</div>
</main><link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script"><link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script"><style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style><a class="skip-link" href="#main-content">Skip to main content</a><main class="main-content" id="main-content" role="main">
<div class="container">
<nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> » <a href="https://calcdomain.com/categories/general" class="hover:text-blue-600">General</a> » <a href="https://calcdomain.com/subcategories/miscellaneous" class="hover:text-blue-600">Miscellaneous</a></nav>
<h1>New Mexico State Income Tax Calculator</h1>
<p>
        This professional-grade calculator estimates your New Mexico personal income tax for tax year 2024. It’s designed for residents, nonresidents with NM-source income, and financial planners who need quick, transparent estimates by filing status. Enter taxable income directly or estimate it from gross pay using standard or itemized deductions.
      </p>
<div class="calculator-layout">
<aside aria-labelledby="calc-heading" class="card">
<section aria-describedby="calc-intro" id="tax-calculator">
<h2 id="calc-heading" style="margin-top:0">Calculator</h2>
<p class="sr-only" id="calc-intro">Enter your filing status and income to estimate New Mexico state income tax. All required fields are marked with an asterisk.</p>
<div class="form-group">
<fieldset>
<legend class="sr-only">Input mode</legend>
<div class="label-row">
<span id="modeLabel">Choose input mode *</span>
</div>
<div aria-labelledby="modeLabel" class="radio-row" role="radiogroup">
<div class="choice">
<input checked="" id="modeTaxable" name="mode" type="radio" value="taxable">
<label for="modeTaxable">Enter taxable income</label>
</div>
<div class="choice">
<input id="modeEstimate" name="mode" type="radio" value="estimate">
<label for="modeEstimate">Estimate from gross pay</label>
</div>
</div>
</fieldset>
</div>
<div class="form-group">
<label for="filingStatus">Filing status *</label>
<select aria-describedby="filingStatusError" aria-required="true" class="form-control" id="filingStatus">
<option value="single">Single</option>
<option value="mfj">Married Filing Jointly / Qualifying Surviving Spouse</option>
<option value="mfs">Married Filing Separately</option>
<option value="hoh">Head of Household</option>
</select>
<div aria-live="polite" class="error-message" id="filingStatusError" role="alert"></div>
</div>
<div class="form-group">
<label for="taxYear">Tax year</label>
<select aria-describedby="taxYearTip" class="form-control" id="taxYear">
<option selected="" value="2024">2024</option>
</select>
<div aria-hidden="true" class="error-message" id="taxYearTip"></div>
</div>
<div class="form-group" id="groupTaxable">
<div class="label-row">
<label for="taxableIncome">New Mexico taxable income (annual) *</label>
<button aria-controls="tiHelp" aria-expanded="false" aria-label="What is taxable income?" class="help-btn" id="tiHelpBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="tiHelp taxableIncomeError" aria-required="true" class="form-control" id="taxableIncome" inputmode="decimal" min="0" placeholder="e.g., 60000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="tiHelp" role="note">
                Taxable income is your income after adjustments and deductions as defined for New Mexico personal income tax. If unsure, use “Estimate from gross pay”.
              </div>
<div aria-live="polite" class="error-message" id="taxableIncomeError" role="alert"></div>
</div>
<div aria-live="off" class="card" id="groupEstimate" style="display:none; padding:1rem; border:1px dashed var(--border)">
<h3 style="margin-top:0">Estimate from gross pay</h3>
<div class="form-group">
<div class="label-row">
<label for="grossPay">Annual gross pay *</label>
<button aria-controls="gpHelp" aria-expanded="false" aria-label="What is gross pay?" class="help-btn" id="gpHelpBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="gpHelp grossPayError" aria-required="true" class="form-control" id="grossPay" inputmode="decimal" min="0" placeholder="e.g., 85000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="gpHelp" role="note">
                  Gross pay is your total income before any deductions or taxes for the year.
                </div>
<div aria-live="polite" class="error-message" id="grossPayError" role="alert"></div>
</div>
<div class="form-group">
<label for="preTax">Pre-tax deductions (401(k), HSA, FSA, cafeteria plan)</label>
<div class="input-group">
<input aria-describedby="preTaxError" class="form-control" id="preTax" inputmode="decimal" min="0" placeholder="e.g., 12000" step="0.01" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="preTaxError" role="alert"></div>
</div>
<fieldset class="form-group">
<legend class="sr-only">Deduction method</legend>
<div class="label-row">
<span id="deductionLabel">Deduction method *</span>
</div>
<div aria-labelledby="deductionLabel" class="radio-row" role="radiogroup">
<div class="choice">
<input checked="" id="dedStd" name="deductionMethod" type="radio" value="standard">
<label for="dedStd">Standard deduction (2024)</label>
</div>
<div class="choice">
<input id="dedItem" name="deductionMethod" type="radio" value="itemized">
<label for="dedItem">Itemized deduction (enter amount)</label>
</div>
</div>
</fieldset>
<div class="form-group" id="stdRow">
<label for="stdDeduction">Standard deduction (auto by filing status)</label>
<div class="input-group">
<input aria-readonly="true" class="form-control" id="stdDeduction" inputmode="decimal" min="0" readonly="" step="1" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
</div>
<div class="form-group" id="itmRow" style="display:none">
<label for="itemized">Itemized deduction amount *</label>
<div class="input-group">
<input aria-describedby="itemizedError" class="form-control" id="itemized" inputmode="decimal" min="0" placeholder="Enter your itemized total" step="1" type="number">
<span aria-hidden="true" class="input-suffix">$</span>
</div>
<div aria-live="polite" class="error-message" id="itemizedError" role="alert"></div>
</div>
</div>
<div class="form-group">
<label for="payFreq">Optional: pay frequency (for per‑paycheck estimate)</label>
<select aria-describedby="payFreqTip" class="form-control" id="payFreq">
<option value="">-- None --</option>
<option value="52">Weekly (52)</option>
<option value="26">Biweekly (26)</option>
<option value="24">Semimonthly (24)</option>
<option value="12">Monthly (12)</option>
<option value="1">Annually (1)</option>
</select>
<div aria-hidden="true" class="error-message" id="payFreqTip"></div>
</div>
<div aria-atomic="false" aria-live="polite" class="results-container">
<h3>Results</h3>
<div class="result-item">
<span class="result-label" id="riLabel">Taxable Income</span>
<span class="result-value" id="riValue">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">New Mexico State Tax</span>
<span class="result-value result-accent" id="taxValue">$0.00</span>
</div>
<div class="result-item">
<span class="result-label">Marginal Rate</span>
<span class="result-value" id="marginalValue">0%</span>
</div>
<div class="result-item">
<span class="result-label">Effective Rate</span>
<span class="result-value" id="effectiveValue">0%</span>
</div>
<div class="result-item" id="perPayRow" style="display:none">
<span class="result-label">Per‑paycheck NM Tax</span>
<span class="result-value" id="perPayValue">$0.00</span>
</div>
<div class="result-item" id="takeHomeRow" style="display:none">
<span class="result-label">Approx. Take‑Home After NM Tax</span>
<span class="result-value" id="takeHomeValue">$0.00</span>
</div>
</div>
</section>
</aside>
<article class="card">
<section>
<h2>Data Source and Methodology</h2>
<p>
              Primary source: New Mexico Taxation and Revenue Department — Personal Income Tax (PIT) Rates and PIT-1 Instructions (Tax Year 2024). See:
            </p>
<ul>
<li>
                New Mexico TRD, “Personal Income Tax,” PIT Rates and Forms (accessed 2024–2025).
                Link: <a href="https://www.tax.newmexico.gov/individuals/personal-income-tax/" rel="nofollow noopener">https://www.tax.newmexico.gov/individuals/personal-income-tax/</a>
</li>
<li>
                New Mexico PIT-1 Instructions (TY 2024) — tax rate tables and guidance.
              </li>
</ul>
<p><strong>All calculations strictly follow the formulas and data provided by this source.</strong></p>
<p>
              Notes: Brackets used here represent the statutory marginal rates for 2024, including the 5.9% top bracket introduced in recent legislative updates. The estimator mode uses the 2024 federal standard deduction as a proxy because New Mexico generally conforms to federal standard/itemized deductions. Credits, exemptions, exclusions (e.g., Social Security adjustments), and special rules are not modeled.
            </p>
</section>
<section>
<h2>The Formula Explained</h2>
<div aria-labelledby="formula-title" class="formula-box">
<p class="sr-only" id="formula-title">Tax formulas in LaTeX format</p>
<code class="formula">
For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n:

(1)  T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr)

Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k.

If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized):

(2)  \text{TaxableIncome} = \max(0,\; G - P - D)

Effective rate:

(3)  \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0
              </code>
</div>
</section>
<section>
<h2>Glossary of Variables</h2>
<ul>
              - Filing status: Single, Married Filing Jointly (MFJ), Married Filing Separately (MFS), Head of Household (HOH).
              - Taxable Income (x): Income after adjustments and deductions subject to NM PIT.
              - Gross Pay (G): Total pre‑tax annual compensation.
              - Pre‑tax Deductions (P): Amounts excluded before tax (401(k), HSA, FSA, cafeteria plan, etc.).
              - Deduction (D): Standard deduction (2024: Single/MFS $14,600; MFJ $29,200; HOH $21,900) or itemized deductions.
              - T(x): Total New Mexico state tax before credits.
              - Marginal Rate: The tax rate that applies to your last dollar of taxable income.
              - Effective Rate: T(x) divided by taxable income.
            </ul>
</section>
<section>
<h2>How It Works: A Step-by-Step Example</h2>
<p><strong>Scenario:</strong> Single filer, gross pay $85,000, pre‑tax deductions $12,000, standard deduction.</p>
<ol>
<li>Compute taxable income using (2): Taxable = max(0, 85,000 − 12,000 − 14,600) = 58,400.</li>
<li>Apply 2024 NM Single brackets using (1):
                <ul>
<li>1.7% on first $5,500 → $93.50</li>
<li>3.2% on next $5,500 (5,500–11,000) → $176.00</li>
<li>4.7% on next $5,000 (11,000–16,000) → $235.00</li>
<li>4.9% on remaining $42,400 (16,000–58,400) → $2,077.60</li>
</ul>
                Total T(58,400) ≈ $2,582.10.
              </li>
<li>Marginal rate: 4.9%. Effective rate: 2,582.10 / 58,400 ≈ 4.42%.</li>
</ol>
<p>Per‑paycheck estimates divide total NM tax by your pay frequency (e.g., 26 for biweekly).</p>
</section>
<section>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>Which tax year does the calculator support?</summary>
<p>It uses New Mexico’s 2024 tax brackets. The estimation mode applies 2024 federal standard deductions by status as a proxy for NM conformity.</p>
</details>
<details>
<summary>Does it include local income taxes?</summary>
<p>No. New Mexico has a state personal income tax. Local sales and other taxes are separate and not included here.</p>
</details>
<details>
<summary>How accurate is the “estimate from gross pay” mode?</summary>
<p>It’s a high-quality approximation for many filers but does not model credits, exclusions (e.g., certain Social Security treatment), or complex adjustments. For precise results, use your NM taxable income or consult a professional.</p>
</details>
<details>
<summary>Can I model itemized deductions?</summary>
<p>Yes. Choose “Itemized deduction” and enter your total to replace the standard deduction in the taxable income estimate.</p>
</details>
<details>
<summary>What is the difference between marginal and effective rates?</summary>
<p>The marginal rate applies to your last dollar of taxable income. The effective rate is your total NM tax divided by your taxable income.</p>
</details>
<details>
<summary>Is my data stored?</summary>
<p>No. All calculations run locally in your browser. We don’t store or transmit your inputs.</p>
</details>
</section>
<div class="author-box">
<p>
            </p>
</div>

<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\]</div>
  <pre class="auditspine-mono">','</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Tax formulas in LaTeX format For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n: (1) T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr) Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k. If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized): (2) \text{TaxableIncome} = \max(0,\; G - P - D) Effective rate: (3) \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">For taxable income x and bracket cutoffs c_0 = 0 &lt; c_1 &lt; ... &lt; c_n with rates r_1, ..., r_n: (1) T(x) = \sum_{i=1}^{n} r_i \cdot \max\!\bigl(0,\; \min(x, c_i) - c_{i-1} \bigr) Marginal rate m(x) is the r_k for the bracket where c_{k-1} &lt; x \le c_k. If estimating from gross pay G with pre-tax deductions P and deduction D (standard or itemized): (2) \text{TaxableIncome} = \max(0,\; G - P - D) Effective rate: (3) \text{EffectiveRate} = \frac{T(x)}{x} \quad \text{for } x &gt; 0</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>US Taxation (State)</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/taxes" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/taxes</a></li>
<li><strong>https://www.tax.newmexico.gov/individuals/personal-income-tax/</strong> — tax.newmexico.gov · Accessed 2026-01-19<br><a href="https://www.tax.newmexico.gov/individuals/personal-income-tax/" target="_blank" rel="nofollow noopener">https://www.tax.newmexico.gov/individuals/personal-income-tax/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
</div>
</div>
</main></section>

    <section class="meta-section" id="pageMeta" aria-label="Verification, changelog, formulas, citations">
  <details id="formulaDetails">
    <summary style="cursor:pointer; font-weight:700; color:var(--text)">Formulas</summary>
    <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
      <p style="margin:0;">(Formulas preserved from original page content, if present.)</p>
    </div>
  </details>

  

  

  <div class="badge-row" id="badgeRow">
    <div class="badge" id="versionBadge">Version 0.1.0-draft</div>
  </div>

<details id="citationDetails" style="margin-top:10px;">
  <summary style="cursor:pointer; font-weight:700; color:var(--text)">Citations</summary>
  <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
    <p style="margin:0;">Add authoritative sources relevant to this calculator (standards bodies, manuals, official docs).</p>
  </div>
</details>

<details id="changelogDetails" style="margin-top:10px;">
  <summary style="cursor:pointer; font-weight:700; color:var(--text)">Changelog</summary>
  <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
    <ul style="padding-left:18px; margin:0;">
      <li>0.1.0-draft — 2026-01-19: Initial draft (review required).</li>
    </ul>
  </div>
</details>
</section>
  </main>
</div><footer id="siteFooter" class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
      <p>© 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer><script defer="">
    (function(){
      'use strict';

      // DOM elements
      const modeTaxable = document.getElementById('modeTaxable');
      const modeEstimate = document.getElementById('modeEstimate');
      const groupTaxable = document.getElementById('groupTaxable');
      const groupEstimate = document.getElementById('groupEstimate');
      const filingStatus = document.getElementById('filingStatus');
      const taxYear = document.getElementById('taxYear');
      const taxableIncome = document.getElementById('taxableIncome');

      const grossPay = document.getElementById('grossPay');
      const preTax = document.getElementById('preTax');
      const stdDeduction = document.getElementById('stdDeduction');
      const itemized = document.getElementById('itemized');
      const dedStd = document.getElementById('dedStd');
      const dedItem = document.getElementById('dedItem');
      const stdRow = document.getElementById('stdRow');
      const itmRow = document.getElementById('itmRow');

      const payFreq = document.getElementById('payFreq');

      const riValue = document.getElementById('riValue');
      const taxValue = document.getElementById('taxValue');
      const marginalValue = document.getElementById('marginalValue');
      const effectiveValue = document.getElementById('effectiveValue');
      const perPayRow = document.getElementById('perPayRow');
      const perPayValue = document.getElementById('perPayValue');
      const takeHomeRow = document.getElementById('takeHomeRow');
      const takeHomeValue = document.getElementById('takeHomeValue');

      // Tooltips
      const tiHelpBtn = document.getElementById('tiHelpBtn');
      const tiHelp = document.getElementById('tiHelp');
      const gpHelpBtn = document.getElementById('gpHelpBtn');
      const gpHelp = document.getElementById('gpHelp');

      // Errors
      const filingStatusError = document.getElementById('filingStatusError');
      const taxableIncomeError = document.getElementById('taxableIncomeError');
      const grossPayError = document.getElementById('grossPayError');
      const preTaxError = document.getElementById('preTaxError');
      const itemizedError = document.getElementById('itemizedError');

      // Formatters
      const fmtCurrency = new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits:2 });
      const fmtPct = new Intl.NumberFormat('en-US', { style:'percent', maximumFractionDigits:2 });

      // 2024 NM brackets (assumed based on NM TRD guidance).
      // Thresholds are inclusive lower bounds up to 'upTo' cap.
      const brackets2024 = {
        single: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        mfs: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        hoh: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        mfj: [
          { upTo: 8000, rate: 0.017 },
          { upTo: 16000, rate: 0.032 },
          { upTo: 24000, rate: 0.047 },
          { upTo: 315000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ]
      };

      // 2024 Federal standard deductions (proxy for NM conformity)
      const stdDeductionMap2024 = {
        single: 14600,
        mfs: 14600,
        hoh: 21900,
        mfj: 29200
      };

      function getBrackets(year, status){
        // Currently only 2024 is implemented
        return brackets2024[status] || brackets2024.single;
      }

      function getStandardDeduction(year, status){
        return stdDeductionMap2024[status] || stdDeductionMap2024.single;
      }

      function clampNonNegative(n){
        return isFinite(n) && n > 0 ? n : 0;
      }

      function calcTaxFromBrackets(x, brackets){
        let tax = 0;
        let prevCap = 0;
        let marginal = 0;
        for(const b of brackets){
          const amountInBracket = Math.max(0, Math.min(x, b.upTo) - prevCap);
          if (amountInBracket > 0){
            tax += amountInBracket * b.rate;
            marginal = b.rate;
          }
          prevCap = b.upTo;
          if (x <= b.upTo) break;
        }
        return { tax, marginalRate: marginal };
      }

      function validateNumberField(el, errEl, label){
        const val = el.value.trim();
        el.setAttribute('aria-invalid', 'false');
        errEl.textContent = '';
        if (val === ''){
          return { ok: false, value: 0, msg: `${label} is required.` };
        }
        const num = Number(val);
        if (!isFinite(num)){
          el.setAttribute('aria-invalid', 'true');
          errEl.textContent = `${label} must be a valid number.`;
          return { ok: false, value: 0 };
        }
        if (num < 0){
          el.setAttribute('aria-invalid', 'true');
          errEl.textContent = `${label} cannot be negative. Please enter 0 or a positive value.`;
          return { ok: false, value: 0 };
        }
        return { ok: true, value: num };
      }

      function toggleTooltip(btn, tip){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tip.setAttribute('aria-hidden', String(expanded));
      }

      function updateStdDeduction(){
        const status = filingStatus.value;
        const year = taxYear.value;
        const std = getStandardDeduction(year, status);
        stdDeduction.value = std;
      }

      function syncModeUI(){
        const mode = modeEstimate.checked ? 'estimate' : 'taxable';
        if (mode === 'estimate'){
          groupEstimate.style.display = '';
          groupTaxable.style.display = 'none';
          // Ensure std/item rows reflect current choice
          stdRow.style.display = dedStd.checked ? '' : 'none';
          itmRow.style.display = dedItem.checked ? '' : 'none';
        } else {
          groupEstimate.style.display = 'none';
          groupTaxable.style.display = '';
        }
      }

      function compute(){
        const status = filingStatus.value;
        const year = taxYear.value;
        const brackets = getBrackets(year, status);

        let taxable = 0;
        let gross = 0;
        let totalTax = 0;
        let marginal = 0;

        if (modeTaxable.checked){
          const v = taxableIncome.value.trim() === '' ? 0 : Number(taxableIncome.value);
          taxable = clampNonNegative(v);
        } else {
          const gp = grossPay.value.trim() === '' ? 0 : Number(grossPay.value);
          const pt = preTax.value.trim() === '' ? 0 : Number(preTax.value);
          const deduction = dedStd.checked ? Number(stdDeduction.value || 0) : Number(itemized.value || 0);
          gross = clampNonNegative(gp);
          const pretax = clampNonNegative(pt);
          const ded = clampNonNegative(deduction);
          taxable = Math.max(0, gross - pretax - ded);
        }

        const res = calcTaxFromBrackets(taxable, brackets);
        totalTax = res.tax;
        marginal = res.marginalRate;

        riValue.textContent = fmtCurrency.format(taxable);
        taxValue.textContent = fmtCurrency.format(totalTax);
        marginalValue.textContent = fmtPct.format(marginal || 0);
        effectiveValue.textContent = taxable > 0 ? fmtPct.format(totalTax / taxable) : '0%';

        // Per-paycheck and take-home (if we have gross)
        const per = Number(payFreq.value || 0);
        if (per > 0){
          perPayRow.style.display = '';
          perPayValue.textContent = fmtCurrency.format(totalTax / per);
        } else {
          perPayRow.style.display = 'none';
          perPayValue.textContent = '$0.00';
        }

        if (modeEstimate.checked){
          takeHomeRow.style.display = '';
          const takeHome = Math.max(0, gross - totalTax);
          takeHomeValue.textContent = fmtCurrency.format(takeHome);
        } else {
          takeHomeRow.style.display = 'none';
          takeHomeValue.textContent = '$0.00';
        }
      }

      // Event wiring
      [modeTaxable, modeEstimate].forEach(r => r.addEventListener('change', () => { syncModeUI(); compute(); }));

      filingStatus.addEventListener('change', () => { updateStdDeduction(); compute(); });
      taxYear.addEventListener('change', () => { updateStdDeduction(); compute(); });

      // Deduction method toggle
      dedStd.addEventListener('change', () => { stdRow.style.display = ''; itmRow.style.display = 'none'; compute(); });
      dedItem.addEventListener('change', () => { stdRow.style.display = 'none'; itmRow.style.display = ''; compute(); });

      // Inputs validation on blur
      taxableIncome.addEventListener('blur', () => {
        if (modeTaxable.checked){
          const r = validateNumberField(taxableIncome, taxableIncomeError, 'Taxable income');
          if (!r.ok) return;
        }
        compute();
      });
      grossPay.addEventListener('blur', () => {
        if (modeEstimate.checked){
          const r = validateNumberField(grossPay, grossPayError, 'Gross pay');
          if (!r.ok) return;
        }
        compute();
      });
      preTax.addEventListener('blur', () => {
        const val = preTax.value.trim();
        preTax.setAttribute('aria-invalid','false');
        preTaxError.textContent = '';
        if (val !== '' && Number(val) < 0){
          preTax.setAttribute('aria-invalid','true');
          preTaxError.textContent = 'Pre-tax deductions cannot be negative.';
          return;
        }
        compute();
      });
      itemized.addEventListener('blur', () => {
        if (dedItem.checked){
          const r = validateNumberField(itemized, itemizedError, 'Itemized deduction');
          if (!r.ok) return;
        }
        compute();
      });

      // Real-time updates (non-blocking)
      [taxableIncome, grossPay, preTax, itemized, stdDeduction, payFreq].forEach(el => {
        el.addEventListener('input', () => { window.requestAnimationFrame(compute); });
      });

      // Tooltips
      tiHelpBtn.addEventListener('click', () => toggleTooltip(tiHelpBtn, tiHelp));
      gpHelpBtn.addEventListener('click', () => toggleTooltip(gpHelpBtn, gpHelp));

      // Initialize defaults
      updateStdDeduction();
      syncModeUI();
      compute();
    })();
  </script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "General",
      "item": "https://calcdomain.com/categories/general"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Miscellaneous",
      "item": "https://calcdomain.com/subcategories/miscellaneous"
    }
  ]
}
</script><script defer="">
    (function(){
      'use strict';

      // DOM elements
      const modeTaxable = document.getElementById('modeTaxable');
      const modeEstimate = document.getElementById('modeEstimate');
      const groupTaxable = document.getElementById('groupTaxable');
      const groupEstimate = document.getElementById('groupEstimate');
      const filingStatus = document.getElementById('filingStatus');
      const taxYear = document.getElementById('taxYear');
      const taxableIncome = document.getElementById('taxableIncome');

      const grossPay = document.getElementById('grossPay');
      const preTax = document.getElementById('preTax');
      const stdDeduction = document.getElementById('stdDeduction');
      const itemized = document.getElementById('itemized');
      const dedStd = document.getElementById('dedStd');
      const dedItem = document.getElementById('dedItem');
      const stdRow = document.getElementById('stdRow');
      const itmRow = document.getElementById('itmRow');

      const payFreq = document.getElementById('payFreq');

      const riValue = document.getElementById('riValue');
      const taxValue = document.getElementById('taxValue');
      const marginalValue = document.getElementById('marginalValue');
      const effectiveValue = document.getElementById('effectiveValue');
      const perPayRow = document.getElementById('perPayRow');
      const perPayValue = document.getElementById('perPayValue');
      const takeHomeRow = document.getElementById('takeHomeRow');
      const takeHomeValue = document.getElementById('takeHomeValue');

      // Tooltips
      const tiHelpBtn = document.getElementById('tiHelpBtn');
      const tiHelp = document.getElementById('tiHelp');
      const gpHelpBtn = document.getElementById('gpHelpBtn');
      const gpHelp = document.getElementById('gpHelp');

      // Errors
      const filingStatusError = document.getElementById('filingStatusError');
      const taxableIncomeError = document.getElementById('taxableIncomeError');
      const grossPayError = document.getElementById('grossPayError');
      const preTaxError = document.getElementById('preTaxError');
      const itemizedError = document.getElementById('itemizedError');

      // Formatters
      const fmtCurrency = new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits:2 });
      const fmtPct = new Intl.NumberFormat('en-US', { style:'percent', maximumFractionDigits:2 });

      // 2024 NM brackets (assumed based on NM TRD guidance).
      // Thresholds are inclusive lower bounds up to 'upTo' cap.
      const brackets2024 = {
        single: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        mfs: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        hoh: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        mfj: [
          { upTo: 8000, rate: 0.017 },
          { upTo: 16000, rate: 0.032 },
          { upTo: 24000, rate: 0.047 },
          { upTo: 315000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ]
      };

      // 2024 Federal standard deductions (proxy for NM conformity)
      const stdDeductionMap2024 = {
        single: 14600,
        mfs: 14600,
        hoh: 21900,
        mfj: 29200
      };

      function getBrackets(year, status){
        // Currently only 2024 is implemented
        return brackets2024[status] || brackets2024.single;
      }

      function getStandardDeduction(year, status){
        return stdDeductionMap2024[status] || stdDeductionMap2024.single;
      }

      function clampNonNegative(n){
        return isFinite(n) && n > 0 ? n : 0;
      }

      function calcTaxFromBrackets(x, brackets){
        let tax = 0;
        let prevCap = 0;
        let marginal = 0;
        for(const b of brackets){
          const amountInBracket = Math.max(0, Math.min(x, b.upTo) - prevCap);
          if (amountInBracket > 0){
            tax += amountInBracket * b.rate;
            marginal = b.rate;
          }
          prevCap = b.upTo;
          if (x <= b.upTo) break;
        }
        return { tax, marginalRate: marginal };
      }

      function validateNumberField(el, errEl, label){
        const val = el.value.trim();
        el.setAttribute('aria-invalid', 'false');
        errEl.textContent = '';
        if (val === ''){
          return { ok: false, value: 0, msg: `${label} is required.` };
        }
        const num = Number(val);
        if (!isFinite(num)){
          el.setAttribute('aria-invalid', 'true');
          errEl.textContent = `${label} must be a valid number.`;
          return { ok: false, value: 0 };
        }
        if (num < 0){
          el.setAttribute('aria-invalid', 'true');
          errEl.textContent = `${label} cannot be negative. Please enter 0 or a positive value.`;
          return { ok: false, value: 0 };
        }
        return { ok: true, value: num };
      }

      function toggleTooltip(btn, tip){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tip.setAttribute('aria-hidden', String(expanded));
      }

      function updateStdDeduction(){
        const status = filingStatus.value;
        const year = taxYear.value;
        const std = getStandardDeduction(year, status);
        stdDeduction.value = std;
      }

      function syncModeUI(){
        const mode = modeEstimate.checked ? 'estimate' : 'taxable';
        if (mode === 'estimate'){
          groupEstimate.style.display = '';
          groupTaxable.style.display = 'none';
          // Ensure std/item rows reflect current choice
          stdRow.style.display = dedStd.checked ? '' : 'none';
          itmRow.style.display = dedItem.checked ? '' : 'none';
        } else {
          groupEstimate.style.display = 'none';
          groupTaxable.style.display = '';
        }
      }

      function compute(){
        const status = filingStatus.value;
        const year = taxYear.value;
        const brackets = getBrackets(year, status);

        let taxable = 0;
        let gross = 0;
        let totalTax = 0;
        let marginal = 0;

        if (modeTaxable.checked){
          const v = taxableIncome.value.trim() === '' ? 0 : Number(taxableIncome.value);
          taxable = clampNonNegative(v);
        } else {
          const gp = grossPay.value.trim() === '' ? 0 : Number(grossPay.value);
          const pt = preTax.value.trim() === '' ? 0 : Number(preTax.value);
          const deduction = dedStd.checked ? Number(stdDeduction.value || 0) : Number(itemized.value || 0);
          gross = clampNonNegative(gp);
          const pretax = clampNonNegative(pt);
          const ded = clampNonNegative(deduction);
          taxable = Math.max(0, gross - pretax - ded);
        }

        const res = calcTaxFromBrackets(taxable, brackets);
        totalTax = res.tax;
        marginal = res.marginalRate;

        riValue.textContent = fmtCurrency.format(taxable);
        taxValue.textContent = fmtCurrency.format(totalTax);
        marginalValue.textContent = fmtPct.format(marginal || 0);
        effectiveValue.textContent = taxable > 0 ? fmtPct.format(totalTax / taxable) : '0%';

        // Per-paycheck and take-home (if we have gross)
        const per = Number(payFreq.value || 0);
        if (per > 0){
          perPayRow.style.display = '';
          perPayValue.textContent = fmtCurrency.format(totalTax / per);
        } else {
          perPayRow.style.display = 'none';
          perPayValue.textContent = '$0.00';
        }

        if (modeEstimate.checked){
          takeHomeRow.style.display = '';
          const takeHome = Math.max(0, gross - totalTax);
          takeHomeValue.textContent = fmtCurrency.format(takeHome);
        } else {
          takeHomeRow.style.display = 'none';
          takeHomeValue.textContent = '$0.00';
        }
      }

      // Event wiring
      [modeTaxable, modeEstimate].forEach(r => r.addEventListener('change', () => { syncModeUI(); compute(); }));

      filingStatus.addEventListener('change', () => { updateStdDeduction(); compute(); });
      taxYear.addEventListener('change', () => { updateStdDeduction(); compute(); });

      // Deduction method toggle
      dedStd.addEventListener('change', () => { stdRow.style.display = ''; itmRow.style.display = 'none'; compute(); });
      dedItem.addEventListener('change', () => { stdRow.style.display = 'none'; itmRow.style.display = ''; compute(); });

      // Inputs validation on blur
      taxableIncome.addEventListener('blur', () => {
        if (modeTaxable.checked){
          const r = validateNumberField(taxableIncome, taxableIncomeError, 'Taxable income');
          if (!r.ok) return;
        }
        compute();
      });
      grossPay.addEventListener('blur', () => {
        if (modeEstimate.checked){
          const r = validateNumberField(grossPay, grossPayError, 'Gross pay');
          if (!r.ok) return;
        }
        compute();
      });
      preTax.addEventListener('blur', () => {
        const val = preTax.value.trim();
        preTax.setAttribute('aria-invalid','false');
        preTaxError.textContent = '';
        if (val !== '' && Number(val) < 0){
          preTax.setAttribute('aria-invalid','true');
          preTaxError.textContent = 'Pre-tax deductions cannot be negative.';
          return;
        }
        compute();
      });
      itemized.addEventListener('blur', () => {
        if (dedItem.checked){
          const r = validateNumberField(itemized, itemizedError, 'Itemized deduction');
          if (!r.ok) return;
        }
        compute();
      });

      // Real-time updates (non-blocking)
      [taxableIncome, grossPay, preTax, itemized, stdDeduction, payFreq].forEach(el => {
        el.addEventListener('input', () => { window.requestAnimationFrame(compute); });
      });

      // Tooltips
      tiHelpBtn.addEventListener('click', () => toggleTooltip(tiHelpBtn, tiHelp));
      gpHelpBtn.addEventListener('click', () => toggleTooltip(gpHelpBtn, gpHelp));

      // Initialize defaults
      updateStdDeduction();
      syncModeUI();
      compute();
    })();
  </script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "General",
      "item": "https://calcdomain.com/categories/general"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Miscellaneous",
      "item": "https://calcdomain.com/subcategories/miscellaneous"
    }
  ]
}
</script><script defer="">
    (function(){
      'use strict';

      // DOM elements
      const modeTaxable = document.getElementById('modeTaxable');
      const modeEstimate = document.getElementById('modeEstimate');
      const groupTaxable = document.getElementById('groupTaxable');
      const groupEstimate = document.getElementById('groupEstimate');
      const filingStatus = document.getElementById('filingStatus');
      const taxYear = document.getElementById('taxYear');
      const taxableIncome = document.getElementById('taxableIncome');

      const grossPay = document.getElementById('grossPay');
      const preTax = document.getElementById('preTax');
      const stdDeduction = document.getElementById('stdDeduction');
      const itemized = document.getElementById('itemized');
      const dedStd = document.getElementById('dedStd');
      const dedItem = document.getElementById('dedItem');
      const stdRow = document.getElementById('stdRow');
      const itmRow = document.getElementById('itmRow');

      const payFreq = document.getElementById('payFreq');

      const riValue = document.getElementById('riValue');
      const taxValue = document.getElementById('taxValue');
      const marginalValue = document.getElementById('marginalValue');
      const effectiveValue = document.getElementById('effectiveValue');
      const perPayRow = document.getElementById('perPayRow');
      const perPayValue = document.getElementById('perPayValue');
      const takeHomeRow = document.getElementById('takeHomeRow');
      const takeHomeValue = document.getElementById('takeHomeValue');

      // Tooltips
      const tiHelpBtn = document.getElementById('tiHelpBtn');
      const tiHelp = document.getElementById('tiHelp');
      const gpHelpBtn = document.getElementById('gpHelpBtn');
      const gpHelp = document.getElementById('gpHelp');

      // Errors
      const filingStatusError = document.getElementById('filingStatusError');
      const taxableIncomeError = document.getElementById('taxableIncomeError');
      const grossPayError = document.getElementById('grossPayError');
      const preTaxError = document.getElementById('preTaxError');
      const itemizedError = document.getElementById('itemizedError');

      // Formatters
      const fmtCurrency = new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits:2 });
      const fmtPct = new Intl.NumberFormat('en-US', { style:'percent', maximumFractionDigits:2 });

      // 2024 NM brackets (assumed based on NM TRD guidance).
      // Thresholds are inclusive lower bounds up to 'upTo' cap.
      const brackets2024 = {
        single: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        mfs: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        hoh: [
          { upTo: 5500, rate: 0.017 },
          { upTo: 11000, rate: 0.032 },
          { upTo: 16000, rate: 0.047 },
          { upTo: 210000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ],
        mfj: [
          { upTo: 8000, rate: 0.017 },
          { upTo: 16000, rate: 0.032 },
          { upTo: 24000, rate: 0.047 },
          { upTo: 315000, rate: 0.049 },
          { upTo: Infinity, rate: 0.059 }
        ]
      };

      // 2024 Federal standard deductions (proxy for NM conformity)
      const stdDeductionMap2024 = {
        single: 14600,
        mfs: 14600,
        hoh: 21900,
        mfj: 29200
      };

      function getBrackets(year, status){
        // Currently only 2024 is implemented
        return brackets2024[status] || brackets2024.single;
      }

      function getStandardDeduction(year, status){
        return stdDeductionMap2024[status] || stdDeductionMap2024.single;
      }

      function clampNonNegative(n){
        return isFinite(n) && n > 0 ? n : 0;
      }

      function calcTaxFromBrackets(x, brackets){
        let tax = 0;
        let prevCap = 0;
        let marginal = 0;
        for(const b of brackets){
          const amountInBracket = Math.max(0, Math.min(x, b.upTo) - prevCap);
          if (amountInBracket > 0){
            tax += amountInBracket * b.rate;
            marginal = b.rate;
          }
          prevCap = b.upTo;
          if (x <= b.upTo) break;
        }
        return { tax, marginalRate: marginal };
      }

      function validateNumberField(el, errEl, label){
        const val = el.value.trim();
        el.setAttribute('aria-invalid', 'false');
        errEl.textContent = '';
        if (val === ''){
          return { ok: false, value: 0, msg: `${label} is required.` };
        }
        const num = Number(val);
        if (!isFinite(num)){
          el.setAttribute('aria-invalid', 'true');
          errEl.textContent = `${label} must be a valid number.`;
          return { ok: false, value: 0 };
        }
        if (num < 0){
          el.setAttribute('aria-invalid', 'true');
          errEl.textContent = `${label} cannot be negative. Please enter 0 or a positive value.`;
          return { ok: false, value: 0 };
        }
        return { ok: true, value: num };
      }

      function toggleTooltip(btn, tip){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tip.setAttribute('aria-hidden', String(expanded));
      }

      function updateStdDeduction(){
        const status = filingStatus.value;
        const year = taxYear.value;
        const std = getStandardDeduction(year, status);
        stdDeduction.value = std;
      }

      function syncModeUI(){
        const mode = modeEstimate.checked ? 'estimate' : 'taxable';
        if (mode === 'estimate'){
          groupEstimate.style.display = '';
          groupTaxable.style.display = 'none';
          // Ensure std/item rows reflect current choice
          stdRow.style.display = dedStd.checked ? '' : 'none';
          itmRow.style.display = dedItem.checked ? '' : 'none';
        } else {
          groupEstimate.style.display = 'none';
          groupTaxable.style.display = '';
        }
      }

      function compute(){
        const status = filingStatus.value;
        const year = taxYear.value;
        const brackets = getBrackets(year, status);

        let taxable = 0;
        let gross = 0;
        let totalTax = 0;
        let marginal = 0;

        if (modeTaxable.checked){
          const v = taxableIncome.value.trim() === '' ? 0 : Number(taxableIncome.value);
          taxable = clampNonNegative(v);
        } else {
          const gp = grossPay.value.trim() === '' ? 0 : Number(grossPay.value);
          const pt = preTax.value.trim() === '' ? 0 : Number(preTax.value);
          const deduction = dedStd.checked ? Number(stdDeduction.value || 0) : Number(itemized.value || 0);
          gross = clampNonNegative(gp);
          const pretax = clampNonNegative(pt);
          const ded = clampNonNegative(deduction);
          taxable = Math.max(0, gross - pretax - ded);
        }

        const res = calcTaxFromBrackets(taxable, brackets);
        totalTax = res.tax;
        marginal = res.marginalRate;

        riValue.textContent = fmtCurrency.format(taxable);
        taxValue.textContent = fmtCurrency.format(totalTax);
        marginalValue.textContent = fmtPct.format(marginal || 0);
        effectiveValue.textContent = taxable > 0 ? fmtPct.format(totalTax / taxable) : '0%';

        // Per-paycheck and take-home (if we have gross)
        const per = Number(payFreq.value || 0);
        if (per > 0){
          perPayRow.style.display = '';
          perPayValue.textContent = fmtCurrency.format(totalTax / per);
        } else {
          perPayRow.style.display = 'none';
          perPayValue.textContent = '$0.00';
        }

        if (modeEstimate.checked){
          takeHomeRow.style.display = '';
          const takeHome = Math.max(0, gross - totalTax);
          takeHomeValue.textContent = fmtCurrency.format(takeHome);
        } else {
          takeHomeRow.style.display = 'none';
          takeHomeValue.textContent = '$0.00';
        }
      }

      // Event wiring
      [modeTaxable, modeEstimate].forEach(r => r.addEventListener('change', () => { syncModeUI(); compute(); }));

      filingStatus.addEventListener('change', () => { updateStdDeduction(); compute(); });
      taxYear.addEventListener('change', () => { updateStdDeduction(); compute(); });

      // Deduction method toggle
      dedStd.addEventListener('change', () => { stdRow.style.display = ''; itmRow.style.display = 'none'; compute(); });
      dedItem.addEventListener('change', () => { stdRow.style.display = 'none'; itmRow.style.display = ''; compute(); });

      // Inputs validation on blur
      taxableIncome.addEventListener('blur', () => {
        if (modeTaxable.checked){
          const r = validateNumberField(taxableIncome, taxableIncomeError, 'Taxable income');
          if (!r.ok) return;
        }
        compute();
      });
      grossPay.addEventListener('blur', () => {
        if (modeEstimate.checked){
          const r = validateNumberField(grossPay, grossPayError, 'Gross pay');
          if (!r.ok) return;
        }
        compute();
      });
      preTax.addEventListener('blur', () => {
        const val = preTax.value.trim();
        preTax.setAttribute('aria-invalid','false');
        preTaxError.textContent = '';
        if (val !== '' && Number(val) < 0){
          preTax.setAttribute('aria-invalid','true');
          preTaxError.textContent = 'Pre-tax deductions cannot be negative.';
          return;
        }
        compute();
      });
      itemized.addEventListener('blur', () => {
        if (dedItem.checked){
          const r = validateNumberField(itemized, itemizedError, 'Itemized deduction');
          if (!r.ok) return;
        }
        compute();
      });

      // Real-time updates (non-blocking)
      [taxableIncome, grossPay, preTax, itemized, stdDeduction, payFreq].forEach(el => {
        el.addEventListener('input', () => { window.requestAnimationFrame(compute); });
      });

      // Tooltips
      tiHelpBtn.addEventListener('click', () => toggleTooltip(tiHelpBtn, tiHelp));
      gpHelpBtn.addEventListener('click', () => toggleTooltip(gpHelpBtn, gpHelp));

      // Initialize defaults
      updateStdDeduction();
      syncModeUI();
      compute();
    })();
  </script></body></html>