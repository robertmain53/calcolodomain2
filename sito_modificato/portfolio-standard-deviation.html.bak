<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="canonical" href="https://calcdomain.com/portfolio-standard-deviation" />
    <title>Portfolio Standard Deviation (2024 Guide) | CalcDomain</title>
    <meta name="description" content="Calculate Portfolio Standard Deviation in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Portfolio Standard Deviation (2024 Guide) | CalcDomain" />
    <meta property="og:description" content="Calculate Portfolio Standard Deviation in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />
    <meta property="og:url" content="https://calcdomain.com/portfolio-standard-deviation" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Portfolio Standard Deviation (2024 Guide) | CalcDomain" />
    <meta name="twitter:description" content="Calculate Portfolio Standard Deviation in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Try it today." />

    
    <link rel="preload" href="https://calcdomain.com/assets/tailwind.min.css" as="style">
    <link rel="stylesheet" href="https://calcdomain.com/assets/tailwind.min.css">
    <!-- Google tag (gtag.js) -->
    
    
    
    
    

    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Portfolio Standard Deviation Calculator – Multi-Asset Risk & Correlation",
        "description": "Free portfolio standard deviation calculator for up to 15 assets. Enter weights, volatilities, and correlations to compute portfolio risk, variance, and contribution by asset.",
        "url": "https://calcdomain.com/portfolio-standard-deviation",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://calcdomain.com"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Finance",
              "item": "https://calcdomain.com/categories/finance"
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": "Finance",
              "item": "https://calcdomain.com/finance"
            },
            {
              "@type": "ListItem",
              "position": 4,
              "name": "Portfolio Standard Deviation",
              "item": "https://calcdomain.com/portfolio-standard-deviation"
            }
          ]
        },
        "mainEntity": {
          "@type": "SoftwareApplication",
          "name": "Portfolio Standard Deviation Calculator",
          "applicationCategory": "FinanceApplication",
          "operatingSystem": "Any",
          "url": "https://calcdomain.com/portfolio-standard-deviation"
        }
      }</script>
    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "What is portfolio standard deviation?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Portfolio standard deviation is a measure of the total risk (volatility) of a portfolio. It combines the individual volatilities of each asset with the correlations between them to show how much the portfolio's return typically fluctuates around its average."
            }
          },
          {
            "@type": "Question",
            "name": "How do you calculate the standard deviation of a two-asset portfolio?",
            "acceptedAnswer": {
              "@type": "Answer where wi are weights, σi are standard deviations, and ρ12 is the correlation. The portfolio standard deviation is σp = √σp²."
            }
          },
          {
            "@type": "Question",
            "name": "Should I use daily, monthly, or annual standard deviation?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Use the same time scale for all assets. If you care about annual risk, use annualized standard deviations and correlations. If you start from daily data, convert to annual by multiplying the daily standard deviation by √252 (trading days)."
            }
          },
          {
            "@type": "Question",
            "name": "Can portfolio standard deviation be lower than every asset in the portfolio?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. If assets are not perfectly positively correlated, diversification can reduce overall portfolio volatility below the volatility of each individual asset. This is one of the key insights of modern portfolio theory."
            }
          },
          {
            "@type": "Question",
            "name": "What inputs do I need for this portfolio standard deviation calculator?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "You need the weight of each asset in the portfolio, its standard deviation (on a consistent time scale), and the correlation between each pair of assets. The calculator then builds the covariance matrix and computes portfolio variance and standard deviation."
            }
          }
        ]
      }</script>
  
    <style>
      body { margin: 0; }
      .mb-10 { margin-bottom: 2.5rem; }
      .mt-10 { margin-top: 2.5rem; }
    </style>
    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ugo Candido",
        "url": "https://www.linkedin.com/in/ugocandido92821/",
        "sameAs": ["https://www.linkedin.com/in/ugocandido92821/"],
        "email": "info@calcdomain.com",
        "description": "Ugo Candido builds calculators and educational resources to help readers make better decisions with transparent, practical models."
      }</script>
  <script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/"}, {"@type": "ListItem", "position": 2, "name": "Finance Calculators", "item": "https://calcdomain.com/categories/finance"}, {"@type": "ListItem", "position": 3, "name": "Investment Calculators", "item": "https://calcdomain.com/subcategories/finance-investment"}, {"@type": "ListItem", "position": 4, "name": "Portfolio Standard Deviation Calculator", "item": "https://calcdomain.com/portfolio-standard-deviation"}]}</script>
</head>
  <body class="bg-gray-50 text-gray-800">
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9476637732224939"
      crossorigin="anonymous"
    ></script>

    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a
            href="https://calcdomain.com"
            class="text-2xl font-bold text-blue-600"
            >CalcDomain</a
          >
          <div class="w-full max-w-md hidden md:block mx-8">
            <div class="relative">
              <input
                type="search"
                id="search-input"
                placeholder="Search for a calculator..."
                class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                autocomplete="off"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
              <div
                id="search-results"
                class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"
              ></div>
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a
              href="https://calcdomain.com/search"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Categories</a
            >
          </div>
          <button
            id="mobile-menu-toggle"
            class="md:hidden p-2"
            aria-controls="mobile-menu"
            aria-expanded="false"
            aria-label="Open menu"
            type="button"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
        <nav
          id="mobile-menu"
          class="md:hidden mt-4 hidden"
          aria-label="Mobile menu"
          role="navigation"
        >
          <div class="mb-4">
            <div class="relative">
              <input
                type="search"
                id="mobile-search-input"
                placeholder="Search calculators..."
                class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
            </div>
          </div>
          <div class="space-y-2">
            <a
              href="https://calcdomain.com/search"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Categories</a
            >
          </div>
        </nav>
      </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
      <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600">
  <ol class="flex flex-wrap items-center gap-1">
    <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/categories/finance" class="text-blue-600 hover:underline">Finance Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/subcategories/finance-investment" class="text-blue-600 hover:underline">Investment Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><span class="text-gray-800">Portfolio Standard Deviation Calculator</span></li>
  </ol>
</nav>
      <div class="flex flex-col lg:flex-row gap-8">
        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <header class="mb-6">
              <h1 class="text-2xl font-bold mb-2">
                Portfolio Standard Deviation Calculator
              </h1>
              <p class="text-gray-700">
                Compute the standard deviation (total risk) of a portfolio with
                up to 15 assets using weights, volatilities, and a full
                correlation matrix. See variance, risk contributions, and
                diversification effects.
              </p>
            </header>

            <section aria-labelledby="calculator-heading" class="mb-8">
              <h2 id="calculator-heading" class="text-xl font-semibold mb-4">
                Calculator
              </h2>

              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label
                    for="num-assets"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Number of assets</label
                  >
                  <input
                    id="num-assets"
                    type="number"
                    min="2"
                    max="15"
                    value="3"
                    class="w-full border border-gray-300 rounded-md px-3 py-2"
                  />
                  <p class="text-xs text-gray-500 mt-1">
                    Supports 2–15 assets.
                  </p>
                </div>
                <div>
                  <label
                    for="scale-select"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Time scale of standard deviations</label
                  >
                  <select
                    id="scale-select"
                    class="w-full border border-gray-300 rounded-md px-3 py-2"
                  >
                    <option value="annual" selected>Annual</option>
                    <option value="monthly">Monthly</option>
                    <option value="daily">Daily</option>
                  </select>
                  <p class="text-xs text-gray-500 mt-1">
                    Use the same scale for all assets.
                  </p>
                </div>
              </div>

              <div class="flex flex-wrap gap-2 mb-4">
                <button
                  id="load-example-2"
                  type="button"
                  class="px-3 py-1 text-xs bg-blue-50 text-blue-700 rounded border border-blue-200"
                >
                  Load 2-asset example
                </button>
                <button
                  id="load-example-3"
                  type="button"
                  class="px-3 py-1 text-xs bg-blue-50 text-blue-700 rounded border border-blue-200"
                >
                  Load 3-asset example
                </button>
                <button
                  id="reset-all"
                  type="button"
                  class="px-3 py-1 text-xs bg-gray-50 text-gray-700 rounded border border-gray-200"
                >
                  Reset
                </button>
              </div>

              <div class="border border-gray-200 rounded-lg p-4 mb-4">
                <h3 class="font-semibold mb-2 text-sm">
                  Asset weights & volatilities
                </h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full text-sm border border-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-2 py-1 border-b text-left">Asset</th>
                        <th class="px-2 py-1 border-b text-left">Label</th>
                        <th class="px-2 py-1 border-b text-right">Weight</th>
                        <th class="px-2 py-1 border-b text-right">
                          Std dev (%)
                        </th>
                      </tr>
                    </thead>
                    <tbody id="asset-table-body">
                      <!-- Rows injected by JS -->
                    </tbody>
                    <tfoot>
                      <tr class="bg-gray-50">
                        <td
                          class="px-2 py-1 border-t text-right font-semibold"
                          colspan="2"
                        >
                          Weight sum
                        </td>
                        <td
                          class="px-2 py-1 border-t text-right font-semibold"
                          id="weight-sum-cell"
                        >
                          1.00
                        </td>
                        <td
                          class="px-2 py-1 border-t text-xs text-gray-500 text-right"
                          colspan="1"
                        >
                          Should equal 1.00
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
                <p
                  id="weight-warning"
                  class="mt-2 text-xs text-amber-600 hidden"
                >
                  Weights do not sum to 1. They will be normalized internally
                  for the calculation.
                </p>
              </div>

              <div class="border border-gray-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="font-semibold text-sm">Correlation matrix (ρ)</h3>
                  <div class="flex gap-2">
                    <button
                      id="set-perfect-corr"
                      type="button"
                      class="px-2 py-1 text-xs bg-gray-50 border border-gray-200 rounded"
                    >
                      Set all off-diagonal to 1
                    </button>
                    <button
                      id="set-zero-corr"
                      type="button"
                      class="px-2 py-1 text-xs bg-gray-50 border border-gray-200 rounded"
                    >
                      Set all off-diagonal to 0
                    </button>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mb-2">
                  Diagonal is fixed at 1. Enter correlations between -1 and 1.
                  Only the upper triangle is editable; the lower triangle
                  mirrors automatically.
                </p>
                <div id="correlation-matrix-container" class="overflow-x-auto">
                  <!-- Matrix injected by JS -->
                </div>
              </div>

              <div class="flex flex-wrap items-center gap-3 mb-4">
                <button
                  id="calculate-btn"
                  type="button"
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                >
                  Calculate portfolio risk
                </button>
                <span
                  id="calc-error"
                  class="text-sm text-red-600 hidden"
                ></span>
              </div>

              <div id="results-section" class="hidden">
                <h3 class="font-semibold mb-2 text-sm">Results</h3>
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                  <div class="bg-blue-50 border border-blue-100 rounded-lg p-3">
                    <p class="text-xs text-gray-600 mb-1">
                      Portfolio standard deviation
                    </p>
                    <p
                      id="result-sd"
                      class="text-xl font-semibold text-blue-700"
                    >
                      —
                    </p>
                    <p
                      id="result-sd-annualized"
                      class="text-xs text-gray-600 mt-1 hidden"
                    ></p>
                  </div>
                  <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                    <p class="text-xs text-gray-600 mb-1">Portfolio variance</p>
                    <p
                      id="result-var"
                      class="text-lg font-semibold text-gray-800"
                    >
                      —
                    </p>
                    <p class="text-xs text-gray-500 mt-1">
                      Variance is standard deviation squared.
                    </p>
                  </div>
                </div>

                <div id="contrib-section" class="mb-4 hidden">
                  <h4 class="font-semibold text-sm mb-2">
                    Risk contribution by asset
                  </h4>
                  <div class="overflow-x-auto">
                    <table class="min-w-full text-sm border border-gray-200">
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-2 py-1 border-b text-left">Asset</th>
                          <th class="px-2 py-1 border-b text-right">
                            Weight (normalized)
                          </th>
                          <th class="px-2 py-1 border-b text-right">
                            Marginal contribution
                          </th>
                          <th class="px-2 py-1 border-b text-right">
                            % of portfolio variance
                          </th>
                        </tr>
                      </thead>
                      <tbody id="contrib-table-body">
                        <!-- Filled by JS -->
                      </tbody>
                    </table>
                  </div>
                </div>

                <p id="diversification-note" class="text-xs text-gray-600"></p>
              </div>
            </section>

            <section class="prose">
              <h2>How this portfolio standard deviation calculator works</h2>
              <p>
                This tool implements the full covariance-matrix approach from
                modern portfolio theory. It supports any number of assets
                (2–15), arbitrary weights, and a complete correlation matrix.
              </p>

              <h3>Inputs</h3>
              <ul>
                <li>
                  <strong>Weights</strong> \\(w_i\\): fraction of total
                  portfolio value in each asset (e.g., 0.60 = 60%).
                </li>
                <li>
                  <strong>Standard deviations</strong> \\(\\sigma_i\\):
                  volatility of each asset’s returns, in percent, on a chosen
                  time scale (daily, monthly, or annual).
                </li>
                <li>
                  <strong>Correlations</strong> \\(\\rho_{ij}\\): correlation
                  between asset \\(i\\) and \\(j\\), between -1 and 1.
                </li>
              </ul>

              <h3>Portfolio variance and standard deviation formula</h3>
              <div class="formula-box">
                <p class="mb-2"><strong>Matrix form</strong></p>
                <p>
                  Let \\(w\\) be the column vector of weights and \\(\\Sigma\\)
                  the covariance matrix. Then:
                </p>
                <p>\\[ \\sigma_p^2 = w^T \\Sigma w \\]</p>
                <p>and</p>
                <p>\\[ \\sigma_p = \\sqrt{\\sigma_p^2} \\]</p>
              </div>

              <div class="formula-box">
                <p class="mb-2">
                  <strong>From standard deviations and correlations</strong>
                </p>
                <p>The covariance between assets \\(i\\) and \\(j\\) is:</p>
                <p>\\[ \\text{Cov}(i,j) = \\sigma_i \\sigma_j \\rho_{ij} \\]</p>
                <p>So portfolio variance is:</p>
                <p>
                  \\[ \\sigma_p^2 = \\sum_{i=1}^N \\sum_{j=1}^N w_i w_j
                  \\sigma_i \\sigma_j \\rho_{ij} \\]
                </p>
              </div>

              <h3>Two-asset portfolio standard deviation</h3>
              <p>For two assets, the formula simplifies to:</p>
              <div class="formula-box">
                <p>
                  \\[ \\sigma_p^2 = w_1^2 \\sigma_1^2 + w_2^2 \\sigma_2^2 + 2
                  w_1 w_2 \\sigma_1 \\sigma_2 \\rho_{12} \\]
                </p>
                <p>\\[ \\sigma_p = \\sqrt{\\sigma_p^2} \\]</p>
              </div>
              <p>
                This is exactly what the calculator computes for the 2-asset
                case, and it generalizes to more assets via the covariance
                matrix.
              </p>

              <h3>Risk contribution by asset</h3>
              <p>
                The calculator also shows how much each asset contributes to
                total portfolio variance. The marginal contribution of asset
                \\(i\\) is:
              </p>
              <div class="formula-box">
                <p>
                  \\[ \\frac{\\partial \\sigma_p^2}{\\partial w_i} = 2
                  \\sum_{j=1}^N w_j \\text{Cov}(i,j) \\]
                </p>
              </div>
              <p>
                The percentage contribution of asset \\(i\\) to portfolio
                variance is:
              </p>
              <div class="formula-box">
                <p>
                  \\[ \\text{Contribution}_i = \\frac{w_i \\sum_{j=1}^N w_j
                  \\text{Cov}(i,j)}{\\sigma_p^2} \\]
                </p>
              </div>
              <p>
                This helps you see which positions drive most of the risk, even
                if they are small in weight.
              </p>

              <h2>Interpreting portfolio standard deviation</h2>
              <ul>
                <li>
                  <strong>Higher \\(\\sigma_p\\)</strong> = more volatile
                  portfolio, wider range of possible outcomes.
                </li>
                <li>
                  <strong>Lower \\(\\sigma_p\\)</strong> = smoother return path,
                  less uncertainty.
                </li>
                <li>
                  <strong>Units</strong>: if you use annual standard deviations,
                  \\(\\sigma_p\\) is an annualized volatility (e.g., 15% per
                  year).
                </li>
              </ul>

              <h3>Effect of correlation on portfolio risk</h3>
              <ul>
                <li>
                  If all correlations are <strong>+1</strong>, there is no
                  diversification benefit and portfolio volatility is just a
                  weighted average of volatilities.
                </li>
                <li>
                  If correlations are <strong>less than +1</strong>,
                  diversification reduces risk; \\(\\sigma_p\\) can be lower
                  than each individual \\(\\sigma_i\\).
                </li>
                <li>
                  If some correlations are <strong>negative</strong>, risk can
                  be reduced dramatically, especially when combining hedging
                  assets.
                </li>
              </ul>

              <h3>Time scaling of standard deviation</h3>
              <p>
                Standard deviation scales with the square root of time under the
                usual assumptions:
              </p>
              <ul>
                <li>
                  From daily to annual (252 trading days):
                  \\(\\sigma_{\\text{annual}} \\approx \\sigma_{\\text{daily}}
                  \\sqrt{252}\\).
                </li>
                <li>
                  From monthly (12 months) to annual:
                  \\(\\sigma_{\\text{annual}} \\approx \\sigma_{\\text{monthly}}
                  \\sqrt{12}\\).
                </li>
              </ul>
              <p>
                Always keep the time scale consistent across assets and
                correlations.
              </p>

              <h2>Worked example</h2>
              <p>Suppose you have a 2-asset portfolio:</p>
              <ul>
                <li>Asset A: weight 60%, annual volatility 20%.</li>
                <li>Asset B: weight 40%, annual volatility 10%.</li>
                <li>Correlation \\(\\rho_{AB} = 0.3\\).</li>
              </ul>
              <p>Portfolio variance:</p>
              <div class="formula-box">
                <p>
                  \\[ \\sigma_p^2 = 0.6^2 (0.20)^2 + 0.4^2 (0.10)^2 +
                  2(0.6)(0.4)(0.20)(0.10)(0.3) \\]
                </p>
                <p>
                  \\[ = 0.36 \\cdot 0.04 + 0.16 \\cdot 0.01 + 2 \\cdot 0.24
                  \\cdot 0.02 \\cdot 0.3 = 0.0144 + 0.0016 + 0.00288 = 0.01888
                  \\]
                </p>
                <p>\\[ \\sigma_p = \\sqrt{0.01888} \\approx 13.7\\% \\]</p>
              </div>
              <p>
                The portfolio’s volatility (13.7%) is lower than the 20%
                volatility of Asset A, thanks to diversification.
              </p>

              <h2>Limitations and good practices</h2>
              <ul>
                <li>
                  Standard deviation assumes <strong>symmetry</strong> and does
                  not distinguish upside vs downside volatility.
                </li>
                <li>
                  Correlations and volatilities are
                  <strong>estimated from historical data</strong> and can change
                  over time, especially in crises.
                </li>
                <li>
                  Use this tool as one input in your risk analysis, alongside
                  stress tests, scenario analysis, and drawdown statistics.
                </li>
              </ul>
            </section>

            <section class="mt-8">
              <h2 class="text-lg font-semibold mb-3">FAQ</h2>
              <div class="space-y-3" id="faq-container">
                <div class="border border-gray-200 rounded-lg">
                  <button
                    class="w-full text-left px-4 py-3 flex justify-between items-center faq-question"
                  >
                    <span class="font-medium text-sm"
                      >What is portfolio standard deviation?</span
                    >
                    <span class="text-gray-500 text-sm">+</span>
                  </button>
                  <div
                    class="px-4 pb-3 hidden faq-answer text-sm text-gray-700"
                  >
                    Portfolio standard deviation is a measure of how much the
                    total return of your portfolio tends to fluctuate around its
                    average. It combines the volatility of each asset with the
                    correlations between them. A higher standard deviation means
                    more uncertainty in returns; a lower one means a smoother
                    ride.
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg">
                  <button
                    class="w-full text-left px-4 py-3 flex justify-between items-center faq-question"
                  >
                    <span class="font-medium text-sm"
                      >Do my asset weights have to sum to 1?</span
                    >
                    <span class="text-gray-500 text-sm">+</span>
                  </button>
                  <div
                    class="px-4 pb-3 hidden faq-answer text-sm text-gray-700"
                  >
                    In theory, yes. In practice, this calculator will
                    automatically normalize your weights so that they sum to 1.
                    If your weights already sum to 1, normalization has no
                    effect. If they do not, the tool rescales them
                    proportionally and shows the normalized weights in the risk
                    contribution table.
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg">
                  <button
                    class="w-full text-left px-4 py-3 flex justify-between items-center faq-question"
                  >
                    <span class="font-medium text-sm"
                      >Where do I get the standard deviations and
                      correlations?</span
                    >
                    <span class="text-gray-500 text-sm">+</span>
                  </button>
                  <div
                    class="px-4 pb-3 hidden faq-answer text-sm text-gray-700"
                  >
                    Typically you estimate them from historical return data
                    (e.g., daily or monthly returns) using a spreadsheet or
                    statistical software. Many brokers and data providers also
                    publish historical volatilities and correlation matrices for
                    major asset classes and indices. Just be sure to use a
                    consistent time scale for all inputs.
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg">
                  <button
                    class="w-full text-left px-4 py-3 flex justify-between items-center faq-question"
                  >
                    <span class="font-medium text-sm"
                      >Is a lower portfolio standard deviation always
                      better?</span
                    >
                    <span class="text-gray-500 text-sm">+</span>
                  </button>
                  <div
                    class="px-4 pb-3 hidden faq-answer text-sm text-gray-700"
                  >
                    Not necessarily. Lower volatility usually means a smoother
                    experience, but it can also mean lower expected returns. The
                    key is the trade-off between risk and return. Many investors
                    look at ratios like the Sharpe ratio, which compare excess
                    return to volatility, rather than minimizing volatility
                    alone.
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg">
                  <button
                    class="w-full text-left px-4 py-3 flex justify-between items-center faq-question"
                  >
                    <span class="font-medium text-sm"
                      >Does this calculator assume normal (Gaussian)
                      returns?</span
                    >
                    <span class="text-gray-500 text-sm">+</span>
                  </button>
                  <div
                    class="px-4 pb-3 hidden faq-answer text-sm text-gray-700"
                  >
                    The math of variance and standard deviation does not require
                    normality, but many common interpretations (e.g., “68% of
                    returns fall within ±1σ”) do. Real-world returns often have
                    fat tails and skewness, so standard deviation should be
                    complemented with other risk metrics such as drawdowns and
                    value-at-risk.
                  </div>
                </div>
              </div>
            </section>
          </div>



            <section class="mt-10" id="author">
              <h2 class="text-xl font-semibold mb-4">About the author</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  <a href="https://www.linkedin.com/in/ugocandido92821/" class="text-blue-600 hover:underline" target="_blank" rel="noopener">Ugo Candido</a>
                  builds financial tools and educational resources to help
                  readers make better money decisions. He focuses on practical,
                  transparent models that reflect how lenders calculate
                  payments and total cost of ownership.
                </p>
                <p class="text-sm text-gray-700 mt-3">
                  Contact: <a href="mailto:info@calcdomain.com" class="text-blue-600 hover:underline">info@calcdomain.com</a>
                </p>
              </div>
            </section>

            <section class="mt-10" id="editorial-policy">
              <h2 class="text-xl font-semibold mb-4">Editorial policy</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  CalcDomain content is created for educational purposes and is
                  reviewed for clarity, accuracy, and transparency. We do not
                  accept paid placements that influence calculator outputs.
                  Inputs and assumptions are shown directly in the interface so
                  you can verify how results are produced.
                </p>
              </div>
            </section>

            <section class="mt-10" id="methodology">
              <h2 class="text-xl font-semibold mb-4">Methodology</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  Results use standard formulas and the values you provide.
                  Figures are estimates and may differ from lender quotes.
                  For decisions that require professional guidance, consult a
                  licensed advisor.
                </p>
              </div>
            </section>

        
            <section class="mt-10" id="sources">
              <h2 class="text-xl font-semibold mb-4">Sources</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                  <li>
                    <a href="https://www.nist.gov/pml/owm/metric-si/si-units" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      NIST: The International System of Units (SI)
                    </a>
                  </li>
                  <li>
                    <a href="https://openstax.org/details/books/college-algebra" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      OpenStax: College Algebra
                    </a>
                  </li>
                </ul>
              </div>
            </section>

        





<section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Operational notes</h2><p class="text-sm text-gray-700">Fill in realistic values and keep units and timeframes consistent.</p><p class="text-sm text-gray-700 mt-2">Key entities: Portfolio, Standard, Deviation.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><!-- %%EEAT_STRIP%% -->
<!-- %%QUALITY_BLOCKS%% -->
<!-- %%FAQ_JSONLD%% -->
</main>
        <aside class="w-full lg:w-1/3">
          <div class="sticky-notice">
            <div class="bg-white p-4 rounded-lg shadow-md mb-6">
              <h2 class="text-lg font-semibold mb-3">Related Finance Tools</h2>
              <ul class="space-y-2 text-sm">
                <li>
                  <a
                    href="https://calcdomain.com/portfolio-rebalancing"
                    class="text-blue-600 hover:underline"
                    >Portfolio Rebalancing</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/asset-allocation"
                    class="text-blue-600 hover:underline"
                    >Asset Allocation</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/sharpe-ratio"
                    class="text-blue-600 hover:underline"
                    >Sharpe Ratio</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/sortino-ratio"
                    class="text-blue-600 hover:underline"
                    >Sortino Ratio</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/value-at-risk"
                    class="text-blue-600 hover:underline"
                    >Value at Risk (VaR)</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/beta"
                    class="text-blue-600 hover:underline"
                    >Beta</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/roi"
                    class="text-blue-600 hover:underline"
                    >Investment Return (ROI)</a
                  >
                </li>
                <li>
                  <a
                    href="https://calcdomain.com/compound-interest-calculator"
                    class="text-blue-600 hover:underline"
                    >Compound Interest</a
                  >
                </li>
              </ul>
            </div>
            <div
              class="bg-blue-50 border border-blue-100 text-xs text-blue-900 rounded-lg p-3"
            >
              <strong>Note:</strong> This calculator is for educational and
              illustrative purposes only and is not investment advice. Always
              consider consulting a qualified financial professional before
              making investment decisions.
            </div>
          </div>
        </aside>
      </div>
    </div>
    <footer class="bg-gray-900 text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
            <p class="text-gray-400 mb-4">
              Your trusted source for free online calculators. Accurate, fast,
              and reliable calculations for every need.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Categories</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/finance"
                  class="text-gray-400 hover:text-white"
                  >Finance</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/health-fitness"
                  class="text-gray-400 hover:text-white"
                  >Health & Fitness</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/math-conversions"
                  class="text-gray-400 hover:text-white"
                  >Math & Conversions</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/lifestyle-everyday"
                  class="text-gray-400 hover:text-white"
                  >Lifestyle & Everyday</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/construction-diy"
                  class="text-gray-400 hover:text-white"
                  >Construction & DIY</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/mortgage-payment"
                  class="text-gray-400 hover:text-white"
                  >Mortgage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percentage-calculator"
                  class="text-gray-400 hover:text-white"
                  >Percentage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bmi-calculator"
                  class="text-gray-400 hover:text-white"
                  >BMI Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/auto-loan-calculator"
                  class="text-gray-400 hover:text-white"
                  >Auto Loan Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/house-affordability"
                  class="text-gray-400 hover:text-white"
                  >House Affordability</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/about"
                  class="text-gray-400 hover:text-white"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/contact"
                  class="text-gray-400 hover:text-white"
                  >Contact</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/privacy"
                  class="text-gray-400 hover:text-white"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/terms"
                  class="text-gray-400 hover:text-white"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/sitemap.xml"
                  class="text-gray-400 hover:text-white"
                  >Site Map</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>
            &copy; 2025 CalcDomain. All Rights Reserved. | Free Online
            Calculators for Everyone
          </p>
        </div>
      </div>
    </footer>

    <script src="/assets/js/mobile-menu.js"></script>
    <script src="/search.js"></script>

    <script>
      // Utility: clamp and parse number
      function parseNumber(value) {
        const v = parseFloat(value);
        return isFinite(v) ? v : NaN;
      }

      const maxAssets = 15;
      const assetTableBody = document.getElementById("asset-table-body");
      const correlationContainer = document.getElementById(
        "correlation-matrix-container"
      );
      const numAssetsInput = document.getElementById("num-assets");
      const weightSumCell = document.getElementById("weight-sum-cell");
      const weightWarning = document.getElementById("weight-warning");
      const calcBtn = document.getElementById("calculate-btn");
      const calcError = document.getElementById("calc-error");
      const resultsSection = document.getElementById("results-section");
      const resultSd = document.getElementById("result-sd");
      const resultVar = document.getElementById("result-var");
      const resultSdAnnualized = document.getElementById(
        "result-sd-annualized"
      );
      const contribSection = document.getElementById("contrib-section");
      const contribBody = document.getElementById("contrib-table-body");
      const diversificationNote = document.getElementById(
        "diversification-note"
      );
      const scaleSelect = document.getElementById("scale-select");

      function buildAssetTable(n) {
        assetTableBody.innerHTML = "";
        for (let i = 0; i < n; i++) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
        <td class="px-2 py-1 border-b text-xs text-gray-600">#${i + 1}</td>
        <td class="px-2 py-1 border-b">
          <input type="text" class="w-full border border-gray-200 rounded px-2 py-1 text-xs asset-label" value="Asset ${
            i + 1
          }">
        </td>
        <td class="px-2 py-1 border-b text-right">
          <input type="number" step="0.0001" class="w-20 border border-gray-200 rounded px-1 py-1 text-right text-xs asset-weight" value="${(
            1 / n
          ).toFixed(4)}">
        </td>
        <td class="px-2 py-1 border-b text-right">
          <input type="number" step="0.01" class="w-20 border border-gray-200 rounded px-1 py-1 text-right text-xs asset-sd" value="15">
        </td>
      `;
          assetTableBody.appendChild(tr);
        }
        updateWeightSum();
        attachWeightListeners();
      }

      function buildCorrelationMatrix(n) {
        const table = document.createElement("table");
        table.className = "text-xs border border-gray-200";
        const thead = document.createElement("thead");
        thead.className = "bg-gray-50";
        let headRow = '<tr><th class="px-1 py-1 border-b"></th>';
        for (let j = 0; j < n; j++) {
          headRow += `<th class="px-1 py-1 border-b text-center">#${
            j + 1
          }</th>`;
        }
        headRow += "</tr>";
        thead.innerHTML = headRow;
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        for (let i = 0; i < n; i++) {
          const tr = document.createElement("tr");
          let rowHtml = `<td class="px-1 py-1 border-b bg-gray-50 text-center">#${
            i + 1
          }</td>`;
          for (let j = 0; j < n; j++) {
            if (i === j) {
              rowHtml += `<td class="px-1 py-1 border-b text-center bg-gray-100">1.00</td>`;
            } else if (j > i) {
              rowHtml += `
            <td class="px-1 py-1 border-b text-center">
              <input type="number" step="0.01" min="-1" max="1"
                     class="matrix-input border border-gray-200 rounded px-1 py-0.5 text-center text-xs corr-input"
                     data-i="${i}" data-j="${j}" value="0.30">
            </td>`;
            } else {
              rowHtml += `
            <td class="px-1 py-1 border-b text-center bg-gray-50 corr-mirror" data-i="${i}" data-j="${j}">0.30</td>`;
            }
          }
          tr.innerHTML = rowHtml;
          tbody.appendChild(tr);
        }
        table.appendChild(tbody);
        correlationContainer.innerHTML = "";
        correlationContainer.appendChild(table);

        // Attach listeners to keep matrix symmetric and clamp values
        const inputs = table.querySelectorAll(".corr-input");
        inputs.forEach((inp) => {
          inp.addEventListener("input", () => {
            let v = parseNumber(inp.value);
            if (!isFinite(v)) {
              inp.value = "";
              return;
            }
            if (v > 1) v = 1;
            if (v < -1) v = -1;
            inp.value = v.toFixed(2);
            const i = parseInt(inp.dataset.i, 10);
            const j = parseInt(inp.dataset.j, 10);
            const mirrorCell = table.querySelector(
              `.corr-mirror[data-i="${j}"][data-j="${i}"]`
            );
            if (mirrorCell) mirrorCell.textContent = v.toFixed(2);
          });
        });
      }

      function updateWeightSum() {
        const weights = document.querySelectorAll(".asset-weight");
        let sum = 0;
        weights.forEach((w) => {
          const v = parseNumber(w.value);
          if (isFinite(v)) sum += v;
        });
        weightSumCell.textContent = sum.toFixed(4);
        if (Math.abs(sum - 1) > 1e-6) {
          weightWarning.classList.remove("hidden");
        } else {
          weightWarning.classList.add("hidden");
        }
      }

      function attachWeightListeners() {
        const weights = document.querySelectorAll(".asset-weight");
        weights.forEach((w) => {
          w.addEventListener("input", updateWeightSum);
        });
      }

      numAssetsInput.addEventListener("input", () => {
        let n = parseInt(numAssetsInput.value, 10);
        if (!isFinite(n) || n < 2) n = 2;
        if (n > maxAssets) n = maxAssets;
        numAssetsInput.value = n;
        buildAssetTable(n);
        buildCorrelationMatrix(n);
        resultsSection.classList.add("hidden");
        calcError.classList.add("hidden");
      });

      document
        .getElementById("set-perfect-corr")
        .addEventListener("click", () => {
          const inputs = correlationContainer.querySelectorAll(".corr-input");
          inputs.forEach((inp) => {
            inp.value = "1.00";
            const i = parseInt(inp.dataset.i, 10);
            const j = parseInt(inp.dataset.j, 10);
            const mirrorCell = correlationContainer.querySelector(
              `.corr-mirror[data-i="${j}"][data-j="${i}"]`
            );
            if (mirrorCell) mirrorCell.textContent = "1.00";
          });
        });

      document.getElementById("set-zero-corr").addEventListener("click", () => {
        const inputs = correlationContainer.querySelectorAll(".corr-input");
        inputs.forEach((inp) => {
          inp.value = "0.00";
          const i = parseInt(inp.dataset.i, 10);
          const j = parseInt(inp.dataset.j, 10);
          const mirrorCell = correlationContainer.querySelector(
            `.corr-mirror[data-i="${j}"][data-j="${i}"]`
          );
          if (mirrorCell) mirrorCell.textContent = "0.00";
        });
      });

      document.getElementById("reset-all").addEventListener("click", () => {
        numAssetsInput.value = 3;
        buildAssetTable(3);
        buildCorrelationMatrix(3);
        scaleSelect.value = "annual";
        resultsSection.classList.add("hidden");
        calcError.classList.add("hidden");
      });

      document
        .getElementById("load-example-2")
        .addEventListener("click", () => {
          numAssetsInput.value = 2;
          buildAssetTable(2);
          buildCorrelationMatrix(2);
          const labels = document.querySelectorAll(".asset-label");
          const weights = document.querySelectorAll(".asset-weight");
          const sds = document.querySelectorAll(".asset-sd");
          labels[0].value = "Equity Index";
          labels[1].value = "Bond Index";
          weights[0].value = "0.60";
          weights[1].value = "0.40";
          sds[0].value = "20";
          sds[1].value = "8";
          updateWeightSum();
          const inputs = correlationContainer.querySelectorAll(".corr-input");
          inputs.forEach((inp) => {
            inp.value = "0.30";
            const i = parseInt(inp.dataset.i, 10);
            const j = parseInt(inp.dataset.j, 10);
            const mirrorCell = correlationContainer.querySelector(
              `.corr-mirror[data-i="${j}"][data-j="${i}"]`
            );
            if (mirrorCell) mirrorCell.textContent = "0.30";
          });
          resultsSection.classList.add("hidden");
          calcError.classList.add("hidden");
        });

      document
        .getElementById("load-example-3")
        .addEventListener("click", () => {
          numAssetsInput.value = 3;
          buildAssetTable(3);
          buildCorrelationMatrix(3);
          const labels = document.querySelectorAll(".asset-label");
          const weights = document.querySelectorAll(".asset-weight");
          const sds = document.querySelectorAll(".asset-sd");
          labels[0].value = "US Stocks";
          labels[1].value = "International Stocks";
          labels[2].value = "Bonds";
          weights[0].value = "0.50";
          weights[1].value = "0.20";
          weights[2].value = "0.30";
          sds[0].value = "18";
          sds[1].value = "20";
          sds[2].value = "7";
          updateWeightSum();
          const inputs = correlationContainer.querySelectorAll(".corr-input");
          inputs.forEach((inp) => {
            const i = parseInt(inp.dataset.i, 10);
            const j = parseInt(inp.dataset.j, 10);
            let v = 0.3;
            if ((i === 0 && j === 1) || (i === 1 && j === 0)) v = 0.8;
            if ((i === 0 && j === 2) || (i === 2 && j === 0)) v = 0.2;
            if ((i === 1 && j === 2) || (i === 2 && j === 1)) v = 0.1;
            inp.value = v.toFixed(2);
            const mirrorCell = correlationContainer.querySelector(
              `.corr-mirror[data-i="${j}"][data-j="${i}"]`
            );
            if (mirrorCell) mirrorCell.textContent = v.toFixed(2);
          });
          resultsSection.classList.add("hidden");
          calcError.classList.add("hidden");
        });

      calcBtn.addEventListener("click", () => {
        calcError.classList.add("hidden");
        resultsSection.classList.add("hidden");
        contribSection.classList.add("hidden");
        contribBody.innerHTML = "";
        diversificationNote.textContent = "";

        const labels = Array.from(
          document.querySelectorAll(".asset-label")
        ).map((el) => el.value.trim() || el.placeholder || "Asset");
        const weightsRaw = Array.from(
          document.querySelectorAll(".asset-weight")
        ).map((el) => parseNumber(el.value));
        const sdsPct = Array.from(document.querySelectorAll(".asset-sd")).map(
          (el) => parseNumber(el.value)
        );

        const n = weightsRaw.length;
        if (n < 2) {
          calcError.textContent = "Please use at least 2 assets.";
          calcError.classList.remove("hidden");
          return;
        }

        for (let i = 0; i < n; i++) {
          if (!isFinite(weightsRaw[i])) {
            calcError.textContent = `Invalid weight for asset #${i + 1}.`;
            calcError.classList.remove("hidden");
            return;
          }
          if (!isFinite(sdsPct[i]) || sdsPct[i] < 0) {
            calcError.textContent = `Invalid standard deviation for asset #${
              i + 1
            }.`;
            calcError.classList.remove("hidden");
            return;
          }
        }

        let weightSum = weightsRaw.reduce((a, b) => a + b, 0);
        if (Math.abs(weightSum) < 1e-12) {
          calcError.textContent = "Sum of weights cannot be zero.";
          calcError.classList.remove("hidden");
          return;
        }
        const weights = weightsRaw.map((w) => w / weightSum);

        const sds = sdsPct.map((v) => v / 100);

        const corr = Array.from({ length: n }, () => Array(n).fill(0));
        const corrInputs = correlationContainer.querySelectorAll(".corr-input");
        for (let i = 0; i < n; i++) {
          corr[i][i] = 1;
        }
        corrInputs.forEach((inp) => {
          const i = parseInt(inp.dataset.i, 10);
          const j = parseInt(inp.dataset.j, 10);
          let v = parseNumber(inp.value);
          if (!isFinite(v)) v = 0;
          if (v > 1) v = 1;
          if (v < -1) v = -1;
          corr[i][j] = v;
          corr[j][i] = v;
        });

        const cov = Array.from({ length: n }, () => Array(n).fill(0));
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < n; j++) {
            cov[i][j] = sds[i] * sds[j] * corr[i][j];
          }
        }

        let varP = 0;
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < n; j++) {
            varP += weights[i] * weights[j] * cov[i][j];
          }
        }

        if (varP < 0) varP = 0;
        const sdP = Math.sqrt(varP);

        resultVar.textContent = varP.toFixed(6);
        resultSd.textContent = (sdP * 100).toFixed(2) + "%";

        const scale = scaleSelect.value;
        if (scale === "daily") {
          const annualSd = sdP * Math.sqrt(252);
          resultSdAnnualized.textContent =
            "Approx. annualized volatility (assuming 252 trading days): " +
            (annualSd * 100).toFixed(2) +
            "%";
          resultSdAnnualized.classList.remove("hidden");
        } else if (scale === "monthly") {
          const annualSd = sdP * Math.sqrt(12);
          resultSdAnnualized.textContent =
            "Approx. annualized volatility (12 months): " +
            (annualSd * 100).toFixed(2) +
            "%";
          resultSdAnnualized.classList.remove("hidden");
        } else {
          resultSdAnnualized.classList.add("hidden");
        }

        // Risk contributions
        const mrc = new Array(n).fill(0);
        for (let i = 0; i < n; i++) {
          let sumCov = 0;
          for (let j = 0; j < n; j++) {
            sumCov += weights[j] * cov[i][j];
          }
          mrc[i] = 2 * sumCov;
        }

        if (varP > 0) {
          contribBody.innerHTML = "";
          for (let i = 0; i < n; i++) {
            const contribVar = (weights[i] * mrc[i]) / 2;
            const pctVar = (contribVar / varP) * 100;
            const tr = document.createElement("tr");
            tr.innerHTML = `
          <td class="px-2 py-1 border-b">${labels[i]}</td>
          <td class="px-2 py-1 border-b text-right">${weights[i].toFixed(
            4
          )}</td>
          <td class="px-2 py-1 border-b text-right">${mrc[i].toFixed(6)}</td>
          <td class="px-2 py-1 border-b text-right">${pctVar.toFixed(2)}%</td>
        `;
            contribBody.appendChild(tr);
          }
          contribSection.classList.remove("hidden");
        }

        // Diversification note
        let maxSd = 0;
        sds.forEach((v) => {
          if (v > maxSd) maxSd = v;
        });
        if (sdP < maxSd - 1e-8) {
          diversificationNote.textContent =
            "Your portfolio volatility is lower than the most volatile individual asset, indicating a diversification benefit from imperfect correlations.";
        } else {
          diversificationNote.textContent =
            "Your portfolio volatility is close to the volatility of the most volatile asset, suggesting limited diversification (correlations may be high).";
        }

        resultsSection.classList.remove("hidden");
      });

      // FAQ toggle (simple, in addition to global script)
      document
        .querySelectorAll("#faq-container .faq-question")
        .forEach((btn) => {
          btn.addEventListener("click", () => {
            const answer = btn.parentElement.querySelector(".faq-answer");
            const sign = btn.querySelector("span:last-child");
            const isHidden = answer.classList.contains("hidden");
            document
              .querySelectorAll("#faq-container .faq-answer")
              .forEach((a) => a.classList.add("hidden"));
            document
              .querySelectorAll("#faq-container .faq-question span:last-child")
              .forEach((s) => (s.textContent = "+"));
            if (isHidden) {
              answer.classList.remove("hidden");
              sign.textContent = "−";
            }
          });
        });

      // Initial build
      buildAssetTable(3);
      buildCorrelationMatrix(3);
    </script>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["\\(", "\\)"],
            ["$", "$"],
          ],
          displayMath: [
            ["$", "$"],
            ["\\[", "\\]"],
          ],
        },
        svg: { fontCache: "global" },
      };
    </script>
    <script>
  (function () {
    var loadMathJax = function () {
      if (window.__mathjaxLoading) return;
      window.__mathjaxLoading = true;
      var script = document.createElement("script");
      script.id = "MathJax-script";
      script.async = true;
      script.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js";
      document.head.appendChild(script);
    };

    var target = document.querySelector(
      ".formula-box, .mathjax, .math, .formula, [data-mathjax]"
    );

    if (!target) return;

    if ("IntersectionObserver" in window) {
      var observer = new IntersectionObserver(
        function (entries) {
          if (entries.some(function (entry) { return entry.isIntersecting; })) {
            observer.disconnect();
            loadMathJax();
          }
        },
        { rootMargin: "200px" }
      );
      observer.observe(target);
    } else {
      window.addEventListener(
        "load",
        function () {
          setTimeout(loadMathJax, 1000);
        },
        { once: true }
      );
    }
  })();
</script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
<script>
  window.__cmpLoadQueued = window.__cmpLoadQueued || [];
  window.addEventListener("load", function () {
    var loadCmp = function () {
      var s1 = document.createElement("script");
      s1.src = "https://cmp.gatekeeperconsent.com/min.js";
      s1.async = true;
      s1.setAttribute("data-cfasync", "false");
      document.head.appendChild(s1);

      var s2 = document.createElement("script");
      s2.src = "https://the.gatekeeperconsent.com/cmp.min.js";
      s2.async = true;
      s2.setAttribute("data-cfasync", "false");
      document.head.appendChild(s2);
    };

    if ("requestIdleCallback" in window) {
      requestIdleCallback(loadCmp, { timeout: 2000 });
    } else {
      setTimeout(loadCmp, 1000);
    }
  });
</script>
<script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
<script>
      window.ezstandalone = window.ezstandalone || {};
      ezstandalone.cmd = ezstandalone.cmd || [];
    </script>
</body>
</html>
