<!DOCTYPE html><html lang="en"><head>
<link rel="canonical" href="https://calcdomain.com/heart-rate-calculator">





  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Heart Rate Calculator – Target Zones, HRmax &amp; Karvonen (HRR)</title>
  <meta name="description" content="Calculate your target heart rate zones using multiple HRmax formulas (Fox, Tanaka, HUNT, Gulati for women) and the Karvonen method (HRR). Includes step-by-step example, formulas in LaTeX, accessible UI, and expert guidance.">
  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com" defer=""></script>
  <!-- Chart.js (for optional zone visualization) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer=""></script>
  <!-- MathJax for LaTeX formulas -->
  <script defer="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root { --focus: #2563eb; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; }
    /* readable prose sizing */
    .prose { max-width: 68ch; }
    .prose h2 { font-size: 1.375rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; }
    .prose p  { line-height: 1.65; margin-bottom: 0.9rem; }
    .prose ul, .prose ol { margin-left: 1.25rem; margin-bottom: 1rem; }
    .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow-x:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    /* results container min-height to prevent CLS */
    #results { min-height: 16rem; }
    /* focus styles (WCAG) */
    :where(a, button, input, select, details, summary, textarea):focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
      border-radius: 8px;
    }
    /* Touch targets */
    .tap-target { min-height: 48px; min-width: 48px; }
    /* Print */
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; inset: 0; }
      #zoneChartWrap { display: none !important; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Heart Rate Calculator – Target Zones, HRmax & Karvonen (HRR)",
  "url": "https://calcdomain.com/heart-rate-calculator",
  "inLanguage": "en",
  "description": "Calculate your target heart rate zones using multiple HRmax formulas (Fox, Tanaka, HUNT, Gulati for women) and the Karvonen method (HRR).",
  "about": [
    {
      "@type": "Thing",
      "name": "Heart rate"
    },
    {
      "@type": "Thing",
      "name": "Exercise intensity"
    }
  ],
  "reviewedBy": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "dateModified": "2026-01-19"
}</script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Health & Fitness",
      "item": "https://calcdomain.com/categories/health-fitness"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Health Metrics",
      "item": "https://calcdomain.com/subcategories/health-metrics"
    }
  ]
}
</script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Which maximum heart rate formula should I use?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Fox (220 − age) is a rough rule; Tanaka (208 − 0.7 × age) and HUNT (211 − 0.64 × age) are research-backed for mixed populations. Gulati (206 − 0.88 × age) is recommended for women. Compare all and fine-tune with your real-world data."
      }
    },
    {
      "@type": "Question",
      "name": "What is the Karvonen (HRR) method?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Karvonen uses heart rate reserve (HRR = HRmax − Resting HR) to compute target training heart rates: Target HR = Resting HR + %Intensity × HRR. It individualizes zones based on your resting HR."
      }
    },
    {
      "@type": "Question",
      "name": "Are wrist wearables accurate for HR zones?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Wrist optical sensors can lag or drift during high-intensity or arm-dominant activities. Use a chest strap for best accuracy and validate zones with perceived exertion and pace/power where relevant."
      }
    },
    {
      "@type": "Question",
      "name": "Do medications affect target heart rate?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes. Beta-blockers, some calcium channel blockers, and other medications blunt HR response. Consult your clinician; perceived exertion or power/pace may be better guides."
      }
    },
    {
      "@type": "Question",
      "name": "What zone is best for fat loss or endurance?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Consistent Zone 2 (roughly 60–70% HRmax or 40–59% HRR) builds aerobic base and supports fat oxidation. Mix higher-intensity sessions judiciously for performance adaptations."
      }
    }
  ]
}
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="https://calcdomain.com" class="text-2xl font-extrabold text-blue-600">CalcDomain</a>
      
        
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Max HR (pick a formula): \( HR_{\max}^{\text{Fox}} = 220 - \text{age} \) | \( HR_{\max}^{\text{Tanaka}} = 208 - 0.7\,\text{age} \) | \( HR_{\max}^{\text{HUNT}} = 211 - 0.64\,\text{age} \) \( HR_{\max}^{\text{Gulati (women)}} = 206 - 0.88\,\text{age} \) Heart Rate Reserve (HRR): \( HRR = HR_{\max} - HR_{\text{rest}} \) Karvonen target: \( HR_{\text{target}} = HR_{\text{rest}} + \% \times HRR \) AHA zones (by %HRmax): Moderate \( \approx 50\!-\!70\% \), Vigorous \( \approx 70\!-\!85\% \).</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><em>No variables provided in audit spec.</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>PubMed</strong> — pubmed.ncbi.nlm.nih.gov · Accessed 2026-01-19<br><a href="https://pubmed.ncbi.nlm.nih.gov/11153730/" target="_blank" rel="nofollow noopener">https://pubmed.ncbi.nlm.nih.gov/11153730/</a></li>
<li><strong>PubMed</strong> — pubmed.ncbi.nlm.nih.gov · Accessed 2026-01-19<br><a href="https://pubmed.ncbi.nlm.nih.gov/22376273/" target="_blank" rel="nofollow noopener">https://pubmed.ncbi.nlm.nih.gov/22376273/</a></li>
<li><strong>Home</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/" target="_blank" rel="nofollow noopener">https://calcdomain.com/</a></li>
<li><strong>Health &amp; Fitness</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/health-fitness" target="_blank" rel="nofollow noopener">https://calcdomain.com/health-fitness</a></li>
<li><strong>Health Metrics</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/health-metrics" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/health-metrics</a></li>
<li><strong>American Heart Association (AHA): Target Heart Rates</strong> — heart.org · Accessed 2026-01-19<br><a href="https://www.heart.org/en/healthy-living/fitness/fitness-basics/target-heart-rates" target="_blank" rel="nofollow noopener">https://www.heart.org/en/healthy-living/fitness/fitness-basics/target-heart-rates</a></li>
<li><strong>Circulation</strong> — ahajournals.org · Accessed 2026-01-19<br><a href="https://www.ahajournals.org/doi/10.1161/CIRCULATIONAHA.110.939249" target="_blank" rel="nofollow noopener">https://www.ahajournals.org/doi/10.1161/CIRCULATIONAHA.110.939249</a></li>
<li><strong>Physiotutors</strong> — physiotutors.com · Accessed 2026-01-19<br><a href="https://www.physiotutors.com/wiki/karvonen-formula/" target="_blank" rel="nofollow noopener">https://www.physiotutors.com/wiki/karvonen-formula/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
      </section>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-600">
            Ad Placement (300×600)
          </div>

          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-lg mb-3">Why this calculator is different</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Multiple HRmax formulas (Fox, Tanaka, HUNT, Gulati) + custom override.</li>
              <li>Dual view: %HRmax (AHA) and %HRR (Karvonen) for individualized targets.</li>
              <li>WCAG-accessible UI with inline validation and print-friendly output.</li>
            </ul>
          </div>

          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-lg mb-4">Related health tools</h3>
            <ul class="space-y-3 text-sm">
              <li><a class="text-blue-700 hover:underline" href="https://calcdomain.com/bmi-calculator">BMI Calculator</a></li>
              <li>VO₂max Estimator</li>
              <li><a class="text-blue-700 hover:underline" href="https://calcdomain.com/calorie">Calorie &amp; TDEE Calculator</a></li>
              <li>Pace &amp; Zone Planner</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                                                <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction & DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health & Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle & Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math & Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer>




















  <!-- Calculator Logic (defer in head per spec; kept here at end for clarity and to avoid blocking) -->
  <script defer="">
  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const el = {
      age:        document.getElementById('age'),
      sex:        document.getElementById('sex'),
      rhr:        document.getElementById('rhr'),
      method:     document.getElementById('method'),
      customMax:  document.getElementById('customMax'),
      zoneScale:  document.getElementById('zoneScale'),
      calcBtn:    document.getElementById('calcBtn'),
      printBtn:   document.getElementById('printBtn'),
      resetBtn:   document.getElementById('resetBtn'),
      // errors
      ageError:   document.getElementById('ageError'),
      rhrError:   document.getElementById('rhrError'),
      customError:document.getElementById('customError'),
      // outputs
      hrmaxOut:   document.getElementById('hrmaxOut'),
      hrmaxNote:  document.getElementById('hrmaxNote'),
      hrrOut:     document.getElementById('hrrOut'),
      recOut:     document.getElementById('recOut'),
      zonesMaxBody: document.getElementById('zonesMaxBody'),
      zonesHrrBody: document.getElementById('zonesHrrBody')
    };

    // Accessible tooltip toggles (for all "?" buttons near labels)
    document.querySelectorAll('label + div > button[aria-controls]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('aria-controls');
        const tgt = document.getElementById(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tgt.classList.toggle('hidden', expanded);
      });
      // Start tooltips visible (we keep them visible by default for clarity)
    });

    // Validation helpers
    function setError(elErr, msg, input) {
      elErr.textContent = msg;
      elErr.classList.remove('hidden');
      if (input) input.setAttribute('aria-invalid', 'true');
    }
    function clearError(elErr, input) {
      elErr.textContent = '';
      elErr.classList.add('hidden');
      if (input) input.removeAttribute('aria-invalid');
    }

    function validateAge() {
      const v = Number(el.age.value);
      if (!Number.isFinite(v) || v < 10 || v > 100) {
        setError(el.ageError, 'Please enter an age between 10 and 100 years.', el.age);
        return false;
      }
      clearError(el.ageError, el.age);
      return true;
    }
    function validateRhr() {
      const v = Number(el.rhr.value);
      if (!Number.isFinite(v) || v < 30 || v > 120) {
        setError(el.rhrError, 'Resting HR should be between 30 and 120 bpm. Measure on waking for accuracy.', el.rhr);
        return false;
      }
      clearError(el.rhrError, el.rhr);
      return true;
    }
    function validateCustom() {
      if (el.method.value !== 'custom') { clearError(el.customError, el.customMax); return true; }
      const v = Number(el.customMax.value);
      if (!Number.isFinite(v) || v < 120 || v > 230) {
        setError(el.customError, 'Custom HRmax must be between 120 and 230 bpm.', el.customMax);
        return false;
      }
      clearError(el.customError, el.customMax);
      return true;
    }

    // On-blur validation (per spec)
    el.age.addEventListener('blur', validateAge);
    el.rhr.addEventListener('blur', validateRhr);
    el.customMax.addEventListener('blur', validateCustom);
    el.method.addEventListener('change', validateCustom);

    // HRmax calculators
    function hrmax(age, method, sex, customVal) {
      switch (method) {
        case 'fox':   return 220 - age;
        case 'tanaka':return 208 - 0.7 * age;
        case 'hunt':  return 211 - 0.64 * age;
        case 'gulati':return sex === 'female' ? 206 - 0.88 * age : 208 - 0.7 * age; // fallback to Tanaka if not female
        case 'custom':return Number(customVal) || NaN;
        default:      return 208 - 0.7 * age;
      }
    }

    // Zones
    const ZONES_MAX = [
      { name: 'Z1 (Warm-up/Recovery)', lo: 0.50, hi: 0.60 },
      { name: 'Z2 (Endurance/Base)',  lo: 0.60, hi: 0.70 },
      { name: 'Z3 (Tempo/Aerobic)',   lo: 0.70, hi: 0.80 },
      { name: 'Z4 (Threshold)',       lo: 0.80, hi: 0.90 },
      { name: 'Z5 (VO₂max)',          lo: 0.90, hi: 1.00 }
    ];
    const ZONES_HRR = [
      { name: 'Z1 (Recovery)', lo: 0.30, hi: 0.39 },
      { name: 'Z2 (Endurance)',lo: 0.40, hi: 0.59 },
      { name: 'Z3 (Tempo)',    lo: 0.60, hi: 0.69 },
      { name: 'Z4 (Thresh.)',  lo: 0.70, hi: 0.84 },
      { name: 'Z5 (VO₂max)',   lo: 0.85, hi: 1.00 }
    ];

    // Formatters
    const fmt = (n) => Math.round(n);
    const bpm = (n) => Number.isFinite(n) ? `${fmt(n)} bpm` : '—';

    // Render zone tables
    function renderMaxZones(max) {
      el.zonesMaxBody.innerHTML = '';
      ZONES_MAX.forEach(z => {
        const lo = z.lo * max, hi = z.hi * max;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-3 py-2 text-left">${z.name}</td>
          <td class="px-3 py-2 text-right">${fmt(z.lo*100)}–${fmt(z.hi*100)}%</td>
          <td class="px-3 py-2 text-right">${fmt(lo)}–${fmt(hi)} bpm</td>`;
        el.zonesMaxBody.appendChild(tr);
      });
    }
    function renderHrrZones(max, rhr) {
      el.zonesHrrBody.innerHTML = '';
      const hrr = max - rhr;
      ZONES_HRR.forEach(z => {
        const lo = rhr + z.lo * hrr, hi = rhr + z.hi * hrr;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-3 py-2 text-left">${z.name}</td>
          <td class="px-3 py-2 text-right">${fmt(z.lo*100)}–${fmt(z.hi*100)}%</td>
          <td class="px-3 py-2 text-right">${fmt(lo)}–${fmt(hi)} bpm</td>`;
        el.zonesHrrBody.appendChild(tr);
      });
      return hrr;
    }

    // Chart
    let chart;
    function renderChart(max, rhr) {
      const ctx = document.getElementById('zoneChart');
      if (!ctx) return;
      const hrr = max - rhr;

      // Show midpoints of Z2-Z5 to visualize targets (HRR scale)
      const mids = ZONES_HRR.map(z => rhr + ((z.lo + z.hi)/2) * hrr);
      const labels = ZONES_HRR.map(z => z.name);

      const data = {
        labels,
        datasets: [{
          label: 'Midpoint (Karvonen, bpm)',
          data: mids
        }]
      };
      const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { title: { display: true, text: 'BPM' }, beginAtZero: false }
        }
      };

      if (chart) { chart.data = data; chart.options = options; chart.update(); }
      else { chart = new Chart(ctx, { type: 'bar', data, options }); }
    }

    function recommendText(max, rhr) {
      const modLo = 0.50 * max, modHi = 0.70 * max;
      const vigLo = 0.70 * max, vigHi = 0.85 * max;
      return `Moderate ~ ${fmt(modLo)}–${fmt(modHi)} bpm; Vigorous ~ ${fmt(vigLo)}–${fmt(vigHi)} bpm`;
    }

    function calculate() {
      if (!(validateAge() & validateRhr() & validateCustom())) return;

      const age = Number(el.age.value);
      const rhr = Number(el.rhr.value);
      const method = el.method.value;
      const sex = el.sex.value;
      const customVal = el.customMax.value;

      let max = hrmax(age, method, sex, customVal);
      if (!Number.isFinite(max) || max <= rhr + 10) {
        setError(el.customError, 'Computed HRmax is too low relative to RHR; check inputs or use Custom HRmax.', null);
        return;
      } else {
        clearError(el.customError, null);
      }

      // Outputs
      el.hrmaxOut.textContent = bpm(max);
      el.hrmaxNote.textContent = `Method: ${method === 'custom' ? 'Custom' :
        method === 'fox' ? 'Fox (220−age)' :
        method === 'tanaka' ? 'Tanaka (208−0.7×age)' :
        method === 'hunt' ? 'HUNT (211−0.64×age)' :
        'Gulati (women, 206−0.88×age)'}`;

      const hrr = renderHrrZones(max, rhr);
      el.hrrOut.textContent = bpm(hrr);
      renderMaxZones(max);
      el.recOut.textContent = recommendText(max, rhr);

      renderChart(max, rhr);
    }

    // Events
    el.calcBtn.addEventListener('click', calculate);
    el.printBtn.addEventListener('click', () => window.print());
    el.resetBtn.addEventListener('click', () => {
      el.age.value = 35; el.sex.value = 'male'; el.rhr.value = 60;
      el.method.value = 'tanaka'; el.customMax.value = ''; el.zoneScale.value = 'percentMax';
      el.hrmaxOut.textContent = '—'; el.hrrOut.textContent = '—'; el.recOut.textContent = '—';
      el.zonesMaxBody.innerHTML = ''; el.zonesHrrBody.innerHTML = '';
      if (window.MathJax && MathJax.typeset) MathJax.typeset();
    });

    // Auto-run initial calc
    calculate();
  });
  </script>


</body></html>