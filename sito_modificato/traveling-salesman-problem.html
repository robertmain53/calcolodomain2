<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Traveling Salesman Problem (TSP) Calculator &amp; Visualizer</title>
    <meta name="description" content="Interactive Traveling Salesman Problem (TSP) calculator. Enter city coordinates or a distance matrix, run an exact Held–Karp solver for small instances or a nearest-neighbor + 2-opt heuristic for larger ones, and visualize the optimal tour and total distance.">
    <link rel="canonical" href="https://calcdomain.com/traveling-salesman-problem">
    
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-hover { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .prose { max-width: 65ch; margin-left: auto; margin-right: auto; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .formula-box { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 8px; padding: 1rem; overflow-x: auto; margin: 1rem 0; }
        .pill-toggle button { transition: background-color 0.15s ease, color 0.15s ease, border-color 0.15s ease; }
        .code-like { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        table.tsp-table th, table.tsp-table td { font-size: 0.75rem; padding: 0.25rem 0.4rem; border: 1px solid #e5e7eb; text-align: right; }
        table.tsp-table th:first-child, table.tsp-table td:first-child { text-align: left; }
    </style>
    
    <!-- HEAD_SCRIPTS_E_META -->
    <!-- Google tag (gtag.js) -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7MB5V1LZRN');
    </script>

    <meta name="google-site-verification" content="_tiTZ9ivAdtXcAS9CMnTNJ549Sg39WVqP_ZFbWgglNA">

    <script src="https://cmp.gatekeeperconsent.com/min.js" data-cfasync="false"></script>
    <script src="https://the.gatekeeperconsent.com/cmp.min.js" data-cfasync="false"></script>

    <script async="" src="//www.ezojs.com/ezoic/sa.min.js"></script>
    <script>
        window.ezstandalone = window.ezstandalone || {};
        ezstandalone.cmd = ezstandalone.cmd || [];
    </script>

    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://calcdomain.com"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Math & Conversions",
          "item": "https://calcdomain.com/categories/math-conversions"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Core Math Algebra",
          "item": "https://calcdomain.com/subcategories/core-math-algebra"
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is the Traveling Salesman Problem (TSP)?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The Traveling Salesman Problem asks for the shortest possible tour that visits each city exactly once and returns to the starting city, given pairwise distances between cities. It is a classic NP-hard optimization problem in combinatorial optimization and operations research."
          }
        },
        {
          "@type": "Question",
          "name": "Which algorithms does this TSP calculator use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "For small instances (up to 12 cities), the calculator can use the Held–Karp dynamic programming algorithm to find an exact optimal tour. For larger instances it uses a two-stage heuristic: a nearest-neighbor construction followed by 2-opt local search to improve the tour."
          }
        },
        {
          "@type": "Question",
          "name": "How many cities can I solve optimally with this tool?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The exact Held–Karp solver in this tool is limited to 12 cities to keep computations fast in the browser. The heuristic method can handle more cities (typically up to a few dozen) but does not guarantee optimality."
          }
        },
        {
          "@type": "Question",
          "name": "Can I enter a custom distance matrix instead of coordinates?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. In Distance matrix mode you can enter an arbitrary symmetric or asymmetric distance matrix. The calculator will treat the distances as given and solve the TSP on that matrix."
          }
        },
        {
          "@type": "Question",
          "name": "Does the TSP calculator support Euclidean distances from coordinates?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. In Coordinates mode you enter X and Y coordinates for each city. The calculator builds a symmetric distance matrix using Euclidean distances between the points and then runs the selected algorithm."
          }
        }
      ]
    },
    {
      "@type": "HowTo",
      "name": "How to use the Traveling Salesman Problem calculator",
      "description": "Step-by-step guide for entering cities, choosing an algorithm and interpreting the TSP tour produced by the calculator.",
      "step": [
        {
          "@type": "HowToStep",
          "position": 1,
          "name": "Choose input mode",
          "text": "Select Coordinates if you have the locations of cities as X, Y pairs. Select Distance matrix if you already have a full matrix of distances between all city pairs."
        },
        {
          "@type": "HowToStep",
          "position": 2,
          "name": "Specify the number of cities",
          "text": "Enter the number of cities. For exact optimization with Held–Karp, keep the number of cities at or below 12."
        },
        {
          "@type": "HowToStep",
          "position": 3,
          "name": "Fill in coordinates or distances",
          "text": "If you selected Coordinates mode, fill in X and Y for each city. In Distance matrix mode, fill in the distance between every ordered pair of distinct cities."
        },
        {
          "@type": "HowToStep",
          "position": 4,
          "name": "Choose algorithm and run",
          "text": "Pick either the exact Held–Karp solver (for small cases) or the nearest-neighbor + 2-opt heuristic, then click Calculate tour. The tool reports the total length and the visiting order."
        },
        {
          "@type": "HowToStep",
          "position": 5,
          "name": "Interpret the tour and visualization",
          "text": "Use the reported sequence of cities and the SVG visualization to understand the route. The distance table shows edge-by-edge contributions to the total tour length."
        }
      ]
    }
  ]
}
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
.auditspine-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:600;
  border:1px solid #e5e7eb;
  background:#f8fafc;
  color:#0f172a;
}
.auditspine-badge-warn{
  background:#fff7ed;
  border-color:#fed7aa;
  color:#9a3412;
}
</style>
</head>

<body class="bg-gray-50 text-gray-800">

    <!-- BODY_SCRIPTS_INIZIO -->
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9476637732224939" crossorigin="anonymous"></script>

    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a href="https://calcdomain.com" class="text-2xl font-bold text-blue-600">CalcDomain</a>
          <div class="w-full max-w-md hidden md:block mx-8">
            <div class="relative">
              <input type="search" id="search-input" placeholder="Search for a calculator..." class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off">
              <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
              <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a href="https://calcdomain.com/search" class="text-gray-700 hover:text-blue-600 transition-colors">Advanced Search</a>
            <a href="https://calcdomain.com/categories" class="text-gray-700 hover:text-blue-600 transition-colors">Categories</a>
          </div>
          <button id="mobile-menu-toggle" class="md:hidden p-2" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open menu" type="button">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
          </button>
        </div>
        <nav id="mobile-menu" class="md:hidden mt-4 hidden" aria-label="Mobile menu" role="navigation">
          <div class="mb-4">
            <div class="relative">
              <input type="search" id="mobile-search-input" placeholder="Search calculators..." class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
          </div>
          <div class="space-y-2">
            <a href="https://calcdomain.com/search" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
            <a href="https://calcdomain.com/categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
          </div>
        </nav>
      </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
      
      <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> &raquo; <a href="https://calcdomain.com/categories/math-conversions" class="hover:text-blue-600">Math & Conversions</a> &raquo; <a href="https://calcdomain.com/subcategories/core-math-algebra" class="hover:text-blue-600">Core Math Algebra</a></nav>
      
      <div class="flex flex-col lg:flex-row gap-8">
        
        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            
            <h1 class="text-2xl md:text-3xl font-bold mb-3">Traveling Salesman Problem (TSP) Calculator</h1>
            <p class="text-gray-700 mb-2">
              Build and solve small instances of the <strong>Traveling Salesman Problem (TSP)</strong>.
              Enter city coordinates (X, Y) or a full distance matrix, choose an <strong>exact Held–Karp
              solver</strong> for up to 12 cities or a <strong>nearest-neighbor + 2-opt heuristic</strong>
              for larger cases, and visualize the resulting tour.
            </p>
            <p class="text-gray-700 mb-4">
              This tool is ideal for teaching, coursework and quick what-if analyses in operations research,
              logistics and graph theory.
            </p>

            <!-- Input mode -->
            <section class="mb-4">
              <h2 class="text-lg font-semibold mb-2">Input mode</h2>
              <div class="pill-toggle inline-flex flex-wrap gap-2 text-xs md:text-sm">
                <button type="button" data-tsp-mode="coords" class="tsp-mode-btn px-3 py-1.5 rounded-full border border-blue-600 bg-blue-600 text-white font-medium">
                  Coordinates (X, Y)
                </button>
                <button type="button" data-tsp-mode="matrix" class="tsp-mode-btn px-3 py-1.5 rounded-full border border-gray-300 bg-white text-gray-700">
                  Distance matrix
                </button>
              </div>
            </section>

            <!-- Coordinates mode -->
            <section id="tsp-coords-section" class="mb-6">
              <div class="grid md:grid-cols-3 gap-4 mb-3">
                <div>
                  <label for="tsp-n-coords" class="block text-sm font-medium text-gray-700 mb-1">
                    Number of cities (n)
                  </label>
                  <input id="tsp-n-coords" type="number" min="3" max="20" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" value="5">
                  <p class="text-xs text-gray-500 mt-1">
                    For exact optimization, keep n ≤ 12.
                  </p>
                </div>
                <div class="flex items-end">
                  <button id="tsp-build-coords" type="button" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Rebuild table
                  </button>
                </div>
                <div class="flex items-end">
                  <button id="tsp-example-coords" type="button" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Load example
                  </button>
                </div>
              </div>

              <div class="border border-gray-200 rounded-lg p-3">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-sm font-medium text-gray-700">City coordinates</span>
                </div>
                <div class="overflow-x-auto">
                  <table id="tsp-coords-table" class="tsp-table border-collapse min-w-full bg-white">
                    <!-- filled by JS -->
                  </table>
                </div>
                <p class="text-xs text-gray-500 mt-2">
                  Each row is one city. Labels are assigned automatically (A, B, C, ...). Coordinates are arbitrary:
                  you can treat them as X/Y on a plane or as projected longitude / latitude.
                </p>
              </div>
            </section>

            <!-- Matrix mode -->
            <section id="tsp-matrix-section" class="mb-6 hidden">
              <div class="grid md:grid-cols-3 gap-4 mb-3">
                <div>
                  <label for="tsp-n-matrix" class="block text-sm font-medium text-gray-700 mb-1">
                    Number of cities (n)
                  </label>
                  <input id="tsp-n-matrix" type="number" min="3" max="20" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" value="5">
                  <p class="text-xs text-gray-500 mt-1">
                    Larger n increases compute time for heuristics; exact solver limited to n ≤ 12.
                  </p>
                </div>
                <div class="flex items-end">
                  <button id="tsp-build-matrix" type="button" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Rebuild matrix
                  </button>
                </div>
                <div class="flex items-end">
                  <button id="tsp-example-matrix" type="button" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Load symmetric example
                  </button>
                </div>
              </div>

              <div class="border border-gray-200 rounded-lg p-3">
                <span class="text-sm font-medium text-gray-700 block mb-2">Distance matrix</span>
                <div class="overflow-x-auto">
                  <table id="tsp-matrix-table" class="tsp-table border-collapse min-w-full bg-white">
                    <!-- filled by JS -->
                  </table>
                </div>
                <p class="text-xs text-gray-500 mt-2">
                  Cell (i, j) is the distance from city i to city j. Diagonal entries are ignored. The matrix may be
                  asymmetric; the solver will treat it as a directed TSP.
                </p>
              </div>
            </section>

            <!-- Algorithm & controls -->
            <section class="mb-4">
              <div class="grid md:grid-cols-3 gap-4 mb-3">
                <div>
                  <label for="tsp-algorithm" class="block text-sm font-medium text-gray-700 mb-1">
                    Algorithm
                  </label>
                  <select id="tsp-algorithm" class="w-full border border-gray-300 rounded-md px-2 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="exact">Exact Held–Karp (n ≤ 12)</option>
                    <option value="heuristic">Nearest-neighbor + 2-opt heuristic</option>
                  </select>
                  <p class="text-xs text-gray-500 mt-1">
                    Exact solver guarantees optimality; heuristic scales better but is approximate.
                  </p>
                </div>
                <div>
                  <label for="tsp-decimals" class="block text-sm font-medium text-gray-700 mb-1">
                    Decimals in output
                  </label>
                  <input id="tsp-decimals" type="number" min="0" max="6" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" value="3">
                </div>
              </div>

              <div class="flex flex-wrap items-center gap-3">
                <button id="tsp-calc-btn" type="button" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                  Calculate tour
                </button>
                <button id="tsp-clear-btn" type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                  Clear all
                </button>
                <p class="text-xs text-gray-500">
                  Use dot or comma as decimal separator. Empty cells are treated as missing values and will cause an error.
                </p>
              </div>

              <p id="tsp-error" class="text-sm text-red-600 mt-3 hidden"></p>
            </section>

            <!-- Results -->
            <section id="tsp-result-section" class="border border-gray-200 rounded-lg p-4 mb-4 hidden">
              <h2 class="text-lg font-semibold mb-2">TSP tour results</h2>
              <p id="tsp-result-summary" class="text-sm text-gray-800 mb-2"></p>
              <p id="tsp-result-detail" class="text-xs text-gray-700 mb-3"></p>

              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div class="border border-gray-100 rounded-md p-3 bg-gray-50">
                  <h3 class="text-sm font-semibold text-gray-800 mb-2">Tour information</h3>
                  <ul class="text-xs text-gray-700 space-y-1">
                    <li id="tsp-tour-length"></li>
                    <li id="tsp-tour-order"></li>
                    <li id="tsp-tour-start"></li>
                    <li id="tsp-tour-algorithm"></li>
                  </ul>
                </div>
                <div class="border border-gray-100 rounded-md p-3 bg-gray-50">
                  <h3 class="text-sm font-semibold text-gray-800 mb-2">Distance breakdown</h3>
                  <div class="overflow-x-auto">
                    <table class="tsp-table border-collapse min-w-full bg-white">
                      <thead>
                        <tr>
                          <th>Step</th>
                          <th>Edge</th>
                          <th>Distance</th>
                        </tr>
                      </thead>
                      <tbody id="tsp-distance-body">
                        <!-- filled by JS -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- SVG visualization -->
              <div id="tsp-visual-wrapper" class="border border-gray-100 rounded-md p-3 mb-2 bg-white">
                <h3 class="text-sm font-semibold text-gray-800 mb-2">Route visualization (coordinates mode)</h3>
                <svg id="tsp-svg" viewBox="0 0 400 300" class="w-full h-64 border border-gray-200 rounded-md bg-gray-50"></svg>
                <p class="text-xs text-gray-500 mt-2">
                  Points represent cities; lines show the tour starting and ending at city A. If coordinates are
                  not available (distance matrix mode), the SVG is left empty.
                </p>
              </div>
            </section>

            <!-- Theory & explanations -->
            <section class="prose">
              <h2>What is the Traveling Salesman Problem?</h2>
              <p>
                The <strong>Traveling Salesman Problem (TSP)</strong> is a fundamental problem in combinatorial
                optimization: given a list of cities and pairwise distances, find the shortest possible tour that
                visits each city exactly once and returns to the starting city.
              </p>
              <p>
                Formally, given a complete graph with vertex set \(V\) and edge weights \(d(i, j)\), we seek a
                minimum-weight <strong>Hamiltonian cycle</strong>.
              </p>

              <h2>TSP as an optimization problem</h2>
              <div class="formula-box text-sm">
                <p class="font-mono mb-1">
                  Minimize \( \displaystyle L = \sum_{i=1}^{n} d(c_i, c_{i+1}) \)
                </p>
                <p class="font-mono mb-0">
                  subject to \( (c_1, c_2, \dots, c_n) \) being a permutation of the cities and
                  \( c_{n+1} = c_1 \) (tour returns to start).
                </p>
              </div>
              <p>
                The TSP is <strong>NP-hard</strong>, which means that no known algorithm can guarantee optimal
                solutions in polynomial time for arbitrary large instances. However, many efficient exact and
                approximate algorithms exist for small and medium-sized problems.
              </p>

              <h2>Algorithms implemented in this TSP calculator</h2>
              <h3>1. Held–Karp dynamic programming (exact)</h3>
              <p>
                For up to about 12 cities, the calculator can use the classic
                <strong>Held–Karp algorithm</strong>, which runs in \(O(n^2 2^n)\) time. It represents partial
                tours as subsets of cities and uses dynamic programming to propagate the best cost to each state.
              </p>

              <div class="formula-box text-sm">
                <p class="font-mono mb-1">
                  \( C(S, j) = \min_{i \in S, i \ne j} \bigl[ C(S \setminus \{j\}, i) + d(i, j) \bigr] \)
                </p>
                <p class="text-xs mb-0">
                  where \(S\) is a subset of cities that includes the start and \(j\), and \(C(S, j)\) is the best
                  path cost from the start to \(j\) visiting exactly the cities in \(S\).
                </p>
              </div>

              <h3>2. Nearest-neighbor + 2-opt heuristic</h3>
              <p>
                For larger instances, the calculator offers a two-stage heuristic:
              </p>
              <ul>
                <li><strong>Nearest neighbor</strong> builds a tour greedily: from the current city, move to the nearest unvisited city.</li>
                <li><strong>2-opt</strong> then iteratively improves the tour by swapping two edges when it reduces the total length.</li>
              </ul>
              <p>
                Heuristics are fast and often find good tours, but they do not guarantee optimality.
              </p>

              <h2>Coordinate vs distance matrix input</h2>
              <ul>
                <li>
                  <strong>Coordinates mode</strong>: you specify planar coordinates \((x_i, y_i)\). The calculator
                  builds a symmetric distance matrix using Euclidean distances
                  \( d(i, j) = \sqrt{(x_i - x_j)^2 + (y_i - y_j)^2} \).
                </li>
                <li>
                  <strong>Matrix mode</strong>: you directly specify all distances. This is useful when distances are
                  road travel times, costs or any other metric that is not simple Euclidean distance.
                </li>
              </ul>

              <h2>Typical use cases</h2>
              <ul>
                <li>Teaching TSP and NP-hardness in algorithms or operations research courses.</li>
                <li>Demonstrating dynamic programming and local search heuristics.</li>
                <li>Small “toy” routing problems in logistics, field service or sales territory planning.</li>
                <li>Graph theory experiments in research and student projects.</li>
              </ul>

              <h2>Traveling Salesman Problem – FAQ</h2>

              <div class="mt-4 space-y-3">
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                  <button type="button" class="w-full text-left faq-question px-4 py-3 flex items-center justify-between">
                    <span class="font-medium text-gray-800">Why is the TSP considered difficult (NP-hard)?</span>
                    <span class="ml-2 text-gray-400">+</span>
                  </button>
                  <div class="faq-answer px-4 pb-4 pt-1 text-sm text-gray-700 hidden">
                    <p>
                      The number of possible tours through n cities is \((n-1)!/2\) in the symmetric case, which grows
                      faster than exponentially. NP-hardness means that unless P = NP, no algorithm can solve all
                      instances optimally in polynomial time. Exact methods must exploit structure and pruning to
                      handle realistic sizes.
                    </p>
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg overflow-hidden">
                  <button type="button" class="w-full text-left faq-question px-4 py-3 flex items-center justify-between">
                    <span class="font-medium text-gray-800">Is the tour produced by the heuristic guaranteed to be optimal?</span>
                    <span class="ml-2 text-gray-400">+</span>
                  </button>
                  <div class="faq-answer px-4 pb-4 pt-1 text-sm text-gray-700 hidden">
                    <p>
                      No. Heuristics like nearest neighbor and 2-opt are designed to be fast and usually produce good
                      tours, but they can get trapped in local minima. Only the exact Held–Karp solver guarantees that
                      the tour is globally optimal for the instance provided.
                    </p>
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg overflow-hidden">
                  <button type="button" class="w-full text-left faq-question px-4 py-3 flex items-center justify-between">
                    <span class="font-medium text-gray-800">Can I change the starting city of the tour?</span>
                    <span class="ml-2 text-gray-400">+</span>
                  </button>
                  <div class="faq-answer px-4 pb-4 pt-1 text-sm text-gray-700 hidden">
                    <p>
                      This calculator always labels cities A, B, C, … and uses A as the nominal starting point. For a
                      symmetric TSP, rotating the tour to start at a different city does not change its total length.
                      You can therefore re-index the tour manually to your preferred starting city.
                    </p>
                  </div>
                </div>

                <div class="border border-gray-200 rounded-lg overflow-hidden">
                  <button type="button" class="w-full text-left faq-question px-4 py-3 flex items-center justify-between">
                    <span class="font-medium text-gray-800">How accurate is the Euclidean distance when using geographic coordinates?</span>
                    <span class="ml-2 text-gray-400">+</span>
                  </button>
                  <div class="faq-answer px-4 pb-4 pt-1 text-sm text-gray-700 hidden">
                    <p>
                      If you plug raw latitude and longitude degrees into the coordinate fields, Euclidean distance is
                      only an approximation. For planning on the Earth’s surface, you should convert coordinates to a
                      suitable projected system (e.g. UTM) or work with precomputed distance matrices that reflect
                      real travel times or distances.
                    </p>
                  </div>
                </div>
              </div>
            </section>

          </div>
        
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\\]</div>
  <pre class="auditspine-mono">','\</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Minimize \( \displaystyle L = \sum_{i=1}^{n} d(c_i, c_{i+1}) \) subject to \( (c_1, c_2, \dots, c_n) \) being a permutation of the cities and \( c_{n+1} = c_1 \) (tour returns to start).</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">\( C(S, j) = \min_{i \in S, i \ne j} \bigl[ C(S \setminus \{j\}, i) + d(i, j) \bigr] \) where \(S\) is a subset of cities that includes the start and \(j\), and \(C(S, j)\) is the best path cost from the start to \(j\) visiting exactly the cities in \(S\).</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><em>No variables provided in audit spec.</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>NIST — Weights and measures</strong> — nist.gov · Accessed 2026-01-19<br><a href="https://www.nist.gov/pml/weights-and-measures" target="_blank" rel="nofollow noopener">https://www.nist.gov/pml/weights-and-measures</a></li>
<li><strong>FTC — Consumer advice</strong> — consumer.ftc.gov · Accessed 2026-01-19<br><a href="https://consumer.ftc.gov/" target="_blank" rel="nofollow noopener">https://consumer.ftc.gov/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</main>
        
        <aside class="w-full lg:w-1/3">
          <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-3">Core Math &amp; Algebra tools</h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="https://calcdomain.com/standard-form" class="text-blue-600 hover:underline">
                  Standard Form Calculator
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/percent-error-calculator" class="text-blue-600 hover:underline">
                  Percent Error Calculator
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/cohen-s-d-calculator" class="text-blue-600 hover:underline">
                  Effect Size (Cohen’s d)
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/g-test" class="text-blue-600 hover:underline">
                  G-test (Likelihood-Ratio Test)
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/foil" class="text-blue-600 hover:underline">
                  FOIL Method Calculator
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/adjacency-matrix" class="text-blue-600 hover:underline">
                  Graph Adjacency Matrix
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/speed-distance-time" class="text-blue-600 hover:underline">
                  Speed, Distance, Time
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/friedman-test" class="text-blue-600 hover:underline">
                  Friedman Test
                </a>
              </li>
              <li>
                <span class="text-gray-500">
                  Traveling Salesman Problem – you are here
                </span>
              </li>
              <li>
                <a href="https://calcdomain.com/stem-and-leaf-plot" class="text-blue-600 hover:underline">
                  Stem-and-Leaf Plot Generator
                </a>
              </li>
            </ul>
          </div>

          <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">Optimization &amp; graph tools</h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="https://calcdomain.com/shortest-path-dijkstra" class="text-blue-600 hover:underline">
                  Shortest Path (Dijkstra)
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/minimum-spanning-tree" class="text-blue-600 hover:underline">
                  Minimum Spanning Tree
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/network-flow-max-flow" class="text-blue-600 hover:underline">
                  Max Flow / Min Cut
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/linear-programming-solver" class="text-blue-600 hover:underline">
                  Linear Programming Solver
                </a>
              </li>
              <li>
                <a href="https://calcdomain.com/assignment-problem" class="text-blue-600 hover:underline">
                  Assignment Problem (Hungarian)
                </a>
              </li>
            </ul>
          </div>
        </aside>
        
      </div>
    </div>

    <footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction & DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health & Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle & Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math & Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer>















    
    <script src="/assets/js/script_menu.js" defer=""></script>
    <script src="/assets/js/script_faq.js" defer=""></script>
    <script src="search.js" defer=""></script>
    
    <script>
      // ---------- Helpers ----------
      function tspParseNumber(value) {
        if (value === null || value === undefined) return null;
        const normalized = String(value).replace(/\\s+/g, '').replace(',', '.');
        if (normalized === '') return null;
        const num = Number(normalized);
        return Number.isFinite(num) ? num : null;
      }

      function tspLetterLabel(index) {
        // 0 -> A, 1 -> B, ..., 25 -> Z, 26 -> AA, ...
        let n = index;
        let label = '';
        while (true) {
          const rem = n % 26;
          label = String.fromCharCode(65 + rem) + label;
          n = Math.floor(n / 26) - 1;
          if (n < 0) break;
        }
        return label;
      }

      // Compute tour length for given order and distance matrix
      function tspTourLength(order, dist) {
        let sum = 0;
        for (let i = 0; i < order.length - 1; i++) {
          sum += dist[order[i]][order[i+1]];
        }
        return sum;
      }

      // Nearest-neighbor starting from 0
      function tspNearestNeighbor(dist) {
        const n = dist.length;
        const visited = new Array(n).fill(false);
        const order = [0];
        visited[0] = true;
        let current = 0;
        for (let step = 1; step < n; step++) {
          let bestJ = -1;
          let bestD = Infinity;
          for (let j = 0; j < n; j++) {
            if (!visited[j] && j !== current) {
              const d = dist[current][j];
              if (d < bestD) {
                bestD = d;
                bestJ = j;
              }
            }
          }
          if (bestJ === -1) {
            // Fallback: choose any unvisited
            for (let j = 0; j < n; j++) {
              if (!visited[j] && j !== current) {
                bestJ = j;
                break;
              }
            }
          }
          if (bestJ === -1) break;
          visited[bestJ] = true;
          order.push(bestJ);
          current = bestJ;
        }
        order.push(0); // return to start
        return order;
      }

      // 2-opt local search
      function tspTwoOpt(order, dist, maxIterations) {
        const n = order.length;
        let improved = true;
        let iter = 0;
        while (improved && iter < maxIterations) {
          improved = false;
          iter++;
          for (let i = 1; i < n - 2; i++) {
            for (let k = i + 1; k < n - 1; k++) {
              const a = order[i - 1];
              const b = order[i];
              const c = order[k];
              const d = order[k + 1];
              const current = dist[a][b] + dist[c][d];
              const swapped = dist[a][c] + dist[b][d];
              if (swapped + 1e-12 < current) {
                // reverse segment [i, k]
                const newSegment = order.slice(i, k + 1).reverse();
                for (let t = 0; t < newSegment.length; t++) {
                  order[i + t] = newSegment[t];
                }
                improved = true;
              }
            }
          }
        }
        return order;
      }

      // Held–Karp dynamic programming for exact TSP, start at 0
      function tspHeldKarp(dist) {
        const n = dist.length;
        const N = 1 << n;
        const INF = 1e300;
        const dp = Array.from({ length: N }, () => new Array(n).fill(INF));
        const parent = Array.from({ length: N }, () => new Array(n).fill(-1));

        dp[1][0] = 0; // start at city 0 with mask 000...001

        for (let mask = 1; mask < N; mask++) {
          if (!(mask & 1)) continue; // ensure start city included
          for (let j = 0; j < n; j++) {
            if (!(mask & (1 << j))) continue;
            if (j === 0 && mask !== 1) continue; // starting city only as base
            const prevMask = mask ^ (1 << j);
            if (prevMask === 0 && j === 0) continue;
            if (prevMask === 0) continue;
            let bestVal = dp[mask][j];
            let bestPrev = -1;
            for (let i = 0; i < n; i++) {
              if (!(prevMask & (1 << i))) continue;
              const cand = dp[prevMask][i] + dist[i][j];
              if (cand < bestVal) {
                bestVal = cand;
                bestPrev = i;
              }
            }
            dp[mask][j] = bestVal;
            parent[mask][j] = bestPrev;
          }
        }

        let bestCost = INF;
        let bestLast = -1;
        const fullMask = N - 1;
        for (let j = 1; j < n; j++) {
          const cand = dp[fullMask][j] + dist[j][0];
          if (cand < bestCost) {
            bestCost = cand;
            bestLast = j;
          }
        }

        if (!Number.isFinite(bestCost) || bestLast === -1) {
          return null;
        }

        // Reconstruct path
        const order = [];
        let mask = fullMask;
        let curr = bestLast;
        while (curr !== -1) {
          order.push(curr);
          const prev = parent[mask][curr];
          mask = mask ^ (1 << curr);
          curr = prev;
        }
        order.push(0); // start
        order.reverse();
        if (order[0] !== 0) {
          // rotate to start at 0
          const idx = order.indexOf(0);
          const rotated = order.slice(idx).concat(order.slice(1, idx + 1));
          return rotated;
        }
        return order;
      }

      // ---------- UI setup ----------
      (function () {
        const modeButtons = document.querySelectorAll('.tsp-mode-btn');
        const coordsSection = document.getElementById('tsp-coords-section');
        const matrixSection = document.getElementById('tsp-matrix-section');

        function setMode(mode) {
          modeButtons.forEach(btn => {
            const m = btn.getAttribute('data-tsp-mode');
            const active = m === mode;
            btn.classList.toggle('bg-blue-600', active);
            btn.classList.toggle('text-white', active);
            btn.classList.toggle('border-blue-600', active);
            btn.classList.toggle('bg-white', !active);
            btn.classList.toggle('text-gray-700', !active);
            btn.classList.toggle('border-gray-300', !active);
          });
          if (mode === 'coords') {
            coordsSection.classList.remove('hidden');
            matrixSection.classList.add('hidden');
          } else {
            coordsSection.classList.add('hidden');
            matrixSection.classList.remove('hidden');
          }
          document.getElementById('tsp-error').classList.add('hidden');
          document.getElementById('tsp-result-section').classList.add('hidden');
        }

        modeButtons.forEach(btn => {
          btn.addEventListener('click', () => setMode(btn.getAttribute('data-tsp-mode')));
        });
        setMode('coords'); // default

        // Build tables
        const coordsTable = document.getElementById('tsp-coords-table');
        const matrixTable = document.getElementById('tsp-matrix-table');

        function buildCoordsTable() {
          let n = Number(document.getElementById('tsp-n-coords').value) || 5;
          n = Math.max(3, Math.min(20, n));
          document.getElementById('tsp-n-coords').value = n;

          let html = '<thead><tr><th>City</th><th>X</th><th>Y</th></tr></thead><tbody>';
          for (let i = 0; i < n; i++) {
            const label = tspLetterLabel(i);
            html += '<tr>';
            html += '<td class="text-left">' + label + '</td>';
            html += '<td><input type="text" class="w-24 border border-gray-300 rounded-md px-1 py-0.5 text-xs" /></td>';
            html += '<td><input type="text" class="w-24 border border-gray-300 rounded-md px-1 py-0.5 text-xs" /></td>';
            html += '</tr>';
          }
          html += '</tbody>';
          coordsTable.innerHTML = html;
        }

        function buildMatrixTable() {
          let n = Number(document.getElementById('tsp-n-matrix').value) || 5;
          n = Math.max(3, Math.min(20, n));
          document.getElementById('tsp-n-matrix').value = n;

          let html = '<thead><tr><th></th>';
          for (let j = 0; j < n; j++) {
            html += '<th>' + tspLetterLabel(j) + '</th>';
          }
          html += '</tr></thead><tbody>';
          for (let i = 0; i < n; i++) {
            html += '<tr><td class="text-left">' + tspLetterLabel(i) + '</td>';
            for (let j = 0; j < n; j++) {
              if (i === j) {
                html += '<td class="bg-gray-50 text-gray-400 text-center">–</td>';
              } else {
                html += '<td><input type="text" class="w-20 border border-gray-300 rounded-md px-1 py-0.5 text-xs" /></td>';
              }
            }
            html += '</tr>';
          }
          html += '</tbody>';
          matrixTable.innerHTML = html;
        }

        document.getElementById('tsp-build-coords').addEventListener('click', buildCoordsTable);
        document.getElementById('tsp-build-matrix').addEventListener('click', buildMatrixTable);

        // Load simple examples
        document.getElementById('tsp-example-coords').addEventListener('click', function () {
          const example = [
            [0, 0],
            [2, 1],
            [4, 0],
            [3, 3],
            [1, 3]
          ];
          const n = example.length;
          document.getElementById('tsp-n-coords').value = n;
          buildCoordsTable();
          const rows = coordsTable.querySelectorAll('tbody tr');
          for (let i = 0; i < n; i++) {
            const cells = rows[i].querySelectorAll('td');
            const xInput = cells[1].querySelector('input');
            const yInput = cells[2].querySelector('input');
            xInput.value = example[i][0];
            yInput.value = example[i][1];
          }
        });

        document.getElementById('tsp-example-matrix').addEventListener('click', function () {
          const example = [
            [0, 10, 15, 20, 10],
            [10, 0, 35, 25, 17],
            [15, 35, 0, 30, 28],
            [20, 25, 30, 0, 22],
            [10, 17, 28, 22, 0]
          ];
          const n = example.length;
          document.getElementById('tsp-n-matrix').value = n;
          buildMatrixTable();
          const rows = matrixTable.querySelectorAll('tbody tr');
          for (let i = 0; i < n; i++) {
            const cells = rows[i].querySelectorAll('td');
            for (let j = 0; j < n; j++) {
              if (i === j) continue;
              const input = cells[j+1].querySelector('input');
              input.value = example[i][j];
            }
          }
        });

        // Initialize tables on load
        buildCoordsTable();
        buildMatrixTable();

        // Calculation
        const errorEl = document.getElementById('tsp-error');
        const resultSection = document.getElementById('tsp-result-section');
        const resultSummary = document.getElementById('tsp-result-summary');
        const resultDetail = document.getElementById('tsp-result-detail');
        const tourLengthEl = document.getElementById('tsp-tour-length');
        const tourOrderEl = document.getElementById('tsp-tour-order');
        const tourStartEl = document.getElementById('tsp-tour-start');
        const tourAlgorithmEl = document.getElementById('tsp-tour-algorithm');
        const distBody = document.getElementById('tsp-distance-body');
        const svg = document.getElementById('tsp-svg');

        function getMode() {
          const active = document.querySelector('.tsp-mode-btn.bg-blue-600');
          return active ? active.getAttribute('data-tsp-mode') : 'coords';
        }

        function clearSVG() {
          while (svg.firstChild) svg.removeChild(svg.firstChild);
        }

        function drawTour(order, coords, decimals) {
          clearSVG();
          if (!coords || coords.length === 0 || !order || order.length < 2) return;

          const n = coords.length;
          let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
          for (let i = 0; i < n; i++) {
            const [x, y] = coords[i];
            if (x < minX) minX = x;
            if (x > maxX) maxX = x;
            if (y < minY) minY = y;
            if (y > maxY) maxY = y;
          }
          if (!Number.isFinite(minX) || !Number.isFinite(maxX)) return;
          const padding = 30;
          const width = 400;
          const height = 300;
          const spanX = maxX - minX || 1;
          const spanY = maxY - minY || 1;
          const scaleX = (width - 2 * padding) / spanX;
          const scaleY = (height - 2 * padding) / spanY;

          function mapPoint(x, y) {
            const sx = padding + (x - minX) * scaleX;
            const sy = height - padding - (y - minY) * scaleY; // invert Y
            return [sx, sy];
          }

          // Draw edges
          for (let i = 0; i < order.length - 1; i++) {
            const a = coords[order[i]];
            const b = coords[order[i+1]];
            const [x1, y1] = mapPoint(a[0], a[1]);
            const [x2, y2] = mapPoint(b[0], b[1]);
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', '#3b82f6');
            line.setAttribute('stroke-width', '2');
            line.setAttribute('stroke-linecap', 'round');
            svg.appendChild(line);
          }

          // Draw cities
          for (let i = 0; i < n; i++) {
            const [x, y] = coords[i];
            const [sx, sy] = mapPoint(x, y);
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', sx);
            circle.setAttribute('cy', sy);
            circle.setAttribute('r', i === 0 ? 6 : 5);
            circle.setAttribute('fill', i === 0 ? '#ef4444' : '#111827');
            svg.appendChild(circle);

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', sx + 8);
            text.setAttribute('y', sy - 8);
            text.setAttribute('font-size', '11');
            text.setAttribute('fill', '#111827');
            text.textContent = tspLetterLabel(i);
            svg.appendChild(text);
          }
        }

        document.getElementById('tsp-calc-btn').addEventListener('click', function () {
          errorEl.classList.add('hidden');
          errorEl.textContent = '';
          resultSection.classList.add('hidden');
          distBody.innerHTML = '';
          clearSVG();

          const decimals = Math.max(0, Math.min(6, Number(document.getElementById('tsp-decimals').value) || 3));
          document.getElementById('tsp-decimals').value = decimals;
          const algorithm = document.getElementById('tsp-algorithm').value;
          const mode = getMode();

          try {
            let dist = [];
            let coords = null;
            let n;

            if (mode === 'coords') {
              n = Number(document.getElementById('tsp-n-coords').value) || 5;
              n = Math.max(3, Math.min(20, n));
              document.getElementById('tsp-n-coords').value = n;

              const rows = coordsTable.querySelectorAll('tbody tr');
              if (rows.length !== n) {
                throw new Error('Please rebuild the coordinates table after changing n.');
              }

              coords = [];
              for (let i = 0; i < n; i++) {
                const cells = rows[i].querySelectorAll('td');
                const xInput = cells[1].querySelector('input');
                const yInput = cells[2].querySelector('input');
                const xVal = tspParseNumber(xInput.value);
                const yVal = tspParseNumber(yInput.value);
                if (xVal === null || yVal === null) {
                  throw new Error('All coordinate cells must contain numeric values in Coordinates mode.');
                }
                coords.push([xVal, yVal]);
              }

              // build symmetric Euclidean distance matrix
              dist = Array.from({ length: n }, () => new Array(n).fill(0));
              for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                  if (i === j) {
                    dist[i][j] = 0;
                  } else {
                    const dx = coords[i][0] - coords[j][0];
                    const dy = coords[i][1] - coords[j][1];
                    dist[i][j] = Math.hypot(dx, dy);
                  }
                }
              }

            } else {
              n = Number(document.getElementById('tsp-n-matrix').value) || 5;
              n = Math.max(3, Math.min(20, n));
              document.getElementById('tsp-n-matrix').value = n;

              const rows = matrixTable.querySelectorAll('tbody tr');
              if (rows.length !== n) {
                throw new Error('Please rebuild the distance matrix after changing n.');
              }

              dist = Array.from({ length: n }, () => new Array(n).fill(0));
              for (let i = 0; i < n; i++) {
                const cells = rows[i].querySelectorAll('td');
                for (let j = 0; j < n; j++) {
                  if (i === j) {
                    dist[i][j] = 0;
                  } else {
                    const input = cells[j + 1].querySelector('input');
                    const v = tspParseNumber(input.value);
                    if (v === null || v < 0) {
                      throw new Error('All off-diagonal distances must be non-negative numeric values in Matrix mode.');
                    }
                    dist[i][j] = v;
                  }
                }
              }
            }

            if (algorithm === 'exact' && n > 12) {
              throw new Error('Exact Held–Karp solver is limited to n ≤ 12. Please reduce the number of cities or use the heuristic algorithm.');
            }

            let order;
            let isExact = false;
            if (algorithm === 'exact') {
              const tour = tspHeldKarp(dist);
              if (!tour) {
                throw new Error('Unable to find a valid tour with the exact solver.');
              }
              order = tour;
              isExact = true;
            } else {
              let tour = tspNearestNeighbor(dist);
              tour = tspTwoOpt(tour, dist, 1000);
              order = tour;
            }

            // Compute length and distance breakdown
            const labels = [];
            for (let i = 0; i < n; i++) labels.push(tspLetterLabel(i));
            const length = tspTourLength(order, dist);
            const lengthDisp = length.toFixed(decimals);

            const orderLabels = order.map(idx => labels[idx]).join(' → ');
            resultSummary.innerHTML =
              'Computed a tour through <strong>' + n + '</strong> cities with total length ' +
              '<strong>' + lengthDisp + '</strong>.';
            resultDetail.textContent =
              'The tour starts and ends at city A. For symmetric TSPs, any cyclic rotation of the visiting order represents the same tour length.';

            tourLengthEl.innerHTML = '<strong>Total tour length</strong> = ' + lengthDisp;
            tourOrderEl.innerHTML = '<strong>Visiting order</strong> = ' + orderLabels;
            tourStartEl.innerHTML = '<strong>Start / end city</strong> = A';
            tourAlgorithmEl.innerHTML = '<strong>Algorithm</strong> = ' + (isExact ? 'Exact Held–Karp (optimal)' : 'Nearest-neighbor + 2-opt heuristic (approximate)');

            // Fill distance table
            distBody.innerHTML = '';
            for (let i = 0; i < order.length - 1; i++) {
              const from = order[i];
              const to = order[i+1];
              const d = dist[from][to];
              const tr = document.createElement('tr');
              const tdStep = document.createElement('td');
              const tdEdge = document.createElement('td');
              const tdDist = document.createElement('td');
              tdStep.textContent = String(i + 1);
              tdStep.className = 'text-left';
              tdEdge.textContent = tspLetterLabel(from) + ' → ' + tspLetterLabel(to);
              tdDist.textContent = d.toFixed(decimals);
              tr.appendChild(tdStep);
              tr.appendChild(tdEdge);
              tr.appendChild(tdDist);
              distBody.appendChild(tr);
            }

            // Draw SVG if coordinates available
            if (coords) {
              drawTour(order, coords, decimals);
            } else {
              clearSVG();
            }

            resultSection.classList.remove('hidden');
          } catch (err) {
            errorEl.textContent = err.message || 'Unable to compute TSP tour. Please check your inputs.';
            errorEl.classList.remove('hidden');
          }
        });

        document.getElementById('tsp-clear-btn').addEventListener('click', function () {
          coordsTable.querySelectorAll('input').forEach(inp => inp.value = '');
          matrixTable.querySelectorAll('input').forEach(inp => inp.value = '');
          errorEl.classList.add('hidden');
          resultSection.classList.add('hidden');
          distBody.innerHTML = '';
          clearSVG();
        });
      })();
    </script>

    <script>
      window.MathJax = {
        tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['$','$'], ['\\[','\\]']] },
        svg: { fontCache: 'global' }
      };
    </script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    


</body></html>