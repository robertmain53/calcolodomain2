<!DOCTYPE html><html lang="en"><head>
<link rel="canonical" href="https://calcdomain.com/car-lease-calculator">





<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Car Lease Calculator – Payment, Money Factor, Residual &amp; Total Cost</title>
<meta name="description" content="Pro car lease calculator: enter MSRP, cap cost, money factor or APR, residual %, fees and taxes to get monthly payment (pre/post tax), due at signing, rent charge, depreciation, and cost-per-mile with an exportable month-by-month breakdown.">

<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="manifest" href="/site.webmanifest">

<!-- Fonts & UI -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- MathJax for LaTeX formulas -->
<script defer="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  :root { --focus: #2563eb; }
  body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', sans-serif; }
  .prose { max-width: 68ch; }
  .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
  .prose h3 { font-size: 1.15rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.5rem; }
  .prose p { line-height: 1.7; margin-bottom: 1rem; }
  .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:10px;padding:1rem;overflow-x:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  /* Visible focus */
  a, button, input, select, summary, details[open] > summary { outline: none; }
  :focus-visible { box-shadow: 0 0 0 3px var(--focus); border-radius: 6px; }
  /* Prevent CLS in results */
  #results-shell{min-height: 18rem}
  /* Touch target min size */
  .touch-target { min-height: 48px; min-width: 48px; }
  /* Table responsiveness */
  .table-wrap{overflow:auto;border:1px solid #e5e7eb;border-radius:10px}
  th,td{ white-space:nowrap }
  @media print{
    body *{ visibility:hidden }
    #print-section, #print-section *{ visibility:visible }
    #print-section{ position:absolute; inset:0; }
    #chartWrap{ display:none !important }
  }
</style>

<!-- WebPage / E-E-A-T -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Car Lease Calculator",
  "url": "https://calcdomain.com/car-lease-calculator",
  "inLanguage": "en",
  "description": "Professional car lease calculator with residuals, money factor, taxes, fees, and cost analysis.",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "dateModified": "2025-10-30"
}
</script>

<!-- Breadcrumbs -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Finance",
      "item": "https://calcdomain.com/categories/finance"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Loans Debt",
      "item": "https://calcdomain.com/subcategories/loans-debt"
    }
  ]
}
</script>

<!-- HowTo -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to calculate a car lease payment",
  "description": "Steps to compute a lease payment using cap cost, residual, and money factor.",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Enter vehicle pricing",
      "text": "Input MSRP and negotiated price (cap cost). Add down payment, trade-in credits, rebates, and acquisition/doc fees."
    },
    {
      "@type": "HowToStep",
      "name": "Set residual and term",
      "text": "Choose residual percent or value and the lease term in months."
    },
    {
      "@type": "HowToStep",
      "name": "Set rate",
      "text": "Enter the money factor or convert from APR."
    },
    {
      "@type": "HowToStep",
      "name": "Add taxes",
      "text": "Choose tax treatment and enter a tax rate if applicable."
    },
    {
      "@type": "HowToStep",
      "name": "Review results",
      "text": "See monthly payment (pre/post tax), depreciation fee, rent charge, due at signing, total cost and cost per mile."
    }
  ]
}
</script>

<!-- FAQPage -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What is a money factor?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "It is the lease finance rate. Multiply the money factor by 2400 to approximate an APR. The rent charge each month equals (Adjusted Cap Cost + Residual Value) × Money Factor."
      }
    },
    {
      "@type": "Question",
      "name": "How is depreciation calculated in a lease?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Depreciation fee equals (Adjusted Cap Cost − Residual Value) ÷ Term (months)."
      }
    },
    {
      "@type": "Question",
      "name": "Does tax apply to each lease payment?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "In many regions, sales tax applies to each monthly payment; other regions assess tax upfront on cap cost. Use the tax treatment toggle to model your case."
      }
    },
    {
      "@type": "Question",
      "name": "Is APR the same as money factor?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "They represent the finance cost differently. APR ≈ Money Factor × 2400. Use the converter built into the calculator."
      }
    },
    {
      "@type": "Question",
      "name": "What is due at signing?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Typically the first payment, acquisition and doc fees, DMV/title, plus any cash due (down payment) minus rebates and trade-in credits."
      }
    },
    {
      "@type": "Question",
      "name": "How do mileage limits affect a lease?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Higher allowed mileage generally reduces residual values, raising depreciation and the payment. Over-mileage after turn-in is charged per mile."
      }
    },
    {
      "@type": "Question",
      "name": "Can I compare leasing vs. buying?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes. Compare total out-of-pocket over the term, expected equity when buying, and your usage needs. This tool shows the lease side; see our loan amortization tool for buying."
      }
    }
  ]
}
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky for mobile viewport space) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="https://calcdomain.com" class="text-2xl font-bold text-blue-700">CalcDomain</a>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a href="https://calcdomain.com/search" class="hover:text-blue-700">Advanced Search</a>
        Categories
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3" id="print-section" aria-labelledby="page-title">
        <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> &raquo; <a href="https://calcdomain.com/categories/finance" class="hover:text-blue-600">Finance</a> &raquo; <a href="https://calcdomain.com/subcategories/loans-debt" class="hover:text-blue-600">Loans Debt</a></nav>

        <h1 id="page-title" class="text-3xl font-extrabold mb-2">car lease calculator</h1>
        <p class="text-gray-700 mb-6">
          A professional-grade car lease calculator for shoppers, finance pros, and advisors. Enter MSRP, negotiated price, money factor/APR, residual, fees, and taxes to get a transparent monthly payment, due-at-signing, and a month-by-month breakdown with depreciation vs. finance (rent charge).
        </p>

        <!-- Calculator -->
        <section class="bg-white p-6 rounded-xl shadow-md" aria-labelledby="calc-title">
          <h2 id="calc-title" class="text-xl font-bold mb-4">Lease Inputs</h2>

          <!-- Currency & locale -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
            <div>
              <label for="currency" class="block text-sm font-medium text-gray-800">Currency *</label>
              <select id="currency" class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 touch-target" aria-required="true">
                <option value="USD" selected="">USD – $</option>
                <option value="EUR">EUR – €</option>
                <option value="GBP">GBP – £</option>
                <option value="AUD">AUD – $</option>
                <option value="CAD">CAD – $</option>
              </select>
            </div>
            <div>
              <label for="regionTax" class="block text-sm font-medium text-gray-800">Tax treatment *</label>
              <div class="flex gap-2 items-center">
                <select id="regionTax" class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 touch-target" aria-required="true" aria-describedby="regionTaxTip">
                  <option value="payment" selected="">Tax on each monthly payment</option>
                  <option value="upfront">Upfront tax on cap cost</option>
                  <option value="none">No tax</option>
                </select>
                <button id="regionTaxHelp" class="ml-1 px-2 py-1 border rounded touch-target" aria-expanded="false" aria-controls="regionTaxTip">?</button>
              </div>
              <p id="regionTaxTip" class="text-sm text-gray-600 mt-1 hidden">
                Select how your jurisdiction applies sales/VAT to leases. This impacts where tax is added (monthly vs. upfront).
              </p>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
            <!-- Vehicle pricing -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="font-semibold text-gray-800 px-1">Vehicle Pricing</legend>

              <label for="msrp" class="block text-sm font-medium text-gray-800 mt-2">MSRP *</label>
              <input id="msrp" type="number" inputmode="decimal" min="0" step="100" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-required="true" aria-describedby="msrpErr msrpTip">
              <div class="flex items-center gap-2 mt-1">
                <button id="msrpHelp" class="px-2 py-1 border rounded touch-target" aria-expanded="false" aria-controls="msrpTip">?</button>
                <span id="msrpTip" class="text-sm text-gray-600 hidden">Manufacturer’s Suggested Retail Price; used to compute residual if given as a % of MSRP.</span>
              </div>
              <p id="msrpErr" class="text-red-600 text-sm mt-1 hidden"></p>

              <label for="capCost" class="block text-sm font-medium text-gray-800 mt-4">Negotiated Price (Cap Cost) *</label>
              <input id="capCost" type="number" inputmode="decimal" min="0" step="100" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-required="true" aria-describedby="capErr capTip">
              <div class="flex items-center gap-2 mt-1">
                <button id="capHelp" class="px-2 py-1 border rounded touch-target" aria-expanded="false" aria-controls="capTip">?</button>
                <span id="capTip" class="text-sm text-gray-600 hidden">The price you and the dealer agree on before down payment, rebates, and fees.</span>
              </div>
              <p id="capErr" class="text-red-600 text-sm mt-1 hidden"></p>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div>
                  <label for="down" class="block text-sm font-medium text-gray-800">Cash Due (Down Payment)</label>
                  <input id="down" type="number" inputmode="decimal" min="0" step="50" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-describedby="downErr">
                  <p id="downErr" class="text-red-600 text-sm mt-1 hidden"></p>
                </div>
                <div>
                  <label for="rebates" class="block text-sm font-medium text-gray-800">Rebates / Incentives</label>
                  <input id="rebates" type="number" inputmode="decimal" min="0" step="50" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
                </div>
                <div>
                  <label for="trade" class="block text-sm font-medium text-gray-800">Trade-in Credit</label>
                  <input id="trade" type="number" inputmode="decimal" min="0" step="50" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
                </div>
                <div>
                  <label for="acqFee" class="block text-sm font-medium text-gray-800">Acquisition Fee</label>
                  <input id="acqFee" type="number" inputmode="decimal" min="0" step="25" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
                </div>
                <div>
                  <label for="docDmv" class="block text-sm font-medium text-gray-800">Doc/DMV/Title Fees</label>
                  <input id="docDmv" type="number" inputmode="decimal" min="0" step="25" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
                </div>
              </div>
            </fieldset>

            <!-- Rate & residual -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="font-semibold text-gray-800 px-1">Rate &amp; Residual</legend>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label for="term" class="block text-sm font-medium text-gray-800">Term (months) *</label>
                  <input id="term" type="number" inputmode="numeric" min="12" max="72" step="1" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-required="true" aria-describedby="termErr">
                  <p id="termErr" class="text-red-600 text-sm mt-1 hidden"></p>
                </div>
                <div>
                  <label for="miles" class="block text-sm font-medium text-gray-800">Miles per year</label>
                  <input id="miles" type="number" inputmode="numeric" min="5000" max="30000" step="500" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div>
                  <label for="mf" class="block text-sm font-medium text-gray-800">Money Factor *</label>
                  <input id="mf" type="number" inputmode="decimal" min="0" step="0.00001" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-required="true" aria-describedby="mfErr mfTip">
                  <div class="flex items-center gap-2 mt-1">
                    <button id="mfHelp" class="px-2 py-1 border rounded touch-target" aria-expanded="false" aria-controls="mfTip">?</button>
                    <span id="mfTip" class="text-sm text-gray-600 hidden">APR ≈ Money Factor × 2400. Example: MF 0.0025 ≈ 6% APR.</span>
                  </div>
                  <p id="mfErr" class="text-red-600 text-sm mt-1 hidden"></p>
                </div>
                <div>
                  <label for="apr" class="block text-sm font-medium text-gray-800">…or APR (%)</label>
                  <input id="apr" type="number" inputmode="decimal" min="0" step="0.01" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-describedby="aprTip">
                  <p id="aprTip" class="text-sm text-gray-600 mt-1">If you enter APR, the calculator converts it to MF as APR/2400.</p>
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div>
                  <label for="residualPct" class="block text-sm font-medium text-gray-800">Residual (% of MSRP) *</label>
                  <input id="residualPct" type="number" inputmode="decimal" min="20" max="90" step="0.1" class="mt-1 w-full border rounded-md px-3 py-2 touch-target" aria-required="true" aria-describedby="residErr residTip">
                  <div class="flex items-center gap-2 mt-1">
                    <button id="residHelp" class="px-2 py-1 border rounded touch-target" aria-expanded="false" aria-controls="residTip">?</button>
                    <span id="residTip" class="text-sm text-gray-600 hidden">Residual value is typically a % of MSRP set by the lessor (e.g., 58% for 36 mo/12k mi).</span>
                  </div>
                  <p id="residErr" class="text-red-600 text-sm mt-1 hidden"></p>
                </div>
                <div>
                  <label for="residualOverride" class="block text-sm font-medium text-gray-800">…or Residual Value (absolute)</label>
                  <input id="residualOverride" type="number" inputmode="decimal" min="0" step="100" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
                </div>
              </div>
            </fieldset>

            <!-- Taxes -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="font-semibold text-gray-800 px-1">Taxes</legend>
              <label for="taxRate" class="block text-sm font-medium text-gray-800 mt-2">Sales Tax / VAT (%)</label>
              <input id="taxRate" type="number" inputmode="decimal" min="0" step="0.01" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
              <p id="taxErr" class="text-red-600 text-sm mt-1 hidden"></p>
            </fieldset>

            <!-- Start date -->
            <fieldset class="border border-gray-200 rounded-lg p-4">
              <legend class="font-semibold text-gray-800 px-1">Schedule &amp; Start</legend>
              <label for="startMonth" class="block text-sm font-medium text-gray-800 mt-2">First Payment Month</label>
              <input id="startMonth" type="month" class="mt-1 w-full border rounded-md px-3 py-2 touch-target">
              <p class="text-xs text-gray-600 mt-1">Used to label the month-by-month table; does not change amounts.</p>
            </fieldset>
          </div>

          <div class="mt-6 flex flex-wrap gap-3">
            <button id="calcBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded-lg touch-target">Calculate</button>
            <button id="resetBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-900 font-semibold px-5 py-2 rounded-lg touch-target">Reset</button>
            <button id="printBtn" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-900 font-semibold px-5 py-2 rounded-lg touch-target">Print</button>
            <button id="copyLinkBtn" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-900 font-semibold px-5 py-2 rounded-lg touch-target">Copy shareable link</button>
          </div>
        </section>

        <!-- Results -->
        <section id="results-shell" class="mt-8 bg-blue-50 border border-blue-100 rounded-xl p-6">
          <h2 class="text-xl font-bold mb-4">Results</h2>
          <div class="flex flex-col lg:flex-row gap-6">
            <div class="w-full lg:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Monthly Payment (pre-tax)</h3>
                <p id="pmtPreTax" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Tax per Month</h3>
                <p id="taxPerMo" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Monthly Payment (with tax)</h3>
                <p id="pmtWithTax" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Due at Signing</h3>
                <p id="dueSigning" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Total Depreciation</h3>
                <p id="depTotal" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Total Rent Charge</h3>
                <p id="rentTotal" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Total Out-of-Pocket</h3>
                <p id="oopTotal" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
              <div class="bg-white border rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600">Effective Cost per Mile</h3>
                <p id="costPerMile" class="text-2xl font-extrabold text-blue-700">$0.00</p>
              </div>
            </div>

            <div id="chartWrap" class="w-full lg:w-1/3 h-48">
              <canvas id="breakdownChart" aria-label="Lease cost composition chart"></canvas>
            </div>
          </div>

          <details class="mt-6 bg-white rounded-lg p-4">
            <summary class="font-semibold">View Month-by-Month Breakdown</summary>
            <div class="table-wrap mt-4">
              <table class="min-w-full text-sm text-right">
                <thead class="bg-gray-100 text-gray-700 uppercase">
                  <tr>
                    <th class="px-4 py-2 text-left">#</th>
                    <th class="px-4 py-2 text-left">Month</th>
                    <th class="px-4 py-2">Payment</th>
                    <th class="px-4 py-2">Depreciation</th>
                    <th class="px-4 py-2">Rent Charge</th>
                    <th class="px-4 py-2">Tax</th>
                    <th class="px-4 py-2">Running Total</th>
                  </tr>
                </thead>
                <tbody id="scheduleBody"></tbody>
              </table>
            </div>
          </details>
        </section>

        <!-- Authoritative ecosystem -->
        <article class="bg-white p-6 rounded-xl shadow-md mt-8 prose">
          <h2>Authoritative Data Source &amp; Methodology</h2>
          <p><strong>Primary reference:</strong> <a class="text-blue-700 underline" href="https://www.consumerfinance.gov/rules-policy/regulations/1013/" rel="nofollow">CFPB Regulation M — Consumer Leasing (12 CFR Part 1013)</a>. Effective dates vary by section; methodology last reviewed Oct 30, 2025. <em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>
          <p>We implement the canonical lease math used across the industry: monthly payment equals the sum of a depreciation fee and a finance (rent) charge, with taxes applied per local rules.</p>

          <h2>The Formula Explained</h2>
          <div class="formula-box">
            \[
              \text{AdjCap} = \text{CapCost} - \text{Down} - \text{Rebates} - \text{TradeIn} + \text{AcqFee} + \text{Doc/DMV}
            \]<br>
            \[
              \text{Residual} =
              \begin{cases}
                \text{ResidualOverride} &amp; \text{if provided}\\
                \text{MSRP} \times \dfrac{\text{Residual\%}}{100} &amp; \text{otherwise}
              \end{cases}
            \]<br>
            \[
              \text{DepreciationFee} = \dfrac{\text{AdjCap} - \text{Residual}}{\text{TermMonths}}
            \]\[
              \text{RentCharge} = (\text{AdjCap} + \text{Residual}) \times \text{MoneyFactor}
            \]\[
              \text{PaymentPreTax} = \text{DepreciationFee} + \text{RentCharge}
            \]
            Tax treatment:<br>
            \[
              \text{TaxPerMonth} =
              \begin{cases}
                \text{PaymentPreTax} \times \text{TaxRate} &amp; \text{(tax on payment)}\\
                0 &amp; \text{(upfront/no tax)}
              \end{cases}
            \]
            \[
              \text{PaymentWithTax} = \text{PaymentPreTax} + \text{TaxPerMonth}
            \]
            Upfront tax (if applicable): \(\text{UpfrontTax} = \text{AdjCap} \times \text{TaxRate}\).<br>
            APR conversion: \(\text{APR} \approx \text{MoneyFactor} \times 2400 \Rightarrow \text{MF} \approx \dfrac{\text{APR}}{2400}\).
          </div>

          <h2>Glossary of Variables</h2>
          <ul>
            <li><strong>MSRP</strong>: List price used to compute residuals.</li>
            <li><strong>Cap Cost</strong>: Negotiated selling price before incentives and fees.</li>
            <li><strong>Adjusted Cap (AdjCap)</strong>: Cap cost after down/trade/rebates and plus fees.</li>
            <li><strong>Residual</strong>: Expected value at lease end (often % of MSRP).</li>
            <li><strong>Money Factor (MF)</strong>: Finance rate for leases; APR ≈ MF × 2400.</li>
            <li><strong>Depreciation Fee</strong>: (AdjCap − Residual) / months.</li>
            <li><strong>Rent Charge</strong>: (AdjCap + Residual) × MF.</li>
            <li><strong>Tax Treatment</strong>: Whether tax is charged monthly or upfront.</li>
          </ul>

          <h2>How It Works: A Step-by-Step Example</h2>
          <p>Suppose MSRP = $40,000, Cap Cost = $36,000, Down = $2,000, Rebates = $500, Trade-in = $0, Acq Fee = $895, Doc/DMV = $400, Term = 36 months, Residual = 58%, MF = 0.0020, tax on payment at 7.5%.</p>
          <ol>
            <li>AdjCap = 36,000 − 2,000 − 500 − 0 + 895 + 400 = 34,795.</li>
            <li>Residual = 40,000 × 0.58 = 23,200.</li>
            <li>DepreciationFee = (34,795 − 23,200) / 36 = 321.53.</li>
            <li>RentCharge = (34,795 + 23,200) × 0.0020 = 115.99.</li>
            <li>PaymentPreTax = 321.53 + 115.99 = 437.52.</li>
            <li>TaxPerMonth = 437.52 × 0.075 = 32.81.</li>
            <li>PaymentWithTax ≈ 470.33. Due at signing ≈ first payment + fees + down − rebates − trade-in.</li>
          </ol>

          <h2>FAQ</h2>
          <details>
            <summary>Is a higher down payment always better?</summary>
            <p>It reduces the adjusted cap and monthly payment but increases cash at risk if the car is totaled early. Many prefer minimal down and higher payments.</p>
          </details>
          <details>
            <summary>What affects residuals the most?</summary>
            <p>Term and mileage. Longer terms and higher annual mileage reduce residual percentages.</p>
          </details>
          <details>
            <summary>Do acquisition/doc fees roll into the payment?</summary>
            <p>They can either be paid upfront or capitalized into the adjusted cap. Toggle by entering them here; they are added to AdjCap by default.</p>
          </details>
          <details>
            <summary>What if my region taxes upfront?</summary>
            <p>Choose “Upfront tax on cap cost” to move sales tax from the monthly payment to due-at-signing.</p>
          </details>
          <details>
            <summary>Can I use APR instead of money factor?</summary>
            <p>Yes—enter APR and we convert it to MF using APR/2400.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content reviewed by the CalcDomain Editorial Board.<br>
            Last accuracy review: <time datetime="2025-10-30">October 30, 2025</time></p>
          </div>
        
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{AdjCap} = \text{CapCost} - \text{Down} - \text{Rebates} - \text{TradeIn} + \text{AcqFee} + \text{Doc/DMV}\]</div>
  <pre class="auditspine-mono">\text{AdjCap} = \text{CapCost} - \text{Down} - \text{Rebates} - \text{TradeIn} + \text{AcqFee} + \text{Doc/DMV}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{Residual} = \begin{cases} \text{ResidualOverride} &amp; \text{if provided}\\ \text{MSRP} \times \dfrac{\text{Residual\%}}{100} &amp; \text{otherwise} \end{cases}\]</div>
  <pre class="auditspine-mono">\text{Residual} = \begin{cases} \text{ResidualOverride} &amp; \text{if provided}\\ \text{MSRP} \times \dfrac{\text{Residual\%}}{100} &amp; \text{otherwise} \end{cases}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{DepreciationFee} = \dfrac{\text{AdjCap} - \text{Residual}}{\text{TermMonths}}\]</div>
  <pre class="auditspine-mono">\text{DepreciationFee} = \dfrac{\text{AdjCap} - \text{Residual}}{\text{TermMonths}}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{RentCharge} = (\text{AdjCap} + \text{Residual}) \times \text{MoneyFactor}\]</div>
  <pre class="auditspine-mono">\text{RentCharge} = (\text{AdjCap} + \text{Residual}) \times \text{MoneyFactor}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{PaymentPreTax} = \text{DepreciationFee} + \text{RentCharge}\]</div>
  <pre class="auditspine-mono">\text{PaymentPreTax} = \text{DepreciationFee} + \text{RentCharge}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[\text{TaxPerMonth} = \begin{cases} \text{PaymentPreTax} \times \text{TaxRate} &amp; \text{(tax on payment)}\\ 0 &amp; \text{(upfront/no tax)} \end{cases}\]</div>
  <pre class="auditspine-mono">\text{TaxPerMonth} = \begin{cases} \text{PaymentPreTax} \times \text{TaxRate} &amp; \text{(tax on payment)}\\ 0 &amp; \text{(upfront/no tax)} \end{cases}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">\[ \text{AdjCap} = \text{CapCost} - \text{Down} - \text{Rebates} - \text{TradeIn} + \text{AcqFee} + \text{Doc/DMV} \] \[ \text{Residual} = \begin{cases} \text{ResidualOverride} &amp; \text{if provided}\\ \text{MSRP} \times \dfrac{\text{Residual\%}}{100} &amp; \text{otherwise} \end{cases} \] \[ \text{DepreciationFee} = \dfrac{\text{AdjCap} - \text{Residual}}{\text{TermMonths}} \]\[ \text{RentCharge} = (\text{AdjCap} + \text{Residual}) \times \text{MoneyFactor} \]\[ \text{PaymentPreTax} = \text{DepreciationFee} + \text{RentCharge} \] Tax treatment: \[ \text{TaxPerMonth} = \begin{cases} \text{PaymentPreTax} \times \text{TaxRate} &amp; \text{(tax on payment)}\\ 0 &amp; \text{(upfront/no tax)} \end{cases} \] \[ \text{PaymentWithTax} = \text{PaymentPreTax} + \text{TaxPerMonth} \] Upfront tax (if applicable): \(\text{UpfrontTax} = \text{AdjCap} \times \text{TaxRate}\). APR conversion: \(\text{APR} \approx \text{MoneyFactor} \times 2400 \Rightarrow \text{MF} \approx \dfrac{\text{APR}}{2400}\).</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">P</span> = principal (loan amount) <em>(currency)</em></li>
<li><span class="auditspine-mono">r</span> = periodic interest rate (annual rate ÷ payments per year) <em>(1)</em></li>
<li><span class="auditspine-mono">n</span> = total number of payments (years × payments per year) <em>(count)</em></li>
<li><span class="auditspine-mono">M</span> = periodic payment for principal + interest <em>(currency)</em></li>
<li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>CFPB Regulation M — Consumer Leasing (12 CFR Part 1013)</strong> — consumerfinance.gov · Accessed 2026-01-19<br><a href="https://www.consumerfinance.gov/rules-policy/regulations/1013/" target="_blank" rel="nofollow noopener">https://www.consumerfinance.gov/rules-policy/regulations/1013/</a></li>
<li><strong>Home</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/" target="_blank" rel="nofollow noopener">https://calcdomain.com/</a></li>
<li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>Loans &amp; Debt</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/finance-loans-debt" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/finance-loans-debt</a></li>
<li><strong>Loan Amortization Schedule</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/loan-amortization" target="_blank" rel="nofollow noopener">https://calcdomain.com/loan-amortization</a></li>
<li><strong>APR Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/apr" target="_blank" rel="nofollow noopener">https://calcdomain.com/apr</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-6 space-y-6">
          <div class="bg-white p-6 rounded-xl shadow-md">
            <h3 class="font-bold text-lg mb-3">Why this beats other calculators</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Clear split of depreciation vs. rent charge, plus tax routing.</li>
              <li>Full due-at-signing and cost-per-mile for practical decisions.</li>
              <li>Accessible tooltips, inline validation, and exportable schedule.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md">
            <h3 class="font-bold text-lg mb-3">Related tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-700 hover:underline" href="https://calcdomain.com/loan-amortization">Loan Amortization Schedule</a></li>
              <li><a class="text-blue-700 hover:underline" href="https://calcdomain.com/apr">APR Calculator</a></li>
              <li>Lease vs. Buy Analyzer</li>
            </ul>
          </div>
          <div class="bg-gray-200 h-72 rounded-xl flex items-center justify-center text-gray-600">
            Ad Placement (300×600)
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>© 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="https://calcdomain.com/about" class="hover:text-blue-700">About</a>
        <a href="https://calcdomain.com/contact" class="hover:text-blue-700">Contact</a>
        <a href="https://calcdomain.com/privacy" class="hover:text-blue-700">Privacy</a>
        <a href="https://calcdomain.com/terms" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic -->
  <script defer="">
  (function(){
    const $ = id => document.getElementById(id);

    // Elements
    const el = {
      currency: $('currency'),
      regionTax: $('regionTax'),
      regionTaxHelp: $('regionTaxHelp'),
      regionTaxTip: $('regionTaxTip'),

      msrp: $('msrp'), capCost: $('capCost'), down: $('down'),
      rebates: $('rebates'), trade: $('trade'), acqFee: $('acqFee'),
      docDmv: $('docDmv'),

      term: $('term'), miles: $('miles'),
      mf: $('mf'), apr: $('apr'),
      residualPct: $('residualPct'), residualOverride: $('residualOverride'),

      taxRate: $('taxRate'), startMonth: $('startMonth'),

      // Errors
      msrpErr: $('msrpErr'), capErr: $('capErr'),
      downErr: $('downErr'), termErr: $('termErr'),
      mfErr: $('mfErr'), residErr: $('residErr'), taxErr: $('taxErr'),

      // Buttons
      calcBtn: $('calcBtn'), resetBtn: $('resetBtn'),
      printBtn: $('printBtn'), copyLinkBtn: $('copyLinkBtn'),

      // Results
      pmtPreTax: $('pmtPreTax'), taxPerMo: $('taxPerMo'),
      pmtWithTax: $('pmtWithTax'), dueSigning: $('dueSigning'),
      depTotal: $('depTotal'), rentTotal: $('rentTotal'),
      oopTotal: $('oopTotal'), costPerMile: $('costPerMile'),

      scheduleBody: $('scheduleBody')
    };

    // Accessible tooltip toggles
    function toggleTip(button, tip) {
      const open = button.getAttribute('aria-expanded') === 'true';
      button.setAttribute('aria-expanded', String(!open));
      tip.classList.toggle('hidden', open);
    }
    el.regionTaxHelp.addEventListener('click', ()=>toggleTip(el.regionTaxHelp, el.regionTaxTip));
    $('msrpHelp').addEventListener('click', ()=>toggleTip($('msrpHelp'), $('msrpTip')));
    $('capHelp').addEventListener('click', ()=>toggleTip($('capHelp'), $('capTip')));
    $('mfHelp').addEventListener('click', ()=>toggleTip($('mfHelp'), $('mfTip')));
    $('residHelp').addEventListener('click', ()=>toggleTip($('residHelp'), $('residTip')));

    // Defaults for a good UX
    const today = new Date();
    el.startMonth.value = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}`;
    el.msrp.value = 40000;
    el.capCost.value = 36000;
    el.down.value = 2000;
    el.rebates.value = 500;
    el.trade.value = 0;
    el.acqFee.value = 895;
    el.docDmv.value = 400;
    el.term.value = 36;
    el.miles.value = 12000;
    el.mf.value = 0.0020;
    el.residualPct.value = 58;
    el.taxRate.value = 7.5;

    // Number formatting by currency
    function currencyFormatter(curr){
      try {
        return new Intl.NumberFormat(undefined, { style:'currency', currency: curr || 'USD' });
      } catch {
        return new Intl.NumberFormat(undefined, { style:'currency', currency: 'USD' });
      }
    }
    function pct(n){ return (n||0)/100; }

    // Validation (on blur)
    function showErr(node, errNode, msg){
      if(!msg){ errNode.classList.add('hidden'); errNode.textContent=''; node.removeAttribute('aria-invalid'); return true; }
      errNode.textContent = msg;
      errNode.classList.remove('hidden');
      node.setAttribute('aria-invalid','true');
      return false;
    }
    function requireNonNeg(node, errNode, name){
      const v = parseFloat(node.value);
      if(isNaN(v) || v < 0) return showErr(node, errNode, `${name} must be a number ≥ 0.`);
      return showErr(node, errNode, '');
    }
    function requirePos(node, errNode, name){
      const v = parseFloat(node.value);
      if(isNaN(v) || v <= 0) return showErr(node, errNode, `${name} must be greater than 0.`);
      return showErr(node, errNode, '');
    }
    function inRange(node, errNode, name, min, max){
      const v = parseFloat(node.value);
      if(isNaN(v) || v < min || v > max) return showErr(node, errNode, `${name} must be between ${min} and ${max}.`);
      return showErr(node, errNode, '');
    }

    // Attach blur validators
    el.msrp.addEventListener('blur', ()=>requirePos(el.msrp, el.msrpErr, 'MSRP'));
    el.capCost.addEventListener('blur', ()=>requirePos(el.capCost, el.capErr, 'Cap Cost'));
    el.down.addEventListener('blur', ()=>requireNonNeg(el.down, el.downErr, 'Down Payment'));
    el.term.addEventListener('blur', ()=>inRange(el.term, el.termErr, 'Term', 12, 72));
    el.mf.addEventListener('blur', ()=>requireNonNeg(el.mf, el.mfErr, 'Money Factor'));
    el.residualPct.addEventListener('blur', ()=>inRange(el.residualPct, el.residErr, 'Residual %', 20, 90));
    el.taxRate.addEventListener('blur', ()=>requireNonNeg(el.taxRate, el.taxErr, 'Tax Rate'));

    // Link APR <-> MF
    el.apr.addEventListener('input', ()=>{
      const apr = parseFloat(el.apr.value);
      if(!isNaN(apr)) el.mf.value = (apr/2400).toFixed(5);
    });
    el.mf.addEventListener('input', ()=>{
      const mf = parseFloat(el.mf.value);
      if(!isNaN(mf)) el.apr.value = (mf*2400).toFixed(2);
    });

    // Core calculation
    let chart;
    function calc(){
      // Basic validation gate
      const ok =
        requirePos(el.msrp, el.msrpErr, 'MSRP') &
        requirePos(el.capCost, el.capErr, 'Cap Cost') &
        inRange(el.term, el.termErr, 'Term', 12, 72) &
        requireNonNeg(el.mf, el.mfErr, 'Money Factor') &
        inRange(el.residualPct, el.residErr, 'Residual %', 20, 90) &
        requireNonNeg(el.taxRate, el.taxErr, 'Tax Rate');
      if(!ok) return;

      const fmt = currencyFormatter(el.currency.value);

      const msrp = +el.msrp.value || 0;
      const cap = +el.capCost.value || 0;
      const down = +el.down.value || 0;
      const rebates = +el.rebates.value || 0;
      const trade = +el.trade.value || 0;
      const acq = +el.acqFee.value || 0;
      const doc = +el.docDmv.value || 0;

      const term = Math.round(+el.term.value || 0);
      const mf = +el.mf.value || 0;
      const residPct = +el.residualPct.value || 0;
      const residOverride = +el.residualOverride.value || 0;

      const taxRate = pct(+el.taxRate.value || 0);
      const taxMode = el.regionTax.value;

      const adjCap = Math.max(0, cap - down - rebates - trade + acq + doc);
      const residual = residOverride > 0 ? residOverride : msrp * (residPct/100);

      const depFee = Math.max(0, (adjCap - residual) / term);
      const rentCharge = Math.max(0, (adjCap + residual) * mf);
      const pmtPreTax = depFee + rentCharge;

      const taxPerMonth = (taxMode === 'payment') ? pmtPreTax * taxRate : 0;
      const pmtWithTax = pmtPreTax + taxPerMonth;

      const upfrontTax = (taxMode === 'upfront') ? (adjCap * taxRate) : 0;

      // Due at signing: first payment + fees + cash due − rebates − trade (fees already in AdjCap but still typically paid upfront; we keep both views simple)
      const dueAtSigning = Math.max(0, pmtWithTax + down + acq + doc - rebates - trade + upfrontTax);

      const depTotal = depFee * term;
      const rentTotal = rentCharge * term;
      const taxTotal = (taxPerMonth * term) + upfrontTax;
      const paymentsTotal = pmtPreTax * term + (taxMode==='payment' ? taxPerMonth*term : 0);

      // Out-of-pocket: due at signing + remaining payments (excluding first already included), assuming you pay each monthly bill
      const oopTotal = dueAtSigning + (pmtWithTax * (term - 1));

      // Cost per mile
      const milesPerYear = +el.miles.value || 12000;
      const totalMiles = milesPerYear * (term/12);
      const costPerMile = totalMiles>0 ? oopTotal / totalMiles : 0;

      // Results UI
      el.pmtPreTax.textContent = fmt.format(pmtPreTax);
      el.taxPerMo.textContent = fmt.format(taxPerMonth);
      el.pmtWithTax.textContent = fmt.format(pmtWithTax);
      el.dueSigning.textContent = fmt.format(dueAtSigning);
      el.depTotal.textContent = fmt.format(depTotal);
      el.rentTotal.textContent = fmt.format(rentTotal);
      el.oopTotal.textContent = fmt.format(oopTotal);
      el.costPerMile.textContent = fmt.format(costPerMile);

      // Schedule
      const schedBody = el.scheduleBody;
      schedBody.innerHTML = '';
      let running = 0;
      const start = el.startMonth.value ? new Date(el.startMonth.value + '-01') : new Date();
      for(let i=1;i<=term;i++){
        const date = new Date(start); date.setMonth(start.getMonth() + (i-1));
        const monthLbl = date.toLocaleString(undefined, { month:'short', year:'numeric' });
        running += pmtWithTax;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-2 text-left">${i}</td>
          <td class="px-4 py-2 text-left">${monthLbl}</td>
          <td class="px-4 py-2">${fmt.format(pmtWithTax)}</td>
          <td class="px-4 py-2">${fmt.format(depFee)}</td>
          <td class="px-4 py-2">${fmt.format(rentCharge)}</td>
          <td class="px-4 py-2">${fmt.format(taxPerMonth)}</td>
          <td class="px-4 py-2">${fmt.format(running)}</td>
        `;
        schedBody.appendChild(tr);
      }

      // Chart
      const ctx = document.getElementById('breakdownChart');
      const data = {
        labels: ['Depreciation', 'Rent Charge', 'Taxes', 'Other Upfront'],
        datasets: [{
          data: [depTotal, rentTotal, taxTotal, Math.max(0, dueAtSigning - pmtWithTax)], // isolate first payment from other due
          backgroundColor: ['#1d4ed8','#f59e0b','#10b981','#6b7280']
        }]
      };
      if(chart){ chart.data = data; chart.update(); }
      else {
        chart = new Chart(ctx, {
          type: 'doughnut',
          data,
          options: { plugins:{ legend:{ position:'bottom' } }, responsive:true, maintainAspectRatio:false }
        });
      }

      // Update URL (shareable link)
      const params = new URLSearchParams({
        c: el.currency.value, tx: el.regionTax.value,
        msrp: msrp, cap: cap, dn: down, rb: rebates, tr: trade, aq: acq, dc: doc,
        tm: term, mi: milesPerYear, mf: mf, apr: el.apr.value || '',
        rp: residPct, ro: residOverride || '',
        trt: el.taxRate.value || 0, sm: el.startMonth.value || ''
      });
      history.replaceState(null,'', `${location.pathname}?${params.toString()}`);
    }

    // Populate from URL if present
    (function initFromQuery(){
      const q = new URLSearchParams(location.search);
      const map = {
        c:'currency', tx:'regionTax', msrp:'msrp', cap:'capCost', dn:'down', rb:'rebates', tr:'trade',
        aq:'acqFee', dc:'docDmv', tm:'term', mi:'miles', mf:'mf', apr:'apr',
        rp:'residualPct', ro:'residualOverride', trt:'taxRate', sm:'startMonth'
      };
      Object.entries(map).forEach(([k,id])=>{
        if(q.has(k)) el[id].value = q.get(k);
      });
      // keep APR↔MF coherent
      if(q.has('apr') && !q.has('mf')) el.mf.value = (+el.apr.value||0)/2400;
      if(q.has('mf') && !q.has('apr')) el.apr.value = (+el.mf.value||0)*2400;
    })();

    // Buttons
    el.calcBtn.addEventListener('click', calc);
    el.resetBtn.addEventListener('click', ()=>{
      location.href = location.pathname; // clears query & state
    });
    el.printBtn.addEventListener('click', ()=>window.print());
    el.copyLinkBtn.addEventListener('click', async ()=>{
      try {
        await navigator.clipboard.writeText(location.href);
        el.copyLinkBtn.textContent = 'Link copied!';
        setTimeout(()=>el.copyLinkBtn.textContent='Copy shareable link', 1500);
      } catch {}
    });

    // Recalculate on any input (fast feedback) but keep blur validation too
    document.querySelectorAll('input, select').forEach(node=>{
      node.addEventListener('input', ()=>{ /* lightweight live update */ calc(); });
    });

    // First run
    calc();
  })();
  </script>


</body></html>