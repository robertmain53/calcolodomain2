<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Kruskal–Wallis Test Calculator – Nonparametric One-Way ANOVA</title>
  <meta name="description" content="Kruskal–Wallis test calculator for comparing 2 or more independent groups. Computes H statistic with tie correction, degrees of freedom, p-value (chi-square approximation), group ranks, and step-by-step explanation.">
  <link rel="canonical" href="https://calcdomain.com/kruskal-wallis-test">

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .card-hover { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
    .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    .prose { max-width: 65ch; margin-left: auto; margin-right: auto; }
    .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
    .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
    .prose p { margin-bottom: 1rem; line-height: 1.6; }
    .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    .prose li { margin-bottom: 0.5rem; }
    .formula-box { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 8px; padding: 1rem; overflow-x: auto; margin: 1rem 0; }
    .badge { display:inline-flex; align-items:center; border-radius:9999px; padding:0.25rem 0.75rem; font-size:0.75rem; font-weight:500; }
    .result-box { background:#f9fafb; border-radius:0.5rem; border:1px solid #e5e7eb; padding:0.75rem 1rem; font-size:0.9rem; }
    .result-value { font-weight:600; color:#111827; }
    .error-text { font-size:0.8rem; color:#b91c1c; }
    .hint { font-size:0.75rem; color:#6b7280; }
    .small-code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:0.8rem; }
    .table-scroll { max-height:260px; overflow-y:auto; }
    .pill { display:inline-flex; align-items:center; padding:0.15rem 0.5rem; border-radius:9999px; border:1px solid #e5e7eb; font-size:0.7rem; margin:0.1rem; cursor:pointer; background:white; }
    .pill:hover { background:#eff6ff; border-color:#bfdbfe; }
    .toggle-link { font-size:0.8rem; cursor:pointer; }
  </style>

  <!-- HEAD_SCRIPTS_E_META -->
  <!-- Google tag (gtag.js) -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7MB5V1LZRN');
  </script>

  <meta name="google-site-verification" content="_tiTZ9ivAdtXcAS9CMnTNJ549Sg39WVqP_ZFbWgglNA">

  <script>
    window.ezstandalone = window.ezstandalone || {};
    ezstandalone.cmd = ezstandalone.cmd || [];
  </script>

  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://calcdomain.com"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Math",
          "item": "https://calcdomain.com/categories/math"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "Core Math & Algebra",
          "item": "https://calcdomain.com/subcategories/core-math-algebra"
        }
      ]
    },
    {
      "@type": "HowTo",
      "name": "How to use the Kruskal–Wallis test calculator",
      "description": "Step-by-step instructions to perform a Kruskal–Wallis H test to compare the medians of several independent groups.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Choose the number of groups",
          "text": "Set the number of independent groups you want to compare. The calculator supports from 2 up to 10 groups."
        },
        {
          "@type": "HowToStep",
          "name": "Enter the data for each group",
          "text": "For each group, type the observed values separated by commas, semicolons or spaces. Each row represents an independent sample."
        },
        {
          "@type": "HowToStep",
          "name": "Set the significance level",
          "text": "Choose a significance level alpha, usually 0.05. The calculator uses a chi-square distribution with k minus 1 degrees of freedom to approximate the p-value."
        },
        {
          "@type": "HowToStep",
          "name": "Run the test and interpret the result",
          "text": "Click the Compute test button. The tool reports the Kruskal–Wallis H statistic, the degrees of freedom, the p-value, and a decision to reject or not reject the null hypothesis of equal distributions across groups."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is the Kruskal–Wallis test used for?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The Kruskal–Wallis test is a nonparametric alternative to one-way ANOVA. It is used to compare the distributions, typically medians, of two or more independent groups when the assumptions of normality and homoscedasticity are not met or data are ordinal."
          }
        },
        {
          "@type": "Question",
          "name": "What are the assumptions of the Kruskal–Wallis test?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The Kruskal–Wallis test assumes that observations are independent, the response variable is at least ordinal, and the distributions of the groups have the same shape apart from a possible shift in location. It is robust to outliers and non-normality but still requires independent samples."
          }
        },
        {
          "@type": "Question",
          "name": "How is the Kruskal–Wallis H statistic computed?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "All data are pooled and ranked from lowest to highest, with ties receiving average ranks. The Kruskal–Wallis H statistic is computed from the sum of ranks for each group and the group sizes, and can be corrected for ties. Under the null hypothesis and for sufficiently large samples, H approximately follows a chi-square distribution with k minus 1 degrees of freedom."
          }
        },
        {
          "@type": "Question",
          "name": "Does a significant Kruskal–Wallis test identify which groups differ?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. A significant Kruskal–Wallis test indicates that at least one group differs from the others, but it does not specify which ones. Post-hoc pairwise comparisons with appropriate corrections, such as Dunn's test, are required to identify specific group differences."
          }
        },
        {
          "@type": "Question",
          "name": "Is this calculator a substitute for statistical software?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This calculator is designed for learning, quick checks and exploratory analysis. For complex study designs, multiple testing corrections or regulatory reporting, a full-featured statistical package and the guidance of a statistician are recommended."
          }
        }
      ]
    }
  ]
}
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
.auditspine-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:600;
  border:1px solid #e5e7eb;
  background:#f8fafc;
  color:#0f172a;
}
.auditspine-badge-warn{
  background:#fff7ed;
  border-color:#fed7aa;
  color:#9a3412;
}
</style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- BODY_SCRIPTS_INIZIO -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
      <div class="flex justify-between items-center">
        <a href="https://calcdomain.com" class="text-2xl font-bold text-blue-600">CalcDomain</a>
        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            <input type="search" id="search-input" placeholder="Search for a calculator..." class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>
        <div class="hidden md:flex items-center space-x-6">
          <a href="https://calcdomain.com/search" class="text-gray-700 hover:text-blue-600 transition-colors">Advanced Search</a>
          <a href="https://calcdomain.com/#categories" class="text-gray-700 hover:text-blue-600 transition-colors">Categories</a>
        </div>
        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open menu" type="button">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
      </div>
      <nav id="mobile-menu" class="md:hidden mt-4 hidden" aria-label="Mobile menu" role="navigation">
        <div class="mb-4">
          <div class="relative">
            <input type="search" id="mobile-search-input" placeholder="Search calculators..." class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
          </div>
        </div>
        <div class="space-y-2">
          <a href="https://calcdomain.com/search" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="https://calcdomain.com/#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </nav>
    </nav>
  </header>

  <div class="container mx-auto px-4 py-8">
    <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> &raquo; <a href="https://calcdomain.com/categories/math" class="hover:text-blue-600">Math</a> &raquo; <a href="https://calcdomain.com/subcategories/core-math-algebra" class="hover:text-blue-600">Core Math &amp; Algebra</a></nav>

    <div class="flex flex-col lg:flex-row gap-8">
      <main class="w-full lg:w-2/3">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="space-y-6">
            <header>
              <div class="flex flex-wrap items-center gap-2 mb-2">
                <h1 class="text-2xl md:text-3xl font-bold">Kruskal–Wallis Test Calculator</h1>
                <span class="badge bg-emerald-50 text-emerald-700 border border-emerald-200">
                  Nonparametric one-way ANOVA on ranks
                </span>
              </div>
              <p class="text-gray-700">
                Perform a Kruskal–Wallis H test to compare two or more independent groups when normality or equal variances
                cannot be assumed. The tool pools and ranks all observations, applies tie correction, and computes
                the H statistic, degrees of freedom, p-value (chi-square approximation), and a clear decision.
              </p>
              <p class="mt-2 text-xs text-gray-700 bg-gray-50 border border-gray-200 rounded-md p-2">
                Suitable for ordinal outcomes, skewed data and small samples. For formal analyses, always report your
                full study design and consult a statistician when needed.
              </p>
            </header>

            <!-- INPUT SECTION -->
            <section aria-label="Kruskal–Wallis input section" class="space-y-4">
              <h2 class="text-lg font-semibold">1. Enter your data</h2>

              <div class="grid md:grid-cols-3 gap-4 items-end">
                <div>
                  <label for="kw-groups" class="block text-sm font-medium text-gray-700">
                    Number of groups (k)
                  </label>
                  <input id="kw-groups" type="number" min="2" max="10" step="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" value="3">
                  <p class="hint mt-1">From 2 to 10 independent groups.</p>
                </div>
                <div>
                  <label for="kw-alpha" class="block text-sm font-medium text-gray-700">
                    Significance level \(\alpha\)
                  </label>
                  <input id="kw-alpha" type="number" min="0.0001" max="0.5" step="0.001" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" value="0.05">
                  <p class="hint mt-1">Common choices: 0.05, 0.01.</p>
                </div>
                <div>
                  <button id="kw-update-groups" type="button" class="inline-flex items-center px-3 py-2 text-xs font-medium rounded-md bg-gray-800 text-white hover:bg-gray-900">
                    Update group inputs
                  </button>
                  <p class="hint mt-1">
                    Change k and click to resize inputs. Empty groups are ignored.
                  </p>
                </div>
              </div>

              <div class="flex flex-wrap items-center justify-between gap-2 mt-2">
                <div class="flex items-center gap-2">
                  <input id="kw-tie-correction" type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked="">
                  <label for="kw-tie-correction" class="text-sm text-gray-700">
                    Apply tie correction (recommended)
                  </label>
                </div>
                <div class="text-xs flex flex-wrap items-center gap-2">
                  <span class="font-medium text-gray-700 mr-1">Load example:</span>
                  <button type="button" class="pill" data-example="three-groups">
                    3 groups (clinical scores)
                  </button>
                  <button type="button" class="pill" data-example="two-groups">
                    2 groups (A vs B)
                  </button>
                </div>
              </div>

              <div id="kw-groups-container" class="mt-3 space-y-3">
                <!-- Group textareas inserted by JS -->
              </div>

              <div class="flex flex-wrap items-center gap-3 mt-2">
                <button type="button" id="kw-calc" class="inline-flex items-center px-3 py-2 text-xs font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700">
                  Compute Kruskal–Wallis test
                </button>
                <button type="button" id="kw-clear" class="inline-flex items-center px-3 py-2 text-xs font-medium rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50">
                  Clear all data
                </button>
                <p id="kw-error" class="error-text ml-auto"></p>
              </div>
            </section>

            <!-- SUMMARY RESULTS -->
            <section aria-label="Kruskal–Wallis results" class="space-y-4 mt-6">
              <h2 class="text-lg font-semibold">2. Test results summary</h2>
              <p class="text-sm text-gray-600">
                The Kruskal–Wallis H statistic is compared to a chi-square distribution with \(k-1\) degrees of freedom.
                For small samples (especially with ties), the chi-square approximation is only approximate.
              </p>

              <div class="grid md:grid-cols-4 gap-4">
                <div>
                  <div class="text-xs font-medium text-gray-500 mb-1">H statistic</div>
                  <div id="kw-res-h" class="result-box text-xs">
                    <span class="result-value">—</span>
                    <div class="mt-0.5 text-gray-500 hint">with tie correction if enabled</div>
                  </div>
                </div>
                <div>
                  <div class="text-xs font-medium text-gray-500 mb-1">Degrees of freedom</div>
                  <div id="kw-res-df" class="result-box text-xs">
                    <span class="result-value">—</span>
                    <div class="mt-0.5 text-gray-500 hint">df = k − 1</div>
                  </div>
                </div>
                <div>
                  <div class="text-xs font-medium text-gray-500 mb-1">p-value (chi-square)</div>
                  <div id="kw-res-p" class="result-box text-xs">
                    <span class="result-value">—</span>
                    <div class="mt-0.5 text-gray-500 hint">right-tail probability P(χ² ≥ H)</div>
                  </div>
                </div>
                <div>
                  <div class="text-xs font-medium text-gray-500 mb-1">Decision at \(\alpha\)</div>
                  <div id="kw-res-decision" class="result-box text-xs">
                    <span class="result-value">—</span>
                    <div class="mt-0.5 text-gray-500 hint">reject / do not reject H₀</div>
                  </div>
                </div>
              </div>

              <div id="kw-res-interpretation" class="text-xs text-gray-700 bg-gray-50 border border-gray-200 rounded-md p-2">
                The interpretation of the test will appear here after computation.
              </div>
            </section>

            <!-- GROUP STATS -->
            <section aria-label="Group descriptive statistics" class="space-y-4 mt-6">
              <h2 class="text-lg font-semibold">3. Group descriptive statistics and ranks</h2>
              <p class="text-sm text-gray-600">
                For each group, the table reports the sample size \(n_i\), basic descriptive statistics, and the sum
                and mean of ranks after pooling all observations.
              </p>

              <div class="border border-gray-200 rounded-md table-scroll mt-2 bg-gray-50">
                <table class="min-w-full text-xs">
                  <thead class="bg-gray-100">
                    <tr>
                      <th class="px-3 py-1.5 text-left font-semibold text-gray-700 border-b">Group</th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">n</th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Min</th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Max</th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Mean</th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Median</th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Sum of ranks R<sub>i</sub></th>
                      <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Mean rank</th>
                    </tr>
                  </thead>
                  <tbody id="kw-group-table-body">
                    <!-- Filled via JS -->
                  </tbody>
                </table>
              </div>

              <div class="flex items-center gap-2 text-xs mt-2">
                <button type="button" id="kw-toggle-details" class="text-blue-600 hover:text-blue-800 toggle-link">
                  Show detailed ranked data table
                </button>
                <span class="hint">(useful for verifying ranks and ties)</span>
              </div>

              <div id="kw-details-wrapper" class="mt-2 hidden">
                <div class="border border-gray-200 rounded-md table-scroll bg-gray-50">
                  <table class="min-w-full text-xs">
                    <thead class="bg-gray-100">
                      <tr>
                        <th class="px-3 py-1.5 text-left font-semibold text-gray-700 border-b">Observation</th>
                        <th class="px-3 py-1.5 text-left font-semibold text-gray-700 border-b">Group</th>
                        <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Value</th>
                        <th class="px-3 py-1.5 text-right font-semibold text-gray-700 border-b">Rank</th>
                      </tr>
                    </thead>
                    <tbody id="kw-details-table-body">
                      <!-- Filled via JS -->
                    </tbody>
                  </table>
                </div>
              </div>
            </section>

            <!-- THEORY / CONTENT -->
            <section class="prose mt-8">
              <h2>Definition of the Kruskal–Wallis test</h2>
              <p>
                The <strong>Kruskal–Wallis test</strong> is a nonparametric method for testing whether several
                independent samples (groups) come from the same population. It is often described as a
                <em>rank-based one-way ANOVA</em>, because it applies ANOVA logic to the ranks of the data instead
                of the raw values.
              </p>
              <p>
                Suppose we have \(k\) groups, with sample sizes \(n_1, n_2, \dots, n_k\) and total sample size
                \(N = n_1 + n_2 + \dots + n_k\). All \(N\) observations are pooled and ranked from 1 to \(N\),
                with ties receiving the average of their ranks. Let \(R_i\) be the sum of ranks in group \(i\).
              </p>
              <div class="formula-box text-sm">
                <p>The Kruskal–Wallis H statistic (without tie correction) is</p>
                \[
                  H = \frac{12}{N(N+1)} \sum_{i=1}^{k} \frac{R_i^2}{n_i} - 3(N+1).
                \]
              </div>
              <p>
                Under the null hypothesis that all group distributions are identical, and for sufficiently large
                samples, \(H\) approximately follows a chi-square distribution with \(k-1\) degrees of freedom.
              </p>

              <h3>Tie correction</h3>
              <p>
                When there are ties in the data, a <strong>tie correction factor</strong> improves the accuracy
                of the chi-square approximation. If the data contain tie groups of sizes \(t_1, t_2, \dots\), the
                correction factor \(C\) is
              </p>
              <div class="formula-box text-sm">
                \[
                  C = 1 - \frac{\sum_j (t_j^3 - t_j)}{N^3 - N}.
                \]
                \[
                  H_{\text{corrected}} = \frac{H}{C}.
                \]
              </div>
              <p>
                This calculator applies tie correction by default and reports the corrected \(H\) statistic.
              </p>

              <h3>Null and alternative hypotheses</h3>
              <ul>
                <li><strong>Null hypothesis \(H_0\):</strong> all groups come from the same distribution (typically interpreted as equal medians).</li>
                <li><strong>Alternative hypothesis \(H_1\):</strong> at least one group tends to have larger or smaller values than the others.</li>
              </ul>
              <p>
                If the p-value is below the chosen significance level \(\alpha\), we reject \(H_0\) and conclude that
                there is evidence of a difference between groups. To identify which groups differ, post-hoc tests are required.
              </p>

              <h2 id="faq">FAQ: using and interpreting this Kruskal–Wallis calculator</h2>

              <h3>1. When should I use Kruskal–Wallis instead of one-way ANOVA?</h3>
              <p>
                Use Kruskal–Wallis when the response variable is ordinal or clearly non normal, when there are
                strong outliers, or when the homogeneity of variances assumption of ANOVA is violated. If data are
                approximately normal with equal variances, one-way ANOVA is more powerful.
              </p>

              <h3>2. How many observations per group do I need?</h3>
              <p>
                The test can be computed with small samples, but the chi-square approximation improves with larger
                group sizes (e.g. \(n_i \geq 5\)). With very small groups, treat p-values with caution and interpret
                them as approximate.
              </p>

              <h3>3. How do I perform post-hoc comparisons?</h3>
              <p>
                After a significant Kruskal–Wallis test, use pairwise nonparametric tests such as Dunn's test,
                Wilcoxon rank-sum (Mann–Whitney) with multiple-comparison corrections (Bonferroni, Holm, FDR, etc.)
                to identify which groups differ.
              </p>

              <h3>4. What effect size measures can I report?</h3>
              <p>
                Common effect sizes for Kruskal–Wallis include \(\eta^2\) or \(\epsilon^2\) based on the H statistic.
                For example, a simple option is \(\epsilon^2 = \dfrac{H - k + 1}{N - k}\). This calculator does not
                compute effect size automatically, but you can plug in H, k and N into the formula.
              </p>
            </section>
          </div>
        </div>
      
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[H = \frac{12}{N(N+1)} \sum_{i=1}^{k} \frac{R_i^2}{n_i} - 3(N+1).\]</div>
  <pre class="auditspine-mono">H = \frac{12}{N(N+1)} \sum_{i=1}^{k} \frac{R_i^2}{n_i} - 3(N+1).</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[C = 1 - \frac{\sum_j (t_j^3 - t_j)}{N^3 - N}.\]</div>
  <pre class="auditspine-mono">C = 1 - \frac{\sum_j (t_j^3 - t_j)}{N^3 - N}.</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[H_{\text{corrected}} = \frac{H}{C}.\]</div>
  <pre class="auditspine-mono">H_{\text{corrected}} = \frac{H}{C}.</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\\]</div>
  <pre class="auditspine-mono">','\</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">The Kruskal–Wallis H statistic (without tie correction) is \[ H = \frac{12}{N(N+1)} \sum_{i=1}^{k} \frac{R_i^2}{n_i} - 3(N+1). \]</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">\[ C = 1 - \frac{\sum_j (t_j^3 - t_j)}{N^3 - N}. \] \[ H_{\text{corrected}} = \frac{H}{C}. \]</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><em>No variables provided in audit spec.</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>NIST — Weights and measures</strong> — nist.gov · Accessed 2026-01-19<br><a href="https://www.nist.gov/pml/weights-and-measures" target="_blank" rel="nofollow noopener">https://www.nist.gov/pml/weights-and-measures</a></li>
<li><strong>FTC — Consumer advice</strong> — consumer.ftc.gov · Accessed 2026-01-19<br><a href="https://consumer.ftc.gov/" target="_blank" rel="nofollow noopener">https://consumer.ftc.gov/</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</main>

      <aside class="w-full lg:w-1/3">
        <div class="space-y-6">
          <section class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">Related calculators</h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="https://calcdomain.com/one-way-anova" class="text-blue-600 hover:underline">
                  One-way ANOVA Calculator
                </a>
                <p class="text-gray-500 text-xs">
                  Parametric alternative to Kruskal–Wallis when normality and equal variances are plausible.
                </p>
              </li>
              <li>
                <a href="https://calcdomain.com/mann-whitney-u-test" class="text-blue-600 hover:underline">
                  Mann–Whitney U Test
                </a>
                <p class="text-gray-500 text-xs">
                  Two-group nonparametric comparison, equivalent to Kruskal–Wallis with k = 2.
                </p>
              </li>
              <li>
                <a href="https://calcdomain.com/wilcoxon-signed-rank" class="text-blue-600 hover:underline">
                  Wilcoxon Signed-Rank Test
                </a>
                <p class="text-gray-500 text-xs">
                  Nonparametric test for paired or matched samples.
                </p>
              </li>
              <li>
                <a href="https://calcdomain.com/median-calculator" class="text-blue-600 hover:underline">
                  Median &amp; Quartiles Calculator
                </a>
                <p class="text-gray-500 text-xs">
                  Compute medians, quartiles and IQR to summarise group distributions.
                </p>
              </li>
            </ul>
          </section>

          <section class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">Category: Math &amp; Conversions</h2>
            <p class="text-sm text-gray-700 mb-3">
              Explore more statistics, probability and hypothesis testing tools tailored for students,
              researchers and data professionals.
            </p>
            <a href="https://calcdomain.com/math-conversions" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700">
              Browse all math tools
            </a>
          </section>
        </div>
      </aside>
    </div>
  </div>

  <footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                                                                                                        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction & DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health & Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle & Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math & Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer>



























  <script src="/assets/js/script_menu.js" defer=""></script>
  <script src="/assets/js/script_faq.js" defer=""></script>
  <script src="search.js" defer=""></script>

  <script>
    window.MathJax = { tex: { inlineMath: [['\\(','\\)'], [',
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script>
    // Mobile menu toggle
    document.getElementById('mobile-menu-toggle')?.addEventListener('click', function () {
      const menu = document.getElementById('mobile-menu');
      if (!menu) return;
      const isHidden = menu.classList.contains('hidden');
      menu.classList.toggle('hidden', !isHidden);
      this.setAttribute('aria-expanded', String(isHidden));
    });

    document.addEventListener('DOMContentLoaded', function () {
      const groupsInput = document.getElementById('kw-groups');
      const alphaInput = document.getElementById('kw-alpha');
      const updateGroupsBtn = document.getElementById('kw-update-groups');
      const groupsContainer = document.getElementById('kw-groups-container');
      const tieCheckbox = document.getElementById('kw-tie-correction');

      const calcBtn = document.getElementById('kw-calc');
      const clearBtn = document.getElementById('kw-clear');
      const errorEl = document.getElementById('kw-error');

      const hBox = document.getElementById('kw-res-h');
      const dfBox = document.getElementById('kw-res-df');
      const pBox = document.getElementById('kw-res-p');
      const decisionBox = document.getElementById('kw-res-decision');
      const interpEl = document.getElementById('kw-res-interpretation');

      const groupTableBody = document.getElementById('kw-group-table-body');
      const detailsWrapper = document.getElementById('kw-details-wrapper');
      const detailsToggle = document.getElementById('kw-toggle-details');
      const detailsBody = document.getElementById('kw-details-table-body');

      const exampleButtons = document.querySelectorAll('[data-example]');
      const TOL = 1e-10;

      function setBoxValue(box, text) {
        if (!box) return;
        const span = box.querySelector('.result-value');
        if (span) span.textContent = text;
      }

      function clearResults() {
        setBoxValue(hBox, '—');
        setBoxValue(dfBox, '—');
        setBoxValue(pBox, '—');
        setBoxValue(decisionBox, '—');
        if (interpEl) {
          interpEl.textContent = 'The interpretation of the test will appear here after computation.';
        }
        if (groupTableBody) groupTableBody.innerHTML = '';
        if (detailsBody) detailsBody.innerHTML = '';
        if (detailsWrapper) detailsWrapper.classList.add('hidden');
        if (errorEl) errorEl.textContent = '';
      }

      function clampInt(value, min, max, fallback) {
        const n = Number(value);
        if (!Number.isFinite(n)) return fallback;
        const i = Math.round(n);
        if (i < min) return min;
        if (i > max) return max;
        return i;
      }

      function createGroupInputs(k) {
        groupsContainer.innerHTML = '';
        for (let i = 0; i < k; i++) {
          const div = document.createElement('div');
          div.className = 'space-y-1';

          const labelRow = document.createElement('div');
          labelRow.className = 'flex items-center justify-between';

          const label = document.createElement('label');
          label.className = 'text-sm font-medium text-gray-700';
          label.textContent = 'Group ' + (i + 1) + ' data';

          const hint = document.createElement('span');
          hint.className = 'hint';
          hint.textContent = 'values separated by comma, semicolon or space';

          labelRow.appendChild(label);
          labelRow.appendChild(hint);

          const textarea = document.createElement('textarea');
          textarea.rows = 2;
          textarea.className = 'mt-1 block w-full rounded-md border border-gray-300 px-2 py-1 text-xs focus:ring-blue-500 focus:border-blue-500';
          textarea.setAttribute('data-group-index', String(i));
          textarea.placeholder = 'e.g. 12, 15, 9, 11';

          div.appendChild(labelRow);
          div.appendChild(textarea);
          groupsContainer.appendChild(div);
        }
      }

      function parseGroupValues(text) {
        if (!text) return [];
        const parts = text.split(/[,; \t\r\n]+/).filter(Boolean);
        const values = [];
        for (const p of parts) {
          const num = Number(p);
          if (Number.isFinite(num)) {
            values.push(num);
          }
        }
        return values;
      }

      function formatNumber(num, decimals) {
        if (!Number.isFinite(num)) return '—';
        const abs = Math.abs(num);
        if (abs !== 0 && (abs < 1e-4 || abs >= 1e6)) {
          return num.toExponential(decimals != null ? decimals : 4);
        }
        return num.toLocaleString(undefined, {
          maximumFractionDigits: decimals != null ? decimals : 4
        });
      }

      // Gamma and chi-square utilities (Numerical Recipes style)
      function gammaln(z) {
        const cof = [
          76.18009172947146,
          -86.50532032941677,
          24.01409824083091,
          -1.231739572450155,
          0.001208650973866179,
          -0.000005395239384953
        ];
        let x = z;
        let y = z;
        let tmp = x + 5.5;
        tmp -= (x + 0.5) * Math.log(tmp);
        let ser = 1.000000000190015;
        for (let j = 0; j < cof.length; j++) {
          y += 1;
          ser += cof[j] / y;
        }
        return -tmp + Math.log(2.5066282746310005 * ser / x);
      }

      // Regularized incomplete gamma Q(a,x) = Γ(a,x)/Γ(a) ~ upper tail.
      function gammaincQ(a, x) {
        if (x < 0 || a <= 0) return NaN;
        const ITMAX = 200;
        const EPS = 1e-10;

        if (x === 0) return 1;

        // Series representation for P(a,x) then Q = 1 - P
        function gser(a, x) {
          const gln = gammaln(a);
          let ap = a;
          let sum = 1 / a;
          let del = sum;
          for (let n = 1; n <= ITMAX; n++) {
            ap += 1;
            del *= x / ap;
            sum += del;
            if (Math.abs(del) < Math.abs(sum) * EPS) {
              break;
            }
          }
          const val = sum * Math.exp(-x + a * Math.log(x) - gln);
          return { P: val, Q: 1 - val };
        }

        // Continued fraction for Q directly
        function gcf(a, x) {
          const gln = gammaln(a);
          let b = x + 1 - a;
          let c = 1 / 1e-30;
          let d = 1 / b;
          let h = d;
          for (let i = 1; i <= ITMAX; i++) {
            let an = -i * (i - a);
            b += 2;
            d = an * d + b;
            if (Math.abs(d) < 1e-30) d = 1e-30;
            c = b + an / c;
            if (Math.abs(c) < 1e-30) c = 1e-30;
            d = 1 / d;
            const delta = d * c;
            h *= delta;
            if (Math.abs(delta - 1) < EPS) break;
          }
          const Q = Math.exp(-x + a * Math.log(x) - gln) * h;
          const P = 1 - Q;
          return { P, Q };
        }

        if (x < a + 1) {
          return gser(a, x).Q;
        } else {
          return gcf(a, x).Q;
        }
      }

      function chisqPvalue(chi2, df) {
        if (!Number.isFinite(chi2) || !Number.isFinite(df) || chi2 < 0 || df <= 0) {
          return NaN;
        }
        const a = df / 2;
        const x = chi2 / 2;
        return gammaincQ(a, x);
      }

      function computeKruskalWallis() {
        clearResults();

        const kRequested = clampInt(groupsInput.value, 2, 10, 3);
        groupsInput.value = String(kRequested);

        const alpha = Number(alphaInput.value);
        if (!Number.isFinite(alpha) || alpha <= 0 || alpha >= 0.5) {
          errorEl.textContent = 'Significance level α must be between 0 and 0.5.';
          return;
        }

        const groupTextareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        const groups = [];
        groupTextareas.forEach((ta) => {
          const idx = Number(ta.getAttribute('data-group-index'));
          const values = parseGroupValues(ta.value);
          if (values.length > 0) {
            groups.push({ index: idx, name: 'Group ' + (idx + 1), values: values });
          }
        });

        const k = groups.length;
        if (k < 2) {
          errorEl.textContent = 'Please provide data for at least two non-empty groups.';
          return;
        }

        let N = 0;
        groups.forEach(g => { N += g.values.length; });
        if (N < 5) {
          errorEl.textContent = 'Total sample size is too small. Please enter at least 5 observations.';
          return;
        }

        // Flatten and rank data
        const pooled = [];
        let obsCounter = 1;
        groups.forEach(g => {
          g.values.forEach(v => {
            pooled.push({
              value: v,
              groupIndex: g.index,
              groupName: g.name,
              obsId: obsCounter++
            });
          });
        });

        pooled.sort((a, b) => a.value - b.value);

        // Assign ranks with ties and collect tie counts
        const tieCounts = [];
        let i = 0;
        while (i < pooled.length) {
          let j = i + 1;
          while (j < pooled.length && Math.abs(pooled[j].value - pooled[i].value) < TOL) {
            j++;
          }
          const t = j - i;
          const rankStart = i + 1;
          const rankEnd = j;
          const avgRank = (rankStart + rankEnd) / 2;
          for (let r = i; r < j; r++) {
            pooled[r].rank = avgRank;
          }
          if (t > 1) {
            tieCounts.push(t);
          }
          i = j;
        }

        // Sum ranks per group and compute descriptive stats
        const groupStatsMap = new Map();
        groups.forEach(g => {
          groupStatsMap.set(g.index, {
            name: g.name,
            values: g.values.slice(),
            n: g.values.length,
            R: 0,
            mean: NaN,
            median: NaN,
            min: NaN,
            max: NaN
          });
        });

        pooled.forEach(obs => {
          const stats = groupStatsMap.get(obs.groupIndex);
          if (stats) {
            stats.R += obs.rank;
          }
        });

        groupStatsMap.forEach(stats => {
          const arr = stats.values.slice().sort((a, b) => a - b);
          const n = arr.length;
          stats.min = arr[0];
          stats.max = arr[n - 1];
          const sum = arr.reduce((acc, v) => acc + v, 0);
          stats.mean = sum / n;
          if (n % 2 === 1) {
            stats.median = arr[(n - 1) / 2];
          } else {
            stats.median = (arr[n / 2 - 1] + arr[n / 2]) / 2;
          }
        });

        // Compute H
        let sumR2overNi = 0;
        groupStatsMap.forEach(stats => {
          sumR2overNi += (stats.R * stats.R) / stats.n;
        });

        const H_unadjusted = (12 / (N * (N + 1))) * sumR2overNi - 3 * (N + 1);

        // Tie correction
        let C = 1;
        if (tieCheckbox.checked && tieCounts.length > 0) {
          let tieSum = 0;
          tieCounts.forEach(t => {
            tieSum += (t * t * t - t);
          });
          const denom = (N * N * N - N);
          if (Math.abs(denom) > TOL) {
            C = 1 - tieSum / denom;
          }
        }

        const H = H_unadjusted / C;

        // Degrees of freedom and p-value
        const df = k - 1;
        const p = chisqPvalue(H, df);

        // Summary outputs
        setBoxValue(hBox, formatNumber(H, 4) + (tieCheckbox.checked ? ' (corrected)' : ''));
        setBoxValue(dfBox, String(df));

        if (Number.isFinite(p)) {
          let pText;
          if (p < 0.0001) {
            pText = 'p < 0.0001';
          } else {
            pText = 'p ≈ ' + formatNumber(p, 4);
          }
          setBoxValue(pBox, pText);
        } else {
          setBoxValue(pBox, 'not available');
        }

        let decisionText = '—';
        let interpText = '';

        if (Number.isFinite(p)) {
          if (p <= alpha) {
            decisionText = 'Reject H₀ at α = ' + alpha.toString();
            interpText =
              'The Kruskal–Wallis test is statistically significant (H ≈ ' + formatNumber(H, 4) +
              ', df = ' + df + ', p ≈ ' + formatNumber(p, 4) +
              '). At least one group tends to differ from the others. ' +
              'Consider post-hoc pairwise comparisons (e.g. Dunn’s test) to identify which groups differ.';
          } else {
            decisionText = 'Do not reject H₀ at α = ' + alpha.toString();
            interpText =
              'The Kruskal–Wallis test is not statistically significant (H ≈ ' + formatNumber(H, 4) +
              ', df = ' + df + ', p ≈ ' + formatNumber(p, 4) +
              '). There is no strong evidence that the group distributions differ, ' +
              'although practical relevance and sample size should still be considered.';
          }
        } else {
          interpText =
            'The test statistic H was computed as ' + formatNumber(H, 4) +
            ', but the p-value could not be evaluated. Please check the data.';
        }

        setBoxValue(decisionBox, decisionText);
        if (interpEl) interpEl.textContent = interpText;

        // Group stats table
        groupTableBody.innerHTML = '';
        const orderedGroups = Array.from(groupStatsMap.values()).sort((a, b) => {
          const numA = Number(a.name.replace(/[^0-9]/g, '')) || 0;
          const numB = Number(b.name.replace(/[^0-9]/g, '')) || 0;
          return numA - numB;
        });

        orderedGroups.forEach(stats => {
          const tr = document.createElement('tr');
          tr.className = 'border-b';

          const tdName = document.createElement('td');
          tdName.className = 'px-3 py-1.5 text-gray-700';
          tdName.textContent = stats.name;

          const tdN = document.createElement('td');
          tdN.className = 'px-3 py-1.5 text-right text-gray-700';
          tdN.textContent = String(stats.n);

          const tdMin = document.createElement('td');
          tdMin.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMin.textContent = formatNumber(stats.min, 4);

          const tdMax = document.createElement('td');
          tdMax.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMax.textContent = formatNumber(stats.max, 4);

          const tdMean = document.createElement('td');
          tdMean.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMean.textContent = formatNumber(stats.mean, 4);

          const tdMedian = document.createElement('td');
          tdMedian.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMedian.textContent = formatNumber(stats.median, 4);

          const tdR = document.createElement('td');
          tdR.className = 'px-3 py-1.5 text-right text-gray-700';
          tdR.textContent = formatNumber(stats.R, 4);

          const tdMeanRank = document.createElement('td');
          tdMeanRank.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMeanRank.textContent = formatNumber(stats.R / stats.n, 4);

          tr.appendChild(tdName);
          tr.appendChild(tdN);
          tr.appendChild(tdMin);
          tr.appendChild(tdMax);
          tr.appendChild(tdMean);
          tr.appendChild(tdMedian);
          tr.appendChild(tdR);
          tr.appendChild(tdMeanRank);

          groupTableBody.appendChild(tr);
        });

        // Detailed table
        detailsBody.innerHTML = '';
        pooled.forEach(obs => {
          const tr = document.createElement('tr');
          tr.className = 'border-b';

          const tdObs = document.createElement('td');
          tdObs.className = 'px-3 py-1.5 text-gray-700';
          tdObs.textContent = '#' + obs.obsId;

          const tdGroup = document.createElement('td');
          tdGroup.className = 'px-3 py-1.5 text-gray-700';
          tdGroup.textContent = obs.groupName;

          const tdVal = document.createElement('td');
          tdVal.className = 'px-3 py-1.5 text-right text-gray-700';
          tdVal.textContent = formatNumber(obs.value, 6);

          const tdRank = document.createElement('td');
          tdRank.className = 'px-3 py-1.5 text-right text-gray-700';
          tdRank.textContent = formatNumber(obs.rank, 4);

          tr.appendChild(tdObs);
          tr.appendChild(tdGroup);
          tr.appendChild(tdVal);
          tr.appendChild(tdRank);
          detailsBody.appendChild(tr);
        });
      }

      function clearAll() {
        const textareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        textareas.forEach(ta => { ta.value = ''; });
        clearResults();
      }

      function loadExample(name) {
        const examples = {
          'three-groups': [
            [12, 15, 9, 11, 14],
            [18, 21, 19, 17, 22],
            [8, 10, 7, 9, 6]
          ],
          'two-groups': [
            [5, 7, 6, 8, 9],
            [10, 12, 11, 13, 14]
          ]
        };

        const data = examples[name];
        if (!data) return;

        const k = data.length;
        groupsInput.value = String(k);
        createGroupInputs(k);

        const textareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        textareas.forEach(ta => {
          const idx = Number(ta.getAttribute('data-group-index'));
          const arr = data[idx];
          if (arr) {
            ta.value = arr.join(', ');
          } else {
            ta.value = '';
          }
        });

        clearResults();
      }

      // Toggle detailed table visibility
      if (detailsToggle) {
        detailsToggle.addEventListener('click', function () {
          if (!detailsWrapper) return;
          const isHidden = detailsWrapper.classList.contains('hidden');
          detailsWrapper.classList.toggle('hidden', !isHidden);
          detailsToggle.textContent = isHidden
            ? 'Hide detailed ranked data table'
            : 'Show detailed ranked data table';
        });
      }

      // Initialise group inputs
      const initialK = clampInt(groupsInput.value, 2, 10, 3);
      groupsInput.value = String(initialK);
      createGroupInputs(initialK);

      if (updateGroupsBtn) {
        updateGroupsBtn.addEventListener('click', function () {
          const k = clampInt(groupsInput.value, 2, 10, 3);
          groupsInput.value = String(k);
          createGroupInputs(k);
          clearResults();
        });
      }

      if (calcBtn) calcBtn.addEventListener('click', computeKruskalWallis);
      if (clearBtn) clearBtn.addEventListener('click', clearAll);

      exampleButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          const name = btn.getAttribute('data-example');
          if (name) loadExample(name);
        });
      });
    });
  </script>


</body></html>
, ',
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script>
    // Mobile menu toggle
    document.getElementById('mobile-menu-toggle')?.addEventListener('click', function () {
      const menu = document.getElementById('mobile-menu');
      if (!menu) return;
      const isHidden = menu.classList.contains('hidden');
      menu.classList.toggle('hidden', !isHidden);
      this.setAttribute('aria-expanded', String(isHidden));
    });

    document.addEventListener('DOMContentLoaded', function () {
      const groupsInput = document.getElementById('kw-groups');
      const alphaInput = document.getElementById('kw-alpha');
      const updateGroupsBtn = document.getElementById('kw-update-groups');
      const groupsContainer = document.getElementById('kw-groups-container');
      const tieCheckbox = document.getElementById('kw-tie-correction');

      const calcBtn = document.getElementById('kw-calc');
      const clearBtn = document.getElementById('kw-clear');
      const errorEl = document.getElementById('kw-error');

      const hBox = document.getElementById('kw-res-h');
      const dfBox = document.getElementById('kw-res-df');
      const pBox = document.getElementById('kw-res-p');
      const decisionBox = document.getElementById('kw-res-decision');
      const interpEl = document.getElementById('kw-res-interpretation');

      const groupTableBody = document.getElementById('kw-group-table-body');
      const detailsWrapper = document.getElementById('kw-details-wrapper');
      const detailsToggle = document.getElementById('kw-toggle-details');
      const detailsBody = document.getElementById('kw-details-table-body');

      const exampleButtons = document.querySelectorAll('[data-example]');
      const TOL = 1e-10;

      function setBoxValue(box, text) {
        if (!box) return;
        const span = box.querySelector('.result-value');
        if (span) span.textContent = text;
      }

      function clearResults() {
        setBoxValue(hBox, '—');
        setBoxValue(dfBox, '—');
        setBoxValue(pBox, '—');
        setBoxValue(decisionBox, '—');
        if (interpEl) {
          interpEl.textContent = 'The interpretation of the test will appear here after computation.';
        }
        if (groupTableBody) groupTableBody.innerHTML = '';
        if (detailsBody) detailsBody.innerHTML = '';
        if (detailsWrapper) detailsWrapper.classList.add('hidden');
        if (errorEl) errorEl.textContent = '';
      }

      function clampInt(value, min, max, fallback) {
        const n = Number(value);
        if (!Number.isFinite(n)) return fallback;
        const i = Math.round(n);
        if (i < min) return min;
        if (i > max) return max;
        return i;
      }

      function createGroupInputs(k) {
        groupsContainer.innerHTML = '';
        for (let i = 0; i < k; i++) {
          const div = document.createElement('div');
          div.className = 'space-y-1';

          const labelRow = document.createElement('div');
          labelRow.className = 'flex items-center justify-between';

          const label = document.createElement('label');
          label.className = 'text-sm font-medium text-gray-700';
          label.textContent = 'Group ' + (i + 1) + ' data';

          const hint = document.createElement('span');
          hint.className = 'hint';
          hint.textContent = 'values separated by comma, semicolon or space';

          labelRow.appendChild(label);
          labelRow.appendChild(hint);

          const textarea = document.createElement('textarea');
          textarea.rows = 2;
          textarea.className = 'mt-1 block w-full rounded-md border border-gray-300 px-2 py-1 text-xs focus:ring-blue-500 focus:border-blue-500';
          textarea.setAttribute('data-group-index', String(i));
          textarea.placeholder = 'e.g. 12, 15, 9, 11';

          div.appendChild(labelRow);
          div.appendChild(textarea);
          groupsContainer.appendChild(div);
        }
      }

      function parseGroupValues(text) {
        if (!text) return [];
        const parts = text.split(/[,; \t\r\n]+/).filter(Boolean);
        const values = [];
        for (const p of parts) {
          const num = Number(p);
          if (Number.isFinite(num)) {
            values.push(num);
          }
        }
        return values;
      }

      function formatNumber(num, decimals) {
        if (!Number.isFinite(num)) return '—';
        const abs = Math.abs(num);
        if (abs !== 0 && (abs < 1e-4 || abs >= 1e6)) {
          return num.toExponential(decimals != null ? decimals : 4);
        }
        return num.toLocaleString(undefined, {
          maximumFractionDigits: decimals != null ? decimals : 4
        });
      }

      // Gamma and chi-square utilities (Numerical Recipes style)
      function gammaln(z) {
        const cof = [
          76.18009172947146,
          -86.50532032941677,
          24.01409824083091,
          -1.231739572450155,
          0.001208650973866179,
          -0.000005395239384953
        ];
        let x = z;
        let y = z;
        let tmp = x + 5.5;
        tmp -= (x + 0.5) * Math.log(tmp);
        let ser = 1.000000000190015;
        for (let j = 0; j < cof.length; j++) {
          y += 1;
          ser += cof[j] / y;
        }
        return -tmp + Math.log(2.5066282746310005 * ser / x);
      }

      // Regularized incomplete gamma Q(a,x) = Γ(a,x)/Γ(a) ~ upper tail.
      function gammaincQ(a, x) {
        if (x < 0 || a <= 0) return NaN;
        const ITMAX = 200;
        const EPS = 1e-10;

        if (x === 0) return 1;

        // Series representation for P(a,x) then Q = 1 - P
        function gser(a, x) {
          const gln = gammaln(a);
          let ap = a;
          let sum = 1 / a;
          let del = sum;
          for (let n = 1; n <= ITMAX; n++) {
            ap += 1;
            del *= x / ap;
            sum += del;
            if (Math.abs(del) < Math.abs(sum) * EPS) {
              break;
            }
          }
          const val = sum * Math.exp(-x + a * Math.log(x) - gln);
          return { P: val, Q: 1 - val };
        }

        // Continued fraction for Q directly
        function gcf(a, x) {
          const gln = gammaln(a);
          let b = x + 1 - a;
          let c = 1 / 1e-30;
          let d = 1 / b;
          let h = d;
          for (let i = 1; i <= ITMAX; i++) {
            let an = -i * (i - a);
            b += 2;
            d = an * d + b;
            if (Math.abs(d) < 1e-30) d = 1e-30;
            c = b + an / c;
            if (Math.abs(c) < 1e-30) c = 1e-30;
            d = 1 / d;
            const delta = d * c;
            h *= delta;
            if (Math.abs(delta - 1) < EPS) break;
          }
          const Q = Math.exp(-x + a * Math.log(x) - gln) * h;
          const P = 1 - Q;
          return { P, Q };
        }

        if (x < a + 1) {
          return gser(a, x).Q;
        } else {
          return gcf(a, x).Q;
        }
      }

      function chisqPvalue(chi2, df) {
        if (!Number.isFinite(chi2) || !Number.isFinite(df) || chi2 < 0 || df <= 0) {
          return NaN;
        }
        const a = df / 2;
        const x = chi2 / 2;
        return gammaincQ(a, x);
      }

      function computeKruskalWallis() {
        clearResults();

        const kRequested = clampInt(groupsInput.value, 2, 10, 3);
        groupsInput.value = String(kRequested);

        const alpha = Number(alphaInput.value);
        if (!Number.isFinite(alpha) || alpha <= 0 || alpha >= 0.5) {
          errorEl.textContent = 'Significance level α must be between 0 and 0.5.';
          return;
        }

        const groupTextareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        const groups = [];
        groupTextareas.forEach((ta) => {
          const idx = Number(ta.getAttribute('data-group-index'));
          const values = parseGroupValues(ta.value);
          if (values.length > 0) {
            groups.push({ index: idx, name: 'Group ' + (idx + 1), values: values });
          }
        });

        const k = groups.length;
        if (k < 2) {
          errorEl.textContent = 'Please provide data for at least two non-empty groups.';
          return;
        }

        let N = 0;
        groups.forEach(g => { N += g.values.length; });
        if (N < 5) {
          errorEl.textContent = 'Total sample size is too small. Please enter at least 5 observations.';
          return;
        }

        // Flatten and rank data
        const pooled = [];
        let obsCounter = 1;
        groups.forEach(g => {
          g.values.forEach(v => {
            pooled.push({
              value: v,
              groupIndex: g.index,
              groupName: g.name,
              obsId: obsCounter++
            });
          });
        });

        pooled.sort((a, b) => a.value - b.value);

        // Assign ranks with ties and collect tie counts
        const tieCounts = [];
        let i = 0;
        while (i < pooled.length) {
          let j = i + 1;
          while (j < pooled.length && Math.abs(pooled[j].value - pooled[i].value) < TOL) {
            j++;
          }
          const t = j - i;
          const rankStart = i + 1;
          const rankEnd = j;
          const avgRank = (rankStart + rankEnd) / 2;
          for (let r = i; r < j; r++) {
            pooled[r].rank = avgRank;
          }
          if (t > 1) {
            tieCounts.push(t);
          }
          i = j;
        }

        // Sum ranks per group and compute descriptive stats
        const groupStatsMap = new Map();
        groups.forEach(g => {
          groupStatsMap.set(g.index, {
            name: g.name,
            values: g.values.slice(),
            n: g.values.length,
            R: 0,
            mean: NaN,
            median: NaN,
            min: NaN,
            max: NaN
          });
        });

        pooled.forEach(obs => {
          const stats = groupStatsMap.get(obs.groupIndex);
          if (stats) {
            stats.R += obs.rank;
          }
        });

        groupStatsMap.forEach(stats => {
          const arr = stats.values.slice().sort((a, b) => a - b);
          const n = arr.length;
          stats.min = arr[0];
          stats.max = arr[n - 1];
          const sum = arr.reduce((acc, v) => acc + v, 0);
          stats.mean = sum / n;
          if (n % 2 === 1) {
            stats.median = arr[(n - 1) / 2];
          } else {
            stats.median = (arr[n / 2 - 1] + arr[n / 2]) / 2;
          }
        });

        // Compute H
        let sumR2overNi = 0;
        groupStatsMap.forEach(stats => {
          sumR2overNi += (stats.R * stats.R) / stats.n;
        });

        const H_unadjusted = (12 / (N * (N + 1))) * sumR2overNi - 3 * (N + 1);

        // Tie correction
        let C = 1;
        if (tieCheckbox.checked && tieCounts.length > 0) {
          let tieSum = 0;
          tieCounts.forEach(t => {
            tieSum += (t * t * t - t);
          });
          const denom = (N * N * N - N);
          if (Math.abs(denom) > TOL) {
            C = 1 - tieSum / denom;
          }
        }

        const H = H_unadjusted / C;

        // Degrees of freedom and p-value
        const df = k - 1;
        const p = chisqPvalue(H, df);

        // Summary outputs
        setBoxValue(hBox, formatNumber(H, 4) + (tieCheckbox.checked ? ' (corrected)' : ''));
        setBoxValue(dfBox, String(df));

        if (Number.isFinite(p)) {
          let pText;
          if (p < 0.0001) {
            pText = 'p < 0.0001';
          } else {
            pText = 'p ≈ ' + formatNumber(p, 4);
          }
          setBoxValue(pBox, pText);
        } else {
          setBoxValue(pBox, 'not available');
        }

        let decisionText = '—';
        let interpText = '';

        if (Number.isFinite(p)) {
          if (p <= alpha) {
            decisionText = 'Reject H₀ at α = ' + alpha.toString();
            interpText =
              'The Kruskal–Wallis test is statistically significant (H ≈ ' + formatNumber(H, 4) +
              ', df = ' + df + ', p ≈ ' + formatNumber(p, 4) +
              '). At least one group tends to differ from the others. ' +
              'Consider post-hoc pairwise comparisons (e.g. Dunn’s test) to identify which groups differ.';
          } else {
            decisionText = 'Do not reject H₀ at α = ' + alpha.toString();
            interpText =
              'The Kruskal–Wallis test is not statistically significant (H ≈ ' + formatNumber(H, 4) +
              ', df = ' + df + ', p ≈ ' + formatNumber(p, 4) +
              '). There is no strong evidence that the group distributions differ, ' +
              'although practical relevance and sample size should still be considered.';
          }
        } else {
          interpText =
            'The test statistic H was computed as ' + formatNumber(H, 4) +
            ', but the p-value could not be evaluated. Please check the data.';
        }

        setBoxValue(decisionBox, decisionText);
        if (interpEl) interpEl.textContent = interpText;

        // Group stats table
        groupTableBody.innerHTML = '';
        const orderedGroups = Array.from(groupStatsMap.values()).sort((a, b) => {
          const numA = Number(a.name.replace(/[^0-9]/g, '')) || 0;
          const numB = Number(b.name.replace(/[^0-9]/g, '')) || 0;
          return numA - numB;
        });

        orderedGroups.forEach(stats => {
          const tr = document.createElement('tr');
          tr.className = 'border-b';

          const tdName = document.createElement('td');
          tdName.className = 'px-3 py-1.5 text-gray-700';
          tdName.textContent = stats.name;

          const tdN = document.createElement('td');
          tdN.className = 'px-3 py-1.5 text-right text-gray-700';
          tdN.textContent = String(stats.n);

          const tdMin = document.createElement('td');
          tdMin.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMin.textContent = formatNumber(stats.min, 4);

          const tdMax = document.createElement('td');
          tdMax.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMax.textContent = formatNumber(stats.max, 4);

          const tdMean = document.createElement('td');
          tdMean.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMean.textContent = formatNumber(stats.mean, 4);

          const tdMedian = document.createElement('td');
          tdMedian.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMedian.textContent = formatNumber(stats.median, 4);

          const tdR = document.createElement('td');
          tdR.className = 'px-3 py-1.5 text-right text-gray-700';
          tdR.textContent = formatNumber(stats.R, 4);

          const tdMeanRank = document.createElement('td');
          tdMeanRank.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMeanRank.textContent = formatNumber(stats.R / stats.n, 4);

          tr.appendChild(tdName);
          tr.appendChild(tdN);
          tr.appendChild(tdMin);
          tr.appendChild(tdMax);
          tr.appendChild(tdMean);
          tr.appendChild(tdMedian);
          tr.appendChild(tdR);
          tr.appendChild(tdMeanRank);

          groupTableBody.appendChild(tr);
        });

        // Detailed table
        detailsBody.innerHTML = '';
        pooled.forEach(obs => {
          const tr = document.createElement('tr');
          tr.className = 'border-b';

          const tdObs = document.createElement('td');
          tdObs.className = 'px-3 py-1.5 text-gray-700';
          tdObs.textContent = '#' + obs.obsId;

          const tdGroup = document.createElement('td');
          tdGroup.className = 'px-3 py-1.5 text-gray-700';
          tdGroup.textContent = obs.groupName;

          const tdVal = document.createElement('td');
          tdVal.className = 'px-3 py-1.5 text-right text-gray-700';
          tdVal.textContent = formatNumber(obs.value, 6);

          const tdRank = document.createElement('td');
          tdRank.className = 'px-3 py-1.5 text-right text-gray-700';
          tdRank.textContent = formatNumber(obs.rank, 4);

          tr.appendChild(tdObs);
          tr.appendChild(tdGroup);
          tr.appendChild(tdVal);
          tr.appendChild(tdRank);
          detailsBody.appendChild(tr);
        });
      }

      function clearAll() {
        const textareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        textareas.forEach(ta => { ta.value = ''; });
        clearResults();
      }

      function loadExample(name) {
        const examples = {
          'three-groups': [
            [12, 15, 9, 11, 14],
            [18, 21, 19, 17, 22],
            [8, 10, 7, 9, 6]
          ],
          'two-groups': [
            [5, 7, 6, 8, 9],
            [10, 12, 11, 13, 14]
          ]
        };

        const data = examples[name];
        if (!data) return;

        const k = data.length;
        groupsInput.value = String(k);
        createGroupInputs(k);

        const textareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        textareas.forEach(ta => {
          const idx = Number(ta.getAttribute('data-group-index'));
          const arr = data[idx];
          if (arr) {
            ta.value = arr.join(', ');
          } else {
            ta.value = '';
          }
        });

        clearResults();
      }

      // Toggle detailed table visibility
      if (detailsToggle) {
        detailsToggle.addEventListener('click', function () {
          if (!detailsWrapper) return;
          const isHidden = detailsWrapper.classList.contains('hidden');
          detailsWrapper.classList.toggle('hidden', !isHidden);
          detailsToggle.textContent = isHidden
            ? 'Hide detailed ranked data table'
            : 'Show detailed ranked data table';
        });
      }

      // Initialise group inputs
      const initialK = clampInt(groupsInput.value, 2, 10, 3);
      groupsInput.value = String(initialK);
      createGroupInputs(initialK);

      if (updateGroupsBtn) {
        updateGroupsBtn.addEventListener('click', function () {
          const k = clampInt(groupsInput.value, 2, 10, 3);
          groupsInput.value = String(k);
          createGroupInputs(k);
          clearResults();
        });
      }

      if (calcBtn) calcBtn.addEventListener('click', computeKruskalWallis);
      if (clearBtn) clearBtn.addEventListener('click', clearAll);

      exampleButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          const name = btn.getAttribute('data-example');
          if (name) loadExample(name);
        });
      });
    });
  </script>


</body></html>
]], displayMath: [['\\[','\\]']] }, svg: { fontCache: 'global' } };,
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script>
    // Mobile menu toggle
    document.getElementById('mobile-menu-toggle')?.addEventListener('click', function () {
      const menu = document.getElementById('mobile-menu');
      if (!menu) return;
      const isHidden = menu.classList.contains('hidden');
      menu.classList.toggle('hidden', !isHidden);
      this.setAttribute('aria-expanded', String(isHidden));
    });

    document.addEventListener('DOMContentLoaded', function () {
      const groupsInput = document.getElementById('kw-groups');
      const alphaInput = document.getElementById('kw-alpha');
      const updateGroupsBtn = document.getElementById('kw-update-groups');
      const groupsContainer = document.getElementById('kw-groups-container');
      const tieCheckbox = document.getElementById('kw-tie-correction');

      const calcBtn = document.getElementById('kw-calc');
      const clearBtn = document.getElementById('kw-clear');
      const errorEl = document.getElementById('kw-error');

      const hBox = document.getElementById('kw-res-h');
      const dfBox = document.getElementById('kw-res-df');
      const pBox = document.getElementById('kw-res-p');
      const decisionBox = document.getElementById('kw-res-decision');
      const interpEl = document.getElementById('kw-res-interpretation');

      const groupTableBody = document.getElementById('kw-group-table-body');
      const detailsWrapper = document.getElementById('kw-details-wrapper');
      const detailsToggle = document.getElementById('kw-toggle-details');
      const detailsBody = document.getElementById('kw-details-table-body');

      const exampleButtons = document.querySelectorAll('[data-example]');
      const TOL = 1e-10;

      function setBoxValue(box, text) {
        if (!box) return;
        const span = box.querySelector('.result-value');
        if (span) span.textContent = text;
      }

      function clearResults() {
        setBoxValue(hBox, '—');
        setBoxValue(dfBox, '—');
        setBoxValue(pBox, '—');
        setBoxValue(decisionBox, '—');
        if (interpEl) {
          interpEl.textContent = 'The interpretation of the test will appear here after computation.';
        }
        if (groupTableBody) groupTableBody.innerHTML = '';
        if (detailsBody) detailsBody.innerHTML = '';
        if (detailsWrapper) detailsWrapper.classList.add('hidden');
        if (errorEl) errorEl.textContent = '';
      }

      function clampInt(value, min, max, fallback) {
        const n = Number(value);
        if (!Number.isFinite(n)) return fallback;
        const i = Math.round(n);
        if (i < min) return min;
        if (i > max) return max;
        return i;
      }

      function createGroupInputs(k) {
        groupsContainer.innerHTML = '';
        for (let i = 0; i < k; i++) {
          const div = document.createElement('div');
          div.className = 'space-y-1';

          const labelRow = document.createElement('div');
          labelRow.className = 'flex items-center justify-between';

          const label = document.createElement('label');
          label.className = 'text-sm font-medium text-gray-700';
          label.textContent = 'Group ' + (i + 1) + ' data';

          const hint = document.createElement('span');
          hint.className = 'hint';
          hint.textContent = 'values separated by comma, semicolon or space';

          labelRow.appendChild(label);
          labelRow.appendChild(hint);

          const textarea = document.createElement('textarea');
          textarea.rows = 2;
          textarea.className = 'mt-1 block w-full rounded-md border border-gray-300 px-2 py-1 text-xs focus:ring-blue-500 focus:border-blue-500';
          textarea.setAttribute('data-group-index', String(i));
          textarea.placeholder = 'e.g. 12, 15, 9, 11';

          div.appendChild(labelRow);
          div.appendChild(textarea);
          groupsContainer.appendChild(div);
        }
      }

      function parseGroupValues(text) {
        if (!text) return [];
        const parts = text.split(/[,; \t\r\n]+/).filter(Boolean);
        const values = [];
        for (const p of parts) {
          const num = Number(p);
          if (Number.isFinite(num)) {
            values.push(num);
          }
        }
        return values;
      }

      function formatNumber(num, decimals) {
        if (!Number.isFinite(num)) return '—';
        const abs = Math.abs(num);
        if (abs !== 0 && (abs < 1e-4 || abs >= 1e6)) {
          return num.toExponential(decimals != null ? decimals : 4);
        }
        return num.toLocaleString(undefined, {
          maximumFractionDigits: decimals != null ? decimals : 4
        });
      }

      // Gamma and chi-square utilities (Numerical Recipes style)
      function gammaln(z) {
        const cof = [
          76.18009172947146,
          -86.50532032941677,
          24.01409824083091,
          -1.231739572450155,
          0.001208650973866179,
          -0.000005395239384953
        ];
        let x = z;
        let y = z;
        let tmp = x + 5.5;
        tmp -= (x + 0.5) * Math.log(tmp);
        let ser = 1.000000000190015;
        for (let j = 0; j < cof.length; j++) {
          y += 1;
          ser += cof[j] / y;
        }
        return -tmp + Math.log(2.5066282746310005 * ser / x);
      }

      // Regularized incomplete gamma Q(a,x) = Γ(a,x)/Γ(a) ~ upper tail.
      function gammaincQ(a, x) {
        if (x < 0 || a <= 0) return NaN;
        const ITMAX = 200;
        const EPS = 1e-10;

        if (x === 0) return 1;

        // Series representation for P(a,x) then Q = 1 - P
        function gser(a, x) {
          const gln = gammaln(a);
          let ap = a;
          let sum = 1 / a;
          let del = sum;
          for (let n = 1; n <= ITMAX; n++) {
            ap += 1;
            del *= x / ap;
            sum += del;
            if (Math.abs(del) < Math.abs(sum) * EPS) {
              break;
            }
          }
          const val = sum * Math.exp(-x + a * Math.log(x) - gln);
          return { P: val, Q: 1 - val };
        }

        // Continued fraction for Q directly
        function gcf(a, x) {
          const gln = gammaln(a);
          let b = x + 1 - a;
          let c = 1 / 1e-30;
          let d = 1 / b;
          let h = d;
          for (let i = 1; i <= ITMAX; i++) {
            let an = -i * (i - a);
            b += 2;
            d = an * d + b;
            if (Math.abs(d) < 1e-30) d = 1e-30;
            c = b + an / c;
            if (Math.abs(c) < 1e-30) c = 1e-30;
            d = 1 / d;
            const delta = d * c;
            h *= delta;
            if (Math.abs(delta - 1) < EPS) break;
          }
          const Q = Math.exp(-x + a * Math.log(x) - gln) * h;
          const P = 1 - Q;
          return { P, Q };
        }

        if (x < a + 1) {
          return gser(a, x).Q;
        } else {
          return gcf(a, x).Q;
        }
      }

      function chisqPvalue(chi2, df) {
        if (!Number.isFinite(chi2) || !Number.isFinite(df) || chi2 < 0 || df <= 0) {
          return NaN;
        }
        const a = df / 2;
        const x = chi2 / 2;
        return gammaincQ(a, x);
      }

      function computeKruskalWallis() {
        clearResults();

        const kRequested = clampInt(groupsInput.value, 2, 10, 3);
        groupsInput.value = String(kRequested);

        const alpha = Number(alphaInput.value);
        if (!Number.isFinite(alpha) || alpha <= 0 || alpha >= 0.5) {
          errorEl.textContent = 'Significance level α must be between 0 and 0.5.';
          return;
        }

        const groupTextareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        const groups = [];
        groupTextareas.forEach((ta) => {
          const idx = Number(ta.getAttribute('data-group-index'));
          const values = parseGroupValues(ta.value);
          if (values.length > 0) {
            groups.push({ index: idx, name: 'Group ' + (idx + 1), values: values });
          }
        });

        const k = groups.length;
        if (k < 2) {
          errorEl.textContent = 'Please provide data for at least two non-empty groups.';
          return;
        }

        let N = 0;
        groups.forEach(g => { N += g.values.length; });
        if (N < 5) {
          errorEl.textContent = 'Total sample size is too small. Please enter at least 5 observations.';
          return;
        }

        // Flatten and rank data
        const pooled = [];
        let obsCounter = 1;
        groups.forEach(g => {
          g.values.forEach(v => {
            pooled.push({
              value: v,
              groupIndex: g.index,
              groupName: g.name,
              obsId: obsCounter++
            });
          });
        });

        pooled.sort((a, b) => a.value - b.value);

        // Assign ranks with ties and collect tie counts
        const tieCounts = [];
        let i = 0;
        while (i < pooled.length) {
          let j = i + 1;
          while (j < pooled.length && Math.abs(pooled[j].value - pooled[i].value) < TOL) {
            j++;
          }
          const t = j - i;
          const rankStart = i + 1;
          const rankEnd = j;
          const avgRank = (rankStart + rankEnd) / 2;
          for (let r = i; r < j; r++) {
            pooled[r].rank = avgRank;
          }
          if (t > 1) {
            tieCounts.push(t);
          }
          i = j;
        }

        // Sum ranks per group and compute descriptive stats
        const groupStatsMap = new Map();
        groups.forEach(g => {
          groupStatsMap.set(g.index, {
            name: g.name,
            values: g.values.slice(),
            n: g.values.length,
            R: 0,
            mean: NaN,
            median: NaN,
            min: NaN,
            max: NaN
          });
        });

        pooled.forEach(obs => {
          const stats = groupStatsMap.get(obs.groupIndex);
          if (stats) {
            stats.R += obs.rank;
          }
        });

        groupStatsMap.forEach(stats => {
          const arr = stats.values.slice().sort((a, b) => a - b);
          const n = arr.length;
          stats.min = arr[0];
          stats.max = arr[n - 1];
          const sum = arr.reduce((acc, v) => acc + v, 0);
          stats.mean = sum / n;
          if (n % 2 === 1) {
            stats.median = arr[(n - 1) / 2];
          } else {
            stats.median = (arr[n / 2 - 1] + arr[n / 2]) / 2;
          }
        });

        // Compute H
        let sumR2overNi = 0;
        groupStatsMap.forEach(stats => {
          sumR2overNi += (stats.R * stats.R) / stats.n;
        });

        const H_unadjusted = (12 / (N * (N + 1))) * sumR2overNi - 3 * (N + 1);

        // Tie correction
        let C = 1;
        if (tieCheckbox.checked && tieCounts.length > 0) {
          let tieSum = 0;
          tieCounts.forEach(t => {
            tieSum += (t * t * t - t);
          });
          const denom = (N * N * N - N);
          if (Math.abs(denom) > TOL) {
            C = 1 - tieSum / denom;
          }
        }

        const H = H_unadjusted / C;

        // Degrees of freedom and p-value
        const df = k - 1;
        const p = chisqPvalue(H, df);

        // Summary outputs
        setBoxValue(hBox, formatNumber(H, 4) + (tieCheckbox.checked ? ' (corrected)' : ''));
        setBoxValue(dfBox, String(df));

        if (Number.isFinite(p)) {
          let pText;
          if (p < 0.0001) {
            pText = 'p < 0.0001';
          } else {
            pText = 'p ≈ ' + formatNumber(p, 4);
          }
          setBoxValue(pBox, pText);
        } else {
          setBoxValue(pBox, 'not available');
        }

        let decisionText = '—';
        let interpText = '';

        if (Number.isFinite(p)) {
          if (p <= alpha) {
            decisionText = 'Reject H₀ at α = ' + alpha.toString();
            interpText =
              'The Kruskal–Wallis test is statistically significant (H ≈ ' + formatNumber(H, 4) +
              ', df = ' + df + ', p ≈ ' + formatNumber(p, 4) +
              '). At least one group tends to differ from the others. ' +
              'Consider post-hoc pairwise comparisons (e.g. Dunn’s test) to identify which groups differ.';
          } else {
            decisionText = 'Do not reject H₀ at α = ' + alpha.toString();
            interpText =
              'The Kruskal–Wallis test is not statistically significant (H ≈ ' + formatNumber(H, 4) +
              ', df = ' + df + ', p ≈ ' + formatNumber(p, 4) +
              '). There is no strong evidence that the group distributions differ, ' +
              'although practical relevance and sample size should still be considered.';
          }
        } else {
          interpText =
            'The test statistic H was computed as ' + formatNumber(H, 4) +
            ', but the p-value could not be evaluated. Please check the data.';
        }

        setBoxValue(decisionBox, decisionText);
        if (interpEl) interpEl.textContent = interpText;

        // Group stats table
        groupTableBody.innerHTML = '';
        const orderedGroups = Array.from(groupStatsMap.values()).sort((a, b) => {
          const numA = Number(a.name.replace(/[^0-9]/g, '')) || 0;
          const numB = Number(b.name.replace(/[^0-9]/g, '')) || 0;
          return numA - numB;
        });

        orderedGroups.forEach(stats => {
          const tr = document.createElement('tr');
          tr.className = 'border-b';

          const tdName = document.createElement('td');
          tdName.className = 'px-3 py-1.5 text-gray-700';
          tdName.textContent = stats.name;

          const tdN = document.createElement('td');
          tdN.className = 'px-3 py-1.5 text-right text-gray-700';
          tdN.textContent = String(stats.n);

          const tdMin = document.createElement('td');
          tdMin.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMin.textContent = formatNumber(stats.min, 4);

          const tdMax = document.createElement('td');
          tdMax.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMax.textContent = formatNumber(stats.max, 4);

          const tdMean = document.createElement('td');
          tdMean.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMean.textContent = formatNumber(stats.mean, 4);

          const tdMedian = document.createElement('td');
          tdMedian.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMedian.textContent = formatNumber(stats.median, 4);

          const tdR = document.createElement('td');
          tdR.className = 'px-3 py-1.5 text-right text-gray-700';
          tdR.textContent = formatNumber(stats.R, 4);

          const tdMeanRank = document.createElement('td');
          tdMeanRank.className = 'px-3 py-1.5 text-right text-gray-700';
          tdMeanRank.textContent = formatNumber(stats.R / stats.n, 4);

          tr.appendChild(tdName);
          tr.appendChild(tdN);
          tr.appendChild(tdMin);
          tr.appendChild(tdMax);
          tr.appendChild(tdMean);
          tr.appendChild(tdMedian);
          tr.appendChild(tdR);
          tr.appendChild(tdMeanRank);

          groupTableBody.appendChild(tr);
        });

        // Detailed table
        detailsBody.innerHTML = '';
        pooled.forEach(obs => {
          const tr = document.createElement('tr');
          tr.className = 'border-b';

          const tdObs = document.createElement('td');
          tdObs.className = 'px-3 py-1.5 text-gray-700';
          tdObs.textContent = '#' + obs.obsId;

          const tdGroup = document.createElement('td');
          tdGroup.className = 'px-3 py-1.5 text-gray-700';
          tdGroup.textContent = obs.groupName;

          const tdVal = document.createElement('td');
          tdVal.className = 'px-3 py-1.5 text-right text-gray-700';
          tdVal.textContent = formatNumber(obs.value, 6);

          const tdRank = document.createElement('td');
          tdRank.className = 'px-3 py-1.5 text-right text-gray-700';
          tdRank.textContent = formatNumber(obs.rank, 4);

          tr.appendChild(tdObs);
          tr.appendChild(tdGroup);
          tr.appendChild(tdVal);
          tr.appendChild(tdRank);
          detailsBody.appendChild(tr);
        });
      }

      function clearAll() {
        const textareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        textareas.forEach(ta => { ta.value = ''; });
        clearResults();
      }

      function loadExample(name) {
        const examples = {
          'three-groups': [
            [12, 15, 9, 11, 14],
            [18, 21, 19, 17, 22],
            [8, 10, 7, 9, 6]
          ],
          'two-groups': [
            [5, 7, 6, 8, 9],
            [10, 12, 11, 13, 14]
          ]
        };

        const data = examples[name];
        if (!data) return;

        const k = data.length;
        groupsInput.value = String(k);
        createGroupInputs(k);

        const textareas = groupsContainer.querySelectorAll('textarea[data-group-index]');
        textareas.forEach(ta => {
          const idx = Number(ta.getAttribute('data-group-index'));
          const arr = data[idx];
          if (arr) {
            ta.value = arr.join(', ');
          } else {
            ta.value = '';
          }
        });

        clearResults();
      }

      // Toggle detailed table visibility
      if (detailsToggle) {
        detailsToggle.addEventListener('click', function () {
          if (!detailsWrapper) return;
          const isHidden = detailsWrapper.classList.contains('hidden');
          detailsWrapper.classList.toggle('hidden', !isHidden);
          detailsToggle.textContent = isHidden
            ? 'Hide detailed ranked data table'
            : 'Show detailed ranked data table';
        });
      }

      // Initialise group inputs
      const initialK = clampInt(groupsInput.value, 2, 10, 3);
      groupsInput.value = String(initialK);
      createGroupInputs(initialK);

      if (updateGroupsBtn) {
        updateGroupsBtn.addEventListener('click', function () {
          const k = clampInt(groupsInput.value, 2, 10, 3);
          groupsInput.value = String(k);
          createGroupInputs(k);
          clearResults();
        });
      }

      if (calcBtn) calcBtn.addEventListener('click', computeKruskalWallis);
      if (clearBtn) clearBtn.addEventListener('click', clearAll);

      exampleButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          const name = btn.getAttribute('data-example');
          if (name) loadExample(name);
        });
      });
    });
  </script>


</body></html>
