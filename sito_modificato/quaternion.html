<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Quaternion Calculator – 3D Rotations &amp; Quaternion Algebra</title>
  <meta name="description" content="Work with quaternions for 3D rotations and algebra: add, subtract, multiply, normalize, invert, build rotation quaternions from axis–angle, and rotate 3D vectors with an interactive 3D visualization. Ideal for graphics, robotics and game development.">
  <link rel="canonical" href="https://calcdomain.com/quaternion">

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    .card-hover {
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow:
        0 10px 15px -3px rgba(0,0,0,0.1),
        0 4px 6px -2px rgba(0,0,0,0.05);
    }
    .prose { max-width: 65ch; margin-left: auto; margin-right: auto; }
    .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
    .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
    .prose p { margin-bottom: 1rem; line-height: 1.6; }
    .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    .prose li { margin-bottom: 0.5rem; }
    .formula-box {
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 1rem;
      overflow-x: auto;
      margin: 1rem 0;
    }
    .muted-note {
      font-size: 0.75rem;
      color: #6b7280;
    }
    .pill-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.2rem 0.6rem;
      border-radius: 9999px;
      font-size: 0.7rem;
      font-weight: 500;
      background-color: #eff6ff;
      color: #1d4ed8;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      border-radius: 9999px;
      border: 1px solid #e5e7eb;
      padding: 0.15rem 0.6rem;
      font-size: 0.7rem;
      color: #4b5563;
      background-color: #f9fafb;
      margin-right: 0.25rem;
      margin-bottom: 0.25rem;
      cursor: default;
    }
    .chip-button {
      cursor: pointer;
    }
    .kbd {
      display: inline-block;
      padding: 0.1rem 0.3rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      background-color: #f9fafb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.7rem;
      color: #4b5563;
    }
    .badge-small {
      display: inline-flex;
      align-items: center;
      padding: 0.1rem 0.45rem;
      border-radius: 9999px;
      font-size: 0.65rem;
      font-weight: 500;
      background-color: #f3f4f6;
      color: #4b5563;
    }
    .vector-pill {
      display: inline-flex;
      align-items: baseline;
      padding: 0.1rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.7rem;
      background-color: #eff6ff;
      color: #1f2937;
      margin-right: 0.25rem;
      margin-bottom: 0.25rem;
    }
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 9999px;
      margin-right: 0.35rem;
      flex-shrink: 0;
    }
  </style>

  <!-- HEAD_SCRIPTS_E_META -->
  <!-- Google tag (gtag.js) -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
  <script>
    (function() {

      'use strict';

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7MB5V1LZRN');
  

    })();</script>

  <meta name="google-site-verification" content="_tiTZ9ivAdtXcAS9CMnTNJ549Sg39WVqP_ZFbWgglNA">

  <script>
    (function() {

      'use strict';

    window.ezstandalone = window.ezstandalone || {};
    ezstandalone.cmd = ezstandalone.cmd || [];
  

    })();</script>

  <script type="application/ld+json">
[
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://calcdomain.com"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Math & Conversions",
        "item": "https://calcdomain.com/categories/math-conversions"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "Core Math Algebra",
        "item": "https://calcdomain.com/subcategories/core-math-algebra"
      }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "Rotate a 3D vector using a quaternion",
    "description": "Step-by-step procedure to rotate a 3D vector using a unit quaternion.",
    "step": [
      {
        "@type": "HowToStep",
        "position": 1,
        "name": "Specify the rotation quaternion",
        "text": "Enter the scalar part w and vector part (x, y, z) of your unit quaternion. If your quaternion is not yet unit length, use the normalize function."
      },
      {
        "@type": "HowToStep",
        "position": 2,
        "name": "Enter the 3D vector",
        "text": "Provide the coordinates of the vector you want to rotate as (vx, vy, vz)."
      },
      {
        "@type": "HowToStep",
        "position": 3,
        "name": "Apply the rotation",
        "text": "The rotated vector is computed as v' = q · v · q*, where q* is the conjugate of q and v is embedded as a pure quaternion (0, vx, vy, vz)."
      },
      {
        "@type": "HowToStep",
        "position": 4,
        "name": "Interpret the result",
        "text": "Read the rotated coordinates and inspect the interactive 3D plot to visualise how the vector has been rotated in space."
      }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is a quaternion?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "A quaternion is a four-dimensional extension of complex numbers, usually written as q = w + xi + yj + zk with real coefficients w, x, y, z. Quaternions form a non-commutative division algebra and are widely used to represent rotations in 3D space."
        }
      },
      {
        "@type": "Question",
        "name": "Why use quaternions for 3D rotations?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Quaternions avoid gimbal lock, interpolate smoothly between orientations (slerp), and are more numerically stable than Euler angles or repeated matrix multiplications. A unit quaternion corresponds to a 3D rotation and can be applied efficiently to vectors."
        }
      },
      {
        "@type": "Question",
        "name": "What does this quaternion calculator do?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "This calculator lets you add, subtract and multiply quaternions, compute their conjugate, norm, inverse and normalized form. It can also build a rotation quaternion from an axis–angle pair, rotate 3D vectors, and visualise the rotation in an interactive 3D canvas."
        }
      },
      {
        "@type": "Question",
        "name": "How do I build a rotation quaternion from axis and angle?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Given a unit axis vector u = (ux, uy, uz) and an angle θ in radians, the corresponding unit quaternion is q = (cos(θ/2), ux sin(θ/2), uy sin(θ/2), uz sin(θ/2)). The calculator implements this formula directly from your axis and angle inputs."
        }
      },
      {
        "@type": "Question",
        "name": "Do quaternions commute under multiplication?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No. Quaternion multiplication is associative but not commutative: in general q1 · q2 ≠ q2 · q1. This is consistent with the non-commutative nature of composing 3D rotations."
        }
      },
      {
        "@type": "Question",
        "name": "Do I need a unit quaternion for rotations?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "To represent a pure rotation, the quaternion must be unit-length (norm equal to 1). The calculator provides a normalize function and an option to auto-normalize before applying a rotation, which is standard practice in graphics, robotics and simulation engines."
        }
      }
    ]
  }
]
</script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>

<body class="bg-gray-50 text-gray-800"><header id="siteHeader">
  <div class="nav container">
    <a class="brand" href="https://calcdomain.com">CalcDomain</a>
    <div class="navRight">
      <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
      <span class="pill">Categories</span>
    </div>
  </div>
</header><div class="container">
  <main style="margin:24px 0 40px;" id="mainContent">
    <h1 id="pageTitle">Quaternion Calculator</h1>
    <p class="sub" id="pageSub">Work with quaternions for 3D rotations and algebra: add, subtract, multiply, normalize, invert, build rotation quaternions from axis–angle, and rotate 3D vectors with an interactive 3D visualization. Ideal for graphics, robotics and game development.</p>
    <div id="errorBox" class="alert" role="alert" aria-live="polite"></div>

    <div class="calc-hero" id="calcHero">
      <section class="card" id="inputsCard" aria-label="Calculator inputs"><input type="search" id="search-input" placeholder="Search for a calculator..." class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off">
<div data-canon-btnrow="1" style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
<button id="calcBtn" type="button" class="btn">Calculate</button>

<button id="resetBtn" type="button" class="btn btnSecondary">Reset</button>
</div>
</section>
      <section class="card sticky-box" id="resultsCard" aria-label="Calculator results"></section>
    </div>

    <section class="card content-card" id="howToUse" aria-label="How to use and methodology">
      <h2>Full original guide (expanded)</h2>
    <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
      <div class="flex justify-between items-center">
        <a href="https://calcdomain.com" class="text-2xl font-bold text-blue-600">CalcDomain</a>
        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>
        <div class="hidden md:flex items-center space-x-6">
          <a href="https://calcdomain.com/search" class="text-gray-700 hover:text-blue-600 transition-colors">Advanced Search</a>
          <a href="https://calcdomain.com/categories" class="text-gray-700 hover:text-blue-600 transition-colors">Categories</a>
        </div>
        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open menu" type="button">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
      </div>
      <nav id="mobile-menu" class="md:hidden mt-4 hidden" aria-label="Mobile menu" role="navigation">
        <div class="mb-4">
          <div class="relative">
            <input type="search" id="mobile-search-input" placeholder="Search calculators..." class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
          </div>
        </div>
        <div class="space-y-2">
          <a href="https://calcdomain.com/search" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="https://calcdomain.com/categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </nav>
    </nav>
  </header><div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> » <a href="https://calcdomain.com/categories/math-conversions" class="hover:text-blue-600">Math &amp; Conversions</a> » <a href="https://calcdomain.com/subcategories/core-math-algebra" class="hover:text-blue-600">Core Math Algebra</a></nav>

    <div class="flex flex-col lg:flex-row gap-8">
      <!-- MAIN -->
      <main class="w-full lg:w-2/3">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="flex flex-wrap items-center gap-2 mb-3">
            <h1 class="text-2xl md:text-3xl font-bold">Quaternion Calculator</h1>
            <span class="pill-badge">3D rotations &amp; algebra</span>
          </div>
          <p class="text-gray-700 mb-3">
            Work with quaternions for 3D rotations and algebraic operations. Define quaternions, add/subtract,
            multiply, conjugate, normalize, invert, build rotation quaternions from axis–angle and rotate 3D
            vectors with an interactive 3D visualization of the original and rotated vector.
          </p>
          <div class="mb-4 flex flex-wrap gap-2">
            <span class="chip">quaternion arithmetic</span>
            <span class="chip">3D rotation</span>
            <span class="chip">axis–angle &amp; unit quaternions</span>
            <span class="chip">graphics &amp; robotics</span>
          </div>

          <!-- Calculator -->
          <section aria-labelledby="quat-arith-heading" class="mt-4 mb-8">
            <h2 id="quat-arith-heading" class="text-xl font-semibold mb-3">
              Quaternion inputs &amp; algebra
            </h2>

            <form id="quat-arithmetic-form" class="space-y-6" novalidate="">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Q1 -->
                <fieldset class="border border-gray-200 rounded-lg p-3">
                  <legend class="text-sm font-semibold text-gray-800 px-1">Quaternion q₁</legend>
                  <p class="muted-note mb-2">Form: q = w + x i + y j + z k</p>
                  <div class="grid grid-cols-4 gap-2">
                    <div>
                      <label for="q1-w" class="block text-xs font-medium text-gray-700 mb-1">w</label>
                      <input type="number" id="q1-w" step="any" value="1" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="q1-x" class="block text-xs font-medium text-gray-700 mb-1">x</label>
                      <input type="number" id="q1-x" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="q1-y" class="block text-xs font-medium text-gray-700 mb-1">y</label>
                      <input type="number" id="q1-y" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="q1-z" class="block text-xs font-medium text-gray-700 mb-1">z</label>
                      <input type="number" id="q1-z" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                  </div>
                  <p class="muted-note mt-2">
                    Typical rotation quaternions are unit length: \(\|q\| = 1\).
                  </p>
                </fieldset>

                <!-- Q2 -->
                <fieldset class="border border-gray-200 rounded-lg p-3">
                  <legend class="text-sm font-semibold text-gray-800 px-1">Quaternion q₂ (optional)</legend>
                  <p class="muted-note mb-2">For addition, subtraction or chained rotations.</p>
                  <div class="grid grid-cols-4 gap-2">
                    <div>
                      <label for="q2-w" class="block text-xs font-medium text-gray-700 mb-1">w</label>
                      <input type="number" id="q2-w" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="q2-x" class="block text-xs font-medium text-gray-700 mb-1">x</label>
                      <input type="number" id="q2-x" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="q2-y" class="block text-xs font-medium text-gray-700 mb-1">y</label>
                      <input type="number" id="q2-y" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="q2-z" class="block text-xs font-medium text-gray-700 mb-1">z</label>
                      <input type="number" id="q2-z" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                  </div>
                  <p class="muted-note mt-2">
                    Use q₂ for composing rotations (q = q₂·q₁, etc.).
                  </p>
                </fieldset>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label for="quat-operation" class="block text-xs font-medium text-gray-700 mb-1">
                    Operation
                  </label>
                  <select id="quat-operation" class="w-full border-gray-300 rounded-md px-2 py-1.5 text-sm">
                    <optgroup label="Binary operations (q₁, q₂)">
                      <option value="add">q₁ + q₂</option>
                      <option value="sub">q₁ − q₂</option>
                      <option value="mul12">q₂·q₁ (apply q₁ then q₂)</option>
                      <option value="mul21">q₁·q₂ (apply q₂ then q₁)</option>
                    </optgroup>
                    <optgroup label="Unary operations">
                      <option value="conj1">Conjugate(q₁)</option>
                      <option value="norm1">Norm(q₁)</option>
                      <option value="inv1">Inverse(q₁)</option>
                      <option value="normalize1">Normalize(q₁)</option>
                      <option value="conj2">Conjugate(q₂)</option>
                      <option value="norm2">Norm(q₂)</option>
                      <option value="inv2">Inverse(q₂)</option>
                      <option value="normalize2">Normalize(q₂)</option>
                    </optgroup>
                  </select>
                  <p class="muted-note mt-1">
                    Quaternion multiplication is not commutative: q₁·q₂ ≠ q₂·q₁ in general.
                  </p>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700 mb-1">Presets</label>
                  <div class="flex flex-wrap gap-2">
                    <button type="button" class="chip chip-button" data-preset="identity">q₁ = identity</button>
                    <button type="button" class="chip chip-button" data-preset="90z">q₁ = 90° around z</button>
                    <button type="button" class="chip chip-button" data-preset="180x">q₁ = 180° around x</button>
                  </div>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700 mb-1">Axis–angle → q₁</label>
                  <div class="grid grid-cols-4 gap-2 mb-1">
                    <input type="number" id="axis-x" step="any" value="0" class="border-gray-300 rounded-md px-2 py-1 text-xs" placeholder="ux">
                    <input type="number" id="axis-y" step="any" value="0" class="border-gray-300 rounded-md px-2 py-1 text-xs" placeholder="uy">
                    <input type="number" id="axis-z" step="any" value="1" class="border-gray-300 rounded-md px-2 py-1 text-xs" placeholder="uz">
                    <input type="number" id="axis-angle-deg" step="any" value="90" class="border-gray-300 rounded-md px-2 py-1 text-xs" placeholder="deg">
                  </div>
                  <button type="button" id="btn-axis-to-q1" class="inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-800 text-xs font-medium rounded-md hover:bg-gray-200">
                    Build q₁ from axis–angle
                  </button>
                  <p class="muted-note mt-1">
                    Uses q = (cos(θ/2), u·sin(θ/2)).
                  </p>
                </div>
              </div>

              <div class="flex flex-wrap gap-3 pt-2">
                <button type="submit" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  Compute quaternion result
                </button>
                <button type="button" id="quat-arith-reset" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md shadow-sm hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
                  Reset
                </button>
              </div>
            </form>

            <div id="quat-error" class="mt-4 text-sm text-red-600 hidden"></div>

            <div id="quat-arith-results" class="mt-5 hidden border border-gray-200 rounded-lg p-4">
              <h3 class="text-md font-semibold text-gray-900 mb-2">Quaternion algebra results</h3>
              <p id="quat-result-text" class="text-sm text-gray-800 mb-1"></p>
              <p id="quat-result-norm" class="text-xs text-gray-700 mb-1"></p>
              <p id="quat-result-notes" class="muted-note"></p>
            </div>
          </section>

          <!-- Rotation + 3D visualisation -->
          <section aria-labelledby="quat-rotation-heading" class="mt-8 mb-10">
            <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
              <h2 id="quat-rotation-heading" class="text-xl font-semibold">
                3D rotation with quaternion &amp; interactive visualisation
              </h2>
              <span class="badge-small">Unit quaternion required for pure rotation</span>
            </div>

            <form id="quat-rotation-form" class="space-y-4" novalidate="">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <fieldset class="border border-gray-200 rounded-lg p-3">
                  <legend class="text-sm font-semibold text-gray-800 px-1">Rotation quaternion q<sub>rot</sub></legend>
                  <p class="muted-note mb-2">
                    You can reuse q₁ above, or type directly.
                  </p>
                  <div class="grid grid-cols-4 gap-2">
                    <div>
                      <label for="qr-w" class="block text-xs font-medium text-gray-700 mb-1">w</label>
                      <input type="number" id="qr-w" step="any" value="0.70710678" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="qr-x" class="block text-xs font-medium text-gray-700 mb-1">x</label>
                      <input type="number" id="qr-x" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="qr-y" class="block text-xs font-medium text-gray-700 mb-1">y</label>
                      <input type="number" id="qr-y" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="qr-z" class="block text-xs font-medium text-gray-700 mb-1">z</label>
                      <input type="number" id="qr-z" step="any" value="0.70710678" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                  </div>
                  <div class="flex items-center gap-2 mt-2">
                    <input id="qr-auto-normalize" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked="">
                    <label for="qr-auto-normalize" class="text-xs text-gray-700">
                      Auto-normalize q<sub>rot</sub> before rotating
                    </label>
                  </div>
                  <button type="button" id="btn-copy-q1-to-qr" class="mt-2 inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-800 text-xs font-medium rounded-md hover:bg-gray-200">
                    Copy q₁ → q<sub>rot</sub>
                  </button>
                </fieldset>

                <fieldset class="border border-gray-200 rounded-lg p-3">
                  <legend class="text-sm font-semibold text-gray-800 px-1">Vector to rotate v</legend>
                  <p class="muted-note mb-2">
                    3D vector v = (v<sub>x</sub>, v<sub>y</sub>, v<sub>z</sub>).
                  </p>
                  <div class="grid grid-cols-3 gap-2">
                    <div>
                      <label for="v-x" class="block text-xs font-medium text-gray-700 mb-1">v<sub>x</sub></label>
                      <input type="number" id="v-x" step="any" value="1" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="v-y" class="block text-xs font-medium text-gray-700 mb-1">v<sub>y</sub></label>
                      <input type="number" id="v-y" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                    <div>
                      <label for="v-z" class="block text-xs font-medium text-gray-700 mb-1">v<sub>z</sub></label>
                      <input type="number" id="v-z" step="any" value="0" class="w-full border-gray-300 rounded-md px-2 py-1 text-sm">
                    </div>
                  </div>
                  <div class="flex flex-wrap gap-2 mt-2">
                    <button type="button" class="chip chip-button" data-vpreset="x">v = (1, 0, 0)</button>
                    <button type="button" class="chip chip-button" data-vpreset="y">v = (0, 1, 0)</button>
                    <button type="button" class="chip chip-button" data-vpreset="z">v = (0, 0, 1)</button>
                    <button type="button" class="chip chip-button" data-vpreset="diag">v = (1, 1, 1)</button>
                  </div>
                </fieldset>
              </div>

              <div class="flex flex-wrap gap-3 pt-1">
                <button type="submit" class="inline-flex items-center px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
                  Rotate vector &amp; update 3D view
                </button>
                <button type="button" id="quat-rotation-reset" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md shadow-sm hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
                  Reset rotation
                </button>
              </div>
            </form>

            <div id="quat-rotation-error" class="mt-4 text-sm text-red-600 hidden"></div>

            <div class="mt-5 border border-gray-200 rounded-lg p-4">
              <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
                <div>
                  <h3 class="text-md font-semibold text-gray-900">Rotated vector &amp; rotation matrix</h3>
                  <p id="quat-rotation-result" class="text-sm text-gray-800 mt-1"></p>
                </div>
                <div class="text-xs text-gray-700">
                  <div class="flex items-center mb-1">
                    <span class="legend-dot" style="background-color:#9ca3af;"></span>
                    <span>Original vector v</span>
                  </div>
                  <div class="flex items-center">
                    <span class="legend-dot" style="background-color:#dc2626;"></span>
                    <span>Rotated vector v′</span>
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 items-start">
                <div>
                  <canvas id="quat-canvas" width="360" height="260" class="w-full border border-gray-200 rounded-md bg-white"></canvas>
                  <p class="muted-note mt-1">
                    Simple orthographic-like projection. Rotate around different axes to see the path from v to v′.
                  </p>
                </div>
                <div>
                  <h4 class="text-sm font-semibold text-gray-900 mb-2">Rotation matrix R (3×3) equivalent to q<sub>rot</sub></h4>
                  <div id="quat-rotation-matrix" class="text-xs text-gray-800 space-y-1"></div>
                  <div class="mt-3">
                    <span class="vector-pill">v′ = R · v</span>
                    <p class="muted-note mt-1">
                      For a unit quaternion q = (w, x, y, z), the matrix R is orthogonal with determinant 1, so it preserves lengths and angles.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Explanatory content -->
          <section class="prose prose-sm md:prose-base mt-10">
            <h2>What is a quaternion?</h2>
            <p>
              A quaternion is a hyper-complex number of the form
              \[
                q = w + x \mathbf{i} + y \mathbf{j} + z \mathbf{k},
              \]
              where \(w, x, y, z \in \mathbb{R}\) and \(\mathbf{i}, \mathbf{j}, \mathbf{k}\) satisfy
              \(\mathbf{i}^2 = \mathbf{j}^2 = \mathbf{k}^2 = \mathbf{ijk} = -1\).
              Quaternions extend complex numbers and form a non-commutative division algebra.
            </p>

            <div class="formula-box text-sm">
              <p class="font-semibold mb-2">Basic quaternion operations</p>
              <ul>
                <li><strong>Addition</strong>: component-wise — \(q_1 + q_2 = (w_1 + w_2,\; x_1 + x_2,\; y_1 + y_2,\; z_1 + z_2)\).</li>
                <li><strong>Conjugate</strong>: \(\overline{q} = (w,\; -x,\; -y,\; -z)\).</li>
                <li><strong>Norm</strong>: \(\|q\| = \sqrt{w^2 + x^2 + y^2 + z^2}\).</li>
                <li><strong>Inverse</strong>: for \(q \neq 0\), \(q^{-1} = \overline{q} / \|q\|^2\).</li>
              </ul>
              <p class="mt-1">
                Multiplication is more involved but encodes rotation when \(\|q\| = 1\).
              </p>
            </div>

            <h2>Quaternions and 3D rotations</h2>
            <p>
              A unit quaternion (\(\|q\| = 1\)) can represent a 3D rotation. Given an axis–angle pair
              (a unit axis \( \mathbf{u} = (u_x,u_y,u_z)\) and angle \(\theta\)):
            </p>
            <p>
              \[
                q = \left(\cos\frac{\theta}{2},\; u_x \sin\frac{\theta}{2},\; u_y \sin\frac{\theta}{2},\; u_z \sin\frac{\theta}{2}\right).
              \]
            </p>
            <p>
              To rotate a vector \(\mathbf{v} = (v_x,v_y,v_z)\), embed it as a pure quaternion
              \(p = (0, v_x, v_y, v_z)\) and compute:
            </p>
            <p>
              \[
                p' = q \, p \, q^{-1}.
              \]
              The rotated vector is the imaginary part of \(p'\).
            </p>

            <h2>Rotation matrix from quaternion</h2>
            <p>
              For a unit quaternion \(q = (w,x,y,z)\), the corresponding \(3\times3\) rotation matrix is
            </p>
            <p>
              \[
              R =
              \begin{bmatrix}
              1 - 2(y^2 + z^2) &amp; 2(xy - wz) &amp; 2(xz + wy) \\
              2(xy + wz) &amp; 1 - 2(x^2 + z^2) &amp; 2(yz - wx) \\
              2(xz - wy) &amp; 2(yz + wx) &amp; 1 - 2(x^2 + y^2)
              \end{bmatrix}.
              \]
            </p>
            <p>
              The calculator uses this matrix internally to show the linear map \( \mathbf{v}' = R\mathbf{v} \)
              alongside the direct quaternion formula.
            </p>

            <h2>Typical applications</h2>
            <ul>
              <li><strong>Game development &amp; graphics</strong>: camera orientation, character bones, camera rigs.</li>
              <li><strong>Robotics &amp; drones</strong>: attitude representation, sensor fusion, control loops.</li>
              <li><strong>Simulation &amp; physics</strong>: rigid body orientation and numerical integration of angular velocity.</li>
              <li><strong>Interpolation</strong>: smooth orientation interpolation using slerp between two unit quaternions.</li>
            </ul>

            <h2>Related algebra &amp; 3D math tools</h2>
            <ul>
              <li><a href="https://calcdomain.com/complex-number">Complex Number Calculator</a></li>
              <li><a href="https://calcdomain.com/boolean-algebra">Boolean Algebra Calculator</a></li>
              <li><a href="https://calcdomain.com/covariance-matrix">Covariance Matrix</a></li>
              <li><a href="https://calcdomain.com/qr-decomposition">QR Decomposition</a></li>
              <li><a href="https://calcdomain.com/fft">Fast Fourier Transform (FFT)</a></li>
              <li><a href="https://calcdomain.com/geometric-sequence">Geometric Sequence</a></li>
            </ul>
          </section>
        </div>
      
<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[q = w + x \mathbf{i} + y \mathbf{j} + z \mathbf{k},\]</div>
  <pre class="auditspine-mono">q = w + x \mathbf{i} + y \mathbf{j} + z \mathbf{k},</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[q = \left(\cos\frac{\theta}{2},\; u_x \sin\frac{\theta}{2},\; u_y \sin\frac{\theta}{2},\; u_z \sin\frac{\theta}{2}\right).\]</div>
  <pre class="auditspine-mono">q = \left(\cos\frac{\theta}{2},\; u_x \sin\frac{\theta}{2},\; u_y \sin\frac{\theta}{2},\; u_z \sin\frac{\theta}{2}\right).</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[p' = q \, p \, q^{-1}.\]</div>
  <pre class="auditspine-mono">p' = q \, p \, q^{-1}.</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[R = \begin{bmatrix} 1 - 2(y^2 + z^2) &amp; 2(xy - wz) &amp; 2(xz + wy) \\ 2(xy + wz) &amp; 1 - 2(x^2 + z^2) &amp; 2(yz - wx) \\ 2(xz - wy) &amp; 2(yz + wx) &amp; 1 - 2(x^2 + y^2) \end{bmatrix}.\]</div>
  <pre class="auditspine-mono">R = \begin{bmatrix} 1 - 2(y^2 + z^2) &amp; 2(xy - wz) &amp; 2(xz + wy) \\ 2(xy + wz) &amp; 1 - 2(x^2 + z^2) &amp; 2(yz - wx) \\ 2(xz - wy) &amp; 2(yz + wx) &amp; 1 - 2(x^2 + y^2) \end{bmatrix}.</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\\]</div>
  <pre class="auditspine-mono">','\</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">Basic quaternion operations Addition: component-wise — \(q_1 + q_2 = (w_1 + w_2,\; x_1 + x_2,\; y_1 + y_2,\; z_1 + z_2)\). Conjugate: \(\overline{q} = (w,\; -x,\; -y,\; -z)\). Norm: \(\|q\| = \sqrt{w^2 + x^2 + y^2 + z^2}\). Inverse: for \(q \neq 0\), \(q^{-1} = \overline{q} / \|q\|^2\). Multiplication is more involved but encodes rotation when \(\|q\| = 1\).</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><em>No variables provided in audit spec.</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Complex Number Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/complex-number" target="_blank" rel="nofollow noopener">https://calcdomain.com/complex-number</a></li>
<li><strong>Boolean Algebra Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/boolean-algebra" target="_blank" rel="nofollow noopener">https://calcdomain.com/boolean-algebra</a></li>
<li><strong>Covariance Matrix</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/covariance-matrix" target="_blank" rel="nofollow noopener">https://calcdomain.com/covariance-matrix</a></li>
<li><strong>QR Decomposition</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/qr-decomposition" target="_blank" rel="nofollow noopener">https://calcdomain.com/qr-decomposition</a></li>
<li><strong>Fast Fourier Transform (FFT)</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/fft" target="_blank" rel="nofollow noopener">https://calcdomain.com/fft</a></li>
<li><strong>Geometric Sequence</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/geometric-sequence" target="_blank" rel="nofollow noopener">https://calcdomain.com/geometric-sequence</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->


</main>

      <!-- SIDEBAR -->
      <aside class="w-full lg:w-1/3">
        <div class="bg-white p-4 rounded-lg shadow-md mb-6">
          <h2 class="text-lg font-semibold mb-3">More in Core Math &amp; Algebra</h2>
          <ul class="space-y-2 text-sm">
            <li><a href="https://calcdomain.com/covariance-matrix" class="text-blue-600 hover:underline">Covariance Matrix</a></li>
            <li><a href="https://calcdomain.com/qr-decomposition" class="text-blue-600 hover:underline">QR Decomposition</a></li>
            <li><a href="https://calcdomain.com/fft" class="text-blue-600 hover:underline">FFT – Fast Fourier Transform</a></li>
            <li><a href="https://calcdomain.com/boolean-algebra" class="text-blue-600 hover:underline">Boolean Algebra</a></li>
            <li><a href="https://calcdomain.com/geometric-sequence" class="text-blue-600 hover:underline">Geometric Sequence</a></li>
            <li><a href="https://calcdomain.com/quaternion" class="text-blue-600 hover:underline font-semibold">Quaternion</a></li>
            <li><a href="https://calcdomain.com/linear-transformation" class="text-blue-600 hover:underline">Linear Transformation</a></li>
            <li><a href="https://calcdomain.com/eulers-totient-function" class="text-blue-600 hover:underline">Euler's Totient Function</a></li>
            <li><a href="https://calcdomain.com/permutation-and-combination" class="text-blue-600 hover:underline">Permutation &amp; Combination</a></li>
            <li><a href="https://calcdomain.com/remainder" class="text-blue-600 hover:underline">Remainder Calculator</a></li>
            <li><a href="https://calcdomain.com/basic-arithmetic" class="text-blue-600 hover:underline">Basic Arithmetic</a></li>
          </ul>
        </div>

        <div class="bg-white p-4 rounded-lg shadow-md">
          <h2 class="text-lg font-semibold mb-3">Quaternion checklist for practitioners</h2>
          <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
            <li>Normalise quaternions regularly when using them as rotations.</li>
            <li>Remember that quaternion multiplication is not commutative.</li>
            <li>Store quaternions as (w, x, y, z) consistently across your codebase.</li>
            <li>Use axis–angle to design intuitive rotations, then convert to quaternions.</li>
            <li>For interpolation, prefer slerp over linear interpolation in component space.</li>
          </ul>
        </div>
      </aside>
    </div>
  </div><footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                                                                                                                                                                                        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction &amp; DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health &amp; Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle &amp; Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math &amp; Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>© 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer></section>

    <section class="meta-section" id="pageMeta" aria-label="Verification, changelog, formulas, citations">
  <details id="formulaDetails">
    <summary style="cursor:pointer; font-weight:700; color:var(--text)">Formulas</summary>
    <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
      <p style="margin:0;">(Formulas preserved from original page content, if present.)</p>
    </div>
  </details>

  

  

  <div class="badge-row" id="badgeRow">
    <div class="badge" id="versionBadge">Version 0.1.0-draft</div>
  </div>

<details id="citationDetails" style="margin-top:10px;">
  <summary style="cursor:pointer; font-weight:700; color:var(--text)">Citations</summary>
  <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
    <p style="margin:0;">Add authoritative sources relevant to this calculator (standards bodies, manuals, official docs).</p>
  </div>
</details>

<details id="changelogDetails" style="margin-top:10px;">
  <summary style="cursor:pointer; font-weight:700; color:var(--text)">Changelog</summary>
  <div style="margin-top:12px; padding:12px; background:#fff; border:1px solid var(--line); border-radius:8px;">
    <ul style="padding-left:18px; margin:0;">
      <li>0.1.0-draft — 2026-01-19: Initial draft (review required).</li>
    </ul>
  </div>
</details>
</section>
  </main>
</div><footer id="siteFooter" class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
      <p>© 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer><script src="/assets/js/script_menu.js" defer=""></script><script src="/assets/js/script_faq.js" defer=""></script><script src="search.js" defer=""></script><script>
    (function() {

      'use strict';

    window.MathJax = { tex: { inlineMath: [['\\(','\\)'], [',
      svg: { fontCache: 'global' }
    };
  

    })();</script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><script>
    (function() {

      'use strict';

    (function () {
      function $(id) { return document.getElementById(id); }
      function show(el) { el && el.classList.remove('hidden'); }
      function hide(el) { el && el.classList.add('hidden'); }
      function num(v, def) {
        var n = parseFloat(v);
        return Number.isFinite(n) ? n : def;
      }

      // Mobile menu
      var toggle = document.getElementById('mobile-menu-toggle');
      var mobileMenu = document.getElementById('mobile-menu');
      if (toggle && mobileMenu) {
        toggle.addEventListener('click', function () {
          var isHidden = mobileMenu.classList.contains('hidden');
          if (isHidden) {
            mobileMenu.classList.remove('hidden');
            toggle.setAttribute('aria-expanded', 'true');
          } else {
            mobileMenu.classList.add('hidden');
            toggle.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // Quaternion helpers
      function quat(w, x, y, z) {
        return { w: w, x: x, y: y, z: z };
      }
      function quatAdd(a, b) {
        return quat(a.w + b.w, a.x + b.x, a.y + b.y, a.z + b.z);
      }
      function quatSub(a, b) {
        return quat(a.w - b.w, a.x - b.x, a.y - b.y, a.z - b.z);
      }
      function quatMul(a, b) {
        // a * b (Hamilton product)
        return quat(
          a.w*b.w - a.x*b.x - a.y*b.y - a.z*b.z,
          a.w*b.x + a.x*b.w + a.y*b.z - a.z*b.y,
          a.w*b.y - a.x*b.z + a.y*b.w + a.z*b.x,
          a.w*b.z + a.x*b.y - a.y*b.x + a.z*b.w
        );
      }
      function quatConj(q) {
        return quat(q.w, -q.x, -q.y, -q.z);
      }
      function quatNorm(q) {
        return Math.sqrt(q.w*q.w + q.x*q.x + q.y*q.y + q.z*q.z);
      }
      function quatNormalize(q) {
        var n = quatNorm(q);
        if (n === 0) return quat(0, 0, 0, 0);
        return quat(q.w/n, q.x/n, q.y/n, q.z/n);
      }
      function quatInv(q) {
        var n2 = q.w*q.w + q.x*q.x + q.y*q.y + q.z*q.z;
        if (n2 === 0) return null;
        var c = quatConj(q);
        return quat(c.w/n2, c.x/n2, c.y/n2, c.z/n2);
      }

      function vec(x, y, z) { return { x: x, y: y, z: z }; }
      function vecLength(v) { return Math.sqrt(v.x*v.x + v.y*v.y + v.z*v.z); }
      function vecNormalize(v) {
        var n = vecLength(v);
        if (n === 0) return vec(0, 0, 0);
        return vec(v.x/n, v.y/n, v.z/n);
      }

      function quatFromAxisAngle(axis, deg) {
        var theta = deg * Math.PI / 180;
        var u = vecNormalize(axis);
        var half = theta / 2;
        var s = Math.sin(half);
        return quat(Math.cos(half), u.x * s, u.y * s, u.z * s);
      }

      // Rotate vector v by unit quaternion q
      function rotateVectorByQuat(q, v) {
        // Efficient formula: v' = v + 2 * w * (q_vec × v) + 2 * (q_vec × (q_vec × v))
        var vx = v.x, vy = v.y, vz = v.z;
        var qx = q.x, qy = q.y, qz = q.z, qw = q.w;

        // t = 2 * (q_vec × v)
        var tx = 2 * (qy * vz - qz * vy);
        var ty = 2 * (qz * vx - qx * vz);
        var tz = 2 * (qx * vy - qy * vx);

        return {
          x: vx + qw * tx + (qy * tz - qz * ty),
          y: vy + qw * ty + (qz * tx - qx * tz),
          z: vz + qw * tz + (qx * ty - qy * tx)
        };
      }

      // Rotation matrix from unit quaternion
      function rotationMatrixFromQuat(q) {
        var w = q.w, x = q.x, y = q.y, z = q.z;
        var ww = w*w, xx = x*x, yy = y*y, zz = z*z;
        return [
          [1 - 2*(yy + zz), 2*(x*y - w*z),   2*(x*z + w*y)],
          [2*(x*y + w*z),   1 - 2*(xx + zz), 2*(y*z - w*x)],
          [2*(x*z - w*y),   2*(y*z + w*x),   1 - 2*(xx + yy)]
        ];
      }

      // Read quaternions from inputs
      function readQ(prefix) {
        return quat(
          num($(prefix + '-w').value, 0),
          num($(prefix + '-x').value, 0),
          num($(prefix + '-y').value, 0),
          num($(prefix + '-z').value, 0)
        );
      }
      function writeQ(prefix, q) {
        $(prefix + '-w').value = q.w;
        $(prefix + '-x').value = q.x;
        $(prefix + '-y').value = q.y;
        $(prefix + '-z').value = q.z;
      }

      // Arithmetic form
      var arithForm = $('quat-arithmetic-form');
      var arithError = $('quat-error');
      var arithRes = $('quat-arith-results');
      var resText = $('quat-result-text');
      var resNorm = $('quat-result-norm');
      var resNotes = $('quat-result-notes');

      function qToString(q) {
        return 'q = (' + q.w.toFixed(6) + ', ' +
                        q.x.toFixed(6) + ', ' +
                        q.y.toFixed(6) + ', ' +
                        q.z.toFixed(6) + ')';
      }

      function handleArithSubmit(e) {
        e.preventDefault();
        hide(arithError);
        hide(arithRes);
        resText.textContent = '';
        resNorm.textContent = '';
        resNotes.textContent = '';

        var q1 = readQ('q1');
        var q2 = readQ('q2');
        var op = $('quat-operation').value;
        var result = null;
        var extraNote = '';

        try {
          switch (op) {
            case 'add':
              result = quatAdd(q1, q2);
              extraNote = 'Component-wise sum of q₁ and q₂.';
              break;
            case 'sub':
              result = quatSub(q1, q2);
              extraNote = 'Component-wise difference q₁ − q₂.';
              break;
            case 'mul12':
              result = quatMul(q2, q1);
              extraNote = 'q₂·q₁ corresponds to applying q₁ followed by q₂.';
              break;
            case 'mul21':
              result = quatMul(q1, q2);
              extraNote = 'q₁·q₂ corresponds to applying q₂ followed by q₁.';
              break;
            case 'conj1':
              result = quatConj(q1);
              extraNote = 'Quaternion conjugate of q₁.';
              break;
            case 'norm1':
              var n1 = quatNorm(q1);
              resText.textContent = '‖q₁‖ = ' + n1.toFixed(9);
              resNotes.textContent = 'Norm is the square root of the sum of squared components.';
              show(arithRes);
              return;
            case 'inv1':
              var inv1 = quatInv(q1);
              if (!inv1) throw new Error('q₁ has zero norm and is not invertible.');
              result = inv1;
              extraNote = 'Inverse q₁⁻¹ = conj(q₁) / ‖q₁‖².';
              break;
            case 'normalize1':
              result = quatNormalize(q1);
              extraNote = 'Normalised q₁ so that ‖q₁‖ = 1 (or 0 if q₁ was zero).';
              break;
            case 'conj2':
              result = quatConj(q2);
              extraNote = 'Quaternion conjugate of q₂.';
              break;
            case 'norm2':
              var n2 = quatNorm(q2);
              resText.textContent = '‖q₂‖ = ' + n2.toFixed(9);
              resNotes.textContent = 'Norm is the square root of the sum of squared components.';
              show(arithRes);
              return;
            case 'inv2':
              var inv2 = quatInv(q2);
              if (!inv2) throw new Error('q₂ has zero norm and is not invertible.');
              result = inv2;
              extraNote = 'Inverse q₂⁻¹ = conj(q₂) / ‖q₂‖².';
              break;
            case 'normalize2':
              result = quatNormalize(q2);
              extraNote = 'Normalised q₂ so that ‖q₂‖ = 1 (or 0 if q₂ was zero).';
              break;
            default:
              throw new Error('Unknown operation.');
          }
        } catch (ex) {
          arithError.textContent = ex.message;
          show(arithError);
          return;
        }

        if (result) {
          var n = quatNorm(result);
          resText.textContent = qToString(result);
          resNorm.textContent = '‖q‖ = ' + n.toFixed(9);
          resNotes.textContent = extraNote;
          show(arithRes);
        }
      }

      // Presets
      function applyPreset(name) {
        if (name === 'identity') {
          writeQ('q1', quat(1, 0, 0, 0));
        } else if (name === '90z') {
          // 90 deg around z: (cos 45°, 0,0,sin45°)
          writeQ('q1', quat(Math.SQRT1_2, 0, 0, Math.SQRT1_2));
        } else if (name === '180x') {
          // 180 deg around x: (0,1,0,0)
          writeQ('q1', quat(0, 1, 0, 0));
        }
      }

      function applyVectorPreset(name) {
        if (name === 'x') {
          $('v-x').value = 1; $('v-y').value = 0; $('v-z').value = 0;
        } else if (name === 'y') {
          $('v-x').value = 0; $('v-y').value = 1; $('v-z').value = 0;
        } else if (name === 'z') {
          $('v-x').value = 0; $('v-y').value = 0; $('v-z').value = 1;
        } else if (name === 'diag') {
          $('v-x').value = 1; $('v-y').value = 1; $('v-z').value = 1;
        }
      }

      // Axis → q1 button
      function handleAxisToQ1() {
        var ax = num($('axis-x').value, 0);
        var ay = num($('axis-y').value, 0);
        var az = num($('axis-z').value, 1);
        var deg = num($('axis-angle-deg').value, 0);
        var axis = vec(ax, ay, az);
        var n = vecLength(axis);
        if (n === 0) {
          alert('Axis vector must be non-zero.');
          return;
        }
        var q = quatFromAxisAngle(axis, deg);
        writeQ('q1', q);
      }

      // Rotation form & 3D canvas
      var rotationForm = $('quat-rotation-form');
      var rotationError = $('quat-rotation-error');
      var rotationResult = $('quat-rotation-result');
      var rotationMatrixOut = $('quat-rotation-matrix');
      var canvas = $('quat-canvas');
      var ctx = canvas && canvas.getContext ? canvas.getContext('2d') : null;

      var currentOriginal = vec(1, 0, 0);
      var currentRotated = null;

      function projectPoint(p) {
        var w = canvas.width;
        var h = canvas.height;
        var cx = w / 2;
        var cy = h / 2;
        var zOffset = 3.0;
        var scale = Math.min(w, h) * 0.28;
        var denom = (p.z + zOffset);
        if (denom === 0) denom = 0.0001;
        var x2d = cx + scale * p.x / denom;
        var y2d = cy - scale * p.y / denom;
        return { x: x2d, y: y2d };
      }

      function drawArrow(from, to, color) {
        var p0 = projectPoint(from);
        var p1 = projectPoint(to);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(p0.x, p0.y);
        ctx.lineTo(p1.x, p1.y);
        ctx.stroke();

        var dx = p1.x - p0.x;
        var dy = p1.y - p0.y;
        var len = Math.sqrt(dx*dx + dy*dy) || 1;
        var ux = dx / len, uy = dy / len;
        var size = 7;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p1.x - size*(ux + uy*0.4), p1.y - size*(uy - ux*0.4));
        ctx.lineTo(p1.x - size*(ux - uy*0.4), p1.y - size*(uy + ux*0.4));
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
      }

      function drawAxes() {
        // axes from origin
        var origin = vec(0, 0, 0);
        drawArrow(origin, vec(1, 0, 0), '#2563eb'); // x
        drawArrow(origin, vec(0, 1, 0), '#16a34a'); // y
        drawArrow(origin, vec(0, 0, 1), '#f59e0b'); // z
      }

      function drawScene() {
        if (!ctx || !canvas) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // background grid
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        ctx.globalAlpha = 0.9;
        drawAxes();
        ctx.restore();

        // Original vector v (grey)
        if (currentOriginal) {
          ctx.save();
          drawArrow(vec(0,0,0), currentOriginal, '#9ca3af');
          ctx.restore();
        }
        // Rotated vector v' (red)
        if (currentRotated) {
          ctx.save();
          drawArrow(vec(0,0,0), currentRotated, '#dc2626');
          ctx.restore();
        }
      }

      function renderMatrix(matrix) {
        rotationMatrixOut.innerHTML = '';
        if (!matrix) return;
        matrix.forEach(function (row) {
          var line = document.createElement('div');
          line.textContent = '[' +
            row.map(function (v) { return v.toFixed(6); }).join(', ') +
            ']';
          rotationMatrixOut.appendChild(line);
        });
      }

      function handleRotationSubmit(e) {
        e.preventDefault();
        hide(rotationError);
        rotationResult.textContent = '';
        renderMatrix(null);
        currentRotated = null;

        var qr = quat(
          num($('qr-w').value, 0),
          num($('qr-x').value, 0),
          num($('qr-y').value, 0),
          num($('qr-z').value, 0)
        );
        var v = vec(
          num($('v-x').value, 0),
          num($('v-y').value, 0),
          num($('v-z').value, 0)
        );
        currentOriginal = v;

        var autoNorm = $('qr-auto-normalize').checked;
        var qrUsed = qr;
        var nqr = quatNorm(qr);
        if (autoNorm) {
          qrUsed = quatNormalize(qr);
        } else if (Math.abs(nqr - 1) > 1e-6) {
          rotationError.textContent = 'Warning: q_rot is not unit length. The rotation may include scaling. Enable auto-normalise for pure rotations.';
          show(rotationError);
        }

        var vRot = rotateVectorByQuat(qrUsed, v);
        currentRotated = vRot;
        drawScene();

        rotationResult.innerHTML =
          '<span class="vector-pill">v = (' + v.x.toFixed(4) + ', ' + v.y.toFixed(4) + ', ' + v.z.toFixed(4) + ')</span>' +
          '<span class="vector-pill">v′ = (' + vRot.x.toFixed(4) + ', ' + vRot.y.toFixed(4) + ', ' + vRot.z.toFixed(4) + ')</span>';

        var R = rotationMatrixFromQuat(qrUsed);
        renderMatrix(R);
      }

      function handleRotationReset() {
        hide(rotationError);
        rotationResult.textContent = '';
        renderMatrix(null);
        $('qr-w').value = '0.70710678';
        $('qr-x').value = '0';
        $('qr-y').value = '0';
        $('qr-z').value = '0.70710678';
        $('qr-auto-normalize').checked = true;
        $('v-x').value = '1';
        $('v-y').value = '0';
        $('v-z').value = '0';
        currentOriginal = vec(1,0,0);
        currentRotated = null;
        drawScene();
      }

      function copyQ1ToQr() {
        var q1 = readQ('q1');
        writeQ('qr', q1);
      }

      // Event wiring
      document.addEventListener('DOMContentLoaded', function () {
        if (arithForm) {
          arithForm.addEventListener('submit', handleArithSubmit);
        }
        var arithReset = $('quat-arith-reset');
        if (arithReset) {
          arithReset.addEventListener('click', function () {
            arithForm.reset();
            $('q1-w').value = 1;
            $('q1-x').value = 0;
            $('q1-y').value = 0;
            $('q1-z').value = 0;
            hide(arithError);
            hide(arithRes);
          });
        }

        document.querySelectorAll('.chip-button[data-preset]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            applyPreset(btn.getAttribute('data-preset'));
          });
        });
        document.querySelectorAll('.chip-button[data-vpreset]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            applyVectorPreset(btn.getAttribute('data-vpreset'));
          });
        });

        var axisBtn = $('btn-axis-to-q1');
        if (axisBtn) axisBtn.addEventListener('click', handleAxisToQ1);

        if (rotationForm) {
          rotationForm.addEventListener('submit', handleRotationSubmit);
        }
        var rotReset = $('quat-rotation-reset');
        if (rotReset) rotReset.addEventListener('click', handleRotationReset);

        var copyBtn = $('btn-copy-q1-to-qr');
        if (copyBtn) copyBtn.addEventListener('click', copyQ1ToQr);

        // Init canvas
        if (canvas && ctx) {
          drawScene();
        }
      });
    })();
  

    })();</script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><script>
    (function() {

      'use strict';

    (function () {
      function $(id) { return document.getElementById(id); }
      function show(el) { el && el.classList.remove('hidden'); }
      function hide(el) { el && el.classList.add('hidden'); }
      function num(v, def) {
        var n = parseFloat(v);
        return Number.isFinite(n) ? n : def;
      }

      // Mobile menu
      var toggle = document.getElementById('mobile-menu-toggle');
      var mobileMenu = document.getElementById('mobile-menu');
      if (toggle && mobileMenu) {
        toggle.addEventListener('click', function () {
          var isHidden = mobileMenu.classList.contains('hidden');
          if (isHidden) {
            mobileMenu.classList.remove('hidden');
            toggle.setAttribute('aria-expanded', 'true');
          } else {
            mobileMenu.classList.add('hidden');
            toggle.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // Quaternion helpers
      function quat(w, x, y, z) {
        return { w: w, x: x, y: y, z: z };
      }
      function quatAdd(a, b) {
        return quat(a.w + b.w, a.x + b.x, a.y + b.y, a.z + b.z);
      }
      function quatSub(a, b) {
        return quat(a.w - b.w, a.x - b.x, a.y - b.y, a.z - b.z);
      }
      function quatMul(a, b) {
        // a * b (Hamilton product)
        return quat(
          a.w*b.w - a.x*b.x - a.y*b.y - a.z*b.z,
          a.w*b.x + a.x*b.w + a.y*b.z - a.z*b.y,
          a.w*b.y - a.x*b.z + a.y*b.w + a.z*b.x,
          a.w*b.z + a.x*b.y - a.y*b.x + a.z*b.w
        );
      }
      function quatConj(q) {
        return quat(q.w, -q.x, -q.y, -q.z);
      }
      function quatNorm(q) {
        return Math.sqrt(q.w*q.w + q.x*q.x + q.y*q.y + q.z*q.z);
      }
      function quatNormalize(q) {
        var n = quatNorm(q);
        if (n === 0) return quat(0, 0, 0, 0);
        return quat(q.w/n, q.x/n, q.y/n, q.z/n);
      }
      function quatInv(q) {
        var n2 = q.w*q.w + q.x*q.x + q.y*q.y + q.z*q.z;
        if (n2 === 0) return null;
        var c = quatConj(q);
        return quat(c.w/n2, c.x/n2, c.y/n2, c.z/n2);
      }

      function vec(x, y, z) { return { x: x, y: y, z: z }; }
      function vecLength(v) { return Math.sqrt(v.x*v.x + v.y*v.y + v.z*v.z); }
      function vecNormalize(v) {
        var n = vecLength(v);
        if (n === 0) return vec(0, 0, 0);
        return vec(v.x/n, v.y/n, v.z/n);
      }

      function quatFromAxisAngle(axis, deg) {
        var theta = deg * Math.PI / 180;
        var u = vecNormalize(axis);
        var half = theta / 2;
        var s = Math.sin(half);
        return quat(Math.cos(half), u.x * s, u.y * s, u.z * s);
      }

      // Rotate vector v by unit quaternion q
      function rotateVectorByQuat(q, v) {
        // Efficient formula: v' = v + 2 * w * (q_vec × v) + 2 * (q_vec × (q_vec × v))
        var vx = v.x, vy = v.y, vz = v.z;
        var qx = q.x, qy = q.y, qz = q.z, qw = q.w;

        // t = 2 * (q_vec × v)
        var tx = 2 * (qy * vz - qz * vy);
        var ty = 2 * (qz * vx - qx * vz);
        var tz = 2 * (qx * vy - qy * vx);

        return {
          x: vx + qw * tx + (qy * tz - qz * ty),
          y: vy + qw * ty + (qz * tx - qx * tz),
          z: vz + qw * tz + (qx * ty - qy * tx)
        };
      }

      // Rotation matrix from unit quaternion
      function rotationMatrixFromQuat(q) {
        var w = q.w, x = q.x, y = q.y, z = q.z;
        var ww = w*w, xx = x*x, yy = y*y, zz = z*z;
        return [
          [1 - 2*(yy + zz), 2*(x*y - w*z),   2*(x*z + w*y)],
          [2*(x*y + w*z),   1 - 2*(xx + zz), 2*(y*z - w*x)],
          [2*(x*z - w*y),   2*(y*z + w*x),   1 - 2*(xx + yy)]
        ];
      }

      // Read quaternions from inputs
      function readQ(prefix) {
        return quat(
          num($(prefix + '-w').value, 0),
          num($(prefix + '-x').value, 0),
          num($(prefix + '-y').value, 0),
          num($(prefix + '-z').value, 0)
        );
      }
      function writeQ(prefix, q) {
        $(prefix + '-w').value = q.w;
        $(prefix + '-x').value = q.x;
        $(prefix + '-y').value = q.y;
        $(prefix + '-z').value = q.z;
      }

      // Arithmetic form
      var arithForm = $('quat-arithmetic-form');
      var arithError = $('quat-error');
      var arithRes = $('quat-arith-results');
      var resText = $('quat-result-text');
      var resNorm = $('quat-result-norm');
      var resNotes = $('quat-result-notes');

      function qToString(q) {
        return 'q = (' + q.w.toFixed(6) + ', ' +
                        q.x.toFixed(6) + ', ' +
                        q.y.toFixed(6) + ', ' +
                        q.z.toFixed(6) + ')';
      }

      function handleArithSubmit(e) {
        e.preventDefault();
        hide(arithError);
        hide(arithRes);
        resText.textContent = '';
        resNorm.textContent = '';
        resNotes.textContent = '';

        var q1 = readQ('q1');
        var q2 = readQ('q2');
        var op = $('quat-operation').value;
        var result = null;
        var extraNote = '';

        try {
          switch (op) {
            case 'add':
              result = quatAdd(q1, q2);
              extraNote = 'Component-wise sum of q₁ and q₂.';
              break;
            case 'sub':
              result = quatSub(q1, q2);
              extraNote = 'Component-wise difference q₁ − q₂.';
              break;
            case 'mul12':
              result = quatMul(q2, q1);
              extraNote = 'q₂·q₁ corresponds to applying q₁ followed by q₂.';
              break;
            case 'mul21':
              result = quatMul(q1, q2);
              extraNote = 'q₁·q₂ corresponds to applying q₂ followed by q₁.';
              break;
            case 'conj1':
              result = quatConj(q1);
              extraNote = 'Quaternion conjugate of q₁.';
              break;
            case 'norm1':
              var n1 = quatNorm(q1);
              resText.textContent = '‖q₁‖ = ' + n1.toFixed(9);
              resNotes.textContent = 'Norm is the square root of the sum of squared components.';
              show(arithRes);
              return;
            case 'inv1':
              var inv1 = quatInv(q1);
              if (!inv1) throw new Error('q₁ has zero norm and is not invertible.');
              result = inv1;
              extraNote = 'Inverse q₁⁻¹ = conj(q₁) / ‖q₁‖².';
              break;
            case 'normalize1':
              result = quatNormalize(q1);
              extraNote = 'Normalised q₁ so that ‖q₁‖ = 1 (or 0 if q₁ was zero).';
              break;
            case 'conj2':
              result = quatConj(q2);
              extraNote = 'Quaternion conjugate of q₂.';
              break;
            case 'norm2':
              var n2 = quatNorm(q2);
              resText.textContent = '‖q₂‖ = ' + n2.toFixed(9);
              resNotes.textContent = 'Norm is the square root of the sum of squared components.';
              show(arithRes);
              return;
            case 'inv2':
              var inv2 = quatInv(q2);
              if (!inv2) throw new Error('q₂ has zero norm and is not invertible.');
              result = inv2;
              extraNote = 'Inverse q₂⁻¹ = conj(q₂) / ‖q₂‖².';
              break;
            case 'normalize2':
              result = quatNormalize(q2);
              extraNote = 'Normalised q₂ so that ‖q₂‖ = 1 (or 0 if q₂ was zero).';
              break;
            default:
              throw new Error('Unknown operation.');
          }
        } catch (ex) {
          arithError.textContent = ex.message;
          show(arithError);
          return;
        }

        if (result) {
          var n = quatNorm(result);
          resText.textContent = qToString(result);
          resNorm.textContent = '‖q‖ = ' + n.toFixed(9);
          resNotes.textContent = extraNote;
          show(arithRes);
        }
      }

      // Presets
      function applyPreset(name) {
        if (name === 'identity') {
          writeQ('q1', quat(1, 0, 0, 0));
        } else if (name === '90z') {
          // 90 deg around z: (cos 45°, 0,0,sin45°)
          writeQ('q1', quat(Math.SQRT1_2, 0, 0, Math.SQRT1_2));
        } else if (name === '180x') {
          // 180 deg around x: (0,1,0,0)
          writeQ('q1', quat(0, 1, 0, 0));
        }
      }

      function applyVectorPreset(name) {
        if (name === 'x') {
          $('v-x').value = 1; $('v-y').value = 0; $('v-z').value = 0;
        } else if (name === 'y') {
          $('v-x').value = 0; $('v-y').value = 1; $('v-z').value = 0;
        } else if (name === 'z') {
          $('v-x').value = 0; $('v-y').value = 0; $('v-z').value = 1;
        } else if (name === 'diag') {
          $('v-x').value = 1; $('v-y').value = 1; $('v-z').value = 1;
        }
      }

      // Axis → q1 button
      function handleAxisToQ1() {
        var ax = num($('axis-x').value, 0);
        var ay = num($('axis-y').value, 0);
        var az = num($('axis-z').value, 1);
        var deg = num($('axis-angle-deg').value, 0);
        var axis = vec(ax, ay, az);
        var n = vecLength(axis);
        if (n === 0) {
          alert('Axis vector must be non-zero.');
          return;
        }
        var q = quatFromAxisAngle(axis, deg);
        writeQ('q1', q);
      }

      // Rotation form & 3D canvas
      var rotationForm = $('quat-rotation-form');
      var rotationError = $('quat-rotation-error');
      var rotationResult = $('quat-rotation-result');
      var rotationMatrixOut = $('quat-rotation-matrix');
      var canvas = $('quat-canvas');
      var ctx = canvas && canvas.getContext ? canvas.getContext('2d') : null;

      var currentOriginal = vec(1, 0, 0);
      var currentRotated = null;

      function projectPoint(p) {
        var w = canvas.width;
        var h = canvas.height;
        var cx = w / 2;
        var cy = h / 2;
        var zOffset = 3.0;
        var scale = Math.min(w, h) * 0.28;
        var denom = (p.z + zOffset);
        if (denom === 0) denom = 0.0001;
        var x2d = cx + scale * p.x / denom;
        var y2d = cy - scale * p.y / denom;
        return { x: x2d, y: y2d };
      }

      function drawArrow(from, to, color) {
        var p0 = projectPoint(from);
        var p1 = projectPoint(to);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(p0.x, p0.y);
        ctx.lineTo(p1.x, p1.y);
        ctx.stroke();

        var dx = p1.x - p0.x;
        var dy = p1.y - p0.y;
        var len = Math.sqrt(dx*dx + dy*dy) || 1;
        var ux = dx / len, uy = dy / len;
        var size = 7;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p1.x - size*(ux + uy*0.4), p1.y - size*(uy - ux*0.4));
        ctx.lineTo(p1.x - size*(ux - uy*0.4), p1.y - size*(uy + ux*0.4));
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
      }

      function drawAxes() {
        // axes from origin
        var origin = vec(0, 0, 0);
        drawArrow(origin, vec(1, 0, 0), '#2563eb'); // x
        drawArrow(origin, vec(0, 1, 0), '#16a34a'); // y
        drawArrow(origin, vec(0, 0, 1), '#f59e0b'); // z
      }

      function drawScene() {
        if (!ctx || !canvas) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // background grid
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        ctx.globalAlpha = 0.9;
        drawAxes();
        ctx.restore();

        // Original vector v (grey)
        if (currentOriginal) {
          ctx.save();
          drawArrow(vec(0,0,0), currentOriginal, '#9ca3af');
          ctx.restore();
        }
        // Rotated vector v' (red)
        if (currentRotated) {
          ctx.save();
          drawArrow(vec(0,0,0), currentRotated, '#dc2626');
          ctx.restore();
        }
      }

      function renderMatrix(matrix) {
        rotationMatrixOut.innerHTML = '';
        if (!matrix) return;
        matrix.forEach(function (row) {
          var line = document.createElement('div');
          line.textContent = '[' +
            row.map(function (v) { return v.toFixed(6); }).join(', ') +
            ']';
          rotationMatrixOut.appendChild(line);
        });
      }

      function handleRotationSubmit(e) {
        e.preventDefault();
        hide(rotationError);
        rotationResult.textContent = '';
        renderMatrix(null);
        currentRotated = null;

        var qr = quat(
          num($('qr-w').value, 0),
          num($('qr-x').value, 0),
          num($('qr-y').value, 0),
          num($('qr-z').value, 0)
        );
        var v = vec(
          num($('v-x').value, 0),
          num($('v-y').value, 0),
          num($('v-z').value, 0)
        );
        currentOriginal = v;

        var autoNorm = $('qr-auto-normalize').checked;
        var qrUsed = qr;
        var nqr = quatNorm(qr);
        if (autoNorm) {
          qrUsed = quatNormalize(qr);
        } else if (Math.abs(nqr - 1) > 1e-6) {
          rotationError.textContent = 'Warning: q_rot is not unit length. The rotation may include scaling. Enable auto-normalise for pure rotations.';
          show(rotationError);
        }

        var vRot = rotateVectorByQuat(qrUsed, v);
        currentRotated = vRot;
        drawScene();

        rotationResult.innerHTML =
          '<span class="vector-pill">v = (' + v.x.toFixed(4) + ', ' + v.y.toFixed(4) + ', ' + v.z.toFixed(4) + ')</span>' +
          '<span class="vector-pill">v′ = (' + vRot.x.toFixed(4) + ', ' + vRot.y.toFixed(4) + ', ' + vRot.z.toFixed(4) + ')</span>';

        var R = rotationMatrixFromQuat(qrUsed);
        renderMatrix(R);
      }

      function handleRotationReset() {
        hide(rotationError);
        rotationResult.textContent = '';
        renderMatrix(null);
        $('qr-w').value = '0.70710678';
        $('qr-x').value = '0';
        $('qr-y').value = '0';
        $('qr-z').value = '0.70710678';
        $('qr-auto-normalize').checked = true;
        $('v-x').value = '1';
        $('v-y').value = '0';
        $('v-z').value = '0';
        currentOriginal = vec(1,0,0);
        currentRotated = null;
        drawScene();
      }

      function copyQ1ToQr() {
        var q1 = readQ('q1');
        writeQ('qr', q1);
      }

      // Event wiring
      document.addEventListener('DOMContentLoaded', function () {
        if (arithForm) {
          arithForm.addEventListener('submit', handleArithSubmit);
        }
        var arithReset = $('quat-arith-reset');
        if (arithReset) {
          arithReset.addEventListener('click', function () {
            arithForm.reset();
            $('q1-w').value = 1;
            $('q1-x').value = 0;
            $('q1-y').value = 0;
            $('q1-z').value = 0;
            hide(arithError);
            hide(arithRes);
          });
        }

        document.querySelectorAll('.chip-button[data-preset]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            applyPreset(btn.getAttribute('data-preset'));
          });
        });
        document.querySelectorAll('.chip-button[data-vpreset]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            applyVectorPreset(btn.getAttribute('data-vpreset'));
          });
        });

        var axisBtn = $('btn-axis-to-q1');
        if (axisBtn) axisBtn.addEventListener('click', handleAxisToQ1);

        if (rotationForm) {
          rotationForm.addEventListener('submit', handleRotationSubmit);
        }
        var rotReset = $('quat-rotation-reset');
        if (rotReset) rotReset.addEventListener('click', handleRotationReset);

        var copyBtn = $('btn-copy-q1-to-qr');
        if (copyBtn) copyBtn.addEventListener('click', copyQ1ToQr);

        // Init canvas
        if (canvas && ctx) {
          drawScene();
        }
      });
    })();
  

    })();</script><script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><script>
    (function() {

      'use strict';

    (function () {
      function $(id) { return document.getElementById(id); }
      function show(el) { el && el.classList.remove('hidden'); }
      function hide(el) { el && el.classList.add('hidden'); }
      function num(v, def) {
        var n = parseFloat(v);
        return Number.isFinite(n) ? n : def;
      }

      // Mobile menu
      var toggle = document.getElementById('mobile-menu-toggle');
      var mobileMenu = document.getElementById('mobile-menu');
      if (toggle && mobileMenu) {
        toggle.addEventListener('click', function () {
          var isHidden = mobileMenu.classList.contains('hidden');
          if (isHidden) {
            mobileMenu.classList.remove('hidden');
            toggle.setAttribute('aria-expanded', 'true');
          } else {
            mobileMenu.classList.add('hidden');
            toggle.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // Quaternion helpers
      function quat(w, x, y, z) {
        return { w: w, x: x, y: y, z: z };
      }
      function quatAdd(a, b) {
        return quat(a.w + b.w, a.x + b.x, a.y + b.y, a.z + b.z);
      }
      function quatSub(a, b) {
        return quat(a.w - b.w, a.x - b.x, a.y - b.y, a.z - b.z);
      }
      function quatMul(a, b) {
        // a * b (Hamilton product)
        return quat(
          a.w*b.w - a.x*b.x - a.y*b.y - a.z*b.z,
          a.w*b.x + a.x*b.w + a.y*b.z - a.z*b.y,
          a.w*b.y - a.x*b.z + a.y*b.w + a.z*b.x,
          a.w*b.z + a.x*b.y - a.y*b.x + a.z*b.w
        );
      }
      function quatConj(q) {
        return quat(q.w, -q.x, -q.y, -q.z);
      }
      function quatNorm(q) {
        return Math.sqrt(q.w*q.w + q.x*q.x + q.y*q.y + q.z*q.z);
      }
      function quatNormalize(q) {
        var n = quatNorm(q);
        if (n === 0) return quat(0, 0, 0, 0);
        return quat(q.w/n, q.x/n, q.y/n, q.z/n);
      }
      function quatInv(q) {
        var n2 = q.w*q.w + q.x*q.x + q.y*q.y + q.z*q.z;
        if (n2 === 0) return null;
        var c = quatConj(q);
        return quat(c.w/n2, c.x/n2, c.y/n2, c.z/n2);
      }

      function vec(x, y, z) { return { x: x, y: y, z: z }; }
      function vecLength(v) { return Math.sqrt(v.x*v.x + v.y*v.y + v.z*v.z); }
      function vecNormalize(v) {
        var n = vecLength(v);
        if (n === 0) return vec(0, 0, 0);
        return vec(v.x/n, v.y/n, v.z/n);
      }

      function quatFromAxisAngle(axis, deg) {
        var theta = deg * Math.PI / 180;
        var u = vecNormalize(axis);
        var half = theta / 2;
        var s = Math.sin(half);
        return quat(Math.cos(half), u.x * s, u.y * s, u.z * s);
      }

      // Rotate vector v by unit quaternion q
      function rotateVectorByQuat(q, v) {
        // Efficient formula: v' = v + 2 * w * (q_vec × v) + 2 * (q_vec × (q_vec × v))
        var vx = v.x, vy = v.y, vz = v.z;
        var qx = q.x, qy = q.y, qz = q.z, qw = q.w;

        // t = 2 * (q_vec × v)
        var tx = 2 * (qy * vz - qz * vy);
        var ty = 2 * (qz * vx - qx * vz);
        var tz = 2 * (qx * vy - qy * vx);

        return {
          x: vx + qw * tx + (qy * tz - qz * ty),
          y: vy + qw * ty + (qz * tx - qx * tz),
          z: vz + qw * tz + (qx * ty - qy * tx)
        };
      }

      // Rotation matrix from unit quaternion
      function rotationMatrixFromQuat(q) {
        var w = q.w, x = q.x, y = q.y, z = q.z;
        var ww = w*w, xx = x*x, yy = y*y, zz = z*z;
        return [
          [1 - 2*(yy + zz), 2*(x*y - w*z),   2*(x*z + w*y)],
          [2*(x*y + w*z),   1 - 2*(xx + zz), 2*(y*z - w*x)],
          [2*(x*z - w*y),   2*(y*z + w*x),   1 - 2*(xx + yy)]
        ];
      }

      // Read quaternions from inputs
      function readQ(prefix) {
        return quat(
          num($(prefix + '-w').value, 0),
          num($(prefix + '-x').value, 0),
          num($(prefix + '-y').value, 0),
          num($(prefix + '-z').value, 0)
        );
      }
      function writeQ(prefix, q) {
        $(prefix + '-w').value = q.w;
        $(prefix + '-x').value = q.x;
        $(prefix + '-y').value = q.y;
        $(prefix + '-z').value = q.z;
      }

      // Arithmetic form
      var arithForm = $('quat-arithmetic-form');
      var arithError = $('quat-error');
      var arithRes = $('quat-arith-results');
      var resText = $('quat-result-text');
      var resNorm = $('quat-result-norm');
      var resNotes = $('quat-result-notes');

      function qToString(q) {
        return 'q = (' + q.w.toFixed(6) + ', ' +
                        q.x.toFixed(6) + ', ' +
                        q.y.toFixed(6) + ', ' +
                        q.z.toFixed(6) + ')';
      }

      function handleArithSubmit(e) {
        e.preventDefault();
        hide(arithError);
        hide(arithRes);
        resText.textContent = '';
        resNorm.textContent = '';
        resNotes.textContent = '';

        var q1 = readQ('q1');
        var q2 = readQ('q2');
        var op = $('quat-operation').value;
        var result = null;
        var extraNote = '';

        try {
          switch (op) {
            case 'add':
              result = quatAdd(q1, q2);
              extraNote = 'Component-wise sum of q₁ and q₂.';
              break;
            case 'sub':
              result = quatSub(q1, q2);
              extraNote = 'Component-wise difference q₁ − q₂.';
              break;
            case 'mul12':
              result = quatMul(q2, q1);
              extraNote = 'q₂·q₁ corresponds to applying q₁ followed by q₂.';
              break;
            case 'mul21':
              result = quatMul(q1, q2);
              extraNote = 'q₁·q₂ corresponds to applying q₂ followed by q₁.';
              break;
            case 'conj1':
              result = quatConj(q1);
              extraNote = 'Quaternion conjugate of q₁.';
              break;
            case 'norm1':
              var n1 = quatNorm(q1);
              resText.textContent = '‖q₁‖ = ' + n1.toFixed(9);
              resNotes.textContent = 'Norm is the square root of the sum of squared components.';
              show(arithRes);
              return;
            case 'inv1':
              var inv1 = quatInv(q1);
              if (!inv1) throw new Error('q₁ has zero norm and is not invertible.');
              result = inv1;
              extraNote = 'Inverse q₁⁻¹ = conj(q₁) / ‖q₁‖².';
              break;
            case 'normalize1':
              result = quatNormalize(q1);
              extraNote = 'Normalised q₁ so that ‖q₁‖ = 1 (or 0 if q₁ was zero).';
              break;
            case 'conj2':
              result = quatConj(q2);
              extraNote = 'Quaternion conjugate of q₂.';
              break;
            case 'norm2':
              var n2 = quatNorm(q2);
              resText.textContent = '‖q₂‖ = ' + n2.toFixed(9);
              resNotes.textContent = 'Norm is the square root of the sum of squared components.';
              show(arithRes);
              return;
            case 'inv2':
              var inv2 = quatInv(q2);
              if (!inv2) throw new Error('q₂ has zero norm and is not invertible.');
              result = inv2;
              extraNote = 'Inverse q₂⁻¹ = conj(q₂) / ‖q₂‖².';
              break;
            case 'normalize2':
              result = quatNormalize(q2);
              extraNote = 'Normalised q₂ so that ‖q₂‖ = 1 (or 0 if q₂ was zero).';
              break;
            default:
              throw new Error('Unknown operation.');
          }
        } catch (ex) {
          arithError.textContent = ex.message;
          show(arithError);
          return;
        }

        if (result) {
          var n = quatNorm(result);
          resText.textContent = qToString(result);
          resNorm.textContent = '‖q‖ = ' + n.toFixed(9);
          resNotes.textContent = extraNote;
          show(arithRes);
        }
      }

      // Presets
      function applyPreset(name) {
        if (name === 'identity') {
          writeQ('q1', quat(1, 0, 0, 0));
        } else if (name === '90z') {
          // 90 deg around z: (cos 45°, 0,0,sin45°)
          writeQ('q1', quat(Math.SQRT1_2, 0, 0, Math.SQRT1_2));
        } else if (name === '180x') {
          // 180 deg around x: (0,1,0,0)
          writeQ('q1', quat(0, 1, 0, 0));
        }
      }

      function applyVectorPreset(name) {
        if (name === 'x') {
          $('v-x').value = 1; $('v-y').value = 0; $('v-z').value = 0;
        } else if (name === 'y') {
          $('v-x').value = 0; $('v-y').value = 1; $('v-z').value = 0;
        } else if (name === 'z') {
          $('v-x').value = 0; $('v-y').value = 0; $('v-z').value = 1;
        } else if (name === 'diag') {
          $('v-x').value = 1; $('v-y').value = 1; $('v-z').value = 1;
        }
      }

      // Axis → q1 button
      function handleAxisToQ1() {
        var ax = num($('axis-x').value, 0);
        var ay = num($('axis-y').value, 0);
        var az = num($('axis-z').value, 1);
        var deg = num($('axis-angle-deg').value, 0);
        var axis = vec(ax, ay, az);
        var n = vecLength(axis);
        if (n === 0) {
          alert('Axis vector must be non-zero.');
          return;
        }
        var q = quatFromAxisAngle(axis, deg);
        writeQ('q1', q);
      }

      // Rotation form & 3D canvas
      var rotationForm = $('quat-rotation-form');
      var rotationError = $('quat-rotation-error');
      var rotationResult = $('quat-rotation-result');
      var rotationMatrixOut = $('quat-rotation-matrix');
      var canvas = $('quat-canvas');
      var ctx = canvas && canvas.getContext ? canvas.getContext('2d') : null;

      var currentOriginal = vec(1, 0, 0);
      var currentRotated = null;

      function projectPoint(p) {
        var w = canvas.width;
        var h = canvas.height;
        var cx = w / 2;
        var cy = h / 2;
        var zOffset = 3.0;
        var scale = Math.min(w, h) * 0.28;
        var denom = (p.z + zOffset);
        if (denom === 0) denom = 0.0001;
        var x2d = cx + scale * p.x / denom;
        var y2d = cy - scale * p.y / denom;
        return { x: x2d, y: y2d };
      }

      function drawArrow(from, to, color) {
        var p0 = projectPoint(from);
        var p1 = projectPoint(to);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(p0.x, p0.y);
        ctx.lineTo(p1.x, p1.y);
        ctx.stroke();

        var dx = p1.x - p0.x;
        var dy = p1.y - p0.y;
        var len = Math.sqrt(dx*dx + dy*dy) || 1;
        var ux = dx / len, uy = dy / len;
        var size = 7;
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p1.x - size*(ux + uy*0.4), p1.y - size*(uy - ux*0.4));
        ctx.lineTo(p1.x - size*(ux - uy*0.4), p1.y - size*(uy + ux*0.4));
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
      }

      function drawAxes() {
        // axes from origin
        var origin = vec(0, 0, 0);
        drawArrow(origin, vec(1, 0, 0), '#2563eb'); // x
        drawArrow(origin, vec(0, 1, 0), '#16a34a'); // y
        drawArrow(origin, vec(0, 0, 1), '#f59e0b'); // z
      }

      function drawScene() {
        if (!ctx || !canvas) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // background grid
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        ctx.globalAlpha = 0.9;
        drawAxes();
        ctx.restore();

        // Original vector v (grey)
        if (currentOriginal) {
          ctx.save();
          drawArrow(vec(0,0,0), currentOriginal, '#9ca3af');
          ctx.restore();
        }
        // Rotated vector v' (red)
        if (currentRotated) {
          ctx.save();
          drawArrow(vec(0,0,0), currentRotated, '#dc2626');
          ctx.restore();
        }
      }

      function renderMatrix(matrix) {
        rotationMatrixOut.innerHTML = '';
        if (!matrix) return;
        matrix.forEach(function (row) {
          var line = document.createElement('div');
          line.textContent = '[' +
            row.map(function (v) { return v.toFixed(6); }).join(', ') +
            ']';
          rotationMatrixOut.appendChild(line);
        });
      }

      function handleRotationSubmit(e) {
        e.preventDefault();
        hide(rotationError);
        rotationResult.textContent = '';
        renderMatrix(null);
        currentRotated = null;

        var qr = quat(
          num($('qr-w').value, 0),
          num($('qr-x').value, 0),
          num($('qr-y').value, 0),
          num($('qr-z').value, 0)
        );
        var v = vec(
          num($('v-x').value, 0),
          num($('v-y').value, 0),
          num($('v-z').value, 0)
        );
        currentOriginal = v;

        var autoNorm = $('qr-auto-normalize').checked;
        var qrUsed = qr;
        var nqr = quatNorm(qr);
        if (autoNorm) {
          qrUsed = quatNormalize(qr);
        } else if (Math.abs(nqr - 1) > 1e-6) {
          rotationError.textContent = 'Warning: q_rot is not unit length. The rotation may include scaling. Enable auto-normalise for pure rotations.';
          show(rotationError);
        }

        var vRot = rotateVectorByQuat(qrUsed, v);
        currentRotated = vRot;
        drawScene();

        rotationResult.innerHTML =
          '<span class="vector-pill">v = (' + v.x.toFixed(4) + ', ' + v.y.toFixed(4) + ', ' + v.z.toFixed(4) + ')</span>' +
          '<span class="vector-pill">v′ = (' + vRot.x.toFixed(4) + ', ' + vRot.y.toFixed(4) + ', ' + vRot.z.toFixed(4) + ')</span>';

        var R = rotationMatrixFromQuat(qrUsed);
        renderMatrix(R);
      }

      function handleRotationReset() {
        hide(rotationError);
        rotationResult.textContent = '';
        renderMatrix(null);
        $('qr-w').value = '0.70710678';
        $('qr-x').value = '0';
        $('qr-y').value = '0';
        $('qr-z').value = '0.70710678';
        $('qr-auto-normalize').checked = true;
        $('v-x').value = '1';
        $('v-y').value = '0';
        $('v-z').value = '0';
        currentOriginal = vec(1,0,0);
        currentRotated = null;
        drawScene();
      }

      function copyQ1ToQr() {
        var q1 = readQ('q1');
        writeQ('qr', q1);
      }

      // Event wiring
      document.addEventListener('DOMContentLoaded', function () {
        if (arithForm) {
          arithForm.addEventListener('submit', handleArithSubmit);
        }
        var arithReset = $('quat-arith-reset');
        if (arithReset) {
          arithReset.addEventListener('click', function () {
            arithForm.reset();
            $('q1-w').value = 1;
            $('q1-x').value = 0;
            $('q1-y').value = 0;
            $('q1-z').value = 0;
            hide(arithError);
            hide(arithRes);
          });
        }

        document.querySelectorAll('.chip-button[data-preset]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            applyPreset(btn.getAttribute('data-preset'));
          });
        });
        document.querySelectorAll('.chip-button[data-vpreset]').forEach(function (btn) {
          btn.addEventListener('click', function () {
            applyVectorPreset(btn.getAttribute('data-vpreset'));
          });
        });

        var axisBtn = $('btn-axis-to-q1');
        if (axisBtn) axisBtn.addEventListener('click', handleAxisToQ1);

        if (rotationForm) {
          rotationForm.addEventListener('submit', handleRotationSubmit);
        }
        var rotReset = $('quat-rotation-reset');
        if (rotReset) rotReset.addEventListener('click', handleRotationReset);

        var copyBtn = $('btn-copy-q1-to-qr');
        if (copyBtn) copyBtn.addEventListener('click', copyQ1ToQr);

        // Init canvas
        if (canvas && ctx) {
          drawScene();
        }
      });
    })();
  

    })();</script></body></html>