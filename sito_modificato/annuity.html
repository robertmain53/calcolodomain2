<!DOCTYPE html><html lang="en"><head>
<link rel="canonical" href="https://calcdomain.com/annuity">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Annuity Calculator: Future Value &amp; Payout Planning</title>
<meta name="description" content="Calculate the future value (FV) of an annuity (accumulation) or the periodic payment (payout) from a lump sum. Plan for retirement with our comprehensive tool.">

<meta name="author" content="Ugo Candido">

<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="shortcut" href="/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="manifest" href="/site.webmanifest">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558fYv3eWK7go8HWaISdGfZ9u/IqR55LILGmgEMpGUFJGuRhLVnCALiB" crossorigin="anonymous">
<script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTadBVOjsjMZEJfaFGxaAPfW5dAiMgOkVKG8M4HNTs4LfsKNnxKNOTSBi8" crossorigin="anonymous"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/Gf1ESgqCntTwubN/bRgrLqtWplvT1lP4GrZot6rGGDg/F9Jv" crossorigin="anonymous"></script>

<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1.25rem;
overflow-x:auto; text-align: center; font-size: 1.1rem;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }

/* Stili del Calcolatore e Risultati (Conformi WCAG & Direttiva 2.4) */
.form-label {
display: block;
text-sm;
font-weight: 500;
color: #374151; /* gray-700 */
margin-bottom: 0.25rem;
}
.form-input {
display: block;
width: 100%;
/* Direttiva 2.4: Target Tattili (48px) */
min-height: 48px;
padding: 0.5rem 0.75rem;
border: 1px solid #d1d5db; /* gray-300 */
border-radius: 0.375rem;
box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
}
.form-input-group {
display: flex;
}
.form-input-group .form-input {
border-top-right-radius: 0;
border-bottom-right-radius: 0;
flex-grow: 1;
z-index: 1; /* Fix focus shadow clipping */
}
.form-input-group .prefix {
min-height: 48px;
display: inline-flex;
align-items: center;
padding: 0 0.75rem;
border: 1px solid #d1d5db;
border-right: 0;
border-radius: 0.375rem 0 0 0.375rem;
background-color: #f9fafb;
color: #6b7280;
}
.form-input:focus {
outline: 2px solid transparent;
outline-offset: 2px;
border-color: #2563eb; /* blue-600 */
box-shadow: 0 0 0 2px #2563eb;
z-index: 10;
}
.required-marker {
color: #ef4444; /* red-500 */
margin-left: 0.25rem;
}
.error-message {
color: #dc2626; /* red-600 */
font-size: 0.875rem;
margin-top: 0.5rem;
min-height: 1.25rem; /* Previene CLS */
}
.tap-target {
min-height: 48px; /* Direttiva 2.4 */
min-width: 48px; /* Direttiva 2.4 */
display: inline-flex;
align-items: center;
justify-content: center;
padding-left: 1.5rem;
padding-right: 1.5rem;
}

/* Stile Focus Visibile Personalizzato (WCAG 2.4.7) */
:focus-visible {
outline: 3px solid #3b82f6; /* blue-500 */
outline-offset: 2px;
border-radius: 4px;
}
:focus:not(:focus-visible) {
outline: none;
}

/* Stili Risultati (Contrasto Corretto) */
.result-card {
background: #fff;
border: 1px solid #e5e7eb; /* gray-200 */
border-radius: 10px;
padding: 1rem 1.25rem;
text-align: center;
}
.result-card h4 {
font-size: 0.9rem;
font-weight: 500;
color: #4b5563; /* gray-600 */
margin-bottom: 0.25rem;
text-transform: uppercase;
letter-spacing: 0.05em;
}
.result-card p {
font-size: 1.5rem;
font-weight: 700;
color: #1f2937; /* gray-800 */
}

/* Stili Tab (A11y) */
[role="tab"] {
cursor: pointer;
padding: 0.75rem 1.25rem;
border-bottom: 3px solid transparent;
font-size: 1rem;
font-weight: 500;
}
[role="tab"][aria-selected="true"] {
border-bottom-color: #2563eb; /* blue-600 */
color: #2563eb;
font-weight: 600;
}
[role="tabpanel"] {
border-top: 1px solid #d1d5db;
padding-top: 1.5rem;
}
[role="tabpanel"]:focus {
outline: none;
}

/* Stili Tooltip (A11y) */
.tooltip-btn {
background: none;
border: none;
padding: 0.25rem;
border-radius: 9999px;
color: #6b7280;
cursor: pointer;
}
.tooltip-btn:hover { color: #111827; }
.tooltip-text {
display: none;
background-color: #1f2937;
color: white;
padding: 0.5rem 0.75rem;
border-radius: 6px;
font-size: 0.875rem;
margin-top: 0.5rem;
position: relative;
}
.tooltip-text[aria-hidden="false"] {
display: block;
}

/* Stili Stampa */
@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
#results-chart-container, #results-chart-container-payout { display: none !important; }
}
</style>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Annuity Calculator: Future Value & Payout Planning",
  "description": "Calculate the future value (FV) of an annuity (accumulation) or the periodic payment (payout) from a lump sum. Plan for retirement with our comprehensive tool.",
  "url": "https://calcdomain.com/annuity",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "applicationCategory": "FinancialApplication"
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Finance",
      "item": "https://calcdomain.com/categories/finance"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Finance Investment",
      "item": "https://calcdomain.com/subcategories/finance-investment"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Calculate an Annuity's Future Value",
  "description": "A step-by-step guide to calculating the future value of an annuity (accumulation phase).",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Select 'Future Value' Tab",
      "text": "Ensure the 'Future Value (Accumulation)' tab is selected."
    },
    {
      "@type": "HowToStep",
      "name": "Enter Initial Funds",
      "text": "Input your 'Starting Amount' (Present Value), which can be $0."
    },
    {
      "@type": "HowToStep",
      "name": "Enter Contributions",
      "text": "Input the 'Periodic Payment' (e.g., $500) and how often you'll make it ('Compounding/Payment Frequency')."
    },
    {
      "@type": "HowToStep",
      "name": "Enter Terms",
      "text": "Input the 'Annual Interest Rate (%)' and the 'Number of Years' you plan to save."
    },
    {
      "@type": "HowToStep",
      "name": "Choose Payment Timing",
      "text": "Select 'Beginning of Period' (Annuity Due) or 'End of Period' (Ordinary Annuity)."
    },
    {
      "@type": "HowToStep",
      "name": "Review Results",
      "text": "The calculator instantly shows the 'Future Value', 'Total Principal', and 'Total Interest Earned', along with a growth chart."
    }
  ]
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "FAQPage",
"mainEntity": [
{
"@type": "Question",
"name": "What is the difference between an ordinary annuity and an annuity due?",
"acceptedAnswer": {
"@type": "Answer",
"text": "An **Ordinary Annuity** assumes payments are made at the **end** of each period (e.g., at the end of the month). An **Annuity Due** assumes payments are made at the **beginning** of each period. Because payments in an annuity due have one extra period to earn interest, its future value will be slightly higher."
}
},
{
"@type": "Question",
"name": "What is the difference between the 'Accumulation' and 'Payout' tabs?",
"acceptedAnswer": {
"@type": "Answer",
"text": "The **'Future Value (Accumulation)'** tab calculates how much your money will grow to. You provide a starting amount and periodic payments to find the total future value.\nThe **'Payment (Payout)'** tab calculates how much you can withdraw from a lump sum. You provide the total starting amount and it calculates the fixed periodic payment you can receive until the money runs out."
}
},
{
"@type":G "Question",
"name": "How does 'compounding frequency' affect my investment?",
"acceptedAnswer": {
"@type": "Answer",
"text": "Compounding frequency is how often your interest is calculated and added to your principal. The more frequent the compounding (e.g., monthly vs. annually), the more interest you will earn on your interest, leading to faster growth. This calculator assumes your payment frequency matches your compounding frequency."
}
},
{
"@type": "Question",
"name": "Does this calculator account for inflation or taxes?",
"acceptedAnswer": {
"@type": "Answer",
"text": "No. This calculator computes the nominal future value based on the inputs provided. It does not account for the effects of inflation (which reduces the purchasing power of the future value) or taxes on interest, which would also reduce the net return. These results should be used for estimation purposes."
}
},
{
"@type": "Question",
"name": "What is a realistic interest rate to use?",
"acceptedAnswer": {
"@type": "Answer",
"text": "This depends entirely on the investment. A high-yield savings account might offer 4-5%, while the long-term historical average return of a diversified stock market index (like the S&P 500) is around 7-10%. However, past performance is not a guarantee of future results, and higher-return investments carry higher risk."
}
}
]
}
</script>
<script src="search.js" defer=""></script>

<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="https://calcdomain.com" class="text-2xl font-bold text-blue-700">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..." class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="https://calcdomain.com/search" class="text-gray-700 hover:text-blue-700">Advanced Search</a>
Categories
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="https://calcdomain.com/search" class="block py-2 text-gray-700 hover:text-blue-700">Advanced Search</a>
Categories
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs"><a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> &raquo; <a href="https://calcdomain.com/categories/finance" class="hover:text-blue-600">Finance</a> &raquo; <a href="https://calcdomain.com/subcategories/finance-investment" class="hover:text-blue-600">Finance Investment</a></nav>

<div id="print-section" class="bg-white p-6 md:p-8 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Annuity Calculator</h1>
<p class="text-gray-600 mb-6">Calculate the future value of an annuity (your savings) or the periodic payout from a lump sum (your retirement). This tool helps you plan for retirement by modeling both the accumulation and distribution phases based on standard time-value-of-money formulas.</p>

<div class="mb-4 border-b border-gray-200">
<div role="tablist" aria-label="Calculator Mode" class="flex">
<button role="tab" aria-selected="true" id="tab-fv" aria-controls="panel-fv" class="text-sm md:text-base">
Future Value (Accumulation)
</button>
<button role="tab" aria-selected="false" id="tab-payout" aria-controls="panel-payout" class="text-sm md:text-base">
Payment (Payout)
</button>
</div>
</div>

<section id="calculator-ui">
<div role="tabpanel" id="panel-fv" tabindex="0">
<form id="fv-calculator" class="space-y-6" onsubmit="return false;">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="startAmount" class="form-label">Starting Amount (PV)</label>
<div class="form-input-group">
<span class="prefix">$</span>
<input type="number" id="startAmount" value="10000" step="100" min="0" class="form-input" aria-required="true" aria-describedby="startAmount-error">
</div>
<div id="startAmount-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="periodicPayment" class="form-label">
Periodic Payment (PMT)
<span class="required-marker" aria-hidden="true">*</span>
</label>
<div class="form-input-group">
<span class="prefix">$</span>
<input type="number" id="periodicPayment" value="500" step="10" min="0" class="form-input" aria-required="true" aria-describedby="periodicPayment-error">
</div>
<div id="periodicPayment-error" class="error-message" role="alert"></div>
</div>
<div>
<div class="flex items-center space-x-1">
<label for="interestRate" class="form-label">
Annual Interest Rate (r)
<span class="required-marker" aria-hidden="true">*</span>
</label>
<button type="button" id="rate-tooltip-btn" class="tooltip-btn" aria-label="More info about Annual Interest Rate" aria-expanded="false" aria-controls="rate-tooltip-text">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.06-1.061 3.5 3.5 0 014.12 4.122A.75.75 0 0110.82 10a2 2 0 10-2.298 1.75a.75.75 0 01-1.496-.068 3.5 3.5 0 014.12-4.122zM10 12.25a.75.75 0 01.75.75v.008a.75.75 0 01-1.5 0V13a.75.75 0 01.75-.75z" clip-rule="evenodd"></path></svg>
</button>
</div>
<div class="flex items-center">
<input type="number" id="interestRate" value="7" step="0.01" min="0" class="form-input" aria-required="true" aria-describedby="interestRate-error rate-tooltip-text">
<span class="ml-2 text-gray-700">%</span>
</div>
<div id="interestRate-error" class="error-message" role="alert"></div>
<div id="rate-tooltip-text" role="tooltip" class="tooltip-text" aria-hidden="true">
The nominal annual interest rate (e.g., 7 for 7%).
</div>
</div>
<div>
<label for="termYears" class="form-label">
Number of Years (t)
<span class="required-marker" aria-hidden="true">*</span>
</label>
<input type="number" id="termYears" value="30" step="1" min="1" class="form-input" aria-required="true" aria-describedby="termYears-error">
<div id="termYears-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="compoundFrequency" class="form-label">Compounding/Payment Frequency (n)</label>
<select id="compoundFrequency" class="form-input">
<option value="12" selected="">Monthly</option>
<option value="4">Quarterly</option>
<option value="2">Semiannually</option>
<option value="1">Annually</option>
</select>
</div>
<div>
<fieldset>
<legend class="form-label">Payment Timing</legend>
<div class="flex space-x-6 mt-1 pt-2">
<div class="flex items-center">
<input type="radio" id="paymentTimingEnd" name="paymentTiming" value="end" checked="" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
<label for="paymentTimingEnd" class="ml-2 block text-sm text-gray-900">End of Period (Ordinary)</label>
</div>
<div class="flex items-center">
<input type="radio" id="paymentTimingStart" name="paymentTiming" value="start" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
<label for="paymentTimingStart" class="ml-2 block text-sm text-gray-900">Beginning of Period (Due)</label>
</div>
</div>
</fieldset>
</div>
</div>
<div class="flex space-x-4 mt-6">
<button type="button" id="reset-fv-btn" class="tap-target px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 ring-offset-2">Reset</button>
</div>
</form>
</div>

<div role="tabpanel" id="panel-payout" tabindex="0" class="hidden">
<form id="payout-calculator" class="space-y-6" onsubmit="return false;">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="startAmountPayout" class="form-label">
Starting Amount (PV)
<span class="required-marker" aria-hidden="true">*</span>
</label>
<div class="form-input-group">
<span class="prefix">$</span>
<input type="number" id="startAmountPayout" value="500000" step="1000" min="0" class="form-input" aria-required="true" aria-describedby="startAmountPayout-error">
</div>
<div id="startAmountPayout-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="interestRatePayout" class="form-label">
Annual Interest Rate (r)
<span class="required-marker" aria-hidden="true">*</span>
</label>
<div class="flex items-center">
<input type="number" id="interestRatePayout" value="5" step="0.01" min="0" class="form-input" aria-required="true" aria-describedby="interestRatePayout-error">
<span class="ml-2 text-gray-700">%</span>
</div>
<div id="interestRatePayout-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="termYearsPayout" class="form-label">
Payout Period (Years)
<span class="required-marker" aria-hidden="true">*</span>
</label>
<input type="number" id="termYearsPayout" value="20" step="1" min="1" class="form-input" aria-required="true" aria-describedby="termYearsPayout-error">
<div id="termYearsPayout-error" class="error-message" role="alert"></div>
</div>
<div>
<label for="payoutFrequency" class="form-label">Payout Frequency (n)</label>
<select id="payoutFrequency" class="form-input">
<option value="12" selected="">Monthly</option>
<option value="4">Quarterly</option>
<option value="1">Annually</option>
</select>
</div>
<div class="md:col-span-2">
<fieldset>
<legend class="form-label">Payment Timing</legend>
<div class="flex space-x-6 mt-1 pt-2">
<div class="flex items-center">
<input type="radio" id="paymentTimingEndPayout" name="paymentTimingPayout" value="end" checked="" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
<label for="paymentTimingEndPayout" class="ml-2 block text-sm text-gray-900">End of Period (Ordinary)</label>
</div>
<div class="flex items-center">
<input type="radio" id="paymentTimingStartPayout" name="paymentTimingPayout" value="start" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
<label for="paymentTimingStartPayout" class="ml-2 block text-sm text-gray-900">Beginning of Period (Due)</label>
</div>
</div>
</fieldset>
</div>
</div>
<div class="flex space-x-4 mt-6">
<button type="button" id="reset-payout-btn" class="tap-target px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-500 ring-offset-2">Reset</button>
</div>
</form>
</div>
</section>

<section id="results" class="mt-8" style="min-height: 400px;" aria-live="polite">

<div id="fv-results" class="bg-blue-50 border border-blue-200 rounded-lg p-6">
<h3 id="fv-results-heading" class="text-xl font-semibold text-gray-800 mb-4 text-center">Accumulation Results</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="result-card bg-blue-100 border-blue-200 shadow-sm md:col-span-2">
<h4 class="text-blue-800">Future Value (FV)</h4>
<p id="fv-result-value" class="text-blue-700 text-3xl font-bold">—</p>
</div>
<div class="result-card">
<h4>Total Principal</h4>
<p id="fv-principal-result">—</p>
</div>
<div class="result-card">
<h4>Total Interest Earned</h4>
<p id="fv-interest-result" class="text-green-700">—</p>
</div>
</div>
<div id="results-chart-container" class="mt-6 h-64 md:h-80">
<canvas id="fvChart" aria-label="Annuity growth over time"></canvas>
</div>
</div>

<div id="payout-results" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-6">
<h3 id="payout-results-heading" class="text-xl font-semibold text-gray-800 mb-4 text-center">Payout Results</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="result-card bg-blue-100 border-blue-200 shadow-sm md:col-span-2">
<h4 class="text-blue-800">Periodic Payout (PMT)</h4>
<p id="payout-result-value" class="text-blue-700 text-3xl font-bold">—</p>
</div>
<div class="result-card">
<h4>Total Principal Paid Out</h4>
<p id="payout-principal-result">—</p>
</div>
<div class="result-card">
<h4>Total Interest Earned</h4>
<p id="payout-interest-result" class="text-green-700">—</p>
</div>
</div>
<div id="results-chart-container-payout" class="mt-6 h-64 md:h-80">
<canvas id="payoutChart" aria-label="Annuity balance depletion over time"></canvas>
</div>
</div>

</section>
</div>

<article class="bg-white p-6 md:p-8 rounded-lg shadow-md mt-8 prose prose-blue">
<h2 id="methodology">Data Source &amp; Methodology</h2>
<p>This calculator uses the fundamental principles of the **Time Value of Money (TVM)**, which are the cornerstone of modern finance. The calculations are based on standard formulas for the present and future value of annuities.</p>
<ul>
<li><strong>Authoritative Source:</strong> <em>Fundamentals of Corporate Finance (11th Edition)</em> by Richard Brealey, Stewart Myers, and Alan Marcus.</li>
<li><strong>Reference:</strong> Chapters 4 &amp; 5 ("The Time Value of Money" &amp; "Valuing Bonds").</li>
</ul>
<p>All calculations are based strictly on the standard financial formulas derived from these principles.</p>

<h2 id="formula">The Formulas Explained</h2>
<p>This calculator solves for two primary goals: the Future Value (FV) of an investment and the periodic Payment (PMT) from a lump sum.</p>

<h3 id="fv-formula">1. Future Value of an Annuity (Accumulation)</h3>
<p>This formula calculates the total value of an investment that starts with a present value ($PV$) and receives periodic payments ($PMT$).</p>
<p><strong>Ordinary Annuity (End of Period):</strong></p>
<div class="formula-box" role="math" aria-label="Future Value of an Ordinary Annuity">
$$ FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r} $$
</div>
<p><strong>Annuity Due (Beginning of Period):</strong></p>
<div class="formula-box" role="math" aria-label="Future Value of an Annuity Due">
$$ FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r} \cdot (1 + r) $$
</div>

<h3 id="pmt-formula">2. Payment from an Annuity (Payout)</h3>
<p>This formula calculates the fixed periodic payment ($PMT$) that can be withdrawn from a starting lump sum ($PV$).</p>
<p><strong>Ordinary Annuity (End of Period):</strong></p>
<div class="formula-box" role="math" aria-label="Payment from an Ordinary Annuity">
$$ PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}} $$
</div>
<p><strong>Annuity Due (Beginning of Period):</strong></p>
<div class="formula-box" role="math" aria-label="Payment from an Annuity Due">
$$ PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}} \cdot \frac{1}{1+r} $$
</div>

<h2 id="variables">Glossary of Variables</h2>
<ul class="list-disc list-inside">
<li><strong>$FV$ (Future Value):</strong> The total value of the investment at the end of the specified period.</li>
<li><strong>$PV$ (Present Value):</strong> The starting amount of money (the lump sum).</li>
<li><strong>$PMT$ (Periodic Payment):</strong> The amount of money added (accumulation) or withdrawn (payout) each period.</li>
<li><strong>$r$ (Periodic Interest Rate):</strong> The annual rate divided by the number of compounding periods per year ($r = \text{Annual Rate} / n$).</li>
<li><strong>$n$ (Total Number of Periods):</strong> The number of years multiplied by the number of compounding periods per year ($n = \text{Years} \times n_{\text{per year}}$).</li>
<li><strong>Ordinary Annuity:</strong> An annuity where payments are made at the **end** of each period.</li>
<li><strong>Annuity Due:</strong> An annuity where payments are made at the **beginning** of each period. This results in a slightly higher future value as each payment has one extra period to earn interest.</li>
</ul>

<h2 id="example">How It Works: A Step-by-Step Example (Accumulation)</h2>
<p>Let's calculate the future value of a retirement account.
</p><ul>
<li><strong>Goal:</strong> Future Value (Accumulation)</li>
<li><strong>Starting Amount ($PV$):</strong> $10,000</li>
<li><strong>Periodic Payment ($PMT$):</strong> $500</li>
<li><strong>Payment Frequency:</strong> Monthly ($n_{\text{per year}} = 12$)</li>
<li><strong>Annual Interest Rate:</strong> 7%</li>
<li><strong>Number of Years:</strong> 30</li>
<li><strong>Payment Timing:</strong> End of Period (Ordinary)</li>
</ul>
<p></p>
<ol class="list-decimal list-inside">
<li><strong>Calculate Periodic Rate ($r$):</strong>
<br> $r = 7\% / 12 = 0.07 / 12 \approx 0.005833$</li>
<li><strong>Calculate Total Periods ($n$):</strong>
<br> $n = 30 \text{ years} \times 12 \text{ periods/year} = 360$</li>
<li><strong>Calculate FV of Initial $10,000:</strong>
<br> $FV_{PV} = \$10,000 \cdot (1 + 0.005833)^{360} \approx \$81,166.15$</li>
<li><strong>Calculate FV of $500/mo Payments:</strong>
<br> $FV_{PMT} = \$500 \cdot \frac{(1 + 0.005833)^{360} - 1}{0.005833} \approx \$610,612.39$</li>
<li><strong>Calculate Total Future Value:</strong>
<br> $FV_{Total} = FV_{PV} + FV_{PMT} = \$81,166.15 + \$610,612.39 = \$691,778.54$</li>
<li><strong>Calculate Total Interest:</strong>
<br> $\text{Total Principal} = \$10,000 + (\$500 \times 360) = \$190,000$
<br> $\text{Total Interest} = \$691,778.54 - \$190,000 = \$501,778.54$</li>
</ol>

<h2 id="faq">Frequently Asked Questions (FAQ)</h2>
<details>
<summary>What is the difference between an ordinary annuity and an annuity due?</summary>
<p>An **Ordinary Annuity** assumes payments are made at the **end** of each period (e.g., at the end of the month). An **Annuity Due** assumes payments are made at the **beginning** of each period. Because payments in an annuity due have one extra period to earn interest, its future value will be slightly higher.</p>
</details>
<details>
<summary>What is the difference between the 'Accumulation' and 'Payout' tabs?</summary>
<p>The **'Future Value (Accumulation)'** tab calculates how much your money will grow to. You provide a starting amount and periodic payments to find the total future value.<br>The **'Payment (Payout)'** tab calculates how much you can withdraw from a lump sum. You provide the total starting amount and it calculates the fixed periodic payment you can receive until the money runs out.</p>
</details>
<details>
<summary>How does 'compounding frequency' affect my investment?</summary>
<p>Compounding frequency is how often your interest is calculated and added to your principal. The more frequent the compounding (e.g., monthly vs. annually), the more interest you will earn on your interest, leading to faster growth. This calculator assumes your payment frequency matches your compounding frequency.</p>
</details>
<details>
<summary>Does this calculator account for inflation or taxes?</summary>
<p>No. This calculator computes the nominal future value based on the inputs provided. It does not account for the effects of inflation (which reduces the purchasing power of the future value) or taxes on interest, which would also reduce the net return. These results should be used for estimation purposes.</p>
</details>
<details>
<summary>What is a realistic interest rate to use?</summary>
<p>This depends entirely on the investment. A high-yield savings account might offer 4-5%, while the long-term historical average return of a diversified stock market index (like the S&amp;P 500) is around 7-10%. However, past performance is not a guarantee of future results, and higher-return investments carry higher risk.</p>
</details>
<details>
<summary>Is a 401(k) or IRA an annuity?</summary>
<p>Technically, 401(k)s and IRAs are tax-advantaged retirement accounts, not annuities themselves. However, the *concept* of saving (accumulation) and withdrawing (payout) is identical. You can use this calculator to model the growth and potential income from those accounts.</p>
</details>
<details>
<summary>What is a perpetuity?</summary>
<p>A perpetuity is a type of annuity where the payments continue forever. This calculator is for annuities with a fixed term (a finite number of years).</p>
</details>

<div class="mt-8 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong>
<br>Financial content reviewed by the CalcDomain Editorial Board.
<br>Last accuracy review: <time datetime="2025-11-03">November 3, 2025</time></p>
</div>

<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r}\]</div>
  <pre class="auditspine-mono">FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r} \cdot (1 + r)\]</div>
  <pre class="auditspine-mono">FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r} \cdot (1 + r)</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}}\]</div>
  <pre class="auditspine-mono">PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}} \cdot \frac{1}{1+r}\]</div>
  <pre class="auditspine-mono">PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}} \cdot \frac{1}{1+r}</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[", right: "\]</div>
  <pre class="auditspine-mono">", right: "</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">$ FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r} $</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">$ FV = PV \cdot (1 + r)^n + PMT \cdot \frac{(1 + r)^n - 1}{r} \cdot (1 + r) $</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">$ PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}} $</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">$ PMT = PV \cdot \frac{r}{1 - (1 + r)^{-n}} \cdot \frac{1}{1+r} $</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><span class="auditspine-mono">T</span> = property tax (annual or monthly depending on input) <em>(currency)</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Home</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/" target="_blank" rel="nofollow noopener">https://calcdomain.com/</a></li>
<li><strong>Finance</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/finance" target="_blank" rel="nofollow noopener">https://calcdomain.com/finance</a></li>
<li><strong>Investment</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/subcategories/finance-investment" target="_blank" rel="nofollow noopener">https://calcdomain.com/subcategories/finance-investment</a></li>
<li><strong>Compound Interest Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/compound-interest-calculator" target="_blank" rel="nofollow noopener">https://calcdomain.com/compound-interest-calculator</a></li>
<li><strong>401(k) Retirement Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/401k" target="_blank" rel="nofollow noopener">https://calcdomain.com/401k</a></li>
<li><strong>Present Value Calculator</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/present-value" target="_blank" rel="nofollow noopener">https://calcdomain.com/present-value</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why Use This Calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>**Dual Mode:** Calculate both savings growth (FV) and retirement income (PMT).</li>
<li>**Visual Chart:** See your growth or payout schedule graphically.</li>
<li>**Flexible:** Handles both ordinary (end of period) and due (beginning of period) annuities.</li>
<li>**Clear Results:** See the breakdown of principal vs. interest.</li>
<li>**E-E-A-T:** Based on standard, authoritative financial formulas.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Investment Tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="https://calcdomain.com/compound-interest-calculator" class="text-blue-700 hover:underline">Compound Interest Calculator</a></li>
<li><a href="https://calcdomain.com/401k" class="text-blue-700 hover:underline">401(k) Retirement Calculator</a></li>
<li>Investment Calculator</li>
<li><a href="https://calcdomain.com/present-value" class="text-blue-700 hover:underline">Present Value Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-gray-900 text-white py-12">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
        <p class="text-gray-400 mb-4">
          Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.
        </p>
        </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Categories</h4>
                                                                                        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/categories/construction" class="text-gray-400 hover:text-white">Construction</a></li>
          <li><a href="https://calcdomain.com/categories/construction-diy" class="text-gray-400 hover:text-white">Construction & DIY</a></li>
          <li><a href="https://calcdomain.com/categories/engineering" class="text-gray-400 hover:text-white">Engineering</a></li>
          <li><a href="https://calcdomain.com/categories/finance" class="text-gray-400 hover:text-white">Finance</a></li>
          <li><a href="https://calcdomain.com/categories/general" class="text-gray-400 hover:text-white">General</a></li>
          <li><a href="https://calcdomain.com/categories/health-fitness" class="text-gray-400 hover:text-white">Health & Fitness</a></li>
          <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-gray-400 hover:text-white">Lifestyle & Everyday</a></li>
          <li><a href="https://calcdomain.com/categories/math" class="text-gray-400 hover:text-white">Math</a></li>
          <li><a href="https://calcdomain.com/categories/math-conversions" class="text-gray-400 hover:text-white">Math & Conversions</a></li>
          <li><a href="https://calcdomain.com/categories/science" class="text-gray-400 hover:text-white">Science</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/mortgage-payment" class="text-gray-400 hover:text-white">Mortgage Calculator</a></li>
          <li><a href="https://calcdomain.com/percentage-calculator" class="text-gray-400 hover:text-white">Percentage Calculator</a></li>
          <li><a href="https://calcdomain.com/bmi-calculator" class="text-gray-400 hover:text-white">BMI Calculator</a></li>
          <li><a href="https://calcdomain.com/auto-loan-calculator" class="text-gray-400 hover:text-white">Auto Loan Calculator</a></li>
          <li><a href="https://calcdomain.com/house-affordability" class="text-gray-400 hover:text-white">House Affordability</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-lg font-semibold mb-4">Support</h4>
        <ul class="space-y-2">
          <li><a href="https://calcdomain.com/about" class="text-gray-400 hover:text-white">About Us</a></li>
          <li><a href="https://calcdomain.com/contact" class="text-gray-400 hover:text-white">Contact</a></li>
          <li><a href="https://calcdomain.com/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
          <li><a href="https://calcdomain.com/terms" class="text-gray-400 hover:text-white">Terms of Service</a></li>
          <li><a href="https://calcdomain.com/sitemap.xml" class="text-gray-400 hover:text-white">Site Map</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
      <p>&copy; 2025 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
    </div>
  </div>
</footer>













<script defer="">
document.addEventListener('DOMContentLoaded', () => {

// --- 1. Riferimenti DOM ---
const elements = {
// Tabs
tabFv: document.getElementById('tab-fv'),
tabPayout: document.getElementById('tab-payout'),
panelFv: document.getElementById('panel-fv'),
panelPayout: document.getElementById('panel-payout'),
// FV Form
startAmount: document.getElementById('startAmount'),
startAmountError: document.getElementById('startAmount-error'),
periodicPayment: document.getElementById('periodicPayment'),
periodicPaymentError: document.getElementById('periodicPayment-error'),
interestRate: document.getElementById('interestRate'),
interestRateError: document.getElementById('interestRate-error'),
termYears: document.getElementById('termYears'),
termYearsError: document.getElementById('termYears-error'),
compoundFrequency: document.getElementById('compoundFrequency'),
paymentTimingEnd: document.getElementById('paymentTimingEnd'),
paymentTimingStart: document.getElementById('paymentTimingStart'),
resetFvBtn: document.getElementById('reset-fv-btn'),
// Payout Form
startAmountPayout: document.getElementById('startAmountPayout'),
startAmountPayoutError: document.getElementById('startAmountPayout-error'),
interestRatePayout: document.getElementById('interestRatePayout'),
interestRatePayoutError: document.getElementById('interestRatePayout-error'),
termYearsPayout: document.getElementById('termYearsPayout'),
termYearsPayoutError: document.getElementById('termYearsPayout-error'),
payoutFrequency: document.getElementById('payoutFrequency'),
paymentTimingEndPayout: document.getElementById('paymentTimingEndPayout'),
paymentTimingStartPayout: document.getElementById('paymentTimingStartPayout'),
resetPayoutBtn: document.getElementById('reset-payout-btn'),
// Results
fvResults: document.getElementById('fv-results'),
payoutResults: document.getElementById('payout-results'),
fvResultValue: document.getElementById('fv-result-value'),
fvPrincipalResult: document.getElementById('fv-principal-result'),
fvInterestResult: document.getElementById('fv-interest-result'),
payoutResultValue: document.getElementById('payout-result-value'),
payoutPrincipalResult: document.getElementById('payout-principal-result'),
payoutInterestResult: document.getElementById('payout-interest-result'),
// Tooltip
rateTooltipBtn: document.getElementById('rate-tooltip-btn'),
rateTooltipText: document.getElementById('rate-tooltip-text'),
};

let fvChartInstance = null;
let payoutChartInstance = null;

// --- 2. Helpers ---
const fmtCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val || 0);
const validate = (el, errEl, min = 0) => {
const val = parseFloat(el.value);
if (el.value === '' || isNaN(val) || val < min) {
errEl.textContent = `Value must be a positive number.`;
el.setAttribute('aria-invalid', 'true');
return null;
}
errEl.textContent = '';
el.setAttribute('aria-invalid', 'false');
return val;
};

// --- 3. Logica Tooltip (A11y) ---
elements.rateTooltipBtn.addEventListener('click', () => {
const isExpanded = elements.rateTooltipBtn.getAttribute('aria-expanded') === 'true';
elements.rateTooltipBtn.setAttribute('aria-expanded', !isExpanded);
elements.rateTooltipText.setAttribute('aria-hidden', isExpanded);
});

// --- 4. Logica TAB (A11y) ---
function switchTab(mode) {
const isFv = mode === 'fv';
elements.tabFv.setAttribute('aria-selected', isFv);
elements.tabPayout.setAttribute('aria-selected', !isFv);
elements.panelFv.classList.toggle('hidden', !isFv);
elements.panelPayout.classList.toggle('hidden', isFv);
elements.fvResults.classList.toggle('hidden', !isFv);
elements.payoutResults.classList.toggle('hidden', isFv);
if (isFv) {
elements.panelFv.focus();
calculateFV();
} else {
elements.panelPayout.focus();
calculatePayout();
}
}
elements.tabFv.addEventListener('click', () => switchTab('fv'));
elements.tabPayout.addEventListener('click', () => switchTab('payout'));

// --- 5. Calcolo Future Value (Accumulation) ---
function calculateFV() {
let isValid = true;
const pv = validate(elements.startAmount, elements.startAmountError, 0);
const pmt = validate(elements.periodicPayment, elements.periodicPaymentError, 0);
const rate = validate(elements.interestRate, elements.interestRateError, 0);
const years = validate(elements.termYears, elements.termYearsError, 1);
if (pv === null || pmt === null || rate === null || years === null) isValid = false;
if (!isValid) {
resetFVResults();
return;
}

const n = parseFloat(elements.compoundFrequency.value);
const isDue = elements.paymentTimingStart.checked;
const r = (rate / 100) / n;
const nt = n * years;

// FV of Present Value
const fv_pv = pv * Math.pow(1 + r, nt);
// FV of Payments
let fv_pmt = pmt * ((Math.pow(1 + r, nt) - 1) / r);
if (isDue) {
fv_pmt *= (1 + r);
}
const totalFV = fv_pv + fv_pmt;
const totalPrincipal = pv + (pmt * nt);
const totalInterest = totalFV - totalPrincipal;

displayFVResults(totalFV, totalPrincipal, totalInterest, pv, pmt, r, nt, isDue);
}

function displayFVResults(fv, principal, interest, pv, pmt, r, nt, isDue) {
elements.fvResultValue.textContent = fmtCurrency(fv);
elements.fvPrincipalResult.textContent = fmtCurrency(principal);
elements.fvInterestResult.textContent = fmtCurrency(interest);
renderFVChart(pv, pmt, r, nt, isDue);
}

function resetFVResults() {
elements.fvResultValue.textContent = '—';
elements.fvPrincipalResult.textContent = '—';
elements.fvInterestResult.textContent = '—';
if (fvChartInstance) fvChartInstance.destroy();
}

// --- 6. Calcolo Payment (Payout) ---
function calculatePayout() {
let isValid = true;
const pv = validate(elements.startAmountPayout, elements.startAmountPayoutError, 1);
const rate = validate(elements.interestRatePayout, elements.interestRatePayoutError, 0);
const years = validate(elements.termYearsPayout, elements.termYearsPayoutError, 1);
if (pv === null || rate === null || years === null) isValid = false;
if (!isValid) {
resetPayoutResults();
return;
}

const n = parseFloat(elements.payoutFrequency.value);
const isDue = elements.paymentTimingStartPayout.checked;
const r = (rate / 100) / n;
const nt = n * years;

let pmt;
if (r === 0) { // No interest
pmt = pv / nt;
} else {
const denominator = 1 - Math.pow(1 + r, -nt);
pmt = pv * (r / denominator);
if (isDue) {
pmt /= (1 + r);
}
}

const totalPaidOut = pmt * nt;
const totalInterest = totalPaidOut - pv;

displayPayoutResults(pmt, pv, totalInterest, pv, pmt, r, nt, isDue, n);
}

function displayPayoutResults(pmt, principal, interest, pv, pmtVal, r, nt, isDue, n) {
const freqText = { 12: 'per month', 4: 'per quarter', 1: 'per year' }[n];
elements.payoutResultValue.textContent = `${fmtCurrency(pmt)} ${freqText}`;
elements.payoutPrincipalResult.textContent = fmtCurrency(principal);
elements.payoutInterestResult.textContent = fmtCurrency(interest);
renderPayoutChart(pv, pmtVal, r, nt, isDue);
}

function resetPayoutResults() {
elements.payoutResultValue.textContent = '—';
elements.payoutPrincipalResult.textContent = '—';
elements.payoutInterestResult.textContent = '—';
if (payoutChartInstance) payoutChartInstance.destroy();
}

// --- 7. Logica Grafici (Chart.js) ---
function renderFVChart(pv, pmt, r, nt, isDue) {
const labels = [];
const dataPrincipal = [];
const dataInterest = [];
let currentPV = pv;
let currentPMT = 0;

for (let i = 0; i <= nt; i++) {
labels.push(i);
let fv_pv = pv * Math.pow(1 + r, i);
let fv_pmt = pmt * ((Math.pow(1 + r, i) - 1) / r);
if (isDue) fv_pmt *= (1 + r);

const principal = pv + (pmt * i);
const total = fv_pv + fv_pmt;
const interest = total - principal;
dataPrincipal.push(principal);
dataInterest.push(interest);
}

const ctx = document.getElementById('fvChart').getContext('2d');
if (fvChartInstance) fvChartInstance.destroy();
fvChartInstance = new Chart(ctx, {
type: 'line',
data: {
labels: labels,
datasets: [
{
label: 'Total Principal',
data: dataPrincipal,
backgroundColor: '#3b82f6',
borderColor: '#3b82f6',
fill: true,
tension: 0.1,
pointRadius: 0
},
{
label: 'Total Interest',
data: dataInterest,
backgroundColor: '#16a34a',
borderColor: '#16a34a',
fill: true,
tension: 0.1,
pointRadius: 0
}
]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: { position: 'bottom' },
tooltip: { mode: 'index', intersect: false }
},
scales: {
x: { title: { display: true, text: 'Periods' } },
y: { stacked: true, title: { display: true, text: 'Value' } }
}
}
});
}

function renderPayoutChart(pv, pmt, r, nt, isDue) {
const labels = [];
const dataBalance = [];
let balance = pv;

for (let i = 0; i <= nt; i++) {
labels.push(i);
dataBalance.push(balance);

if (i < nt) {
let interest = balance * r;
let payment = pmt;
if (isDue) {
let principal = payment - interest;
balance -= principal;
} else {
balance += interest;
balance -= payment;
}
}
}
dataBalance[nt] = 0; // Ensure it ends at 0

const ctx = document.getElementById('payoutChart').getContext('2d');
if (payoutChartInstance) payoutChartInstance.destroy();
payoutChartInstance = new Chart(ctx, {
type: 'line',
data: {
labels: labels,
datasets: [
{
label: 'Remaining Balance',
data: dataBalance,
backgroundColor: '#3b82f6',
borderColor: '#3b82f6',
fill: true,
tension: 0.1,
pointRadius: 0
}
]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: { position: 'bottom' },
tooltip: { mode: 'index', intersect: false }
},
scales: {
x: { title: { display: true, text: 'Periods' } },
y: { title: { display: true, text: 'Balance' } }
}
}
});
}

// --- 8. Event Listeners ---
const fvInputs = [elements.startAmount, elements.periodicPayment, elements.interestRate, elements.termYears, elements.compoundFrequency, elements.paymentTimingEnd, elements.paymentTimingStart];
fvInputs.forEach(el => el.addEventListener('input', calculateFV));

const payoutInputs = [elements.startAmountPayout, elements.interestRatePayout, elements.termYearsPayout, elements.payoutFrequency, elements.paymentTimingEndPayout, elements.paymentTimingStartPayout];
payoutInputs.forEach(el => el.addEventListener('input', calculatePayout));

elements.resetFvBtn.addEventListener('click', () => {
elements.startAmount.value = '10000';
elements.periodicPayment.value = '500';
elements.interestRate.value = '7';
elements.termYears.value = '30';
elements.compoundFrequency.value = '12';
elements.paymentTimingEnd.checked = true;
calculateFV();
});
elements.resetPayoutBtn.addEventListener('click', () => {
elements.startAmountPayout.value = '500000';
elements.interestRatePayout.value = '5';
elements.termYearsPayout.value = '20';
elements.payoutFrequency.value = '12';
elements.paymentTimingEndPayout.checked = true;
calculatePayout();
});

// --- 9. Inizializzazione ---
switchTab('fv');

// --- 10. Logica Menu Mobile (dal template) ---
const menuToggle = document.getElementById('mobile-menu-toggle');
const mobileMenu = document.getElementById('mobile-menu');
menuToggle.addEventListener('click', () => {
const isHidden = mobileMenu.classList.toggle('hidden');
menuToggle.setAttribute('aria-expanded', !isHidden);
});

// --- 11. Logica Rendering LaTeX (necessaria) ---
if (typeof renderMathInElement === 'function') {
renderMathInElement(document.body, {
delimiters: [
{left: "$$", right: "$$", display: true},
{left: "$", right: "$", display: false}
]
});
}
});
</script>


</body></html>