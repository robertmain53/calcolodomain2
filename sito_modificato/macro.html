<!DOCTYPE html><html lang="en"><head>
<link rel="canonical" href="https://calcdomain.com/macro">





 
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg">
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png">
<link rel="manifest" href="https://calcdomain.com/site.webmanifest">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Macro Calculator | Health and Fitness Nutrition</title>
<meta content="Accurately calculate your daily calories (TDEE) and macro targets (protein, fat, carbs) based on science-backed formulas. Mobile-first, accessible macro calculator for fat loss, muscle gain, or maintenance." name="description">
<meta content="Ugo Candido" name="author">

<meta content="index,follow" name="robots">
<meta content="#FFFFFF" name="theme-color">
<meta content="Macro Calculator" property="og:title">
<meta content="Science-based macro calculator for precise calorie and macro targets. WCAG 2.1 AA accessible and mobile-first." property="og:description">
<meta content="website" property="og:type">
<meta content="https://calcdomain.com/macro" property="og:url">
<style>
    /* ============ Critical, mobile-first CSS (inline) ============ */
    :root{
      --primary-color:#005A9C; --secondary-color:#003F6E; --accent-color:#00A4E4;
      --background-color:#F8F9FA; --surface-color:#FFFFFF;
      --text-color:#212529; --muted-text-color:#6C757D; --border-color:#DEE2E6;
      --success-color:#198754; --error-color:#DC3545; --warning-color:#FFC107;
      --touch-target-min:48px;
      --radius:10px; --radius-sm:8px;
      --container-max:1200px;
    }
    *{box-sizing:border-box}
    html{font-size:16px; -webkit-text-size-adjust:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text-color); background:var(--background-color); line-height:1.6}
    a{color:var(--primary-color); text-decoration:none}
    a:hover{text-decoration:underline}
    .skip-link{position:absolute; left:8px; top:-40px; background:var(--primary-color); color:#fff; padding:8px 12px; border-radius:6px; z-index:1000}
    .skip-link:focus{top:8px}
    header{background:#fff; border-bottom:1px solid var(--border-color)}
    .container{max-width:var(--container-max); margin:0 auto; padding:0 16px}
    .header-inner{display:flex; align-items:center; gap:12px; padding:12px 0}
    .logo{font-weight:700; color:var(--primary-color)}
    .site-search{display:flex; gap:8px; flex:1 1 auto}
    .site-search input{flex:1 1 auto; min-width:0; padding:10px 12px; border:1px solid var(--border-color); border-radius:8px}
    .btn{display:inline-flex; align-items:center; justify-content:center; min-height:var(--touch-target-min); padding:10px 14px; font-weight:600; border:1px solid var(--primary-color); border-radius:8px; background:#fff; color:var(--primary-color); cursor:pointer}
    .btn:focus{outline:3px solid var(--primary-color); outline-offset:2px}
    .btn-primary{background:var(--primary-color); color:#fff}
    nav.breadcrumb{font-size:.9rem; color:var(--muted-text-color); margin:1rem 0}
    h1{font-size:1.8rem; line-height:1.25; margin:0.25rem 0 0.5rem; color:var(--secondary-color)}
    h2{font-size:1.4rem; margin:1.5rem 0 .5rem; color:var(--secondary-color)}
    h3{font-size:1.2rem; margin:1rem 0 .5rem; color:var(--secondary-color)}
    main{padding:24px 0}
    .layout{display:grid; grid-template-columns:1fr; gap:24px}
    @media(min-width:992px){ .layout{grid-template-columns:420px 1fr} }
    .card{background:#fff; border:1px solid var(--border-color); border-radius:12px; padding:18px}
    .form-group{margin-bottom:16px}
    label{display:block; font-weight:600; margin-bottom:6px}
    .label-row{display:flex; align-items:center; gap:8px; justify-content:space-between}
    .tooltip-btn{border:none; background:#e9f2fb; color:#0b5cab; border-radius:999px; width:28px; height:28px; min-width:28px; min-height:28px; font-weight:700; cursor:pointer}
    .tooltip-btn:focus{outline:3px solid var(--primary-color); outline-offset:2px}
    .tooltip{margin-top:6px; background:#f5f9ff; border:1px solid #cfe3ff; padding:10px; border-radius:8px}
    .input, select{width:100%; min-height:48px; padding:10px 12px; border:1px solid var(--border-color); border-radius:8px; background:#fff}
    .input:focus, select:focus{outline:3px solid var(--primary-color); outline-offset:2px}
    .input[aria-invalid="true"], select[aria-invalid="true"]{border-color:var(--error-color)}
    .error{color:var(--error-color); font-size:.9rem; margin-top:6px}
    fieldset{border:1px solid var(--border-color); border-radius:10px; padding:8px 10px}
    legend{padding:0 6px; font-weight:700}
    .radio-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:8px}
    .radio-item{display:flex; align-items:center; gap:8px; border:1px solid var(--border-color); border-radius:8px; padding:10px}
    .inline{display:flex; gap:10px}
    .inline .input{flex:1}
    .units-row{display:flex; gap:8px}
    .units-row > *{flex:1}
    .results{min-height:260px; background:var(--background-color); border:1px solid var(--border-color); border-radius:12px; padding:16px}
    .result-line{display:flex; justify-content:space-between; align-items:baseline; padding:8px 0; border-bottom:1px solid var(--border-color)}
    .result-line:last-child{border-bottom:none}
    .result-label{color:var(--muted-text-color)}
    .result-value{font-weight:700; color:var(--success-color)}
    .pill{display:inline-block; background:#eef7f0; border:1px solid #cfe9d5; color:#0f6f3d; padding:4px 8px; border-radius:999px; font-size:.85rem}
    .divider{height:1px; background:var(--border-color); margin:12px 0}
    .author-box{font-size:.95rem; color:var(--muted-text-color); border-top:1px solid var(--border-color); padding-top:12px; margin-top:16px}
    footer{background:var(--secondary-color); color:#fff; margin-top:32px}
    .footer-inner{display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); padding:24px 16px}
    .footer-bottom{text-align:center; padding:12px; border-top:1px solid #495057; font-size:.9rem}
    /* Focus visibility */
    :focus-visible{outline:3px solid var(--primary-color); outline-offset:2px}
    /* Ensure minimum tap target spacing on mobile */
    .form-actions{display:flex; gap:8px; flex-wrap:wrap}
  </style>
<!-- Non-critical, richer design system CSS (asynchronously applied) -->
<style id="nonCriticalStyles" media="print" onload="this.media='all'">
/* --- Enhanced CalcDomain CSS with Mobile-First Design & Accessibility --- */

/* ====================================================================== */
/* Design Tokens                                                          */
/* ====================================================================== */
:root {
  --primary-color:#005A9C; --secondary-color:#003F6E; --accent-color:#00A4E4;
  --background-color:#F8F9FA; --surface-color:#FFFFFF;
  --text-color:#212529; --muted-text-color:#6C757D; --border-color:#DEE2E6;
  --success-color:#198754; --error-color:#DC3545; --warning-color:#FFC107;

  --font-sans-serif:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  --font-monospace:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;

  --touch-target-min:48px; --touch-target-optimal:60px;
  --input-padding:clamp(.75rem,2vw,1rem);
  --border-radius-button:8px; --border-radius-card:12px;

  --transition-standard:.2s ease-in-out; --transition-fast:.1s ease-in-out;

  --container-max-width:1200px; --sidebar-width:clamp(300px,40vw,450px);
  --gap-small:.5rem; --gap-medium:1rem; --gap-large:2rem;

  --overlay-bg:rgba(0,0,0,.4);
}
@media (prefers-contrast: high){
  :root{
    --primary-color:#000080; --secondary-color:#000;
    --text-color:#000; --border-color:#000; --background-color:#fff;
  }
}
@media (prefers-reduced-motion: reduce){
  *,*::before,*::after{
    animation-duration:.01ms!important; animation-iteration-count:1!important;
    transition-duration:.01ms!important; scroll-behavior:auto!important;
  }
}

/* Utilities */
.grid{display:grid; gap:clamp(1rem,3vw,1.5rem)}
.grid-3-col{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
code{font-family:var(--font-monospace); background:#e9ecef; padding:.2em .4em; border-radius:3px}
.formula-box{background:#eef2f7; border:1px solid var(--border-color); border-radius:10px; padding:14px; overflow:auto}

/* Buttons extended */
.btn:hover{background:rgba(0,90,156,.06)}
.btn-primary:hover{background:#00487a}

  </style>
<!-- MathJax for LaTeX rendering (non-blocking) -->
<script defer="" id="mathjax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Macro Calculator",
  "description": "Science-based macro calculator that computes your BMR, TDEE, and custom macro targets for protein, fat, and carbs. WCAG 2.1 AA accessible and mobile-first.",
  "url": "https://calcdomain.com/macro",
  "inLanguage": "en",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step Example",
      "description": "An example showing how to calculate TDEE and macros using the Mifflin–St Jeor equation and activity factors.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Collect inputs",
          "text": "Sex: male, Age: 30, Height: 180 cm, Weight: 80 kg, Body fat: 15%, Activity: Moderately active (1.55), Goal: Fat loss (-20%)."
        },
        {
          "@type": "HowToStep",
          "name": "Compute BMR (Mifflin–St Jeor)",
          "text": "BMR = 10·W + 6.25·H − 5·A + s = 10·80 + 6.25·180 − 5·30 + 5 = 1780 kcal/day."
        },
        {
          "@type": "HowToStep",
          "name": "Compute TDEE",
          "text": "TDEE = BMR × Activity = 1780 × 1.55 = 2759 kcal/day."
        },
        {
          "@type": "HowToStep",
          "name": "Apply goal adjustment",
          "text": "Target calories = TDEE × (1 − 0.20) = 2207 kcal/day."
        },
        {
          "@type": "HowToStep",
          "name": "Distribute macros",
          "text": "Protein = 1.8 g/kg × 80 = 144 g (576 kcal). Fat = 25% of calories = 552 kcal = 61 g. Carbs = (2207 − 576 − 552)/4 = 270 g."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Which equation should I use: Mifflin–St Jeor or Katch–McArdle?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Use Mifflin–St Jeor if you do not know your body fat percentage. Use Katch–McArdle if you have a reasonably accurate body fat estimate, as it accounts for lean body mass."
          }
        },
        {
          "@type": "Question",
          "name": "How accurate are activity multipliers?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "They are averages. Individual variability can be large. Use them as a starting point and adjust based on your real-world weight trends over 2–4 weeks."
          }
        },
        {
          "@type": "Question",
          "name": "What protein intake should I choose?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "A common range is 1.6–2.2 g/kg of body weight (or lean mass). Start around 1.8 g/kg and adjust based on satiety, training load, and preferences."
          }
        },
        {
          "@type": "Question",
          "name": "Can I calculate macros for keto or low-carb?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. Increase fat percent or set fat as grams per kg, and allow carbs to be the remainder. Ensure adequate protein and fiber."
          }
        },
        {
          "@type": "Question",
          "name": "Is this medical advice?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. This calculator is for educational purposes and general guidance. Consult a qualified professional for personalized medical or nutrition advice."
          }
        },
        {
          "@type": "Question",
          "name": "How do I improve accuracy over time?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Track your intake and body weight for 2–4 weeks. If weight changes faster or slower than planned, adjust daily calories by 5–10% and re-evaluate."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer=""></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['$','$'], ['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="https://calcdomain.com/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="https://calcdomain.com/assets/js/page-enhancements.js" as="script">


<style>
/* AUDIT_SPINE_CSS */
.auditspine-note{
  border:1px solid #e5e7eb;
  background:#fff;
  border-radius:12px;
  padding:12px;
  color:#475569;
  font-size:13px;
  line-height:1.5;
}
.auditspine-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.auditspine-changelog{
  border:1px solid #e5e7eb;
  background:#fff;
  border-left:5px solid #334155;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  color:#475569;
}
.auditspine-formula{
  margin:10px 0;
  background:#0b1220;
  color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(255,255,255,.12);
  overflow-x:auto;
}
.auditspine-formula pre{margin:8px 0 0; white-space:pre-wrap;}
.auditspine-hr{border:none; border-top:1px solid #e5e7eb; margin:18px 0;}
</style>
</head>
<body>

<a class="skip-link" href="#main">Skip to main content</a>
<header aria-label="Site header" role="banner">
<div class="container header-inner">
CalcDomain
<form aria-label="Site search" class="site-search" role="search">
<label class="sr-only" for="q" style="position:absolute;left:-9999px">Search calculators</label>
<input aria-label="Search calculators" id="q" inputmode="search" name="q" placeholder="Search calculators…" type="search">
<button aria-label="Submit search" class="btn" type="submit">Search</button>
</form>
</div>
</header>
<main class="container" id="main" tabindex="-1">
<nav aria-label="Breadcrumb" class="breadcrumb">
Home / <a href="https://calcdomain.com/health-fitness">Health and Fitness</a> / Nutrition / Macro Calculator
    </nav>
<h1>Macro Calculator</h1>
<p>This interactive macro calculator estimates your daily energy needs (TDEE) and translates them into practical protein, fat, and carbohydrate targets. It’s built for anyone optimizing nutrition for fat loss, muscle gain, or maintenance, using peer‑reviewed equations and accessible, mobile‑first design.</p>
<div class="layout">
<!-- Calculator -->
<section aria-labelledby="calculator-heading" class="card" id="macro-calculator">
<h2 id="calculator-heading" style="margin-top:0">Calculator</h2>
<!-- Units -->
<div class="form-group">
<fieldset>
<legend>Units *</legend>
<div aria-label="Units" class="radio-grid" role="radiogroup">
<label class="radio-item">
<input checked="" id="unitsMetric" name="units" type="radio" value="metric">
<span>Metric (kg, cm)</span>
</label>
<label class="radio-item">
<input id="unitsImperial" name="units" type="radio" value="imperial">
<span>Imperial (lb, ft/in)</span>
</label>
</div>
</fieldset>
</div>
<!-- Sex -->
<div class="form-group">
<fieldset>
<legend>Sex *</legend>
<div aria-label="Sex" class="radio-grid" role="radiogroup">
<label class="radio-item">
<input checked="" id="sexMale" name="sex" type="radio" value="male">
<span>Male</span>
</label>
<label class="radio-item">
<input id="sexFemale" name="sex" type="radio" value="female">
<span>Female</span>
</label>
</div>
</fieldset>
</div>
<!-- Age -->
<div class="form-group">
<div class="label-row">
<label for="age">Age *</label>
<button aria-controls="tip-age" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="tooltip" hidden="" id="tip-age">Age in full years. Typical valid range: 14–90.</div>
<input aria-describedby="ageError tip-age" aria-required="true" class="input" id="age" inputmode="numeric" max="100" min="10" placeholder="e.g., 30" step="1" type="number">
<div aria-live="polite" class="error" id="ageError" role="alert"></div>
</div>
<!-- Height -->
<div class="form-group" id="heightMetricGroup">
<div class="label-row">
<label for="heightCm">Height (cm) *</label>
<button aria-controls="tip-height" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="tooltip" hidden="" id="tip-height">Measure without shoes. Valid range 120–220 cm (or 4’0”–7’3”).</div>
<input aria-describedby="heightError tip-height" aria-required="true" class="input" id="heightCm" inputmode="decimal" max="230" min="120" placeholder="e.g., 175" step="0.1" type="number">
<div aria-live="polite" class="error" id="heightError" role="alert"></div>
</div>
<div class="form-group" hidden="" id="heightImperialGroup">
<div class="label-row">
<label for="heightFt">Height (ft/in) *</label>
<button aria-controls="tip-height" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="units-row">
<input aria-describedby="heightImpError tip-height" aria-required="true" class="input" id="heightFt" inputmode="numeric" max="7" min="4" placeholder="ft" step="1" type="number">
<input aria-describedby="heightImpError tip-height" aria-required="true" class="input" id="heightIn" inputmode="numeric" max="11" min="0" placeholder="in" step="1" type="number">
</div>
<div aria-live="polite" class="error" id="heightImpError" role="alert"></div>
</div>
<!-- Weight -->
<div class="form-group" id="weightMetricGroup">
<label for="weightKg">Weight (kg) *</label>
<input aria-describedby="weightError" aria-required="true" class="input" id="weightKg" inputmode="decimal" max="300" min="30" placeholder="e.g., 70.0" step="0.1" type="number">
<div aria-live="polite" class="error" id="weightError" role="alert"></div>
</div>
<div class="form-group" hidden="" id="weightImperialGroup">
<label for="weightLb">Weight (lb) *</label>
<input aria-describedby="weightImpError" aria-required="true" class="input" id="weightLb" inputmode="decimal" max="660" min="66" placeholder="e.g., 154" step="0.1" type="number">
<div aria-live="polite" class="error" id="weightImpError" role="alert"></div>
</div>
<!-- Body Fat -->
<div class="form-group">
<div class="label-row">
<label for="bodyFat">Body fat (%)</label>
<button aria-controls="tip-bodyfat" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="tooltip" hidden="" id="tip-bodyfat">Optional but recommended for Katch–McArdle and lean‑mass protein targeting. Typical range 5–60%.</div>
<input aria-describedby="bodyFatError tip-bodyfat" class="input" id="bodyFat" inputmode="decimal" max="60" min="3" placeholder="e.g., 20" step="0.1" type="number">
<div aria-live="polite" class="error" id="bodyFatError" role="alert"></div>
</div>
<!-- Equation -->
<div class="form-group">
<fieldset>
<legend>Equation *</legend>
<div aria-label="Equation" class="radio-grid" role="radiogroup">
<label class="radio-item">
<input checked="" id="eqMSJ" name="equation" type="radio" value="msj">
<span>Mifflin–St Jeor</span>
</label>
<label class="radio-item">
<input id="eqKM" name="equation" type="radio" value="km">
<span>Katch–McArdle</span>
</label>
</div>
</fieldset>
<div aria-live="polite" class="error" id="equationNote" role="alert" style="margin-top:6px"></div>
</div>
<!-- Activity level -->
<div class="form-group">
<div class="label-row">
<label for="activity">Activity level *</label>
<button aria-controls="tip-activity" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="tooltip" hidden="" id="tip-activity">Pick the option that best matches your weekly average. Adjust later based on results.</div>
<select aria-describedby="activityError tip-activity" aria-required="true" class="input" id="activity">
<option value="1.2">Sedentary (little to no exercise) — 1.2</option>
<option value="1.375">Lightly active (1–3 days/week) — 1.375</option>
<option selected="" value="1.55">Moderately active (3–5 days/week) — 1.55</option>
<option value="1.725">Very active (6–7 days/week) — 1.725</option>
<option value="1.9">Extra active (physical job + training) — 1.9</option>
</select>
<div aria-live="polite" class="error" id="activityError" role="alert"></div>
</div>
<!-- Goal -->
<div class="form-group">
<fieldset>
<legend>Goal *</legend>
<div aria-label="Goal" class="radio-grid" role="radiogroup">
<label class="radio-item"><input checked="" name="goal" type="radio" value="maintain"><span>Maintain</span></label>
<label class="radio-item"><input name="goal" type="radio" value="lose"><span>Lose fat</span></label>
<label class="radio-item"><input name="goal" type="radio" value="gain"><span>Gain muscle</span></label>
<label class="radio-item"><input name="goal" type="radio" value="custom"><span>Custom %</span></label>
</div>
</fieldset>
<div class="inline" style="margin-top:10px">
<label class="sr-only" for="goalRate">Goal rate</label>
<select aria-label="Goal intensity" class="input" id="goalRate">
<option value="0">Maintain (0%)</option>
<option value="-0.1">Fat loss: Mild (−10%)</option>
<option selected="" value="-0.2">Fat loss: Moderate (−20%)</option>
<option value="-0.25">Fat loss: Aggressive (−25%)</option>
<option value="0.1">Muscle gain: Slow (+10%)</option>
<option value="0.15">Muscle gain: Moderate (+15%)</option>
<option value="0.2">Muscle gain: Faster (+20%)</option>
</select>
<input aria-describedby="goalError" class="input" hidden="" id="goalCustom" inputmode="decimal" placeholder="Custom % (−40 to +40)" step="1" type="number">
</div>
<div aria-live="polite" class="error" id="goalError" role="alert"></div>
</div>
<div aria-hidden="true" class="divider"></div>
<!-- Macro settings -->
<h3 style="margin-top:0.5rem">Macro settings</h3>
<!-- Protein -->
<div class="form-group">
<div class="label-row">
<label for="proteinPerKg">Protein target</label>
<button aria-controls="tip-protein" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="tooltip" hidden="" id="tip-protein">Common evidence-based range: 1.6–2.2 g/kg. Choose basis: total body weight or lean mass if body fat is known.</div>
<div class="inline">
<input aria-describedby="proteinError tip-protein" class="input" id="proteinPerKg" inputmode="decimal" max="3.0" min="0.8" step="0.1" type="number" value="1.8">
<select aria-label="Protein basis" class="input" id="proteinBasis">
<option selected="" value="tbw">g/kg (total weight)</option>
<option value="lbm">g/kg (lean mass)</option>
</select>
</div>
<div aria-live="polite" class="error" id="proteinError" role="alert"></div>
<div aria-live="polite" class="pill" id="proteinMirror" style="margin-top:8px">≈ 0.82 g/lb basis</div>
</div>
<!-- Fat -->
<div class="form-group">
<div class="label-row">
<label for="fatMethod">Fat target</label>
<button aria-controls="tip-fat" aria-expanded="false" class="tooltip-btn" data-tooltip="" type="button">?</button>
</div>
<div class="tooltip" hidden="" id="tip-fat">Use 20–40% of calories or 0.6–1.0 g/kg. Ensure essential fat intake while balancing carbs for performance.</div>
<div class="inline">
<select aria-label="Fat method" class="input" id="fatMethod">
<option selected="" value="percent">Percent of calories</option>
<option value="gkg">g/kg</option>
</select>
<input aria-describedby="fatError" class="input" id="fatPercent" inputmode="decimal" max="60" min="15" step="1" type="number" value="25">
<input aria-describedby="fatError" class="input" hidden="" id="fatPerKg" inputmode="decimal" max="1.5" min="0.4" step="0.1" type="number" value="0.8">
</div>
<div aria-live="polite" class="error" id="fatError" role="alert"></div>
</div>
</section>
<!-- Results -->
<section aria-labelledby="results-heading" class="card">
<h2 id="results-heading" style="margin-top:0">Results</h2>
<div aria-live="polite" class="results">
<div class="result-line">
<span class="result-label">BMR</span>
<span class="result-value" id="bmrOut">—</span>
</div>
<div class="result-line">
<span class="result-label">Activity factor</span>
<span class="result-value" id="activityOut">—</span>
</div>
<div class="result-line">
<span class="result-label">TDEE</span>
<span class="result-value" id="tdeeOut">—</span>
</div>
<div class="result-line">
<span class="result-label">Calorie target</span>
<span class="result-value" id="calorieOut">—</span>
</div>
<div class="result-line">
<span class="result-label">Protein</span>
<span class="result-value" id="proteinOut">—</span>
</div>
<div class="result-line">
<span class="result-label">Fat</span>
<span class="result-value" id="fatOut">—</span>
</div>
<div class="result-line">
<span class="result-label">Carbs</span>
<span class="result-value" id="carbOut">—</span>
</div>
</div>
<p class="author-box">
          Note: Start with these targets and adjust by 5–10% based on your 2–4 week progress and how you feel. This tool does not replace personalized medical or nutrition advice.
        </p>
</section>
</div>
<!-- Authoritative Content Ecosystem -->
<section class="card" style="margin-top:24px">
<h2>Data Source and Methodology</h2>
<ul>
<li>Mifflin MD, St Jeor ST, et al. A new predictive equation for resting energy expenditure in healthy individuals. American Journal of Clinical Nutrition 1990;51(2):241–247. <a href="https://doi.org/10.1093/ajcn/51.2.241" rel="nofollow noopener" target="_blank">DOI</a></li>
<li>Katch VL, McArdle WD. Nutrition, Weight Control, and Exercise. Houghton Mifflin; 1993. (Katch–McArdle BMR: BMR = 370 + 21.6 × LBM[kg])</li>
<li>Activity multipliers adapted from FAO/WHO/UNU Expert Consultation on Human Energy Requirements (2001) and common sports nutrition practice.</li>
<li>Protein guidance synthesized from Morton RW et al., Br J Sports Med. 2018;52:376–384. <a href="https://doi.org/10.1136/bjsports-2017-097608" rel="nofollow noopener" target="_blank">DOI</a></li>
</ul>
<p><strong>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</strong></p>
<h2>The Formula Explained</h2>
<div class="formula-box">
<p>BMR (Mifflin–St Jeor):</p>
<p>For men: \( \mathrm{BMR} = 10W + 6.25H - 5A + 5 \)</p>
<p>For women: \( \mathrm{BMR} = 10W + 6.25H - 5A - 161 \)</p>
<p style="margin-top:8px">BMR (Katch–McArdle): \( \mathrm{BMR} = 370 + 21.6 \times \mathrm{LBM} \)</p>
<p>where \( \mathrm{LBM} = W \times (1 - \frac{\%BF}{100}) \)</p>
<p style="margin-top:8px">Total Daily Energy Expenditure (TDEE): \( \mathrm{TDEE} = \mathrm{BMR} \times \mathrm{Activity} \)</p>
<p>Goal calories: \( \mathrm{Calories}_{target} = \mathrm{TDEE} \times (1 + r) \) where r is goal rate (e.g., −0.20)</p>
<p style="margin-top:8px">Macros:</p>
<p>\( P_{g} = p \times \text{kg basis} \), \( F_{g} = \begin{cases} \frac{f\% \times \mathrm{Calories}}{9} &amp; (\%) \\ f_{kg}\times \text{kg basis} &amp; (\mathrm{g/kg})\end{cases} \)</p>
<p>\( C_{g} = \frac{\mathrm{Calories} - 4P_{g} - 9F_{g}}{4} \)</p>
</div>
<h2>Glossary of Variables</h2>
<ul>
<li>W: Body weight in kilograms (kg).</li>
<li>H: Height in centimeters (cm).</li>
<li>A: Age in years.</li>
<li>%BF: Body fat percentage.</li>
<li>LBM: Lean body mass (kg).</li>
<li>BMR: Basal Metabolic Rate (kcal/day).</li>
<li>TDEE: Total Daily Energy Expenditure (kcal/day).</li>
<li>r: Goal rate as a fraction (e.g., −0.2 = 20% deficit).</li>
<li>P_g, F_g, C_g: Protein, fat, carbohydrate grams per day.</li>
<li>p: Protein in g/kg (basis: body weight or lean mass).</li>
<li>f%: Fat as percent of calories. f_kg: Fat in g/kg.</li>
</ul>
<h2>How It Works: A Step-by-Step Example</h2>
<p><strong>Inputs:</strong> Male, 30 years, 180 cm, 80 kg, 15% body fat, activity 1.55, goal −20%, protein 1.8 g/kg (total body weight), fat 25% calories.</p>
<ol>
<li>BMR (MSJ): 10×80 + 6.25×180 − 5×30 + 5 = 1780 kcal/day.</li>
<li>TDEE: 1780 × 1.55 = 2759 kcal/day.</li>
<li>Target calories: 2759 × (1 − 0.20) = 2207 kcal/day.</li>
<li>Protein: 1.8 × 80 = 144 g (576 kcal).</li>
<li>Fat: 25% × 2207 = 551.8 kcal → 61.3 g.</li>
<li>Carbs: (2207 − 576 − 551.8) / 4 = 269.8 g.</li>
</ol>
<h2>Frequently Asked Questions (FAQ)</h2>
<div>
<h3>Do I need my body fat percentage?</h3>
<p>No. If you don’t know it, use Mifflin–St Jeor. If you have a good estimate, Katch–McArdle can personalize BMR via lean mass.</p>
<h3>What if my carbs calculate as negative?</h3>
<p>Reduce protein or fat targets, or increase total calories. Very high protein plus high fat at low calories can leave no room for carbs.</p>
<h3>How fast should I lose or gain?</h3>
<p>Common guidance: lose 0.25–1.0% body weight per week; gain 0.25–0.5% to minimize fat gain. Adjust the goal percentage accordingly.</p>
<h3>Are activity multipliers accurate for athletes?</h3>
<p>They are averages. Endurance or physically demanding jobs may require higher multipliers. Use weight trends to calibrate.</p>
<h3>Should protein be based on lean mass or total weight?</h3>
<p>If body fat is high or known, lean-mass basis can be more appropriate. Otherwise, total body weight basis is fine.</p>
<h3>Is fiber included?</h3>
<p>This calculator targets total carbohydrates. Aim for 25–35 g/day of fiber from whole foods for health and satiety.</p>
<h3>Can I export or print results?</h3>
<p>Copy the results into your notes or a meal-planning tool. A print-friendly layout is supported by your browser.</p>
</div>
<div class="author-box">
        Strumento sviluppato da <strong>Ugo Candido</strong>,. Contenuti verificati da,.
        <br>
        Ultima revisione per l'accuratezza in data: <time id="reviewDate"></time>.
      </div>
</section>

<!-- AUDIT_SPINE_START -->
<hr class="auditspine-hr">
<section aria-label="Formulas, sources, changelog, verification">
  <span class="auditspine-badge">Audit: Complete</span>

  <details style="margin-top:10px">
    <summary><strong>Formula (LaTeX) + variables + units</strong></summary>
    <div class="auditspine-note" style="margin-top:10px">
      This section shows the formulas used by the calculator engine, plus variable definitions and units.
      
    </div>
    <div class="auditspine-formula">
      <div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[','\]</div>
  <pre class="auditspine-mono">','</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[= sel =&gt; Array.from(document.querySelectorAll(sel)); const clamp = (v, min, max) =&gt; Math.max(min, Math.min(max, v)); const toNumber = (v) =&gt; { const n = Number(v); return Number.isFinite(n) ? n : NaN; }; const formatKcal = n =&gt; isFinite(n) ? Math.round(n).toLocaleString() + ' kcal' : '—'; const formatGrams = n =&gt; isFinite(n) ? Math.round(n) + ' g' : '—'; const inchesFromFtIn = (ft, inch) =&gt; (ft*12 + inch); const cmFromInches = inches =&gt; inches * 2.54; const kgFromLb = lb =&gt; lb * 0.45359237; const lbFromKg = kg =&gt; kg / 0.45359237; // Elements const ageEl = $('#age'); const heightCmEl = $('#heightCm'); const heightFtEl = $('#heightFt'); const heightInEl = $('#heightIn'); const weightKgEl = $('#weightKg'); const weightLbEl = $('#weightLb'); const bodyFatEl = $('#bodyFat'); const unitsMetricEl = $('#unitsMetric'); const unitsImperialEl = $('#unitsImperial'); const heightMetricGroup = $('#heightMetricGroup'); const heightImperialGroup = $('#heightImperialGroup'); const weightMetricGroup = $('#weightMetricGroup'); const weightImperialGroup = $('#weightImperialGroup'); const eqMSJ = $('#eqMSJ'); const eqKM = $('#eqKM'); const equationNote = $('#equationNote'); const activityEl = $('#activity'); const proteinPerKgEl = $('#proteinPerKg'); const proteinBasisEl = $('#proteinBasis'); const proteinMirrorEl = $('#proteinMirror'); const fatMethodEl = $('#fatMethod'); const fatPercentEl = $('#fatPercent'); const fatPerKgEl = $('#fatPerKg'); const goalRateEl = $('#goalRate'); const goalCustomEl = $('#goalCustom'); const errors = { age: $('#ageError'), height: $('#heightError'), heightImp: $('#heightImpError'), weight: $('#weightError'), weightImp: $('#weightImpError'), bodyFat: $('#bodyFatError'), activity: $('#activityError'), goal: $('#goalError'), }; const outputs = { bmr: $('#bmrOut'), act: $('#activityOut'), tdee: $('#tdeeOut'), cal: $('#calorieOut'), protein: $('#proteinOut'), fat: $('#fatOut'), carbs: $('#carbOut') }; // Tooltips\]</div>
  <pre class="auditspine-mono">= sel =&gt; Array.from(document.querySelectorAll(sel)); const clamp = (v, min, max) =&gt; Math.max(min, Math.min(max, v)); const toNumber = (v) =&gt; { const n = Number(v); return Number.isFinite(n) ? n : NaN; }; const formatKcal = n =&gt; isFinite(n) ? Math.round(n).toLocaleString() + ' kcal' : '—'; const formatGrams = n =&gt; isFinite(n) ? Math.round(n) + ' g' : '—'; const inchesFromFtIn = (ft, inch) =&gt; (ft*12 + inch); const cmFromInches = inches =&gt; inches * 2.54; const kgFromLb = lb =&gt; lb * 0.45359237; const lbFromKg = kg =&gt; kg / 0.45359237; // Elements const ageEl = $('#age'); const heightCmEl = $('#heightCm'); const heightFtEl = $('#heightFt'); const heightInEl = $('#heightIn'); const weightKgEl = $('#weightKg'); const weightLbEl = $('#weightLb'); const bodyFatEl = $('#bodyFat'); const unitsMetricEl = $('#unitsMetric'); const unitsImperialEl = $('#unitsImperial'); const heightMetricGroup = $('#heightMetricGroup'); const heightImperialGroup = $('#heightImperialGroup'); const weightMetricGroup = $('#weightMetricGroup'); const weightImperialGroup = $('#weightImperialGroup'); const eqMSJ = $('#eqMSJ'); const eqKM = $('#eqKM'); const equationNote = $('#equationNote'); const activityEl = $('#activity'); const proteinPerKgEl = $('#proteinPerKg'); const proteinBasisEl = $('#proteinBasis'); const proteinMirrorEl = $('#proteinMirror'); const fatMethodEl = $('#fatMethod'); const fatPercentEl = $('#fatPercent'); const fatPerKgEl = $('#fatPerKg'); const goalRateEl = $('#goalRate'); const goalCustomEl = $('#goalCustom'); const errors = { age: $('#ageError'), height: $('#heightError'), heightImp: $('#heightImpError'), weight: $('#weightError'), weightImp: $('#weightImpError'), bodyFat: $('#bodyFatError'), activity: $('#activityError'), goal: $('#goalError'), }; const outputs = { bmr: $('#bmrOut'), act: $('#activityOut'), tdee: $('#tdeeOut'), cal: $('#calorieOut'), protein: $('#proteinOut'), fat: $('#fatOut'), carbs: $('#carbOut') }; // Tooltips</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[('input[name="goal"]').forEach(r =&gt; r.addEventListener('change', () =&gt; { syncGoalUI(); compute(); })); goalRateEl.addEventListener('change', () =&gt; compute()); goalCustomEl.addEventListener('input', () =&gt; compute()); syncGoalUI(); // Fat method UI function syncFatUI(){ const method = fatMethodEl.value; if (method === 'percent') { fatPercentEl.hidden = false; fatPerKgEl.hidden = true; } else { fatPercentEl.hidden = true; fatPerKgEl.hidden = false; } } fatMethodEl.addEventListener('change', () =&gt; { syncFatUI(); compute(); }); fatPercentEl.addEventListener('input', compute); fatPerKgEl.addEventListener('input', compute); syncFatUI(); // Protein mirror to per-lb for clarity function updateProteinMirror(){ const perKg = toNumber(proteinPerKgEl.value); if (!isFinite(perKg)) { proteinMirrorEl.textContent = '—'; return; } const perLb = perKg / 2.2046226218; // g/kg to g/lb proteinMirrorEl.textContent = '≈ ' + (Math.round(perLb*100)/100).toFixed(2) + ' g/lb basis'; } proteinPerKgEl.addEventListener('input', () =&gt; { updateProteinMirror(); compute(); }); proteinBasisEl.addEventListener('change', compute); updateProteinMirror(); // Validation helpers function setError(el, msg, key){ el.setAttribute('aria-invalid', 'true'); if (key &amp;&amp; errors[key]) errors[key].textContent = msg; } function clearError(el, key){ el.removeAttribute('aria-invalid'); if (key &amp;&amp; errors[key]) errors[key].textContent = ''; } // Field-level validation (on blur) ageEl.addEventListener('blur', () =&gt; { const v = toNumber(ageEl.value); if (!isFinite(v) || v &lt; 10 || v &gt; 100) setError(ageEl, 'Please enter an age between 10 and 100.', 'age'); else clearError(ageEl, 'age'); }); heightCmEl.addEventListener('blur', () =&gt; { const v = toNumber(heightCmEl.value); if (!isFinite(v) || v &lt; 120 || v &gt; 230) setError(heightCmEl, 'Height must be between 120 and 230 cm.', 'height'); else clearError(heightCmEl, 'height'); }); heightFtEl.addEventListener('blur', () =&gt; { const ft = toNumber(heightFtEl.value), inch = toNumber(heightInEl.value); if (!isFinite(ft) || !isFinite(inch) || ft &lt; 4 || ft &gt; 7 || inch &lt; 0 || inch &gt; 11) setError(heightFtEl, 'Enter a valid height between 4’0” and 7’11”.', 'heightImp'); else clearError(heightFtEl, 'heightImp'); }); heightInEl.addEventListener('blur', () =&gt; { const ft = toNumber(heightFtEl.value), inch = toNumber(heightInEl.value); if (!isFinite(ft) || !isFinite(inch) || ft &lt; 4 || ft &gt; 7 || inch &lt; 0 || inch &gt; 11) setError(heightInEl, 'Enter a valid height between 4’0” and 7’11”.', 'heightImp'); else clearError(heightInEl, 'heightImp'); }); weightKgEl.addEventListener('blur', () =&gt; { const v = toNumber(weightKgEl.value); if (!isFinite(v) || v &lt; 30 || v &gt; 300) setError(weightKgEl, 'Weight must be between 30 and 300 kg.', 'weight'); else clearError(weightKgEl, 'weight'); }); weightLbEl.addEventListener('blur', () =&gt; { const v = toNumber(weightLbEl.value); if (!isFinite(v) || v &lt; 66 || v &gt; 660) setError(weightLbEl, 'Weight must be between 66 and 660 lb.', 'weightImp'); else clearError(weightLbEl, 'weightImp'); }); bodyFatEl.addEventListener('blur', () =&gt; { const v = toNumber(bodyFatEl.value); if (bodyFatEl.value === '') { clearError(bodyFatEl, 'bodyFat'); return; } if (!isFinite(v) || v &lt; 3 || v &gt; 60) setError(bodyFatEl, 'Enter body fat between 3% and 60%, or leave empty.', 'bodyFat'); else clearError(bodyFatEl, 'bodyFat'); }); activityEl.addEventListener('blur', () =&gt; { const v = toNumber(activityEl.value); if (!isFinite(v) || v &lt; 1.1 || v &gt; 2.5) setError(activityEl, 'Please select a valid activity level.', 'activity'); else clearError(activityEl, 'activity'); }); // Equation note when Katch requires BF% function checkEquationRequirement(){ if (eqKM.checked) { const bf = toNumber(bodyFatEl.value); if (!isFinite(bf)) { equationNote.textContent = 'Katch–McArdle requires a valid body fat percentage.'; } else { equationNote.textContent = ''; } } else { equationNote.textContent = ''; } } eqMSJ.addEventListener('change', () =&gt; { checkEquationRequirement(); compute(); }); eqKM.addEventListener('change', () =&gt; { checkEquationRequirement(); compute(); }); bodyFatEl.addEventListener('input', () =&gt; { checkEquationRequirement(); compute(); }); // Input events -&gt; compute [ageEl, heightCmEl, heightFtEl, heightInEl, weightKgEl, weightLbEl, activityEl].forEach(el =&gt; { el.addEventListener('input', compute); });\]</div>
  <pre class="auditspine-mono">('input[name="goal"]').forEach(r =&gt; r.addEventListener('change', () =&gt; { syncGoalUI(); compute(); })); goalRateEl.addEventListener('change', () =&gt; compute()); goalCustomEl.addEventListener('input', () =&gt; compute()); syncGoalUI(); // Fat method UI function syncFatUI(){ const method = fatMethodEl.value; if (method === 'percent') { fatPercentEl.hidden = false; fatPerKgEl.hidden = true; } else { fatPercentEl.hidden = true; fatPerKgEl.hidden = false; } } fatMethodEl.addEventListener('change', () =&gt; { syncFatUI(); compute(); }); fatPercentEl.addEventListener('input', compute); fatPerKgEl.addEventListener('input', compute); syncFatUI(); // Protein mirror to per-lb for clarity function updateProteinMirror(){ const perKg = toNumber(proteinPerKgEl.value); if (!isFinite(perKg)) { proteinMirrorEl.textContent = '—'; return; } const perLb = perKg / 2.2046226218; // g/kg to g/lb proteinMirrorEl.textContent = '≈ ' + (Math.round(perLb*100)/100).toFixed(2) + ' g/lb basis'; } proteinPerKgEl.addEventListener('input', () =&gt; { updateProteinMirror(); compute(); }); proteinBasisEl.addEventListener('change', compute); updateProteinMirror(); // Validation helpers function setError(el, msg, key){ el.setAttribute('aria-invalid', 'true'); if (key &amp;&amp; errors[key]) errors[key].textContent = msg; } function clearError(el, key){ el.removeAttribute('aria-invalid'); if (key &amp;&amp; errors[key]) errors[key].textContent = ''; } // Field-level validation (on blur) ageEl.addEventListener('blur', () =&gt; { const v = toNumber(ageEl.value); if (!isFinite(v) || v &lt; 10 || v &gt; 100) setError(ageEl, 'Please enter an age between 10 and 100.', 'age'); else clearError(ageEl, 'age'); }); heightCmEl.addEventListener('blur', () =&gt; { const v = toNumber(heightCmEl.value); if (!isFinite(v) || v &lt; 120 || v &gt; 230) setError(heightCmEl, 'Height must be between 120 and 230 cm.', 'height'); else clearError(heightCmEl, 'height'); }); heightFtEl.addEventListener('blur', () =&gt; { const ft = toNumber(heightFtEl.value), inch = toNumber(heightInEl.value); if (!isFinite(ft) || !isFinite(inch) || ft &lt; 4 || ft &gt; 7 || inch &lt; 0 || inch &gt; 11) setError(heightFtEl, 'Enter a valid height between 4’0” and 7’11”.', 'heightImp'); else clearError(heightFtEl, 'heightImp'); }); heightInEl.addEventListener('blur', () =&gt; { const ft = toNumber(heightFtEl.value), inch = toNumber(heightInEl.value); if (!isFinite(ft) || !isFinite(inch) || ft &lt; 4 || ft &gt; 7 || inch &lt; 0 || inch &gt; 11) setError(heightInEl, 'Enter a valid height between 4’0” and 7’11”.', 'heightImp'); else clearError(heightInEl, 'heightImp'); }); weightKgEl.addEventListener('blur', () =&gt; { const v = toNumber(weightKgEl.value); if (!isFinite(v) || v &lt; 30 || v &gt; 300) setError(weightKgEl, 'Weight must be between 30 and 300 kg.', 'weight'); else clearError(weightKgEl, 'weight'); }); weightLbEl.addEventListener('blur', () =&gt; { const v = toNumber(weightLbEl.value); if (!isFinite(v) || v &lt; 66 || v &gt; 660) setError(weightLbEl, 'Weight must be between 66 and 660 lb.', 'weightImp'); else clearError(weightLbEl, 'weightImp'); }); bodyFatEl.addEventListener('blur', () =&gt; { const v = toNumber(bodyFatEl.value); if (bodyFatEl.value === '') { clearError(bodyFatEl, 'bodyFat'); return; } if (!isFinite(v) || v &lt; 3 || v &gt; 60) setError(bodyFatEl, 'Enter body fat between 3% and 60%, or leave empty.', 'bodyFat'); else clearError(bodyFatEl, 'bodyFat'); }); activityEl.addEventListener('blur', () =&gt; { const v = toNumber(activityEl.value); if (!isFinite(v) || v &lt; 1.1 || v &gt; 2.5) setError(activityEl, 'Please select a valid activity level.', 'activity'); else clearError(activityEl, 'activity'); }); // Equation note when Katch requires BF% function checkEquationRequirement(){ if (eqKM.checked) { const bf = toNumber(bodyFatEl.value); if (!isFinite(bf)) { equationNote.textContent = 'Katch–McArdle requires a valid body fat percentage.'; } else { equationNote.textContent = ''; } } else { equationNote.textContent = ''; } } eqMSJ.addEventListener('change', () =&gt; { checkEquationRequirement(); compute(); }); eqKM.addEventListener('change', () =&gt; { checkEquationRequirement(); compute(); }); bodyFatEl.addEventListener('input', () =&gt; { checkEquationRequirement(); compute(); }); // Input events -&gt; compute [ageEl, heightCmEl, heightFtEl, heightInEl, weightKgEl, weightLbEl, activityEl].forEach(el =&gt; { el.addEventListener('input', compute); });</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted LaTeX)</strong></div>
  <div style="margin-top:6px">\[('input[name="units"]').forEach(el =&gt; el.addEventListener('change', () =&gt; { applyUnitsUI(); compute(); })); function getInputs(){ const metric = unitsMetricEl.checked; const sex = (document.querySelector('input[name="sex"]:checked')||{}).value || 'male'; const age = toNumber(ageEl.value); const activity = toNumber(activityEl.value); const equation = eqKM.checked ? 'km' : 'msj'; let heightCm, weightKg; if (metric) { heightCm = toNumber(heightCmEl.value); weightKg = toNumber(weightKgEl.value); } else { const ft = toNumber(heightFtEl.value); const inch = toNumber(heightInEl.value); const inches = inchesFromFtIn(ft, inch); heightCm = cmFromInches(inches); weightKg = kgFromLb(toNumber(weightLbEl.value)); } const bf = bodyFatEl.value === '' ? NaN : toNumber(bodyFatEl.value); // Goal rate const goal = (document.querySelector('input[name="goal"]:checked') || {}).value || 'maintain'; let rate = 0; if (goal === 'custom') { const custom = toNumber(goalCustomEl.value); rate = isFinite(custom) ? clamp(custom, -40, 40) / 100 : 0; if (!isFinite(custom)) errors.goal.textContent = 'Enter a custom percentage between −40 and +40.'; else errors.goal.textContent = ''; } else { rate = toNumber(goalRateEl.value); } // Macros const pPerKg = toNumber(proteinPerKgEl.value); const pBasis = proteinBasisEl.value; // 'tbw' or 'lbm' const fatMethod = fatMethodEl.value; const fatPercent = toNumber(fatPercentEl.value); const fatPerKg = toNumber(fatPerKgEl.value); return { metric, sex, age, heightCm, weightKg, bf, activity, equation, goal, rate, pPerKg, pBasis, fatMethod, fatPercent, fatPerKg }; } function compute(){ const inp = getInputs(); // Basic validity const validAge = isFinite(inp.age) &amp;&amp; inp.age &gt;= 10 &amp;&amp; inp.age &lt;= 100; const validH = isFinite(inp.heightCm) &amp;&amp; inp.heightCm &gt;= 120 &amp;&amp; inp.heightCm &lt;= 230; const validW = isFinite(inp.weightKg) &amp;&amp; inp.weightKg &gt;= 30 &amp;&amp; inp.weightKg &lt;= 300; const validAct = isFinite(inp.activity) &amp;&amp; inp.activity &gt;= 1.1 &amp;&amp; inp.activity &lt;= 2.5; if (!validAge || !validH || !validW || !validAct) { outputs.bmr.textContent = '—'; outputs.tdee.textContent = '—'; outputs.act.textContent = '—'; outputs.cal.textContent = '—'; outputs.protein.textContent = '—'; outputs.fat.textContent = '—'; outputs.carbs.textContent = '—'; return; } // BMR let bmr = NaN; if (inp.equation === 'msj') { const s = (inp.sex === 'male') ? 5 : -161; bmr = 10*inp.weightKg + 6.25*inp.heightCm - 5*inp.age + s; } else { const bf = toNumber(inp.bf); if (isFinite(bf)) { const lbm = inp.weightKg * (1 - bf / 100); bmr = 370 + 21.6 * lbm; } else { outputs.bmr.textContent = '—'; outputs.tdee.textContent = '—'; outputs.act.textContent = '—'; outputs.cal.textContent = '—'; outputs.protein.textContent = '—'; outputs.fat.textContent = '—'; outputs.carbs.textContent = '—'; return; } } const tdee = bmr * inp.activity; const targetCalories = tdee * (1 + inp.rate); // Protein grams let kgBasis = inp.weightKg; if (inp.pBasis === 'lbm') { if (isFinite(inp.bf)) { kgBasis = inp.weightKg * (1 - inp.bf / 100); } else { // fall back to TBW if no BF% kgBasis = inp.weightKg; } } const proteinG = Math.max(0, inp.pPerKg * kgBasis); // Fat grams let fatG = 0; if (inp.fatMethod === 'percent') { const pct = clamp(isFinite(inp.fatPercent) ? inp.fatPercent : 25, 5, 80) / 100; fatG = (targetCalories * pct) / 9; } else { const perKg = clamp(isFinite(inp.fatPerKg) ? inp.fatPerKg : 0.8, 0.2, 3.0); fatG = perKg * kgBasis; } // Carbs grams const remainingKcal = targetCalories - (proteinG * 4) - (fatG * 9); const carbsG = Math.max(0, remainingKcal / 4); // Output outputs.bmr.textContent = formatKcal(bmr); outputs.act.textContent = inp.activity.toFixed(2); outputs.tdee.textContent = formatKcal(tdee); outputs.cal.textContent = formatKcal(targetCalories); outputs.protein.textContent = formatGrams(proteinG); outputs.fat.textContent = formatGrams(fatG); outputs.carbs.textContent = formatGrams(carbsG); } // Initial compute compute(); // Footer dates const y = new Date().getFullYear(); const review = new Date(); $('#year').textContent = y; $('#reviewDate').textContent = review.toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' }); // Keyboard accessibility for radio "cards"\]</div>
  <pre class="auditspine-mono">('input[name="units"]').forEach(el =&gt; el.addEventListener('change', () =&gt; { applyUnitsUI(); compute(); })); function getInputs(){ const metric = unitsMetricEl.checked; const sex = (document.querySelector('input[name="sex"]:checked')||{}).value || 'male'; const age = toNumber(ageEl.value); const activity = toNumber(activityEl.value); const equation = eqKM.checked ? 'km' : 'msj'; let heightCm, weightKg; if (metric) { heightCm = toNumber(heightCmEl.value); weightKg = toNumber(weightKgEl.value); } else { const ft = toNumber(heightFtEl.value); const inch = toNumber(heightInEl.value); const inches = inchesFromFtIn(ft, inch); heightCm = cmFromInches(inches); weightKg = kgFromLb(toNumber(weightLbEl.value)); } const bf = bodyFatEl.value === '' ? NaN : toNumber(bodyFatEl.value); // Goal rate const goal = (document.querySelector('input[name="goal"]:checked') || {}).value || 'maintain'; let rate = 0; if (goal === 'custom') { const custom = toNumber(goalCustomEl.value); rate = isFinite(custom) ? clamp(custom, -40, 40) / 100 : 0; if (!isFinite(custom)) errors.goal.textContent = 'Enter a custom percentage between −40 and +40.'; else errors.goal.textContent = ''; } else { rate = toNumber(goalRateEl.value); } // Macros const pPerKg = toNumber(proteinPerKgEl.value); const pBasis = proteinBasisEl.value; // 'tbw' or 'lbm' const fatMethod = fatMethodEl.value; const fatPercent = toNumber(fatPercentEl.value); const fatPerKg = toNumber(fatPerKgEl.value); return { metric, sex, age, heightCm, weightKg, bf, activity, equation, goal, rate, pPerKg, pBasis, fatMethod, fatPercent, fatPerKg }; } function compute(){ const inp = getInputs(); // Basic validity const validAge = isFinite(inp.age) &amp;&amp; inp.age &gt;= 10 &amp;&amp; inp.age &lt;= 100; const validH = isFinite(inp.heightCm) &amp;&amp; inp.heightCm &gt;= 120 &amp;&amp; inp.heightCm &lt;= 230; const validW = isFinite(inp.weightKg) &amp;&amp; inp.weightKg &gt;= 30 &amp;&amp; inp.weightKg &lt;= 300; const validAct = isFinite(inp.activity) &amp;&amp; inp.activity &gt;= 1.1 &amp;&amp; inp.activity &lt;= 2.5; if (!validAge || !validH || !validW || !validAct) { outputs.bmr.textContent = '—'; outputs.tdee.textContent = '—'; outputs.act.textContent = '—'; outputs.cal.textContent = '—'; outputs.protein.textContent = '—'; outputs.fat.textContent = '—'; outputs.carbs.textContent = '—'; return; } // BMR let bmr = NaN; if (inp.equation === 'msj') { const s = (inp.sex === 'male') ? 5 : -161; bmr = 10*inp.weightKg + 6.25*inp.heightCm - 5*inp.age + s; } else { const bf = toNumber(inp.bf); if (isFinite(bf)) { const lbm = inp.weightKg * (1 - bf / 100); bmr = 370 + 21.6 * lbm; } else { outputs.bmr.textContent = '—'; outputs.tdee.textContent = '—'; outputs.act.textContent = '—'; outputs.cal.textContent = '—'; outputs.protein.textContent = '—'; outputs.fat.textContent = '—'; outputs.carbs.textContent = '—'; return; } } const tdee = bmr * inp.activity; const targetCalories = tdee * (1 + inp.rate); // Protein grams let kgBasis = inp.weightKg; if (inp.pBasis === 'lbm') { if (isFinite(inp.bf)) { kgBasis = inp.weightKg * (1 - inp.bf / 100); } else { // fall back to TBW if no BF% kgBasis = inp.weightKg; } } const proteinG = Math.max(0, inp.pPerKg * kgBasis); // Fat grams let fatG = 0; if (inp.fatMethod === 'percent') { const pct = clamp(isFinite(inp.fatPercent) ? inp.fatPercent : 25, 5, 80) / 100; fatG = (targetCalories * pct) / 9; } else { const perKg = clamp(isFinite(inp.fatPerKg) ? inp.fatPerKg : 0.8, 0.2, 3.0); fatG = perKg * kgBasis; } // Carbs grams const remainingKcal = targetCalories - (proteinG * 4) - (fatG * 9); const carbsG = Math.max(0, remainingKcal / 4); // Output outputs.bmr.textContent = formatKcal(bmr); outputs.act.textContent = inp.activity.toFixed(2); outputs.tdee.textContent = formatKcal(tdee); outputs.cal.textContent = formatKcal(targetCalories); outputs.protein.textContent = formatGrams(proteinG); outputs.fat.textContent = formatGrams(fatG); outputs.carbs.textContent = formatGrams(carbsG); } // Initial compute compute(); // Footer dates const y = new Date().getFullYear(); const review = new Date(); $('#year').textContent = y; $('#reviewDate').textContent = review.toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' }); // Keyboard accessibility for radio "cards"</pre>
</div>
<div style="margin:10px 0">
  <div><strong>Formula (extracted text)</strong></div>
  
  <pre class="auditspine-mono">BMR (Mifflin–St Jeor): For men: \( \mathrm{BMR} = 10W + 6.25H - 5A + 5 \) For women: \( \mathrm{BMR} = 10W + 6.25H - 5A - 161 \) BMR (Katch–McArdle): \( \mathrm{BMR} = 370 + 21.6 \times \mathrm{LBM} \) where \( \mathrm{LBM} = W \times (1 - \frac{\%BF}{100}) \) Total Daily Energy Expenditure (TDEE): \( \mathrm{TDEE} = \mathrm{BMR} \times \mathrm{Activity} \) Goal calories: \( \mathrm{Calories}_{target} = \mathrm{TDEE} \times (1 + r) \) where r is goal rate (e.g., −0.20) Macros: \( P_{g} = p \times \text{kg basis} \), \( F_{g} = \begin{cases} \frac{f\% \times \mathrm{Calories}}{9} &amp; (\%) \\ f_{kg}\times \text{kg basis} &amp; (\mathrm{g/kg})\end{cases} \) \( C_{g} = \frac{\mathrm{Calories} - 4P_{g} - 9F_{g}}{4} \)</pre>
</div>
      <div style="margin-top:12px"><strong>Variables and units</strong></div>
      <ul style="margin:8px 0 0 18px">
        <li><em>No variables provided in audit spec.</em></li>
      </ul>
    </div>
  </details>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Sources (authoritative):</strong>
    <ul style="margin:8px 0 0 18px">
      <li><strong>Health and Fitness</strong> — calcdomain.com · Accessed 2026-01-19<br><a href="https://calcdomain.com/health-fitness" target="_blank" rel="nofollow noopener">https://calcdomain.com/health-fitness</a></li>
<li><strong>DOI</strong> — doi.org · Accessed 2026-01-19<br><a href="https://doi.org/10.1093/ajcn/51.2.241" target="_blank" rel="nofollow noopener">https://doi.org/10.1093/ajcn/51.2.241</a></li>
<li><strong>DOI</strong> — doi.org · Accessed 2026-01-19<br><a href="https://doi.org/10.1136/bjsports-2017-097608" target="_blank" rel="nofollow noopener">https://doi.org/10.1136/bjsports-2017-097608</a></li>
    </ul>
  </div>

  <div class="auditspine-changelog" style="margin-top:12px">
    <strong>Changelog</strong><br>
    <div style="margin-top:6px">
      <strong>Version:</strong> 0.1.0-draft<br>
      <strong>Last code update:</strong> 2026-01-19
    </div>
    <div style="margin-top:10px">
  <strong>0.1.0-draft</strong> · 2026-01-19
  <ul style="margin:6px 0 0 18px">
    <li>Initial audit spec draft generated from HTML extraction (review required).</li>
<li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
<li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
  </ul>
</div>
  </div>

  <div class="auditspine-note" style="margin-top:12px">
    <strong>Verified by Ugo Candido on 2026-01-19</strong><br>
    <a href="https://calcdomain.com/ugocandido" target="_blank" rel="noopener">Profile</a> ·
    <a href="https://www.linkedin.com/in/ugocandido92821/" target="_blank" rel="noopener">LinkedIn</a>
  </div>
</section>
<!-- AUDIT_SPINE_END -->
</main>
<!-- Standard Footer --> 
<script defer="">
  (function(){
    'use strict';

    // Utilities
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const toNumber = (v) => {
      const n = Number(v);
      return Number.isFinite(n) ? n : NaN;
    };
    const formatKcal = n => isFinite(n) ? Math.round(n).toLocaleString() + ' kcal' : '—';
    const formatGrams = n => isFinite(n) ? Math.round(n) + ' g' : '—';
    const inchesFromFtIn = (ft, inch) => (ft*12 + inch);
    const cmFromInches = inches => inches * 2.54;
    const kgFromLb = lb => lb * 0.45359237;
    const lbFromKg = kg => kg / 0.45359237;

    // Elements
    const ageEl = $('#age');
    const heightCmEl = $('#heightCm');
    const heightFtEl = $('#heightFt');
    const heightInEl = $('#heightIn');
    const weightKgEl = $('#weightKg');
    const weightLbEl = $('#weightLb');
    const bodyFatEl = $('#bodyFat');
    const unitsMetricEl = $('#unitsMetric');
    const unitsImperialEl = $('#unitsImperial');
    const heightMetricGroup = $('#heightMetricGroup');
    const heightImperialGroup = $('#heightImperialGroup');
    const weightMetricGroup = $('#weightMetricGroup');
    const weightImperialGroup = $('#weightImperialGroup');
    const eqMSJ = $('#eqMSJ');
    const eqKM = $('#eqKM');
    const equationNote = $('#equationNote');
    const activityEl = $('#activity');
    const proteinPerKgEl = $('#proteinPerKg');
    const proteinBasisEl = $('#proteinBasis');
    const proteinMirrorEl = $('#proteinMirror');
    const fatMethodEl = $('#fatMethod');
    const fatPercentEl = $('#fatPercent');
    const fatPerKgEl = $('#fatPerKg');
    const goalRateEl = $('#goalRate');
    const goalCustomEl = $('#goalCustom');

    const errors = {
      age: $('#ageError'),
      height: $('#heightError'),
      heightImp: $('#heightImpError'),
      weight: $('#weightError'),
      weightImp: $('#weightImpError'),
      bodyFat: $('#bodyFatError'),
      activity: $('#activityError'),
      goal: $('#goalError'),
    };

    const outputs = {
      bmr: $('#bmrOut'),
      act: $('#activityOut'),
      tdee: $('#tdeeOut'),
      cal: $('#calorieOut'),
      protein: $('#proteinOut'),
      fat: $('#fatOut'),
      carbs: $('#carbOut')
    };

    // Tooltips
    $$('[data-tooltip]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('aria-controls');
        const tip = document.getElementById(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        if (tip) tip.hidden = expanded;
      });
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
      });
    });

    // Units toggle
    function applyUnitsUI() {
      const metric = unitsMetricEl.checked;
      heightMetricGroup.hidden = !metric;
      heightImperialGroup.hidden = metric;
      weightMetricGroup.hidden = !metric;
      weightImperialGroup.hidden = metric;
    }
    unitsMetricEl.addEventListener('change', applyUnitsUI);
    unitsImperialEl.addEventListener('change', applyUnitsUI);
    applyUnitsUI();

    // Goal handling
    function syncGoalUI() {
      const goal = (document.querySelector('input[name="goal"]:checked') || {}).value;
      if (goal === 'maintain') {
        goalRateEl.value = '0';
        goalRateEl.disabled = true;
        goalCustomEl.hidden = true;
      } else if (goal === 'custom') {
        goalRateEl.disabled = true;
        goalCustomEl.hidden = false;
      } else if (goal === 'lose') {
        goalRateEl.disabled = false;
        goalCustomEl.hidden = true;
        // Select first negative if not negative
        if (parseFloat(goalRateEl.value) >= 0) goalRateEl.value = '-0.2';
      } else if (goal === 'gain') {
        goalRateEl.disabled = false;
        goalCustomEl.hidden = true;
        if (parseFloat(goalRateEl.value) <= 0) goalRateEl.value = '0.1';
      }
    }
    $$('input[name="goal"]').forEach(r => r.addEventListener('change', () => { syncGoalUI(); compute(); }));
    goalRateEl.addEventListener('change', () => compute());
    goalCustomEl.addEventListener('input', () => compute());
    syncGoalUI();

    // Fat method UI
    function syncFatUI(){
      const method = fatMethodEl.value;
      if (method === 'percent') {
        fatPercentEl.hidden = false;
        fatPerKgEl.hidden = true;
      } else {
        fatPercentEl.hidden = true;
        fatPerKgEl.hidden = false;
      }
    }
    fatMethodEl.addEventListener('change', () => { syncFatUI(); compute(); });
    fatPercentEl.addEventListener('input', compute);
    fatPerKgEl.addEventListener('input', compute);
    syncFatUI();

    // Protein mirror to per-lb for clarity
    function updateProteinMirror(){
      const perKg = toNumber(proteinPerKgEl.value);
      if (!isFinite(perKg)) {
        proteinMirrorEl.textContent = '—';
        return;
      }
      const perLb = perKg / 2.2046226218; // g/kg to g/lb
      proteinMirrorEl.textContent = '≈ ' + (Math.round(perLb*100)/100).toFixed(2) + ' g/lb basis';
    }
    proteinPerKgEl.addEventListener('input', () => { updateProteinMirror(); compute(); });
    proteinBasisEl.addEventListener('change', compute);
    updateProteinMirror();

    // Validation helpers
    function setError(el, msg, key){
      el.setAttribute('aria-invalid', 'true');
      if (key && errors[key]) errors[key].textContent = msg;
    }
    function clearError(el, key){
      el.removeAttribute('aria-invalid');
      if (key && errors[key]) errors[key].textContent = '';
    }

    // Field-level validation (on blur)
    ageEl.addEventListener('blur', () => {
      const v = toNumber(ageEl.value);
      if (!isFinite(v) || v < 10 || v > 100) setError(ageEl, 'Please enter an age between 10 and 100.', 'age'); else clearError(ageEl, 'age');
    });
    heightCmEl.addEventListener('blur', () => {
      const v = toNumber(heightCmEl.value);
      if (!isFinite(v) || v < 120 || v > 230) setError(heightCmEl, 'Height must be between 120 and 230 cm.', 'height'); else clearError(heightCmEl, 'height');
    });
    heightFtEl.addEventListener('blur', () => {
      const ft = toNumber(heightFtEl.value), inch = toNumber(heightInEl.value);
      if (!isFinite(ft) || !isFinite(inch) || ft < 4 || ft > 7 || inch < 0 || inch > 11) setError(heightFtEl, 'Enter a valid height between 4’0” and 7’11”.', 'heightImp'); else clearError(heightFtEl, 'heightImp');
    });
    heightInEl.addEventListener('blur', () => {
      const ft = toNumber(heightFtEl.value), inch = toNumber(heightInEl.value);
      if (!isFinite(ft) || !isFinite(inch) || ft < 4 || ft > 7 || inch < 0 || inch > 11) setError(heightInEl, 'Enter a valid height between 4’0” and 7’11”.', 'heightImp'); else clearError(heightInEl, 'heightImp');
    });
    weightKgEl.addEventListener('blur', () => {
      const v = toNumber(weightKgEl.value);
      if (!isFinite(v) || v < 30 || v > 300) setError(weightKgEl, 'Weight must be between 30 and 300 kg.', 'weight'); else clearError(weightKgEl, 'weight');
    });
    weightLbEl.addEventListener('blur', () => {
      const v = toNumber(weightLbEl.value);
      if (!isFinite(v) || v < 66 || v > 660) setError(weightLbEl, 'Weight must be between 66 and 660 lb.', 'weightImp'); else clearError(weightLbEl, 'weightImp');
    });
    bodyFatEl.addEventListener('blur', () => {
      const v = toNumber(bodyFatEl.value);
      if (bodyFatEl.value === '') { clearError(bodyFatEl, 'bodyFat'); return; }
      if (!isFinite(v) || v < 3 || v > 60) setError(bodyFatEl, 'Enter body fat between 3% and 60%, or leave empty.', 'bodyFat'); else clearError(bodyFatEl, 'bodyFat');
    });
    activityEl.addEventListener('blur', () => {
      const v = toNumber(activityEl.value);
      if (!isFinite(v) || v < 1.1 || v > 2.5) setError(activityEl, 'Please select a valid activity level.', 'activity'); else clearError(activityEl, 'activity');
    });

    // Equation note when Katch requires BF%
    function checkEquationRequirement(){
      if (eqKM.checked) {
        const bf = toNumber(bodyFatEl.value);
        if (!isFinite(bf)) {
          equationNote.textContent = 'Katch–McArdle requires a valid body fat percentage.';
        } else {
          equationNote.textContent = '';
        }
      } else {
        equationNote.textContent = '';
      }
    }
    eqMSJ.addEventListener('change', () => { checkEquationRequirement(); compute(); });
    eqKM.addEventListener('change', () => { checkEquationRequirement(); compute(); });
    bodyFatEl.addEventListener('input', () => { checkEquationRequirement(); compute(); });

    // Input events -> compute
    [ageEl, heightCmEl, heightFtEl, heightInEl, weightKgEl, weightLbEl, activityEl].forEach(el => {
      el.addEventListener('input', compute);
    });
    $$('input[name="sex"]').forEach(el => el.addEventListener('change', compute));
    $$('input[name="units"]').forEach(el => el.addEventListener('change', () => { applyUnitsUI(); compute(); }));

    function getInputs(){
      const metric = unitsMetricEl.checked;
      const sex = (document.querySelector('input[name="sex"]:checked')||{}).value || 'male';
      const age = toNumber(ageEl.value);
      const activity = toNumber(activityEl.value);
      const equation = eqKM.checked ? 'km' : 'msj';

      let heightCm, weightKg;
      if (metric) {
        heightCm = toNumber(heightCmEl.value);
        weightKg = toNumber(weightKgEl.value);
      } else {
        const ft = toNumber(heightFtEl.value);
        const inch = toNumber(heightInEl.value);
        const inches = inchesFromFtIn(ft, inch);
        heightCm = cmFromInches(inches);
        weightKg = kgFromLb(toNumber(weightLbEl.value));
      }

      const bf = bodyFatEl.value === '' ? NaN : toNumber(bodyFatEl.value);

      // Goal rate
      const goal = (document.querySelector('input[name="goal"]:checked') || {}).value || 'maintain';
      let rate = 0;
      if (goal === 'custom') {
        const custom = toNumber(goalCustomEl.value);
        rate = isFinite(custom) ? clamp(custom, -40, 40) / 100 : 0;
        if (!isFinite(custom)) errors.goal.textContent = 'Enter a custom percentage between −40 and +40.'; else errors.goal.textContent = '';
      } else {
        rate = toNumber(goalRateEl.value);
      }

      // Macros
      const pPerKg = toNumber(proteinPerKgEl.value);
      const pBasis = proteinBasisEl.value; // 'tbw' or 'lbm'
      const fatMethod = fatMethodEl.value;
      const fatPercent = toNumber(fatPercentEl.value);
      const fatPerKg = toNumber(fatPerKgEl.value);

      return { metric, sex, age, heightCm, weightKg, bf, activity, equation, goal, rate, pPerKg, pBasis, fatMethod, fatPercent, fatPerKg };
    }

    function compute(){
      const inp = getInputs();

      // Basic validity
      const validAge = isFinite(inp.age) && inp.age >= 10 && inp.age <= 100;
      const validH = isFinite(inp.heightCm) && inp.heightCm >= 120 && inp.heightCm <= 230;
      const validW = isFinite(inp.weightKg) && inp.weightKg >= 30 && inp.weightKg <= 300;
      const validAct = isFinite(inp.activity) && inp.activity >= 1.1 && inp.activity <= 2.5;

      if (!validAge || !validH || !validW || !validAct) {
        outputs.bmr.textContent = '—';
        outputs.tdee.textContent = '—';
        outputs.act.textContent = '—';
        outputs.cal.textContent = '—';
        outputs.protein.textContent = '—';
        outputs.fat.textContent = '—';
        outputs.carbs.textContent = '—';
        return;
      }

      // BMR
      let bmr = NaN;
      if (inp.equation === 'msj') {
        const s = (inp.sex === 'male') ? 5 : -161;
        bmr = 10*inp.weightKg + 6.25*inp.heightCm - 5*inp.age + s;
      } else {
        const bf = toNumber(inp.bf);
        if (isFinite(bf)) {
          const lbm = inp.weightKg * (1 - bf / 100);
          bmr = 370 + 21.6 * lbm;
        } else {
          outputs.bmr.textContent = '—';
          outputs.tdee.textContent = '—';
          outputs.act.textContent = '—';
          outputs.cal.textContent = '—';
          outputs.protein.textContent = '—';
          outputs.fat.textContent = '—';
          outputs.carbs.textContent = '—';
          return;
        }
      }

      const tdee = bmr * inp.activity;
      const targetCalories = tdee * (1 + inp.rate);

      // Protein grams
      let kgBasis = inp.weightKg;
      if (inp.pBasis === 'lbm') {
        if (isFinite(inp.bf)) {
          kgBasis = inp.weightKg * (1 - inp.bf / 100);
        } else {
          // fall back to TBW if no BF%
          kgBasis = inp.weightKg;
        }
      }
      const proteinG = Math.max(0, inp.pPerKg * kgBasis);

      // Fat grams
      let fatG = 0;
      if (inp.fatMethod === 'percent') {
        const pct = clamp(isFinite(inp.fatPercent) ? inp.fatPercent : 25, 5, 80) / 100;
        fatG = (targetCalories * pct) / 9;
      } else {
        const perKg = clamp(isFinite(inp.fatPerKg) ? inp.fatPerKg : 0.8, 0.2, 3.0);
        fatG = perKg * kgBasis;
      }

      // Carbs grams
      const remainingKcal = targetCalories - (proteinG * 4) - (fatG * 9);
      const carbsG = Math.max(0, remainingKcal / 4);

      // Output
      outputs.bmr.textContent = formatKcal(bmr);
      outputs.act.textContent = inp.activity.toFixed(2);
      outputs.tdee.textContent = formatKcal(tdee);
      outputs.cal.textContent = formatKcal(targetCalories);
      outputs.protein.textContent = formatGrams(proteinG);
      outputs.fat.textContent = formatGrams(fatG);
      outputs.carbs.textContent = formatGrams(carbsG);
    }

    // Initial compute
    compute();

    // Footer dates
    const y = new Date().getFullYear();
    const review = new Date();
    $('#year').textContent = y;
    $('#reviewDate').textContent = review.toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' });

    // Keyboard accessibility for radio "cards"
    $$('.radio-item input[type="radio"]').forEach(r => {
      r.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          r.checked = true;
          r.dispatchEvent(new Event('change', { bubbles:true }));
        }
      });
    });
  })();
  </script>

</body></html>