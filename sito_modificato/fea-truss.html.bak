<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="canonical" href="https://calcdomain.com/fea-truss" />
    <title>Fea Truss Calculator Guide [Bold 2024] | CalcDomain</title>
    <meta name="description" content="Calculate Fea Truss Calculator Guide fast with our bold tool. Get clear results, formulas, and tips - act now. No signup. Try it today. Free to use." />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Fea Truss Calculator Guide [Bold 2024] | CalcDomain" />
    <meta property="og:description" content="Calculate Fea Truss Calculator Guide fast with our bold tool. Get clear results, formulas, and tips - act now. No signup. Try it today. Free to use." />
    <meta property="og:url" content="https://calcdomain.com/fea-truss" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Fea Truss Calculator Guide [Bold 2024] | CalcDomain" />
    <meta name="twitter:description" content="Calculate Fea Truss Calculator Guide fast with our bold tool. Get clear results, formulas, and tips - act now. No signup. Try it today. Free to use." />

    
    <link rel="preload" href="https://calcdomain.com/assets/tailwind.min.css" as="style">
    <link rel="stylesheet" href="https://calcdomain.com/assets/tailwind.min.css">
    <!-- Google tag (gtag.js) -->
    
    
    
    
    

    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "2D Truss FEA Calculator (Finite Element Analysis)",
        "description": "Interactive 2D truss FEA calculator. Define nodes, elements, supports, and loads; assemble global stiffness matrix; solve displacements, reactions, and member forces; and visualize results.",
        "url": "https://calcdomain.com/fea-truss",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://calcdomain.com"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Math & Conversions",
              "item": "https://calcdomain.com/categories/math-conversions"
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": "Core Math & Algebra",
              "item": "https://calcdomain.com/subcategories/core-math-algebra"
            },
            {
              "@type": "ListItem",
              "position": 4,
              "name": "2D Truss FEA Calculator",
              "item": "https://calcdomain.com/fea-truss"
            }
          ]
        },
        "mainEntity": {
          "@type": "SoftwareApplication",
          "name": "2D Truss FEA Calculator",
          "applicationCategory": "EngineeringApplication",
          "operatingSystem": "Any",
          "description": "Browser-based finite element analysis (FEA) tool for 2D truss structures. Supports custom nodes, elements, boundary conditions, and loads with visualisation of displacements and member forces."
        },
        "faq": {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "What does this 2D truss FEA calculator do?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "This calculator performs a linear elastic finite element analysis (FEA) of 2D truss structures. You define nodes, elements, supports, and nodal loads. The tool assembles the global stiffness matrix, applies boundary conditions, solves for nodal displacements, computes support reactions, and reports axial forces and stresses in each member."
              }
            },
            {
              "@type": "Question",
              "name": "What assumptions does the truss FEA model use?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "The model assumes pin-jointed members, axial forces only (no bending), small displacements, linear elastic material e element formulations."
              }
            },
            {
              "@type": "Question",
              "name": "How are the global stiffness matrix and member forces calculated?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "For each element, the local 2×2 axial stiffness matrix k = AE/L is formed and then transformed to global coordinates using the direction cosines c and s. The resulting 4×4 element stiffness matrix is assembled into the global stiffness matrix K. After solving K·u = F for the nodal displacements u, element axial forces are obtained from f = (AE/L)[-1 1]·u_local, where u_local are the end displacements projected along the element axis."
              }
            },
            {
              "@type": "Question",
              "name": "Why do I get a singular matrix or instability warning?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "A singular global stiffness matrix usually means the structure is not adequately restrained or is kinematically unstable. Check that you have enough supports to prevent rigid body motion, that every element has a non-zero length, and that all nodes referenced by elements are defined. Adding at least one fixed or properly constrained support typically resolves the issue."
              }
            },
            {
              "@type": "Question",
              "name": "Is this calculator suitable for professional design?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "This tool is intended for education, quick checks, and conceptual design. It implements standard linear 2D truss FEA, but it does not replace a full-featured structural analysis package or the judgement of a qualified engineer. Always verify critical designs using appropriate codes, safety factors, and professional software where required."
              }
            }
          ]
        }
      }</script>
  
    <style>
      body { margin: 0; }
      .mb-10 { margin-bottom: 2.5rem; }
      .mt-10 { margin-top: 2.5rem; }
    </style>
    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ugo Candido",
        "url": "https://www.linkedin.com/in/ugocandido92821/",
        "sameAs": ["https://www.linkedin.com/in/ugocandido92821/"],
        "email": "info@calcdomain.com",
        "description": "Ugo Candido builds calculators and educational resources to help readers make better decisions with transparent, practical models."
      }</script>
  <script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/"}, {"@type": "ListItem", "position": 2, "name": "Engineering Calculators", "item": "https://calcdomain.com/categories/engineering"}, {"@type": "ListItem", "position": 3, "name": "Structural Engineering Calculators", "item": "https://calcdomain.com/subcategories/structural-engineering"}, {"@type": "ListItem", "position": 4, "name": "2D Truss FEA Calculator", "item": "https://calcdomain.com/fea-truss"}]}</script>
</head>
  <body class="bg-gray-50 text-gray-800">
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9476637732224939"
      crossorigin="anonymous"
    ></script>

    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a
            href="https://calcdomain.com"
            class="text-2xl font-bold text-blue-600"
            >CalcDomain</a
          >
          <div class="w-full max-w-md hidden md:block mx-8">
            <div class="relative">
              <input
                type="search"
                id="search-input"
                placeholder="Search for a calculator..."
                class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                autocomplete="off"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
              <div
                id="search-results"
                class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"
              ></div>
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a
              href="https://calcdomain.com/search"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Categories</a
            >
          </div>
          <button
            id="mobile-menu-toggle"
            class="md:hidden p-2"
            aria-controls="mobile-menu"
            aria-expanded="false"
            aria-label="Open menu"
            type="button"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
        <nav
          id="mobile-menu"
          class="md:hidden mt-4 hidden"
          aria-label="Mobile menu"
          role="navigation"
        >
          <div class="mb-4">
            <div class="relative">
              <input
                type="search"
                id="mobile-search-input"
                placeholder="Search calculators..."
                class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
            </div>
          </div>
          <div class="space-y-2">
            <a
              href="https://calcdomain.com/search"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Categories</a
            >
          </div>
        </nav>
      </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
      <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600">
  <ol class="flex flex-wrap items-center gap-1">
    <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/categories/engineering" class="text-blue-600 hover:underline">Engineering Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/subcategories/structural-engineering" class="text-blue-600 hover:underline">Structural Engineering Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><span class="text-gray-800">2D Truss FEA Calculator</span></li>
  </ol>
</nav>
      <div class="flex flex-col lg:flex-row gap-8">
        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <header class="mb-6">
              <h1 class="text-2xl md:text-3xl font-bold mb-2">
                2D Truss FEA Calculator
              </h1>
              <p class="text-gray-600">
                Finite element analysis of 2D pin-jointed trusses. Define nodes,
                elements, supports, and loads, then solve for displacements,
                reactions, and member forces.
              </p>
              <div class="mt-3 flex flex-wrap gap-2">
                <span
                  class="badge px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-200"
                  >Linear elastic</span
                >
                <span
                  class="badge px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-200"
                  >Global stiffness method</span
                >
                <span
                  class="badge px-2 py-1 rounded-full bg-purple-50 text-purple-700 border border-purple-200"
                  >Visualization</span
                >
              </div>
            </header>

            <!-- Calculator UI -->
            <section aria-labelledby="truss-inputs-heading" class="space-y-6">
              <h2 id="truss-inputs-heading" class="text-xl font-semibold">
                Model definition
              </h2>

              <!-- Global settings -->
              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label
                    class="block text-sm font-medium text-gray-700 mb-1"
                    for="unit-length"
                    >Length unit</label
                  >
                  <select
                    id="unit-length"
                    class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="m">m</option>
                    <option value="mm">mm</option>
                    <option value="ft">ft</option>
                    <option value="in">in</option>
                  </select>
                </div>
                <div>
                  <label
                    class="block text-sm font-medium text-gray-700 mb-1"
                    for="unit-force"
                    >Force unit</label
                  >
                  <select
                    id="unit-force"
                    class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="N">N</option>
                    <option value="kN">kN</option>
                    <option value="lb">lb</option>
                    <option value="kips">kips</option>
                  </select>
                </div>
                <div>
                  <label
                    class="block text-sm font-medium text-gray-700 mb-1"
                    for="youngs-modulus"
                    >Young's modulus E</label
                  >
                  <div class="flex">
                    <input
                      id="youngs-modulus"
                      type="number"
                      step="any"
                      value="210000"
                      class="table-input w-full border-gray-300 rounded-l-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                    />
                    <select
                      id="unit-e"
                      class="border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-sm px-2"
                    >
                      <option value="MPa">MPa</option>
                      <option value="GPa">GPa</option>
                      <option value="psi">psi</option>
                    </select>
                  </div>
                  <p class="text-xs text-gray-500 mt-1">
                    Applies to all elements (steel ≈ 210000 MPa).
                  </p>
                </div>
              </div>

              <!-- Nodes table -->
              <div>
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-lg font-semibold">Nodes</h3>
                  <div class="space-x-2">
                    <button
                      id="add-node"
                      type="button"
                      class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700"
                    >
                      Add node
                    </button>
                    <button
                      id="clear-nodes"
                      type="button"
                      class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200"
                    >
                      Clear
                    </button>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table
                    class="min-w-full text-sm border border-gray-200 rounded-md"
                  >
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-2 py-1 border-b text-left">ID</th>
                        <th class="px-2 py-1 border-b text-left">x</th>
                        <th class="px-2 py-1 border-b text-left">y</th>
                        <th class="px-2 py-1 border-b text-left">Support</th>
                        <th class="px-2 py-1 border-b text-left">Fx</th>
                        <th class="px-2 py-1 border-b text-left">Fy</th>
                        <th class="px-2 py-1 border-b"></th>
                      </tr>
                    </thead>
                    <tbody id="nodes-body">
                      <!-- Rows injected by JS -->
                    </tbody>
                  </table>
                </div>
                <p class="text-xs text-gray-500 mt-1">
                  Support types: free, pinned (Ux=Uy=0), roller X (Ux=0), roller
                  Y (Uy=0).
                </p>
              </div>

              <!-- Elements table -->
              <div>
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-lg font-semibold">Elements</h3>
                  <div class="space-x-2">
                    <button
                      id="add-element"
                      type="button"
                      class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700"
                    >
                      Add element
                    </button>
                    <button
                      id="clear-elements"
                      type="button"
                      class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200"
                    >
                      Clear
                    </button>
                  </div>
                </div>
                <div class="overflow-x-auto">
                  <table
                    class="min-w-full text-sm border border-gray-200 rounded-md"
                  >
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-2 py-1 border-b text-left">ID</th>
                        <th class="px-2 py-1 border-b text-left">Node i</th>
                        <th class="px-2 py-1 border-b text-left">Node j</th>
                        <th class="px-2 py-1 border-b text-left">Area A</th>
                        <th class="px-2 py-1 border-b text-left">Unit</th>
                        <th class="px-2 py-1 border-b"></th>
                      </tr>
                    </thead>
                    <tbody id="elements-body">
                      <!-- Rows injected by JS -->
                    </tbody>
                  </table>
                </div>
                <p class="text-xs text-gray-500 mt-1">
                  Area units consistent with E (e.g., mm² with MPa, in² with
                  ksi/psi).
                </p>
              </div>

              <!-- Actions -->
              <div
                class="flex flex-wrap items-center gap-3 pt-2 border-t border-gray-100"
              >
                <button
                  id="run-analysis"
                  type="button"
                  class="inline-flex items-center px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-md hover:bg-emerald-700"
                >
                  Run FEA
                </button>
                <button
                  id="load-example"
                  type="button"
                  class="inline-flex items-center px-3 py-2 bg-indigo-50 text-indigo-700 text-sm font-medium rounded-md hover:bg-indigo-100"
                >
                  Load example truss
                </button>
                <span id="status-message" class="text-sm text-gray-600"></span>
              </div>
            </section>

            <!-- Visualization -->
            <section
              aria-labelledby="visualization-heading"
              class="mt-8 space-y-3"
            >
              <h2 id="visualization-heading" class="text-xl font-semibold">
                Visualization
              </h2>
              <p class="text-sm text-gray-600">
                Undeformed (gray) and scaled deformed (blue) shapes. Axial
                forces shown in red (tension) and green (compression).
              </p>
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-3">
                  <label class="text-sm text-gray-700 flex items-center gap-1">
                    Scale factor
                    <input
                      id="scale-factor"
                      type="number"
                      step="0.1"
                      value="50"
                      class="w-20 table-input border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                    />
                  </label>
                  <label class="inline-flex items-center text-sm text-gray-700">
                    <input
                      id="toggle-forces"
                      type="checkbox"
                      class="mr-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                      checked
                    />
                    Show axial forces
                  </label>
                </div>
              </div>
              <div class="w-full">
                <canvas
                  id="truss-canvas"
                  width="640"
                  height="360"
                  aria-label="Truss diagram"
                ></canvas>
              </div>
            </section>

            <!-- Results -->
            <section aria-labelledby="results-heading" class="mt-8 space-y-4">
              <h2 id="results-heading" class="text-xl font-semibold">
                Results
              </h2>

              <div id="results-container" class="space-y-4 hidden">
                <!-- Nodal displacements -->
                <div>
                  <h3 class="text-lg font-semibold mb-2">
                    Nodal displacements
                  </h3>
                  <div class="overflow-x-auto">
                    <table
                      class="min-w-full text-sm border border-gray-200 rounded-md"
                    >
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-2 py-1 border-b text-left">Node</th>
                          <th class="px-2 py-1 border-b text-left">Ux</th>
                          <th class="px-2 py-1 border-b text-left">Uy</th>
                        </tr>
                      </thead>
                      <tbody id="displacements-body"></tbody>
                    </table>
                  </div>
                </div>

                <!-- Reactions -->
                <div>
                  <h3 class="text-lg font-semibold mb-2">Support reactions</h3>
                  <div class="overflow-x-auto">
                    <table
                      class="min-w-full text-sm border border-gray-200 rounded-md"
                    >
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-2 py-1 border-b text-left">Node</th>
                          <th class="px-2 py-1 border-b text-left">Rx</th>
                          <th class="px-2 py-1 border-b text-left">Ry</th>
                        </tr>
                      </thead>
                      <tbody id="reactions-body"></tbody>
                    </table>
                  </div>
                </div>

                <!-- Member forces -->
                <div>
                  <h3 class="text-lg font-semibold mb-2">
                    Member axial forces &amp; stresses
                  </h3>
                  <div class="overflow-x-auto">
                    <table
                      class="min-w-full text-sm border border-gray-200 rounded-md"
                    >
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-2 py-1 border-b text-left">Element</th>
                          <th class="px-2 py-1 border-b text-left">i</th>
                          <th class="px-2 py-1 border-b text-left">j</th>
                          <th class="px-2 py-1 border-b text-left">Force</th>
                          <th class="px-2 py-1 border-b text-left">Type</th>
                          <th class="px-2 py-1 border-b text-left">Stress</th>
                        </tr>
                      </thead>
                      <tbody id="forces-body"></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div id="no-results" class="text-sm text-gray-500">
                Run the analysis to see displacements, reactions, and member
                forces.
              </div>
            </section>

            <!-- Explanatory content -->
            <section class="mt-10 prose">
              <h2>How the 2D truss FEA calculator works</h2>
              <p>
                This tool implements the classical finite element formulation
                for 2D pin-jointed trusses. Each bar element carries only axial
                force, and all loads are applied at the nodes. The solution
                follows the global stiffness method.
              </p>

              <h3>1. Element stiffness in local and global coordinates</h3>
              <p>
                For an element between nodes \(i\) and \(j\) with Young’s
                modulus \(E\), cross-sectional area \(A\), and length \(L\):
              </p>
              <div class="formula-box">
                <p>Element length:</p>
                <p>\[ L = \sqrt{(x_j - x_i)^2 + (y_j - y_i)^2} \]</p>
                <p>Direction cosines:</p>
                <p>
                  \[ c = \frac{x_j - x_i}{L}, \quad s = \frac{y_j - y_i}{L} \]
                </p>
                <p>Local axial stiffness matrix:</p>
                <p>
                  \[ k^{(e)}_{\text{local}} = \frac{AE}{L} \begin{bmatrix} 1 &
                  -1 \\ -1 & 1 \end{bmatrix} \]
                </p>
              </div>
              <p>
                In global coordinates, each element has four degrees of freedom:
                \(u_{ix}, u_{iy}, u_{jx}, u_{jy}\). Using the direction cosines,
                the 4×4 global element stiffness matrix is:
              </p>
              <div class="formula-box">
                <p>
                  \[ k^{(e)} = \frac{AE}{L} \begin{bmatrix} c^2 & cs & -c^2 &
                  -cs \\ cs & s^2 & -cs & -s^2 \\ -c^2 & -cs & c^2 & cs \\ -cs &
                  -s^2 & cs & s^2 \end{bmatrix} \]
                </p>
              </div>

              <h3>2. Global stiffness matrix and boundary conditions</h3>
              <p>
                The calculator assembles the global stiffness matrix \(K\) by
                adding each element’s 4×4 matrix into the appropriate rows and
                columns corresponding to the node degrees of freedom.
              </p>
              <p>Supports are applied by constraining degrees of freedom:</p>
              <ul>
                <li><strong>Free</strong>: no constraints.</li>
                <li><strong>Pinned</strong>: \(u_x = 0\), \(u_y = 0\).</li>
                <li><strong>Roller X</strong>: \(u_x = 0\), \(u_y\) free.</li>
                <li><strong>Roller Y</strong>: \(u_y = 0\), \(u_x\) free.</li>
              </ul>
              <p>The reduced system for unknown displacements \(u_f\) is:</p>
              <div class="formula-box">
                <p>\[ K_{ff} \, u_f = F_f \]</p>
              </div>

              <h3>
                3. Solving for displacements, reactions, and member forces
              </h3>
              <p>
                Once \(u_f\) is found, the full displacement vector \(u\) is
                reconstructed by inserting zeros at constrained DOFs. Support
                reactions are obtained from:
              </p>
              <div class="formula-box">
                <p>\[ R = K \, u - F \]</p>
              </div>
              <p>
                For each element, the end displacements are projected along the
                element axis to compute axial force:
              </p>
              <div class="formula-box">
                <p>
                  \[ u_{\text{local}} = \begin{bmatrix} u_i^{\parallel} \\
                  u_j^{\parallel} \end{bmatrix} = \begin{bmatrix} c & s & 0 & 0
                  \\ 0 & 0 & c & s \end{bmatrix} \begin{bmatrix} u_{ix} \\
                  u_{iy} \\ u_{jx} \\ u_{jy} \end{bmatrix} \]
                </p>
                <p>
                  \[ f^{(e)} = \frac{AE}{L} \begin{bmatrix} -1 & 1 \end{bmatrix}
                  u_{\text{local}} \]
                </p>
              </div>
              <p>
                Positive axial force is reported as <strong>tension</strong>,
                negative as <strong>compression</strong>. Stress is simply
                \(\sigma = f^{(e)} / A\).
              </p>

              <h3>4. Typical sources of errors</h3>
              <ul>
                <li>
                  <strong>Singular matrix / instability</strong>: structure not
                  adequately supported or has a mechanism.
                </li>
                <li>
                  <strong>Zero-length element</strong>: nodes with identical
                  coordinates.
                </li>
                <li>
                  <strong>Inconsistent units</strong>: e.g., using mm for length
                  but in² for area with MPa for E.
                </li>
              </ul>

              <h3>Disclaimer</h3>
              <p>
                This calculator is for educational use and preliminary checks.
                For safety-critical or code-compliant design, always verify
                results with professional structural analysis software and a
                qualified engineer.
              </p>
            </section>

            <!-- FAQ -->
            <section id="faq" class="mt-10">
              <h2 class="text-xl font-semibold mb-4">
                2D Truss FEA – Frequently Asked Questions
              </h2>
              <div class="space-y-3">
                <details class="border border-gray-200 rounded-md p-3">
                  <summary class="font-medium cursor-pointer">
                    What does this 2D truss FEA calculator do?
                  </summary>
                  <p class="mt-2 text-sm text-gray-700">
                    It performs a linear elastic finite element analysis of 2D
                    truss structures. You define nodes, elements, supports, and
                    nodal loads. The tool assembles the global stiffness matrix,
                    solves for nodal displacements, computes support reactions,
                    and reports axial forces and stresses in each member, along
                    with a visual deformed shape.
                  </p>
                </details>
                <details class="border border-gray-200 rounded-md p-3">
                  <summary class="font-medium cursor-pointer">
                    Which units should I use?
                  </summary>
                  <p class="mt-2 text-sm text-gray-700">
                    Use a consistent set of units. For example, if you choose mm
                    for length and MPa for E, then areas must be in mm² and
                    forces in N. If you use inches and psi, areas must be in in²
                    and forces in lb. The calculator does not convert between
                    incompatible unit systems automatically.
                  </p>
                </details>
                <details class="border border-gray-200 rounded-md p-3">
                  <summary class="font-medium cursor-pointer">
                    How do I model supports correctly?
                  </summary>
                  <p class="mt-2 text-sm text-gray-700">
                    At a minimum, you need enough constraints to prevent rigid
                    body motion. A common pattern is one pinned support (fixes
                    both x and y) and one roller support (fixes only one
                    direction). Avoid over-constraining the structure unless you
                    intend to model a statically indeterminate truss, which FEA
                    can handle but may increase reaction redundancy.
                  </p>
                </details>
                <details class="border border-gray-200 rounded-md p-3">
                  <summary class="font-medium cursor-pointer">
                    Can I apply distributed loads on members?
                  </summary>
                  <p class="mt-2 text-sm text-gray-700">
                    No. This simplified truss FEA tool supports only nodal
                    forces. To approximate a distributed load on a member,
                    convert it to equivalent nodal forces at the member ends
                    based on statics, or use a frame/beam FEA tool that includes
                    bending.
                  </p>
                </details>
                <details class="border border-gray-200 rounded-md p-3">
                  <summary class="font-medium cursor-pointer">
                    Why do I see very large displacements?
                  </summary>
                  <p class="mt-2 text-sm text-gray-700">
                    Large displacements usually indicate a very flexible
                    structure (small E or area), a missing support, or a
                    mechanism. Check your units, material properties, and
                    boundary conditions. Also remember that the plotted deformed
                    shape is scaled for visibility; use the numeric displacement
                    table for actual values.
                  </p>
                </details>
              </div>
            </section>
          </div>



            <section class="mt-10" id="author">
              <h2 class="text-xl font-semibold mb-4">About the author</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  <a href="https://www.linkedin.com/in/ugocandido92821/" class="text-blue-600 hover:underline" target="_blank" rel="noopener">Ugo Candido</a>
                  builds financial tools and educational resources to help
                  readers make better money decisions. He focuses on practical,
                  transparent models that reflect how lenders calculate
                  payments and total cost of ownership.
                </p>
                <p class="text-sm text-gray-700 mt-3">
                  Contact: <a href="mailto:info@calcdomain.com" class="text-blue-600 hover:underline">info@calcdomain.com</a>
                </p>
              </div>
            </section>

            <section class="mt-10" id="editorial-policy">
              <h2 class="text-xl font-semibold mb-4">Editorial policy</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  CalcDomain content is created for educational purposes and is
                  reviewed for clarity, accuracy, and transparency. We do not
                  accept paid placements that influence calculator outputs.
                  Inputs and assumptions are shown directly in the interface so
                  you can verify how results are produced.
                </p>
              </div>
            </section>

            <section class="mt-10" id="methodology">
              <h2 class="text-xl font-semibold mb-4">Methodology</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  Results use standard formulas and the values you provide.
                  Figures are estimates and may differ from lender quotes.
                  For decisions that require professional guidance, consult a
                  licensed advisor.
                </p>
              </div>
            </section>

        
            <section class="mt-10" id="sources">
              <h2 class="text-xl font-semibold mb-4">Sources</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                  <li>
                    <a href="https://www.nist.gov/pml/owm/metric-si/si-units" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      NIST: The International System of Units (SI)
                    </a>
                  </li>
                  <li>
                    <a href="https://openstax.org/details/books/college-algebra" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      OpenStax: College Algebra
                    </a>
                  </li>
                </ul>
              </div>
            </section>

        





<section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Length unit m mm ft in Force unit N kN lb kips Young's modulus E MPa GPa psi Applies to all elements (steel ≈ 210000 MPa). Nodes Add node Clear ID x y Support Fx Fy Support types: free, pinned (Ux=Uy=0), roller X (Ux=0), roller Y (Uy=0). Elements Add element Clear ID Node i Node j Area A Unit Area units consistent with E (e.g., mm² with MPa, in² with ksi/psi). Run FEA Load example truss Visualization Undeformed (gray) and scaled deformed (blue) shapes. Axial forces shown in red (tension) and green (compression). Scale factor</li><li>Show axial forces</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Operational notes</h2><p class="text-sm text-gray-700">Fill in realistic values and keep units and timeframes consistent.</p><p class="text-sm text-gray-700 mt-2">Key entities: Fea, Truss, Length unit m mm ft in Force unit N kN lb kips Young's modulus E MPa GPa psi Applies to all elements (steel ≈ 210000 MPa). Nodes Add node Clear ID x y Support Fx Fy Support types: free, pinned (Ux=Uy=0), roller X (Ux=0), roller Y (Uy=0). Elements Add element Clear ID Node i Node j Area A Unit Area units consistent with E (e.g., mm² with MPa, in² with ksi/psi). Run FEA Load example truss Visualization Undeformed (gray) and scaled deformed (blue) shapes. Axial forces shown in red (tension) and green (compression). Scale factor, Show axial forces.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Length unit m mm ft in Force unit N kN lb kips Young's modulus E MPa GPa psi Applies to all elements (steel ≈ 210000 MPa). Nodes Add node Clear ID x y Support Fx Fy Support types: free, pinned (Ux=Uy=0), roller X (Ux=0), roller Y (Uy=0). Elements Add element Clear ID Node i Node j Area A Unit Area units consistent with E (e.g., mm² with MPa, in² with ksi/psi). Run FEA Load example truss Visualization Undeformed (gray) and scaled deformed (blue) shapes. Axial forces shown in red (tension) and green (compression). Scale factor</li><li>Show axial forces</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><!-- %%EEAT_STRIP%% -->
<!-- %%QUALITY_BLOCKS%% -->
<!-- %%FAQ_JSONLD%% -->
</main>
        <aside class="w-full lg:w-1/3">
          <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-3">
              Related Core Math &amp; Engineering Tools
            </h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/beam-deflection"
                  class="text-blue-600 hover:underline"
                  >Beam Deflection Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/moment-of-inertia"
                  class="text-blue-600 hover:underline"
                  >Moment of Inertia Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/stress-and-strain"
                  class="text-blue-600 hover:underline"
                  >Stress and Strain Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/mohrs-circle"
                  class="text-blue-600 hover:underline"
                  >Mohr's Circle Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/plate-bending"
                  class="text-blue-600 hover:underline"
                  >Plate Bending (FEA) Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/buckling-load"
                  class="text-blue-600 hover:underline"
                  >Euler Buckling Load Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/2d-frame-analysis"
                  class="text-blue-600 hover:underline"
                  >Frame Analysis 2D Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/stress-and-strain"
                  class="text-blue-600 hover:underline"
                  >Stress &amp; Strain Fundamentals</a
                >
              </li>
            </ul>
          </div>
          <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">
              More Core Math &amp; Algebra
            </h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/system-of-equations"
                  class="text-blue-600 hover:underline"
                  >System of Equations Solver</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/matrix"
                  class="text-blue-600 hover:underline"
                  >Matrix Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/eigenvalue-eigenvector"
                  class="text-blue-600 hover:underline"
                  >Eigenvalues &amp; Eigenvectors</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/linear-algebra"
                  class="text-blue-600 hover:underline"
                  >Linear Algebra Toolbox</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/finite-element-analysis"
                  class="text-blue-600 hover:underline"
                  >Finite Element Concepts</a
                >
              </li>
            </ul>
          </div>
        </aside>
      </div>
    </div>
    <footer class="bg-gray-900 text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
            <p class="text-gray-400 mb-4">
              Your trusted source for free online calculators. Accurate, fast,
              and reliable calculations for every need.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Categories</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/finance"
                  class="text-gray-400 hover:text-white"
                  >Finance</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/health-fitness"
                  class="text-gray-400 hover:text-white"
                  >Health & Fitness</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/math-conversions"
                  class="text-gray-400 hover:text-white"
                  >Math & Conversions</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/lifestyle-everyday"
                  class="text-gray-400 hover:text-white"
                  >Lifestyle & Everyday</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/construction-diy"
                  class="text-gray-400 hover:text-white"
                  >Construction & DIY</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/mortgage-payment"
                  class="text-gray-400 hover:text-white"
                  >Mortgage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percentage-calculator"
                  class="text-gray-400 hover:text-white"
                  >Percentage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bmi-calculator"
                  class="text-gray-400 hover:text-white"
                  >BMI Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/auto-loan-calculator"
                  class="text-gray-400 hover:text-white"
                  >Auto Loan Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/house-affordability"
                  class="text-gray-400 hover:text-white"
                  >House Affordability</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/about"
                  class="text-gray-400 hover:text-white"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/contact"
                  class="text-gray-400 hover:text-white"
                  >Contact</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/privacy"
                  class="text-gray-400 hover:text-white"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/terms"
                  class="text-gray-400 hover:text-white"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/sitemap.xml"
                  class="text-gray-400 hover:text-white"
                  >Site Map</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>
            &copy; 2025 CalcDomain. All Rights Reserved. | Free Online
            Calculators for Everyone
          </p>
        </div>
      </div>
    </footer>

    <script src="/assets/js/mobile-menu.js"></script>
    <script src="/search.js"></script>

    <script>
      // Data structures
      let nodes = [];
      let elements = [];

      const nodesBody = document.getElementById("nodes-body");
      const elementsBody = document.getElementById("elements-body");
      const statusMessage = document.getElementById("status-message");
      const canvas = document.getElementById("truss-canvas");
      const ctx = canvas.getContext("2d");

      function resetStatus(msg = "", isError = false) {
        statusMessage.textContent = msg;
        statusMessage.className =
          "text-sm " + (isError ? "text-red-600" : "text-gray-600");
      }

      function addNodeRow(node) {
        const tr = document.createElement("tr");
        tr.dataset.id = node.id;
        tr.innerHTML = `
      <td class="px-2 py-1 border-b">${node.id}</td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="any" class="table-input w-24 border-gray-300 rounded-md" value="${
          node.x
        }">
      </td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="any" class="table-input w-24 border-gray-300 rounded-md" value="${
          node.y
        }">
      </td>
      <td class="px-2 py-1 border-b">
        <select class="border-gray-300 rounded-md">
          <option value="free"${
            node.support === "free" ? " selected" : ""
          }>Free</option>
          <option value="pinned"${
            node.support === "pinned" ? " selected" : ""
          }>Pinned</option>
          <option value="roller-x"${
            node.support === "roller-x" ? " selected" : ""
          }>Roller X</option>
          <option value="roller-y"${
            node.support === "roller-y" ? " selected" : ""
          }>Roller Y</option>
        </select>
      </td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="any" class="table-input w-24 border-gray-300 rounded-md" value="${
          node.fx
        }">
      </td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="any" class="table-input w-24 border-gray-300 rounded-md" value="${
          node.fy
        }">
      </td>
      <td class="px-2 py-1 border-b text-right">
        <button type="button" class="text-xs text-red-600 hover:underline">Delete</button>
      </td>
    `;
        nodesBody.appendChild(tr);
      }

      function addElementRow(el) {
        const tr = document.createElement("tr");
        tr.dataset.id = el.id;
        tr.innerHTML = `
      <td class="px-2 py-1 border-b">${el.id}</td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="1" class="table-input w-20 border-gray-300 rounded-md" value="${
          el.i
        }">
      </td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="1" class="table-input w-20 border-gray-300 rounded-md" value="${
          el.j
        }">
      </td>
      <td class="px-2 py-1 border-b">
        <input type="number" step="any" class="table-input w-24 border-gray-300 rounded-md" value="${
          el.area
        }">
      </td>
      <td class="px-2 py-1 border-b">
        <select class="border-gray-300 rounded-md">
          <option value="mm2"${
            el.unit === "mm2" ? " selected" : ""
          }>mm²</option>
          <option value="m2"${el.unit === "m2" ? " selected" : ""}>m²</option>
          <option value="in2"${
            el.unit === "in2" ? " selected" : ""
          }>in²</option>
        </select>
      </td>
      <td class="px-2 py-1 border-b text-right">
        <button type="button" class="text-xs text-red-600 hover:underline">Delete</button>
      </td>
    `;
        elementsBody.appendChild(tr);
      }

      function syncFromTable() {
        nodes = [];
        elements = [];

        nodesBody.querySelectorAll("tr").forEach((tr) => {
          const id = parseInt(tr.dataset.id, 10);
          const inputs = tr.querySelectorAll("input");
          const select = tr.querySelector("select");
          const x = parseFloat(inputs[0].value) || 0;
          const y = parseFloat(inputs[1].value) || 0;
          const fx = parseFloat(inputs[2].value) || 0;
          const fy = parseFloat(inputs[3].value) || 0;
          nodes.push({ id, x, y, support: select.value, fx, fy });
        });

        elementsBody.querySelectorAll("tr").forEach((tr) => {
          const id = parseInt(tr.dataset.id, 10);
          const inputs = tr.querySelectorAll("input");
          const select = tr.querySelector("select");
          const i = parseInt(inputs[0].value, 10);
          const j = parseInt(inputs[1].value, 10);
          const area = parseFloat(inputs[2].value) || 0;
          elements.push({ id, i, j, area, unit: select.value });
        });
      }

      document.getElementById("add-node").addEventListener("click", () => {
        const id = nodes.length ? Math.max(...nodes.map((n) => n.id)) + 1 : 1;
        const node = { id, x: 0, y: 0, support: "free", fx: 0, fy: 0 };
        nodes.push(node);
        addNodeRow(node);
        resetStatus();
      });

      document.getElementById("clear-nodes").addEventListener("click", () => {
        nodes = [];
        nodesBody.innerHTML = "";
        resetStatus("All nodes cleared.");
      });

      document.getElementById("add-element").addEventListener("click", () => {
        const id = elements.length
          ? Math.max(...elements.map((e) => e.id)) + 1
          : 1;
        const el = { id, i: 1, j: 1, area: 100, unit: "mm2" };
        elements.push(el);
        addElementRow(el);
        resetStatus();
      });

      document
        .getElementById("clear-elements")
        .addEventListener("click", () => {
          elements = [];
          elementsBody.innerHTML = "";
          resetStatus("All elements cleared.");
        });

      nodesBody.addEventListener("click", (e) => {
        if (e.target.tagName === "BUTTON") {
          const tr = e.target.closest("tr");
          const id = parseInt(tr.dataset.id, 10);
          nodes = nodes.filter((n) => n.id !== id);
          tr.remove();
        }
      });

      elementsBody.addEventListener("click", (e) => {
        if (e.target.tagName === "BUTTON") {
          const tr = e.target.closest("tr");
          const id = parseInt(tr.dataset.id, 10);
          elements = elements.filter((el) => el.id !== id);
          tr.remove();
        }
      });

      // Linear algebra helpers
      function zeros(n) {
        return Array(n).fill(0);
      }

      function zerosMatrix(n) {
        return Array.from({ length: n }, () => Array(n).fill(0));
      }

      function solveLinearSystem(K, F) {
        const n = F.length;
        const A = K.map((row, i) => row.concat([F[i]]));

        for (let i = 0; i < n; i++) {
          // Pivot
          let maxRow = i;
          for (let k = i + 1; k < n; k++) {
            if (Math.abs(A[k][i]) > Math.abs(A[maxRow][i])) maxRow = k;
          }
          if (Math.abs(A[maxRow][i]) < 1e-12) {
            throw new Error(
              "Singular matrix (structure may be unstable or under-constrained)."
            );
          }
          [A[i], A[maxRow]] = [A[maxRow], A[i]];

          // Normalize
          const pivot = A[i][i];
          for (let j = i; j <= n; j++) A[i][j] / pivot;

          // Eliminate
          for (let k = 0; k < n; k++) {
            if (k === i) continue;
            const factor = A[k][i];
            for (let j = i; j <= n; j++) {
              A[k][j] -= factor * A[i][j];
            }
          }
        }

        const x = zeros(n);
        for (let i = 0; i < n; i++) x[i] = A[i][n];
        return x;
      }

      function runAnalysis() {
        resetStatus();
        syncFromTable();

        if (!nodes.length || !elements.length) {
          resetStatus("Please define at least one node and one element.", true);
          return;
        }

        const nodeIndex = new Map();
        nodes.forEach((n, idx) => nodeIndex.set(n.id, idx));

        const ndof = nodes.length * 2;
        let K = zerosMatrix(ndof);
        let F = zeros(ndof);

        // Global load vector
        nodes.forEach((n, idx) => {
          F[2 * idx] = n.fx;
          F[2 * idx + 1] = n.fy;
        });

        // Convert E to base unit (e.g., MPa -> N/mm²)
        const Einput =
          parseFloat(document.getElementById("youngs-modulus").value) || 0;
        const unitE = document.getElementById("unit-e").value;
        let E = Einput;
        if (unitE === "GPa") E = Einput * 1000; // GPa -> MPa
        // psi left as-is; user must keep consistent with area and force units.

        // Assemble global stiffness
        for (const el of elements) {
          if (!nodeIndex.has(el.i) || !nodeIndex.has(el.j)) {
            resetStatus(`Element ${el.id} references undefined node.`, true);
            return;
          }
          const ni = nodes[nodeIndex.get(el.i)];
          const nj = nodes[nodeIndex.get(el.j)];

          const dx = nj.x - ni.x;
          const dy = nj.y - ni.y;
          const L = Math.hypot(dx, dy);
          if (L < 1e-9) {
            resetStatus(`Element ${el.id} has zero or near-zero length.`, true);
            return;
          }
          const c = dx / L;
          const s = dy / L;

          // Area conversion: assume user keeps consistent with E; we don't convert between mm²/m²/in² here.
          const A = el.area;
          if (A <= 0) {
            resetStatus(`Element ${el.id} has non-positive area.`, true);
            return;
          }

          const k = (A * E) / L;
          const kLocal = [
            [c * c, c * s, -c * c, -c * s],
            [c * s, s * s, -c * s, -s * s],
            [-c * c, -c * s, c * c, c * s],
            [-c * s, -s * s, c * s, s * s],
          ].map((row) => row.map((v) => v * k));

          const iIdx = nodeIndex.get(el.i);
          const jIdx = nodeIndex.get(el.j);
          const dof = [2 * iIdx, 2 * iIdx + 1, 2 * jIdx, 2 * jIdx + 1];

          for (let r = 0; r < 4; r++) {
            for (let c2 = 0; c2 < 4; c2++) {
              K[dof[r]][dof[c2]] += kLocal[r][c2];
            }
          }
        }

        // Apply boundary conditions
        const freeDofs = [];
        const fixedDofs = [];
        nodes.forEach((n, idx) => {
          const ux = 2 * idx;
          const uy = 2 * idx + 1;
          if (n.support === "pinned") {
            fixedDofs.push(ux, uy);
          } else if (n.support === "roller-x") {
            fixedDofs.push(ux);
            freeDofs.push(uy);
          } else if (n.support === "roller-y") {
            fixedDofs.push(uy);
            freeDofs.push(ux);
          } else {
            freeDofs.push(ux, uy);
          }
        });

        if (!freeDofs.length) {
          resetStatus(
            "All DOFs are fixed. At least one DOF must be free.",
            true
          );
          return;
        }

        const Kff = freeDofs.map((i) => freeDofs.map((j) => K[i][j]));
        const Ff = freeDofs.map((i) => F[i]);

        let uf;
        try {
          uf = solveLinearSystem(Kff, Ff);
        } catch (err) {
          resetStatus(err.message, true);
          return;
        }

        const u = zeros(ndof);
        freeDofs.forEach((dof, idx) => {
          u[dof] = uf[idx];
        });

        // Reactions
        const R = zeros(ndof);
        for (let i = 0; i < ndof; i++) {
          let sum = 0;
          for (let j = 0; j < ndof; j++) {
            sum += K[i][j] * u[j];
          }
          R[i] = sum - F[i];
        }

        // Element forces and stresses
        const elementResults = [];
        for (const el of elements) {
          const ni = nodes[nodeIndex.get(el.i)];
          const nj = nodes[nodeIndex.get(el.j)];
          const dx = nj.x - ni.x;
          const dy = nj.y - ni.y;
          const L = Math.hypot(dx, dy);
          const c = dx / L;
          const s = dy / L;
          const A = el.area;

          const iIdx = nodeIndex.get(el.i);
          const jIdx = nodeIndex.get(el.j);
          const uix = u[2 * iIdx];
          const uiy = u[2 * iIdx + 1];
          const ujx = u[2 * jIdx];
          const ujy = u[2 * jIdx + 1];

          const uiLocal = c * uix + s * uiy;
          const ujLocal = c * ujx + s * ujy;
          const axial = ((A * E) / L) * (ujLocal - uiLocal); // sign: tension positive
          const stress = axial / A;

          elementResults.push({
            id: el.id,
            i: el.i,
            j: el.j,
            axial,
            stress,
          });
        }

        renderResults(u, R, elementResults);
        drawTruss(u, elementResults);
        resetStatus("Analysis completed.");
      }

      function renderResults(u, R, elementResults) {
        const dispBody = document.getElementById("displacements-body");
        const reacBody = document.getElementById("reactions-body");
        const forcesBody = document.getElementById("forces-body");

        dispBody.innerHTML = "";
        reacBody.innerHTML = "";
        forcesBody.innerHTML = "";

        const unitLength = document.getElementById("unit-length").value;
        const unitForce = document.getElementById("unit-force").value;

        nodes.forEach((n, idx) => {
          const ux = u[2 * idx];
          const uy = u[2 * idx + 1];
          const rx = R[2 * idx];
          const ry = R[2 * idx + 1];

          const trD = document.createElement("tr");
          trD.innerHTML = `
        <td class="px-2 py-1 border-b">${n.id}</td>
        <td class="px-2 py-1 border-b">${ux.toExponential(3)} ${unitLength}</td>
        <td class="px-2 py-1 border-b">${uy.toExponential(3)} ${unitLength}</td>
      `;
          dispBody.appendChild(trD);

          if (Math.abs(rx) > 1e-6 || Math.abs(ry) > 1e-6) {
            const trR = document.createElement("tr");
            trR.innerHTML = `
          <td class="px-2 py-1 border-b">${n.id}</td>
          <td class="px-2 py-1 border-b">${rx.toFixed(3)} ${unitForce}</td>
          <td class="px-2 py-1 border-b">${ry.toFixed(3)} ${unitForce}</td>
        `;
            reacBody.appendChild(trR);
          }
        });

        elementResults.forEach((res) => {
          const type = res.axial >= 0 ? "Tension" : "Compression";
          const trF = document.createElement("tr");
          trF.innerHTML = `
        <td class="px-2 py-1 border-b">${res.id}</td>
        <td class="px-2 py-1 border-b">${res.i}</td>
        <td class="px-2 py-1 border-b">${res.j}</td>
        <td class="px-2 py-1 border-b">${res.axial.toFixed(3)} ${unitForce}</td>
        <td class="px-2 py-1 border-b">${type}</td>
        <td class="px-2 py-1 border-b">${res.stress.toExponential(3)}</td>
      `;
          forcesBody.appendChild(trF);
        });

        document.getElementById("results-container").classList.remove("hidden");
        document.getElementById("no-results").classList.add("hidden");
      }

      function drawTruss(u, elementResults) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (!nodes.length) return;

        const padding = 40;
        const xs = nodes.map((n) => n.x);
        const ys = nodes.map((n) => n.y);
        const minX = Math.min(...xs);
        const maxX = Math.max(...xs);
        const minY = Math.min(...ys);
        const maxY = Math.max(...ys);

        const width = maxX - minX || 1;
        const height = maxY - minY || 1;
        const scaleX = (canvas.width - 2 * padding) / width;
        const scaleY = (canvas.height - 2 * padding) / height;
        const scale = Math.min(scaleX, scaleY);

        function toCanvas(n, dx = 0, dy = 0) {
          const x = padding + (n.x - minX) * scale + dx;
          const y = canvas.height - (padding + (n.y - minY) * scale + dy);
          return { x, y };
        }

        // Undeformed truss (gray)
        ctx.lineWidth = 1.5;
        ctx.strokeStyle = "#9ca3af";
        elements.forEach((el) => {
          const ni = nodes.find((n) => n.id === el.i);
          const nj = nodes.find((n) => n.id === el.j);
          if (!ni || !nj) return;
          const p1 = toCanvas(ni);
          const p2 = toCanvas(nj);
          ctx.beginPath();
          ctx.moveTo(p1.x, p1.y);
          ctx.lineTo(p2.x, p2.y);
          ctx.stroke();
        });

        // Deformed shape
        const scaleFactor =
          parseFloat(document.getElementById("scale-factor").value) || 1;
        const showForces = document.getElementById("toggle-forces").checked;

        const nodeIndex = new Map();
        nodes.forEach((n, idx) => nodeIndex.set(n.id, idx));

        // Draw deformed elements
        elements.forEach((el, idx) => {
          const ni = nodes.find((n) => n.id === el.i);
          const nj = nodes.find((n) => n.id === el.j);
          if (!ni || !nj) return;

          const iIdx = nodeIndex.get(el.i);
          const jIdx = nodeIndex.get(el.j);
          const duix = u[2 * iIdx] * scaleFactor;
          const duiy = u[2 * iIdx + 1] * scaleFactor;
          const dujx = u[2 * jIdx] * scaleFactor;
          const dujy = u[2 * jIdx + 1] * scaleFactor;

          const p1 = toCanvas(ni, duix * scale, duiy * scale);
          const p2 = toCanvas(nj, dujx * scale, dujy * scale);

          ctx.lineWidth = 2;
          ctx.strokeStyle = "#2563eb";
          ctx.beginPath();
          ctx.moveTo(p1.x, p1.y);
          ctx.lineTo(p2.x, p2.y);
          ctx.stroke();

          if (showForces && elementResults && elementResults[idx]) {
            const axial = elementResults[idx].axial;
            ctx.strokeStyle = axial >= 0 ? "#dc2626" : "#16a34a";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
          }
        });

        // Draw nodes
        nodes.forEach((n, idx) => {
          const dux = u[2 * idx] * scaleFactor;
          const duy = u[2 * idx + 1] * scaleFactor;
          const p = toCanvas(n, dux * scale, duy * scale);
          ctx.fillStyle = "#1d4ed8";
          ctx.beginPath();
          ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI);
          ctx.fill();
        });
      }

      document
        .getElementById("run-analysis")
        .addEventListener("click", runAnalysis);

      document.getElementById("scale-factor").addEventListener("change", () => {
        // Re-draw with same last results if available
        // We don't store last results separately; easiest is to re-run analysis.
        try {
          runAnalysis();
        } catch (e) {}
      });

      document
        .getElementById("toggle-forces")
        .addEventListener("change", () => {
          try {
            runAnalysis();
          } catch (e) {}
        });

      // Example truss: simple 3-node triangular truss
      document.getElementById("load-example").addEventListener("click", () => {
        nodes = [
          { id: 1, x: 0, y: 0, support: "pinned", fx: 0, fy: 0 },
          { id: 2, x: 4, y: 0, support: "roller-y", fx: 0, fy: 0 },
          { id: 3, x: 2, y: 3, support: "free", fx: 0, fy: -10 },
        ];
        elements = [
          { id: 1, i: 1, j: 3, area: 1000, unit: "mm2" },
          { id: 2, i: 2, j: 3, area: 1000, unit: "mm2" },
          { id: 3, i: 1, j: 2, area: 1000, unit: "mm2" },
        ];

        nodesBody.innerHTML = "";
        elementsBody.innerHTML = "";
        nodes.forEach(addNodeRow);
        elements.forEach(addElementRow);

        document.getElementById("unit-length").value = "m";
        document.getElementById("unit-force").value = "kN";
        document.getElementById("youngs-modulus").value = 210000;
        document.getElementById("unit-e").value = "MPa";
        document.getElementById("scale-factor").value = 50;

        resetStatus('Example truss loaded. Click "Run FEA" to solve.');
        document.getElementById("results-container").classList.add("hidden");
        document.getElementById("no-results").classList.remove("hidden");
        drawTruss(zeros(nodes.length * 2), null);
      });

      // Initialize with empty drawing
      drawTruss([], null);
    </script>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["\\(", "\\)"],
            ["$", "$"],
          ],
          displayMath: [
            ["$", "$"],
            ["\\[", "\\]"],
          ],
        },
        svg: { fontCache: "global" },
      };
    </script>
    <script>
  (function () {
    var loadMathJax = function () {
      if (window.__mathjaxLoading) return;
      window.__mathjaxLoading = true;
      var script = document.createElement("script");
      script.id = "MathJax-script";
      script.async = true;
      script.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js";
      document.head.appendChild(script);
    };

    var target = document.querySelector(
      ".formula-box, .mathjax, .math, .formula, [data-mathjax]"
    );

    if (!target) return;

    if ("IntersectionObserver" in window) {
      var observer = new IntersectionObserver(
        function (entries) {
          if (entries.some(function (entry) { return entry.isIntersecting; })) {
            observer.disconnect();
            loadMathJax();
          }
        },
        { rootMargin: "200px" }
      );
      observer.observe(target);
    } else {
      window.addEventListener(
        "load",
        function () {
          setTimeout(loadMathJax, 1000);
        },
        { once: true }
      );
    }
  })();
</script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
<script>
  window.__cmpLoadQueued = window.__cmpLoadQueued || [];
  window.addEventListener("load", function () {
    var loadCmp = function () {
      var s1 = document.createElement("script");
      s1.src = "https://cmp.gatekeeperconsent.com/min.js";
      s1.async = true;
      s1.setAttribute("data-cfasync", "false");
      document.head.appendChild(s1);

      var s2 = document.createElement("script");
      s2.src = "https://the.gatekeeperconsent.com/cmp.min.js";
      s2.async = true;
      s2.setAttribute("data-cfasync", "false");
      document.head.appendChild(s2);
    };

    if ("requestIdleCallback" in window) {
      requestIdleCallback(loadCmp, { timeout: 2000 });
    } else {
      setTimeout(loadCmp, 1000);
    }
  });
</script>
<script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
<script>
      window.ezstandalone = window.ezstandalone || {};
      ezstandalone.cmd = ezstandalone.cmd || [];
    </script>
</body>
</html>
