<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baconian Cipher Encoder/Decoder (BAC) | A/B, 24-letter, 26-letter, stego</title>
  <meta name="description" content="Encode or decode messages using the Baconian cipher (Francis Bacon) with optional steganography and flexible A/B symbols, alphabets, and grouping.">
  <link rel="canonical" href="https://calcdomain.com/bac">

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    header, footer { font-family: 'Inter', sans-serif; }
    .card { background: white; border: 1px solid #e5e7eb; border-radius: 1rem; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08); }
    .calc-hero { display: grid; gap: 1.75rem; }
    .nav { display: flex; align-items: center; justify-content: space-between; }
    .container { max-width: 1100px; }
    .brand { font-weight: 700; font-size: 1.6rem; color: #2563eb; }
    .navRight { display: flex; gap: 0.75rem; }
    .navRight .pill:hover { border-color: #2563eb; color: #2563eb; }
    .pill { padding: 0.35rem 0.85rem; border-radius: 999px; border: 1px solid #e5e7eb; cursor: pointer; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.04em; font-weight: 600; }
    .pill.active { background: #2563eb; color: white; border-color: #2563eb; }
    .calc-input, .calc-input:focus, textarea.calc-input:focus, select.calc-input:focus { width: 100%; border: 1px solid #d1d5db; border-radius: 0.75rem; padding: 0.75rem 0.85rem; font-size: 0.95rem; background: white; }
    .calc-input:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); }
    .calc-label { display: block; font-size: 0.8rem; font-weight: 600; color: #6b7280; margin-bottom: 0.35rem; }
    .btn { border: none; border-radius: 0.75rem; padding: 0.85rem 1rem; font-weight: 600; cursor: pointer; transition: background 0.2s ease; }
    .btn.btnSecondary { border: 1px solid #d1d5db; background: white; color: #374151; }
    .btn.btnSecondary:hover { background: #f8fafc; }
    .btn.primary { background: #1d4ed8; color: white; }
    .btn.convert { background: #2563eb; color: white; }
    .btn.convert:hover { background: #1d4ed8; }
    .alert { border-radius: 0.5rem; padding: 0.75rem 1rem; margin-top: 1rem; font-size: 0.9rem; display: none; }
    .alert.alert-error { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; }
    .result-box { background: linear-gradient(135deg, #e0f2fe 0%, #c7d2fe 100%); border: 1px solid #93c5fd; border-radius: 0.75rem; padding: 1.2rem; }
    .result-box textarea { border: none; min-height: 140px; background: transparent; resize: none; font-size: 1rem; font-family: 'Inter', sans-serif; }
    .result-value { font-size: 1.4rem; font-weight: 700; color: #0f172a; word-break: break-word; }
    .kpi-row { display: flex; justify-content: space-between; border-bottom: 1px solid #e5e7eb; padding: 0.75rem 0; font-size: 0.9rem; }
    .kpi-row:last-child { border-bottom: none; }
    .kpi-label { color: #6b7280; font-size: 0.8rem; letter-spacing: 0.04em; text-transform: uppercase; }
    .kpi-value { font-weight: 600; color: #111827; word-break: break-all; }
    .calc-hero section { display: flex; flex-direction: column; gap: 1rem; }
    .sticky-box { position: relative; }
    .prose h2, .prose h3 { margin-top: 1.2rem; margin-bottom: 0.5rem; }
    .prose ul { margin-left: 1.5rem; }
    .full-guide-list { margin-left: 1.5rem; }
    .content-card { padding: 2rem; }
    .meta-section { padding: 2rem; }
    .fs-small { font-size: 0.85rem; }
    textarea { font-family: inherit; }
    @media (min-width: 1024px) {
      .calc-hero { grid-template-columns: 1fr 0.9fr; }
      .results-fixed { position: sticky; top: 5rem; }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header id="siteHeader" class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="nav container mx-auto px-4 py-4" aria-label="Primary">
      <a class="brand" href="https://calcdomain.com">CalcDomain</a>
      <div class="w-full max-w-sm hidden md:block">
        <div class="relative">
          <input type="search" id="search-input" placeholder="Search for a calculator..." class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" autocomplete="off">
          <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
      </div>
      <div class="navRight hidden md:flex">
        <a class="pill" href="https://calcdomain.com/search">Advanced Search</a>
        <span class="pill">Categories</span>
      </div>
    </nav>
  </header>

  <main id="mainContent" class="container mx-auto px-4 py-10">
    <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600" aria-label="Breadcrumbs">
      <ol class="flex flex-wrap items-center gap-1">
        <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
        <li class="text-gray-400">/</li>
        <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="text-blue-600 hover:underline">Lifestyle &amp; Everyday</a></li>
        <li class="text-gray-400">/</li>
        <li><span class="text-gray-800">Baconian Cipher Encoder/Decoder (BAC)</span></li>
      </ol>
    </nav>

    <div class="space-y-3">
      <h1 id="pageTitle" class="text-3xl font-bold text-gray-900">Baconian Cipher Encoder/Decoder (BAC)</h1>
      <p id="pageSub" class="sub text-lg text-gray-600">Encode or decode messages with the Baconian cipher using 24-letter or 26-letter alphabets, custom A/B symbols, grouping, and optional steganography.</p>
      <div id="errorBox" class="alert alert-error" role="alert" aria-live="polite"></div>
    </div>

    <div class="calc-hero mt-8" id="calcHero" aria-label="Calculator hero">
      <section class="card" id="inputsCard" aria-label="Calculator inputs">
        <div class="p-6 space-y-5">
          <div>
            <h3 class="text-lg font-semibold text-gray-700">Encode, decode, configure</h3>
            <div class="flex flex-wrap gap-3 mt-3">
              <button type="button" class="pill active" data-mode="encode">Encode</button>
              <button type="button" class="pill" data-mode="decode">Decode</button>
            </div>
          </div>

          <div class="grid gap-4 md:grid-cols-3">
            <div>
              <label for="variant" class="calc-label">Alphabet variant</label>
              <select id="variant" class="calc-input">
                <option value="24">Original 24-letter (I/J, U/V merged)</option>
                <option value="26">Modern 26-letter</option>
              </select>
            </div>
            <div>
              <label for="symA" class="calc-label">Symbol for “A”</label>
              <input id="symA" type="text" maxlength="1" class="calc-input" value="A">
            </div>
            <div>
              <label for="symB" class="calc-label">Symbol for “B”</label>
              <input id="symB" type="text" maxlength="1" class="calc-input" value="B">
            </div>
          </div>

          <div class="flex gap-4 flex-wrap">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="group5" checked="" class="rounded border-gray-300 focus:ring-blue-500">
              <span class="text-sm text-gray-700">Group output in 5-digit blocks</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="keepUnknown" checked="" class="rounded border-gray-300 focus:ring-blue-500">
              <span class="text-sm text-gray-700">Keep unsupported characters</span>
            </label>
          </div>

          <div>
            <label for="input" class="calc-label">Input text</label>
            <textarea id="input" rows="5" class="calc-input" placeholder="Encode: Defense is at dawn.\nDecode: AABAA ABBAB ...">Francis Bacon</textarea>
          </div>

          <div>
            <label for="cover" class="calc-label">Cover text for steganography (optional)</label>
            <textarea id="cover" rows="4" class="calc-input" placeholder="This is only a perfectly normal letter to everyone else."></textarea>
            <p class="fs-small text-gray-500 mt-2">A/B sequence will be applied to letters in this cover text (A&nbsp;= uppercase, B&nbsp;= lowercase).</p>
          </div>

          <div class="flex gap-3">
            <button id="calcBtn" class="btn convert flex-1" type="button">Convert</button>
            <button id="resetBtn" class="btn btnSecondary flex-1" type="button">Reset</button>
          </div>
        </div>
      
<div data-canon-btnrow="1" style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;"></div>
</section>

      <section class="card sticky-box results-fixed" id="resultsCard" aria-label="Calculator results">
        <div class="result-box">
          <div class="text-xs font-bold text-blue-700 uppercase tracking-wider mb-2">Converted output</div>
          <textarea id="output" class="calc-input" rows="6" readonly=""></textarea>
        </div>
        <div class="bg-white border border-gray-200 rounded-lg p-4 mt-4">
          <div class="kpi-row">
            <span class="kpi-label">Mode</span>
            <span class="kpi-value" id="modeLabel">Encode</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-label">Alphabet variant</span>
            <span class="kpi-value" id="variantLabel">24-letter</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-label">Grouping</span>
            <span class="kpi-value" id="groupLabel">Grouped in 5s</span>
          </div>
          <div class="kpi-row">
            <span class="kpi-label">Normalized A/B sequence</span>
            <span class="kpi-value" id="normalizedSeq">—</span>
          </div>
        </div>
        <div class="mt-4 space-y-2">
          <label for="stegoOutput" class="calc-label">Stego output (A = uppercase, B = lowercase)</label>
          <textarea id="stegoOutput" rows="4" class="calc-input" readonly=""></textarea>
          <button id="buildStego" class="btn btnSecondary w-full" type="button">Build stego text</button>
        </div>
      </section>
    </div>

    <section class="card content-card space-y-6 mt-10" id="howToUse" aria-label="How to use and methodology">
      <div>
        <h2 class="text-2xl font-semibold">How to Use This Calculator</h2>
        <p>Switch between Encode and Decode to transform text into Baconian A/B blocks or back into plain letters. Configure the alphabet variant, custom A/B symbols, grouping, and whether non-alphabet characters stay in place. Click Convert (or edit the inputs) to refresh the output, and use Reset to return to the example defaults.</p>
        <p>You can paste an existing A/B string to decode it, or feed your plain message to create an encoded result. Optional cover text accepts the current A/B sequence so you can stamp it into uppercase/lowercase letters for steganography.</p>
      </div>

      <div>
        <h2 class="text-2xl font-semibold">Methodology</h2>
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <p>The calculator follows Francis Bacon’s original system: each letter maps to a unique five-character pattern of As and Bs. The 24-letter variant merges I/J and U/V, while the 26-letter variant exposes every A‑Z pattern. The encode path replaces letters with your chosen A/B symbols, while the decode path reverses that mapping with optional placeholders for partial groups.</p>
        </div>
        <ul class="list-disc pl-5 text-gray-700 space-y-1">
          <li>Encoding strips letters (A–Z) and substitutes each with its five-symbol pattern.</li>
          <li>Decoding normalizes your A/B symbols, chunks the stream in five-character groups, and maps each to the corresponding letter; incomplete groups show “?” when kept.</li>
          <li>Grouping in fives adds spaces for readability, but you can also request a continuous string to embed in steganography.</li>
        </ul>
      </div>

      <div>
        <h2 class="text-2xl font-semibold">Full original guide (expanded)</h2>
        <article class="prose">
          <h3>How the Baconian cipher works</h3>
          <p>The cipher turns every letter into a block of 5 characters, each either “A” or “B”. For example, in the original 24-letter alphabet:</p>
          <div class="formula-box">
            <code>A = AAAAA<br>
B = AAAAB<br>
C = AAABA<br>
...<br>
I/J = ABAAA<br>
U/V = BAABB</code>
          </div>
          <p>Once you have the A/B sequence, you can hide it using two fonts, two colors, or simply uppercase versus lowercase characters. A reader with the key can map back to As and Bs and then to letters.</p>

          <h3>24 vs 26 letters</h3>
          <ul>
            <li><strong>24-letter (classic):</strong> I=J and U=V are merged to fit 24 patterns.</li>
            <li><strong>26-letter (extended):</strong> every letter A–Z is unique and does not rely on merged symbols.</li>
          </ul>

          <h3>Common decoding problems</h3>
          <ul>
            <li>Make sure the symbol you use for A and B stays consistent.</li>
            <li>If the encoded message length is not a multiple of 5, the last letter may be incomplete.</li>
            <li>Mixing alphabet variants (24 vs 26) produces odd characters during decoding.</li>
          </ul>

          <h3>Related Crypto &amp; Encoding Tools</h3>
          <ul class="full-guide-list">
            <li><a href="https://calcdomain.com/caesar-cipher" class="text-blue-600 hover:underline">Caesar Cipher Encoder/Decoder</a></li>
            <li><a href="https://calcdomain.com/atbash-cipher" class="text-blue-600 hover:underline">Atbash Cipher</a></li>
            <li><a href="https://calcdomain.com/substitution-cipher-solver" class="text-blue-600 hover:underline">Substitution Cipher Solver</a></li>
            <li><a href="https://calcdomain.com/rsa" class="text-blue-600 hover:underline">RSA Encryption/Decryption</a></li>
            <li><a href="https://calcdomain.com/baconian-cipher" class="text-blue-600 hover:underline">Baconian Cipher (alt)</a></li>
          </ul>

          <h3>Tips for stronger stego</h3>
          <p class="text-sm text-gray-600">Use a cover text of similar length to your encoded message. Mix punctuation and numbers, and avoid repeating obvious upper/lowercase patterns so your embedded A/B stream stays subtle.</p>
        </article>
      </div>
    </section>

    <section class="card meta-section space-y-4 mt-10" id="pageMeta" aria-label="Verification, changelog, formulas, citations">
      <details id="formulaDetails">
        <summary class="cursor-pointer font-bold text-gray-800">Formulas</summary>
        <div class="mt-3 p-3 bg-white border border-gray-200 rounded-lg text-sm">
          <p><strong>Letter → A/B mapping (24-letter variant shown)</strong></p>
          <p class="font-mono mt-2">A = AAAAA<br>B = AAAAB<br>C = AAABA<br>D = AAABB<br>E = AABAA<br>F = AABAB<br>G = AABBA<br>H = AABBB<br>I/J = ABAAA<br>U/V = BAABB</p>
          <p class="mt-2"><strong>26-letter extension adds:</strong></p>
          <p class="font-mono">J = ABAAB<br>K = ABABA<br>L = ABABB<br>M = ABBAA<br>N = ABBAB<br>O = ABBBA<br>P = ABBBB<br>Q = BAAAA<br>Z = BBAAB</p>
        </div>
      </details>

      <details id="citationDetails">
        <summary class="cursor-pointer font-bold text-gray-800">Citations</summary>
        <div class="mt-3 p-3 bg-white border border-gray-200 rounded-lg text-sm">
          <p><strong>NIST — Weights and measures</strong> — nist.gov · Accessed 2026-01-19<br><a href="https://www.nist.gov/pml/weights-and-measures" target="_blank" rel="noopener" class="text-blue-600 hover:underline">https://www.nist.gov/pml/weights-and-measures</a></p>
          <p class="mt-3"><strong>FTC — Consumer advice</strong> — consumer.ftc.gov · Accessed 2026-01-19<br><a href="https://consumer.ftc.gov/" target="_blank" rel="noopener" class="text-blue-600 hover:underline">https://consumer.ftc.gov/</a></p>
        </div>
      </details>

      <details id="changelogDetails">
        <summary class="cursor-pointer font-bold text-gray-800">Changelog</summary>
        <div class="mt-3 p-3 bg-white border border-gray-200 rounded-lg text-sm">
          <div><strong>Version 0.1.0-draft</strong> — 2026-01-19</div>
          <ul class="list-disc list-inside mt-2">
            <li>Initial audit spec draft generated from HTML extraction (review required).</li>
            <li>Verify formulas match the calculator engine and convert any text-only formulas to LaTeX.</li>
            <li>Confirm sources are authoritative and relevant to the calculator methodology.</li>
          </ul>
        </div>
      </details>

      <div class="flex gap-2 flex-wrap mt-4">
        <span class="inline-flex items-center gap-1 border border-gray-200 px-3 py-1 rounded-full bg-white text-sm"><span class="text-green-600 font-bold">✓</span> Verified by Ugo Candido</span>
        <span class="inline-flex items-center border border-gray-200 px-3 py-1 rounded-full bg-white text-sm">Last Updated: 2026-01-19</span>
        <span class="inline-flex items-center border border-gray-200 px-3 py-1 rounded-full bg-white text-sm">Version 0.1.0-draft</span>
      </div>
    
          <div class="badge" id="versionBadge">Version 1.5.0</div></section>
  </main>

  <footer id="siteFooter" class="bg-gray-900 text-white py-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
          <p class="text-gray-400 mb-4">Your trusted source for free online calculators. Accurate, fast, and reliable calculations for every need.</p>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Categories</h4>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="https://calcdomain.com/categories/finance" class="hover:text-white">Finance</a></li>
            <li><a href="https://calcdomain.com/categories/lifestyle-everyday" class="hover:text-white">Lifestyle &amp; Everyday</a></li>
            <li><a href="https://calcdomain.com/categories/math-conversions" class="hover:text-white">Math &amp; Conversions</a></li>
            <li><a href="https://calcdomain.com/categories/science" class="hover:text-white">Science</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="https://calcdomain.com/mortgage-payment" class="hover:text-white">Mortgage Calculator</a></li>
            <li><a href="https://calcdomain.com/percentage-calculator" class="hover:text-white">Percentage Calculator</a></li>
            <li><a href="https://calcdomain.com/bmi-calculator" class="hover:text-white">BMI Calculator</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Support</h4>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="https://calcdomain.com/about" class="hover:text-white">About Us</a></li>
            <li><a href="https://calcdomain.com/contact" class="hover:text-white">Contact</a></li>
            <li><a href="https://calcdomain.com/privacy" class="hover:text-white">Privacy Policy</a></li>
            <li><a href="https://calcdomain.com/terms" class="hover:text-white">Terms of Service</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
        <p>© 2026 CalcDomain. All Rights Reserved. | Free Online Calculators for Everyone</p>
      </div>
    </div>
  </footer>

  <script src="/assets/js/mobile-menu.js"></script>
  <script src="/search.js"></script>
  <script>
    (function () {
      'use strict';

      const bacon24 = {
        "A":"AAAAA","B":"AAAAB","C":"AAABA","D":"AAABB","E":"AABAA","F":"AABAB","G":"AABBA","H":"AABBB",
        "I":"ABAAA","J":"ABAAA","K":"ABAAB","L":"ABABA","M":"ABABB","N":"ABBAA","O":"ABBAB","P":"ABBBA",
        "Q":"ABBBB","R":"BAAAA","S":"BAAAB","T":"BAABA","U":"BAABB","V":"BAABB","W":"BABAA","X":"BABAB",
        "Y":"BABBA","Z":"BABBB"
      };

      const bacon26 = {
        "A":"AAAAA","B":"AAAAB","C":"AAABA","D":"AAABB","E":"AABAA","F":"AABAB","G":"AABBA","H":"AABBB",
        "I":"ABAAA","J":"ABAAB","K":"ABABA","L":"ABABB","M":"ABBAA","N":"ABBAB","O":"ABBBA","P":"ABBBB",
        "Q":"BAAAA","R":"BAAAB","S":"BAABA","T":"BAABB","U":"BABAA","V":"BABAB","W":"BABBA","X":"BABBB",
        "Y":"BBAAA","Z":"BBAAB"
      };

      const escapeForRegex = (value) => value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

      const getMapping = (variant) => variant === '26' ? bacon26 : bacon24;
      const invertMapping = (map) => {
        const inv = {};
        Object.keys(map).forEach((key) => {
          inv[map[key]] = key;
        });
        return inv;
      };

      const els = {
        variant: document.getElementById('variant'),
        symA: document.getElementById('symA'),
        symB: document.getElementById('symB'),
        group5: document.getElementById('group5'),
        keepUnknown: document.getElementById('keepUnknown'),
        input: document.getElementById('input'),
        cover: document.getElementById('cover'),
        output: document.getElementById('output'),
        stegoOutput: document.getElementById('stegoOutput'),
        modeLabel: document.getElementById('modeLabel'),
        variantLabel: document.getElementById('variantLabel'),
        groupLabel: document.getElementById('groupLabel'),
        normalizedSeq: document.getElementById('normalizedSeq'),
        calcBtn: document.getElementById('calcBtn'),
        resetBtn: document.getElementById('resetBtn'),
        buildStego: document.getElementById('buildStego'),
        errorBox: document.getElementById('errorBox')
      };

      const modeButtons = document.querySelectorAll('[data-mode]');
      let currentMode = 'encode';
      let lastNormalizedSequence = '';

      const defaults = {
        mode: 'encode',
        variant: '24',
        symA: 'A',
        symB: 'B',
        group5: true,
        keepUnknown: true,
        input: 'Francis Bacon',
        cover: ''
      };

      const debounce = (fn, delay = 100) => {
        let t;
        return (...args) => {
          clearTimeout(t);
          t = setTimeout(() => fn(...args), delay);
        };
      };

      function setActiveModeButton() {
        modeButtons.forEach((btn) => {
          btn.classList.toggle('active', btn.dataset.mode === currentMode);
        });
      }

      function parseInputs() {
        return {
          mode: currentMode,
          variant: els.variant.value,
          symA: els.symA.value.trim() || 'A',
          symB: els.symB.value.trim() || 'B',
          group5: els.group5.checked,
          keepUnknown: els.keepUnknown.checked,
          inputText: els.input.value || '',
          coverText: els.cover.value || ''
        };
      }

      function validate(inputs) {
        const errors = [];
        if (!['24', '26'].includes(inputs.variant)) {
          errors.push('Alphabet variant must be 24 or 26 letters.');
        }
        if (!inputs.symA) errors.push('Symbol for “A” is required.');
        if (!inputs.symB) errors.push('Symbol for “B” is required.');
        if (inputs.symA.toUpperCase() === inputs.symB.toUpperCase()) {
          errors.push('Symbol for “A” and “B” must be different.');
        }
        if (!inputs.inputText.trim()) {
          errors.push('Input text cannot be empty.');
        }
        return { ok: errors.length === 0, errors };
      }

      function encodeBacon(text, variant, symA, symB, group5, keepUnknown) {
        const map = getMapping(variant);
        const upper = text.toUpperCase();
        const tokens = [];
        const normalized = [];
        for (const ch of upper) {
          if (ch >= 'A' && ch <= 'Z') {
            const pattern = map[ch];
            if (pattern) {
              tokens.push(pattern.replace(/A/g, symA).replace(/B/g, symB));
              normalized.push(pattern);
            } else if (keepUnknown) {
              tokens.push(ch);
            }
          } else if (keepUnknown) {
            tokens.push(ch);
          }
        }
        const joined = group5 ? tokens.join(' ') : tokens.join('');
        return { encoded: joined.trim(), normalized: normalized.join('') };
      }

      function decodeBacon(text, variant, symA, symB, keepUnknown) {
        const map = getMapping(variant);
        const inv = invertMapping(map);
        const safeA = symA.toUpperCase();
        const safeB = symB.toUpperCase();
        const pattern = new RegExp(`[^${escapeForRegex(safeA)}${escapeForRegex(safeB)}]`, 'g');
        const clean = text.toUpperCase().replace(pattern, '');
        const groups = clean.match(/.{1,5}/g) || [];
        const decoded = [];
        for (const g of groups) {
          if (g.length < 5) {
            if (keepUnknown) decoded.push('?');
            continue;
          }
          const ab = g.replace(new RegExp(escapeForRegex(safeA), 'g'), 'A')
                       .replace(new RegExp(escapeForRegex(safeB), 'g'), 'B');
          const letter = inv[ab];
          if (letter) decoded.push(letter);
          else if (keepUnknown) decoded.push('?');
        }
        return decoded.join('');
      }

      function compute(inputs) {
        if (inputs.mode === 'encode') {
          const encoded = encodeBacon(inputs.inputText, inputs.variant, inputs.symA, inputs.symB, inputs.group5, inputs.keepUnknown);
          lastNormalizedSequence = encoded.normalized;
          return {
            output: encoded.encoded,
            normalized: encoded.normalized,
            variantLabel: inputs.variant === '26' ? '26-letter' : '24-letter',
            modeLabel: 'Encode',
            groupLabel: inputs.group5 ? 'Grouped in 5s' : 'Ungrouped',
            canBuildStego: Boolean(encoded.normalized)
          };
        }

        const decoded = decodeBacon(inputs.inputText, inputs.variant, inputs.symA, inputs.symB, inputs.keepUnknown);
        lastNormalizedSequence = '';
        return {
          output: decoded,
          normalized: '',
          variantLabel: inputs.variant === '26' ? '26-letter' : '24-letter',
          modeLabel: 'Decode',
          groupLabel: 'N/A for decode',
          canBuildStego: false
        };
      }

      function formatResult(result) {
        return {
          outputText: result.output || '',
          variantLabel: result.variantLabel,
          modeLabel: result.modeLabel,
          groupLabel: result.groupLabel,
          normalizedDisplay: result.normalized || '—',
          canBuildStego: result.canBuildStego
        };
      }

      function renderError(errors) {
        if (!errors || errors.length === 0) {
          els.errorBox.style.display = 'none';
          els.errorBox.textContent = '';
          return;
        }
        els.errorBox.style.display = 'block';
        els.errorBox.textContent = errors.join(' ');
      }

      function render(formatted, errors = []) {
        renderError(errors);
        if (formatted) {
          els.output.value = formatted.outputText;
          els.modeLabel.textContent = formatted.modeLabel;
          els.variantLabel.textContent = formatted.variantLabel;
          els.groupLabel.textContent = formatted.groupLabel;
          els.normalizedSeq.textContent = formatted.normalizedDisplay;
          els.buildStego.disabled = !formatted.canBuildStego;
          if (!formatted.canBuildStego) {
            els.stegoOutput.value = '';
          }
        }
      }

      function update() {
        const inputs = parseInputs();
        const validation = validate(inputs);
        if (!validation.ok) {
          render(null, validation.errors);
          return;
        }
        const result = compute(inputs);
        const formatted = formatResult(result);
        render(formatted);
      }

      function applyStego() {
        const seq = lastNormalizedSequence;
        if (!seq) {
          renderError(['Switch to Encode mode and produce output before building stego text.']);
          return;
        }
        const cover = els.cover.value;
        if (!cover.trim()) {
          renderError(['Provide cover text to apply the A/B sequence.']);
          return;
        }
        renderError([]);
        let idx = 0;
        const chars = cover.split('');
        const built = chars.map((ch) => {
          if (idx >= seq.length) return ch;
          const code = seq[idx++];
          if (/[a-zA-Z]/.test(ch)) {
            return code === 'A' ? ch.toUpperCase() : ch.toLowerCase();
          }
          return ch;
        }).join('');
        els.stegoOutput.value = built;
      }

      function resetForm() {
        currentMode = defaults.mode;
        setActiveModeButton();
        els.variant.value = defaults.variant;
        els.symA.value = defaults.symA;
        els.symB.value = defaults.symB;
        els.group5.checked = defaults.group5;
        els.keepUnknown.checked = defaults.keepUnknown;
        els.input.value = defaults.input;
        els.cover.value = defaults.cover;
        els.stegoOutput.value = '';
        lastNormalizedSequence = '';
        update();
      }

      modeButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          currentMode = btn.dataset.mode;
          setActiveModeButton();
          update();
        });
      });

      els.calcBtn.addEventListener('click', update);
      els.resetBtn.addEventListener('click', resetForm);
      els.buildStego.addEventListener('click', applyStego);

      const debouncedUpdate = debounce(update, 100);
      document.querySelectorAll('#inputsCard input, #inputsCard select, #inputsCard textarea').forEach((el) => {
        el.addEventListener('input', debouncedUpdate);
        el.addEventListener('change', debouncedUpdate);
      });

      setActiveModeButton();
      update();
    })();
  </script>


</body></html>