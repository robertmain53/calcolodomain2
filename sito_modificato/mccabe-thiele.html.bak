<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="canonical" href="https://calcdomain.com/mccabe-thiele" />
    <title>Mccabe Thiele Calculator (2024 Guide) | CalcDomain</title>
    <meta name="description" content="Calculate Mccabe Thiele Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Fast, reliable results." />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Mccabe Thiele Calculator (2024 Guide) | CalcDomain" />
    <meta property="og:description" content="Calculate Mccabe Thiele Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Fast, reliable results." />
    <meta property="og:url" content="https://calcdomain.com/mccabe-thiele" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Mccabe Thiele Calculator (2024 Guide) | CalcDomain" />
    <meta name="twitter:description" content="Calculate Mccabe Thiele Calculator in seconds with this free tool. Get accurate results, formulas, and tips - start now. No signup. Fast, reliable results." />

    
    <link rel="preload" href="https://calcdomain.com/assets/tailwind.min.css" as="style">
    <link rel="stylesheet" href="https://calcdomain.com/assets/tailwind.min.css">
    <!-- Google tag (gtag.js) -->
    
    
    
    
    

    <script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/"}, {"@type": "ListItem", "position": 2, "name": "Math Calculators", "item": "https://calcdomain.com/categories/math"}, {"@type": "ListItem", "position": 3, "name": "Structural Engineering Calculators", "item": "https://calcdomain.com/subcategories/structural-engineering"}, {"@type": "ListItem", "position": 4, "name": "McCabe-Thiele Distillation Column Calculator", "item": "https://calcdomain.com/mccabe-thiele"}]}</script>
  
    <style>
      body { margin: 0; }
      .mb-10 { margin-bottom: 2.5rem; }
      .mt-10 { margin-top: 2.5rem; }
    </style>
    <script type="application/ld+json">{
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ugo Candido",
        "url": "https://www.linkedin.com/in/ugocandido92821/",
        "sameAs": ["https://www.linkedin.com/in/ugocandido92821/"],
        "email": "info@calcdomain.com",
        "description": "Ugo Candido builds calculators and educational resources to help readers make better decisions with transparent, practical models."
      }</script>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9476637732224939"
      crossorigin="anonymous"
    ></script>

    <header class="bg-white shadow-sm sticky top-0 z-50">
      <nav class="container mx-auto px-4 lg:px-6 py-4" aria-label="Primary">
        <div class="flex justify-between items-center">
          <a
            href="https://calcdomain.com"
            class="text-2xl font-bold text-blue-600"
            >CalcDomain</a
          >
          <div class="w-full max-w-md hidden md:block mx-8">
            <div class="relative">
              <input
                type="search"
                id="search-input"
                placeholder="Search for a calculator..."
                class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                autocomplete="off"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
              <div
                id="search-results"
                class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"
              ></div>
            </div>
          </div>
          <div class="hidden md:flex items-center space-x-6">
            <a
              href="https://calcdomain.com/search"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="text-gray-700 hover:text-blue-600 transition-colors"
              >Categories</a
            >
          </div>
          <button
            id="mobile-menu-toggle"
            class="md:hidden p-2"
            aria-controls="mobile-menu"
            aria-expanded="false"
            aria-label="Open menu"
            type="button"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
        <nav
          id="mobile-menu"
          class="md:hidden mt-4 hidden"
          aria-label="Mobile menu"
          role="navigation"
        >
          <div class="mb-4">
            <div class="relative">
              <input
                type="search"
                id="mobile-search-input"
                placeholder="Search calculators..."
                class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <svg
                class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
              </svg>
            </div>
          </div>
          <div class="space-y-2">
            <a
              href="https://calcdomain.com/search"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Advanced Search</a
            >
            <a
              href="https://calcdomain.com/#categories"
              class="block py-2 text-gray-700 hover:text-blue-600"
              >Categories</a
            >
          </div>
        </nav>
      </nav>
    </header>

    <div class="container mx-auto px-4 py-8">
      <nav id="breadcrumb-container" class="text-sm mb-4 text-gray-600">
  <ol class="flex flex-wrap items-center gap-1">
    <li><a href="https://calcdomain.com" class="text-blue-600 hover:underline">Home</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/categories/math" class="text-blue-600 hover:underline">Math Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><a href="https://calcdomain.com/subcategories/structural-engineering" class="text-blue-600 hover:underline">Structural Engineering Calculators</a></li>
    <li class="text-gray-400">/</li>
    <li><span class="text-gray-800">McCabe-Thiele Distillation Column Calculator</span></li>
  </ol>
</nav>
      <div class="flex flex-col lg:flex-row gap-8">
        <main class="w-full lg:w-2/3">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h1 class="text-2xl md:text-3xl font-bold mb-2">
              McCabe-Thiele Distillation Column Calculator
            </h1>
            <p class="text-gray-600 mb-4">
              Interactive McCabe-Thiele diagram for binary distillation. Define
              compositions, feed quality, and reflux ratio to estimate
              theoretical stages, feed stage, and operating lines.
            </p>

            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <!-- Left: process inputs -->
              <div>
                <h2 class="text-lg font-semibold mb-2">
                  Process specifications
                </h2>
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm font-medium mb-1" for="xF"
                      >Feed composition x<sub>F</sub> (light key)</label
                    >
                    <input
                      id="xF"
                      type="number"
                      step="0.01"
                      min="0"
                      max="1"
                      value="0.5"
                      class="w-full border rounded px-3 py-2"
                    />
                  </div>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="block text-sm font-medium mb-1" for="xD"
                        >Distillate x<sub>D</sub></label
                      >
                      <input
                        id="xD"
                        type="number"
                        step="0.01"
                        min="0"
                        max="1"
                        value="0.95"
                        class="w-full border rounded px-3 py-2"
                      />
                    </div>
                    <div>
                      <label class="block text-sm font-medium mb-1" for="xB"
                        >Bottoms x<sub>B</sub></label
                      >
                      <input
                        id="xB"
                        type="number"
                        step="0.01"
                        min="0"
                        max="1"
                        value="0.05"
                        class="w-full border rounded px-3 py-2"
                      />
                    </div>
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium mb-1"
                      for="feedCondition"
                      >Feed condition (q-line)</label
                    >
                    <select
                      id="feedCondition"
                      class="w-full border rounded px-3 py-2"
                    >
                      <option value="1">Saturated liquid (q = 1)</option>
                      <option value="0.5">Two-phase (q = 0.5)</option>
                      <option value="0">Saturated vapor (q = 0)</option>
                      <option value="1.2">
                        Subcooled liquid (q &gt; 1, use 1.2)
                      </option>
                      <option value="-0.2">
                        Superheated vapor (q &lt; 0, use -0.2)
                      </option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-medium mb-1" for="alpha"
                      >Relative volatility α (light/heavy)</label
                    >
                    <input
                      id="alpha"
                      type="number"
                      step="0.1"
                      min="1.01"
                      value="2.5"
                      class="w-full border rounded px-3 py-2"
                    />
                    <p class="text-xs text-gray-500 mt-1">
                      Used to generate an ideal equilibrium curve: y = αx / (1 +
                      (α − 1)x).
                    </p>
                  </div>
                </div>
              </div>

              <!-- Right: reflux & options -->
              <div>
                <h2 class="text-lg font-semibold mb-2">
                  Reflux &amp; operating lines
                </h2>
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm font-medium mb-1"
                      >Reflux mode</label
                    >
                    <div class="flex items-center gap-3">
                      <label class="inline-flex items-center text-sm">
                        <input
                          type="radio"
                          name="refluxMode"
                          value="direct"
                          class="mr-1"
                          checked
                        />
                        Specify R directly
                      </label>
                      <label class="inline-flex items-center text-sm">
                        <input
                          type="radio"
                          name="refluxMode"
                          value="multiple"
                          class="mr-1"
                        />
                        Multiple of R<sub>min</sub>
                      </label>
                    </div>
                  </div>

                  <div id="directRContainer">
                    <label class="block text-sm font-medium mb-1" for="R"
                      >Reflux ratio R = L/D</label
                    >
                    <input
                      id="R"
                      type="number"
                      step="0.1"
                      min="0.1"
                      value="2.5"
                      class="w-full border rounded px-3 py-2"
                    />
                  </div>

                  <div id="multipleRContainer" class="hidden">
                    <label
                      class="block text-sm font-medium mb-1"
                      for="Rmultiple"
                      >R / R<sub>min</sub></label
                    >
                    <input
                      id="Rmultiple"
                      type="number"
                      step="0.05"
                      min="1.01"
                      value="1.5"
                      class="w-full border rounded px-3 py-2"
                    />
                    <p class="text-xs text-gray-500 mt-1">
                      The tool will estimate R<sub>min</sub> from the pinch at
                      the feed intersection.
                    </p>
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium mb-1"
                      for="maxStages"
                      >Max stages to step</label
                    >
                    <input
                      id="maxStages"
                      type="number"
                      min="2"
                      max="200"
                      value="50"
                      class="w-full border rounded px-3 py-2"
                    />
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium mb-1"
                      for="stageType"
                      >Stage type</label
                    >
                    <select
                      id="stageType"
                      class="w-full border rounded px-3 py-2"
                    >
                      <option value="equilibrium">
                        Theoretical stages (equilibrium)
                      </option>
                      <option value="efficiency">
                        Murphree efficiency (specify below)
                      </option>
                    </select>
                  </div>

                  <div id="efficiencyContainer" class="hidden">
                    <label
                      class="block text-sm font-medium mb-1"
                      for="efficiency"
                      >Murphree efficiency E<sub>M</sub> (0–1)</label
                    >
                    <input
                      id="efficiency"
                      type="number"
                      step="0.05"
                      min="0.1"
                      max="1"
                      value="0.7"
                      class="w-full border rounded px-3 py-2"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Equilibrium data input -->
            <div class="mb-6">
              <details class="border rounded-md px-4 py-3">
                <summary class="cursor-pointer font-semibold text-sm">
                  Advanced: custom equilibrium data (x-y)
                </summary>
                <p class="text-sm text-gray-600 mt-2">
                  Paste tab- or comma-separated x,y pairs (0–1). If provided,
                  these data override the relative volatility model.
                </p>
                <textarea
                  id="xyData"
                  rows="4"
                  class="w-full border rounded px-3 py-2 text-xs font-mono"
                  placeholder="Example:
0,0
0.1,0.22
0.2,0.39
0.3,0.53
0.4,0.64
0.5,0.73
0.6,0.80
0.7,0.86
0.8,0.91
0.9,0.96
1.0,1.0"
                ></textarea>
                <button
                  id="clearXyData"
                  type="button"
                  class="mt-2 text-xs text-blue-600 hover:underline"
                >
                  Clear custom data
                </button>
              </details>
            </div>

            <!-- Actions -->
            <div class="flex flex-wrap items-center gap-3 mb-4">
              <button
                id="runCalc"
                type="button"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded shadow-sm"
              >
                Calculate &amp; Plot
              </button>
              <button
                id="resetCalc"
                type="button"
                class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-3 py-2 rounded"
              >
                Reset
              </button>
              <span id="errorMsg" class="text-sm text-red-600"></span>
            </div>

            <!-- Results summary -->
            <div
              id="resultsPanel"
              class="grid md:grid-cols-3 gap-4 mb-6 text-sm"
            >
              <div class="bg-blue-50 border border-blue-100 rounded p-3">
                <div class="font-semibold text-blue-800 mb-1">
                  Theoretical stages
                </div>
                <div id="stagesOut" class="text-2xl font-bold text-blue-900">
                  –
                </div>
                <div
                  id="effStagesOut"
                  class="text-xs text-blue-700 mt-1 hidden"
                ></div>
              </div>
              <div class="bg-green-50 border border-green-100 rounded p-3">
                <div class="font-semibold text-green-800 mb-1">Feed stage</div>
                <div
                  id="feedStageOut"
                  class="text-2xl font-bold text-green-900"
                >
                  –
                </div>
                <div class="text-xs text-green-700 mt-1">
                  Stage counted from the top (condenser = 0).
                </div>
              </div>
              <div class="bg-amber-50 border border-amber-100 rounded p-3">
                <div class="font-semibold text-amber-800 mb-1">Reflux info</div>
                <div class="text-xs text-amber-800">
                  <div>R: <span id="RusedOut">–</span></div>
                  <div>R<sub>min</sub>: <span id="RminOut">–</span></div>
                </div>
              </div>
            </div>

            <!-- Plot -->
            <div class="mb-6">
              <h2 class="text-lg font-semibold mb-2">McCabe-Thiele diagram</h2>
              <p class="text-sm text-gray-600 mb-2">
                The plot shows the equilibrium curve, operating lines, q-line,
                and staircase construction from x<sub>D</sub> to x<sub>B</sub>.
              </p>
              <div class="bg-gray-50 border rounded p-3">
                <canvas
                  id="mtCanvas"
                  width="600"
                  height="600"
                  aria-label="McCabe-Thiele diagram"
                ></canvas>
              </div>
              <p class="text-xs text-gray-500 mt-2">
                Tip: On a desktop, right-click the diagram and choose “Save
                image as…” to export it.
              </p>
            </div>

            <div class="prose">
              <h2>McCabe-Thiele method overview</h2>
              <p>
                The McCabe–Thiele method is a classic graphical technique for
                designing and analyzing binary distillation columns. It uses an
                <em>x–y</em> diagram (liquid vs. vapor composition of the light
                key) to determine the number of theoretical stages required to
                achieve specified distillate and bottoms purities at a given
                reflux ratio.
              </p>

              <h3>Key assumptions</h3>
              <ul>
                <li>Binary mixture (light key and heavy key).</li>
                <li>
                  Constant molar overflow (CMO): liquid and vapor flow rates are
                  constant in each section.
                </li>
                <li>
                  Equilibrium stages (each tray or packing height equivalent to
                  a theoretical stage).
                </li>
                <li>Constant pressure and negligible heat losses.</li>
                <li>
                  Total condenser (distillate composition equals top vapor
                  composition).
                </li>
              </ul>

              <h3>Equilibrium curve</h3>
              <p>
                For an ideal binary mixture with constant relative volatility \(
                \alpha \), the vapor–liquid equilibrium relation can be
                approximated as:
              </p>
              <div class="formula-box">
                \( y = \dfrac{\alpha x}{1 + (\alpha - 1)x} \)
              </div>
              <p>
                where \( x \) is the mole fraction of the light key in the
                liquid phase and \( y \) is the mole fraction in the vapor
                phase. In this calculator you can either:
              </p>
              <ul>
                <li>Use the relative volatility model (enter α), or</li>
                <li>
                  Paste your own experimental or simulated x–y data, which will
                  be interpolated.
                </li>
              </ul>

              <h3>Operating lines</h3>
              <p>
                Under constant molar overflow, the operating lines are straight
                in the x–y diagram.
              </p>
              <h4>Rectifying section (above the feed)</h4>
              <p>
                For a total condenser and reflux ratio \( R = L/D \), the
                rectifying operating line is:
              </p>
              <div class="formula-box">
                \( y = \dfrac{R}{R+1} x + \dfrac{x_D}{R+1} \)
              </div>

              <h4>Stripping section (below the feed)</h4>
              <p>
                The stripping operating line passes through the bottoms point \(
                (x_B, x_B) \) and the intersection with the q-line. Once the
                intersection point \( (x_q, y_q) \) is known, the line is:
              </p>
              <div class="formula-box">
                \( y = m_s x + b_s \) with \( m_s = \dfrac{y_q - x_B}{x_q - x_B}
                \), \( b_s = x_B (1 - m_s) \)
              </div>

              <h3>Feed line (q-line)</h3>
              <p>
                The feed quality \( q \) is the fraction of the feed that is
                liquid. The q-line in the x–y diagram is:
              </p>
              <div class="formula-box">
                \( y = \dfrac{q}{q-1} x - \dfrac{x_F}{q-1} \)
              </div>
              <p>Special cases:</p>
              <ul>
                <li>
                  Saturated liquid: \( q = 1 \) → vertical line at \( x = x_F
                  \).
                </li>
                <li>
                  Saturated vapor: \( q = 0 \) → horizontal line at \( y = x_F
                  \).
                </li>
                <li>
                  Subcooled liquid: \( q &gt; 1 \) → steep positive slope.
                </li>
                <li>Superheated vapor: \( q &lt; 0 \) → negative slope.</li>
              </ul>

              <h3>Minimum reflux ratio \( R_{\min} \)</h3>
              <p>
                The minimum reflux ratio corresponds to the limiting case where
                the operating line just touches the equilibrium curve at the
                feed intersection (pinch). A common graphical procedure is:
              </p>
              <ol>
                <li>Draw the q-line through \( x_F \).</li>
                <li>Find its intersection with the equilibrium curve.</li>
                <li>
                  Draw a straight line from that pinch point to \( (x_D, x_D)
                  \).
                </li>
                <li>
                  Compute its slope and back-calculate \( R_{\min} \) from the
                  rectifying operating line equation.
                </li>
              </ol>
              <p>
                This calculator automates that procedure numerically and lets
                you choose a multiple of \( R_{\min} \), e.g. 1.2–1.5.
              </p>

              <h3>Stage stepping and feed stage location</h3>
              <p>
                Once the equilibrium and operating lines are defined, the
                McCabe–Thiele construction proceeds by “stepping off” stages:
              </p>
              <ol>
                <li>Start at \( (x_D, x_D) \) on the diagonal.</li>
                <li>
                  Move horizontally to the equilibrium curve (vapor–liquid
                  equilibrium on a stage).
                </li>
                <li>
                  Move vertically to the appropriate operating line (material
                  balance between stages).
                </li>
                <li>Repeat until you reach \( x_B \).</li>
              </ol>
              <p>
                The feed stage is where the staircase switches from the
                rectifying to the stripping operating line. The calculator
                counts stages from the top (condenser = stage 0).
              </p>

              <h3>Murphree efficiency and actual trays</h3>
              <p>
                Real trays or packing are not perfectly efficient. A common way
                to relate theoretical stages to actual trays is via Murphree
                efficiency \( E_M \):
              </p>
              <div class="formula-box">
                \( N_{\text{actual}} \approx \dfrac{N_{\text{theoretical}}}{E_M}
                \)
              </div>
              <p>
                If you select “Murphree efficiency” and enter \( E_M \), the
                calculator will report both theoretical and estimated actual
                stages.
              </p>

              <h2>Worked example</h2>
              <p>Suppose you want to separate a binary mixture with:</p>
              <ul>
                <li>Feed composition \( x_F = 0.5 \)</li>
                <li>Distillate composition \( x_D = 0.95 \)</li>
                <li>Bottoms composition \( x_B = 0.05 \)</li>
                <li>Saturated liquid feed (q = 1)</li>
                <li>Relative volatility \( \alpha = 2.5 \)</li>
                <li>Reflux ratio \( R = 2.5 \)</li>
              </ul>
              <p>
                Enter these values and click “Calculate &amp; Plot”. The diagram
                will show the equilibrium curve, q-line, operating lines, and
                staircase. The results panel will display the number of
                theoretical stages, the feed stage index, and the reflux
                information. You can then adjust R or q to see how the design
                changes.
              </p>

              <h2>Limitations</h2>
              <ul>
                <li>Binary mixtures only (no multicomponent distillation).</li>
                <li>Assumes constant molar overflow and constant pressure.</li>
                <li>
                  For highly non-ideal systems with azeotropes, the
                  McCabe–Thiele method may not be applicable.
                </li>
              </ul>

              <h2>FAQ</h2>
              <h3>Can I use this for packed columns?</h3>
              <p>
                Yes, but you must convert the number of theoretical stages to
                height of packing using the height equivalent to a theoretical
                plate (HETP) for your packing and system.
              </p>

              <h3>What if my feed is not saturated?</h3>
              <p>
                Choose a q value different from 0 or 1 to represent subcooled or
                superheated feeds. If you know the enthalpy balance, you can
                compute q and enter it using the closest option or by editing
                the HTML to set a custom value.
              </p>

              <h3>How accurate is the relative volatility model?</h3>
              <p>
                For many ideal or near-ideal systems over a moderate composition
                range, assuming constant relative volatility is acceptable. For
                strongly non-ideal systems, you should use experimental VLE data
                or a thermodynamic model and paste the resulting x–y data into
                the custom equilibrium section.
              </p>
            </div>
          </div>



            <section class="mt-10" id="author">
              <h2 class="text-xl font-semibold mb-4">About the author</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  <a href="https://www.linkedin.com/in/ugocandido92821/" class="text-blue-600 hover:underline" target="_blank" rel="noopener">Ugo Candido</a>
                  builds financial tools and educational resources to help
                  readers make better money decisions. He focuses on practical,
                  transparent models that reflect how lenders calculate
                  payments and total cost of ownership.
                </p>
                <p class="text-sm text-gray-700 mt-3">
                  Contact: <a href="mailto:info@calcdomain.com" class="text-blue-600 hover:underline">info@calcdomain.com</a>
                </p>
              </div>
            </section>

            <section class="mt-10" id="editorial-policy">
              <h2 class="text-xl font-semibold mb-4">Editorial policy</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  CalcDomain content is created for educational purposes and is
                  reviewed for clarity, accuracy, and transparency. We do not
                  accept paid placements that influence calculator outputs.
                  Inputs and assumptions are shown directly in the interface so
                  you can verify how results are produced.
                </p>
              </div>
            </section>

            <section class="mt-10" id="methodology">
              <h2 class="text-xl font-semibold mb-4">Methodology</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p class="text-sm text-gray-700">
                  Results use standard formulas and the values you provide.
                  Figures are estimates and may differ from lender quotes.
                  For decisions that require professional guidance, consult a
                  licensed advisor.
                </p>
              </div>
            </section>

        
            <section class="mt-10" id="sources">
              <h2 class="text-xl font-semibold mb-4">Sources</h2>
              <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                  <li>
                    <a href="https://www.nist.gov/pml/owm/metric-si/si-units" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      NIST: The International System of Units (SI)
                    </a>
                  </li>
                  <li>
                    <a href="https://openstax.org/details/books/college-algebra" class="text-blue-600 hover:underline" target="_blank" rel="noopener">
                      OpenStax: College Algebra
                    </a>
                  </li>
                </ul>
              </div>
            </section>

        





<section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Feed composition x F (light key) Distillate x D Bottoms x B Feed condition (q-line) Saturated liquid (q = 1) Two-phase (q = 0.5) Saturated vapor (q = 0) Subcooled liquid (q &gt; 1, use 1.2) Superheated vapor (q &lt; 0, use -0.2) Relative volatility α (light/heavy) Used to generate an ideal equilibrium curve: y = αx / (1 + (α − 1)x). Reflux &amp; operating lines Reflux mode Specify R directly</li><li>Multiple of R min</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Operational notes</h2><p class="text-sm text-gray-700">Fill in realistic values and keep units and timeframes consistent.</p><p class="text-sm text-gray-700 mt-2">Key entities: Mccabe, Thiele, Feed composition x F (light key) Distillate x D Bottoms x B Feed condition (q-line) Saturated liquid (q = 1) Two-phase (q = 0.5) Saturated vapor (q = 0) Subcooled liquid (q &gt; 1, use 1.2) Superheated vapor (q &lt; 0, use -0.2) Relative volatility α (light/heavy) Used to generate an ideal equilibrium curve: y = αx / (1 + (α − 1)x). Reflux &amp; operating lines Reflux mode Specify R directly, Multiple of R min.</p></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Inputs used by this calculator</h2><ul class="text-sm text-gray-700 list-disc pl-5"><li>Feed composition x F (light key) Distillate x D Bottoms x B Feed condition (q-line) Saturated liquid (q = 1) Two-phase (q = 0.5) Saturated vapor (q = 0) Subcooled liquid (q &gt; 1, use 1.2) Superheated vapor (q &lt; 0, use -0.2) Relative volatility α (light/heavy) Used to generate an ideal equilibrium curve: y = αx / (1 + (α − 1)x). Reflux &amp; operating lines Reflux mode Specify R directly</li><li>Multiple of R min</li></ul></section><section class="bg-white p-4 rounded-lg shadow-md mt-6"><h2 class="text-lg font-semibold mb-2">Consistency checks</h2><p class="text-sm text-gray-700">Checks: non-negative values, plausible ranges, coherent outputs.</p></section><!-- %%EEAT_STRIP%% -->
<!-- %%QUALITY_BLOCKS%% -->
<!-- %%FAQ_JSONLD%% -->
</main>

        <aside class="w-full lg:w-1/3">
          <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <h2 class="text-lg font-semibold mb-3">
              Related Engineering Calculators
            </h2>
            <ul class="space-y-2 text-sm">
              <li>
                <a
                  href="https://calcdomain.com/reactor-design"
                  class="text-blue-600 hover:underline"
                  >Reactor Design Calculator (CSTR &amp; PFR)</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/batch-reactor-design"
                  class="text-blue-600 hover:underline"
                  >Batch Reactor Design</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/flash-distillation"
                  class="text-blue-600 hover:underline"
                  >Flash Distillation</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/heat-transfer"
                  class="text-blue-600 hover:underline"
                  >Heat Transfer</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bernoulli-equation"
                  class="text-blue-600 hover:underline"
                  >Bernoulli's Equation</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/reynolds-number"
                  class="text-blue-600 hover:underline"
                  >Reynolds Number</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/heat-loss"
                  class="text-blue-600 hover:underline"
                  >Heat Loss</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/psychrometric-chart"
                  class="text-blue-600 hover:underline"
                  >Psychrometric Chart</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/hazen-williams"
                  class="text-blue-600 hover:underline"
                  >Pipe Flow (Hazen–Williams)</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/darcy-weisbach"
                  class="text-blue-600 hover:underline"
                  >Pipe Flow (Darcy–Weisbach)</a
                >
              </li>
            </ul>
          </div>

          <div class="bg-white p-4 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-3">Quick Tips</h2>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
              <li>
                Start with saturated liquid feed (q = 1) and moderate R (2–3) to
                get a feel for the system.
              </li>
              <li>
                Use your own x–y data for non-ideal mixtures or azeotropes.
              </li>
              <li>
                Compare theoretical stages with actual trays using Murphree
                efficiency.
              </li>
              <li>
                Experiment with R / R<sub>min</sub> to see the trade-off between
                stages and energy use.
              </li>
            </ul>
          </div>
        </aside>
      </div>
    </div>

    <footer class="bg-gray-900 text-white py-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-2xl font-bold mb-4">CalcDomain</h3>
            <p class="text-gray-400 mb-4">
              Your trusted source for free online calculators. Accurate, fast,
              and reliable calculations for every need.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Categories</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/finance"
                  class="text-gray-400 hover:text-white"
                  >Finance</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/health-fitness"
                  class="text-gray-400 hover:text-white"
                  >Health & Fitness</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/math-conversions"
                  class="text-gray-400 hover:text-white"
                  >Math & Conversions</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/lifestyle-everyday"
                  class="text-gray-400 hover:text-white"
                  >Lifestyle & Everyday</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/construction-diy"
                  class="text-gray-400 hover:text-white"
                  >Construction & DIY</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Popular Tools</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/mortgage-payment"
                  class="text-gray-400 hover:text-white"
                  >Mortgage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/percentage-calculator"
                  class="text-gray-400 hover:text-white"
                  >Percentage Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/bmi-calculator"
                  class="text-gray-400 hover:text-white"
                  >BMI Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/auto-loan-calculator"
                  class="text-gray-400 hover:text-white"
                  >Auto Loan Calculator</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/house-affordability"
                  class="text-gray-400 hover:text-white"
                  >House Affordability</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Support</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="https://calcdomain.com/about"
                  class="text-gray-400 hover:text-white"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/contact"
                  class="text-gray-400 hover:text-white"
                  >Contact</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/privacy"
                  class="text-gray-400 hover:text-white"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/terms"
                  class="text-gray-400 hover:text-white"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="https://calcdomain.com/sitemap.xml"
                  class="text-gray-400 hover:text-white"
                  >Site Map</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>
            &copy; 2025 CalcDomain. All Rights Reserved. | Free Online
            Calculators for Everyone
          </p>
        </div>
      </div>
    </footer>

    <script src="/assets/js/mobile-menu.js"></script>
    <script src="/search.js"></script>

    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["\\(", "\\)"],
            ["$", "$"],
          ],
          displayMath: [
            ["$", "$"],
            ["\\[", "\\]"],
          ],
        },
        svg: { fontCache: "global" },
      };
    </script>
    <script>
  (function () {
    var loadMathJax = function () {
      if (window.__mathjaxLoading) return;
      window.__mathjaxLoading = true;
      var script = document.createElement("script");
      script.id = "MathJax-script";
      script.async = true;
      script.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js";
      document.head.appendChild(script);
    };

    var target = document.querySelector(
      ".formula-box, .mathjax, .math, .formula, [data-mathjax]"
    );

    if (!target) return;

    if ("IntersectionObserver" in window) {
      var observer = new IntersectionObserver(
        function (entries) {
          if (entries.some(function (entry) { return entry.isIntersecting; })) {
            observer.disconnect();
            loadMathJax();
          }
        },
        { rootMargin: "200px" }
      );
      observer.observe(target);
    } else {
      window.addEventListener(
        "load",
        function () {
          setTimeout(loadMathJax, 1000);
        },
        { once: true }
      );
    }
  })();
</script>

    <script>
      // UI helpers
      document
        .getElementById("mobile-menu-toggle")
        .addEventListener("click", () => {
          const menu = document.getElementById("mobile-menu");
          menu.classList.toggle("hidden");
        });

      // Reflux mode toggle
      const refluxRadios = document.querySelectorAll(
        'input[name="refluxMode"]'
      );
      const directRContainer = document.getElementById("directRContainer");
      const multipleRContainer = document.getElementById("multipleRContainer");
      refluxRadios.forEach((r) => {
        r.addEventListener("change", () => {
          if (r.checked && r.value === "direct") {
            directRContainer.classList.remove("hidden");
            multipleRContainer.classList.add("hidden");
          } else if (r.checked && r.value === "multiple") {
            directRContainer.classList.add("hidden");
            multipleRContainer.classList.remove("hidden");
          }
        });
      });

      // Stage type toggle
      const stageType = document.getElementById("stageType");
      const efficiencyContainer = document.getElementById(
        "efficiencyContainer"
      );
      stageType.addEventListener("change", () => {
        if (stageType.value === "efficiency") {
          efficiencyContainer.classList.remove("hidden");
        } else {
          efficiencyContainer.classList.add("hidden");
        }
      });

      // Clear custom xy data
      document.getElementById("clearXyData").addEventListener("click", () => {
        document.getElementById("xyData").value = "";
      });

      // Reset button
      document.getElementById("resetCalc").addEventListener("click", () => {
        document.getElementById("xF").value = 0.5;
        document.getElementById("xD").value = 0.95;
        document.getElementById("xB").value = 0.05;
        document.getElementById("feedCondition").value = "1";
        document.getElementById("alpha").value = 2.5;
        document.getElementById("R").value = 2.5;
        document.getElementById("Rmultiple").value = 1.5;
        document.getElementById("maxStages").value = 50;
        document.getElementById("stageType").value = "equilibrium";
        efficiencyContainer.classList.add("hidden");
        document.getElementById("efficiency").value = 0.7;
        document.getElementById("xyData").value = "";
        document.getElementById("errorMsg").textContent = "";
        document.getElementById("stagesOut").textContent = "–";
        document.getElementById("feedStageOut").textContent = "–";
        document.getElementById("RusedOut").textContent = "–";
        document.getElementById("RminOut").textContent = "–";
        document.getElementById("effStagesOut").classList.add("hidden");
        clearCanvas();
      });

      // Core numerical helpers
      function linspace(a, b, n) {
        const arr = [];
        const step = (b - a) / (n - 1);
        for (let i = 0; i < n; i++) arr.push(a + i * step);
        return arr;
      }

      // Parse custom xy data
      function parseXyData(text) {
        const lines = text
          .split(/\r?\n/)
          .map((l) => l.trim())
          .filter((l) => l.length > 0);
        const xs = [],
          ys = [];
        for (const line of lines) {
          const parts = line.split(/[\s,;]+/);
          if (parts.length < 2) continue;
          const x = parseFloat(parts[0]);
          const y = parseFloat(parts[1]);
          if (
            isFinite(x) &&
            isFinite(y) &&
            x >= 0 &&
            x <= 1 &&
            y >= 0 &&
            y <= 1
          ) {
            xs.push(x);
            ys.push(y);
          }
        }
        if (xs.length < 3) return null;
        // sort by x
        const idx = xs.map((v, i) => i).sort((a, b) => xs[a] - xs[b]);
        return {
          xs: idx.map((i) => xs[i]),
          ys: idx.map((i) => ys[i]),
          interp: function (x) {
            if (x <= this.xs[0]) return this.ys[0];
            if (x >= this.xs[this.xs.length - 1])
              return this.ys[this.ys.length - 1];
            let i = 0;
            while (i < this.xs.length - 1 && this.xs[i + 1] < x) i++;
            const x1 = this.xs[i],
              x2 = this.xs[i + 1];
            const y1 = this.ys[i],
              y2 = this.ys[i + 1];
            const t = (x - x1) / (x2 - x1);
            return y1 + t * (y2 - y1);
          },
        };
      }

      // Equilibrium y(x)
      function makeEquilibrium(alpha, custom) {
        if (custom) {
          return (x) => custom.interp(x);
        }
        return (x) => {
          x = Math.min(1, Math.max(0, x));
          return (alpha * x) / (1 + (alpha - 1) * x);
        };
      }

      // q-line y(x)
      function qLine(x, xF, q) {
        if (Math.abs(q - 1) < 1e-6) {
          // vertical line at xF; we handle specially in intersection search
          return null;
        }
        const m = q / (q - 1);
        const b = -xF / (q - 1);
        return m * x + b;
      }

      // Find intersection of q-line and rectifying line
      function findIntersectionRectifying(xF, q, xD, R, eqY) {
        // rectifying: y = (R/(R+1)) x + xD/(R+1)
        const mR = R / (R + 1);
        const bR = xD / (R + 1);

        if (Math.abs(q - 1) < 1e-6) {
          // vertical q-line at x = xF
          const x = xF;
          const y = mR * x + bR;
          return { x, y };
        } else if (Math.abs(q) < 1e-6) {
          // horizontal q-line at y = xF
          const y = xF;
          const x = (y - bR) / mR;
          return { x, y };
        } else {
          const mQ = q / (q - 1);
          const bQ = -xF / (q - 1);
          const x = (bQ - bR) / (mR - mQ);
          const y = mR * x + bR;
          return { x, y };
        }
      }

      // Estimate Rmin by finding pinch between rectifying line through pinch and equilibrium
      function estimateRmin(xF, q, xD, eqY) {
        // For simplicity, approximate pinch at intersection of q-line and equilibrium
        // Find x where q-line and eq curve intersect (numerical)
        const n = 400;
        let bestX = null,
          bestDiff = 1e9;
        const xs = linspace(0, 1, n);
        for (const x of xs) {
          let yq;
          if (Math.abs(q - 1) < 1e-6) {
            // vertical line: x = xF; intersection at xF, y = eqY(xF)
            bestX = xF;
            break;
          } else if (Math.abs(q) < 1e-6) {
            yq = xF;
          } else {
            const mQ = q / (q - 1);
            const bQ = -xF / (q - 1);
            yq = mQ * x + bQ;
          }
          const ye = eqY(x);
          const diff = Math.abs(ye - yq);
          if (diff < bestDiff) {
            bestDiff = diff;
            bestX = x;
          }
        }
        if (bestX === null) return null;
        const yPinch = eqY(bestX);
        // Line through (xD,xD) and (xPinch,yPinch): y = m x + b
        const m = (yPinch - xD) / (bestX - xD);
        const b = xD - m * xD;
        // Compare with rectifying form: y = (R/(R+1)) x + xD/(R+1)
        // So m = R/(R+1) => R = m/(1-m)
        const Rmin = m >= 1 ? null : m / (1 - m);
        return { Rmin, pinchX: bestX, pinchY: yPinch };
      }

      // Build operating lines
      function rectifyingY(x, xD, R) {
        return (R / (R + 1)) * x + xD / (R + 1);
      }

      function strippingLineFromFeed(xB, xq, yq) {
        const m = (yq - xB) / (xq - xB);
        const b = xB * (1 - m);
        return { m, b, y: (x) => m * x + b };
      }

      // Stage stepping
      function stepStages(
        xD,
        xB,
        xF,
        q,
        xEq,
        yEq,
        xDop,
        yRect,
        yStrip,
        maxStages
      ) {
        let stages = [];
        let x = xD;
        let y = xD;
        let feedStage = null;
        let section = "rect"; // 'rect' or 'strip'
        let lastLine = "rect";
        for (let i = 0; i < maxStages * 2; i++) {
          // horizontal to equilibrium
          const xNew = invertEquilibrium(y, xEq, yEq);
          if (xNew === null) break;
          stages.push({ type: "h", x1: x, y1: y, x2: xNew, y2: y });
          x = xNew;

          if (x < xB + 1e-4) break;

          // vertical to operating line
          let yNew;
          if (section === "rect") {
            yNew = yRect(x);
            if (yStrip && x <= xF && qLine(x, xF, q) !== null) {
              // approximate switch when x passes feed composition
              section = "strip";
              feedStage = stages.length / 2; // approximate
            }
          } else {
            yNew = yStrip(x);
          }
          stages.push({ type: "v", x1: x, y1: y, x2: x, y2: yNew });
          y = yNew;
        }
        return { stages, feedStage };
      }

      // Invert equilibrium y(x) numerically using precomputed arrays
      function invertEquilibrium(yTarget, xArr, yArr) {
        // assume yArr is monotonic increasing with x
        if (yTarget <= yArr[0]) return xArr[0];
        if (yTarget >= yArr[yArr.length - 1]) return xArr[xArr.length - 1];
        let lo = 0,
          hi = yArr.length - 1;
        while (hi - lo > 1) {
          const mid = Math.floor((lo + hi) / 2);
          if (yArr[mid] < yTarget) lo = mid;
          else hi = mid;
        }
        const y1 = yArr[lo],
          y2 = yArr[hi];
        const x1 = xArr[lo],
          x2 = xArr[hi];
        const t = (yTarget - y1) / (y2 - y1);
        return x1 + t * (x2 - x1);
      }

      // Canvas drawing
      const canvas = document.getElementById("mtCanvas");
      const ctx = canvas.getContext("2d");
      const PAD = 50;

      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // axes and diagonal
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(PAD, canvas.height - PAD);
        ctx.lineTo(canvas.width - PAD, canvas.height - PAD); // x-axis
        ctx.moveTo(PAD, canvas.height - PAD);
        ctx.lineTo(PAD, PAD); // y-axis
        ctx.stroke();

        // diagonal y=x
        ctx.strokeStyle = "#9ca3af";
        ctx.setLineDash([4, 4]);
        ctx.beginPath();
        ctx.moveTo(PAD, canvas.height - PAD);
        ctx.lineTo(canvas.width - PAD, PAD);
        ctx.stroke();
        ctx.setLineDash([]);

        // labels
        ctx.fillStyle = "#111827";
        ctx.font = "12px Inter, sans-serif";
        ctx.fillText(
          "x (liquid mole fraction, light key)",
          canvas.width / 2 - 80,
          canvas.height - 10
        );
        ctx.save();
        ctx.translate(15, canvas.height / 2 + 40);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText("y (vapor mole fraction, light key)", 0, 0);
        ctx.restore();

        // ticks
        ctx.font = "10px Inter, sans-serif";
        for (let i = 0; i <= 10; i++) {
          const t = i / 10;
          const x = PAD + t * (canvas.width - 2 * PAD);
          const y = canvas.height - PAD;
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x, y + 4);
          ctx.strokeStyle = "#6b7280";
          ctx.stroke();
          ctx.fillText(t.toFixed(1), x - 8, y + 16);

          const yy = canvas.height - PAD - t * (canvas.height - 2 * PAD);
          ctx.beginPath();
          ctx.moveTo(PAD, yy);
          ctx.lineTo(PAD - 4, yy);
          ctx.stroke();
          ctx.fillText(t.toFixed(1), PAD - 26, yy + 3);
        }
      }

      function toCanvas(x, y) {
        const cx = PAD + x * (canvas.width - 2 * PAD);
        const cy = canvas.height - PAD - y * (canvas.height - 2 * PAD);
        return { cx, cy };
      }

      function drawCurve(xs, ys, color, width, dash) {
        ctx.save();
        ctx.strokeStyle = color;
        ctx.lineWidth = width || 1;
        if (dash) ctx.setLineDash(dash);
        ctx.beginPath();
        xs.forEach((x, i) => {
          const p = toCanvas(x, ys[i]);
          if (i === 0) ctx.moveTo(p.cx, p.cy);
          else ctx.lineTo(p.cx, p.cy);
        });
        ctx.stroke();
        ctx.restore();
      }

      function drawLine(x1, y1, x2, y2, color, width, dash) {
        const p1 = toCanvas(x1, y1);
        const p2 = toCanvas(x2, y2);
        ctx.save();
        ctx.strokeStyle = color;
        ctx.lineWidth = width || 1;
        if (dash) ctx.setLineDash(dash);
        ctx.beginPath();
        ctx.moveTo(p1.cx, p1.cy);
        ctx.lineTo(p2.cx, p2.cy);
        ctx.stroke();
        ctx.restore();
      }

      function drawStages(stages) {
        ctx.save();
        ctx.strokeStyle = "#ef4444";
        ctx.lineWidth = 1.5;
        stages.forEach((seg) => {
          const p1 = toCanvas(seg.x1, seg.y1);
          const p2 = toCanvas(seg.x2, seg.y2);
          ctx.beginPath();
          ctx.moveTo(p1.cx, p1.cy);
          ctx.lineTo(p2.cx, p2.cy);
          ctx.stroke();
        });
        ctx.restore();
      }

      // Main calculation
      document.getElementById("runCalc").addEventListener("click", () => {
        const errEl = document.getElementById("errorMsg");
        errEl.textContent = "";

        const xF = parseFloat(document.getElementById("xF").value);
        const xD = parseFloat(document.getElementById("xD").value);
        const xB = parseFloat(document.getElementById("xB").value);
        const q = parseFloat(document.getElementById("feedCondition").value);
        const alpha = parseFloat(document.getElementById("alpha").value);
        const maxStages = parseInt(
          document.getElementById("maxStages").value,
          10
        );
        const refluxMode = Array.from(refluxRadios).find(
          (r) => r.checked
        ).value;

        if (![xF, xD, xB, q, alpha].every((v) => isFinite(v))) {
          errEl.textContent = "Please enter valid numeric inputs.";
          return;
        }
        if (!(xB < xF && xF < xD)) {
          errEl.textContent =
            "Require xB < xF < xD for a meaningful separation.";
          return;
        }
        if (alpha <= 1 && !document.getElementById("xyData").value.trim()) {
          errEl.textContent =
            "Relative volatility must be > 1, or provide custom equilibrium data.";
          return;
        }

        let custom = null;
        const xyText = document.getElementById("xyData").value.trim();
        if (xyText) {
          custom = parseXyData(xyText);
          if (!custom) {
            errEl.textContent =
              "Custom equilibrium data must contain at least 3 valid x,y pairs in [0,1].";
            return;
          }
        }

        const eq = makeEquilibrium(alpha, custom);
        const xGrid = linspace(0, 1, 501);
        const yEq = xGrid.map(eq);

        // Estimate Rmin if needed
        let RminInfo = estimateRmin(xF, q, xD, eq);
        let Rmin =
          RminInfo && RminInfo.Rmin && RminInfo.Rmin > 0 ? RminInfo.Rmin : null;

        let R;
        if (refluxMode === "direct") {
          R = parseFloat(document.getElementById("R").value);
          if (!isFinite(R) || R <= 0) {
            errEl.textContent = "Reflux ratio R must be positive.";
            return;
          }
        } else {
          if (!Rmin) {
            errEl.textContent =
              "Could not estimate Rmin for the given conditions.";
            return;
          }
          const mult = parseFloat(document.getElementById("Rmultiple").value);
          if (!isFinite(mult) || mult <= 1) {
            errEl.textContent = "R/Rmin must be greater than 1.";
            return;
          }
          R = mult * Rmin;
        }

        // Rectifying line
        const yRect = (x) => rectifyingY(x, xD, R);

        // Intersection of rectifying line and q-line
        const inter = findIntersectionRectifying(xF, q, xD, R, eq);
        const xq = inter.x;
        const yq = inter.y;

        // Stripping line
        const strip = strippingLineFromFeed(xB, xq, yq);
        const yStrip = strip.y;

        // Stage stepping
        const stepRes = stepStages(
          xD,
          xB,
          xF,
          q,
          xGrid,
          yEq,
          xD,
          yRect,
          yStrip,
          maxStages
        );
        const stages = stepRes.stages;
        let feedStage = stepRes.feedStage;

        // Count theoretical stages (horizontal segments)
        const nTheo = stages.filter((s) => s.type === "h").length;

        // Murphree efficiency
        const stType = document.getElementById("stageType").value;
        const effEl = document.getElementById("effStagesOut");
        let nActual = null;
        if (stType === "efficiency") {
          const E = parseFloat(document.getElementById("efficiency").value);
          if (isFinite(E) && E > 0 && E <= 1) {
            nActual = nTheo / E;
            effEl.textContent =
              "Estimated actual stages (Murphree): " + nActual.toFixed(1);
            effEl.classList.remove("hidden");
          } else {
            effEl.classList.add("hidden");
          }
        } else {
          effEl.classList.add("hidden");
        }

        // Update results
        document.getElementById("stagesOut").textContent = nTheo
          ? nTheo.toString()
          : "–";
        document.getElementById("feedStageOut").textContent = feedStage
          ? feedStage.toFixed(1)
          : "–";
        document.getElementById("RusedOut").textContent = R
          ? R.toFixed(3)
          : "–";
        document.getElementById("RminOut").textContent = Rmin
          ? Rmin.toFixed(3)
          : "–";

        // Draw
        clearCanvas();

        // Equilibrium curve
        drawCurve(xGrid, yEq, "#1d4ed8", 2);

        // Rectifying line segment between xD and xq
        const xRectSeg = linspace(xD, xq, 50);
        const yRectSeg = xRectSeg.map(yRect);
        drawCurve(xRectSeg, yRectSeg, "#10b981", 1.5);

        // Stripping line segment between xq and xB
        const xStripSeg = linspace(xq, xB, 50);
        const yStripSeg = xStripSeg.map(yStrip);
        drawCurve(xStripSeg, yStripSeg, "#f59e0b", 1.5);

        // q-line
        if (Math.abs(q - 1) < 1e-6) {
          drawLine(xF, 0, xF, 1, "#6b21a8", 1, [4, 4]);
        } else if (Math.abs(q) < 1e-6) {
          drawLine(0, xF, 1, xF, "#6b21a8", 1, [4, 4]);
        } else {
          const x1 = 0,
            x2 = 1;
          const mQ = q / (q - 1);
          const bQ = -xF / (q - 1);
          const y1 = mQ * x1 + bQ;
          const y2 = mQ * x2 + bQ;
          drawLine(x1, y1, x2, y2, "#6b21a8", 1, [4, 4]);
        }

        // Diagonal is already drawn in clearCanvas()

        // Stages
        drawStages(stages);

        // Mark key points
        function drawPoint(x, y, color) {
          const p = toCanvas(x, y);
          ctx.save();
          ctx.fillStyle = color;
          ctx.beginPath();
          ctx.arc(p.cx, p.cy, 3, 0, 2 * Math.PI);
          ctx.fill();
          ctx.restore();
        }
        drawPoint(xD, xD, "#0f766e"); // distillate
        drawPoint(xB, xB, "#b91c1c"); // bottoms
        drawPoint(xF, Math.min(1, Math.max(0, eq(xF))), "#7c3aed"); // feed approx
        drawPoint(xq, yq, "#f97316"); // feed intersection
      });
      clearCanvas();
    </script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7MB5V1LZRN"></script>
<script>
  window.__cmpLoadQueued = window.__cmpLoadQueued || [];
  window.addEventListener("load", function () {
    var loadCmp = function () {
      var s1 = document.createElement("script");
      s1.src = "https://cmp.gatekeeperconsent.com/min.js";
      s1.async = true;
      s1.setAttribute("data-cfasync", "false");
      document.head.appendChild(s1);

      var s2 = document.createElement("script");
      s2.src = "https://the.gatekeeperconsent.com/cmp.min.js";
      s2.async = true;
      s2.setAttribute("data-cfasync", "false");
      document.head.appendChild(s2);
    };

    if ("requestIdleCallback" in window) {
      requestIdleCallback(loadCmp, { timeout: 2000 });
    } else {
      setTimeout(loadCmp, 1000);
    }
  });
</script>
<script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
<script>
      window.ezstandalone = window.ezstandalone || {};
      ezstandalone.cmd = ezstandalone.cmd || [];
    </script>
</body>
</html>
