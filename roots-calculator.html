<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Roots Calculator — n-th Roots & Polynomial Roots (Real & Complex)</title>
<meta name="description" content="Professional roots calculator: compute n-th roots of real numbers (including principal complex roots) and solve polynomial equations up to degree 20 with complex solutions, step-by-step and accessible.">
<link rel="canonical" href="https://calcdomain.com/roots-calculator.html">
<link rel="icon" href="/favicon.ico">
<meta name="author" content="Ugo Candido">

<!-- Critical, minimal CSS (mobile-first, high-contrast) -->
<style>
  :root{
    --bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--brand:#1d4ed8;--brand-2:#0ea5e9;
    --ok:#065f46;--err:#991b1b;--focus:#f59e0b;--border:#e5e7eb;--chip:#eef2ff;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif;line-height:1.5}
  a{color:var(--brand)} a:focus{outline:3px solid var(--focus);outline-offset:2px;border-radius:6px}
  .container{max-width:1100px;margin-inline:auto;padding:16px}
  header{background:#fff;border-bottom:1px solid var(--border)}
  header .brand{font-weight:800;font-size:1.25rem;color:var(--brand);text-decoration:none}
  nav.breadcrumb{font-size:.875rem;color:var(--muted);margin:12px 0}
  nav.breadcrumb a{color:inherit;text-decoration:none}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
  h1{font-size:1.875rem;line-height:1.2;margin:.25rem 0 .5rem}
  h2{font-size:1.375rem;margin:1.25rem 0 .5rem}
  h3{font-size:1.125rem;margin:1rem 0 .25rem}
  p{margin:.5rem 0}
  /* form */
  .grid{display:grid;gap:12px}
  @media (min-width:720px){.grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}
  label{display:block;font-weight:600;margin-bottom:6px}
  .req::after{content:" *";color:var(--brand)}
  .row{display:flex;align-items:center;gap:8px}
  .help-btn{border:1px solid var(--border);background:var(--chip);border-radius:999px;width:28px;height:28px;display:inline-grid;place-items:center;font-weight:700;cursor:pointer}
  .help-btn:focus,.btn:focus,.tab:focus,input:focus,select:focus,textarea:focus{outline:3px solid var(--focus);outline-offset:2px;border-radius:8px}
  input[type="number"],input[type="text"],select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font:inherit;background:#fff}
  textarea{min-height:72px;resize:vertical}
  .err{color:var(--err);font-size:.875rem;margin-top:6px}
  .hint{font-size:.875rem;color:var(--muted)}
  .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:.5rem 0}
  .tab{border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:999px;cursor:pointer}
  .tab[aria-selected="true"]{background:var(--brand);color:#fff;border-color:var(--brand)}
  .btn{display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 14px;cursor:pointer;font-weight:700}
  .btn.secondary{background:#111827;color:#fff}
  .btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand)}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  /* results */
  #results{min-height:180px} /* prevent CLS */
  .kpis{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
  .kpi{border:1px solid var(--border);border-radius:12px;padding:10px;text-align:center;background:#fff}
  .kpi h4{margin:0;color:var(--muted);font-size:.875rem}
  .kpi p{margin:.25rem 0 0;font-weight:800;font-size:1.25rem;color:var(--brand)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:10px;padding:12px;overflow:auto}
  details>summary{cursor:pointer;font-weight:700}
  .vis{border:1px solid var(--border);border-radius:12px;background:#fff;padding:8px}
  canvas{width:100%;height:260px;max-height:260px;display:block}
  footer{background:#fff;border-top:1px solid var(--border);margin-top:24px}
  .muted{color:var(--muted);font-size:.9rem}
  @media print{
    header,nav,aside,.actions,.tabs,.hint,.help,.help-btn{display:none !important}
    .container{max-width:100%;padding:0}
    #print-section{position:absolute;inset:0}
  }
</style>

<!-- MathJax for LaTeX rendering (defer for INP) -->
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        id="MathJax-script"></script>

<!-- Structured Data (WebPage + Breadcrumbs + SoftwareApplication + HowTo + FAQPage) -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebPage",
      "name":"Roots Calculator — n-th Roots & Polynomial Roots",
      "url":"https://calcdomain.com/roots-calculator.html",
      "inLanguage":"en",
      "description":"Compute n-th roots and solve polynomial equations (real & complex) with step-by-step explanations.",
      "author":{"@type":"Person","name":"Ugo Candido"},
      "publisher":{"@type":"Organization","name":"CalcDomain"}
    },
    {
      "@type":"BreadcrumbList",
      "itemListElement":[
        {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
        {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
        {"@type":"ListItem","position":3,"name":"Algebra","item":"https://calcdomain.com/subcategories/core-math-algebra.html"},
        {"@type":"ListItem","position":4,"name":"Roots Calculator","item":"https://calcdomain.com/roots-calculator.html"}
      ]
    },
    {
      "@type":"SoftwareApplication",
      "name":"Roots Calculator",
      "applicationCategory":"EducationalApplication",
      "operatingSystem":"Web",
      "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
      "author":{"@type":"Person","name":"Ugo Candido"},
      "publisher":{"@type":"Organization","name":"CalcDomain"}
    },
    {
      "@type":"HowTo",
      "name":"How to find n-th roots and polynomial roots",
      "step":[
        {"@type":"HowToStep","name":"Choose mode","text":"Select either n-th Root or Polynomial Roots."},
        {"@type":"HowToStep","name":"Enter inputs","text":"Provide the number and index n, or polynomial coefficients."},
        {"@type":"HowToStep","name":"Calculate","text":"Click Calculate to compute real and complex roots."},
        {"@type":"HowToStep","name":"Review results","text":"See exact/decimal forms and a complex-plane plot."}
      ]
    },
    {
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"Does this show complex roots?",
         "acceptedAnswer":{"@type":"Answer","text":"Yes. Both n-th roots and polynomial roots may be complex; all solutions are shown with real and imaginary parts."}},
        {"@type":"Question","name":"What is the maximum degree?",
         "acceptedAnswer":{"@type":"Answer","text":"Up to 20 by default; numerical stability measures are included but extreme coefficients may need scaling."}},
        {"@type":"Question","name":"Which method is used?",
         "acceptedAnswer":{"@type":"Answer","text":"A Durand–Kerner–Aberth style simultaneous iteration with deflation safeguards and convergence checks."}},
        {"@type":"Question","name":"Can I paste a polynomial string?",
         "acceptedAnswer":{"@type":"Answer","text":"Yes. Use the polynomial parser to read expressions like 2x^4 - 3x + 1."}},
        {"@type":"Question","name":"How are n-th roots defined?",
         "acceptedAnswer":{"@type":"Answer","text":"The calculator returns the principal complex root and the full set of n equally spaced complex roots on the complex plane."}}
      ]
    }
  ]
}
</script>
</head>
<body>
<header>
  <div class="container row" role="navigation" aria-label="Top bar">
    <a class="brand" href="index.html" aria-label="CalcDomain home">CalcDomain</a>
    <div class="hint" aria-hidden="true">Math › Algebra</div>
  </div>
</header>

<main class="container" id="print-section">
  <!-- Breadcrumb -->
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a href="index.html">Home</a> ›
    <a href="math.html">Math</a> ›
    <a href="subcategories/math-algebra.html">Algebra</a> ›
    <span aria-current="page">Roots Calculator</span>
  </nav>

  <!-- 1) H1 -->
  <h1>roots calculator</h1>

  <!-- 2) Intro -->
  <p class="muted">Compute <strong>n-th roots</strong> of real numbers (including the full complex set) and find
  <strong>polynomial roots</strong> up to degree 20 with professional accuracy, accessible UI, and step-by-step explanations. Built for students, engineers, and analysts who need reliable results—fast.</p>

  <!-- 3) Calculator -->
  <section class="card" aria-labelledby="calc-title" id="calculator">
    <h2 id="calc-title">Interactive Calculator</h2>

    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="Mode selection">
      <button class="tab" id="tab-nth" role="tab" aria-selected="true" aria-controls="panel-nth">n-th Root</button>
      <button class="tab" id="tab-poly" role="tab" aria-selected="false" aria-controls="panel-poly">Polynomial Roots</button>
    </div>

    <!-- n-th root panel -->
    <div id="panel-nth" role="tabpanel" aria-labelledby="tab-nth">
      <div class="grid cols-2">
        <div>
          <div class="row">
            <label class="req" for="nth-number">Number (a)</label>
            <button class="help-btn" type="button" aria-expanded="false" aria-controls="help-a" aria-label="Help: Number">?</button>
          </div>
          <input inputmode="decimal" type="number" id="nth-number" value="64" aria-required="true"
                 aria-describedby="err-a help-a">
          <div id="err-a" class="err" role="alert" hidden></div>
          <div id="help-a" class="hint" hidden>The value a whose n-th roots you want. Negative a is allowed; complex roots are supported.</div>
        </div>

        <div>
          <div class="row">
            <label class="req" for="nth-index">Index (n)</label>
            <button class="help-btn" type="button" aria-expanded="false" aria-controls="help-n" aria-label="Help: Index">?</button>
          </div>
          <input inputmode="numeric" type="number" id="nth-index" value="3" min="1" step="1" aria-required="true"
                 aria-describedby="err-n help-n">
          <div id="err-n" class="err" role="alert" hidden></div>
          <div id="help-n" class="hint" hidden>Positive integer n ≥ 1. The calculator returns the principal root and all n complex roots.</div>
        </div>
      </div>

      <div class="grid" style="margin-top:8px">
        <div class="row">
          <label for="nth-precision">Decimal precision</label>
          <button class="help-btn" type="button" aria-expanded="false" aria-controls="help-prec" aria-label="Help: Precision">?</button>
        </div>
        <input type="number" id="nth-precision" value="6" min="0" max="12" step="1" aria-describedby="help-prec">
        <div id="help-prec" class="hint" hidden>Number of digits after the decimal point for displayed values (does not affect internal precision).</div>
      </div>

      <div class="actions" style="margin-top:10px">
        <button id="btn-calc-nth" class="btn" type="button">Calculate</button>
        <button id="btn-clear-nth" class="btn ghost" type="button">Clear</button>
      </div>
    </div>

    <!-- polynomial panel -->
    <div id="panel-poly" role="tabpanel" aria-labelledby="tab-poly" hidden>
      <div class="grid">
        <div>
          <div class="row">
            <label class="req" for="poly-coefs">Coefficients (highest → constant)</label>
            <button class="help-btn" type="button" aria-expanded="false" aria-controls="help-coef" aria-label="Help: Coefficients">?</button>
          </div>
          <input id="poly-coefs" type="text" class="mono" placeholder="e.g., 1, 0, -3, 1  (for x^3 - 3x + 1)"
                 value="1, 0, -3, 1" aria-required="true" aria-describedby="err-coef help-coef">
          <div id="err-coef" class="err" role="alert" hidden></div>
          <div id="help-coef" class="hint" hidden>Enter comma- or space-separated numbers (real); first is a<sub>n</sub> (≠0). Example: 2, -5, 0, 7 means 2x³ − 5x² + 0x + 7.</div>
        </div>

        <div>
          <div class="row">
            <label for="poly-str">Or paste polynomial (optional)</label>
            <button class="help-btn" type="button" aria-expanded="false" aria-controls="help-parse" aria-label="Help: Parser">?</button>
          </div>
          <input id="poly-str" type="text" class="mono" placeholder="e.g., 2x^4 - 3x + 1" aria-describedby="help-parse">
          <div id="help-parse" class="hint" hidden>Click “Parse to Coefficients” to convert an expression (x variable) into the coefficients list.</div>
          <div class="actions" style="margin-top:8px">
            <button id="btn-parse" type="button" class="btn secondary">Parse to Coefficients</button>
          </div>
        </div>

        <div class="grid cols-2">
          <div>
            <label for="poly-precision">Decimal precision</label>
            <input type="number" id="poly-precision" value="6" min="0" max="12" step="1">
          </div>
          <div>
            <label for="poly-maxiter">Max iterations</label>
            <input type="number" id="poly-maxiter" value="200" min="20" step="10">
          </div>
        </div>
      </div>

      <div class="actions" style="margin-top:10px">
        <button id="btn-calc-poly" class="btn" type="button">Calculate</button>
        <button id="btn-clear-poly" class="btn ghost" type="button">Clear</button>
      </div>
    </div>
  </section>

  <!-- 4) Results -->
  <section id="results" class="card" aria-labelledby="res-title" style="margin-top:12px">
    <h2 id="res-title">Results</h2>
    <div class="kpis" id="res-kpis" aria-live="polite"></div>
    <div class="vis" style="margin-top:12px">
      <h3 style="margin:6px 0">Complex plane plot</h3>
      <canvas id="root-canvas" aria-label="Complex plane plot showing root locations"></canvas>
      <div class="hint">Real axis (horizontal), imaginary axis (vertical). Points = roots.</div>
    </div>

    <details style="margin-top:10px">
      <summary>Full numeric output</summary>
      <pre id="res-raw" class="mono" style="white-space:pre-wrap"></pre>
    </details>
  </section>

  <!-- 5) Authoritative content -->
  <section class="card" style="margin-top:12px">
    <h2>Data Source &amp; Methodology</h2>
    <p><strong>AuthoritativeDataSource:</strong> NIST Digital Library of Mathematical Functions (DLMF), Chap. 1 (Notation), Chap. 2 (Elementary Functions), and Chap. 18 (Orthogonal Polynomials) — National Institute of Standards and Technology. <a href="https://dlmf.nist.gov" rel="noopener">NIST DLMF</a>. <em>Accessed October 25, 2025.</em></p>
    <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

    <h2>The formulas explained</h2>
    <div class="formula-box">
      <p><strong>n-th roots of \(a\in\mathbb{C}\)</strong>:</p>
      <p>\[
        \sqrt[n]{a} = \{\, |a|^{1/n} \exp(i(\arg(a)+2\pi k)/n) \;|\; k=0,1,\dots,n-1 \,\}.
      \]</p>
      <p><strong>Polynomial roots</strong> for \(p(x)=a_n x^n + \dots + a_1 x + a_0\), \(a_n\neq 0\): find \(x\in\mathbb{C}\) such that \(p(x)=0\).
      We apply a simultaneous iteration (Durand–Kerner–Aberth style):
      \[
        x_k^{(m+1)} = x_k^{(m)} - \frac{p(x_k^{(m)})}{p'(x_k^{(m)}) - \sum_{j\ne k}\frac{p(x_k^{(m)})}{x_k^{(m)}-x_j^{(m)}}}.
      \]
      Convergence is monitored by \(\max_k |x_k^{(m+1)}-x_k^{(m)}|\).</p>
    </div>

    <h2>Glossary of variables</h2>
    <ul>
      <li><strong>a</strong>: number whose n-th roots are sought.</li>
      <li><strong>n</strong>: positive integer index for n-th root.</li>
      <li><strong>Coefficients</strong> \((a_n,\dots,a_0)\): polynomial coefficients from highest degree to constant.</li>
      <li><strong>Root \(x_k\)</strong>: complex solution shown as \( \Re(x_k) + i\,\Im(x_k) \) and magnitude/angle.</li>
      <li><strong>Precision</strong>: digits displayed (internal computations use higher precision).</li>
    </ul>

    <h2>How it works: a step-by-step example</h2>
    <h3>Example 1 — n-th roots</h3>
    <p>Let \(a=-8\) and \(n=3\). Then \(|a|^{1/3}=2\) and \(\arg(a)=\pi\). The roots are
      \(2\exp(i(\pi+2\pi k)/3)\) for \(k=0,1,2\): \(1+i\sqrt{3}\), \(-2\), \(1-i\sqrt{3}\) (scaled appropriately). The calculator lists these numerically and plots them.</p>
    <h3>Example 2 — polynomial roots</h3>
    <p>For \(p(x)=x^3-3x+1\), initial seeds spread on a circle iterate to three real roots near \(-1.8794\), \(0.3473\), \(1.5321\). The full vector is shown and plotted.</p>

    <h2>Frequently asked questions</h2>
    <details><summary>What degrees are supported?</summary><p>Degrees 1–20 by default. Coefficients are real; complex coefficients are out of scope for this version.</p></details>
    <details><summary>Will I always get exact radicals?</summary><p>No. Exact forms are shown only for special cases (e.g., perfect powers). Otherwise, high-precision decimals are provided.</p></details>
    <details><summary>Why do I see complex roots when my coefficients are real?</summary><p>By the Fundamental Theorem of Algebra, degree-n polynomials have n complex roots (some may be non-real). Complex conjugate pairs appear for real coefficients.</p></details>
    <details><summary>How accurate are the results?</summary><p>Residuals \( |p(x_k)| \) are reported. If any is above tolerance (e.g., 1e-9), a warning appears.</p></details>
    <details><summary>Can I copy results?</summary><p>Yes—use the “Full numeric output” block or print the page; the results section is print-optimized.</p></details>
  </section>

  <!-- 6) Authorship & review -->
  <article class="card" style="margin-top:12px">
    <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
    Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
  </article>
</main>

<footer>
  <div class="container muted" role="contentinfo">
    <p>&copy; 2025 CalcDomain. All rights reserved.</p>
    <p><a href="about.html">About</a> · <a href="contact.html">Contact</a> · <a href="privacy.html">Privacy</a> · <a href="terms.html">Terms</a></p>
  </div>
</footer>

<!-- Calculator Logic (defer loading) -->
<script defer>
(function(){
  "use strict";

  // Utility: show/hide
  function toggleHidden(el, show){
    el.hidden = !show;
    if(show && el.id && el.getAttribute('role')==='alert'){ // announce
      el.setAttribute('aria-live','assertive');
    }
  }

  // Tabs
  const tabNth = document.getElementById('tab-nth');
  const tabPoly = document.getElementById('tab-poly');
  const panelNth = document.getElementById('panel-nth');
  const panelPoly = document.getElementById('panel-poly');
  function selectTab(which){
    const nthSel = which==='nth';
    tabNth.setAttribute('aria-selected', nthSel ? 'true':'false');
    tabPoly.setAttribute('aria-selected', nthSel ? 'false':'true');
    panelNth.hidden = !nthSel;
    panelPoly.hidden = nthSel;
  }
  tabNth.addEventListener('click',()=>selectTab('nth'));
  tabPoly.addEventListener('click',()=>selectTab('poly'));

  // Accessible tooltips
  document.querySelectorAll('.help-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const id = btn.getAttribute('aria-controls');
      const tip = document.getElementById(id);
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      toggleHidden(tip, expanded ? false : true);
      if(!expanded) tip.setAttribute('role','tooltip');
    });
    btn.addEventListener('keydown',(e)=>{
      if(e.key===' '||e.key==='Enter'){ e.preventDefault(); btn.click(); }
    });
  });

  // Elements: n-th
  const nthA = document.getElementById('nth-number');
  const nthN = document.getElementById('nth-index');
  const nthPrec = document.getElementById('nth-precision');
  const errA = document.getElementById('err-a');
  const errN = document.getElementById('err-n');
  const btnCalcNth = document.getElementById('btn-calc-nth');
  const btnClearNth = document.getElementById('btn-clear-nth');

  // Elements: poly
  const inCoefs = document.getElementById('poly-coefs');
  const inPolyStr = document.getElementById('poly-str');
  const errCoefs = document.getElementById('err-coef');
  const btnParse = document.getElementById('btn-parse');
  const btnCalcPoly = document.getElementById('btn-calc-poly');
  const btnClearPoly = document.getElementById('btn-clear-poly');
  const polyPrec = document.getElementById('poly-precision');
  const polyMaxIter = document.getElementById('poly-maxiter');

  // Results
  const kpis = document.getElementById('res-kpis');
  const raw = document.getElementById('res-raw');
  const canvas = document.getElementById('root-canvas');
  const ctx = canvas.getContext('2d');

  // Validation (on blur)
  function validateNth(){
    let ok = true;
    const aVal = Number(nthA.value);
    const nVal = Number(nthN.value);
    errA.textContent = '';
    errN.textContent = '';
    toggleHidden(errA, false); toggleHidden(errN, false);
    if(!Number.isFinite(aVal)){
      errA.textContent = 'Please enter a valid number for a.'; toggleHidden(errA, true); ok=false;
    }
    if(!Number.isInteger(nVal) || nVal<1 || nVal>64){
      errN.textContent = 'Index n must be an integer between 1 and 64.'; toggleHidden(errN, true); ok=false;
    }
    return ok;
  }
  nthA.addEventListener('blur', validateNth);
  nthN.addEventListener('blur', validateNth);

  function validatePoly(){
    errCoefs.textContent = ''; toggleHidden(errCoefs,false);
    const coefs = readCoefs();
    if(!coefs || coefs.length<2){
      errCoefs.textContent = 'Enter at least two coefficients (degree ≥ 1).'; toggleHidden(errCoefs,true); return null;
    }
    if(Math.abs(coefs[0])===0){
      errCoefs.textContent = 'Leading coefficient a_n must be non-zero.'; toggleHidden(errCoefs,true); return null;
    }
    if(coefs.length>21){
      errCoefs.textContent = 'Degree too high. Max supported degree is 20.'; toggleHidden(errCoefs,true); return null;
    }
    return coefs;
  }
  inCoefs.addEventListener('blur', validatePoly);

  // Parsing helpers
  function readCoefs(){
    const s = (inCoefs.value||'').trim().replace(/[,;\s]+/g,' ').split(' ').filter(Boolean);
    if(!s.length) return null;
    const arr = s.map(Number);
    if(arr.some(v=>!Number.isFinite(v))) return null;
    return arr;
  }
  // very small parser for expressions like "2x^4 - 3x + 1"
  function parsePolynomialString(str){
    if(!str) return null;
    const cleaned = str.replace(/\s+/g,'').replace(/−/g,'-').replace(/·/g,'*');
    // Accept terms like ax^k, ax, x^k, x, or constants
    const termRe = /([+\-]?)(?:(\d+(?:\.\d+)?)\*?)?(x(?:\^(\d+))?)?/ig;
    const terms = [];
    let m;
    while((m=termRe.exec(cleaned))!==null){
      if(m[0]==='') continue;
      const sign = (m[1]==='-')?-1:1;
      const coef = m[2]!==undefined? Number(m[2]): (m[3]?1:0);
      const hasX = !!m[3];
      const pow = hasX ? (m[4]? Number(m[4]):1) : 0;
      if(!Number.isFinite(coef) || !Number.isFinite(pow)) return null;
      terms.push({coef: sign*coef, pow});
    }
    if(!terms.length) return null;
    const deg = Math.max(...terms.map(t=>t.pow));
    const coefs = new Array(deg+1).fill(0);
    for(const t of terms){ coefs[deg - t.pow] += t.coef; }
    // remove leading zeros if any
    while(coefs.length>1 && Math.abs(coefs[0])===0){ coefs.shift(); }
    return coefs;
  }

  btnParse.addEventListener('click', ()=>{
    const coefs = parsePolynomialString(inPolyStr.value);
    if(!coefs){ errCoefs.textContent='Could not parse the polynomial. Use variable x and ^ for powers.'; toggleHidden(errCoefs,true); return; }
    inCoefs.value = coefs.join(', ');
    validatePoly();
    inCoefs.focus();
  });

  // Complex number helpers
  function c(re,im){ return {re,im}; }
  function cadd(a,b){ return c(a.re+b.re, a.im+b.im); }
  function csub(a,b){ return c(a.re-b.re, a.im-b.im); }
  function cmul(a,b){ return c(a.re*b.re - a.im*b.im, a.re*b.im + a.im*b.re); }
  function cdiv(a,b){ const d=b.re*b.re+b.im*b.im; return c((a.re*b.re+a.im*b.im)/d, (a.im*b.re-a.re*b.im)/d); }
  function cabs(a){ return Math.hypot(a.re,a.im); }
  function cexp(iang){ return c(Math.cos(iang), Math.sin(iang)); }
  function cpow(a, n){ // integer n>=0
    let r=c(1,0); let base=a; let e=n;
    while(e>0){ if(e&1) r=cmul(r,base); base=cmul(base,base); e>>=1; }
    return r;
  }

  // n-th roots
  function nthRoots(a, n){
    // a: real number -> treat as complex a+0i
    const re = Number(a), im = 0;
    const r = Math.hypot(re, im);
    const theta = Math.atan2(im, re); // principal arg
    const mag = Math.pow(r, 1/n);
    const roots = [];
    for(let k=0;k<n;k++){
      const ang = (theta + 2*Math.PI*k)/n;
      roots.push(c(mag*Math.cos(ang), mag*Math.sin(ang)));
    }
    return roots;
  }

  // Polynomial evaluation (real input to complex)
  function peval(coefs, z){ // coefs: [a_n,...,a_0]
    let acc = c(0,0);
    for(let i=0;i<coefs.length;i++){
      acc = cadd(cmul(acc,z), c(coefs[i],0));
    }
    return acc;
  }
  function pderivative(coefs){
    const n = coefs.length-1; if(n<=0) return [0];
    const d = new Array(n).fill(0);
    for(let i=0;i<n;i++){
      d[i] = coefs[i]*(n-i);
    }
    return d;
  }

  // Initial guesses: equally spaced on circle using Cauchy bound
  function cauchyRadius(coefs){
    const an = Math.abs(coefs[0]);
    const rest = coefs.slice(1).map(Math.abs);
    const max = Math.max(...rest, 0);
    return 1 + (max/(an||1));
  }

  // Aberth–Ehrlich step with safeguard (Durand–Kerner fallback)
  function rootsAberth(coefs, maxIter=200, tol=1e-12){
    const n = coefs.length-1;
    if(n===1){
      // a1 x + a0 = 0
      return [ c(-coefs[1]/coefs[0], 0) ];
    }
    const deriv = pderivative(coefs);
    const R = cauchyRadius(coefs);
    let z = [];
    for(let k=0;k<n;k++){
      const ang = 2*Math.PI*k/n;
      z.push(c(R*Math.cos(ang), R*Math.sin(ang)));
    }
    const tmp = new Array(n);
    let converged = false;

    for(let it=0; it<maxIter; it++){
      let maxStep = 0;

      for(let k=0;k<n;k++){
        const zk = z[k];
        const pz = peval(coefs, zk);
        const dp = peval(deriv, zk);

        // Compute Aberth correction
        let denom = dp;
        // subtract sum p(z)/(z - zj)
        let sum = c(0,0);
        for(let j=0;j<n;j++){
          if(j===k) continue;
          sum = cadd(sum, cdiv(c(1,0), csub(zk, z[j])));
        }
        denom = csub(denom, cmul(pz, sum));
        let delta;
        const denomAbs = cabs(denom);
        if(denomAbs<1e-18){
          // fallback to Durand–Kerner step: product over j!=k (zk - zj)
          let prod = c(1,0);
          for(let j=0;j<n;j++){ if(j!==k) prod = cmul(prod, csub(zk, z[j])); }
          if(cabs(prod)<1e-18){ // jitter
            z[k] = c(zk.re + (Math.random()-0.5)*1e-6, zk.im + (Math.random()-0.5)*1e-6);
            continue;
          }
          delta = cdiv(pz, prod); // DK
        }else{
          delta = cdiv(pz, denom); // Aberth
        }
        tmp[k] = csub(zk, delta);
        maxStep = Math.max(maxStep, cabs(delta));
      }
      z = tmp.slice();
      if(maxStep < tol){ converged = true; break; }
    }
    return z; // return even if not fully converged; caller checks residuals
  }

  // Drawing
  function drawRoots(points){
    const W = canvas.clientWidth, H = canvas.clientHeight;
    canvas.width = Math.max(320, W); canvas.height = Math.max(200, H);
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(!points || !points.length){
      // axes only
      ctx.strokeStyle = '#94a3b8';
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(0, canvas.height/2); ctx.lineTo(canvas.width, canvas.height/2); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height); ctx.stroke();
      return;
    }

    const xs = points.map(p=>p.re), ys = points.map(p=>p.im);
    const minX = Math.min(...xs, -1), maxX = Math.max(...xs, 1);
    const minY = Math.min(...ys, -1), maxY = Math.max(...ys, 1);
    const pad = 0.2;
    const rangeX = (maxX-minX)||2, rangeY = (maxY-minY)||2;
    const sx = canvas.width/(rangeX*(1+pad)), sy = canvas.height/(rangeY*(1+pad));
    const scale = Math.min(sx, sy);
    const cx = (minX+maxX)/2, cy = (minY+maxY)/2;

    function toPix(pt){
      return {
        x: canvas.width/2 + (pt.re - cx)*scale,
        y: canvas.height/2 - (pt.im - cy)*scale
      };
    }

    // axes
    ctx.strokeStyle = '#94a3b8';
    ctx.lineWidth = 1;
    const origin = toPix(c(0,0));
    ctx.beginPath(); ctx.moveTo(0, origin.y); ctx.lineTo(canvas.width, origin.y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(origin.x, 0); ctx.lineTo(origin.x, canvas.height); ctx.stroke();

    // points
    ctx.fillStyle = '#1d4ed8';
    for(const p of points){
      const P = toPix(p);
      ctx.beginPath(); ctx.arc(P.x, P.y, 4, 0, Math.PI*2); ctx.fill();
    }
  }

  // KPI rendering
  function setKpis(items){
    kpis.innerHTML = '';
    items.forEach(it=>{
      const div = document.createElement('div');
      div.className = 'kpi';
      div.innerHTML = `<h4>${it.label}</h4><p>${it.value}</p>`;
      kpis.appendChild(div);
    });
  }

  // Format helpers
  function fmtNum(x, d){
    if(!Number.isFinite(x)) return String(x);
    return x.toLocaleString(undefined,{maximumFractionDigits:d, minimumFractionDigits:Math.min(d,6)});
  }
  function fmtComplex(z, d){
    const re = fmtNum(z.re, d), im = fmtNum(Math.abs(z.im), d);
    if(Math.abs(z.im)<1e-14) return `${re}`;
    const sign = z.im>=0 ? '+' : '−';
    return `${re} ${sign} ${im}i`;
  }

  // Actions: n-th root
  function calcNth(){
    if(!validateNth()) return;
    const a = Number(nthA.value);
    const n = Math.max(1, Math.min(64, Math.floor(Number(nthN.value))));
    const d = Math.max(0, Math.min(12, Math.floor(Number(nthPrec.value)||6)));
    const roots = nthRoots(a, n);
    const principal = roots[0];
    setKpis([
      {label:'Principal root', value: fmtComplex(principal, d)},
      {label:'Number of roots', value: String(roots.length)},
      {label:'Magnitude |a|^(1/n)', value: fmtNum(Math.pow(Math.abs(a), 1/n), d)}
    ]);
    drawRoots(roots);
    // raw block
    const rawLines = roots.map((r,i)=>`k=${i}: ${fmtComplex(r,d)}`);
    raw.textContent = `n-th roots of a=${a} (n=${n})\n`+rawLines.join('\n');
  }
  btnCalcNth.addEventListener('click', calcNth);
  btnClearNth.addEventListener('click', ()=>{
    nthA.value=''; nthN.value=''; raw.textContent=''; setKpis([]); drawRoots([]);
  });

  // Actions: polynomial
  function calcPoly(){
    const coefs = validatePoly(); if(!coefs) return;
    const d = Math.max(0, Math.min(12, Math.floor(Number(polyPrec.value)||6)));
    const iters = Math.max(20, Math.floor(Number(polyMaxIter.value)||200));
    const roots = rootsAberth(coefs, iters, 1e-12);
    // residuals
    const res = roots.map(r=>cabs(peval(coefs, r)));
    const maxRes = Math.max(...res);
    const deg = coefs.length-1;
    setKpis([
      {label:'Degree', value: String(deg)},
      {label:'Roots found', value: String(roots.length)},
      {label:'Max residual |p(x)|', value: fmtNum(maxRes, d)}
    ]);
    drawRoots(roots);
    const lines = roots.map((r,i)=>`x${i+1} = ${fmtComplex(r,d)}   |p(x)|=${fmtNum(res[i], d+2)}`);
    raw.textContent = `Polynomial: p(x) = ${coefs.map((a,i)=>{
      const pow = coefs.length-1-i;
      const sign = a<0?' − ':' + ';
      const mag = Math.abs(a);
      const term = pow===0? mag : (pow===1? `${mag}x` : `${mag}x^${pow}`);
      return (i===0?(a<0?'- ':''):sign)+term;
    }).join('')}\n\nRoots:\n` + lines.join('\n');

    if(maxRes>1e-6){
      const warn = document.createElement('div');
      warn.className = 'hint';
      warn.style.color = '#b45309';
      warn.textContent = 'Warning: Some residuals exceed tolerance; consider rescaling coefficients or increasing iterations.';
      kpis.parentElement.insertBefore(warn, kpis.nextSibling);
      setTimeout(()=>warn.remove(), 6000);
    }
  }
  btnCalcPoly.addEventListener('click', calcPoly);
  btnClearPoly.addEventListener('click', ()=>{
    inCoefs.value=''; inPolyStr.value=''; raw.textContent=''; setKpis([]); drawRoots([]);
  });

  // Defaults
  drawRoots([]);

  // Keyboard support for tabs
  [tabNth, tabPoly].forEach(tb=>{
    tb.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowRight' || e.key==='ArrowLeft'){
        e.preventDefault();
        (tb===tabNth?tabPoly:tabNth).focus();
        (tb===tabNth?tabPoly:tabNth).click();
      }
    });
  });

})();
</script>
</body>
</html>
