<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mode Calculator — Find Mode, Multimodal Sets & Modal Class</title>
  <meta name="description" content="Professional mode calculator for numbers and categories. Supports multimodal sets, frequency/weighted data, and grouped data with modal class interpolation. Includes chart, glossary, step-by-step example, and FAQs." />
  <link rel="canonical" href="https://calcdomain.com/mode-calculator.html" />
  <meta name="theme-color" content="#0b57d0"/>

  <!-- Favicons (safe fallbacks if not present) -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com" defer></script>
  <!-- Chart.js (for frequency bars) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <!-- MathJax for LaTeX formulas -->
  <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    integrity="sha384-5F0l8W7nK8s8+3w3t1sM7J7M2VvL4u9rXc4gk+5lR6cUoKjzXgS+4rO9M3x9m3uV" crossorigin="anonymous"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --brand:#0b57d0;
      --ink:#111827;
      --muted:#6b7280;
      --surface:#ffffff;
      --bg:#f8fafc;
      --border:#e5e7eb;
      --focus:#16a34a;
      --danger:#b91c1c;
    }
    html,body{height:100%}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    .container{max-width:1100px}
    .prose{max-width:68ch}
    .prose h2{font-size:1.5rem;font-weight:700;margin-top:2rem;margin-bottom:.75rem}
    .prose h3{font-size:1.2rem;font-weight:600;margin-top:1.25rem;margin-bottom:.5rem}
    .prose p{line-height:1.7;margin:.75rem 0}
    .formula-box{background:#f3f4f6;border:1px solid #d1d5db;border-radius:10px;padding:1rem;overflow:auto}
    .result-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1rem;text-align:center}
    .result-card h4{font-size:.95rem;color:var(--muted);margin-bottom:.25rem}
    .result-card p{font-size:1.4rem;font-weight:800;color:var(--brand)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;border-radius:12px;border:1px solid var(--border);padding:.75rem 1rem;background:var(--surface)}
    .btn-primary{background:var(--brand);color:#fff;border-color:transparent}
    .btn:focus-visible, .focusable:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible, button:focus-visible { outline:3px solid var(--focus); outline-offset:2px }
    .help{font-size:.875rem;color:var(--muted)}
    .error{font-size:.875rem;color:#fff;background:var(--danger);padding:.5rem .75rem;border-radius:.5rem;margin-top:.5rem}
    .tooltip-panel{display:none;margin-top:.5rem;font-size:.9rem;color:var(--ink);background:#eef2ff;border:1px solid #c7d2fe;border-radius:.5rem;padding:.5rem .75rem}
    .tooltip-panel[aria-hidden="false"]{display:block}
    .kbd{font-family:ui-monospace, Menlo, Consolas, monospace;background:#eef2ff;border:1px solid #c7d2fe;border-bottom-width:3px;border-radius:6px;padding:.15rem .4rem}
    /* Prevent CLS in results/card/chart blocks */
    #results-region{min-height:320px}
    #chart-wrap{min-height:220px}
    /* Ensure 48px tap targets */
    .btn, button, select, input, textarea { min-height:48px }
    /* Table */
    table{border-collapse:separate;border-spacing:0;width:100%}
    th,td{border-bottom:1px solid var(--border);padding:.6rem .75rem}
    thead th{background:#f3f4f6;color:#374151;text-transform:uppercase;font-size:.8rem;letter-spacing:.02em}
    /* Breadcrumbs */
    nav[aria-label="Breadcrumb"] a{color:#374151}
    nav[aria-label="Breadcrumb"] a:hover{color:var(--brand)}
    /* Print */
    @media print {
      body *{visibility:hidden}
      #print-section, #print-section *{visibility:visible}
      #print-section{position:absolute;inset:0;padding:0}
      #chart-wrap{display:none !important}
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Mode Calculator",
    "url":"https://calcdomain.com/mode-calculator.html",
    "description":"Compute the mode for numbers or categories, including multimodal sets, frequency/weighted data, and grouped data (modal class).",
    "inLanguage":"en",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>

  <!-- JSON-LD: WebApplication (calculator) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Mode Calculator",
    "applicationCategory":"Education",
    "operatingSystem":"Any",
    "url":"https://calcdomain.com/mode-calculator.html",
    "creator":{"@type":"Person","name":"Ugo Candido"}
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Algebra","item":"https://calcdomain.com/subcategories/math-algebra.html"},
      {"@type":"ListItem","position":4,"name":"Mode Calculator","item":"https://calcdomain.com/mode-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to compute the mode of a dataset",
    "step":[
      {"@type":"HowToStep","name":"Enter data","text":"Paste a list (comma, space, or newline separated) or build a frequency table."},
      {"@type":"HowToStep","name":"Choose data type","text":"Numbers or categories/strings. Toggle grouped mode for binned data."},
      {"@type":"HowToStep","name":"Calculate","text":"The calculator computes all modes, the frequency table, and optional modal class."},
      {"@type":"HowToStep","name":"Export/Print","text":"Download the table as CSV or print a clean summary."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json" id="faq-jsonld">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the mode?","acceptedAnswer":{"@type":"Answer","text":"The mode is the most frequent value in a dataset. A dataset may be unimodal, bimodal, multimodal, or have no mode."}},
      {"@type":"Question","name":"Can I enter categories like red, blue?","acceptedAnswer":{"@type":"Answer","text":"Yes. Set Data Type to 'Categorical' and paste labels. The tool counts identical strings case-insensitively if you enable normalization."}},
      {"@type":"Question","name":"How are ties handled?","acceptedAnswer":{"@type":"Answer","text":"All values that share the highest frequency are reported as modes."}},
      {"@type":"Question","name":"What is a modal class for grouped data?","acceptedAnswer":{"@type":"Answer","text":"For data grouped into classes, the modal class is the class interval with the highest frequency. An interpolated mode can be estimated with L + ((f1 - f0) / (2f1 - f0 - f2)) × h."}},
      {"@type":"Question","name":"Does the calculator ignore blanks and text in numeric mode?","acceptedAnswer":{"@type":"Answer","text":"Yes, you can choose to ignore blanks and non-numeric tokens or flag them as data quality errors with inline messages."}},
      {"@type":"Question","name":"Can I import a frequency/weighted list?","acceptedAnswer":{"@type":"Answer","text":"Yes. Use the Frequency tab to input value–frequency pairs; weights are treated as frequencies."}},
      {"@type":"Question","name":"How do rounding and normalization work?","acceptedAnswer":{"@type":"Answer","text":"You can set a rounding precision for numeric values and enable trimming/lowercasing for categorical labels to consolidate near-duplicates."}}
    ]
  }
  </script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per requirements) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-600">CalcDomain</a>
      <a class="text-sm text-gray-700 hover:text-blue-600 focusable" href="search.html">Advanced Search</a>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3" id="print-section" aria-labelledby="page-title">
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="math.html" class="hover:text-blue-600">Math</a> &raquo;
          <a href="subcategories/math-algebra.html" class="hover:text-blue-600">Algebra</a> &raquo;
          <span class="text-gray-900">Mode Calculator</span>
        </nav>

        <!-- 1. H1 -->
        <h1 id="page-title" class="text-3xl font-extrabold text-gray-900 mb-2">mode calculator</h1>

        <!-- 2. Intro -->
        <p class="text-gray-700 mb-6">
          Compute the <strong>mode</strong> for numbers or categories, including multimodal results, frequency/weighted inputs, and grouped data (modal class). Built for analysts, engineers, and students who need reliable, auditable outputs with clear methods and exportable tables.
        </p>

        <!-- 3. Calculator UI -->
        <section class="bg-white p-6 rounded-lg shadow-sm border" aria-labelledby="calc-head">
          <h2 id="calc-head" class="sr-only">Mode calculator inputs</h2>
          <!-- Tabs -->
          <div role="tablist" aria-label="Input mode" class="flex flex-wrap gap-2 mb-4">
            <button class="btn btn-primary" role="tab" aria-selected="true" aria-controls="tab-list" id="tabbtn-list">List</button>
            <button class="btn" role="tab" aria-selected="false" aria-controls="tab-freq" id="tabbtn-freq">Frequency / Weights</button>
            <button class="btn" role="tab" aria-selected="false" aria-controls="tab-grouped" id="tabbtn-grouped">Grouped (Modal Class)</button>
          </div>

          <!-- Global options -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
              <label for="dataType" class="block text-sm font-medium text-gray-800">Data Type *</label>
              <div class="flex items-center gap-2">
                <select id="dataType" aria-required="true" class="w-full border rounded-md px-3">
                  <option value="numeric" selected>Numeric</option>
                  <option value="categorical">Categorical (strings)</option>
                </select>
                <button type="button" class="btn focusable" id="tip-dataType" aria-expanded="false" aria-controls="tip-panel-dataType" aria-label="More info about Data Type">?</button>
              </div>
              <p id="tip-panel-dataType" class="tooltip-panel" aria-hidden="true">
                <strong>Numeric</strong> parses numbers (with optional rounding). <strong>Categorical</strong> treats tokens as labels; enable normalization to trim & lowercase.
              </p>
              <p id="err-dataType" class="error hidden" role="alert"></p>
            </div>

            <div>
              <label for="rounding" class="block text-sm font-medium text-gray-800">Rounding (decimals)</label>
              <input id="rounding" type="number" inputmode="numeric" min="0" step="1" value="2" class="w-full border rounded-md px-3" aria-describedby="help-rounding">
              <p class="help" id="help-rounding">Applies to numeric parsing before tallying frequencies.</p>
              <p id="err-rounding" class="error hidden" role="alert"></p>
            </div>

            <div class="flex items-center gap-3">
              <div class="flex items-center gap-2">
                <input id="normalize" type="checkbox" class="w-5 h-5" aria-describedby="help-normalize">
                <label for="normalize" class="text-sm font-medium text-gray-800">Normalize labels</label>
              </div>
              <div class="flex items-center gap-2">
                <input id="ignoreNonNumeric" type="checkbox" class="w-5 h-5">
                <label for="ignoreNonNumeric" class="text-sm font-medium text-gray-800">Ignore non-numeric</label>
              </div>
            </div>
          </div>

          <!-- Tab Panels -->
          <div id="tab-list" role="tabpanel" aria-labelledby="tabbtn-list">
            <label for="rawInput" class="block text-sm font-medium text-gray-800">Paste values (comma/space/newline) *</label>
            <textarea id="rawInput" class="w-full border rounded-md px-3 py-3" rows="5" placeholder="e.g. 2, 3, 3, 5, 8, 8, 8, 10" aria-required="true" aria-describedby="help-raw err-raw"></textarea>
            <p class="help" id="help-raw">Tip: press <span class="kbd">Enter</span> to add new lines; strings allowed in categorical mode.</p>
            <p id="err-raw" class="error hidden" role="alert"></p>
          </div>

          <div id="tab-freq" class="hidden" role="tabpanel" aria-labelledby="tabbtn-freq" tabindex="-1">
            <div class="flex items-center justify-between mb-2">
              <label class="block text-sm font-medium text-gray-800">Value–Frequency table *</label>
              <div class="flex gap-2">
                <button type="button" id="addFreqRow" class="btn">+ Row</button>
                <button type="button" id="clearFreq" class="btn">Clear</button>
              </div>
            </div>
            <div class="overflow-auto border rounded-md">
              <table aria-describedby="help-freq" class="min-w-full">
                <thead>
                  <tr>
                    <th class="text-left">Value</th>
                    <th class="text-left">Frequency / Weight</th>
                    <th class="text-left">Actions</th>
                  </tr>
                </thead>
                <tbody id="freqBody"></tbody>
              </table>
            </div>
            <p class="help" id="help-freq">Weights are treated as frequencies. Use integers for classic frequency tables.</p>
            <p id="err-freq" class="error hidden" role="alert"></p>
          </div>

          <div id="tab-grouped" class="hidden" role="tabpanel" aria-labelledby="tabbtn-grouped" tabindex="-1">
            <div class="flex items-center justify-between mb-2">
              <label class="block text-sm font-medium text-gray-800">Grouped classes (continuous intervals) *</label>
              <div class="flex gap-2">
                <button type="button" id="addGrpRow" class="btn">+ Class</button>
                <button type="button" id="clearGrp" class="btn">Clear</button>
              </div>
            </div>
            <div class="overflow-auto border rounded-md">
              <table aria-describedby="help-grouped" class="min-w-full">
                <thead>
                  <tr>
                    <th class="text-left">Lower (L)</th>
                    <th class="text-left">Upper (U)</th>
                    <th class="text-left">Frequency (f)</th>
                    <th class="text-left">Actions</th>
                  </tr>
                </thead>
                <tbody id="grpBody"></tbody>
              </table>
            </div>
            <p class="help" id="help-grouped">We estimate the mode using \\( \\hat{m} = L + \\frac{f_1 - f_0}{2f_1 - f_0 - f_2} \\times h \\), where <em>h = U - L</em>.</p>
            <p id="err-grp" class="error hidden" role="alert"></p>
          </div>

          <!-- Actions -->
          <div class="mt-6 flex flex-wrap gap-3">
            <button type="button" id="btnCalc" class="btn btn-primary">Calculate Mode</button>
            <button type="button" id="btnReset" class="btn">Reset</button>
            <button type="button" id="btnExport" class="btn">Download CSV</button>
            <button type="button" id="btnPrint" class="btn">Print</button>
          </div>
        </section>

        <!-- 4. Results -->
        <section id="results-region" class="mt-6 bg-blue-50 border border-blue-100 rounded-lg p-6">
          <h2 class="text-xl font-bold mb-3">Results</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="result-card"><h4>Mode</h4><p id="resMode">—</p></div>
            <div class="result-card"><h4>Multiplicity</h4><p id="resMultiplicity">—</p></div>
            <div class="result-card"><h4>Ties</h4><p id="resTies">—</p></div>
            <div class="result-card"><h4>Data Count</h4><p id="resCount">0</p></div>
          </div>

          <details class="mt-4 bg-white border rounded-lg p-4">
            <summary class="font-semibold">Frequency table</summary>
            <div class="overflow-auto mt-3">
              <table id="freqTable" class="min-w-full">
                <thead><tr><th class="text-left">Value / Class</th><th class="text-left">Frequency</th></tr></thead>
                <tbody id="freqRows"></tbody>
              </table>
            </div>
          </details>

          <div id="chart-wrap" class="mt-6 h-56">
            <canvas id="freqChart" aria-label="Frequency bar chart"></canvas>
          </div>
        </section>

        <!-- 5. Authoritative Content Ecosystem -->
        <section class="prose mt-10">
          <!-- a. Data Source & Method -->
          <h2>Authoritative data source & methodology</h2>
          <p>
            Primary reference: <a class="text-blue-600 underline" href="https://www.itl.nist.gov/div898/handbook/" rel="nofollow">NIST/SEMATECH e-Handbook of Statistical Methods</a> (accessed 2025) and
            ISO 3534-1:2006 “Statistics — Vocabulary and symbols”. <br/>
            <em>“Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.”</em>
          </p>

          <!-- b. Formula explained -->
          <h2>The formula, explained</h2>
          <div class="formula-box">
            <p><strong>Ungrouped data (discrete):</strong> The mode is the value(s) with maximum frequency.</p>
            <p>\\[
              \\text{Mode}(X) = \\{ x_i : f(x_i) = \\max_j f(x_j) \\}
            \\]</p>
            <p><strong>Grouped data (modal class interpolation):</strong></p>
            <p>\\[
              \\hat{m} = L + \\frac{f_1 - f_0}{2f_1 - f_0 - f_2}\\,h
            \\]</p>
            <p class="help">where \\(L\\) is the lower boundary of the modal class, \\(h\\) is class width, \\(f_1\\) is the modal class frequency, and \\(f_0, f_2\\) are frequencies of the previous and next classes.</p>
          </div>

          <!-- c. Glossary -->
          <h2>Glossary of variables</h2>
          <table>
            <thead><tr><th class="text-left">Symbol / Field</th><th class="text-left">Meaning</th></tr></thead>
            <tbody>
              <tr><td>Mode</td><td>Most frequent value(s).</td></tr>
              <tr><td>Multiplicity</td><td>Number of distinct modes returned.</td></tr>
              <tr><td>Data Type</td><td>Numeric or categorical parsing behavior.</td></tr>
              <tr><td>Frequency</td><td>Count or weight associated with a value/class.</td></tr>
              <tr><td>\\(L, h, f_0, f_1, f_2\\)</td><td>Grouped-data interpolation parameters.</td></tr>
            </tbody>
          </table>

          <!-- d. Worked example -->
          <h2>How it works: a step-by-step example</h2>
          <h3>Example dataset</h3>
          <p>Raw list: <code>7, 8, 8, 9, 10, 10, 10, 12, 12</code></p>
          <ol>
            <li>Parse values (numeric). Count frequencies.</li>
            <li>Frequencies: 7→1, 8→2, 9→1, 10→3, 12→2.</li>
            <li>Maximum frequency is 3 at value 10.</li>
          </ol>
          <p><strong>Result:</strong> Mode = 10, Multiplicity = 1, Ties = No, Count = 9.</p>

          <!-- e. FAQ -->
          <h2>Frequently asked questions</h2>
          <details><summary>What happens if all values are unique?</summary><p>The dataset has no mode; the tool reports “No mode”.</p></details>
          <details><summary>How are strings compared?</summary><p>When normalization is on, labels are trimmed and lowercased, so “Blue” and “ blue ” tally together.</p></details>
          <details><summary>Can I paste mixed content?</summary><p>Yes. In numeric mode you may ignore non-numeric tokens or flag them as errors; in categorical mode everything is treated as a label.</p></details>
          <details><summary>Is the grouped interpolation exact?</summary><p>It’s an estimate assuming uniform distribution within the class; it is standard in descriptive statistics for binned data.</p></details>
          <details><summary>Can I export and print?</summary><p>Yes—use “Download CSV” or “Print” for a clean summary.</p></details>
        </section>

        <!-- 6. Authorship & Review -->
        <article class="mt-8 bg-white p-6 rounded-lg border">
          <p><strong>Tool developed by Ugo Candido.</strong> Content reviewed by the CalcDomain Editorial Board.</p>
          <p>Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
        </article>
      </section>

      <!-- Aside -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-6 space-y-6">
          <div class="bg-white p-6 rounded-lg border shadow-sm">
            <h3 class="font-bold text-lg mb-2">Why this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
              <li>Handles numeric & categorical data, ties, and “no mode”.</li>
              <li>Supports frequency/weights and grouped modal class.</li>
              <li>Inline validation and accessible tooltips.</li>
            </ul>
          </div>
          <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-600">Ad Placement (300×600)</div>
          <div class="bg-white p-6 rounded-lg border shadow-sm">
            <h3 class="font-bold text-lg mb-3">Related math tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-600 hover:underline" href="mean-calculator.html">Mean Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="median-calculator.html">Median Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="range-calculator.html">Range Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="standard-deviation.html">Standard Deviation</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic -->
  <script defer>
    // Utility helpers
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const show = (el) => el.classList.remove('hidden');
    const hide = (el) => el.classList.add('hidden');

    const state = {
      activeTab: 'list',
      chart: null
    };

    // Accessible tab switching
    function setTab(tab){
      state.activeTab = tab;
      const tabs = [
        {btn:'#tabbtn-list', panel:'#tab-list'},
        {btn:'#tabbtn-freq', panel:'#tab-freq'},
        {btn:'#tabbtn-grouped', panel:'#tab-grouped'}
      ];
      tabs.forEach(({btn,panel})=>{
        const b=$(btn), p=$(panel);
        if (panel.endsWith(tab)) {
          b.classList.add('btn-primary'); b.setAttribute('aria-selected','true');
          p.classList.remove('hidden'); p.removeAttribute('tabindex');
        } else {
          b.classList.remove('btn-primary'); b.setAttribute('aria-selected','false');
          p.classList.add('hidden'); p.setAttribute('tabindex','-1');
        }
      });
    }

    // Tooltip toggles
    function bindTooltip(buttonId, panelId){
      const btn = document.getElementById(buttonId);
      const panel = document.getElementById(panelId);
      btn?.addEventListener('click', ()=>{
        const open = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!open));
        panel.setAttribute('aria-hidden', String(open));
      });
    }

    // Validation helpers
    function setError(id, msg){
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = msg || '';
      if (msg) el.classList.remove('hidden'); else el.classList.add('hidden');
    }

    // Frequency & grouped dynamic rows
    function addFreqRow(value='', freq=''){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" class="w-full border rounded-md px-3" value="${value}"></td>
        <td><input type="number" class="w-full border rounded-md px-3" inputmode="numeric" min="0" step="1" value="${freq}"></td>
        <td><button type="button" class="btn remove-row">Remove</button></td>
      `;
      document.getElementById('freqBody').appendChild(tr);
    }
    function addGrpRow(L='', U='', f=''){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="number" class="w-full border rounded-md px-3" step="any" value="${L}"></td>
        <td><input type="number" class="w-full border rounded-md px-3" step="any" value="${U}"></td>
        <td><input type="number" class="w-full border rounded-md px-3" inputmode="numeric" min="0" step="1" value="${f}"></td>
        <td><button type="button" class="btn remove-row">Remove</button></td>
      `;
      document.getElementById('grpBody').appendChild(tr);
    }

    // Parse inputs
    function normalizeLabel(s){
      return s.trim().toLowerCase();
    }
    function parseNumeric(token, rounding){
      const n = Number(token);
      if (Number.isFinite(n)){
        const p = Math.max(0, Math.floor(rounding ?? 0));
        return Number(n.toFixed(p));
      }
      return NaN;
    }

    // Build frequency map from list
    function buildFromList(){
      const mode = document.getElementById('dataType').value;
      const rounding = Number(document.getElementById('rounding').value||0);
      const ignoreNN = document.getElementById('ignoreNonNumeric').checked;
      const normalize = document.getElementById('normalize').checked;
      const raw = document.getElementById('rawInput').value || '';
      const tokens = raw.split(/[\s,;]+/).filter(s => s.length>0);

      const map = new Map();
      let invalidCount = 0;

      for (const t0 of tokens){
        if (mode === 'numeric'){
          const n = parseNumeric(t0, rounding);
          if (Number.isFinite(n)){
            map.set(n, (map.get(n)||0)+1);
          } else {
            if (!ignoreNN) invalidCount++;
          }
        } else {
          const key = normalize ? normalizeLabel(t0) : t0.trim();
          if (key.length>0) map.set(key, (map.get(key)||0)+1);
        }
      }
      return {map, count: [...map.values()].reduce((a,b)=>a+b,0), invalidCount};
    }

    // Build from frequency table
    function buildFromFreq(){
      const mode = document.getElementById('dataType').value;
      const rounding = Number(document.getElementById('rounding').value||0);
      const normalize = document.getElementById('normalize').checked;
      const rows = Array.from(document.querySelectorAll('#freqBody tr'));
      const map = new Map();
      let errors = 0;

      for (const r of rows){
        const [vEl,fEl] = r.querySelectorAll('input');
        const v = vEl.value;
        const f = Number(fEl.value);
        if (!Number.isFinite(f) || f < 0) { errors++; continue; }

        if (mode === 'numeric'){
          const n = parseNumeric(v, rounding);
          if (Number.isFinite(n)) map.set(n, (map.get(n)||0)+f);
          else errors++;
        } else {
          const key = normalize ? normalizeLabel(v) : v.trim();
          if (key) map.set(key, (map.get(key)||0)+f); else errors++;
        }
      }
      return {map, count: [...map.values()].reduce((a,b)=>a+b,0), errors};
    }

    // Grouped modal class interpolation
    function computeGrouped(){
      const rows = Array.from(document.querySelectorAll('#grpBody tr')).map(r => {
        const [L,U,f] = r.querySelectorAll('input');
        return {L:Number(L.value), U:Number(U.value), f:Number(f.value)};
      });
      // basic validation
      if (rows.length===0) return {error:'Add at least one class row.'};
      for (const r of rows){
        if (!Number.isFinite(r.L) || !Number.isFinite(r.U) || !Number.isFinite(r.f) || r.U<=r.L || r.f<0){
          return {error:'Each class must have valid numbers with U > L and non-negative frequency.'};
        }
      }
      // find modal class index k (max f)
      const k = rows.reduce((best,i,idx,arr)=> i.f>arr[best].f?idx:best, 0);
      const L = rows[k].L, U = rows[k].U, f1 = rows[k].f;
      const h = U - L;
      const f0 = (rows[k-1]?.f ?? 0);
      const f2 = (rows[k+1]?.f ?? 0);
      const denom = (2*f1 - f0 - f2);
      if (denom === 0) return {modalClass: [L,U], modeEst: (L+U)/2, note:'Flat top around modal class (denominator 0); returned class midpoint.'};
      const modeEst = L + ((f1 - f0) / denom) * h;
      return {modalClass:[L,U], modeEst, note:null, table: rows};
    }

    // Compute modes from a frequency map
    function computeModes(map){
      const entries = Array.from(map.entries());
      entries.sort((a,b)=>{
        // numeric sort if both numeric
        const an = typeof a[0] === 'number', bn = typeof b[0] === 'number';
        if (an && bn) return (a[0]-b[0]);
        return String(a[0]).localeCompare(String(b[0]));
      });
      const maxF = entries.reduce((m,[,f])=>Math.max(m,f), 0);
      const modes = maxF>0 ? entries.filter(([,f])=>f===maxF).map(([v])=>v) : [];
      return {entries, maxF, modes};
    }

    // Render frequency table & chart
    function renderFreq(entries){
      const tbody = document.getElementById('freqRows');
      tbody.innerHTML = '';
      for (const [v,f] of entries){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${v}</td><td>${f}</td>`;
        tbody.appendChild(tr);
      }

      // Chart
      const ctx = document.getElementById('freqChart');
      const labels = entries.slice(0,50).map(([v])=>String(v)); // cap to 50 labels for readability
      const datas = entries.slice(0,50).map(([,f])=>f);
      const data = {
        labels,
        datasets:[{label:'Frequency', data:datas}]
      };
      if (state.chart){
        state.chart.data = data;
        state.chart.update();
      } else if (ctx){
        state.chart = new Chart(ctx, {
          type:'bar',
          data,
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{legend:{display:false}},
            scales:{x:{ticks:{autoSkip:true,maxRotation:0}}}
          }
        });
      }
    }

    // Update result cards
    function updateCards({modes, maxF, totalCount}){
      const modeText = modes.length===0 ? 'No mode' : modes.join(', ');
      document.getElementById('resMode').textContent = modeText;
      document.getElementById('resMultiplicity').textContent = modes.length===0 ? '0' : String(modes.length);
      document.getElementById('resTies').textContent = modes.length>1 ? 'Yes' : 'No';
      document.getElementById('resCount').textContent = String(totalCount);
    }

    // CSV export
    function downloadCSV(entries){
      const lines = [['Value','Frequency'], ...entries.map(([v,f])=>[v,f])];
      const csv = lines.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'mode-frequency-table.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // Event bindings
    document.addEventListener('DOMContentLoaded', ()=>{
      // Tabs
      document.getElementById('tabbtn-list').addEventListener('click', ()=>setTab('list'));
      document.getElementById('tabbtn-freq').addEventListener('click', ()=>setTab('freq'));
      document.getElementById('tabbtn-grouped').addEventListener('click', ()=>setTab('grouped'));

      // Tooltips
      bindTooltip('tip-dataType', 'tip-panel-dataType');

      // On-blur validation examples
      document.getElementById('rawInput').addEventListener('blur', ()=>{
        const v = document.getElementById('rawInput').value.trim();
        setError('err-raw', v.length ? '' : 'Please paste at least one value.');
      });
      document.getElementById('rounding').addEventListener('blur', ()=>{
        const p = Number(document.getElementById('rounding').value);
        setError('err-rounding', (Number.isInteger(p) && p>=0) ? '' : 'Rounding must be a non-negative integer.');
      });

      // Dynamic rows default
      addFreqRow(); addFreqRow();
      addGrpRow(); addGrpRow();

      document.getElementById('addFreqRow').addEventListener('click', ()=>addFreqRow());
      document.getElementById('clearFreq').addEventListener('click', ()=>{
        document.getElementById('freqBody').innerHTML='';
        setError('err-freq','');
      });
      document.getElementById('freqBody').addEventListener('click', (e)=>{
        if (e.target.classList.contains('remove-row')) e.target.closest('tr').remove();
      });

      document.getElementById('addGrpRow').addEventListener('click', ()=>addGrpRow());
      document.getElementById('clearGrp').addEventListener('click', ()=>{
        document.getElementById('grpBody').innerHTML='';
        setError('err-grp','');
      });
      document.getElementById('grpBody').addEventListener('click', (e)=>{
        if (e.target.classList.contains('remove-row')) e.target.closest('tr').remove();
      });

      // Calculate
      document.getElementById('btnCalc').addEventListener('click', ()=>{
        setError('err-raw',''); setError('err-freq',''); setError('err-grp','');

        if (state.activeTab==='grouped'){
          const g = computeGrouped();
          if (g.error){ setError('err-grp', g.error); return; }
          const entries = g.table.map(r=>[`${r.L}–${r.U}`, r.f]);
          renderFreq(entries);
          document.getElementById('resMode').textContent = Number.isFinite(g.modeEst) ? String(g.modeEst) : '—';
          document.getElementById('resMultiplicity').textContent = '1 (estimated)';
          document.getElementById('resTies').textContent = '—';
          document.getElementById('resCount').textContent = String(entries.reduce((a, [,f])=>a+f,0));
          if (g.note){
            // show note in frequency section header as a transient message
            // (simple accessible announcement)
            const note = document.createElement('p');
            note.className='help mt-2';
            note.textContent = g.note;
            const details = document.querySelector('#results-region details');
            details?.prepend(note);
            setTimeout(()=>note.remove(), 6000);
          }
          return;
        }

        if (state.activeTab==='freq'){
          const {map,count,errors} = buildFromFreq();
          if (map.size===0) { setError('err-freq','Please add at least one valid row with a non-negative frequency.'); return; }
          if (errors>0){ setError('err-freq', 'Some rows were invalid and ignored. Check value types and frequencies.'); }
          const {entries, maxF, modes} = computeModes(map);
          renderFreq(entries);
          updateCards({modes, maxF, totalCount: count});
          return;
        }

        // list
        const {map,count,invalidCount} = buildFromList();
        if (count===0){ setError('err-raw','No valid values found. Check parsing options or data type.'); return; }
        if (invalidCount>0){ setError('err-raw', `${invalidCount} token(s) were invalid and ignored.`); }
        const {entries, maxF, modes} = computeModes(map);
        renderFreq(entries);
        updateCards({modes, maxF, totalCount: count});
      });

      // Reset
      document.getElementById('btnReset').addEventListener('click', ()=>{
        document.getElementById('rawInput').value='';
        document.getElementById('freqBody').innerHTML=''; addFreqRow(); addFreqRow();
        document.getElementById('grpBody').innerHTML=''; addGrpRow(); addGrpRow();
        setError('err-raw',''); setError('err-freq',''); setError('err-grp','');
        renderFreq([]);
        updateCards({modes:[], maxF:0, totalCount:0});
      });

      // Export
      document.getElementById('btnExport').addEventListener('click', ()=>{
        const rows = Array.from(document.querySelectorAll('#freqRows tr'));
        if (!rows.length) { alert('No frequency rows to export. Calculate first.'); return; }
        const entries = rows.map(r => [r.children[0].textContent, Number(r.children[1].textContent)]);
        downloadCSV(entries);
      });

      // Print
      document.getElementById('btnPrint').addEventListener('click', ()=>window.print());

      // Default tab
      setTab('list');
    });
  </script>
</body>
</html>
