<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Packet Loss Calculator — Loss %, Lost Packets & Throughput</title>
  <meta name="description" content="Compute network packet loss percentage, lost packets, and estimated throughput impact. Enter packets sent/received or loss%, test duration, link speed, RTT and MSS for TCP goodput estimate." />
  <link rel="canonical" href="https://calcdomain.com/packet-loss-calculator.html" />

  <!-- Icons / PWA (optional placeholders to match site conventions) -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind CDN for rapid, consistent styling -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- Accessibility-first, mobile-first refinements -->
  <style>
    /* Base font stack for performance (no external fonts) */
    :root { --focus: 3px solid #2563eb; }
    html { -webkit-text-size-adjust: 100%; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background:#f8fafc; color:#111827; }
    .container { max-width: 1100px; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p, .prose li { line-height: 1.65; }
    .formula-box { background:#f3f4f6; border:1px solid #e5e7eb; border-radius: .75rem; padding:1rem; overflow-x:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius: .75rem; padding: 1rem; }
    .result-key { font-size:.9rem; color:#6b7280; }
    .result-val { font-weight:800; font-size:1.5rem; color:#1d4ed8; }
    .minh-results { min-height: 10rem; } /* Prevent CLS when results render */
    .kbd:focus, button:focus, input:focus, select:focus { outline: var(--focus); outline-offset: 2px; }
    details > summary { cursor:pointer; font-weight:700; }
    details[open] > summary { margin-bottom:.5rem; }
    /* Touch targets */
    button, .btn { min-height: 48px; min-width: 48px; }
    label .req { color:#b91c1c; }
    /* Error text accessible */
    .err { color:#b91c1c; font-size:.9rem; margin-top:.25rem; }
    /* Hide elements only visually (keep for SR) */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Packet Loss Calculator",
    "url": "https://calcdomain.com/packet-loss-calculator.html",
    "inLanguage": "en",
    "isPartOf": { "@type": "WebSite", "name": "CalcDomain", "url": "https://calcdomain.com/" },
    "description": "Compute network packet loss percentage, lost packets, and estimated throughput impact using link speed, RTT, and MSS.",
    "author": { "@type": "Person", "name": "Ugo Candido" },
    "publisher": { "@type": "Organization", "name": "CalcDomain" }
  }
  </script>

  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Lifestyle Everyday","item":"https://calcdomain.com/lifestyle-everyday.html"},
      {"@type":"ListItem","position":3,"name":"Miscellaneous","item":"https://calcdomain.com/subcategories/lifestyle-everyday-miscellaneous.html"},
      {"@type":"ListItem","position":4,"name":"Packet Loss Calculator","item":"https://calcdomain.com/packet-loss-calculator.html"}
    ]
  }
  </script>

  <!-- JSON-LD: HowTo (calculator steps) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to calculate packet loss and throughput impact",
    "description":"Steps to compute packet loss percentage, lost packets, and throughput impact.",
    "step":[
      {"@type":"HowToStep","name":"Choose input mode","text":"Use either 'Sent & Received' or 'Sent & Loss %' to provide your data."},
      {"@type":"HowToStep","name":"Enter counts","text":"Provide total packets sent and either received or loss percentage."},
      {"@type":"HowToStep","name":"Optional context","text":"Add test duration and link speed to estimate effective bitrate. Add RTT and MSS for TCP goodput estimate."},
      {"@type":"HowToStep","name":"Read results","text":"View loss %, lost packets, and estimated throughput with notes."}
    ]
  }
  </script>

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is packet loss?","acceptedAnswer":{"@type":"Answer","text":"Packet loss is the fraction of transmitted packets that never arrive at the destination. It causes stutter, buffering, or retransmissions."}},
      {"@type":"Question","name":"How do I calculate packet loss percentage?","acceptedAnswer":{"@type":"Answer","text":"Loss% = ((Sent − Received) / Sent) × 100. If you know loss% and Sent, then Lost = Sent × (Loss%/100) and Received = Sent − Lost."}},
      {"@type":"Question","name":"Is 0% packet loss realistic?","acceptedAnswer":{"@type":"Answer","text":"Short tests may show 0% loss, but over time nearly all networks exhibit transient loss. For real-time apps, aim for <1%."}},
      {"@type":"Question","name":"Does packet loss affect TCP and UDP equally?","acceptedAnswer":{"@type":"Answer","text":"TCP reduces send rate when it detects loss (congestion control), so throughput drops. UDP keeps sending; loss shows up as missing media frames."}},
      {"@type":"Question","name":"What RTT and MSS should I use for TCP estimate?","acceptedAnswer":{"@type":"Answer","text":"Use your measured round-trip time (RTT, ms) and your path MTU-derived MSS (commonly ~1440 bytes on Ethernet with typical MTUs)."}},
      {"@type":"Question","name":"Why does my measured bitrate differ from the estimate?","acceptedAnswer":{"@type":"Answer","text":"Real networks have variable RTT, queueing, bursts, FEC, QoS, and application behavior. The Mathis model is a first-order approximation."}}
    ]
  }
  </script>
</head>
<body>
  <!-- Header (non-sticky for maximal mobile viewport) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="text-xl font-extrabold text-blue-700 focus:outline-none">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700 focus:outline-none" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-700 focus:outline-none" href="index.html#categories">Categories</a>
      </nav>
      <button id="menuBtn" class="md:hidden p-2 rounded hover:bg-gray-100 focus:outline-none" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">☰</button>
    </div>
    <div id="mobileNav" class="md:hidden hidden px-4 pb-4">
      <a class="block py-2 hover:text-blue-700" href="search.html">Advanced Search</a>
      <a class="block py-2 hover:text-blue-700" href="index.html#categories">Categories</a>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- Breadcrumbs -->
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
      <a href="lifestyle-everyday.html" class="hover:text-blue-700">Lifestyle Everyday</a> &raquo;
      <a href="subcategories/lifestyle-everyday-miscellaneous.html" class="hover:text-blue-700">Miscellaneous</a> &raquo;
      <span class="text-gray-900">Packet Loss Calculator</span>
    </nav>

    <!-- H1 -->
    <h1 class="text-3xl font-extrabold mb-2">Packet Loss Calculator</h1>
    <!-- Intro -->
    <p class="text-gray-700 mb-6">
      Quickly compute <strong>packet loss percentage</strong>, <strong>lost packets</strong>, and the <strong>throughput impact</strong> on your link.
      Built for network engineers, SREs, and technically minded users running ping/iperf or application-level tests.
    </p>

    <!-- Calculator + Results two-column (stacks on mobile) -->
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Calculator -->
      <section class="w-full lg:w-2/3 bg-white p-6 rounded-xl shadow-sm border" aria-labelledby="calcTitle">
        <h2 id="calcTitle" class="text-xl font-bold mb-4">Interactive Calculator</h2>

        <!-- Input mode -->
        <fieldset class="mb-4">
          <legend class="font-semibold mb-2">Input mode</legend>
          <div class="flex flex-col sm:flex-row gap-3" role="radiogroup" aria-label="Input mode">
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="mode" id="modeSR" value="sr" checked />
              <span>Sent &amp; Received</span>
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="radio" name="mode" id="modeSL" value="sl" />
              <span>Sent &amp; Loss %</span>
            </label>
          </div>
        </fieldset>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <!-- Sent packets -->
          <div>
            <label for="sent" class="block font-medium">Packets sent <span class="req" aria-hidden="true">*</span></label>
            <div class="flex items-start gap-2">
              <input type="number" id="sent" inputmode="numeric" min="1" step="1" aria-required="true" aria-describedby="sent_tip sent_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="sent_tip" data-tooltip="#sent_tip">?</button>
            </div>
            <p id="sent_tip" class="text-gray-600 text-sm mt-1 hidden">Total packets transmitted by the sender during the test window.</p>
            <p id="sent_err" class="err hidden">Enter an integer ≥ 1.</p>
          </div>

          <!-- Received packets (SR mode) -->
          <div data-mode="sr">
            <label for="recv" class="block font-medium">Packets received <span class="req" aria-hidden="true">*</span></label>
            <div class="flex items-start gap-2">
              <input type="number" id="recv" inputmode="numeric" min="0" step="1" aria-required="true" aria-describedby="recv_tip recv_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="recv_tip" data-tooltip="#recv_tip">?</button>
            </div>
            <p id="recv_tip" class="text-gray-600 text-sm mt-1 hidden">Packets that reached the destination (successful receives).</p>
            <p id="recv_err" class="err hidden">Received must be an integer ≥ 0 and ≤ Sent.</p>
          </div>

          <!-- Loss % (SL mode) -->
          <div data-mode="sl" class="hidden">
            <label for="lossPct" class="block font-medium">Loss percentage (%) <span class="req" aria-hidden="true">*</span></label>
            <div class="flex items-start gap-2">
              <input type="number" id="lossPct" inputmode="decimal" min="0" max="100" step="0.0001" aria-required="true" aria-describedby="loss_tip loss_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="loss_tip" data-tooltip="#loss_tip">?</button>
            </div>
            <p id="loss_tip" class="text-gray-600 text-sm mt-1 hidden">If known, provide loss% directly (0 to 100).</p>
            <p id="loss_err" class="err hidden">Enter a value from 0 to 100.</p>
          </div>

          <!-- Test duration -->
          <div>
            <label for="duration" class="block font-medium">Test duration (seconds)</label>
            <div class="flex items-start gap-2">
              <input type="number" id="duration" inputmode="decimal" min="0" step="0.001" aria-describedby="dur_tip dur_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="dur_tip" data-tooltip="#dur_tip">?</button>
            </div>
            <p id="dur_tip" class="text-gray-600 text-sm mt-1 hidden">Optional. Used to compute send/receive rates.</p>
            <p id="dur_err" class="err hidden">Enter a number ≥ 0.</p>
          </div>

          <!-- Link speed -->
          <div>
            <label for="linkMbps" class="block font-medium">Link speed (Mb/s)</label>
            <div class="flex items-start gap-2">
              <input type="number" id="linkMbps" inputmode="decimal" min="0" step="0.001" aria-describedby="speed_tip speed_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="speed_tip" data-tooltip="#speed_tip">?</button>
            </div>
            <p id="speed_tip" class="text-gray-600 text-sm mt-1 hidden">Optional. Used to estimate effective bitrate under loss.</p>
            <p id="speed_err" class="err hidden">Enter a number ≥ 0.</p>
          </div>

          <!-- RTT & MSS for TCP estimate -->
          <div>
            <label for="rttMs" class="block font-medium">RTT (ms)</label>
            <div class="flex items-start gap-2">
              <input type="number" id="rttMs" inputmode="decimal" min="0" step="0.01" aria-describedby="rtt_tip rtt_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="rtt_tip" data-tooltip="#rtt_tip">?</button>
            </div>
            <p id="rtt_tip" class="text-gray-600 text-sm mt-1 hidden">Optional. Round-trip time. Improves TCP goodput estimate.</p>
            <p id="rtt_err" class="err hidden">Enter a number ≥ 0.</p>
          </div>

          <div>
            <label for="mssBytes" class="block font-medium">MSS (bytes)</label>
            <div class="flex items-start gap-2">
              <input type="number" id="mssBytes" inputmode="numeric" min="256" step="1" aria-describedby="mss_tip mss_err"
                     class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2" />
              <button type="button" class="mt-1 px-2 rounded border" aria-expanded="false" aria-controls="mss_tip" data-tooltip="#mss_tip">?</button>
            </div>
            <p id="mss_tip" class="text-gray-600 text-sm mt-1 hidden">Optional. Max Segment Size (payload). Typical ~1440 bytes with common MTUs.</p>
            <p id="mss_err" class="err hidden">Enter an integer ≥ 256.</p>
          </div>
        </div>

        <!-- Actions -->
        <div class="mt-6 flex flex-wrap gap-3">
          <button id="calcBtn" class="btn px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Calculate</button>
          <button id="resetBtn" class="btn px-4 py-2 rounded-md border">Reset</button>
        </div>
      </section>

      <!-- Results -->
      <section class="w-full lg:w-1/3 bg-white p-6 rounded-xl shadow-sm border minh-results" aria-labelledby="resTitle">
        <h2 id="resTitle" class="text-xl font-bold mb-4">Results</h2>

        <div class="grid grid-cols-1 gap-4">
          <div class="result-card">
            <div class="result-key">Loss percentage</div>
            <div id="outLossPct" class="result-val">—</div>
          </div>
          <div class="result-card">
            <div class="result-key">Packets lost</div>
            <div id="outLost" class="result-val">—</div>
          </div>
          <div class="result-card">
            <div class="result-key">Estimated effective bitrate (Mb/s)</div>
            <div id="outEff" class="result-val">—</div>
          </div>
          <div class="result-card">
            <div class="result-key">Estimated TCP goodput (Mb/s)</div>
            <div id="outTcp" class="result-val">—</div>
          </div>
        </div>

        <p id="notes" class="text-sm text-gray-600 mt-4"></p>
      </section>
    </div>

    <!-- Authoritative ecosystem -->
    <section class="bg-white p-6 rounded-xl shadow-sm border mt-8 prose">
      <h2>Authoritative Data Source &amp; Methodology</h2>
      <ul>
        <li><strong>ITU-T Y.1540 (12/2016)</strong> — Internet protocol data communication service: <em>IP packet transfer and availability performance parameters</em>. Defines <strong>IP Packet Loss Ratio (IPLR)</strong> and measurement methodology. Link: <a href="https://www.itu.int/rec/T-REC-Y.1540" rel="nofollow">itu.int/rec/T-REC-Y.1540</a></li>
        <li><strong>RFC 5681</strong> — <em>TCP Congestion Control</em>. Background for TCP behavior under loss.</li>
        <li><strong>Mathis et al. (1997)</strong> — <em>The macroscopic behavior of the TCP congestion avoidance algorithm</em>. Throughput ∝ 1/√p model.</li>
      </ul>
      <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

      <h2>The Formula Explained</h2>
      <div class="formula-box" aria-label="Formulas">
        Loss ratio (PLR):<br/>
        \( \displaystyle \mathrm{PLR} = 1 - \frac{R}{S} = \frac{S - R}{S} \)<br/><br/>
        Loss percentage:<br/>
        \( \displaystyle \mathrm{Loss\%} = \left( \frac{S - R}{S} \right)\times 100 \)<br/><br/>
        Lost packets:<br/>
        \( \displaystyle L = S - R = S \times \frac{\mathrm{Loss\%}}{100} \)<br/><br/>
        Naïve effective bitrate (given link rate \(B\)):<br/>
        \( \displaystyle B_{\mathrm{eff}} \approx B \times (1 - \mathrm{PLR}) \)<br/><br/>
        TCP goodput estimate (Mathis model, constant \(C\approx1.22\), MSS in bytes, RTT in seconds, loss probability \(p\)):<br/>
        \( \displaystyle \mathrm{Throughput} \approx \frac{C \cdot \mathrm{MSS}}{\mathrm{RTT}\cdot \sqrt{p}} \) (bytes/s) \( \Rightarrow \) convert to Mb/s by multiplying by \(8/10^6\).
      </div>

      <h2>Glossary of Variables</h2>
      <table>
        <thead><tr><th>Symbol / Field</th><th>Meaning</th></tr></thead>
        <tbody>
          <tr><td><strong>S</strong> (Packets sent)</td><td>Total transmitted packets.</td></tr>
          <tr><td><strong>R</strong> (Packets received)</td><td>Successfully received packets.</td></tr>
          <tr><td><strong>L</strong> (Packets lost)</td><td>Packets missing at destination (S − R).</td></tr>
          <tr><td><strong>PLR</strong></td><td>Packet loss ratio (0..1).</td></tr>
          <tr><td><strong>Loss%</strong></td><td>Packet loss percentage (0..100).</td></tr>
          <tr><td><strong>B</strong> (Mb/s)</td><td>Nominal link bitrate.</td></tr>
          <tr><td><strong>RTT</strong> (ms)</td><td>Round-trip time for TCP connections.</td></tr>
          <tr><td><strong>MSS</strong> (bytes)</td><td>TCP maximum segment size (payload).</td></tr>
        </tbody>
      </table>

      <h2>How It Works: A Step-by-Step Example</h2>
      <p><strong>Scenario.</strong> You sent S = 50,000 packets, and received R = 49,500. Link speed is 100 Mb/s. RTT is 40 ms, MSS is 1440 bytes.</p>
      <ol>
        <li>Compute PLR: \( \mathrm{PLR} = (50{,}000 - 49{,}500) / 50{,}000 = 0.01 \).</li>
        <li>Loss%: \( 0.01 \times 100 = 1\% \).</li>
        <li>Lost packets: \( 50{,}000 - 49{,}500 = 500 \).</li>
        <li>Naïve effective bitrate: \( 100 \times (1 - 0.01) = 99 \) Mb/s.</li>
        <li>TCP goodput (Mathis): \( C \cdot MSS /(RTT\cdot\sqrt{p}) \) with \(C=1.22\), \(MSS=1440\) B, \(RTT=0.04\) s, \(p=0.01\):<br/>
          \( \frac{1.22 \times 1440}{0.04 \times 0.1} = 439,200 \) B/s ≈ 3.51 Mb/s.</li>
      </ol>
      <p>Note how even 1% loss can strongly reduce TCP throughput over a 40 ms path.</p>

      <h2>Frequently Asked Questions</h2>
      <details>
        <summary>What packet loss is acceptable for real-time apps?</summary>
        <p>For VoIP and video conferencing, target &lt;1% with low jitter. Some apps use FEC to mask small losses.</p>
      </details>
      <details>
        <summary>My speed test shows good bandwidth but calls still stutter. Why?</summary>
        <p>Loss and jitter, not bandwidth, often cause stutter. Even brief bursts of loss can break real-time streams.</p>
      </details>
      <details>
        <summary>Does increasing MTU reduce loss?</summary>
        <p>Not directly. Jumbo frames can reduce per-packet overhead but fragmentation or PMTUD issues can worsen loss.</p>
      </details>
      <details>
        <summary>How long should I test?</summary>
        <p>Longer windows capture intermittent loss. Run multiple tests across peak times to see burst patterns.</p>
      </details>
      <details>
        <summary>Can Wi-Fi cause high packet loss?</summary>
        <p>Yes—interference, signal strength, hidden nodes, and rate control can all contribute to retries and loss.</p>
      </details>
      <details>
        <summary>Why does TCP estimate differ from application throughput?</summary>
        <p>App behavior, parallel flows, congestion control variant, pacing, and server limits all matter. The model is a first-order guide.</p>
      </details>

      <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-26">October 26, 2025</time></p>
      </div>
    </section>
  </main>

  <footer class="bg-white border-t mt-10">
    <div class="container mx-auto px-4 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-3 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (defer) -->
  <script defer>
  (function () {
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    // Menu
    const menuBtn = $("#menuBtn");
    const mobileNav = $("#mobileNav");
    if (menuBtn && mobileNav) {
      menuBtn.addEventListener("click", () => {
        const open = mobileNav.classList.toggle("hidden") ? "false" : "true";
        menuBtn.setAttribute("aria-expanded", open);
      });
    }

    // Tooltip toggles (click or keyboard)
    $$(".[data-tooltip], [data-tooltip]").forEach(btn => {
      btn.addEventListener("click", () => toggleTip(btn));
      btn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); toggleTip(btn); }
      });
    });

    function toggleTip(btn) {
      const sel = btn.getAttribute("data-tooltip");
      if (!sel) return;
      const tip = document.querySelector(sel);
      if (!tip) return;
      const isHidden = tip.classList.toggle("hidden");
      btn.setAttribute("aria-expanded", (!isHidden).toString());
    }

    // Inputs
    const modeSR = $("#modeSR");
    const modeSL = $("#modeSL");
    const sent = $("#sent");
    const recv = $("#recv");
    const lossPct = $("#lossPct");
    const duration = $("#duration");
    const linkMbps = $("#linkMbps");
    const rttMs = $("#rttMs");
    const mssBytes = $("#mssBytes");

    const outLossPct = $("#outLossPct");
    const outLost = $("#outLost");
    const outEff = $("#outEff");
    const outTcp = $("#outTcp");
    const notes = $("#notes");

    // Show/hide fields by mode
    function applyMode() {
      const isSR = modeSR.checked;
      $$("[data-mode='sr']").forEach(el => el.classList.toggle("hidden", !isSR));
      $$("[data-mode='sl']").forEach(el => el.classList.toggle("hidden", isSR));
    }
    modeSR.addEventListener("change", applyMode);
    modeSL.addEventListener("change", applyMode);
    applyMode();

    // Validation helpers
    function showErr(id, msg) {
      const el = $(id);
      if (!el) return;
      el.textContent = msg;
      el.classList.remove("hidden");
    }
    function hideErr(id) {
      const el = $(id);
      if (!el) return;
      el.classList.add("hidden");
    }

    function validate() {
      let ok = true;
      const s = +sent.value;
      if (!(Number.isFinite(s) && s >= 1 && Number.isInteger(s))) { showErr("#sent_err","Enter an integer ≥ 1."); ok = false; }
      else { hideErr("#sent_err"); }

      if (modeSR.checked) {
        const r = +recv.value;
        if (!(Number.isFinite(r) && r >= 0 && Number.isInteger(r) && r <= s)) {
          showErr("#recv_err","Received must be an integer ≥ 0 and ≤ Sent.");
          ok = false;
        } else hideErr("#recv_err");
      } else {
        const lp = +lossPct.value;
        if (!(Number.isFinite(lp) && lp >= 0 && lp <= 100)) { showErr("#loss_err","Enter a value from 0 to 100."); ok = false; }
        else hideErr("#loss_err");
      }

      const d = duration.value === "" ? 0 : +duration.value;
      if (!(Number.isFinite(d) && d >= 0)) { showErr("#dur_err","Enter a number ≥ 0."); ok = false; } else hideErr("#dur_err");

      const b = linkMbps.value === "" ? 0 : +linkMbps.value;
      if (!(Number.isFinite(b) && b >= 0)) { showErr("#speed_err","Enter a number ≥ 0."); ok = false; } else hideErr("#speed_err");

      const rtt = rttMs.value === "" ? 0 : +rttMs.value;
      if (!(Number.isFinite(rtt) && rtt >= 0)) { showErr("#rtt_err","Enter a number ≥ 0."); ok = false; } else hideErr("#rtt_err");

      const mss = mssBytes.value === "" ? 0 : +mssBytes.value;
      if (mssBytes.value !== "" && !(Number.isFinite(mss) && Number.isInteger(mss) && mss >= 256)) { showErr("#mss_err","Enter an integer ≥ 256."); ok = false; } else hideErr("#mss_err");

      return ok;
    }

    // Inline validation on blur
    [sent, recv, lossPct, duration, linkMbps, rttMs, mssBytes].forEach(inp => {
      if (!inp) return;
      inp.addEventListener("blur", validate);
    });

    // Calculation
    function calc() {
      if (!validate()) { render("", "", "", "", ""); return; }
      const S = +sent.value;
      let R, Lp;
      if (modeSR.checked) {
        R = +recv.value;
        Lp = (S - R) / S * 100;
      } else {
        const lpIn = +lossPct.value;
        Lp = lpIn;
        R = S * (1 - (Lp/100));
      }
      const L = S - R;

      // Effective bitrate (naïve) if link speed provided
      const B = linkMbps.value === "" ? NaN : +linkMbps.value;
      const Beff = Number.isFinite(B) ? B * (1 - (Lp/100)) : NaN;

      // TCP goodput estimate (Mathis model)
      const rtt = rttMs.value === "" ? NaN : (+rttMs.value / 1000); // seconds
      const mss = mssBytes.value === "" ? NaN : +mssBytes.value; // bytes
      let tcpMb = NaN;
      const p = Math.max(1e-12, Lp/100); // guard against 0
      if (Number.isFinite(rtt) && rtt > 0 && Number.isFinite(mss) && mss > 0) {
        const C = 1.22;
        const bytesPerSec = (C * mss) / (rtt * Math.sqrt(p));
        tcpMb = bytesPerSec * 8 / 1e6; // to Mb/s
      }

      // Optional rates if duration provided
      const D = duration.value === "" ? NaN : +duration.value;
      let sendRate = NaN, recvRate = NaN;
      if (Number.isFinite(D) && D > 0) {
        sendRate = S / D;
        recvRate = R / D;
      }

      // Notes
      const parts = [];
      parts.push("Loss and jitter impact real-time apps disproportionately.");
      if (Number.isFinite(sendRate)) parts.push(`Send rate ≈ ${fmt(sendRate)} p/s`);
      if (Number.isFinite(recvRate)) parts.push(`Receive rate ≈ ${fmt(recvRate)} p/s`);
      if (Number.isFinite(B)) parts.push(`Nominal link: ${fmt(B)} Mb/s`);
      const note = parts.join(" • ");

      render(
        `${fmt(Lp, 4)}%`,
        fmt(L, 0),
        Number.isFinite(Beff) ? fmt(Beff, 3) : "—",
        Number.isFinite(tcpMb) ? fmt(tcpMb, 3) : "—",
        note
      );
    }

    function fmt(n, dec = 0) {
      return new Intl.NumberFormat(undefined, { maximumFractionDigits: dec }).format(n);
    }

    function render(lossPctTxt, lostTxt, effTxt, tcpTxt, noteTxt) {
      outLossPct.textContent = lossPctTxt || "—";
      outLost.textContent = lostTxt || "—";
      outEff.textContent = effTxt || "—";
      outTcp.textContent = tcpTxt || "—";
      notes.textContent = noteTxt || "";
    }

    // Buttons
    $("#calcBtn").addEventListener("click", calc);
    $("#resetBtn").addEventListener("click", () => {
      [sent, recv, lossPct, duration, linkMbps, rttMs, mssBytes].forEach(i => { if (i) i.value = ""; });
      modeSR.checked = true; modeSL.checked = false; applyMode();
      render("", "", "", "", "");
      $$("[id$='_err']").forEach(e => e.classList.add("hidden"));
    });

    // Sensible defaults for quick demo
    sent.value = "10000";
    recv.value = "9950";
    duration.value = "10";
    linkMbps.value = "100";
    rttMs.value = "40";
    mssBytes.value = "1440";
    calc();
  })();
  </script>
</body>
</html>
