<!DOCTYPE html>
<html lang="en"><head> 
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta charset="utf-8"/>
<title>UK PAYE Calculator</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Professional-grade PAYE calculator (UK). Estimate Income Tax, National Insurance, Student Loan and take-home pay by year, region (rUK/Scotland), pay frequency, tax code and pension method." name="description"/>
<meta content="Ugo Candido" name="author"/>
<link href="https://calcdomain.com/paye-uk.html" rel="canonical"/>
<meta content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" name="robots"/>
<meta content="UK PAYE Calculator" property="og:title"/>
<meta content="Estimate UK Income Tax, NI, Student Loan and take-home pay with an accurate, accessible and mobile-first PAYE calculator." property="og:description"/>
<meta content="website" property="og:type"/>
<meta content="https://calcdomain.com/paye-calculator-uk" property="og:url"/>
<meta content="en_GB" property="og:locale"/>
<meta content="#005A9C" name="theme-color"/>
<!-- Non‑critical global CSS loaded asynchronously -->
<link as="style" href="style.css" onload="this.rel='stylesheet'" rel="preload"/>
<noscript><link href="style.css" rel="stylesheet"/></noscript>
<style>
    /* Critical, mobile-first CSS (above-the-fold) */
    :root{
      --primary-color:#005A9C; --secondary-color:#003F6E; --accent-color:#00A4E4;
      --background-color:#F8F9FA; --surface-color:#FFFFFF;
      --text-color:#212529; --muted-text-color:#6C757D; --border-color:#DEE2E6;
      --success-color:#198754; --error-color:#DC3545; --warning-color:#FFC107;
      --touch-target-min:48px; --radius:10px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html{font-size:clamp(16px,2.5vw,18px)}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:#fff;color:var(--text-color);line-height:1.6}
    a{color:var(--primary-color);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1200px;margin:0 auto;padding:0 1rem}
    .skip-link{position:absolute;left:6px;top:-40px;background:var(--primary-color);color:#fff;padding:.5rem .75rem;border-radius:0 0 4px 4px;z-index:1000}
    .skip-link:focus{top:0}
    .site-header{background:#fff;border-bottom:1px solid var(--border-color)}
    .header-content{display:grid;grid-template-columns:auto 1fr;gap:.75rem;align-items:center;padding:.75rem 0}
    .logo{font-weight:700;color:var(--primary-color);font-size:1.25rem}
    .main-content{padding:1.25rem 0}
    h1,h2,h3{color:var(--secondary-color);line-height:1.2}
    h1{font-size:clamp(1.8rem,4vw,2.3rem);margin:.25rem 0 .5rem}
    p{max-width:70ch}
    .calculator-layout{display:grid;grid-template-columns:1fr;gap:1.5rem;margin-top:.5rem}
    @media (min-width: 992px){.calculator-layout{grid-template-columns:420px 1fr}}
    .calculator-container{border:1px solid var(--border-color);border-radius:12px;padding:1rem;background:var(--surface-color)}
    .form-group{margin-bottom:1rem}
    .form-group label{display:block;font-weight:600;margin-bottom:.4rem}
    .input-row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .input-group{position:relative;flex:1 1 220px}
    .form-control{width:100%;min-height:48px;padding:.75rem 1rem;border:1px solid var(--border-color);border-radius:8px;font-size:1rem}
    .form-control:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}
    .input-affix{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);color:#6c757d;pointer-events:none}
    fieldset{border:0;padding:0;margin:0}
    .radio-group{display:flex;gap:.5rem;flex-wrap:wrap}
    .radio-pill{position:relative}
    .radio-pill input[type=radio]{position:absolute;opacity:0}
    .radio-pill label{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--border-color);border-radius:999px;padding:.5rem .9rem;min-height:var(--touch-target-min);cursor:pointer;user-select:none}
    .radio-pill input[type=radio]:checked + label{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}
    .radio-pill input[type=radio]:focus-visible + label{outline:3px solid var(--primary-color);outline-offset:2px}
    .select{min-height:48px;padding:.6rem .75rem;border:1px solid var(--border-color);border-radius:8px}
    .inline-help{display:inline-flex;align-items:center;gap:.35rem}
    .help-btn{appearance:none;border:1px solid var(--border-color);background:#fff;border-radius:50%;width:32px;height:32px;min-width:32px;line-height:30px;text-align:center;font-weight:700;color:#333;cursor:pointer}
    .help-btn:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}
    .tooltip{border:1px solid var(--border-color);border-radius:8px;background:#f8f9fa;padding:.75rem;margin-top:.5rem}
    .error-message{color:var(--error-color);font-size:.9rem;margin-top:.35rem;min-height:1.25rem}
    .results-container{margin-top:1rem;padding:1rem;background:#f8f9fa;border:1px solid var(--border-color);border-radius:12px;min-height:320px}
    .result-grid{display:grid;grid-template-columns:1fr auto;gap:.5rem .75rem;align-items:center}
    .result-label{color:#6c757d}
    .result-value{font-weight:700}
    .result-strong{font-size:1.25rem;color:var(--success-color)}
    .band-breakdown{margin-top:.75rem;border-top:1px dashed var(--border-color);padding-top:.75rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--primary-color);color:#fff;background:var(--primary-color);border-radius:10px;padding:.75rem 1rem;min-height:48px;min-width:48px;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--secondary-color);border-color:var(--secondary-color)}
    .content-container h2{margin-top:1.5rem;padding-top:.5rem;border-top:1px solid var(--border-color)}
    .formula-box{background:#eef3f8;border:1px solid #d5e2ef;border-radius:8px;padding:1rem;margin:.75rem 0;overflow:auto}
    .author-box{font-size:.95rem;color:#6c757d;margin-top:1rem;border-top:1px solid var(--border-color);padding-top:1rem}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
<!-- MathJax for LaTeX rendering -->
<script defer="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "UK PAYE Calculator",
  "description": "Professional-grade UK PAYE calculator to estimate Income Tax, National Insurance, Student Loan and take-home pay with support for Scotland rates, tax codes and pension methods.",
  "url": "https://calcdomain.com/paye-uk.html",
  "inLanguage": "en-GB",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "hasPart": [
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step Example",
      "description": "Worked example showing PAYE, NI and Student Loan on a £45,000 annual salary (rUK, 2024/25).",
      "totalTime": "PT1M",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Provide inputs",
          "text": "Salary £45,000 per year, Region: rUK, Tax code 1257L, No pension, No student loan.",
          "position": 1
        },
        {
          "@type": "HowToStep",
          "name": "Compute Personal Allowance",
          "text": "Tax code 1257L gives £12,570 allowance. Taxable income = £45,000 − £12,570 = £32,430.",
          "position": 2
        },
        {
          "@type": "HowToStep",
          "name": "Apply tax bands",
          "text": "All £32,430 taxed at 20% basic rate for rUK. Income Tax = £6,486.",
          "position": 3
        },
        {
          "@type": "HowToStep",
          "name": "Compute NI",
          "text": "Annual PT £12,570, UEL £50,270. NI = 8% × (45,000 − 12,570) = £2,596. ",
          "position": 4
        },
        {
          "@type": "HowToStep",
          "name": "Arrive at take-home",
          "text": "Net = £45,000 − £6,486 − £2,596 = £35,918 (~£2,993/month).",
          "position": 5
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Does this calculator support Scotland tax rates?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. Choose Scotland under Region to apply the 2024/25 Scottish bands including the Advanced rate."
          }
        },
        {
          "@type": "Question",
          "name": "Can I enter my tax code?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. Numeric codes like 1257L are supported, plus BR, 0T, D0, D1. Numeric codes set a personal allowance equal to the digits × 10. Advanced codes (K, M, N) are partially supported."
          }
        },
        {
          "@type": "Question",
          "name": "How are pensions handled?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Choose Salary Sacrifice (reduces tax and NI), Net Pay Arrangement (reduces taxable income only), or Relief at Source (deducted from net pay; provider claims basic-rate relief)."
          }
        },
        {
          "@type": "Question",
          "name": "Which student loan plans are included?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Plans 1, 2, 4 and 5 at 9% of income above their thresholds, and Postgraduate Loan at 6% above its threshold."
          }
        },
        {
          "@type": "Question",
          "name": "Is NI calculated per pay period?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. NI is computed using the thresholds for your selected pay frequency (weekly, monthly or annual) then annualised."
          }
        },
        {
          "@type": "Question",
          "name": "Are results financial advice?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. This tool is for guidance only. Consult a qualified professional for advice specific to your circumstances."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
</head>
<body>
<a class="skip-link" href="#main-content">Skip to main content</a>

<main class="main-content" id="main-content" role="main">
<div class="container">
<h1>UK PAYE Calculator</h1>
<p>This professional PAYE calculator estimates your UK Income Tax, National Insurance, Student Loan and take-home pay. It’s built for employees, contractors and HR/payroll teams who need quick, transparent and accessible calculations across regions, tax codes and pension methods.</p>
<div class="calculator-layout">
<section aria-labelledby="calc-heading" class="calculator-container">
<h2 class="sr-only" id="calc-heading">PAYE Calculator Inputs</h2>
<div class="form-group">
<fieldset aria-describedby="frequencyHelp">
<legend>Pay frequency *</legend>
<div class="radio-group" id="freqGroup">
<span class="radio-pill"><input checked="" id="freqAnnual" name="frequency" type="radio" value="annual"/><label for="freqAnnual">Annual</label></span>
<span class="radio-pill"><input id="freqMonthly" name="frequency" type="radio" value="monthly"/><label for="freqMonthly">Monthly</label></span>
<span class="radio-pill"><input id="freqWeekly" name="frequency" type="radio" value="weekly"/><label for="freqWeekly">Weekly</label></span>
</div>
<p class="sr-only" id="frequencyHelp">Choose how you input pay: annual, monthly or weekly.</p>
</fieldset>
</div>
<div class="form-group">
<div class="inline-help">
<label for="salaryInput" id="salaryLabel">Gross salary (Annual) *</label>
<button aria-controls="salaryTip" aria-expanded="false" aria-label="About gross salary" class="help-btn" id="salaryTipBtn" type="button">?</button>
</div>
<div class="input-group">
<input aria-describedby="salaryError salaryTip" aria-required="true" class="form-control" id="salaryInput" inputmode="decimal" min="0" placeholder="e.g., 45000" step="0.01" type="number"/>
<span class="input-affix">£</span>
</div>
<div aria-live="polite" class="error-message" id="salaryError" role="alert"></div>
<div class="tooltip" hidden="" id="salaryTip">
              Enter your gross pay before tax and deductions. If you select Monthly or Weekly above, input the amount for that period.
            </div>
</div>
<div class="form-group">
<fieldset>
<legend>Region *</legend>
<div class="radio-group">
<span class="radio-pill"><input checked="" id="regionRUK" name="region" type="radio" value="rUK"/><label for="regionRUK">England, Wales, NI</label></span>
<span class="radio-pill"><input id="regionSCT" name="region" type="radio" value="Scotland"/><label for="regionSCT">Scotland</label></span>
</div>
</fieldset>
</div>
<div class="form-group">
<div class="inline-help">
<label for="taxCode">Tax code</label>
<button aria-controls="taxCodeTip" aria-expanded="false" aria-label="About tax code" class="help-btn" id="taxCodeTipBtn" type="button">?</button>
</div>
<div class="input-row">
<input aria-describedby="taxCodeHelp taxCodeTip" autocomplete="off" class="form-control" id="taxCode" inputmode="text" type="text" value="1257L"/>
</div>
<div aria-live="polite" class="error-message" id="taxCodeHelp"></div>
<div class="tooltip" hidden="" id="taxCodeTip">
              Supported: numeric codes like 1257L (allowance = 12,570), and BR, 0T, D0, D1. Advanced codes (K, M, N) may require specialist advice.
            </div>
</div>
<div class="form-group">
<label for="taxYear">Tax year *</label>
<select aria-required="true" class="select" id="taxYear">
<option value="2024">2024/25 (default)</option>
<option value="2023">2023/24</option>
</select>
</div>
<div class="form-group">
<div class="inline-help">
<label for="pensionPercent">Pension contribution (%)</label>
<button aria-controls="pensionTip" aria-expanded="false" aria-label="About pension methods" class="help-btn" id="pensionTipBtn" type="button">?</button>
</div>
<div class="input-row">
<div class="input-group">
<input aria-describedby="pensionError pensionTip" class="form-control" id="pensionPercent" max="100" min="0" placeholder="e.g., 5" step="0.1" type="number"/>
<span class="input-affix">%</span>
</div>
<select aria-describedby="pensionTip" aria-label="Pension method" class="select" id="pensionMethod">
<option selected="" value="none">No pension</option>
<option value="salary_sacrifice">Salary Sacrifice (pre-tax &amp; pre-NI)</option>
<option value="net_pay">Net Pay Arrangement (pre-tax)</option>
<option value="relief_source">Relief at Source (from net)</option>
</select>
</div>
<div aria-live="polite" class="error-message" id="pensionError"></div>
<div class="tooltip" hidden="" id="pensionTip">
              Salary Sacrifice reduces taxable pay and NI. Net Pay Arrangement reduces taxable pay only. Relief at Source is taken from net pay; the provider claims 20% basic-rate relief.
            </div>
</div>
<div class="form-group">
<label for="loanPlan">Student loan</label>
<div class="input-row">
<select aria-label="Student loan plan" class="select" id="loanPlan">
<option selected="" value="none">No Plan</option>
<option value="plan1">Plan 1</option>
<option value="plan2">Plan 2</option>
<option value="plan4">Plan 4 (Scotland)</option>
<option value="plan5">Plan 5 (England from 2023)</option>
</select>
<span class="radio-pill">
<input id="pgl" name="pgl" type="checkbox"/>
<label for="pgl">Postgraduate Loan</label>
</span>
</div>
</div>
<div class="form-group">
<button aria-label="Calculate take-home pay" class="btn" id="calcBtn" type="button">Calculate now</button>
</div>
<div aria-atomic="true" aria-live="polite" class="results-container">
<h3>Results</h3>
<div aria-label="Key results" class="result-grid" role="region">
<div class="result-label">Take-home pay (per year)</div><div class="result-value result-strong" id="netAnnual">—</div>
<div class="result-label">Take-home (per month)</div><div class="result-value" id="netMonthly">—</div>
<div class="result-label">Take-home (per week)</div><div class="result-value" id="netWeekly">—</div>
<div class="result-label">Income Tax</div><div class="result-value" id="incomeTax">—</div>
<div class="result-label">National Insurance</div><div class="result-value" id="ni">—</div>
<div class="result-label">Student Loan</div><div class="result-value" id="studentLoan">—</div>
<div class="result-label">Postgraduate Loan</div><div class="result-value" id="pglOut">—</div>
<div class="result-label">Employee pension (gross)</div><div class="result-value" id="pensionOut">—</div>
<div class="result-label">Effective deduction rate</div><div class="result-value" id="effRate">—</div>
</div>
<div aria-label="Tax band breakdown" class="band-breakdown" role="region">
<h4 style="margin:.25rem 0 .5rem;">Income Tax breakdown</h4>
<div id="bandBreakdown" style="font-size:.95rem;color:#343a40">—</div>
</div>
</div>
</section>
<article aria-labelledby="content-heading" class="content-container">
<h2 id="content-heading">Data Source and Methodology</h2>
<ul>
<li>
              HM Revenue &amp; Customs (HMRC) – Estimate your Income Tax: 
              <a href="https://www.gov.uk/estimate-income-tax" rel="noopener" target="_blank">gov.uk/estimate-income-tax</a>
              (accessed current tax year).
            </li>
<li>
              HMRC – Income Tax rates and allowances (2024 to 2025): 
              <a href="https://www.gov.uk/income-tax-rates" rel="noopener" target="_blank">gov.uk/income-tax-rates</a>.
            </li>
<li>
              HMRC – National Insurance rates and thresholds (Class 1, 2024 to 2025): 
              <a href="https://www.gov.uk/national-insurance-rates-letters" rel="noopener" target="_blank">gov.uk/national-insurance-rates-letters</a>.
            </li>
<li>
              Student Loans Company/HMRC – Repayment thresholds and rates (2024 to 2025): 
              <a href="https://www.gov.uk/repaying-your-student-loan/what-you-pay" rel="noopener" target="_blank">gov.uk/repaying-your-student-loan</a>.
            </li>
</ul>
<p><strong>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</strong></p>
<h2>The Formula Explained</h2>
<div class="formula-box">
<p>
              Personal Allowance from a standard numeric tax code:
              $$PA = 10 \times \text{codeDigits} \quad \text{(e.g., 1257L → } PA=12{,}570\text{)}$$
            </p>
<p>
              Tapering when Adjusted Net Income exceeds £100,000:
              $$PA^* = \max\left(0,\; PA - \frac{\max(0,\; ANI - 100{,}000)}{2}\right)$$
            </p>
<p>
              Taxable income and banded tax:
              $$TI = \max(0,\; G_t - PA^*)$$
              $$Tax = \sum_{b \in \text{bands}} \left( \min(\max(0, TI - b_{low}),\; b_{width}) \times b_{rate} \right)$$
            </p>
<p>
              Employee Class 1 NI per pay period (annualised):
              $$NI_{period} = 0.08 \cdot \max(0,\min(E, UEL) - PT) + 0.02 \cdot \max(0,\; E - UEL)$$
              $$NI_{annual} = NI_{period} \times N_{periods}$$
            </p>
<p>
              Student Loan and Postgraduate Loan:
              $$SL = r_{sl} \cdot \max(0,\; E_{SL} - T_{sl}) \quad,\quad PGL = 0.06 \cdot \max(0,\; E_{SL} - 21{,}000)$$
            </p>
<p>
              Pension impact (p = contribution rate):
              $$G_t = \begin{cases}
                G \cdot (1 - p) &amp; \text{Salary Sacrifice} \\
                G - G\cdot p &amp; \text{Net Pay Arrangement} \\
                G &amp; \text{Relief at Source}
              \end{cases}
              \quad,\quad
              E_{NI} = \begin{cases}
                G \cdot (1 - p) &amp; \text{Salary Sacrifice} \\
                G &amp; \text{otherwise}
              \end{cases}$$
            </p>
</div>
<h2>Glossary of Variables</h2>
<ul>
<li>G: Gross pay before deductions.</li>
<li>G_t: Taxable gross after pension method adjustments.</li>
<li>ANI: Adjusted Net Income used for Personal Allowance taper (after salary sacrifice or net pay contributions).</li>
<li>PA: Personal Allowance; PA*: tapered Personal Allowance.</li>
<li>TI: Taxable income after allowance.</li>
<li>E: Earnings in a pay period used for NI; PT: Primary Threshold; UEL: Upper Earnings Limit.</li>
<li>SL, PGL: Student Loan and Postgraduate Loan deductions; r_sl is 9% for Plans 1/2/4/5; PGL is 6%.</li>
<li>p: Employee pension rate (percentage of gross).</li>
</ul>
<h2>How It Works: A Step-By-Step Example</h2>
<p><strong>Inputs:</strong> Salary £45,000/year, Region rUK, Tax code 1257L, No pension, No loans, Tax year 2024/25.</p>
<ol>
<li>Personal Allowance: 1257L → PA = £12,570. No taper since ANI ≤ £100,000.</li>
<li>Taxable income TI = £45,000 − £12,570 = £32,430.</li>
<li>rUK bands: Entire TI in basic band at 20% → Tax = 0.20 × £32,430 = £6,486.</li>
<li>NI (annual): PT £12,570, UEL £50,270. NI = 8% × (£45,000 − £12,570) = £2,596.</li>
<li>Net pay = £45,000 − £6,486 − £2,596 = £35,918 (~£2,993/month).</li>
</ol>
<h2>Frequently Asked Questions (FAQ)</h2>
<details>
<summary>What tax years are supported?</summary>
<p>2024/25 (default) and 2023/24. Rates update when HMRC publishes new thresholds.</p>
</details>
<details>
<summary>How accurate is the NI calculation?</summary>
<p>NI is calculated per your chosen pay frequency using period thresholds (weekly, monthly or annual) and then annualised, matching real PAYE behaviour closely.</p>
</details>
<details>
<summary>Do you support Scottish Income Tax?</summary>
<p>Yes. Selecting Scotland applies the 2024/25 six-band structure (Starter, Basic, Intermediate, Higher, Advanced, Top).</p>
</details>
<details>
<summary>Can I simulate salary sacrifice vs net pay pension?</summary>
<p>Yes. Choose a pension rate and method. Salary Sacrifice reduces both tax and NI; Net Pay reduces tax only; Relief at Source is taken from net pay and your provider claims basic-rate relief.</p>
</details>
<details>
<summary>Which student loan plans are included?</summary>
<p>Plans 1, 2, 4 and 5 at 9% above their thresholds, plus Postgraduate Loan at 6% above £21,000 (2024/25).</p>
</details>
<details>
<summary>Are the results advice?</summary>
<p>No. Results are estimates for guidance only. For personal advice, consult a qualified tax professional.</p>
</details>
<div class="author-box">
<p>Strumento sviluppato da <strong>Ugo Candido</strong>. Contenuti verificati da <strong>CalcDomain Editorial Board</strong>. Ultima revisione per l'accuratezza in data: <time id="revDate"></time>.</p>
</div>
</article>
</div>
</div>
</main>
<!-- Standard Footer --> 
<script defer="">
    (function(){
      'use strict';

      const $ = s => document.querySelector(s);
      const $$ = s => Array.from(document.querySelectorAll(s));

      const els = {
        salary: $('#salaryInput'),
        salaryLabel: $('#salaryLabel'),
        salaryError: $('#salaryError'),
        salaryTipBtn: $('#salaryTipBtn'),
        salaryTip: $('#salaryTip'),
        region: $$('input[name="region"]'),
        frequency: $$('input[name="frequency"]'),
        taxCode: $('#taxCode'),
        taxCodeHelp: $('#taxCodeHelp'),
        taxCodeTipBtn: $('#taxCodeTipBtn'),
        taxCodeTip: $('#taxCodeTip'),
        taxYear: $('#taxYear'),
        pensionPercent: $('#pensionPercent'),
        pensionMethod: $('#pensionMethod'),
        pensionError: $('#pensionError'),
        pensionTipBtn: $('#pensionTipBtn'),
        pensionTip: $('#pensionTip'),
        loanPlan: $('#loanPlan'),
        pgl: $('#pgl'),
        calcBtn: $('#calcBtn'),
        // results
        netAnnual: $('#netAnnual'),
        netMonthly: $('#netMonthly'),
        netWeekly: $('#netWeekly'),
        incomeTax: $('#incomeTax'),
        ni: $('#ni'),
        studentLoan: $('#studentLoan'),
        pglOut: $('#pglOut'),
        pensionOut: $('#pensionOut'),
        effRate: $('#effRate'),
        bands: $('#bandBreakdown'),
        revDate: $('#revDate'),
        year: $('#year')
      };

      // Set dates
      const now = new Date();
      els.revDate.textContent = now.toLocaleDateString('en-GB', {year:'numeric', month:'long', day:'numeric'});
      els.year.textContent = now.getFullYear();

      // Accessible tooltips toggle
      function toggleTooltip(btn, panel){
        const open = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!open));
        if (!open) { panel.hidden = false; panel.focus?.(); }
        else { panel.hidden = true; }
      }
      els.salaryTipBtn.addEventListener('click', () => toggleTooltip(els.salaryTipBtn, els.salaryTip));
      els.taxCodeTipBtn.addEventListener('click', () => toggleTooltip(els.taxCodeTipBtn, els.taxCodeTip));
      els.pensionTipBtn.addEventListener('click', () => toggleTooltip(els.pensionTipBtn, els.pensionTip));

      // Update salary label by frequency
      function updateSalaryLabel(){
        const freq = getFrequency();
        const map = {annual:'Annual', monthly:'Monthly', weekly:'Weekly'};
        els.salaryLabel.textContent = `Gross salary (${map[freq]}) *`;
      }
      $$('#freqGroup input[type=radio]').forEach(r => r.addEventListener('change', () => { updateSalaryLabel(); computeAndRender(); }));

      // Validation
      function validateSalary(){
        const v = parseFloat(els.salary.value);
        if (isNaN(v) || v <= 0){
          setInvalid(els.salary, els.salaryError, 'Please enter a positive amount.');
          return false;
        }
        if (v > 10000000){
          setInvalid(els.salary, els.salaryError, 'Amount is unusually high. Please check and try again.');
          return false;
        }
        setValid(els.salary, els.salaryError);
        return true;
      }
      function validatePension(){
        const pct = parseFloat(els.pensionPercent.value);
        const method = els.pensionMethod.value;
        if (!els.pensionPercent.value){
          setValid(els.pensionPercent, els.pensionError);
          return true;
        }
        if (isNaN(pct) || pct < 0 || pct > 100){
          setInvalid(els.pensionPercent, els.pensionError, 'Enter a percentage between 0 and 100.');
          return false;
        }
        if (pct === 0 && method !== 'none'){
          setInvalid(els.pensionPercent, els.pensionError, 'Set a percentage greater than 0 or choose "No pension".');
          return false;
        }
        setValid(els.pensionPercent, els.pensionError);
        return true;
      }
      function validateTaxCode(){
        const code = (els.taxCode.value || '').toUpperCase().trim();
        els.taxCode.value = code;
        // Allow empty -> defaults handled; else basic pattern
        const ok = /^([SC])?(K)?(\d{3,4}[LMN]?)$|^(BR|0T|D0|D1|NT)$/.test(code) || code === '' || /^(\d{3,4}[A-Z]?)$/.test(code);
        if (!ok){
          setInvalid(els.taxCode, els.taxCodeHelp, 'Unrecognised code. Supported: numeric like 1257L, BR, 0T, D0, D1, NT.');
          return false;
        }
        setValid(els.taxCode, els.taxCodeHelp);
        return true;
      }
      function setInvalid(input, msgEl, text){
        input.setAttribute('aria-invalid','true');
        msgEl.textContent = text;
      }
      function setValid(input, msgEl){
        input.removeAttribute('aria-invalid');
        msgEl.textContent = '';
      }

      els.salary.addEventListener('blur', () => { validateSalary(); });
      els.pensionPercent.addEventListener('blur', () => { validatePension(); });
      els.taxCode.addEventListener('blur', () => { validateTaxCode(); });

      // Helpers
      const fmtGBP = v => new Intl.NumberFormat('en-GB', {style:'currency', currency:'GBP', maximumFractionDigits:2}).format(v);
      const fmtPC = v => `${(v*100).toFixed(1)}%`;

      function getFrequency(){
        const el = els.frequency.find(r => r.checked);
        return el ? el.value : 'annual';
      }
      function periodsPerYear(freq){
        return freq === 'weekly' ? 52 : (freq === 'monthly' ? 12 : 1);
      }
      function getRegion(){
        const el = els.region.find(r => r.checked);
        return el ? el.value : 'rUK';
      }

      // Data (2024/25 defaults)
      const DATA = {
        taxBands: {
          'rUK': [
            {limit: 37700, rate: 0.20, label: 'Basic 20%'},
            {limit: 125140, rate: 0.40, overLabel: 'Higher 40%'},
            {limit: Infinity, rate: 0.45, overLabel: 'Additional 45%'}
          ],
          'Scotland': [
            {limit: 2306, rate: 0.19, label: 'Starter 19%'},
            {limit: 13991, rate: 0.20, label: 'Basic 20%'},
            {limit: 31092, rate: 0.21, label: 'Intermediate 21%'},
            {limit: 62430, rate: 0.42, label: 'Higher 42%'},
            {limit: 125140, rate: 0.45, label: 'Advanced 45%'},
            {limit: Infinity, rate: 0.48, overLabel: 'Top 48%'}
          ]
        },
        personalAllowanceStd: 12570,
        allowanceTaperStart: 100000,
        ni: {
          annual: {PT: 12570, UEL: 50270},
          monthly: {PT: 1048, UEL: 4189},
          weekly: {PT: 242, UEL: 967},
          main: 0.08, // 8%
          addl: 0.02 // 2%
        },
        studentLoan: {
          plan1: {threshold: 24990, rate: 0.09},
          plan2: {threshold: 27295, rate: 0.09},
          plan4: {threshold: 31395, rate: 0.09},
          plan5: {threshold: 25000, rate: 0.09},
          pgl: {threshold: 21000, rate: 0.06}
        }
      };

      // 2023/24 for reference (simplified; rUK unchanged bands; NI rates differ historically but we reuse main 12/2? For safety, keep 2024/25 NI to avoid misstatement. We document this in FAQ.)
      const DATA_2023 = {
        taxBands: {
          'rUK': [
            {limit: 37700, rate: 0.20, label: 'Basic 20%'},
            {limit: 125140, rate: 0.40, overLabel: 'Higher 40%'},
            {limit: Infinity, rate: 0.45, overLabel: 'Additional 45%'}
          ],
          'Scotland': [
            {limit: 2162, rate: 0.19, label: 'Starter 19%'},
            {limit: 13118, rate: 0.20, label: 'Basic 20%'},
            {limit: 31292, rate: 0.21, label: 'Intermediate 21%'},
            {limit: 125140, rate: 0.42, label: 'Higher 42%'},
            {limit: Infinity, rate: 0.47, overLabel: 'Top 47%'}
          ]
        },
        personalAllowanceStd: 12570,
        allowanceTaperStart: 100000,
        ni: {
          annual: {PT: 12570, UEL: 50270},
          monthly: {PT: 1048, UEL: 4189},
          weekly: {PT: 242, UEL: 967},
          main: 0.12, // historical main rate; if uncertain, consider this an estimate
          addl: 0.02
        },
        studentLoan: {
          plan1: {threshold: 22015, rate: 0.09},
          plan2: {threshold: 27295, rate: 0.09},
          plan4: {threshold: 27660, rate: 0.09},
          plan5: {threshold: 25000, rate: 0.09},
          pgl: {threshold: 21000, rate: 0.06}
        }
      };

      function pickYear(){
        return els.taxYear.value === '2023' ? DATA_2023 : DATA;
      }

      function parseTaxCode(code, region){
        const clean = (code || '').toUpperCase().trim();
        const res = { special: null, allowance: null, scotlandPrefix: false };
        if (!clean){
          // Default to standard 1257L if none provided
          res.allowance = pickYear().personalAllowanceStd;
          return res;
        }
        if (/^S/.test(clean)) res.scotlandPrefix = true;
        if (/(BR|0T|D0|D1|NT)$/.test(clean)){
          res.special = clean.match(/(BR|0T|D0|D1|NT)$/)[1];
          res.allowance = res.special === '0T' ? 0 : (res.special === 'NT' ? pickYear().personalAllowanceStd : 0);
          return res;
        }
        // Numeric forms e.g., 1257L, 1100, 647L, etc.
        const m = clean.match(/(\d{3,4})/);
        if (m){
          res.allowance = parseInt(m[1], 10) * 10;
          return res;
        }
        // Fallback
        res.allowance = pickYear().personalAllowanceStd;
        return res;
      }

      function computeTax(taxable, region, bands){
        let remaining = Math.max(0, taxable);
        let paid = 0;
        const details = [];
        let lower = 0;
        for (let i=0;i<bands.length;i++){
          const b = bands[i];
          const upper = b.limit === Infinity ? Infinity : b.limit;
          const width = (upper === Infinity) ? remaining : Math.max(0, Math.min(remaining, upper - lower));
          if (width > 0){
            const rate = b.rate;
            const t = width * rate;
            paid += t;
            details.push(`${b.label || (b.overLabel || `Band ${i+1}`)}: ${fmtGBP(width)} × ${(rate*100).toFixed(0)}% = ${fmtGBP(t)}`);
            remaining -= width;
          }
          lower = upper;
          if (remaining <= 0) break;
        }
        return {paid, details};
      }

      function computeNI(annualEarnings, freq, yearData){
        const periods = periodsPerYear(freq);
        const per = annualEarnings / periods;
        const th = yearData.ni[freq];
        const mainR = yearData.ni.main;
        const addR = yearData.ni.addl;
        const mainBase = Math.max(0, Math.min(per, th.UEL) - th.PT);
        const addBase = Math.max(0, per - th.UEL);
        const perNI = mainBase * mainR + addBase * addR;
        return perNI * periods;
      }

      function computeStudentLoan(annual, plan, pgl, yearData){
        let sl = 0, pglAmt = 0;
        if (plan && plan !== 'none'){
          const d = yearData.studentLoan[plan];
          if (d) sl = Math.max(0, annual - d.threshold) * d.rate;
        }
        if (pgl){
          const d = yearData.studentLoan.pgl;
          pglAmt = Math.max(0, annual - d.threshold) * d.rate;
        }
        return {sl, pgl: pglAmt};
      }

      function compute(){
        const yearData = pickYear();
        const freq = getFrequency();
        const region = getRegion();
        const salaryOk = validateSalary();
        const penOk = validatePension();
        const codeOk = validateTaxCode();
        if (!salaryOk || !penOk || !codeOk){
          return null;
        }

        const per = periodsPerYear(freq);
        const inputPay = parseFloat(els.salary.value);
        const annualGross = freq === 'annual' ? inputPay : (freq === 'monthly' ? inputPay * 12 : inputPay * 52);

        const pRate = parseFloat(els.pensionPercent.value || '0') / 100;
        const pMethod = els.pensionMethod.value;
        const pensionGross = annualGross * pRate;

        // Determine earnings bases for tax/NI/SL
        let grossForTax = annualGross;
        let grossForNI = annualGross;
        let grossForSL = annualGross;
        let netPensionDeduction = 0; // from take-home (Relief at Source only)

        if (pMethod === 'salary_sacrifice'){
          grossForTax -= pensionGross;
          grossForNI -= pensionGross;
          grossForSL -= pensionGross;
        } else if (pMethod === 'net_pay'){
          grossForTax -= pensionGross; // NI and SL unchanged
        } else if (pMethod === 'relief_source'){
          netPensionDeduction = pensionGross * 0.8; // you pay 80%, provider adds 20%
        }

        // Personal allowance via tax code and taper
        const tc = parseTaxCode(els.taxCode.value, region);
        // If code forces Scotland via prefix 'S', honour it
        const effRegion = tc.scotlandPrefix ? 'Scotland' : region;
        let PA = (tc.allowance != null) ? tc.allowance : yearData.personalAllowanceStd;
        const ANI = grossForTax; // adjusted net income aligning with pension method
        if (tc.special !== 'NT'){ // NT: no tax regardless bands; PA not needed
          if (ANI > yearData.allowanceTaperStart){
            const reduction = Math.floor((ANI - yearData.allowanceTaperStart) / 2);
            PA = Math.max(0, PA - reduction);
          }
        }

        // Taxable income and special code handling
        let taxable = Math.max(0, grossForTax - PA);
        let taxPaid = 0;
        let breakdown = [];

        if (tc.special === 'NT'){
          taxPaid = 0;
          breakdown.push('Tax code NT: no tax due.');
        } else if (tc.special === 'BR'){
          const basicRate = effRegion === 'Scotland' ? 0.20 : 0.20;
          taxPaid = annualGross * basicRate;
          breakdown.push(`BR code: All income at ${(basicRate*100).toFixed(0)}% = ${fmtGBP(taxPaid)}`);
        } else if (tc.special === 'D0'){
          const rate = effRegion === 'Scotland' ? 0.42 : 0.40;
          taxPaid = annualGross * rate;
          breakdown.push(`D0 code: All income at ${(rate*100).toFixed(0)}% = ${fmtGBP(taxPaid)}`);
        } else if (tc.special === 'D1'){
          const rate = effRegion === 'Scotland' ? 0.48 : 0.45;
          taxPaid = annualGross * rate;
          breakdown.push(`D1 code: All income at ${(rate*100).toFixed(0)}% = ${fmtGBP(taxPaid)}`);
        } else {
          const bands = yearData.taxBands[effRegion];
          const taxRes = computeTax(taxable, effRegion, bands);
          taxPaid = taxRes.paid;
          breakdown = taxRes.details;
          if (PA > 0) breakdown.unshift(`Personal Allowance applied: ${fmtGBP(PA)}`);
        }

        // National Insurance (per period)
        const niAnnual = computeNI(grossForNI, freq, yearData);

        // Student loan
        const plan = els.loanPlan.value;
        const loans = computeStudentLoan(grossForSL, plan, els.pgl.checked, yearData);

        // Take-home
        const preTaxCashPay =
          (pMethod === 'salary_sacrifice') ? (annualGross - pensionGross) :
          (pMethod === 'net_pay') ? (annualGross - pensionGross) :
          annualGross;

        const netAnnual = preTaxCashPay - taxPaid - niAnnual - loans.sl - loans.pgl - netPensionDeduction;

        // Effective deduction rate excludes pension amounts (shows tax/ni/sl/pgl burden)
        const effectiveRate = (annualGross > 0) ? ((taxPaid + niAnnual + loans.sl + loans.pgl) / annualGross) : 0;

        return {
          annualGross,
          netAnnual,
          netMonthly: netAnnual / 12,
          netWeekly: netAnnual / 52,
          taxPaid,
          niAnnual,
          studentLoan: loans.sl,
          pgl: loans.pgl,
          pensionGross,
          netPensionDeduction,
          effectiveRate,
          breakdown
        };
      }

      function render(res){
        if (!res){
          // Reset
          els.netAnnual.textContent = '—';
          els.netMonthly.textContent = '—';
          els.netWeekly.textContent = '—';
          els.incomeTax.textContent = '—';
          els.ni.textContent = '—';
          els.studentLoan.textContent = '—';
          els.pglOut.textContent = '—';
          els.pensionOut.textContent = '—';
          els.effRate.textContent = '—';
          els.bands.textContent = '—';
          return;
        }
        els.netAnnual.textContent = fmtGBP(res.netAnnual);
        els.netMonthly.textContent = fmtGBP(res.netMonthly);
        els.netWeekly.textContent = fmtGBP(res.netWeekly);
        els.incomeTax.textContent = fmtGBP(res.taxPaid);
        els.ni.textContent = fmtGBP(res.niAnnual);
        els.studentLoan.textContent = fmtGBP(res.studentLoan);
        els.pglOut.textContent = fmtGBP(res.pgl);
        els.pensionOut.textContent = fmtGBP(res.pensionGross) + (els.pensionMethod.value === 'relief_source' && res.pensionGross > 0 ? ` (you pay ${fmtGBP(res.netPensionDeduction)})` : '');
        els.effRate.textContent = fmtPC(res.effectiveRate);
        els.bands.innerHTML = res.breakdown.length ? `<ul>${res.breakdown.map(x=>`<li>${x}</li>`).join('')}</ul>` : '—';
      }

      let debounce;
      function computeAndRender(){
        clearTimeout(debounce);
        debounce = setTimeout(() => { render(compute()); }, 60);
      }

      // Bind inputs
      [
        els.salary, els.taxCode, els.taxYear, els.pensionPercent, els.pensionMethod,
        els.loanPlan, els.pgl, ...els.region, ...els.frequency
      ].forEach(el => el.addEventListener('input', computeAndRender));
      els.calcBtn.addEventListener('click', computeAndRender);

      // Initial
      updateSalaryLabel();
      computeAndRender();

      // Improve mobile number inputs UX
      ['wheel','keydown'].forEach(evt=>{
        [els.salary, els.pensionPercent].forEach(inp=>{
          inp.addEventListener(evt, e => {
            if (evt === 'wheel') e.preventDefault();
            if (evt === 'keydown' && ['ArrowUp','ArrowDown'].includes(e.key)) e.preventDefault();
          }, {passive:false});
        });
      });
    })();
  </script>

<script defer src="/assets/js/mobile-menu.js"></script>
<script defer src="/assets/js/page-enhancements.js"></script>
</body></html>