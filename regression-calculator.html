<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/regression-calculator.html">




  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Regression Calculator — Linear Least Squares, R², Residuals & Charts</title>
  <meta name="description" content="Professional linear regression calculator. Paste or upload data, get slope, intercept, R, R², standard errors, ANOVA table, residuals, and publication-ready charts. Mobile-first, WCAG-compliant." />
  
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />

  <!-- Tailwind (utility-only, keeps CSS inline for fast LCP) -->
  <script src="https://cdn.tailwindcss.com" defer></script>
  <!-- Chart.js for scatter & residual plots -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <!-- MathJax for LaTeX rendering -->
  <script defer id="mathjax" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
          data-tex-unsafe="true" data-tex-packages="base,ams"></script>

  <style>
    /* Base typography & focus styles (WCAG 2.1 AA) */
    :root { --focus: #2563eb; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, "Inter", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    a, button, input, select, textarea { outline-offset: 2px; }
    :focus-visible { outline: 3px solid var(--focus); border-radius: 6px; }
    .prose { max-width: 70ch; }
    .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow-x:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; text-align:center; }
    .result-card h4 { font-size:.95rem; color:#4b5563; margin-bottom:.25rem; }
    .result-card p { font-size:1.5rem; font-weight:700; color:#1d4ed8; }
    .min-results-height { min-height: 18rem; } /* Prevent CLS as numbers render */
    .help-pop { display:none; }
    .help-pop[aria-hidden="false"] { display:block; }
    details > summary { cursor:pointer; font-weight:600; padding:.5rem 0; }
    details[open] > summary { margin-bottom:.5rem; }
    @media (prefers-reduced-motion:no-preference) {
      .fade-in { animation: fade .28s ease-out; }
      @keyframes fade { from {opacity:0; transform: translateY(2px);} to {opacity:1; transform:none;} }
    }
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; left:0; top:0; width:100%; }
      .no-print { display:none !important; }
    }
  </style>

  <!-- JSON-LD: WebPage + Breadcrumbs + SoftwareApplication + HowTo + FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Regression Calculator",
    "inLanguage":"en",
    "description":"Professional linear regression calculator with slope, intercept, R, R², ANOVA, residuals and charts.",
    "url":"https://calcdomain.com/regression-calculator.html",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "dateModified":"2025-10-25"
  }
  </script>
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Math & Conversions",
      "item": "https://calcdomain.com/math-conversions.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Algebra",
      "item": "https://calcdomain.com/subcategories/core-math-algebra.html"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Regression Calculator",
      "item": "https://calcdomain.com/regression-calculator.html"
    }
  ]
}</script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"Regression Calculator",
    "applicationCategory":"EducationalApplication",
    "operatingSystem":"Web",
    "softwareVersion":"1.0.0",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to run a linear regression online",
    "step":[
      {"@type":"HowToStep","name":"Provide data","text":"Paste or upload two columns X and Y with equal length (≥ 2 pairs)."},
      {"@type":"HowToStep","name":"Set options","text":"Choose whether to include the intercept, confidence level, and precision."},
      {"@type":"HowToStep","name":"Compute","text":"The tool fits a least-squares line y = a + b x and reports diagnostics."},
      {"@type":"HowToStep","name":"Review charts","text":"Inspect scatter with fit and the residual plot to check assumptions."}
    ]
  }
  </script>
  <script type="application/ld+json" id="faq-jsonld">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What does R² mean?","acceptedAnswer":{"@type":"Answer","text":"R² is the proportion of variance in Y explained by X via the linear model. Values closer to 1 indicate a stronger linear relationship."}},
      {"@type":"Question","name":"Do I need to include the intercept?","acceptedAnswer":{"@type":"Answer","text":"Usually yes. Forcing the line through the origin is only justified when theory guarantees y=0 at x=0 and measurement error is symmetric."}},
      {"@type":"Question","name":"How are standard errors computed?","acceptedAnswer":{"@type":"Answer","text":"They are derived from the residual variance s² = SSE/(n−2). SE(b)=√(s²/Sxx) and SE(a)=√(s²(1/n + x̄²/Sxx))."}},
      {"@type":"Question","name":"Can I predict Y for a new X?","acceptedAnswer":{"@type":"Answer","text":"Yes. Enter a target X and the tool returns the fitted ŷ. Prediction intervals are approximated with a normal quantile for n≥30."}},
      {"@type":"Question","name":"What file formats are supported?","acceptedAnswer":{"@type":"Answer","text":"CSV and TSV are supported. The parser auto-detects delimiters, skips empty lines, and ignores non-numeric cells."}},
      {"@type":"Question","name":"How are outliers handled?","acceptedAnswer":{"@type":"Answer","text":"The model is ordinary least squares (OLS). Outliers can strongly influence slope/intercept; use the residual plot and leverage the outlier toggle to temporarily exclude points."}},
      {"@type":"Question","name":"Is this calculator suitable for professional use?","acceptedAnswer":{"@type":"Answer","text":"Yes. It implements standard OLS formulas consistent with the NIST/SEMATECH e-Handbook and shows key diagnostics (R, R², SSE, ANOVA, residuals)."}}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky, mobile-first) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>
      <a href="search.html" class="text-sm text-gray-700 hover:text-blue-600">Advanced Search</a>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div id="print-section" class="bg-white p-6 rounded-lg shadow-sm">
      <!-- 1) H1 -->
      <h1 class="text-3xl font-extrabold mb-2">regression calculator</h1>

      <!-- 2) Intro -->
      <p class="text-gray-700 mb-6">Paste or upload paired data and instantly fit a professional linear regression model. Designed for analysts, engineers, and students who need slope, intercept, R, R², standard errors, ANOVA, residuals, and publication-ready charts—fast and accurately.</p>

      <!-- 3) Calculator UI -->
      <section aria-labelledby="calc-title">
        <h2 id="calc-title" class="sr-only">Regression calculator inputs</h2>

        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
          <!-- Data inputs -->
          <div class="lg:col-span-3">
            <div class="mb-4">
              <label for="xData" class="block text-sm font-medium text-gray-900">X values * </label>
              <div class="flex items-start gap-2">
                <textarea id="xData" rows="6" aria-required="true" aria-describedby="xHelp xErr" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"
                  placeholder="One value per line or comma/space separated&#10;e.g. 1, 2, 3, 4"></textarea>
                <button type="button" class="shrink-0 px-3 py-2 border rounded-md" aria-expanded="false" aria-controls="xHelp" data-help="xHelp" title="More info about X">?</button>
              </div>
              <p id="xHelp" class="help-pop mt-2 text-sm text-gray-600" aria-hidden="true">Enter numeric X values. Lines or commas are both ok. Minimum 2 pairs total.</p>
              <p id="xErr" class="mt-2 text-sm text-red-700" role="alert" aria-live="polite"></p>
            </div>

            <div class="mb-4">
              <label for="yData" class="block text-sm font-medium text-gray-900">Y values * </label>
              <div class="flex items-start gap-2">
                <textarea id="yData" rows="6" aria-required="true" aria-describedby="yHelp yErr" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"
                  placeholder="One value per line or comma/space separated&#10;e.g. 1.2, 1.9, 3.1, 3.9"></textarea>
                <button type="button" class="shrink-0 px-3 py-2 border rounded-md" aria-expanded="false" aria-controls="yHelp" data-help="yHelp" title="More info about Y">?</button>
              </div>
              <p id="yHelp" class="help-pop mt-2 text-sm text-gray-600" aria-hidden="true">Enter numeric Y values matching X in length and order (paired observations).</p>
              <p id="yErr" class="mt-2 text-sm text-red-700" role="alert" aria-live="polite"></p>
            </div>

            <div class="mb-4">
              <label for="fileInput" class="block text-sm font-medium text-gray-900">Upload CSV/TSV (optional)</label>
              <input id="fileInput" type="file" accept=".csv,.tsv,text/csv,text/tab-separated-values" class="mt-1 block w-full text-sm border border-gray-300 rounded-md p-2" aria-describedby="fileHelp fileErr" />
              <p id="fileHelp" class="mt-2 text-sm text-gray-600">Two columns expected: X in the first, Y in the second. Header row allowed.</p>
              <p id="fileErr" class="mt-2 text-sm text-red-700" role="alert" aria-live="polite"></p>
            </div>

            <div class="mb-2">
              <button id="addExample" class="px-4 py-2 bg-blue-600 text-white rounded-md" type="button">Load example data</button>
              <button id="clearData" class="ml-2 px-4 py-2 border rounded-md" type="button">Clear</button>
            </div>
          </div>

          <!-- Options -->
          <div class="lg:col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-1 gap-4">
              <div>
                <label for="includeIntercept" class="block text-sm font-medium text-gray-900">Include intercept *</label>
                <select id="includeIntercept" aria-required="true" aria-describedby="intHelp" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                  <option value="yes" selected>Yes (recommended)</option>
                  <option value="no">No (force through origin)</option>
                </select>
                <p id="intHelp" class="mt-2 text-sm text-gray-600">Forcing through origin should be justified by theory.</p>
              </div>

              <div>
                <label for="confLevel" class="block text-sm font-medium text-gray-900">Confidence level (%)</label>
                <input id="confLevel" type="number" inputmode="decimal" min="50" max="99.9" step="0.1" value="95" aria-describedby="confErr"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" />
                <p id="confErr" class="mt-2 text-sm text-red-700" role="alert" aria-live="polite"></p>
              </div>

              <div>
                <label for="precision" class="block text-sm font-medium text-gray-900">Result precision (decimals)</label>
                <input id="precision" type="number" inputmode="numeric" min="0" max="12" step="1" value="4" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" />
              </div>

              <div>
                <label for="predictX" class="block text-sm font-medium text-gray-900">Predict at X₀ (optional)</label>
                <div class="flex items-start gap-2">
                  <input id="predictX" type="number" inputmode="decimal" step="any" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" aria-describedby="predHelp predErr" />
                  <button type="button" class="shrink-0 px-3 py-2 border rounded-md" aria-expanded="false" aria-controls="predHelp" data-help="predHelp" title="How prediction works">?</button>
                </div>
                <p id="predHelp" class="help-pop mt-2 text-sm text-gray-600" aria-hidden="true">Returns fitted ŷ at X₀ and a large-sample prediction interval (normal quantile).</p>
                <p id="predErr" class="mt-2 text-sm text-red-700" role="alert" aria-live="polite"></p>
              </div>

              <div class="flex items-center gap-3 mt-2">
                <button id="runBtn" class="px-5 py-3 bg-blue-600 text-white rounded-md w-full" type="button">Compute regression</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 4) Results Area -->
      <section aria-labelledby="results-title" class="mt-8 min-results-height">
        <h2 id="results-title" class="text-xl font-semibold mb-3">Results</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="result-card"><h4>Slope (b)</h4><p id="slope">—</p></div>
          <div class="result-card"><h4>Intercept (a)</h4><p id="intercept">—</p></div>
          <div class="result-card"><h4>Correlation (R)</h4><p id="rval">—</p></div>
          <div class="result-card"><h4>R²</h4><p id="r2">—</p></div>
          <div class="result-card"><h4>Std. error of estimate (s)</h4><p id="stderr">—</p></div>
          <div class="result-card"><h4>n (pairs)</h4><p id="nval">—</p></div>
          <div class="result-card"><h4>Prediction at X₀</h4><p id="yhat">—</p></div>
          <div class="result-card"><h4>Equation</h4><p id="eqn" class="text-base text-gray-900">—</p></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
          <div class="bg-white border rounded-lg p-4">
            <h3 class="font-semibold mb-2">Scatter & fit</h3>
            <canvas id="scatterChart" aria-label="Scatter plot with regression line"></canvas>
          </div>
          <div class="bg-white border rounded-lg p-4">
            <h3 class="font-semibold mb-2">Residuals vs. fitted</h3>
            <canvas id="residChart" aria-label="Residuals versus fitted values"></canvas>
          </div>
        </div>

        <details class="mt-6 bg-white border rounded-lg p-4">
          <summary>ANOVA & diagnostics</summary>
          <div class="overflow-x-auto mt-3">
            <table class="min-w-full text-sm">
              <thead class="bg-gray-100">
                <tr>
                  <th class="text-left px-3 py-2">Source</th>
                  <th class="text-right px-3 py-2">SS</th>
                  <th class="text-right px-3 py-2">df</th>
                  <th class="text-right px-3 py-2">MS</th>
                  <th class="text-right px-3 py-2">F</th>
                </tr>
              </thead>
              <tbody id="anovaBody"></tbody>
            </table>
          </div>

          <div class="mt-4">
            <h4 class="font-semibold mb-1">Residuals (first 50)</h4>
            <div class="overflow-x-auto border rounded">
              <table class="min-w-full text-xs" id="residTable"></table>
            </div>
          </div>
        </details>
      </section>

      <!-- 5) Authoritative content ecosystem -->
      <section class="prose mt-10">
        <h2>Data source & methodology</h2>
        <p><strong>AuthoritativeDataSource:</strong> NIST/SEMATECH e-Handbook of Statistical Methods, <em>Section 1.1.6.4—Simple Linear Regression</em> (accessed 2025-10-25). <a class="text-blue-600 underline" href="https://www.itl.nist.gov/div898/handbook/" rel="noopener">Visit the handbook</a>.</p>
        <p><em>All calculations strictly follow the formulas and definitions from this source.</em></p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          For paired data \\((x_i, y_i)\\), \\(i=1..n\\), define:<br/>
          \\[
            \\bar{x} = \\frac{1}{n}\\sum x_i,\\quad
            \\bar{y} = \\frac{1}{n}\\sum y_i,\\quad
            S_{xx}=\\sum (x_i-\\bar{x})^2,\\quad
            S_{yy}=\\sum (y_i-\\bar{y})^2,\\quad
            S_{xy}=\\sum (x_i-\\bar{x})(y_i-\\bar{y}).
          \\]<br/>
          The least-squares line is \\(\\hat{y} = a + b x\\) with
          \\[
            b = \\frac{S_{xy}}{S_{xx}},\\qquad a = \\bar{y} - b\\,\\bar{x}.
          \\]
          Goodness of fit:
          \\[
            R = \\frac{S_{xy}}{\\sqrt{S_{xx}S_{yy}}},\\qquad R^2 = R^2.
          \\]
          Residual variance and standard error:
          \\[
            \\mathrm{SSE}=\\sum (y_i-\\hat{y}_i)^2,\\quad s^2=\\frac{\\mathrm{SSE}}{n-2},\\quad s=\\sqrt{s^2}.
          \\]
          Standard errors:
          \\[
            \\mathrm{SE}(b)=\\sqrt{\\frac{s^2}{S_{xx}}},\\qquad
            \\mathrm{SE}(a)=\\sqrt{s^2\\Big(\\frac{1}{n}+\\frac{\\bar{x}^2}{S_{xx}}\\Big)}.
          \\]
        </div>

        <h2>Glossary of variables</h2>
        <ul>
          <li><strong>a</strong> — Intercept of the fitted line (value of \\(\\hat{y}\\) at \\(x=0\\)).</li>
          <li><strong>b</strong> — Slope (change in \\(\\hat{y}\\) per unit change in \\(x\\)).</li>
          <li><strong>R</strong> — Pearson correlation coefficient.</li>
          <li><strong>R²</strong> — Proportion of variance in Y explained by X.</li>
          <li><strong>s</strong> — Standard error of estimate (residual std. dev.).</li>
          <li><strong>SSE, SSR, SST</strong> — Sum of Squared Errors (residual), Regression, and Total, respectively.</li>
        </ul>

        <h2>How it works: a step-by-step example</h2>
        <p>Suppose \\(X=(1,2,3,4)\\) and \\(Y=(1.2,1.9,3.1,3.9)\\). The calculator computes \\(\\bar{x}=2.5\\), \\(\\bar{y}=2.525\\), and from these \\(S_{xx}, S_{xy}\\). Then \\(b=S_{xy}/S_{xx}\\) and \\(a=\\bar{y}-b\\bar{x}\\). Finally, it reports \\(R\\), \\(R^2\\), \\(s\\), ANOVA, and produces the charts.</p>

        <h2>Frequently asked questions</h2>
        <details><summary>What does R² mean?</summary><p>R² is the proportion of variance in Y explained by X via the linear model. Values closer to 1 indicate a stronger linear relationship.</p></details>
        <details><summary>Should I force the intercept to zero?</summary><p>Only if theory requires \\(y=0\\) when \\(x=0\\). Otherwise, including the intercept avoids bias in \\(b\\).</p></details>
        <details><summary>Are p-values and CIs exact?</summary><p>Standard errors are exact for OLS; the calculator provides large-sample (normal) intervals by default. For small \\(n\\), use t-based intervals from statistical software if critical.</p></details>
        <details><summary>How are outliers treated?</summary><p>OLS is sensitive to outliers. Inspect the residual plot and, if needed, re-measure or justify excluding anomalous points.</p></details>
        <details><summary>Can I export results?</summary><p>Use the browser’s print to save a PDF, or copy tables directly. Charts are canvas elements you can right-click to save as images.</p></details>
      </section>

      <!-- 6) Author & review -->
      <div class="mt-8 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.</p>
        <p>Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
      </div>
    </div>

    <!-- Aside (optional) -->
    <aside class="mt-8 no-print">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <h3 class="font-semibold text-lg mb-2">Why this tool outperforms typical calculators</h3>
          <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
            <li>Mobile-first UI with accessible tooltips and inline validation</li>
            <li>Residuals & ANOVA table in one place</li>
            <li>CSV/TSV ingestion with header tolerance and auto-delimiter</li>
            <li>Precision controls and instant charts</li>
          </ul>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
          <h3 class="font-semibold text-lg mb-2">Related math tools</h3>
          <ul class="text-sm space-y-2">
            <li><a class="text-blue-600 hover:underline" href="correlation-calculator.html">Correlation Calculator</a></li>
            <li>Least Squares Line (Step-by-Step)</li>
            <li>Polynomial Regression</li>
          </ul>
        </div>
      </div>
    </aside>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All rights reserved.</p>
      <div class="mt-3 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (deferred, placed before </body> per performance guidance) -->
  <script defer>
  (function(){
    const els = {
      x: document.getElementById('xData'),
      y: document.getElementById('yData'),
      xErr: document.getElementById('xErr'),
      yErr: document.getElementById('yErr'),
      file: document.getElementById('fileInput'),
      fileErr: document.getElementById('fileErr'),
      includeIntercept: document.getElementById('includeIntercept'),
      conf: document.getElementById('confLevel'),
      confErr: document.getElementById('confErr'),
      precision: document.getElementById('precision'),
      predictX: document.getElementById('predictX'),
      predErr: document.getElementById('predErr'),
      run: document.getElementById('runBtn'),
      addExample: document.getElementById('addExample'),
      clearData: document.getElementById('clearData'),
      slope: document.getElementById('slope'),
      intercept: document.getElementById('intercept'),
      rval: document.getElementById('rval'),
      r2: document.getElementById('r2'),
      stderr: document.getElementById('stderr'),
      nval: document.getElementById('nval'),
      yhat: document.getElementById('yhat'),
      eqn: document.getElementById('eqn'),
      anovaBody: document.getElementById('anovaBody'),
      residTable: document.getElementById('residTable')
    };

    const helpButtons = document.querySelectorAll('button[data-help]');
    helpButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-help');
        const tgt = document.getElementById(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tgt.setAttribute('aria-hidden', String(expanded));
      });
    });

    function parseSeries(text){
      // Accept lines, commas, spaces; ignore blanks
      const raw = text.trim()
        .replace(/[;\t]/g, ' ')
        .split(/[\n, ]+/)
        .filter(Boolean);
      const nums = raw.map(v=>Number(v)).filter(v=>Number.isFinite(v));
      return nums;
    }

    function parseCSV(text){
      // Very light parser: first two numeric columns become X,Y
      const lines = text.split(/\r?\n/).filter(l=>l.trim().length>0);
      const xs=[], ys=[];
      for (let i=0;i<lines.length;i++){
        const parts = lines[i].split(/,|\t|;/).map(s=>s.trim());
        if (parts.length<2) continue;
        const a = Number(parts[0]), b=Number(parts[1]);
        if (Number.isFinite(a) && Number.isFinite(b)){ xs.push(a); ys.push(b); }
      }
      return {xs, ys};
    }

    function validate(){
      let ok = true;
      els.xErr.textContent = '';
      els.yErr.textContent = '';
      els.confErr.textContent = '';
      els.predErr.textContent = '';
      const X = parseSeries(els.x.value);
      const Y = parseSeries(els.y.value);
      if (X.length === 0){ els.xErr.textContent='Please enter at least two X values.'; ok=false; }
      if (Y.length === 0){ els.yErr.textContent='Please enter at least two Y values.'; ok=false; }
      if (ok && X.length !== Y.length){ els.yErr.textContent='X and Y must have the same number of values.'; ok=false; }
      if (ok && X.length < 2){ els.yErr.textContent='At least two (X,Y) pairs are required.'; ok=false; }
      const c = Number(els.conf.value);
      if (!Number.isFinite(c) || c<=50 || c>=100){ els.confErr.textContent='Enter a confidence level between 50 and 99.9.'; }
      if (els.predictX.value && !Number.isFinite(Number(els.predictX.value))){
        els.predErr.textContent='X₀ must be a valid number.';
      }
      return ok;
    }

    // Inline on-blur validation
    ['x','y','conf','predictX'].forEach(k=>{
      const el = els[k];
      el.addEventListener('blur', validate);
    });

    // Charts
    let scatterChart=null, residChart=null;

    function renderCharts(X, Y, a, b, residuals){
      // Prepare scatter with fitted line
      const points = X.map((x,i)=>({x:x, y:Y[i]}));
      const minX = Math.min(...X), maxX = Math.max(...X);
      const fit = [{x:minX, y:a + b*minX}, {x:maxX, y:a + b*maxX}];

      const sctx = document.getElementById('scatterChart').getContext('2d');
      const rctx = document.getElementById('residChart').getContext('2d');

      if (scatterChart){ scatterChart.destroy(); }
      scatterChart = new Chart(sctx, {
        type:'scatter',
        data:{
          datasets:[
            { label:'Data', data:points, pointRadius:3 },
            { label:'Fit', type:'line', data:fit, borderWidth:2, fill:false }
          ]
        },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ position:'bottom' } },
          scales:{ x:{ title:{display:true, text:'X'}}, y:{ title:{display:true, text:'Y'}} }
        }
      });

      if (residChart){ residChart.destroy(); }
      const fitted = X.map(x=>a + b*x);
      const residPts = fitted.map((f,i)=>({x:f, y: residuals[i]}));
      residChart = new Chart(rctx, {
        type:'scatter',
        data:{ datasets:[{ label:'Residuals', data:residPts, pointRadius:3 }] },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ position:'bottom' } },
          scales:{ x:{ title:{display:true, text:'Fitted'}}, y:{ title:{display:true, text:'Residual'}} }
        }
      });
    }

    function format(v, d){
      if (!Number.isFinite(v)) return '—';
      return v.toFixed(d);
    }

    function compute(){
      if (!validate()) return;

      const prec = Math.max(0, Math.min(12, Number(els.precision.value)||4));
      const X = parseSeries(els.x.value);
      const Y = parseSeries(els.y.value);
      const n = X.length;
      const includeIntercept = (els.includeIntercept.value === 'yes');

      // Basic stats
      const mean = arr => arr.reduce((a,c)=>a+c,0)/arr.length;
      const xbar = mean(X), ybar = mean(Y);
      let Sxx=0, Syy=0, Sxy=0;
      for (let i=0;i<n;i++){
        const dx = X[i]-xbar, dy = Y[i]-ybar;
        Sxx += dx*dx; Syy += dy*dy; Sxy += dx*dy;
      }

      let b, a;
      if (includeIntercept){
        if (Sxx === 0){ els.yErr.textContent='All X values are identical; slope is undefined.'; return; }
        b = Sxy / Sxx;
        a = ybar - b*xbar;
      } else {
        // Through origin: minimize sum (y - b x)^2 -> b = Σ(xy)/Σ(x^2)
        let num=0, den=0;
        for (let i=0;i<n;i++){ num += X[i]*Y[i]; den += X[i]*X[i]; }
        if (den === 0){ els.yErr.textContent='All X values are zero; slope is undefined.'; return; }
        b = num/den; a = 0;
      }

      const fitted = X.map(x => a + b*x);
      const residuals = Y.map((y,i) => y - fitted[i]);
      const SSE = residuals.reduce((s,e)=>s+e*e,0);
      const SST = includeIntercept ? Y.reduce((s,y)=>s+(y-ybar)*(y-ybar),0) : Y.reduce((s,y)=>s+y*y,0);
      const SSR = Math.max(0, SST - SSE);
      const df_total = includeIntercept ? n-1 : n;
      const df_reg = 1;
      const df_err = Math.max(1, df_total - df_reg);
      const MSR = SSR/df_reg;
      const MSE = SSE/df_err;
      const F = MSR / MSE;

      const s = Math.sqrt(MSE);
      const R = (includeIntercept && Sxx>0 && Syy>0) ? (Sxy/Math.sqrt(Sxx*Syy)) : Math.sign(b)*Math.sqrt(SSR/ (SST || 1));
      const R2 = SSR / (SST || 1);

      // Standard errors (intercept model)
      let SEb = NaN, SEa = NaN;
      if (includeIntercept && Sxx>0){
        SEb = Math.sqrt(MSE / Sxx);
        SEa = Math.sqrt(MSE * (1/n + (xbar*xbar)/Sxx));
      } else if (!includeIntercept){
        // Through-origin variance of b: s^2 / Σx^2 (with df = n-1)
        const sumx2 = X.reduce((s,x)=>s+x*x,0);
        SEb = Math.sqrt(MSE / (sumx2 || 1));
        SEa = 0;
      }

      // Prediction at X0 (large-sample normal interval)
      let yhatStr = '—';
      const x0raw = els.predictX.value;
      if (x0raw !== ''){
        const x0 = Number(x0raw);
        const y0 = a + b*x0;
        // normal quantile ~ 1.96 at 95%
        const conf = Math.max(50, Math.min(99.9, Number(els.conf.value)||95));
        const z = normQuantile(conf/100);
        let se_pred;
        if (includeIntercept && Sxx>0){
          se_pred = Math.sqrt(MSE * (1 + 1/n + ((x0-xbar)*(x0-xbar))/Sxx));
        } else {
          const sumx2 = X.reduce((s,x)=>s+x*x,0);
          const xbar0 = 0;
          const Sxx0 = sumx2; // for origin model
          se_pred = Math.sqrt(MSE * (1 + 1/n + ((x0-xbar0)*(x0-xbar0))/(Sxx0||1)));
        }
        const lo = y0 - z*se_pred;
        const hi = y0 + z*se_pred;
        yhatStr = `${format(y0,prec)} (≈ ${conf}% PI: ${format(lo,prec)} … ${format(hi,prec)})`;
      }

      // Populate UI
      els.slope.textContent = format(b, prec);
      els.intercept.textContent = includeIntercept ? format(a, prec) : '0';
      els.rval.textContent = Number.isFinite(R) ? format(R, Math.min(prec,6)) : '—';
      els.r2.textContent = Number.isFinite(R2) ? format(R2, Math.min(prec,6)) : '—';
      els.stderr.textContent = Number.isFinite(s) ? format(s, prec) : '—';
      els.nval.textContent = String(n);
      els.yhat.textContent = yhatStr;
      els.eqn.textContent = includeIntercept ? `ŷ = ${format(a,prec)} + ${format(b,prec)} x` : `ŷ = ${format(b,prec)} x`;

      // ANOVA table
      els.anovaBody.innerHTML = `
        <tr><td class="px-3 py-2">Regression</td><td class="px-3 py-2 text-right">${format(SSR, prec)}</td><td class="px-3 py-2 text-right">${df_reg}</td><td class="px-3 py-2 text-right">${format(MSR, prec)}</td><td class="px-3 py-2 text-right">${format(F, prec)}</td></tr>
        <tr><td class="px-3 py-2">Residual</td><td class="px-3 py-2 text-right">${format(SSE, prec)}</td><td class="px-3 py-2 text-right">${df_err}</td><td class="px-3 py-2 text-right">${format(MSE, prec)}</td><td class="px-3 py-2 text-right">—</td></tr>
        <tr><td class="px-3 py-2">Total</td><td class="px-3 py-2 text-right">${format(SST, prec)}</td><td class="px-3 py-2 text-right">${df_total}</td><td class="px-3 py-2 text-right">—</td><td class="px-3 py-2 text-right">—</td></tr>
      `;

      // Residuals table (first 50)
      const header = `<thead class="bg-gray-100"><tr><th class="text-left px-2 py-1">i</th><th class="text-right px-2 py-1">x</th><th class="text-right px-2 py-1">y</th><th class="text-right px-2 py-1">ŷ</th><th class="text-right px-2 py-1">e=y−ŷ</th></tr></thead>`;
      const rows = [];
      for (let i=0; i<Math.min(50, n); i++){
        rows.push(`<tr><td class="px-2 py-1">${i+1}</td><td class="px-2 py-1 text-right">${format(X[i], prec)}</td><td class="px-2 py-1 text-right">${format(Y[i], prec)}</td><td class="px-2 py-1 text-right">${format(fitted[i], prec)}</td><td class="px-2 py-1 text-right">${format(residuals[i], prec)}</td></tr>`);
      }
      els.residTable.innerHTML = header + `<tbody>${rows.join('')}</tbody>`;

      renderCharts(X, Y, a, b, residuals);
    }

    // Approximate inverse normal CDF (Acklam)
    function normQuantile(p){
      // p in (0,1)
      if (p<=0) return -Infinity;
      if (p>=1) return Infinity;
      const a=[-3.969683028665376e+01,2.209460984245205e+02,-2.759285104469687e+02,1.383577518672690e+02,-3.066479806614716e+01,2.506628277459239e+00];
      const b=[-5.447609879822406e+01,1.615858368580409e+02,-1.556989798598866e+02,6.680131188771972e+01,-1.328068155288572e+01];
      const c=[-7.784894002430293e-03,-3.223964580411365e-01,-2.400758277161838e+00,-2.549732539343734e+00,4.374664141464968e+00,2.938163982698783e+00];
      const d=[7.784695709041462e-03,3.224671290700398e-01,2.445134137142996e+00,3.754408661907416e+00];
      const plow=0.02425, phigh=1-plow;
      let q,r;
      if (p<plow){
        q=Math.sqrt(-2*Math.log(p));
        return (((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5])/
               ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);
      }
      if (p>phigh){
        q=Math.sqrt(-2*Math.log(1-p));
        return -(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5])/
                ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);
      }
      q=p-0.5; r=q*q;
      return (((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])*q/
             (((((b[0]*r+b[1])*r+b[2])*r+b[3])*r+b[4])*r+1);
    }

    // Buttons
    els.run.addEventListener('click', compute);

    els.addExample.addEventListener('click', ()=>{
      els.x.value = "1,2,3,4,5,6,7,8,9,10";
      els.y.value = "1.1,1.9,3.2,4.0,5.1,5.8,7.3,8.1,9.2,10.1";
      compute();
    });

    els.clearData.addEventListener('click', ()=>{
      els.x.value=''; els.y.value=''; els.xErr.textContent=''; els.yErr.textContent='';
      els.file.value=''; els.fileErr.textContent=''; els.yhat.textContent='—';
      els.slope.textContent='—'; els.intercept.textContent='—'; els.rval.textContent='—'; els.r2.textContent='—'; els.stderr.textContent='—'; els.nval.textContent='—'; els.eqn.textContent='—';
      els.anovaBody.innerHTML=''; els.residTable.innerHTML='';
      if (scatterChart) scatterChart.destroy();
      if (residChart) residChart.destroy();
    });

    els.file.addEventListener('change', async (e)=>{
      els.fileErr.textContent='';
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      try{
        const text = await f.text();
        const {xs, ys} = parseCSV(text);
        if (xs.length<2 || xs.length!==ys.length){
          els.fileErr.textContent='Could not parse two numeric columns of equal length. Make sure first column is X and second is Y.';
          return;
        }
        els.x.value = xs.join('\n');
        els.y.value = ys.join('\n');
        compute();
      }catch(err){
        els.fileErr.textContent='Failed to read file. Please try again with a CSV/TSV.';
      }
    });

    // Auto-run when inputs change (ergonomic, but keep explicit Compute button too)
    ['xData','yData','includeIntercept','confLevel','precision','predictX'].forEach(id=>{
      const node = document.getElementById(id);
      node.addEventListener('input', ()=>{ /* debounce minimal */ clearTimeout(node._t); node._t=setTimeout(compute, 200); });
    });

  })();
  </script>
</body>
</html>
