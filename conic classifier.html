<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>conic classifier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Classify a general second-degree equation Ax² + Bxy + Cy² + Dx + Ey + F = 0 as ellipse, circle, parabola, hyperbola, or degenerate. Compute rotation angle, center, canonical form, and axes.">
  <link rel="canonical" href="https://calcdomain.com/conic-classifier.html">
  <meta name="author" content="Ugo Candido">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Tailwind (on-demand) -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- MathJax for LaTeX rendering -->
  <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root { --focus:#2563eb; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    /* Prose helpers */
    .prose { max-width: 70ch; }
    .prose h2 { font-weight: 700; font-size: 1.375rem; margin: 1.5rem 0 .75rem; }
    .prose h3 { font-weight: 600; font-size: 1.125rem; margin: 1rem 0 .5rem; }
    .prose p, .prose li { line-height: 1.65; }
    .formula-box{
      background:#f3f4f6;border:1px solid #e5e7eb;border-radius:.75rem;padding:1rem;overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
    /* Focus styles (WCAG 2.1 AA) */
    :is(a,button,input,select,summary,[role="tooltip"],[data-tip]) :focus,
    :is(a,button,input,select,summary,[role="tooltip"],[data-tip"]):focus { outline:3px solid var(--focus); outline-offset:2px; }
    .focus-ring { outline:3px solid var(--focus); outline-offset:2px; }
    /* Results min-height to avoid CLS */
    #results-panel { min-height: 12rem; }
    /* Tooltip popover */
    .tip {
      position: relative; display:inline-flex; align-items:center; justify-content:center;
      width:1.75rem; height:1.75rem; border-radius:9999px; border:1px solid #9ca3af;
      font-weight:700; font-size:.95rem; line-height:1; background:#fff; color:#374151;
    }
    .tip-content {
      position:absolute; z-index:20; top:120%; left:0; right:auto; min-width:16rem;
      background:#111827; color:#f9fafb; border:1px solid #1f2937; border-radius:.5rem;
      box-shadow: 0 10px 20px rgba(0,0,0,.2); padding:.75rem; display:none;
    }
    .tip[aria-expanded="true"] + .tip-content { display:block; }
    /* Table */
    table { border-collapse: separate; border-spacing:0; }
    th, td { border-bottom:1px solid #e5e7eb; }
    th { text-align:left; font-weight:600; }
    /* Print */
    @media print {
      header, footer, aside, .no-print { display:none !important; }
      #print-section { display:block; }
    }
  </style>

  <!-- JSON-LD: WebApplication + Breadcrumbs + HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Conic Classifier",
    "applicationCategory":"Calculator",
    "operatingSystem":"Web",
    "inLanguage":"en",
    "url":"https://calcdomain.com/conic-classifier.html",
    "description":"Classify Ax² + Bxy + Cy² + Dx + Ey + F = 0 and compute angle, center, canonical form, axes.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Analytic Geometry","item":"https://calcdomain.com/subcategories/math-analytic-geometry.html"},
      {"@type":"ListItem","position":4,"name":"Conic Classifier","item":"https://calcdomain.com/conic-classifier.html"}
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to classify a conic from Ax² + Bxy + Cy² + Dx + Ey + F = 0",
    "step":[
      {"@type":"HowToStep","name":"Enter coefficients","text":"Provide A, B, C, D, E, F of the general quadratic."},
      {"@type":"HowToStep","name":"Check discriminant","text":"Compute Δ = B² − 4AC to decide ellipse/circle, parabola, or hyperbola (non-degenerate)."},
      {"@type":"HowToStep","name":"Eliminate xy-term","text":"Rotate by θ = ½ atan2(B, A − C) to diagonalize the quadratic part."},
      {"@type":"HowToStep","name":"Translate to center","text":"If Δ ≠ 0, solve [ [2A,B],[B,2C] ] [x0,y0]^T = −[D,E]^T for the center."},
      {"@type":"HowToStep","name":"Read canonical form","text":"Use the rotated/translated coefficients to get axes lengths and canonical equation."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-700">CalcDomain</a>
      <nav class="hidden sm:flex gap-6 text-sm">
        <a class="hover:text-blue-700" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-700" href="index.html#categories">Categories</a>
      </nav>
      <button class="sm:hidden tip no-print" aria-expanded="false" aria-controls="mnav" aria-label="Open menu">☰</button>
    </div>
    <div id="mnav" class="sm:hidden hidden px-4 pb-4">
      <a class="block py-2 hover:text-blue-700" href="search.html">Advanced Search</a>
      <a class="block py-2 hover:text-blue-700" href="index.html#categories">Categories</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
      <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
      <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
      <a href="subcategories/math-analytic-geometry.html" class="hover:text-blue-700">Analytic Geometry</a> &raquo;
      <span class="text-gray-900">Conic Classifier</span>
    </nav>

    <section id="print-section" class="bg-white rounded-xl shadow p-6">
      <h1 class="text-3xl font-extrabold mb-2">conic classifier</h1>
      <p class="text-gray-700 mb-6">Enter the coefficients of a general second-degree equation and instantly classify the conic (ellipse/circle, parabola, hyperbola, or degenerate). The tool also computes the rotation angle to remove the \(xy\) term, the center (when it exists), canonical form, and (semi-)axes. Ideal for engineers, surveyors, and students verifying analytic geometry work.</p>

      <!-- Calculator -->
      <section aria-labelledby="calcTitle" class="space-y-6">
        <h2 id="calcTitle" class="text-xl font-bold">Interactive calculator</h2>

        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
          <!-- A -->
          <div>
            <div class="flex items-center justify-between">
              <label for="A" class="block text-sm font-medium text-gray-800">A *</label>
              <button type="button" class="tip" aria-expanded="false" aria-controls="tipA" aria-label="Help for A">?</button>
            </div>
            <input id="A" inputmode="decimal" type="number" step="any" value="1" aria-required="true"
                   class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2"
                   aria-describedby="errA tipA">
            <p id="tipA" class="tip-content" role="tooltip">Coefficient of \(x^2\) in \(Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0\).</p>
            <p id="errA" class="mt-1 text-sm text-red-600"></p>
          </div>

          <!-- B -->
          <div>
            <div class="flex items-center justify-between">
              <label for="B" class="block text-sm font-medium text-gray-800">B *</label>
              <button type="button" class="tip" aria-expanded="false" aria-controls="tipB" aria-label="Help for B">?</button>
            </div>
            <input id="B" inputmode="decimal" type="number" step="any" value="0" aria-required="true"
                   class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2"
                   aria-describedby="errB tipB">
            <p id="tipB" class="tip-content" role="tooltip">Coefficient of \(xy\). If nonzero, the axes are rotated; the tool reports the angle \(\theta\) to eliminate \(xy\).</p>
            <p id="errB" class="mt-1 text-sm text-red-600"></p>
          </div>

          <!-- C -->
          <div>
            <div class="flex items-center justify-between">
              <label for="C" class="block text-sm font-medium text-gray-800">C *</label>
              <button type="button" class="tip" aria-expanded="false" aria-controls="tipC" aria-label="Help for C">?</button>
            </div>
            <input id="C" inputmode="decimal" type="number" step="any" value="1" aria-required="true"
                   class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2"
                   aria-describedby="errC tipC">
            <p id="tipC" class="tip-content" role="tooltip">Coefficient of \(y^2\).</p>
            <p id="errC" class="mt-1 text-sm text-red-600"></p>
          </div>

          <!-- D -->
          <div>
            <div class="flex items-center justify-between">
              <label for="D" class="block text-sm font-medium text-gray-800">D *</label>
              <button type="button" class="tip" aria-expanded="false" aria-controls="tipD" aria-label="Help for D">?</button>
            </div>
            <input id="D" inputmode="decimal" type="number" step="any" value="0" aria-required="true"
                   class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2"
                   aria-describedby="errD tipD">
            <p id="tipD" class="tip-content" role="tooltip">Coefficient of \(x\).</p>
            <p id="errD" class="mt-1 text-sm text-red-600"></p>
          </div>

          <!-- E -->
          <div>
            <div class="flex items-center justify-between">
              <label for="E" class="block text-sm font-medium text-gray-800">E *</label>
              <button type="button" class="tip" aria-expanded="false" aria-controls="tipE" aria-label="Help for E">?</button>
            </div>
            <input id="E" inputmode="decimal" type="number" step="any" value="0" aria-required="true"
                   class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2"
                   aria-describedby="errE tipE">
            <p id="tipE" class="tip-content" role="tooltip">Coefficient of \(y\).</p>
            <p id="errE" class="mt-1 text-sm text-red-600"></p>
          </div>

          <!-- F -->
          <div>
            <div class="flex items-center justify-between">
              <label for="F" class="block text-sm font-medium text-gray-800">F *</label>
              <button type="button" class="tip" aria-expanded="false" aria-controls="tipF" aria-label="Help for F">?</button>
            </div>
            <input id="F" inputmode="decimal" type="number" step="any" value="-1" aria-required="true"
                   class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2"
                   aria-describedby="errF tipF">
            <p id="tipF" class="tip-content" role="tooltip">Constant term.</p>
            <p id="errF" class="mt-1 text-sm text-red-600"></p>
          </div>
        </div>

        <div class="flex flex-wrap gap-3 mt-2">
          <button id="btnReset" class="px-4 py-2 rounded-lg border bg-white hover:bg-gray-50">Reset</button>
          <button id="btnExample" class="px-4 py-2 rounded-lg border bg-white hover:bg-gray-50">Load example</button>
        </div>
      </section>

      <!-- Results -->
      <section id="results-panel" aria-labelledby="resTitle" class="mt-8">
        <h2 id="resTitle" class="text-xl font-bold mb-3">Results</h2>
        <div class="grid lg:grid-cols-3 gap-6">
          <div class="lg:col-span-2">
            <div class="grid sm:grid-cols-2 gap-4">
              <div class="p-4 border rounded-lg">
                <h3 class="text-sm text-gray-600">Classification</h3>
                <p id="outType" class="text-2xl font-extrabold text-blue-700 mt-1">—</p>
                <p class="text-sm text-gray-600 mt-1">Discriminant Δ = <span id="outDisc">—</span></p>
                <p class="text-sm text-gray-600">Degeneracy test det(𝙲) = <span id="outDeg">—</span></p>
              </div>
              <div class="p-4 border rounded-lg">
                <h3 class="text-sm text-gray-600">Rotation to remove xy</h3>
                <p class="mt-1"><span class="font-semibold">θ</span> = <span id="outTheta">—</span> (deg)</p>
                <p class="text-sm text-gray-600">Formula \( \theta = \tfrac12 \operatorname{atan2}(B, A - C) \)</p>
              </div>
              <div class="p-4 border rounded-lg">
                <h3 class="text-sm text-gray-600">Center (if exists)</h3>
                <p id="outCenter" class="mt-1">—</p>
              </div>
              <div class="p-4 border rounded-lg">
                <h3 class="text-sm text-gray-600">Principal coefficients</h3>
                <p class="mt-1">λ₁ = <span id="outL1">—</span>, λ₂ = <span id="outL2">—</span></p>
              </div>
              <div class="p-4 border rounded-lg sm:col-span-2">
                <h3 class="text-sm text-gray-600">Canonical form (rotated/translated)</h3>
                <div class="mt-1 font-mono text-sm" id="outCanonical">—</div>
                <div class="text-sm text-gray-600 mt-2" id="outAxes">—</div>
              </div>
            </div>
          </div>
          <div class="border rounded-lg p-3">
            <h3 class="text-sm text-gray-700 mb-2">Oriented axes preview (not to scale)</h3>
            <svg id="preview" viewBox="-120 -120 240 240" class="w-full h-56 border rounded">
              <rect x="-120" y="-120" width="240" height="240" fill="#ffffff"></rect>
              <!-- base axes -->
              <line x1="-110" y1="0" x2="110" y2="0" stroke="#d1d5db" stroke-width="1"/>
              <line x1="0" y1="-110" x2="0" y2="110" stroke="#d1d5db" stroke-width="1"/>
              <!-- rotated axes -->
              <g id="rotAxes" stroke="#2563eb" stroke-width="2">
                <line id="rotX" x1="-90" y1="0" x2="90" y2="0"></line>
                <line id="rotY" x1="0" y1="-90" x2="0" y2="90"></line>
              </g>
              <!-- center -->
              <circle id="centerDot" cx="0" cy="0" r="3" fill="#ef4444" />
            </svg>
            <p class="text-xs text-gray-600 mt-1">Blue = principal axes; red dot = computed center (if defined).</p>
          </div>
        </div>
      </section>

      <!-- Authoritative content ecosystem -->
      <section class="prose mt-10">
        <h2>Data source and methodology</h2>
        <p><strong>AuthoritativeDataSource:</strong> Larson &amp; Edwards, <em>Calculus</em>, Appendix D: “Rotation and the General Second-Degree Equation,” Cengage (public appendix PDF). “Ax² + Bxy + Cy² + Dx + Ey + F is classified by the discriminant: ellipse/circle if \(B^2-4AC&lt;0\), parabola if \(=0\), hyperbola if \(&gt;0\); rotation by \(\theta=\tfrac12\operatorname{atan2}(B, A-C)\) eliminates \(xy\).” Direct link: <a class="text-blue-700 underline" href="https://www.larsoncalculus.com/calc11/wp-content/uploads/web_appendices/appendix-d-rotation-and-the-general-second-degree-equation.pdf" rel="nofollow">Appendix D (PDF)</a>. All computations strictly follow these formulas. </p>
        <p>Supplementary: NTNU lecture notes on conics (classification by discriminant and degeneracy notes): <a class="text-blue-700 underline" href="https://wiki.math.ntnu.no/_media/ma1102/2015v/notes.pdf" rel="nofollow">Introduction to Conic Sections (PDF)</a>. “All calculations are rigorously based on the formulas and data provided by these sources.”</p>

        <h2>The formula explained</h2>
        <div class="formula-box">
          <p>General equation: \(Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0\).</p>
          <p>Discriminant: \(\Delta = B^2 - 4AC\).</p>
          <ul>
            <li>\(\Delta &lt; 0\): ellipse (circle if \(A=C\) and \(B=0\)), non-degenerate.</li>
            <li>\(\Delta = 0\): parabola (no finite center).</li>
            <li>\(\Delta &gt; 0\): hyperbola.</li>
          </ul>
          <p>Rotation to eliminate \(xy\): \( \displaystyle \theta = \tfrac12 \operatorname{atan2}(B, A - C) \).</p>
          <p>Quadratic form matrix \(Q=\begin{bmatrix}A & B/2\\ B/2 & C\end{bmatrix}\) has eigenvalues \(\lambda_{1,2}\). After rotation, \(B' = 0\) and the principal coefficients are \(\lambda_1,\lambda_2\).</p>
          <p>Center (for \(\Delta \neq 0\)) by solving the linear system of partials:
            \[
              \begin{bmatrix} 2A & B \\ B & 2C \end{bmatrix}
              \begin{bmatrix} x_0 \\ y_0 \end{bmatrix} =
              -\begin{bmatrix} D \\ E \end{bmatrix}.
            \]
          </p>
          <p>Evaluate at the center: \(F' = A x_0^2 + B x_0 y_0 + C y_0^2 + Dx_0 + Ey_0 + F\).</p>
          <p>Canonical (rotated/translated) form: \(\lambda_1 u^2 + \lambda_2 v^2 + F' = 0\).
            <br>Ellipse if \(\lambda_1\!>\!0,\lambda_2\!>\!0, F'\!<\!0\):
            \( \frac{u^2}{a^2} + \frac{v^2}{b^2} = 1\) with
            \( a=\sqrt{\frac{-F'}{\lambda_1}},\; b=\sqrt{\frac{-F'}{\lambda_2}}.\)
            <br>Hyperbola if \(\lambda_1\lambda_2\!<\!0\):
            \( \operatorname{sgn}(\lambda_1)\frac{u^2}{a^2} + \operatorname{sgn}(\lambda_2)\frac{v^2}{b^2} = 1\)
            with \( a=\sqrt{\left|\frac{F'}{\lambda_1}\right|},\; b=\sqrt{\left|\frac{F'}{\lambda_2}\right|}.\)
          </p>
          <p>Degeneracy check (optional): determinant of the conic matrix
            \(\displaystyle \det\!\begin{bmatrix}A & B/2 & D/2\\ B/2 & C & E/2\\ D/2 & E/2 & F\end{bmatrix}=0\)
            indicates a degenerate conic (point, single line, or pair of lines).
          </p>
        </div>

        <h2>Glossary of variables</h2>
        <ul>
          <li><strong>A,B,C,D,E,F</strong>: coefficients of the general equation.</li>
          <li><strong>Δ</strong>: discriminant \(B^2-4AC\) (type test).</li>
          <li><strong>θ</strong>: rotation angle (degrees) to remove \(xy\).</li>
          <li><strong>(x₀,y₀)</strong>: center (for Δ≠0), solution of the partial-derivative system.</li>
          <li><strong>λ₁, λ₂</strong>: eigenvalues of \(Q\); principal quadratic coefficients after rotation.</li>
          <li><strong>F′</strong>: constant term after translation to the center.</li>
          <li><strong>a,b</strong>: semi-axes (ellipse) or axis parameters (hyperbola) in canonical form.</li>
        </ul>

        <h2>How it works: a step-by-step example</h2>
        <h3>Example: ellipse</h3>
        <p>Use \(A=4, B=2, C=5, D=0, E=0, F=-20\). Then \(\Delta=2^2-4\cdot 4\cdot 5=-76&lt;0\Rightarrow\) ellipse. The rotation angle is \(\theta=\tfrac12\operatorname{atan2}(2,4-5)\approx -31.72^\circ\). The center solves \(\bigl[\!\begin{smallmatrix}8&2\\2&10\end{smallmatrix}\!\bigr]\bigl[\!\begin{smallmatrix}x_0\\y_0\end{smallmatrix}\!\bigr]=\bigl[\!\begin{smallmatrix}0\\0\end{smallmatrix}\!\bigr]\Rightarrow (0,0)\). With \(Q=\bigl[\!\begin{smallmatrix}4&1\\1&5\end{smallmatrix}\!\bigr]\), \(\lambda_1\approx 3.382\), \(\lambda_2\approx 5.618\). Since \(F'=-20\), the canonical form is \(\lambda_1 u^2+\lambda_2 v^2-20=0\Rightarrow\frac{u^2}{20/\lambda_1}+\frac{v^2}{20/\lambda_2}=1\) with \(a\approx 2.43,\; b\approx 1.89\).</p>

        <h2>FAQ</h2>
        <details><summary>How do you tell circle vs ellipse?</summary><p>Both have \(\Delta&lt;0\). A circle additionally satisfies \(A=C\) and \(B=0\).</p></details>
        <details><summary>What does “degenerate” mean here?</summary><p>The equation represents a point, a single line, or two lines (parallel or intersecting) instead of a proper conic. We flag this when the 3×3 conic determinant is ~0.</p></details>
        <details><summary>Why doesn’t a parabola have a center?</summary><p>Parabolas are not centrally symmetric; the linear system for \((x_0,y_0)\) becomes singular when \(\Delta=0\).</p></details>
        <details><summary>What if the discriminant test and determinant disagree?</summary><p>The discriminant decides the family (ellipse/parabola/hyperbola) under non-degeneracy. A near-zero 3×3 determinant indicates a degenerate case within that family.</p></details>
        <details><summary>Do floating-point round-off errors affect results?</summary><p>They can. We treat values with \(|v|&lt;10^{-10}\) as zero for stability. Slightly perturb inputs or increase precision if you see borderline classifications.</p></details>
        <details><summary>Can I recover the focal length of a parabola here?</summary><p>This tool focuses on classification, angle, and canonical coefficients. For parabolas, focal parameters require an additional completion-of-squares step after rotation; planned for a future pro version.</p></details>
        <details><summary>Is the SVG drawing exact?</summary><p>No—it's a qualitative orientation preview (principal axes and center). Use the numeric outputs for precise work.</p></details>

        <div class="mt-6 p-4 bg-gray-50 border rounded">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
        </div>
      </section>
    </section>
  </main>

  <footer class="bg-white border-t mt-10">
    <div class="max-w-6xl mx-auto px-4 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All rights reserved.</p>
      <div class="mt-3 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (deferred) -->
  <script defer>
  (function(){
    const $ = id => document.getElementById(id);
    const els = {
      A: $('A'), B:$('B'), C:$('C'), D:$('D'), E:$('E'), F:$('F'),
      outType:$('outType'), outDisc:$('outDisc'), outDeg:$('outDeg'),
      outTheta:$('outTheta'), outCenter:$('outCenter'),
      outL1:$('outL1'), outL2:$('outL2'), outCanonical:$('outCanonical'), outAxes:$('outAxes'),
      rotX:$('rotX'), rotY:$('rotY'), centerDot:$('centerDot'),
      btnReset:$('btnReset'), btnExample:$('btnExample')
    };
    const errs = { A:$('errA'), B:$('errB'), C:$('errC'), D:$('errD'), E:$('errE'), F:$('errF') };
    const tips = Array.from(document.querySelectorAll('.tip'));

    // Accessible tooltip toggles
    tips.forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const exp = btn.getAttribute('aria-expanded') === 'true';
        tips.forEach(b=>b.setAttribute('aria-expanded','false'));
        btn.setAttribute('aria-expanded', String(!exp));
      });
      btn.addEventListener('keydown', (e)=>{
        if(e.key==='Escape'){ btn.setAttribute('aria-expanded','false'); }
      });
    });
    document.addEventListener('click',(e)=>{
      if(!e.target.classList.contains('tip')) tips.forEach(b=>b.setAttribute('aria-expanded','false'));
    });

    // Validation on blur
    function validateField(id){
      const el = els[id], err = errs[id];
      err.textContent = '';
      if(el.value === '' || isNaN(+el.value)){
        err.textContent = 'Please enter a valid number.';
        return false;
      }
      return true;
    }
    ['A','B','C','D','E','F'].forEach(k=>{
      els[k].addEventListener('blur', ()=>{ validateField(k); compute(); });
      els[k].addEventListener('input', ()=>{ compute(); });
    });

    // Linear algebra helpers
    const EPS = 1e-10;
    const near0 = v => Math.abs(v) < EPS ? 0 : v;
    function eigen2(a, b, c){ // for [[a, b],[b, c]]
      const tr = a + c;
      const det = a*c - b*b;
      const disc = Math.max(0, tr*tr - 4*det);
      const s = Math.sqrt(disc);
      return [(tr + s)/2, (tr - s)/2];
    }
    function solve2(a11,a12,a21,a22, b1,b2){
      const det = a11*a22 - a12*a21;
      if(Math.abs(det) < EPS) return null;
      const x = ( b1*a22 - a12*b2)/det;
      const y = (-b1*a21 + a11*b2)/det;
      return [x,y];
    }
    function deg(rad){ return rad*180/Math.PI; }

    function compute(){
      // Validate quickly
      let ok = true;
      ['A','B','C','D','E','F'].forEach(k=>{ ok = validateField(k) && ok; });
      if(!ok) return;

      const A = +els.A.value, B = +els.B.value, C = +els.C.value, D = +els.D.value, E = +els.E.value, F = +els.F.value;

      // Discriminant and degeneracy
      const disc = B*B - 4*A*C;
      const type = (()=>{
        if (Math.abs(disc) < 1e-9) return 'Parabola (Δ ≈ 0)';
        if (disc < 0) {
          if (Math.abs(B) < EPS && Math.abs(A-C) < EPS) return 'Circle (Δ < 0, A=C, B=0)';
          return 'Ellipse (Δ < 0)';
        }
        return 'Hyperbola (Δ > 0)';
      })();

      // 3x3 conic determinant for degeneracy
      const det3 = (()=>{
        // |A  B/2 D/2|
        // |B/2 C  E/2|
        // |D/2 E/2 F |
        const a11=A, a12=B/2, a13=D/2, a21=B/2, a22=C, a23=E/2, a31=D/2, a32=E/2, a33=F;
        return a11*(a22*a33 - a23*a32) - a12*(a21*a33 - a23*a31) + a13*(a21*a32 - a22*a31);
      })();

      // Rotation angle to remove xy
      const theta = 0.5 * Math.atan2(B, A - C); // radians
      const thetaDeg = deg(theta);

      // Eigenvalues of Q (principal coefficients)
      const lam = eigen2(A, B/2, C);
      const lam1 = lam[0], lam2 = lam[1];

      // Center if Δ ≠ 0 (matrix of partials invertible)
      let centerStr = 'No finite center (parabola or singular partials).';
      let x0=null, y0=null, Fp=null;
      const sol = solve2(2*A, B, B, 2*C, -D, -E);
      if (sol && Math.abs(disc) > 1e-9){
        [x0,y0] = sol;
        centerStr = `(${x0.toFixed(6)}, ${y0.toFixed(6)})`;
        // Evaluate at center
        Fp = A*x0*x0 + B*x0*y0 + C*y0*y0 + D*x0 + E*y0 + F;
      }

      // Canonical form & axes
      let canonical = '—';
      let axesTxt = '—';
      if (x0!==null && y0!==null && Fp!==null){
        // After translation to center and rotation, equation is lam1 u^2 + lam2 v^2 + F' = 0
        const l1 = lam1, l2 = lam2;
        const s1 = Math.sign(l1), s2 = Math.sign(l2);
        if (l1>0 && l2>0 && Fp<0){
          const a = Math.sqrt(-Fp/l1), b = Math.sqrt(-Fp/l2);
          canonical = `u^2/${(a*a).toFixed(6)} + v^2/${(b*b).toFixed(6)} = 1`;
          axesTxt = `Ellipse with semi-axes a=${a.toFixed(6)}, b=${b.toFixed(6)}.`;
        } else if (l1*l2 < 0){
          const a = Math.sqrt(Math.abs(Fp/l1));
          const b = Math.sqrt(Math.abs(Fp/l2));
          // Determine sign: lam with same sign as -Fp gives +1 side
          const plusU = (-Fp/l1) > 0;
          canonical = plusU
            ? `u^2/${(a*a).toFixed(6)} - v^2/${(b*b).toFixed(6)} = 1`
            : `-u^2/${(a*a).toFixed(6)} + v^2/${(b*b).toFixed(6)} = 1`;
          axesTxt = `Hyperbola with parameters a=${a.toFixed(6)}, b=${b.toFixed(6)}.`;
        } else if (Math.abs(disc) < 1e-9){
          canonical = `λ₁ u^2 + λ₂ v^2 + F' = 0  (parabolic case; one principal coefficient effectively zero)`;
          axesTxt = `Parabola (canonical focal form requires one more completion step after rotation).`;
        } else {
          // Could be imaginary ellipse or empty set if signs incompatible
          canonical = `λ₁ u^2 + λ₂ v^2 + F' = 0 (no real locus for given signs)`;
          axesTxt = `No real points (sign configuration yields empty set).`;
        }
      } else if (Math.abs(det3) < 1e-9){
        canonical = `Degenerate case (det(𝙲) ≈ 0)`;
        axesTxt = `Point or pair of lines (parallel or intersecting).`;
      }

      // Update UI
      els.outType.textContent = type;
      els.outDisc.textContent = disc.toFixed(6);
      els.outDeg.textContent = near0(det3) === 0 ? '≈ 0 (degenerate)' : det3.toExponential(6);
      els.outTheta.textContent = thetaDeg.toFixed(4);
      els.outCenter.textContent = centerStr;
      els.outL1.textContent = lam1.toFixed(6);
      els.outL2.textContent = lam2.toFixed(6);
      els.outCanonical.textContent = canonical;
      els.outAxes.textContent = axesTxt;

      // Preview: rotated axes and center
      const cos = Math.cos(theta), sin = Math.sin(theta);
      const L = 90;
      const x1 = -L*cos, y1 = -L*sin, x2 = L*cos, y2 = L*sin; // u-axis
      const ux = -L*(-sin), uy = -L*(cos), vx = L*(-sin), vy = L*(cos); // v-axis
      els.rotX.setAttribute('x1', x1.toFixed(2)); els.rotX.setAttribute('y1', y1.toFixed(2));
      els.rotX.setAttribute('x2', x2.toFixed(2)); els.rotX.setAttribute('y2', y2.toFixed(2));
      els.rotY.setAttribute('x1', ux.toFixed(2)); els.rotY.setAttribute('y1', uy.toFixed(2));
      els.rotY.setAttribute('x2', vx.toFixed(2)); els.rotY.setAttribute('y2', vy.toFixed(2));

      if (x0!==null && y0!==null){
        // crude scale for plotting center
        const sx = 20, sy = 20;
        els.centerDot.setAttribute('cx', (x0*sx).toFixed(2));
        els.centerDot.setAttribute('cy', (-y0*sy).toFixed(2));
        els.centerDot.setAttribute('visibility','visible');
      } else {
        els.centerDot.setAttribute('visibility','hidden');
      }

      // Re-render MathJax if available (canonical uses plain text; leave formulas above)
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
      }
    }

    // Example & reset
    els.btnReset.addEventListener('click', (e)=>{
      e.preventDefault();
      els.A.value = 1; els.B.value = 0; els.C.value = 1; els.D.value = 0; els.E.value = 0; els.F.value = -1;
      compute();
    });
    els.btnExample.addEventListener('click', (e)=>{
      e.preventDefault();
      // Hyperbola example rotated
      els.A.value = 4; els.B.value = -6; els.C.value = 1; els.D.value = 0; els.E.value = 0; els.F.value = -20;
      compute();
    });

    // Mobile menu toggle (reuse tip button behavior)
    const mbtn = document.querySelector('header .tip.no-print');
    const mnav = document.getElementById('mnav');
    if (mbtn) {
      mbtn.addEventListener('click', ()=>{
        const open = mnav.classList.contains('hidden');
        mnav.classList.toggle('hidden', !open===false);
        mbtn.setAttribute('aria-expanded', String(open));
        if (open) mnav.classList.remove('hidden'); else mnav.classList.add('hidden');
      });
    }

    // Initial compute
    compute();
  })();
  </script>
</body>
</html>
