<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Refinance Calculator — Compare Payments, Break-Even & Total Savings</title>
  <meta name="description" content="Refinance calculator to compare your current mortgage vs. a new loan. See new payment, monthly savings, break-even date, and total interest savings including closing costs and points." />
  <link rel="canonical" href="https://calcdomain.com/refinance-calculator.html" />

  <!-- Favicons / PWA -->
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Fonts & UI -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root { --focus-ring: 3px solid #2563eb; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', sans-serif; }
    .prose { max-width: 72ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
    .prose h3 { font-size: 1.25rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .prose p { margin-bottom: 1rem; line-height: 1.7; }
    .prose ul, .prose ol { margin-left: 1.25rem; margin-bottom: 1rem; }
    .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow-x:auto; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; text-align:center; }
    .result-card h4 { font-size: .95rem; color:#4b5563; margin-bottom:.25rem; }
    .result-card p { font-size: 1.5rem; font-weight: 800; color:#1d4ed8; }
    .min-results { min-height: 14rem; } /* prevent CLS when results render */
    input, select, button, summary { outline-offset: 2px; }
    input:focus, select:focus, button:focus, summary:focus { outline: var(--focus-ring); }
    .help-btn { width: 2rem; height: 2rem; border-radius: 9999px; border:1px solid #cbd5e1; display:inline-flex; align-items:center; justify-content:center; }
    .help-panel[hidden]{ display:none; }
    .err { color:#b91c1c; font-size:.875rem; margin-top:.375rem; }
    .err-icon::before { content:"⚠ "; }
    @media (max-width: 640px) { .click-48 { min-width:48px; min-height:48px; } }
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; left:0; top:0; width:100%; }
      #results-chart-container { display: none !important; }
    }
  </style>

  <!-- Primary E-E-A-T / WebPage schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Refinance Calculator",
    "headline": "Refinance Calculator — Compare Payments, Break-Even & Total Savings",
    "description": "Refinance calculator to compare your current mortgage vs. a new loan, including closing costs and points. See payment change, break-even date, and total interest savings.",
    "url": "https://calcdomain.com/refinance-calculator.html",
    "inLanguage": "en",
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type": "ListItem","position": 1,"name": "Home","item": "https://calcdomain.com/"},
        {"@type": "ListItem","position": 2,"name": "Finance","item": "https://calcdomain.com/finance.html"},
        {"@type": "ListItem","position": 3,"name": "Loans & Debt","item": "https://calcdomain.com/subcategories/finance-loans-debt.html"},
        {"@type": "ListItem","position": 4,"name": "Refinance Calculator","item": "https://calcdomain.com/refinance-calculator.html"}
      ]
    },
    "author": { "@type": "Person", "name": "Ugo Candido" },
    "publisher": { "@type": "Organization", "name": "CalcDomain" }
  }
  </script>

  <!-- HowTo schema for break-even -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to evaluate a mortgage refinance",
    "description": "Steps to compare current mortgage vs. a new loan, factoring closing costs and points to estimate break-even.",
    "step": [
      {"@type":"HowToStep","name":"Enter current loan","text":"Input remaining balance, remaining term, and current APR."},
      {"@type":"HowToStep","name":"Enter new loan","text":"Input new APR, term, closing costs, and discount points; choose whether to roll costs into the loan."},
      {"@type":"HowToStep","name":"Compare payments","text":"See old vs. new monthly payments and monthly savings."},
      {"@type":"HowToStep","name":"Check break-even","text":"Review the break-even months and calendar date when cumulative savings exceed total refinance costs."},
      {"@type":"HowToStep","name":"Review total savings","text":"Compare total remaining interest on current loan with total interest on the new loan plus costs."}
    ]
  }
  </script>

  <!-- FAQPage schema -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is a refinance break-even point?","acceptedAnswer":{"@type":"Answer","text":"The break-even point is the month when cumulative payment/interest savings from the new loan exceed your upfront refinance costs (closing costs and discount points)."}} ,
      {"@type":"Question","name":"Should I roll closing costs into my new loan?","acceptedAnswer":{"@type":"Answer","text":"Rolling costs increases your principal and the interest paid on those costs. Paying them upfront reduces interest but increases cash needed at closing."}},
      {"@type":"Question","name":"Do points always save money?","acceptedAnswer":{"@type":"Answer","text":"Points buy a lower rate, but they help only if you keep the loan long enough to recover the upfront cost through monthly savings."}},
      {"@type":"Question","name":"Why does my old payment differ from my statement?","acceptedAnswer":{"@type":"Answer","text":"This tool computes the payment from your remaining balance, term, and APR with standard amortization; servicer rounding, escrow, or fees may make your statement differ."}},
      {"@type":"Question","name":"Can I compare a cash-out refinance?","acceptedAnswer":{"@type":"Answer","text":"Yes. Increase the new principal by the cash-out amount in the calculator (via the “roll-in / add to loan” field) to see the payment impact."}},
      {"@type":"Question","name":"Does this include taxes and insurance?","acceptedAnswer":{"@type":"Answer","text":"No. It compares loan principal and interest only. Add your escrow amounts separately to estimate total monthly housing cost."}},
      {"@type":"Question","name":"What if my current loan has a prepayment penalty?","acceptedAnswer":{"@type":"Answer","text":"Add the penalty amount to closing costs to get an accurate break-even and savings estimate."}}
    ]
  }
  </script>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per spec) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex items-center justify-between">
        <a href="index.html" class="text-2xl font-extrabold text-blue-600">CalcDomain</a>
        <div class="hidden md:flex items-center gap-6 text-sm">
          <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>
        <button id="mobile-menu-toggle" class="md:hidden p-2 click-48" aria-label="Open menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      <div id="mobile-menu" class="md:hidden mt-3 hidden">
        <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
        <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-10">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Main content -->
      <section class="w-full lg:w-2/3">
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
          <a href="subcategories/finance-loans-debt.html" class="hover:text-blue-600">Loans &amp; Debt</a> &raquo;
          <span class="text-gray-900">Refinance Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
          <h1 class="text-3xl font-extrabold text-gray-900 mb-2">refinance calculator</h1>
          <p class="text-gray-700 mb-6">
            Compare your current mortgage against a new loan. See old vs. new monthly payments, monthly savings, break-even date, and total interest savings — with closing costs and points accounted for.
          </p>

          <!-- Calculator UI -->
          <section aria-labelledby="calc-heading" id="calculator-ui" class="space-y-6">
            <h2 id="calc-heading" class="sr-only">Refinance Calculator Inputs</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Current loan -->
              <div>
                <label for="currentBalance" class="block text-sm font-medium text-gray-800">Remaining Balance ($) <span aria-hidden="true" class="text-red-600">*</span></label>
                <div class="flex items-start gap-2">
                  <input type="number" inputmode="decimal" id="currentBalance" aria-required="true" aria-describedby="currentBalanceHelp currentBalanceErr"
                         min="1" step="100" value="300000"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                  <button type="button" class="help-btn click-48" aria-expanded="false" aria-controls="currentBalanceHelp" aria-label="What is remaining balance?" data-help="#currentBalanceHelp">?</button>
                </div>
                <p id="currentBalanceHelp" class="text-sm text-gray-600 mt-2 help-panel" hidden>
                  The principal you still owe (exclude escrow). Use your latest statement’s “principal balance”.
                </p>
                <p id="currentBalanceErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <div>
                <label for="currentApr" class="block text-sm font-medium text-gray-800">Current APR (%) <span aria-hidden="true" class="text-red-600">*</span></label>
                <input type="number" inputmode="decimal" id="currentApr" aria-required="true" aria-describedby="currentAprErr"
                       min="0" max="99" step="0.01" value="6.75"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                <p id="currentAprErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <div>
                <label for="remainingTerm" class="block text-sm font-medium text-gray-800">Remaining Term (years) <span aria-hidden="true" class="text-red-600">*</span></label>
                <input type="number" inputmode="decimal" id="remainingTerm" aria-required="true" aria-describedby="remainingTermErr"
                       min="0.25" max="40" step="0.25" value="25"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                <p id="remainingTermErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <!-- New loan -->
              <div>
                <label for="newApr" class="block text-sm font-medium text-gray-800">New APR (%) <span aria-hidden="true" class="text-red-600">*</span></label>
                <input type="number" inputmode="decimal" id="newApr" aria-required="true" aria-describedby="newAprErr"
                       min="0" max="99" step="0.01" value="5.75"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                <p id="newAprErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <div>
                <label for="newTerm" class="block text-sm font-medium text-gray-800">New Term (years) <span aria-hidden="true" class="text-red-600">*</span></label>
                <input type="number" inputmode="decimal" id="newTerm" aria-required="true" aria-describedby="newTermErr"
                       min="1" max="40" step="0.25" value="30"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                <p id="newTermErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <div>
                <label for="closingCosts" class="block text-sm font-medium text-gray-800">Closing Costs ($)</label>
                <input type="number" inputmode="decimal" id="closingCosts" aria-describedby="closingCostsHelp closingCostsErr"
                       min="0" step="100" value="4500"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                <p id="closingCostsHelp" class="text-sm text-gray-600 mt-2">Include lender fees, appraisal, title, prepayment penalty (if any).</p>
                <p id="closingCostsErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <div>
                <label for="pointsPct" class="block text-sm font-medium text-gray-800">Discount Points (%)</label>
                <div class="flex items-start gap-2">
                  <input type="number" inputmode="decimal" id="pointsPct" aria-describedby="pointsHelp pointsErr"
                         min="0" max="10" step="0.125" value="0"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
                  <button type="button" class="help-btn click-48" aria-expanded="false" aria-controls="pointsHelp" aria-label="What are discount points?" data-help="#pointsHelp">?</button>
                </div>
                <p id="pointsHelp" class="text-sm text-gray-600 mt-2 help-panel" hidden>
                  Each 1% point equals 1% of the loan amount paid upfront to reduce the interest rate.
                </p>
                <p id="pointsErr" class="err err-icon" role="alert" hidden></p>
              </div>

              <div class="md:col-span-2">
                <label class="inline-flex items-center gap-3">
                  <input type="checkbox" id="rollCosts" class="w-5 h-5 rounded border-gray-300">
                  <span class="text-sm font-medium text-gray-800">Roll costs into the new loan (adds costs/points to principal)</span>
                </label>
              </div>

              <div>
                <label for="refiMonth" class="block text-sm font-medium text-gray-800">Refinance Month (for timeline)</label>
                <input type="month" id="refiMonth" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-blue-600">
              </div>

              <div class="flex items-center gap-3">
                <button id="resetBtn" class="px-4 py-2 rounded-md border click-48 hover:bg-gray-50">Reset</button>
                <button id="printBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white click-48 hover:bg-blue-700">Print</button>
              </div>
            </div>
          </section>

          <!-- Results -->
          <section id="results" aria-labelledby="results-heading" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6 min-results">
            <h2 id="results-heading" class="sr-only">Results</h2>
            <div class="flex flex-col md:flex-row gap-6">
              <div class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="result-card"><h4>Old Monthly Payment</h4><p id="oldPayment">$0.00</p></div>
                <div class="result-card"><h4>New Monthly Payment</h4><p id="newPayment">$0.00</p></div>
                <div class="result-card"><h4>Monthly Savings</h4><p id="monthlySavings">$0.00</p></div>
                <div class="result-card"><h4>Break-Even</h4><p id="breakEven">—</p></div>
                <div class="result-card"><h4>Total Remaining Interest (Old)</h4><p id="oldInterest">$0.00</p></div>
                <div class="result-card"><h4>Total Interest + Costs (New)</h4><p id="newInterestPlusCosts">$0.00</p></div>
              </div>
              <div class="w-full md:w-1/3">
                <div id="results-chart-container" class="h-44">
                  <canvas id="costChart" aria-label="Cost comparison chart"></canvas>
                </div>
              </div>
            </div>

            <details class="mt-6 bg-white rounded-lg" id="scheduleDetails">
              <summary class="font-semibold text-gray-900 px-4 py-3 cursor-pointer">View first 24 months of new loan schedule</summary>
              <div class="mt-0 overflow-x-auto border-t border-gray-200" id="scheduleContainer">
                <table class="min-w-full text-sm text-right">
                  <thead class="bg-gray-100 text-gray-700 uppercase">
                    <tr>
                      <th class="px-4 py-2 text-left">#</th>
                      <th class="px-4 py-2 text-left">Date</th>
                      <th class="px-4 py-2">Payment</th>
                      <th class="px-4 py-2">Interest</th>
                      <th class="px-4 py-2">Principal</th>
                      <th class="px-4 py-2">Balance</th>
                    </tr>
                  </thead>
                  <tbody id="scheduleBody"></tbody>
                </table>
              </div>
            </details>
          </section>
        </div>

        <!-- Authoritative content -->
        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>Authoritative Data Source & Methodology</h2>
          <p><strong>Primary references:</strong></p>
          <ul>
            <li><a class="text-blue-600 underline" href="https://www.consumerfinance.gov/ask-cfpb/what-is-mortgage-refinancing-en-105/" rel="noopener">Consumer Financial Protection Bureau (CFPB) — Mortgage Refinancing Guidance</a> (accessed 2025).</li>
            <li><a class="text-blue-600 underline" href="https://singlefamily.fanniemae.com" rel="noopener">Fannie Mae Single-Family Selling & Servicing</a> (standard amortization conventions, accessed 2025).</li>
          </ul>
          <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

          <h2>The Formula Explained</h2>
          <div class="formula-box">
            Standard amortized monthly payment:<br/>
            \\[
              PMT = P \\, \\cdot \\, \\frac{i(1+i)^{n}}{(1+i)^{n}-1}
            \\]
            where \\(P\\) is principal, \\(i = \\tfrac{APR}{12}\\) is the monthly rate, and \\(n\\) the number of months.<br/><br/>
            Remaining total interest for a loan is:
            \\[
              I_{total} = PMT \\cdot n - P
            \\]
            Break-even months approximate when cumulative savings exceed upfront costs \\(C\\):
            \\[
              m_{BE} \\approx \\min\\{m : \\sum_{k=1}^{m} (PMT_{old}-PMT_{new}) \\ge C\\}
            \\]
            (In this tool we compute break-even via a monthly cumulative comparison; if costs are rolled into the new principal, interest on those costs is reflected in \\(PMT_{new}\\).)
          </div>

          <h2>Glossary of Inputs & Outputs</h2>
          <ul>
            <li><strong>Remaining Balance:</strong> Current principal owed on your existing mortgage.</li>
            <li><strong>Remaining Term:</strong> Time left until payoff of your existing loan.</li>
            <li><strong>Current APR / New APR:</strong> Annual Percentage Rate used for interest calculation.</li>
            <li><strong>Closing Costs:</strong> Upfront refinance costs (lender/title/fees; add prepayment penalty if any).</li>
            <li><strong>Discount Points:</strong> Upfront % of loan to lower the interest rate.</li>
            <li><strong>Roll Costs:</strong> Option to add costs/points into new principal (increasing interest over time).</li>
            <li><strong>Monthly Savings:</strong> Old payment minus new payment.</li>
            <li><strong>Break-Even:</strong> Month/date when cumulative savings exceed costs.</li>
            <li><strong>Total Interest + Costs (New):</strong> New loan interest plus all refinance costs (including rolled-in amounts).</li>
          </ul>

          <h2>How It Works: A Step-by-Step Example</h2>
          <p><strong>Example:</strong> Remaining balance $300,000; 25 years left at 6.75% APR. New 30-year loan at 5.75% APR; $4,500 costs; 0 points; costs rolled in. The tool:</p>
          <ol>
            <li>Computes your <em>old</em> payment via the amortization formula with \\(P=300{,}000\\), \\(i=0.0675/12\\), \\(n=300\\).</li>
            <li>Builds the <em>new</em> principal (adds rolled-in costs if selected), then computes the new payment with \\(i=0.0575/12\\) and \\(n=360\\).</li>
            <li>Calculates monthly savings and simulates cumulative savings vs. upfront costs to find the break-even month/date.</li>
            <li>Compares remaining interest on old loan to interest+costs on the new loan to show total savings.</li>
          </ol>

          <h2>Frequently Asked Questions</h2>
          <details>
            <summary>Is a longer new term always better if the rate drops?</summary>
            <p>No. A longer term can lower the monthly payment but often increases total interest paid. Use the totals displayed to gauge true savings.</p>
          </details>
          <details>
            <summary>What if I’m far into my existing mortgage?</summary>
            <p>Late-stage loans are mostly principal; the interest you can avoid may be smaller. The break-even calculator helps you judge if costs are recovered.</p>
          </details>
          <details>
            <summary>How do prepayment penalties affect results?</summary>
            <p>Add the penalty to Closing Costs to correctly reflect break-even and total savings.</p>
          </details>
          <details>
            <summary>Can I simulate paying points to buy down the rate?</summary>
            <p>Yes. Enter points % and adjust New APR to the quoted buy-down rate; the tool includes the points cost (rolled or upfront).</p>
          </details>
          <details>
            <summary>Does the tool include taxes/insurance/HOA?</summary>
            <p>No. It focuses on principal & interest. Add escrow items separately for your full housing payment.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Finance content reviewed by the CalcDomain Editorial Board.<br>
            Last accuracy review: <time datetime="2025-10-30">October 30, 2025</time></p>
          </div>
        </article>
      </section>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-600">
            Ad Placement (300×600)
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-3">Why use this refinance calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>True apples-to-apples: includes closing costs and points (rolled or upfront).</li>
              <li>Break-even month and calendar date based on cumulative savings.</li>
              <li>Export-friendly schedule for the first 24 months.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related tools</h3>
            <ul class="space-y-3 text-sm">
              <li><a href="loan-amortization.html" class="text-blue-600 hover:underline">Loan Amortization Schedule</a></li>
              <li><a href="apr.html" class="text-blue-600 hover:underline">APR Calculator</a></li>
              <li><a href="loan-prepayment.html" class="text-blue-600 hover:underline">Loan Prepayment Planner</a></li>
              <li><a href="debt-avalanche.html" class="text-blue-600 hover:underline">Debt Avalanche Calculator</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  (function(){
    const $ = id => document.getElementById(id);
    const els = {
      currentBalance: $('currentBalance'),
      currentApr: $('currentApr'),
      remainingTerm: $('remainingTerm'),
      newApr: $('newApr'),
      newTerm: $('newTerm'),
      closingCosts: $('closingCosts'),
      pointsPct: $('pointsPct'),
      rollCosts: $('rollCosts'),
      refiMonth: $('refiMonth'),

      oldPayment: $('oldPayment'),
      newPayment: $('newPayment'),
      monthlySavings: $('monthlySavings'),
      breakEven: $('breakEven'),
      oldInterest: $('oldInterest'),
      newInterestPlusCosts: $('newInterestPlusCosts'),

      scheduleBody: $('scheduleBody'),
      mobileToggle: $('mobile-menu-toggle'),
      mobileMenu: $('mobile-menu'),
      resetBtn: $('resetBtn'),
      printBtn: $('printBtn')
    };

    let chart;

    // UI helpers
    function fmtCurrency(v){ return new Intl.NumberFormat(undefined,{style:'currency', currency:'USD', maximumFractionDigits:2}).format(isFinite(v)? v: 0); }
    function fmtInt(v){ return new Intl.NumberFormat().format(Math.round(v||0)); }
    function monthAdd(date, m){
      const d = new Date(date.getTime());
      const day = d.getDate();
      d.setMonth(d.getMonth()+m);
      if (d.getDate() < day) d.setDate(0); // handle month length
      return d;
    }
    function parseMonthInput(val){
      if(!val) return null;
      const [y,m] = val.split('-').map(Number);
      const d = new Date(y, m-1, 1);
      return isNaN(d) ? null : d;
    }

    // Validation
    const fields = [
      {el: els.currentBalance, min:1, errId:'currentBalanceErr', name:'Remaining Balance'},
      {el: els.currentApr, min:0, max:99, errId:'currentAprErr', name:'Current APR'},
      {el: els.remainingTerm, min:0.25, max:40, errId:'remainingTermErr', name:'Remaining Term'},
      {el: els.newApr, min:0, max:99, errId:'newAprErr', name:'New APR'},
      {el: els.newTerm, min:1, max:40, errId:'newTermErr', name:'New Term'},
      {el: els.closingCosts, min:0, errId:'closingCostsErr', name:'Closing Costs'},
      {el: els.pointsPct, min:0, max:10, errId:'pointsErr', name:'Discount Points'}
    ];

    function showErr(id, msg){
      const p = $(id); if(!p) return;
      if(msg){ p.textContent = msg; p.hidden = false; } else { p.hidden = true; p.textContent = ''; }
    }
    function validateField(cfg){
      const v = parseFloat(cfg.el.value);
      const name = cfg.name;
      if(isNaN(v)){ showErr(cfg.errId, `${name} is required.`); return false; }
      if(cfg.min != null && v < cfg.min){ showErr(cfg.errId, `${name} must be ≥ ${cfg.min}.`); return false; }
      if(cfg.max != null && v > cfg.max){ showErr(cfg.errId, `${name} must be ≤ ${cfg.max}.`); return false; }
      showErr(cfg.errId, ''); return true;
    }
    fields.forEach(cfg => cfg.el.addEventListener('blur', ()=>{ validateField(cfg); compute(); }));

    // Accessible help toggles
    document.querySelectorAll('[data-help]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const sel = btn.getAttribute('data-help');
        const panel = document.querySelector(sel);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        panel.hidden = expanded;
      });
    });

    // Mobile menu
    els.mobileToggle.addEventListener('click', ()=>{
      const hidden = els.mobileMenu.classList.contains('hidden');
      els.mobileMenu.classList.toggle('hidden', !hidden);
    });

    // Amortization helpers
    function pmt(P, r, n){
      if (r === 0) return P / n;
      const f = Math.pow(1+r, n);
      return P * (r * f) / (f - 1);
    }
    function remainingInterest(P, r, n){
      const payment = pmt(P,r,n);
      return payment * n - P;
    }

    function buildSchedule(P, r, n, startDate, limitMonths=24){
      const rows = [];
      let bal = P;
      const pay = pmt(P, r, n);
      const start = startDate || new Date();
      for(let k=1; k<=Math.min(n, limitMonths); k++){
        const int = bal * r;
        const princ = Math.min(pay - int, bal);
        bal = Math.max(0, bal - princ);
        const date = monthAdd(start, k);
        rows.push({k, date, pay, int, princ, bal});
      }
      return rows;
    }

    // Break-even via cumulative savings vs. costs
    function breakEvenMonth(oldP, oldR, oldN, newP, newR, newN, upfrontCosts){
      // simulate month-by-month up to the shorter of both terms × 2 as guard
      const horizon = Math.max(oldN, newN);
      const oldPay = pmt(oldP, oldR, oldN);
      const newPay = pmt(newP, newR, newN);
      let cum = -upfrontCosts; // negative until recovered
      let oldBal = oldP, newBal = newP;
      let m = 0;
      for(m=1; m<=horizon; m++){
        // interest portions
        const oldInt = oldBal * oldR;
        const newInt = newBal * newR;
        // payments (cap at remaining when near zero)
        const oldPrin = Math.min(oldPay - oldInt, oldBal);
        const newPrin = Math.min(newPay - newInt, newBal);
        oldBal = Math.max(0, oldBal - oldPrin);
        newBal = Math.max(0, newBal - newPrin);
        // savings this month (payment difference)
        const save = (oldPay - newPay);
        cum += save;
        if(cum >= 0) return m;
        if(oldBal <= 0 && newBal <= 0) break;
      }
      return null; // no break-even within horizon
    }

    function compute(){
      // validate requireds
      let ok = true;
      fields.forEach(cfg => { ok = validateField(cfg) && ok; });
      if(!ok) return;

      const curBal = parseFloat(els.currentBalance.value)||0;
      const curAPR = (parseFloat(els.currentApr.value)||0)/100;
      const curR = curAPR/12;
      const curYears = parseFloat(els.remainingTerm.value)||0;
      const curN = Math.round(curYears*12);

      const newAPR = (parseFloat(els.newApr.value)||0)/100;
      const newR = newAPR/12;
      const newYears = parseFloat(els.newTerm.value)||0;
      const newN = Math.round(newYears*12);

      const costs = Math.max(0, parseFloat(els.closingCosts.value)||0);
      const pointsPct = Math.max(0, parseFloat(els.pointsPct.value)||0)/100;
      const pointsAmt = curBal * pointsPct; // points based on loan amount
      const roll = els.rollCosts.checked;

      // Principal for new loan
      const newPrincipal = roll ? (curBal + costs + pointsAmt) : curBal;
      const upfrontOutOfPocket = roll ? 0 : (costs + pointsAmt);

      // Payments
      const payOld = pmt(curBal, curR, curN);
      const payNew = pmt(newPrincipal, newR, newN);

      // Totals
      const oldIntTotal = remainingInterest(curBal, curR, curN);
      const newIntOnly = remainingInterest(newPrincipal, newR, newN);
      const newTotalWithCosts = newIntOnly + (roll ? 0 : (costs + pointsAmt)); // if rolled, costs effect already in interest via higher principal

      // Savings
      const monthlySavings = payOld - payNew;

      // Break-even
      const beMonths = monthlySavings > 0
        ? breakEvenMonth(curBal, curR, curN, newPrincipal, newR, newN, upfrontOutOfPocket)
        : null;

      let beText = '—';
      if (monthlySavings <= 0 && upfrontOutOfPocket>0){
        beText = 'No break-even (payment not lower)';
      } else if (monthlySavings <= 0 && upfrontOutOfPocket===0){
        beText = 'Payment not lower';
      } else if (beMonths){
        // date
        const refiStart = parseMonthInput(els.refiMonth.value) || new Date();
        const beDate = monthAdd(refiStart, beMonths);
        const fmt = new Intl.DateTimeFormat(undefined, {year:'numeric', month:'short'});
        beText = `${fmtInt(beMonths)} mo • ${fmt.format(beDate)}`;
      }

      // Update UI
      els.oldPayment.textContent = fmtCurrency(payOld);
      els.newPayment.textContent = fmtCurrency(payNew);
      els.monthlySavings.textContent = fmtCurrency(monthlySavings);
      els.breakEven.textContent = beText;
      els.oldInterest.textContent = fmtCurrency(oldIntTotal);
      els.newInterestPlusCosts.textContent = fmtCurrency(newTotalWithCosts);

      // Chart
      const ctx = document.getElementById('costChart');
      const data = {
        labels: ['Old: Remaining Interest', 'New: Interest + Costs'],
        datasets: [{ data: [Math.max(0,oldIntTotal), Math.max(0,newTotalWithCosts)], backgroundColor: ['#1d4ed8','#f97316'] }]
      };
      if(chart){ chart.data = data; chart.update(); }
      else {
        chart = new Chart(ctx, {
          type:'doughnut',
          data,
          options:{ plugins:{ legend:{ position:'bottom' } }, responsive:true, maintainAspectRatio:false }
        });
      }

      // Schedule (first 24 months of new loan)
      const start = parseMonthInput(els.refiMonth.value) || new Date();
      const schedule = buildSchedule(newPrincipal, newR, newN, start, 24);
      const tbody = els.scheduleBody; tbody.innerHTML = '';
      const df = new Intl.DateTimeFormat(undefined,{year:'numeric', month:'short'});
      schedule.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-2 text-left">${r.k}</td>
          <td class="px-4 py-2 text-left">${df.format(r.date)}</td>
          <td class="px-4 py-2">${fmtCurrency(r.pay)}</td>
          <td class="px-4 py-2">${fmtCurrency(r.int)}</td>
          <td class="px-4 py-2">${fmtCurrency(r.princ)}</td>
          <td class="px-4 py-2">${fmtCurrency(r.bal)}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Events
    ['input','change'].forEach(ev=>{
      Object.values({
        currentBalance:els.currentBalance, currentApr:els.currentApr, remainingTerm:els.remainingTerm,
        newApr:els.newApr, newTerm:els.newTerm, closingCosts:els.closingCosts, pointsPct:els.pointsPct,
        rollCosts:els.rollCosts, refiMonth:els.refiMonth
      }).forEach(el => el.addEventListener(ev, compute));
    });

    els.resetBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      els.currentBalance.value = 300000;
      els.currentApr.value = 6.75;
      els.remainingTerm.value = 25;
      els.newApr.value = 5.75;
      els.newTerm.value = 30;
      els.closingCosts.value = 4500;
      els.pointsPct.value = 0;
      els.rollCosts.checked = true;
      els.refiMonth.value = '';
      document.querySelectorAll('.err').forEach(p=>{ p.hidden = true; p.textContent=''; });
      compute();
    });

    els.printBtn.addEventListener('click', (e)=>{ e.preventDefault(); window.print(); });

    // Initialize
    compute();
  })();
  </script>
</body>
</html>
