<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pyramid Calculator — Volume & Surface Area (Square, Rectangle, Regular n-gon)</title>
  <meta name="description" content="Professional pyramid calculator for volume, lateral area, and total surface area. Supports square, rectangular, and regular polygon bases. Accessible, mobile-first, and E-E-A-T optimized." />
  <link rel="canonical" href="https://calcdomain.com/pyramid-calculator.html" />
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --focus: #2563eb; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 600; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .prose p, .prose li { line-height: 1.65; }
    .formula-box {
      background:#f8fafc; border:1px solid #e5e7eb; border-radius:10px; padding:1rem;
      overflow-x:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; }
    .result-card h4 { font-size:.9rem; color:#374151; margin-bottom:.25rem; }
    .result-card p { font-size:1.5rem; font-weight:800; color:#1d4ed8; }
    input[type="number"], select, button, details>summary { min-height:48px; }
    input[type="number"], select { width:100%; }
    .field-error { color:#b91c1c; font-size:.875rem; margin-top:.375rem; }
    .help { color:#4b5563; font-size:.875rem; margin-top:.25rem; }
    .a11y-tooltip { display:none; margin-top:.5rem; background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px; padding:.75rem; }
    .btn { border:1px solid #d1d5db; background:#111827; color:#fff; border-radius:.75rem; padding:.75rem 1rem; font-weight:600; }
    .btn.secondary { background:#fff; color:#111827; }
    .btn:focus-visible, .focusable:focus-visible, input:focus-visible, select:focus-visible, button:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }
    #results-panels { min-height: 210px; } /* prevent CLS when results render */
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; inset: 0; width: 100%; }
      #related, header, footer, aside { display: none !important; }
    }
  </style>

  <!-- JSON-LD: WebApplication (Calculator) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "applicationCategory": "Calculator",
    "name": "Pyramid Calculator",
    "url": "https://calcdomain.com/pyramid-calculator.html",
    "inLanguage": "en",
    "description": "Compute pyramid volume, lateral area, and surface area for square, rectangular, and regular polygon bases.",
    "about": ["Pyramid volume","Pyramid surface area","Square pyramid","Rectangular pyramid","Regular pyramid"],
    "author": { "@type": "Person", "name": "Ugo Candido" },
    "publisher": { "@type": "Organization", "name": "CalcDomain" }
  }
  </script>
  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Math","item":"https://calcdomain.com/math.html"},
      {"@type":"ListItem","position":3,"name":"Geometry","item":"https://calcdomain.com/subcategories/math-geometry.html"},
      {"@type":"ListItem","position":4,"name":"Pyramid Calculator","item":"https://calcdomain.com/pyramid-calculator.html"}
    ]
  }
  </script>
  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to calculate a pyramid's volume and surface area",
    "step":[
      {"@type":"HowToStep","name":"Choose base type","text":"Select Square, Rectangle, or Regular n-gon."},
      {"@type":"HowToStep","name":"Enter base dimensions","text":"Enter side length(s) or polygon sides and side length."},
      {"@type":"HowToStep","name":"Choose given height","text":"Provide vertical height or slant height and the calculator derives the other."},
      {"@type":"HowToStep","name":"Review results","text":"Read volume, base area, lateral area, total surface area, apothem, slant height."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per requirements) -->
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-600 focusable">CalcDomain</a>
      <div class="hidden md:flex items-center gap-6 text-sm">
        <a class="hover:text-blue-600 focusable" href="search.html">Advanced Search</a>
        <a class="hover:text-blue-600 focusable" href="index.html#categories">Categories</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="math.html" class="hover:text-blue-600">Math</a> &raquo;
          <a href="subcategories/math-geometry.html" class="hover:text-blue-600">Geometry</a> &raquo;
          <span class="text-gray-900">Pyramid Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-lg shadow">
          <h1 class="text-3xl font-extrabold mb-2">pyramid calculator</h1>
          <p class="text-gray-700 mb-6">Compute a pyramid’s <strong>volume</strong>, <strong>lateral area</strong>, and <strong>total surface area</strong> for <em>square</em>, <em>rectangular</em>, and <em>regular n-gon</em> bases. Designed for engineers, architects, educators, and students who need reliable, professional-grade results.</p>

          <!-- Calculator -->
          <section id="calculator" class="space-y-6">
            <!-- Base type -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="baseType" class="block text-sm font-medium text-gray-900">Base type *</label>
                <div class="flex items-center gap-2 mt-1">
                  <select id="baseType" aria-required="true" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="square" selected>Square</option>
                    <option value="rectangle">Rectangle</option>
                    <option value="regular">Regular n-gon</option>
                  </select>
                  <button type="button" class="ml-1 px-2 py-2 rounded-md border focusable" aria-expanded="false" aria-controls="tip-baseType" title="Help" data-tooltip>
                    ?
                  </button>
                </div>
                <div id="tip-baseType" class="a11y-tooltip" role="note">
                  Square = equal sides; Rectangle = sides a, b; Regular n-gon = n equal sides with interior symmetry (equilateral & equiangular).
                </div>
              </div>

              <div>
                <label for="givenMode" class="block text-sm font-medium text-gray-900">Given height mode *</label>
                <div class="flex items-center gap-2 mt-1">
                  <select id="givenMode" aria-required="true" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="height" selected>Vertical height h</option>
                    <option value="slant">Slant height l</option>
                  </select>
                  <button type="button" class="ml-1 px-2 py-2 rounded-md border focusable" aria-expanded="false" aria-controls="tip-givenMode" title="Help" data-tooltip>?</button>
                </div>
                <div id="tip-givenMode" class="a11y-tooltip" role="note">
                  Vertical height h = distance from base plane to apex. Slant height l = height of a triangular face measured along its centerline.
                </div>
              </div>
            </div>

            <!-- Base dimensions -->
            <div id="baseFields" class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div data-field="square rectangle regular">
                <label for="sideA" class="block text-sm font-medium text-gray-900">Side a (or side length s) *</label>
                <input type="number" id="sideA" inputmode="decimal" step="any" min="0" aria-required="true" aria-describedby="err-sideA tip-sideA" class="mt-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="4">
                <p id="err-sideA" class="field-error" aria-live="polite"></p>
                <p id="tip-sideA" class="help">For regular n-gon, this is the side length s.</p>
              </div>

              <div data-field="rectangle">
                <label for="sideB" class="block text-sm font-medium text-gray-900">Side b (rectangle only) *</label>
                <input type="number" id="sideB" inputmode="decimal" step="any" min="0" aria-required="true" aria-describedby="err-sideB" class="mt-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="6">
                <p id="err-sideB" class="field-error" aria-live="polite"></p>
              </div>

              <div data-field="regular">
                <label for="nSides" class="block text-sm font-medium text-gray-900">Number of sides n (regular only) *</label>
                <input type="number" id="nSides" inputmode="numeric" step="1" min="3" aria-required="true" aria-describedby="err-nSides" class="mt-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="6">
                <p id="err-nSides" class="field-error" aria-live="polite"></p>
              </div>

              <div>
                <label for="heightOrSlant" class="block text-sm font-medium text-gray-900"><span id="heightLabel">Vertical height h</span> *</label>
                <input type="number" id="heightOrSlant" inputmode="decimal" step="any" min="0" aria-required="true" aria-describedby="err-heightOrSlant tip-height" class="mt-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" value="5">
                <p id="err-heightOrSlant" class="field-error" aria-live="polite"></p>
                <p id="tip-height" class="help">Enter h (if “Vertical height” is selected) or l (if “Slant height” is selected).</p>
              </div>

              <div>
                <label for="units" class="block text-sm font-medium text-gray-900">Units</label>
                <select id="units" class="mt-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="m" selected>m</option>
                  <option value="cm">cm</option>
                  <option value="mm">mm</option>
                  <option value="in">in</option>
                  <option value="ft">ft</option>
                </select>
              </div>
            </div>

            <div class="flex flex-wrap gap-3">
              <button id="calcBtn" class="btn focusable" type="button">Calculate</button>
              <button id="resetBtn" class="btn secondary focusable" type="button">Reset</button>
              <button id="printBtn" class="btn secondary focusable" type="button">Print</button>
            </div>
          </section>

          <!-- Results -->
          <section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6" aria-live="polite">
            <h2 class="text-xl font-semibold mb-4">Results</h2>
            <div id="results-panels" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="result-card"><h4>Volume</h4><p id="res-volume">—</p></div>
              <div class="result-card"><h4>Base area B</h4><p id="res-base">—</p></div>
              <div class="result-card"><h4>Lateral area</h4><p id="res-lateral">—</p></div>
              <div class="result-card"><h4>Total surface area</h4><p id="res-total">—</p></div>
              <div class="result-card"><h4>Slant height l</h4><p id="res-slant">—</p></div>
              <div class="result-card"><h4>Vertical height h</h4><p id="res-height">—</p></div>
              <div class="result-card"><h4>Perimeter p</h4><p id="res-perimeter">—</p></div>
              <div class="result-card"><h4>Apothem a</h4><p id="res-apothem">—</p></div>
            </div>
          </section>
        </div>

        <!-- Authoritative content -->
        <article class="bg-white p-6 rounded-lg shadow mt-8 prose">
          <h2 id="source">Authoritative data source & methodology</h2>
          <p>
            <strong>Primary reference:</strong> Wolfram MathWorld — “Pyramid,” accessed 2025.
            <a href="https://mathworld.wolfram.com/Pyramid.html" class="text-blue-600 underline">Link to source</a>.
            All calculations use standard Euclidean geometry for right pyramids with square, rectangular, or regular polygon bases.
            <br><em>“Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.”</em>
          </p>

          <h2 id="formula">The formula explained</h2>
          <div class="formula-box">
            For any pyramid: \( V=\frac{1}{3}Bh \).<br>
            For a right pyramid with regular \(n\)-gon base (side \(s\), apothem \(a\), perimeter \(p=ns\)):<br>
            \( a=\dfrac{s}{2\tan\left(\pi/n\right)}\), \(\; B=\dfrac{1}{2}pa\), \(\; l=\sqrt{h^{2}+a^{2}}\),<br>
            Lateral area \(A_L=\dfrac{1}{2}pl\), Total area \(A_T=B+A_L\).<br><br>
            For a right rectangular base \(a\times b\): \(B=ab\), \(l_a=\sqrt{h^{2}+\left(\tfrac{b}{2}\right)^{2}}\), \(l_b=\sqrt{h^{2}+\left(\tfrac{a}{2}\right)^{2}}\),<br>
            \(A_L=a\,l_a+b\,l_b\), \(A_T=B+A_L\).
          </div>

          <h2 id="glossary">Glossary of variables</h2>
          <ul>
            <li><strong>h</strong> — vertical height from base plane to apex.</li>
            <li><strong>l</strong> — slant height measured along a face’s centerline.</li>
            <li><strong>B</strong> — base area; <strong>p</strong> — base perimeter.</li>
            <li><strong>a</strong> — apothem of regular base (distance from center to side midpoint).</li>
            <li><strong>A<sub>L</sub></strong> — lateral area; <strong>A<sub>T</sub></strong> — total surface area.</li>
          </ul>

          <h2 id="example">How it works: a step-by-step example</h2>
          <p><em>Scenario:</em> Square base with side \(s=4\;\text{m}\) and height \(h=5\;\text{m}\).</p>
          <ol>
            <li>Base perimeter \(p=4s=16\ \text{m}\); apothem \(a=s/2=2\ \text{m}\).</li>
            <li>Base area \(B=s^2=16\ \text{m}^2\).</li>
            <li>Slant height \(l=\sqrt{h^2+a^2}=\sqrt{25+4}=\sqrt{29}\approx5.385\ \text{m}\).</li>
            <li>Lateral area \(A_L=\tfrac12 p l=0.5\times16\times5.385\approx43.08\ \text{m}^2\).</li>
            <li>Total area \(A_T=B+A_L\approx16+43.08=59.08\ \text{m}^2\).</li>
            <li>Volume \(V=\tfrac13 B h=\tfrac13\times16\times5\approx26.667\ \text{m}^3\).</li>
          </ol>

          <h2 id="faq">Frequently asked questions</h2>
          <details><summary>What shapes does this calculator support?</summary><p>Square, rectangle, and right regular n-gons (n ≥ 3). These cover most practical pyramids used in education and practice.</p></details>
          <details><summary>Can I enter slant height instead of vertical height?</summary><p>Yes. Choose “Slant height l” and the tool will back-solve the vertical height using the base apothem.</p></details>
          <details><summary>How is rectangular pyramid lateral area computed?</summary><p>Using two slant heights \(l_a\) and \(l_b\) along each pair of opposite faces: \(A_L=a\,l_a+b\,l_b\).</p></details>
          <details><summary>What if my pyramid is oblique (apex not above the base center)?</summary><p>This tool targets right pyramids. For oblique pyramids, \(V=\tfrac13Bh\) still holds, but face areas differ; consult a specialized method or finite elements.</p></details>
          <details><summary>Do units matter?</summary><p>Yes. Linear inputs are in your chosen unit; areas return in unit² and volumes in unit³.</p></details>
          <details><summary>Why do I see an error when l is too small?</summary><p>For regular bases, \(l \ge a\) must hold or the apex would lie below the base’s mid-plane. The validator explains when this occurs.</p></details>

          <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
              Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
          </div>
        </article>
      </section>

      <aside id="related" class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-600">Ad Placement (300×600)</div>
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-lg mb-3">Why this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Supports square, rectangular, and regular n-gons.</li>
              <li>Enter height <em>or</em> slant height; we derive the other.</li>
              <li>WCAG-compliant UI with inline validation and tooltips.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-lg mb-4">Related geometry tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a class="text-blue-600 hover:underline" href="prism-calculator.html">Prism Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="cone-calculator.html">Cone Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="frustum-volume.html">Frustum of a Pyramid</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All rights reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-600">About</a>
        <a href="contact.html" class="hover:text-blue-600">Contact</a>
        <a href="privacy.html" class="hover:text-blue-600">Privacy</a>
        <a href="terms.html" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (defer) -->
  <script defer>
    (function(){
      const $ = (id) => document.getElementById(id);
      const baseType = $("baseType");
      const givenMode = $("givenMode");
      const sideA = $("sideA");
      const sideB = $("sideB");
      const nSides = $("nSides");
      const heightOrSlant = $("heightOrSlant");
      const unitsSel = $("units");

      const errA = $("err-sideA");
      const errB = $("err-sideB");
      const errN = $("err-nSides");
      const errH = $("err-heightOrSlant");
      const heightLabel = $("heightLabel");

      const out = {
        volume: $("res-volume"),
        base: $("res-base"),
        lateral: $("res-lateral"),
        total: $("res-total"),
        slant: $("res-slant"),
        height: $("res-height"),
        perimeter: $("res-perimeter"),
        apothem: $("res-apothem")
      };

      const unitFmt = (u) => ({
        L: u,
        A: u+"²",
        V: u+"³"
      });

      // Accessible tooltips toggle
      document.querySelectorAll("[data-tooltip]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("aria-controls");
          const panel = document.getElementById(id);
          const expanded = btn.getAttribute("aria-expanded")==="true";
          btn.setAttribute("aria-expanded", String(!expanded));
          panel.style.display = expanded ? "none" : "block";
        });
        btn.addEventListener("keydown", (e)=>{
          if(e.key==="Enter"||e.key===" "){ e.preventDefault(); btn.click(); }
        });
      });

      // Show/hide base fields depending on base type
      function updateFieldVisibility(){
        const t = baseType.value; // square | rectangle | regular
        document.querySelectorAll("#baseFields [data-field]").forEach(block=>{
          const modes = block.getAttribute("data-field").split(" ");
          block.style.display = modes.includes(t) ? "" : "none";
        });
        // sideB only for rectangle
        if(t!=="rectangle") { sideB && (sideB.value = sideB?.value || ""); }
        // Label for sideA
        const lblA = document.querySelector('label[for="sideA"]');
        if(t==="regular") lblA.innerHTML = 'Side length s *';
        else if(t==="rectangle") lblA.innerHTML = 'Side a *';
        else lblA.innerHTML = 'Side a (square) *';
      }

      function updateGivenMode(){
        if(givenMode.value==="height") heightLabel.textContent = "Vertical height h";
        else heightLabel.textContent = "Slant height l";
      }

      // Validation on blur
      [sideA, sideB, nSides, heightOrSlant].forEach(el=>{
        if(!el) return;
        el.addEventListener("blur", ()=> validateAll(false));
      });

      function setErr(el, msg){
        const map = new Map([[sideA, errA],[sideB, errB],[nSides, errN],[heightOrSlant, errH]]);
        const p = map.get(el);
        if(!p) return;
        p.textContent = msg || "";
        el.setAttribute("aria-invalid", msg ? "true" : "false");
      }

      function validateAll(requireAll=true){
        let ok = true;
        // sideA
        if(baseType.value){
          const v = Number(sideA.value);
          if(!(v>0)){ setErr(sideA, "Please enter a positive number."); ok=false; } else setErr(sideA, "");
        }
        // sideB for rectangle
        if(baseType.value==="rectangle"){
          const v = Number(sideB.value);
          if(!(v>0)){ setErr(sideB, "Please enter a positive number for side b."); ok=false; } else setErr(sideB, "");
        } else setErr(sideB, "");
        // n for regular
        if(baseType.value==="regular"){
          const n = Number(nSides.value);
          if(!(Number.isInteger(n) && n>=3)){ setErr(nSides,"n must be an integer ≥ 3."); ok=false; } else setErr(nSides,"");
        } else setErr(nSides,"");
        // height or slant
        const hv = Number(heightOrSlant.value);
        if(!(hv>0)){ setErr(heightOrSlant,"Please enter a positive number."); ok=false; } else setErr(heightOrSlant,"");
        return ok;
      }

      function perimeterAndApothem(){
        const t = baseType.value;
        if(t==="square"){
          const s = Number(sideA.value);
          return { p: 4*s, a: s/2, B: s*s };
        }
        if(t==="rectangle"){
          const a = Number(sideA.value), b = Number(sideB.value);
          return { p: 2*(a+b), a_apothem: null, B: a*b };
        }
        // regular n-gon
        const n = Number(nSides.value), s = Number(sideA.value);
        const p = n*s;
        const a = s / (2*Math.tan(Math.PI/n));
        const B = 0.5 * p * a;
        return { p, a, B };
      }

      function fmt(v, kind, uMap){
        if(!isFinite(v)) return "—";
        const f = new Intl.NumberFormat(undefined, { maximumFractionDigits: 6 });
        return f.format(v) + " " + (uMap[kind] || "");
      }

      function compute(){
        if(!validateAll(false)) { renderEmpty(); return; }

        const units = unitsSel.value;
        const U = unitFmt(units);

        const t = baseType.value;
        const mode = givenMode.value; // height | slant

        const dims = perimeterAndApothem();

        // Handle each base type
        let B = dims.B;
        let p, a;
        if(t==="rectangle"){
          // special case: no single apothem; compute lateral with two slants
          const aSide = Number(sideA.value);
          const bSide = Number(sideB.value);
          let h, l, l_a, l_b;
          if(mode==="height"){
            h = Number(heightOrSlant.value);
            l_a = Math.sqrt(h*h + (bSide/2)*(bSide/2));
            l_b = Math.sqrt(h*h + (aSide/2)*(aSide/2));
            l = NaN; // not unique
          } else {
            // when slant is given for rectangle, we assume it refers to the face with base side a (common convention is ambiguous).
            // Derive h from provided l against apothem b/2, then recompute the other slant.
            const l_in = Number(heightOrSlant.value);
            const ap_b = bSide/2;
            if(l_in < ap_b){ setErr(heightOrSlant, "Slant l must be ≥ b/2 for a rectangular base."); renderEmpty(); return; }
            const h2 = l_in*l_in - ap_b*ap_b;
            const h = Math.sqrt(h2);
            l_a = Math.sqrt(h*h + (bSide/2)*(bSide/2)); // equals l_in
            l_b = Math.sqrt(h*h + (aSide/2)*(aSide/2));
            l = NaN;
          }
          const AL = aSide*l_a + bSide*l_b;
          const AT = B + AL;
          const V = (B * (mode==="height" ? Number(heightOrSlant.value) : Math.sqrt(Math.max(0,(Number(heightOrSlant.value))**2 - (bSide/2)**2)))) / 3;

          out.volume.textContent   = fmt(V, "V", U);
          out.base.textContent     = fmt(B, "A", U);
          out.lateral.textContent  = fmt(AL, "A", U);
          out.total.textContent    = fmt(AT, "A", U);
          out.perimeter.textContent= fmt(2*(aSide+bSide), "L", U);
          out.apothem.textContent  = "—";
          out.slant.textContent    = isNaN(l) ? "—" : fmt(l, "L", U);
          out.height.textContent   = fmt(mode==="height" ? Number(heightOrSlant.value) : Math.sqrt(Math.max(0,(Number(heightOrSlant.value))**2 - (bSide/2)**2)), "L", U);
          return;
        }

        // Square or regular n-gon
        if(t==="square"){
          const s = Number(sideA.value);
          p = 4*s;
          a = s/2;
          B = s*s;
        } else {
          p = dims.p; a = dims.a; B = dims.B;
        }

        let h, l;
        if(givenMode.value==="height"){
          h = Number(heightOrSlant.value);
          l = Math.sqrt(h*h + a*a);
        } else {
          l = Number(heightOrSlant.value);
          if(l < a){
            setErr(heightOrSlant, "Slant l must be ≥ the base apothem a.");
            renderEmpty(); return;
          }
          h = Math.sqrt(l*l - a*a);
        }

        const AL = 0.5 * p * l;
        const AT = B + AL;
        const V  = (B * h) / 3;

        out.volume.textContent    = fmt(V, "V", U);
        out.base.textContent      = fmt(B, "A", U);
        out.lateral.textContent   = fmt(AL, "A", U);
        out.total.textContent     = fmt(AT, "A", U);
        out.perimeter.textContent = fmt(p, "L", U);
        out.apothem.textContent   = fmt(a, "L", U);
        out.slant.textContent     = fmt(l, "L", U);
        out.height.textContent    = fmt(h, "L", U);
      }

      function renderEmpty(){
        Object.values(out).forEach(el=> el.textContent="—");
      }

      function resetAll(){
        baseType.value = "square";
        givenMode.value = "height";
        sideA.value = 4;
        if(sideB) sideB.value = 6;
        if(nSides) nSides.value = 6;
        heightOrSlant.value = 5;
        unitsSel.value = "m";
        [errA, errB, errN, errH].forEach(e=> e.textContent="");
        updateFieldVisibility();
        updateGivenMode();
        renderEmpty();
      }

      baseType.addEventListener("change", ()=>{ updateFieldVisibility(); compute(); });
      givenMode.addEventListener("change", ()=>{ updateGivenMode(); compute(); });
      [sideA, sideB, nSides, heightOrSlant, unitsSel].forEach(el=> el && el.addEventListener("input", compute));

      $("calcBtn").addEventListener("click", compute);
      $("resetBtn").addEventListener("click", resetAll);
      $("printBtn").addEventListener("click", ()=> window.print());

      // init
      updateFieldVisibility();
      updateGivenMode();
      compute();
    })();
  </script>
</body>
</html>
