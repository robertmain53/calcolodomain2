<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Personal Loan Calculator | Payments, Interest &amp; Payoff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Estimate monthly personal loan payments, total interest, payoff date, and savings from extra payments. Model origination fees (financed or upfront) and see a full amortization schedule."/>
  <meta name="author" content="Ugo Candido"/>
  <link rel="canonical" href="https://calcdomain.com/personal-loan.html"/>
  <meta name="theme-color" content="#0b3d69"/>
  <meta name="robots" content="index, follow"/>
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Personal Loan Calculator"/>
  <meta property="og:description" content="Calculate payments, interest, payoff timing, and savings with extra payments for personal loans."/>
  <meta property="og:url" content="https://calcdomain.com/personal-loan.html"/>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p { margin-bottom: .9rem; line-height: 1.7; }
    .prose ul { list-style: disc; padding-left: 1.25rem; }
    .prose ol { list-style: decimal; padding-left: 1.25rem; }
    details > summary { cursor: pointer; font-weight: 600; }
    details[open] > summary { margin-bottom: .5rem; }
    .eeat { display:grid; gap:0.75rem; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); font-size:0.875rem; color:#374151; }
    @media (min-width: 768px) { .eeat { grid-template-columns:repeat(4,minmax(0,1fr)); } }
    .eeat span { display:block; background:#f9fafb; border:1px solid #e5e7eb; border-radius:0.5rem; padding:0.75rem 1rem; }
    .result-pill { display:inline-flex; align-items:center; font-size:0.875rem; font-weight:600; padding:0.25rem 0.75rem; border-radius:9999px; }
    .formula-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius:0.75rem; padding:1rem; overflow:auto; }
    .formula-box mjx-container { overflow-x:auto; }
    .sticky-ad { height: 600px; }
  </style>

  <script src="search.js" defer></script>

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://calcdomain.com/"},
      {"@type":"ListItem","position":2,"name":"Finance","item":"https://calcdomain.com/finance.html"},
      {"@type":"ListItem","position":3,"name":"Personal Loans","item":"https://calcdomain.com/subcategories/finance-personal-loans.html"},
      {"@type":"ListItem","position":4,"name":"Personal Loan Calculator","item":"https://calcdomain.com/personal-loan.html"}
    ]
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Personal Loan Calculator",
    "url":"https://calcdomain.com/personal-loan.html",
    "description":"Estimate monthly payments, total interest, payoff time, and savings from extra payments on personal loans.",
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "author":{"@type":"Person","name":"Ugo Candido"},
    "mainEntity":{
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"What formula does this calculator use?","acceptedAnswer":{"@type":"Answer","text":"We apply the level-payment amortization formula M = P·r / (1 − (1 + r)^−n) where r is APR/12 and n is months. Zero-interest loans fall back to P / n."}},
        {"@type":"Question","name":"How are origination fees handled?","acceptedAnswer":{"@type":"Answer","text":"Choose whether the fee is financed (added to principal) or paid upfront (deducted from cash disbursed) to see the impact on payments and total cost."}},
        {"@type":"Question","name":"Can I add extra monthly payments?","acceptedAnswer":{"@type":"Answer","text":"Yes. Enter an extra monthly payment to simulate faster payoff and interest saved. The tool recalculates the schedule month by month."}}
      ]
    }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to model a personal loan",
    "description":"Example using $10,000 principal, 11% APR, 36 months, 5% origination fee paid upfront, and $50 extra per month.",
    "step":[
      {"@type":"HowToStep","name":"Enter loan amount","text":"Amount borrowed before fees. Example: $10,000."},
      {"@type":"HowToStep","name":"Set APR and term","text":"APR 11% with a 36 month term (3 years)."},
      {"@type":"HowToStep","name":"Add fee and extra payment","text":"Origination fee 5% paid upfront, plus $50 in extra monthly payments."},
      {"@type":"HowToStep","name":"Review results","text":"Monthly payment ≈ $327.37; total interest ≈ $1,785; payoff about 2 months early with $135 interest saved."}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-800">

  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

        <div class="w-full max-w-md hidden md:block mx-8">
          <div class="relative">
            <input id="search-input" type="search" placeholder="Search for a calculator..."
                   class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   autocomplete="off">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
          </div>
        </div>

        <div class="hidden md:flex items-center space-x-6">
          <a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>

        <button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Toggle menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <div id="mobile-menu" class="md:hidden mt-4 hidden">
        <div class="mb-4">
          <div class="relative">
            <input id="mobile-search-input" type="search" placeholder="Search calculators..."
                   class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        <div class="space-y-2">
          <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
          <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <section class="w-full lg:w-2/3">
        <nav class="text-sm mb-4 text-gray-600" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
          <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
          <a href="subcategories/finance-personal-loans.html" class="hover:text-blue-600">Personal Loans</a> &raquo;
          <span class="text-gray-900 font-medium">Personal Loan</span>
        </nav>

        <section class="bg-white p-6 rounded-lg shadow-md" aria-labelledby="calc-title">
          <h1 id="calc-title" class="text-3xl font-extrabold mb-2 text-slate-800">Personal Loan Calculator</h1>
          <p class="text-gray-600 mb-6">Estimate monthly payments, total cost, and interest saved from extra payments. Model origination fees, APR, term, and optional extra contributions to see a full payoff timeline.</p>

          <div class="eeat mb-6">
            <span><strong>Author:</strong> Ugo Candido</span>
            <span><strong>Reviewed by:</strong> Finance Content Editor</span>
            <span><strong>Last updated:</strong> <time id="lastUpdated"></time></span>
            <span><strong>Category:</strong> Finance → Personal Loans</span>
          </div>

          <div id="calculator-ui" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="loanAmount" class="block text-sm font-medium text-gray-700">Loan amount *</label>
              <div class="relative">
                <input id="loanAmount" type="number" inputmode="decimal" min="0" step="0.01" value="10000"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="loanAmountErr" aria-required="true">
                <span id="loanAmountSymbol" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">$</span>
              </div>
              <p id="loanAmountErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="apr" class="block text-sm font-medium text-gray-700">APR (%) *</label>
              <div class="relative">
                <input id="apr" type="number" inputmode="decimal" min="0" max="1000" step="0.01" value="11"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="aprErr" aria-required="true">
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">%</span>
              </div>
              <p id="aprErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Term *</label>
              <div class="flex gap-3">
                <input id="termValue" type="number" inputmode="numeric" min="1" step="1" value="36"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="termErr" aria-required="true">
                <select id="termUnit" class="mt-1 w-32 px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option value="months" selected>Months</option>
                  <option value="years">Years</option>
                </select>
              </div>
              <p id="termErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="origFee" class="block text-sm font-medium text-gray-700">Origination fee (%)</label>
              <div class="relative">
                <input id="origFee" type="number" inputmode="decimal" min="0" max="100" step="0.01"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="origFeeErr">
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">%</span>
              </div>
              <p id="origFeeErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>

              <fieldset class="mt-3 border border-gray-200 rounded-md p-2" aria-labelledby="feeModeLabel">
                <legend id="feeModeLabel" class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Fee treatment</legend>
                <div class="flex gap-3">
                  <label class="flex items-center gap-2 text-sm text-gray-700">
                    <input type="radio" name="feeMode" id="feeUpfront" value="upfront" class="text-blue-600" checked>
                    <span>Paid upfront (deducted)</span>
                  </label>
                  <label class="flex items-center gap-2 text-sm text-gray-700">
                    <input type="radio" name="feeMode" id="feeFinanced" value="financed" class="text-blue-600">
                    <span>Financed (added to loan)</span>
                  </label>
                </div>
              </fieldset>
            </div>

            <div>
              <label for="extraPayment" class="block text-sm font-medium text-gray-700">Extra monthly payment</label>
              <div class="relative">
                <input id="extraPayment" type="number" inputmode="decimal" min="0" step="0.01"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md pr-12 focus:ring-blue-500 focus:border-blue-500"
                       aria-describedby="extraPaymentErr">
                <span id="extraSymbol" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold">$</span>
              </div>
              <p id="extraPaymentErr" class="text-xs text-red-600 min-h-[1rem]" role="alert" aria-live="polite"></p>
            </div>

            <div>
              <label for="startMonth" class="block text-sm font-medium text-gray-700">Start month</label>
              <input id="startMonth" type="month"
                     class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
              <p class="text-xs text-gray-500 mt-1">Used to estimate the payoff month.</p>
            </div>
          </div>

          <div class="mt-6 flex flex-wrap gap-3">
            <button id="calculate" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Calculate
            </button>
            <button id="reset" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-md border border-gray-300 text-gray-700 font-semibold hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Reset
            </button>
            <button id="example" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-md border border-blue-300 text-blue-700 font-semibold hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Load example
            </button>
          </div>

          <div id="results" class="mt-8 bg-blue-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Results</h3>
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <div class="border-b pb-3">
                <span class="block text-gray-600">Monthly payment</span>
                <span id="paymentValue" class="text-2xl font-extrabold text-blue-700">$0.00</span>
                <span id="extraNote" class="block text-xs text-gray-500 mt-1">No extra payments applied</span>
              </div>
              <div class="border-b pb-3">
                <span class="block text-gray-600">Total interest</span>
                <span id="totalInterestValue" class="text-2xl font-extrabold text-green-700">$0.00</span>
                <span id="interestSavedValue" class="block text-xs text-gray-500 mt-1">Interest saved with extra: $0.00</span>
              </div>
              <div class="border-b pb-3">
                <span class="block text-gray-600">Total paid (incl. financed fee)</span>
                <span id="totalCostValue" class="text-2xl font-extrabold text-gray-800">$0.00</span>
                <span id="disbursedValue" class="block text-xs text-gray-500 mt-1">Net amount disbursed: $0.00</span>
              </div>
              <div>
                <span class="block text-gray-600">Months to payoff</span>
                <span id="termMonthsValue" class="text-xl font-semibold text-gray-800">0</span>
                <span id="termReductionValue" class="block text-xs text-gray-500 mt-1">Reduction vs scheduled: 0 months</span>
              </div>
              <div>
                <span class="block text-gray-600">Estimated payoff date</span>
                <span id="payoffDateValue" class="text-xl font-semibold text-gray-800">—</span>
                <span id="startEcho" class="block text-xs text-gray-500 mt-1">Start: —</span>
              </div>
              <div>
                <span class="block text-gray-600">APR &amp; rate</span>
                <span id="aprValue" class="text-xl font-semibold text-gray-800">—</span>
                <span id="rateValue" class="block text-xs text-gray-500 mt-1">Monthly rate r: —</span>
              </div>
            </div>
          </div>

          <section class="mt-8">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-xl font-semibold text-gray-800">Amortization schedule</h2>
              <button id="toggleSchedule" type="button" class="text-sm font-semibold text-blue-600 hover:text-blue-700">
                Show full schedule
              </button>
            </div>
            <div class="overflow-auto border border-gray-200 rounded-lg">
              <table class="min-w-full text-sm">
                <caption class="sr-only">Amortization schedule with optional extra payments</caption>
                <thead class="bg-slate-100 text-gray-700">
                  <tr>
                    <th class="py-2 px-3 text-left font-semibold">#</th>
                    <th class="py-2 px-3 text-right font-semibold">Payment</th>
                    <th class="py-2 px-3 text-right font-semibold">Interest</th>
                    <th class="py-2 px-3 text-right font-semibold">Principal</th>
                    <th class="py-2 px-3 text-right font-semibold">Extra</th>
                    <th class="py-2 px-3 text-right font-semibold">Balance</th>
                  </tr>
                </thead>
                <tbody id="scheduleBody">
                  <tr>
                    <td colspan="6" class="py-6 px-3 text-center text-gray-500">Enter loan details to generate the schedule.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </section>

        <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
          <h2>Data Source and Methodology</h2>
          <p>The calculator follows the Truth in Lending (Regulation Z) Appendix J methodology for closed-end credit. Monthly payments use level-payment amortization where the periodic rate is APR divided by 12. When you add extra payments, the tool simulates the loan month by month, applying each extra amount to principal to compute savings and the new payoff date.</p>

          <h2>Formulas Used</h2>
          <div class="formula-box">
            <p><strong>Periodic rate:</strong> \( r = \dfrac{\text{APR}}{12} \)</p>
            <p><strong>Payment amount:</strong> \( M = \dfrac{P \cdot r}{1 - (1 + r)^{-n}} \) (if \(r &gt; 0\); otherwise \(M = P / n\))</p>
            <p><strong>Interest per period:</strong> \( \text{Interest}_t = B_{t-1} \cdot r \)</p>
            <p><strong>Principal with extra \(E\):\)</strong> \( \text{Principal}_t = \min\!\big(M + E - \text{Interest}_t,\; B_{t-1}\big) \)</p>
            <p><strong>Balance update:</strong> \( B_t = \max\!\big(B_{t-1} - \text{Principal}_t,\; 0\big) \)</p>
          </div>

          <h2>Worked Example</h2>
          <p>Borrow $10,000 at 11% APR for 36 months with a 5% origination fee paid upfront and $50 extra per month:</p>
          <ol>
            <li>Scheduled payment (no extra) ≈ $327.37.</li>
            <li>Financed principal remains $10,000, but cash disbursed is $9,500 after the fee.</li>
            <li>With $50 extra per month, payoff occurs roughly 2 months sooner.</li>
            <li>Total interest drops from ≈ $1,861 to ≈ $1,726, saving ≈ $135.</li>
          </ol>
        </article>
        <section class="bg-white p-6 rounded-lg shadow-md mt-8">
          <h2 class="text-xl font-semibold text-gray-900 mb-3">Need more help?</h2>
          <p class="text-sm text-gray-600 leading-relaxed">
            Explore the full suite of <a href="subcategories/finance-personal-loans.html" class="text-blue-600 hover:underline">personal loan calculators</a>
            or visit the <a href="subcategories/finance-loans-debt.html" class="text-blue-600 hover:underline">Loans &amp; Debt hub</a> for broader debt payoff strategies.
          </p>
        </section>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24">
          <div class="bg-gray-200 rounded-lg mb-6 flex items-center justify-center sticky-ad">
            <p class="text-gray-500">Sticky Ad Unit (300×600)</p>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="font-bold text-lg mb-4">Related personal loan tools</h3>
            <ul class="space-y-3">
              <li><a class="text-blue-600 hover:underline" href="simple-loan.html">Simple Loan Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-payoff.html">Loan Payoff Planner</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-prepayment.html">Prepayment Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="loan-amortization.html">Loan Amortization Schedule</a></li>
            </ul>
          </div>
        </div>
      </aside>

    </div>
  </main>

  <footer class="bg-white border-t mt-12">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);

    const els = {
      amount: $('loanAmount'),
      apr: $('apr'),
      termValue: $('termValue'),
      termUnit: $('termUnit'),
      origFee: $('origFee'),
      feeUpfront: $('feeUpfront'),
      feeFinanced: $('feeFinanced'),
      extra: $('extraPayment'),
      startMonth: $('startMonth'),
      amountSymbol: $('loanAmountSymbol'),
      extraSymbol: $('extraSymbol'),

      amountErr: $('loanAmountErr'),
      aprErr: $('aprErr'),
      termErr: $('termErr'),
      origFeeErr: $('origFeeErr'),
      extraErr: $('extraPaymentErr'),

      paymentValue: $('paymentValue'),
      totalInterestValue: $('totalInterestValue'),
      totalCostValue: $('totalCostValue'),
      termMonthsValue: $('termMonthsValue'),
      termReductionValue: $('termReductionValue'),
      payoffDateValue: $('payoffDateValue'),
      interestSavedValue: $('interestSavedValue'),
      disbursedValue: $('disbursedValue'),
      aprValue: $('aprValue'),
      rateValue: $('rateValue'),
      extraNote: $('extraNote'),
      startEcho: $('startEcho'),

      toggleSchedule: $('toggleSchedule'),
      scheduleBody: $('scheduleBody'),

      calculate: $('calculate'),
      reset: $('reset'),
      example: $('example'),
      lastUpdated: $('lastUpdated'),
      ui: $('calculator-ui')
    };

    const CURRENCY_SYMBOL = { USD: '$', EUR: '€', GBP: '£', AUD: 'A$', CAD: 'C$' };

    let fullSchedule = [];
    let showFullSchedule = false;

    const fmtCurrency = (value) => {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
    };
    const fmtNumber = (value, decimals = 2) => (isFinite(value) ? value.toFixed(decimals) : '0.00');

    function updateCurrencySymbols() {
      const sym = CURRENCY_SYMBOL['USD'] || '$';
      els.amountSymbol.textContent = sym;
      els.extraSymbol.textContent = sym;
    }

    function setError(input, errEl, message) {
      if (!errEl) return;
      if (message) {
        errEl.textContent = message;
        input?.setAttribute('aria-invalid', 'true');
      } else {
        errEl.textContent = '';
        input?.setAttribute('aria-invalid', 'false');
      }
    }

    function validateAmount() {
      const value = parseFloat(els.amount.value);
      if (!(value > 0)) {
        setError(els.amount, els.amountErr, 'Enter a loan amount greater than zero.');
        return false;
      }
      setError(els.amount, els.amountErr, '');
      return true;
    }

    function validateApr() {
      const value = parseFloat(els.apr.value);
      if (!(value >= 0) || value > 1000) {
        setError(els.apr, els.aprErr, 'Enter an APR between 0 and 1000%.');
        return false;
      }
      setError(els.apr, els.aprErr, '');
      return true;
    }

    function validateTerm() {
      const raw = parseFloat(els.termValue.value);
      if (!(raw > 0)) {
        setError(els.termValue, els.termErr, 'Enter a positive term.');
        return false;
      }
      if (els.termUnit.value === 'years' && raw * 12 > 1200) {
        setError(els.termValue, els.termErr, 'Term cannot exceed 100 years.');
        return false;
      }
      if (els.termUnit.value === 'months' && raw > 1200) {
        setError(els.termValue, els.termErr, 'Months cannot exceed 1200.');
        return false;
      }
      setError(els.termValue, els.termErr, '');
      return true;
    }

    function validateOrigFee() {
      const value = parseFloat(els.origFee.value);
      if (els.origFee.value.trim() === '') {
        setError(els.origFee, els.origFeeErr, '');
        return true;
      }
      if (!(value >= 0) || value > 100) {
        setError(els.origFee, els.origFeeErr, 'Enter a fee percentage between 0 and 100.');
        return false;
      }
      setError(els.origFee, els.origFeeErr, '');
      return true;
    }

    function validateExtra() {
      const value = parseFloat(els.extra.value);
      if (els.extra.value.trim() === '') {
        setError(els.extra, els.extraErr, '');
        return true;
      }
      if (!(value >= 0)) {
        setError(els.extra, els.extraErr, 'Extra payment cannot be negative.');
        return false;
      }
      setError(els.extra, els.extraErr, '');
      return true;
    }

    function parseInputs() {
      const amount = parseFloat(els.amount.value);
      const apr = parseFloat(els.apr.value);
      const termRaw = parseFloat(els.termValue.value);
      const termUnit = els.termUnit.value;
      const feePct = parseFloat(els.origFee.value) || 0;
      const feeMode = els.feeFinanced.checked ? 'financed' : 'upfront';
      const extra = parseFloat(els.extra.value) || 0;
      const startVal = els.startMonth.value;

      const months = termUnit === 'years' ? Math.round(termRaw * 12) : Math.round(termRaw);
      return { amount, apr, months, feePct, feeMode, extra, startVal };
    }

    function buildSchedule(rows) {
      const tbody = els.scheduleBody;
      tbody.innerHTML = '';
      if (!rows.length) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'py-6 px-3 text-center text-gray-500';
        td.textContent = 'Enter loan details to generate the schedule.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      const limit = showFullSchedule ? rows.length : Math.min(rows.length, 12);
      rows.slice(0, limit).forEach((row) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3 text-left">${row.index}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.payment)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.interest)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.principal)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.extra)}</td>
          <td class="py-2 px-3 text-right">${fmtCurrency(row.balance)}</td>
        `;
        tbody.appendChild(tr);
      });

      if (!showFullSchedule && rows.length > limit) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'py-3 px-3 text-center text-gray-500';
        td.textContent = `Showing the first ${limit} of ${rows.length} payments.`;
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    function compute() {
      const okAmount = validateAmount();
      const okApr = validateApr();
      const okTerm = validateTerm();
      const okFee = validateOrigFee();
      const okExtra = validateExtra();
      const valid = okAmount && okApr && okTerm && okFee && okExtra;

      if (!valid) {
        showFullSchedule = false;
        els.toggleSchedule.textContent = 'Show full schedule';
        fullSchedule = [];
        buildSchedule(fullSchedule);
        els.paymentValue.textContent = fmtCurrency(0);
        els.totalInterestValue.textContent = fmtCurrency(0);
        els.totalCostValue.textContent = fmtCurrency(0);
        els.termMonthsValue.textContent = '0';
        els.termReductionValue.textContent = 'Reduction vs scheduled: 0 months';
        els.payoffDateValue.textContent = '—';
        els.interestSavedValue.textContent = `Interest saved with extra: ${fmtCurrency(0)}`;
        els.disbursedValue.textContent = `Net amount disbursed: ${fmtCurrency(0)}`;
        els.aprValue.textContent = '—';
        els.rateValue.textContent = 'Monthly rate r: —';
        els.extraNote.textContent = 'No extra payments applied';
        els.startEcho.textContent = 'Start: —';
        return;
      }

      const { amount, apr, months, feePct, feeMode, extra, startVal } = parseInputs();

      const feeAmount = amount * (feePct / 100);
      const principal = feeMode === 'financed' ? amount + feeAmount : amount;
      const disbursed = feeMode === 'financed' ? amount : amount - feeAmount;

      const rate = (apr / 100) / 12;
      const payment = rate === 0 ? principal / months : (principal * rate) / (1 - Math.pow(1 + rate, -months));
      const baseTotalInterest = payment * months - principal;

      let balance = principal;
      let totalInterest = 0;
      let period = 0;
      const rows = [];
      const buildRows = months <= 480;
      const paymentWithExtra = payment + extra;

      while (balance > 0 && period < months + 1200) {
        period += 1;
        const interestPortion = balance * rate;
        let principalPortion = paymentWithExtra - interestPortion;

        if (rate === 0) {
          principalPortion = Math.min(paymentWithExtra, balance);
        } else if (principalPortion <= 0) {
          principalPortion = 0.01;
        }

        if (principalPortion > balance) {
          principalPortion = balance;
        }

        const actualPayment = principalPortion + interestPortion;
        balance = Math.max(0, balance - principalPortion);
        totalInterest += interestPortion;

        if (buildRows) {
          rows.push({
            index: period,
            payment: actualPayment,
            interest: interestPortion,
            principal: principalPortion,
            extra,
            balance
          });
        }

        if (balance <= 0) {
          break;
        }
      }

      const actualMonths = period;
      const interestSaved = Math.max(0, baseTotalInterest - totalInterest);
      const reductionMonths = Math.max(0, months - actualMonths);
      const totalCost = principal + totalInterest;

      els.paymentValue.textContent = fmtCurrency(payment);
      els.totalInterestValue.textContent = fmtCurrency(totalInterest);
      els.totalCostValue.textContent = fmtCurrency(totalCost);
      els.termMonthsValue.textContent = String(actualMonths);
      els.termReductionValue.textContent = `Reduction vs scheduled: ${reductionMonths} month${reductionMonths === 1 ? '' : 's'}`;
      els.interestSavedValue.textContent = `Interest saved with extra: ${fmtCurrency(interestSaved)}`;
      els.disbursedValue.textContent = `Net amount disbursed: ${fmtCurrency(disbursed)}`;
      els.aprValue.textContent = `${fmtNumber(apr, 3)}%`;
      els.rateValue.textContent = `Monthly rate r: ${fmtNumber(rate * 100, 3)}%`;
      els.extraNote.textContent = extra > 0 ? `Extra applied monthly: ${fmtCurrency(extra)} (final payment may be smaller)` : 'No extra payments applied';

      let start = new Date();
      if (startVal) {
        const [year, month] = startVal.split('-').map(Number);
        const parsed = new Date(year, (month || 1) - 1, 1);
        if (!Number.isNaN(parsed.valueOf())) {
          start = parsed;
        }
      }
      const payoff = new Date(start.getFullYear(), start.getMonth() + actualMonths, 1);
      const fmtMonthYear = (date) => date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
      els.startEcho.textContent = `Start: ${fmtMonthYear(start)}`;
      els.payoffDateValue.textContent = fmtMonthYear(payoff);

      fullSchedule = rows;
      els.toggleSchedule.textContent = showFullSchedule ? 'Show first 12 payments' : 'Show full schedule';
      buildSchedule(fullSchedule);
    }

    function resetForm() {
      els.amount.value = 10000;
      els.apr.value = 11;
      els.termValue.value = 36;
      els.termUnit.value = 'months';
      els.origFee.value = '';
      els.feeUpfront.checked = true;
      els.extra.value = '';
      const now = new Date();
      els.startMonth.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

      setError(els.amount, els.amountErr, '');
      setError(els.apr, els.aprErr, '');
      setError(els.termValue, els.termErr, '');
      setError(els.origFee, els.origFeeErr, '');
      setError(els.extra, els.extraErr, '');

      showFullSchedule = false;
      els.toggleSchedule.textContent = 'Show full schedule';
      compute();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      els.lastUpdated.textContent = today.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' });
      updateCurrencySymbols();

      if (!els.startMonth.value) {
        const now = new Date();
        els.startMonth.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
      }

      const triggerCompute = () => compute();
      els.ui.addEventListener('input', triggerCompute);
      ['feeUpfront', 'feeFinanced'].forEach(id => $(id).addEventListener('change', triggerCompute));

      els.calculate.addEventListener('click', compute);
      els.reset.addEventListener('click', resetForm);
      els.example.addEventListener('click', () => {
        els.amount.value = 10000;
        els.apr.value = 11;
        els.termUnit.value = 'months';
        els.termValue.value = 36;
        els.origFee.value = 5;
        els.feeUpfront.checked = true;
        els.extra.value = 50;
        const now = new Date();
        els.startMonth.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        compute();
      });

      els.toggleSchedule.addEventListener('click', () => {
        if (!fullSchedule.length) return;
        showFullSchedule = !showFullSchedule;
        els.toggleSchedule.textContent = showFullSchedule ? 'Show first 12 payments' : 'Show full schedule';
        buildSchedule(fullSchedule);
      });

      compute();

      const toggle = $('mobile-menu-toggle');
      const menu = $('mobile-menu');
      toggle?.addEventListener('click', () => menu?.classList.toggle('hidden'));
    });
  </script>
</body>
</html>
