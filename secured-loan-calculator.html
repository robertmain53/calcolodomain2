<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secured Loan Calculator - Calculate Payments &amp; Total Cost</title>
<meta name="description" content="Calculate monthly payments, total interest, and amortization schedule for a secured loan. Enter loan amount, interest rate, and term to see your results.">
<link rel="canonical" href="https://calcdomain.com/secured-loan-calculator.html"/>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
text-align: center; font-size: 1.25rem;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }
.result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; }
.result-card p { font-size: 1.75rem; font-weight: 700; color: #2563eb; }
/* WCAG 2.1 AA Visible Focus */
input:focus-visible, select:focus-visible, button:focus-visible, [tabindex]:focus-visible {
outline: 3px solid #3b82f6 !important; /* Tailwind blue-600 */
outline-offset: 1px;
}
/* Hide spin buttons on number inputs for a cleaner look */
input[type=number] { -moz-appearance: textfield; }
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
-webkit-appearance: none;
margin: 0;
}
@media print {
body * { visibility: hidden; }
#print-section, #print-section * { visibility: visible; }
#print-section { position: absolute; left: 0; top: 0; width: 100%; }
#results-chart-container { display: none !important; }
}
</style>

<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "WebPage",
"name": "Secured Loan Calculator",
"description": "Calculate monthly payments, total interest, and amortization schedule for a secured loan.",
"url": "https://calcdomain.com/secured-loan-calculator.html",
"inLanguage": "en",
"author": { "@type": "Person", "name": "Ugo Candido" },
"publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
{ "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
{ "@type": "ListItem", "position": 2, "name": "Finance", "item": "https://calcdomain.com/finance.html" },
{ "@type": "ListItem", "position": 3, "name": "Loans & Debt", "item": "https://calcdomain.com/subcategories/finance-loans-debt.html" },
{ "@type": "ListItem", "position": 4, "name": "Secured Loan Calculator", "item": "https://calcdomain.com/secured-loan-calculator.html" }
]
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "HowTo",
"name": "How to Use the Secured Loan Calculator",
"description": "A step-by-step guide to calculating your secured loan payments.",
"step": [
{"@type": "HowToStep", "name": "Enter Loan Amount", "text": "Input the total amount you wish to borrow."},
{"@type": "HowToStep", "name": "Enter Interest Rate", "text": "Provide the annual percentage rate (APR) for the loan."},
{"@type": "HowToStep", "name": "Enter Loan Term", "text": "Specify the total duration of the loan (in years or months)."},
{"@type": "HowToStep", "name": "Review Results", "text": "See your payment per period, total interest paid, and a full amortization schedule."}
]
}
</script>
<script src="search.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
<a href="subcategories/finance-loans-debt.html" class="hover:text-blue-600">Loans &amp; Debt</a> &raquo;
<span class="text-gray-900">Secured Loan Calculator</span>
</nav>

<div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Secured Loan Calculator</h1>
<p class="text-gray-600 mb-6">This tool helps you estimate the periodic payments and total interest for a secured loan, such as a homeowner loan or auto loan. Enter your loan details to understand the full cost and repayment structure.</p>

<section id="calculator-ui" aria-labelledby="calculator-heading">
<h2 id="calculator-heading" class="sr-only">Loan Input Form</h2>
<form id="loan-form" class="space-y-6" onsubmit="return false;">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="loanAmount" class="block text-sm font-medium text-gray-700">Loan Amount <span class="text-red-600" aria-hidden="true">*</span></label>
<div class="mt-1 relative rounded-md shadow-sm">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
<span class="text-gray-500 sm:text-sm">$</span>
</div>
<input type="number" id="loanAmount" value="50000" step="1000" min="0" aria-required="true" aria-describedby="loanAmount-error"
class="block w-full px-3 py-2 pl-7 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
</div>
<p id="loanAmount-error" class="text-sm text-red-600 mt-1" role="alert" style="display: none;"></p>
</div>

<div>
<label for="interestRate" class="block text-sm font-medium text-gray-700">Annual Interest Rate (APR) <span class="text-red-600" aria-hidden="true">*</span></label>
<div class="mt-1 relative rounded-md shadow-sm">
<input type="number" id="interestRate" value="7.0" step="0.01" min="0" aria-required="true" aria-describedby="interestRate-error"
class="block w-full px-3 py-2 pr-7 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
<div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
<span class="text-gray-500 sm:text-sm">%</span>
</div>
</div>
<p id="interestRate-error" class="text-sm text-red-600 mt-1" role="alert" style="display: none;"></p>
</div>

<div>
<label for="loanTerm" class="block text-sm font-medium text-gray-700">Loan Term <span class="text-red-600" aria-hidden="true">*</span></label>
<input type="number" id="loanTerm" value="5" step="1" min="0.25" aria-required="true" aria-describedby="loanTerm-error"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
<p id="loanTerm-error" class="text-sm text-red-600 mt-1" role="alert" style="display: none;"></p>
</div>

<div>
<label for="termUnits" class="block text-sm font-medium text-gray-700">Term Unit</label>
<select id="termUnits"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
<option value="years" selected>Years</option>
<option value="months">Months</option>
</select>
</div>

<div class="md:col-span-2">
<label for="paymentFrequency" class="block text-sm font-medium text-gray-700">Payment Frequency</label>
<select id="paymentFrequency"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
<option value="monthly" selected>Monthly</option>
<option value="biweekly">Biweekly (every 2 weeks)</option>
<option value="weekly">Weekly</option>
</select>
</div>
</div>
</form>
</section>

<section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6" aria-labelledby="results-heading" style="min-height: 240px;">
<h2 id="results-heading" class="sr-only">Calculation Results</h2>
<div class="flex flex-col md:flex-row gap-6">
<div class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
<div class="result-card">
<h4>Payment per Period</h4>
<p id="paymentPerPeriod">$0.00</p>
</div>
<div class="result-card">
<h4>Total Interest Paid</h4>
<p id="totalInterest">$0.00</p>
</div>
<div class="result-card">
<h4>Total Principal Paid</h4>
<p id="totalPrincipal">$0.00</p>
</div>
<div class="result-card">
<h4>Total Cost</h4>
<p id="totalCost">$0.00</p>
</div>
</div>
<div class="w-full md:w-1/3">
<div id="results-chart-container" class="h-40">
<canvas id="resultsChart" aria-label="Chart showing principal versus total interest paid"></canvas>
</div>
</div>
</div>

<details class="mt-6 bg-white rounded-lg" id="scheduleDetails">
<summary class="font-semibold text-gray-800 p-3">View Amortization Schedule</summary>
<div class="mt-4 overflow-x-auto border border-gray-200 rounded-lg" id="scheduleContainer" tabindex="0">
<table class="min-w-full text-sm text-right">
<thead class="bg-gray-100 text-gray-700 uppercase">
<tr>
<th scope="col" class="px-4 py-2 text-left">#</th>
<th scope="col" class="px-4 py-2 text-left">Date</th>
<th scope="col" class="px-4 py-2">Payment</th>
<th scope="col" class="px-4 py-2">Interest</th>
<th scope="col" class="px-4 py-2">Principal</th>
<th scope="col" class="px-4 py-2">Balance</th>
</tr>
</thead>
<tbody id="scheduleBody"></tbody>
</table>
</div>
</details>
</section>
</div>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
<section aria-labelledby="methodology-heading">
<h2 id="methodology-heading">Data Source and Methodology</h2>
<p>All calculations are based on the standard amortization formula for a fixed-rate loan. The methodology is consistent with the formulas and guidelines provided by the <strong>U.S. Consumer Financial Protection Bureau (CFPB)</strong> for mortgage and loan calculations.</p>
<p><strong>Authoritative Source:</strong> Consumer Financial Protection Bureau (CFPB).<br>
<strong>Reference:</strong> <a href="https://www.consumerfinance.gov/owning-a-home/loan-estimate/" target="_blank" rel="noopener noreferrer">CFPB Loan Estimate and Closing Disclosure guidance</a>.<br>
All calculations are based strictly on the formulas and data provided by this source.</p>
</section>

<section aria-labelledby="formula-heading">
<h2 id="formula-heading">The Amortization Formula Explained</h2>
<p>The calculator determines your periodic payment (M) using the standard amortization formula:</p>

<div class="formula-box" role="math" aria-label="Amortization formula M equals P times [i times (1 plus i) to the power of n] divided by [(1 plus i) to the power of n minus 1]">
$$ M = P \frac{i(1 + i)^n}{(1 + i)^n - 1} $$
</div>
</section>

<section aria-labelledby="glossary-heading">
<h2 id="glossary-heading">Glossary of Variables</h2>
<ul class="list-disc list-inside">
<li><strong>M (Payment per Period):</strong> The fixed amount you pay each period (e.g., monthly).</li>
<li><strong>P (Principal):</strong> The initial amount of the loan.</li>
<li><strong>i (Periodic Interest Rate):</strong> The annual interest rate (APR) divided by the number of payment periods per year.</li>
<li><strong>n (Total Number of Payments):</strong> The loan term in years multiplied by the number of payment periods per year.</li>
</ul>
</section>

<section aria-labelledby="example-heading">
<h2 id="example-heading">How It Works: A Step-by-Step Example</h2>
<p>Let's calculate the monthly payment for a secured loan with the following details:</p>
<ul class="list-disc list-inside">
<li><strong>Principal (P):</strong> $50,000</li>
<li><strong>Annual Interest Rate (APR):</strong> 7% (or 0.07)</li>
<li><strong>Loan Term:</strong> 5 years</li>
<li><strong>Payment Frequency:</strong> Monthly (12 periods per year)</li>
</ul>
<p><strong>1. Calculate Periodic Rate (i):</strong><br>
$i = 0.07 \text{ (APR)} / 12 \text{ (periods/year)} = 0.005833$</p>
<p><strong>2. Calculate Total Payments (n):</strong><br>
$n = 5 \text{ years} \times 12 \text{ payments/year} = 60 \text{ payments}$</p>
<p><strong>3. Apply the Formula:</strong><br>
$M = 50,000 \times \frac{0.005833(1 + 0.005833)^{60}}{(1 + 0.005833)^{60} - 1}$<br>
$M = 50,000 \times \frac{0.005833 \times 1.4176...}{1.4176... - 1}$<br>
$M = 50,000 \times 0.019801...$</p>
<p><strong>Monthly Payment (M) $\approx$ $990.05</strong></p>
</section>

<section aria-labelledby="faq-heading">
<h2 id="faq-heading">Frequently Asked Questions (FAQ)</h2>
<details>
<summary>What is a secured loan?</summary>
<p>A secured loan is a loan backed by collateral—an asset you own, such as a car, home, or savings. The lender can seize this asset if you fail to repay the loan. This collateral reduces the lender's risk, often resulting in lower interest rates compared to unsecured loans.</p>
</details>
<details>
<summary>What can I use as collateral for a secured loan?</summary>
<p>Common forms of collateral include real estate (for a mortgage or homeowner loan), a vehicle (for an auto loan), or cash in a savings or investment account. The type of collateral accepted depends on the lender and the loan product.</p>
</details>
<details>
<summary>How is a secured loan different from an unsecured loan?</summary>
<p>An <strong>unsecured loan</strong> (like a credit card or personal loan) is not backed by any collateral. The lender bases their decision on your creditworthiness (credit score, income, etc.). Because the risk is higher for the lender, unsecured loans typically have higher interest rates.</p>
</details>
<details>
<summary>What is APR (Annual Percentage Rate)?</summary>
<p>APR is the total cost of borrowing money over a year, expressed as a percentage. It includes the interest rate plus any lender fees (like origination fees). It is a more complete measure of a loan's cost than the interest rate alone.</p>
</details>
<details>
<summary>Can I pay off my secured loan early?</summary>
<p>In most cases, yes. Paying off a loan early can save you a significant amount in interest. However, you must check with your lender to see if there is a "prepayment penalty." This calculator assumes no prepayment penalties.</p>
</details>
<details>
<summary>What happens if I default on a secured loan?</summary>
<p>If you fail to make payments (default), the lender has the legal right to seize the collateral you pledged. This process is called repossession (for a car) or foreclosure (for a home). This is the primary risk of a secured loan.</p>
</details>
</section>

<div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Finance content reviewed by the CalcDomain Editorial Board.<br>
Last accuracy review: <time datetime="2025-10-31">October 31, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why use this calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>See a full breakdown of principal, interest, and total cost.</li>
<li>Export a clean amortization schedule for your records.</li>
<li>Model different scenarios (weekly, biweekly, monthly) to find the best plan.</li>
<li>Understand the true cost of your loan with our transparent formula.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related loan tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="loan-amortization.html" class="text-blue-600 hover:underline">Loan Amortization Schedule</a></li>
<li><a href="loan-payoff.html" class="text-blue-600 hover:underline">Loan Payoff Calculator</a></li>
<li><a href="unsecured-loan-calculator.html" class="text-blue-600 hover:underline">Unsecured Loan Calculator</a></li>
<li><a href="apr.html" class="text-blue-600 hover:underline">APR Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="about.html" class="hover:text-blue-600">About</a>
<a href="contact.html" class="hover:text-blue-600">Contact</a>
<a href="privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
// --- 1. Element References ---
const elements = {
loanAmount: document.getElementById('loanAmount'),
interestRate: document.getElementById('interestRate'),
loanTerm: document.getElementById('loanTerm'),
termUnits: document.getElementById('termUnits'),
paymentFrequency: document.getElementById('paymentFrequency'),

paymentPerPeriod: document.getElementById('paymentPerPeriod'),
totalPrincipal: document.getElementById('totalPrincipal'),
totalInterest: document.getElementById('totalInterest'),
totalCost: document.getElementById('totalCost'),
scheduleBody: document.getElementById('scheduleBody'),

// Error message elements
loanAmountError: document.getElementById('loanAmount-error'),
interestRateError: document.getElementById('interestRate-error'),
loanTermError: document.getElementById('loanTerm-error'),
};

const chartCtx = document.getElementById('resultsChart');
let chartInstance = null;

// --- 2. Formatters ---
const fmtCurrency = (val) => new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' }).format(val || 0);

// --- 3. Helper Functions ---
function getPeriodsPerYear(freq) {
switch (freq) {
case 'weekly': return 52;
case 'biweekly': return 26;
default: return 12; // monthly
}
}

// --- 4. Validation Logic (WCAG 2.1 AA) ---
function validateInputs() {
let isValid = true;
// Clear all errors
clearError(elements.loanAmount, elements.loanAmountError);
clearError(elements.interestRate, elements.interestRateError);
clearError(elements.loanTerm, elements.loanTermError);

const principal = parseFloat(elements.loanAmount.value);
const rate = parseFloat(elements.interestRate.value);
const term = parseFloat(elements.loanTerm.value);

if (isNaN(principal) || principal <= 0) {
setError(elements.loanAmount, elements.loanAmountError, 'Please enter a valid loan amount greater than $0.');
isValid = false;
}
if (isNaN(rate) || rate < 0) {
setError(elements.interestRate, elements.interestRateError, 'Please enter a valid interest rate (0 or greater).');
isValid = false;
}
if (isNaN(term) || term <= 0) {
setError(elements.loanTerm, elements.loanTermError, 'Please enter a valid loan term greater than 0.');
isValid = false;
}

return isValid;
}

function setError(inputEl, errorEl, message) {
errorEl.textContent = message;
errorEl.style.display = 'block';
inputEl.setAttribute('aria-invalid', 'true');
inputEl.classList.add('border-red-600');
inputEl.classList.remove('border-gray-300');
}

function clearError(inputEl, errorEl) {
errorEl.textContent = '';
errorEl.style.display = 'none';
inputEl.setAttribute('aria-invalid', 'false');
inputEl.classList.remove('border-red-600');
inputEl.classList.add('border-gray-300');
}

// --- 5. Core Calculation Engine ---
function calculateAndDisplay() {
if (!validateInputs()) {
// If validation fails, clear results
updateOutputs(0, 0, 0, []);
return;
}

// Get validated inputs
const principal = parseFloat(elements.loanAmount.value);
const apr = parseFloat(elements.interestRate.value) / 100;
let termValue = parseFloat(elements.loanTerm.value);
const termUnits = elements.termUnits.value;
const frequency = elements.paymentFrequency.value;

// Convert term to years
const termInYears = (termUnits === 'months') ? termValue / 12 : termValue;
const periodsPerYear = getPeriodsPerYear(frequency);
const totalPeriods = Math.round(termInYears * periodsPerYear);
const periodicRate = apr / periodsPerYear;

let paymentPerPeriod = 0;
let totalCost = 0;
let totalInterest = 0;

if (periodicRate === 0) {
// 0% interest loan
paymentPerPeriod = principal / totalPeriods;
totalCost = principal;
totalInterest = 0;
} else {
// Standard amortization formula
const formulaFactor = Math.pow(1 + periodicRate, totalPeriods);
paymentPerPeriod = principal * (periodicRate * formulaFactor) / (formulaFactor - 1);
totalCost = paymentPerPeriod * totalPeriods;
totalInterest = totalCost - principal;
}

const schedule = generateSchedule(principal, periodicRate, totalPeriods, paymentPerPeriod, frequency);
updateOutputs(paymentPerPeriod, principal, totalInterest, totalCost, schedule);
}

// --- 6. Amortization Schedule Generation ---
function generateSchedule(principal, periodicRate, totalPeriods, payment, frequency) {
const schedule = [];
let remainingBalance = principal;
let paymentDate = new Date();
const periodsPerYear = getPeriodsPerYear(frequency);
const daysIncrement = 365.25 / periodsPerYear;

for (let period = 1; period <= totalPeriods; period++) {
const interestPayment = remainingBalance * periodicRate;
let principalPayment = payment - interestPayment;

// Adjust last payment for rounding
if (period === totalPeriods) {
principalPayment = remainingBalance;
payment = remainingBalance + interestPayment;
remainingBalance = 0;
} else {
remainingBalance -= principalPayment;
}

// Calculate next payment date
const nextDate = new Date(paymentDate);
nextDate.setDate(paymentDate.getDate() + daysIncrement);
paymentDate = nextDate;

schedule.push({
period,
date: paymentDate,
payment: payment,
interest: interestPayment,
principal: principalPayment,
balance: remainingBalance
});
}
return schedule;
}

// --- 7. Update UI Functions ---
function updateOutputs(paymentPerPeriod, principal, totalInterest, totalCost, schedule) {
elements.paymentPerPeriod.textContent = fmtCurrency(paymentPerPeriod);
elements.totalPrincipal.textContent = fmtCurrency(principal);
elements.totalInterest.textContent = fmtCurrency(totalInterest);
elements.totalCost.textContent = fmtCurrency(totalCost);

renderSchedule(schedule);
renderChart(principal, totalInterest);
}

function renderSchedule(schedule) {
const tbody = elements.scheduleBody;
tbody.innerHTML = '';
if (!schedule.length) return;

const formatter = new Intl.DateTimeFormat(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
schedule.forEach(row => {
const tr = document.createElement('tr');
tr.className = 'border-b border-gray-200 even:bg-gray-50';
tr.innerHTML = `
<td class="px-4 py-2 text-left">${row.period}</td>
<td class="px-4 py-2 text-left">${formatter.format(row.date)}</td>
<td class="px-4 py-2">${fmtCurrency(row.payment)}</td>
<td class="px-4 py-2">${fmtCurrency(row.interest)}</td>
<td class="px-4 py-2">${fmtCurrency(row.principal)}</td>
<td class="px-4 py-2 font-medium">${fmtCurrency(row.balance)}</td>`;
tbody.appendChild(tr);
});
}

function renderChart(principal, totalInterest) {
if (!chartCtx) return;

const data = {
labels: ['Principal', 'Total Interest'],
datasets: [{
data: [Math.max(0, principal), Math.max(0, totalInterest)],
backgroundColor: ['#2563eb', '#f97316'], // Blue, Orange
}]
};

if (chartInstance) {
chartInstance.data = data;
chartInstance.update();
} else {
chartInstance = new Chart(chartCtx, {
type: 'doughnut',
data,
options: {
plugins: {
legend: { position: 'bottom', labels: { boxWidth: 12, padding: 20 } },
tooltip: {
callbacks: {
label: function(context) {
let label = context.label || '';
if (label) {
label += ': ';
}
if (context.parsed !== null) {
label += fmtCurrency(context.parsed);
}
return label;
}
}
}
},
responsive: true,
maintainAspectRatio: false
}
});
}
}

// --- 8. Event Listeners ---
const inputs = [
elements.loanAmount,
elements.interestRate,
elements.loanTerm,
elements.termUnits,
elements.paymentFrequency
];

inputs.forEach(input => {
input.addEventListener('input', calculateAndDisplay);
// Also validate on blur for accessibility
input.addEventListener('blur', validateInputs);
});

// --- 9. Initial Calculation ---
calculateAndDisplay();

// Mobile menu toggle
const menuToggle = document.getElementById('mobile-menu-toggle');
const mobileMenu = document.getElementById('mobile-menu');
if(menuToggle && mobileMenu) {
menuToggle.addEventListener('click', () => {
const isHidden = mobileMenu.classList.contains('hidden');
mobileMenu.classList.toggle('hidden', !isHidden);
menuToggle.setAttribute('aria-expanded', isHidden);
});
}
});
</script>
</body>
</html>