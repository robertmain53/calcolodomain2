<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<title>Mortgage Payoff Calculator | Extra Payments, Time Saved &amp; Interest Savings</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Mortgage payoff calculator: see how extra monthly or one‑time payments shorten your loan term and save interest. Professional, mobile‑first, and WCAG‑compliant." name="description"/>
<meta content="Ugo Candido" name="author"/>
<link href="https://calcdomain.com/mortgage-payoff.html" rel="canonical"/>
<meta content="#ffffff" name="theme-color"/>
<meta content="index,follow" name="robots"/>
<style>
    /* Design tokens */
    :root{
      --primary:#005A9C; --primary-700:#004578; --secondary:#11324D;
      --bg:#F7F9FC; --surface:#FFFFFF;
      --text:#1E293B; --muted:#64748B;
      --border:#E2E8F0; --success:#1E854A; --danger:#C62828; --warning:#B26A00;
      --radius:12px; --radius-sm:8px;
      --shadow:0 6px 18px rgba(17, 50, 77, .08);
      --touch:48px;
      --font:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    }
    @media (prefers-contrast: more){
      :root{ --primary:#003366; --text:#000; --border:#000; }
    }
    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto !important; animation:none !important; transition:none !important;}
    }
    /* Base */
    *,*::before,*::after{box-sizing:border-box}
    html{font-size:16px}
    body{
      margin:0; font-family:var(--font); background:var(--bg); color:var(--text);
      line-height:1.6; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:var(--primary); text-decoration:none}
    a:hover{ text-decoration:underline }
    .skip-link{
      position:absolute; left:8px; top:-40px; background:var(--primary); color:#fff;
      padding:8px 14px; border-radius:6px; z-index:1000
    }
    .skip-link:focus{ top:8px }
    /* Layout */
    .container{max-width:1120px;margin:0 auto;padding:0 16px}
    main{padding:24px 0 48px}
    h1{font-size:clamp(1.6rem,4vw,2.2rem); color:var(--secondary); margin:8px 0 8px}
    p.lead{font-size:1.05rem; color:var(--muted); margin:0 0 18px}
    .grid{
      display:grid; gap:24px; grid-template-columns:1fr; margin-top:10px
    }
    @media (min-width: 992px){
      .grid{ grid-template-columns: minmax(300px,420px) 1fr; align-items:start }
    }
    /* Card */
    .card{
      background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:20px
    }
    /* Form */
    .form-group{ margin-bottom:16px }
    .label-row{ display:flex; align-items:center; gap:8px; justify-content:space-between }
    label{ display:block; font-weight:700; color:var(--secondary); margin-bottom:8px }
    .hint{ font-size:.9rem; color:var(--muted) }
    .tooltip-btn{
      margin-left:auto; appearance:none; border:1px solid var(--border); background:#fff;
      color:var(--primary); border-radius:999px; width:var(--touch); height:var(--touch);
      display:inline-flex; align-items:center; justify-content:center; cursor:pointer; font-weight:700;
    }
    .tooltip-btn:focus{ outline:3px solid var(--primary); outline-offset:2px }
    .tooltip{
      display:none; margin-top:8px; padding:10px 12px; background:#F1F5F9; border-left:4px solid var(--primary);
      border-radius:8px; color:#0f172a; font-size:.95rem
    }
    .tooltip[aria-hidden="false"]{ display:block }
    .control{
      width:100%; min-height:var(--touch); border:1px solid var(--border); border-radius:10px;
      padding:12px 14px; font-size:1rem; background:#fff; color:var(--text)
    }
    .control:focus{ outline:3px solid rgba(0,90,156,.25); border-color:var(--primary) }
    .control[aria-invalid="true"]{ border-color:var(--danger) }
    .input-row{ display:grid; grid-template-columns:1fr auto; align-items:center }
    .suffix{ margin-left:-44px; width:44px; text-align:center; color:var(--muted); pointer-events:none }
    .radio-group{
      display:flex; gap:8px; flex-wrap:wrap; border:1px solid var(--border); padding:6px; border-radius:10px
    }
    .radio-option{
      position:relative; flex:1 1 120px; min-width:120px
    }
    .radio-option input{ position:absolute; inset:0; opacity:0 }
    .radio-option label{
      display:flex; align-items:center; justify-content:center; min-height:44px; padding:8px 10px;
      border-radius:8px; border:1px solid transparent; font-weight:600; color:var(--secondary); cursor:pointer
    }
    .radio-option input:focus + label{ outline:3px solid var(--primary); outline-offset:2px }
    .radio-option input:checked + label{ background:var(--primary); color:#fff }
    .error{ color:var(--danger); font-size:.9rem; margin-top:6px; min-height:1.2em }
    /* Results */
    .results{ margin-top:10px }
    .results .card{ min-height:260px }
    .result-row{
      display:flex; align-items:baseline; justify-content:space-between; border-bottom:1px dashed var(--border);
      padding:10px 0
    }
    .result-row:last-child{ border-bottom:0 }
    .result-label{ color:var(--muted) }
    .result-value{ font-weight:800; font-size:1.2rem; color:var(--success); font-variant-numeric:tabular-nums; }
    .result-note{ font-size:.9rem; color:var(--muted) }
    /* Content section */
    section.content h2{ margin-top:20px; font-size:clamp(1.3rem,3vw,1.6rem); color:var(--secondary) }
    .formula{ background:#EEF2F7; border:1px solid var(--border); border-radius:10px; padding:14px; overflow:auto; font-family:var(--mono) }
    .glossary{ display:grid; gap:8px; margin:8px 0 0; padding:0 0 0 18px }
    .faq h3{ font-size:1.05rem; margin:16px 0 6px }
    .author{ margin-top:24px; color:var(--muted); border-top:1px solid var(--border); padding-top:12px; font-size:.95rem }
    /* Buttons */
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      min-height:var(--touch); padding:10px 16px; border-radius:10px; border:1px solid var(--primary);
      background:var(--primary); color:#fff; font-weight:700; cursor:pointer; user-select:none
    }
    .btn.secondary{ background:#fff; color:var(--primary) }
    .btn:focus{ outline:3px solid rgba(0,90,156,.35); outline-offset:2px }
    /* Footer */
    footer{ margin-top:40px; padding:24px 0; color:#475569; font-size:.95rem }
  </style>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Mortgage Payoff Calculator",
  "description": "Interactive mortgage payoff calculator to quantify time and interest savings from extra monthly or one-time payments. WCAG-compliant, mobile-first, and optimized for Core Web Vitals.",
  "url": "https://calcdomain.com/mortgage-payoff.html",
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain"
  },
  "mainEntity": [
    {
      "@type": "HowTo",
      "name": "How the Mortgage Payoff Calculator works — a step-by-step example",
      "description": "This example shows how a $300,000 balance at 6% APR with 25 years remaining changes when adding $200 extra per month.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Enter current loan details",
          "text": "Current balance: 300000; APR: 6%; Remaining term: 25 years 0 months."
        },
        {
          "@type": "HowToStep",
          "name": "Review the scheduled payment",
          "text": "The calculator computes the standard monthly payment based on balance, APR, and remaining term."
        },
        {
          "@type": "HowToStep",
          "name": "Choose extra payment",
          "text": "Select 'Monthly extra' and enter 200."
        },
        {
          "@type": "HowToStep",
          "name": "View savings",
          "text": "New payoff time is shorter. The tool shows months saved and total interest saved, plus the new payoff date."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What does the mortgage payoff calculator do?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "It estimates how extra payments—monthly or one-time—shorten your payoff time and reduce total interest on a fixed-rate mortgage."
          }
        },
        {
          "@type": "Question",
          "name": "Does making one extra payment per year help?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. Even an annual lump sum applied to principal can shave months off your term and save interest, especially early in the loan."
          }
        },
        {
          "@type": "Question",
          "name": "Are results exact to the cent?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "They are high-precision estimates. Actual lender amortization may differ slightly due to rounding, payment dates, escrow, or fees."
          }
        },
        {
          "@type": "Question",
          "name": "Can I input a 0% interest rate?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. The calculator switches to a zero-interest formula where monthly payment equals principal divided by remaining months."
          }
        },
        {
          "@type": "Question",
          "name": "Will prepayment penalties affect the result?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Potential prepayment penalties are not included. Check your note and lender; penalties can reduce or offset savings."
          }
        },
        {
          "@type": "Question",
          "name": "Is PMI included?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No. This tool models principal and interest only. Taxes, insurance, and PMI are excluded for clarity."
          }
        }
      ]
    }
  ]
}
  </script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="/assets/js/page-enhancements.js" as="script">

</head>
<body>

<a class="skip-link" href="#main">Skip to main content</a>
<main class="container" id="main" role="main">
<h1>Mortgage Payoff Calculator</h1>
<p class="lead">Estimate how extra payments—monthly or one‑time—can shorten your mortgage term and reduce total interest. Built for homeowners, buyers, and financial pros seeking precise, accessible results fast.</p>
<div class="grid" id="calculator-grid">
<!-- Calculator -->
<section aria-labelledby="calc-heading" class="card" id="calculator">
<h2 class="sr-only" id="calc-heading">Calculator Inputs</h2>
<div class="form-group">
<div class="label-row">
<label for="balance">Current principal balance *</label>
</div>
<div class="input-row">
<input aria-describedby="balanceErr balanceHint" aria-required="true" class="control" id="balance" inputmode="decimal" min="0" placeholder="e.g., 300000" step="0.01" type="number"/>
<span aria-hidden="true" class="suffix">$</span>
</div>
<div class="hint" id="balanceHint">Exclude escrow, fees, and interest due—principal only.</div>
<div aria-live="polite" class="error" id="balanceErr" role="alert"></div>
</div>
<div class="form-group">
<div class="label-row">
<label for="apr">Annual interest rate (APR) *</label>
<button aria-controls="aprTip" aria-expanded="false" aria-label="Toggle APR help" class="tooltip-btn" id="aprTipBtn" type="button">?</button>
</div>
<div class="input-row">
<input aria-describedby="aprErr aprHint aprTip" aria-required="true" class="control" id="apr" inputmode="decimal" max="100" min="0" placeholder="e.g., 6.5" step="0.001" type="number"/>
<span aria-hidden="true" class="suffix">%</span>
</div>
<div class="hint" id="aprHint">Nominal annual rate; we convert to a monthly rate using r/12.</div>
<div aria-hidden="true" class="tooltip" id="aprTip" role="region">
            APR here is the annual nominal rate for interest accrual. The calculator uses a monthly rate i = APR/100/12 with monthly compounding.
          </div>
<div aria-live="polite" class="error" id="aprErr" role="alert"></div>
</div>
<div class="form-group">
<div class="label-row">
<label for="years">Remaining term *</label>
</div>
<div class="input-row" style="grid-template-columns: 1fr 1fr; gap:10px">
<input aria-describedby="termErr termHint" aria-required="true" class="control" id="years" inputmode="numeric" max="50" min="0" placeholder="Years" step="1" type="number"/>
<input aria-describedby="termErr termHint" aria-required="true" class="control" id="months" inputmode="numeric" max="11" min="0" placeholder="Months" step="1" type="number"/>
</div>
<div class="hint" id="termHint">Enter years and months left on your loan. At least one must be greater than zero.</div>
<div aria-live="polite" class="error" id="termErr" role="alert"></div>
</div>
<div class="form-group">
<fieldset aria-labelledby="extraLegend">
<legend id="extraLegend" style="font-weight:700; color:var(--secondary); margin-bottom:8px">Extra payment type</legend>
<div aria-label="Extra payment type" class="radio-group" role="radiogroup">
<div class="radio-option">
<input checked="" id="extraNone" name="extraType" type="radio" value="none"/>
<label for="extraNone">None</label>
</div>
<div class="radio-option">
<input id="extraMonthly" name="extraType" type="radio" value="monthly"/>
<label for="extraMonthly">Monthly extra</label>
</div>
<div class="radio-option">
<input id="extraOnce" name="extraType" type="radio" value="once"/>
<label for="extraOnce">One‑time lump sum</label>
</div>
</div>
</fieldset>
</div>
<div class="form-group" hidden="" id="monthlyExtraGroup">
<div class="label-row">
<label for="monthlyExtra">Extra amount per month</label>
</div>
<div class="input-row">
<input aria-describedby="monthlyExtraErr" class="control" id="monthlyExtra" inputmode="decimal" min="0" placeholder="e.g., 200" step="0.01" type="number"/>
<span aria-hidden="true" class="suffix">$</span>
</div>
<div aria-live="polite" class="error" id="monthlyExtraErr" role="alert"></div>
</div>
<div class="form-group" hidden="" id="onceGroup">
<div class="label-row">
<label for="lumpSum">One‑time extra amount</label>
<button aria-controls="onceTip" aria-expanded="false" aria-label="Toggle lump sum help" class="tooltip-btn" id="onceTipBtn" type="button">?</button>
</div>
<div class="input-row">
<input aria-describedby="lumpSumErr onceTip" class="control" id="lumpSum" inputmode="decimal" min="0" placeholder="e.g., 5000" step="0.01" type="number"/>
<span aria-hidden="true" class="suffix">$</span>
</div>
<div class="input-row" style="grid-template-columns: 1fr; margin-top:8px">
<input aria-describedby="lumpSumErr" class="control" id="lumpMonth" inputmode="numeric" min="1" placeholder="Apply in month number (1 = next payment)" step="1" type="number"/>
</div>
<div aria-hidden="true" class="tooltip" id="onceTip" role="region">
            Choose the future payment number when the lump sum will be applied directly to principal. Earlier is usually more impactful.
          </div>
<div aria-live="polite" class="error" id="lumpSumErr" role="alert"></div>
</div>
<div class="form-group" style="display:flex; gap:10px; flex-wrap:wrap">
<button aria-label="Recalculate results" class="btn" id="calcBtn" type="button">Calculate</button>
<button aria-label="Reset form" class="btn secondary" id="resetBtn" type="button">Reset</button>
</div>
</section>
<!-- Results -->
<section class="results">
<div aria-labelledby="resultsHeading" aria-live="polite" class="card">
<h2 id="resultsHeading" style="margin-top:0">Results</h2>
<div class="result-row">
<span class="result-label">Scheduled monthly payment (no extra)</span>
<span class="result-value" id="scheduledPayment">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">New payoff time with extra</span>
<span class="result-value" id="newTerm">—</span>
</div>
<div class="result-row">
<span class="result-label">Time saved</span>
<span class="result-value" id="timeSaved">—</span>
</div>
<div class="result-row">
<span class="result-label">Total interest remaining (no extra)</span>
<span class="result-value" id="interestBaseline">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">Total interest with extra</span>
<span class="result-value" id="interestWithExtra">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">Interest saved</span>
<span class="result-value" id="interestSaved">$0.00</span>
</div>
<div class="result-row">
<span class="result-label">Estimated payoff date (with extra)</span>
<span class="result-value" id="payoffDate">—</span>
</div>
<div class="result-note" id="resultNote">Assumes fixed rate, monthly compounding, and on‑time payments. Taxes/insurance/PMI excluded.</div>
</div>
</section>
</div>
<!-- Authoritative content -->
<section class="content">
<h2>Data Source and Methodology</h2>
<p><strong>Primary Source:</strong> OpenStax, “Business Mathematics,” Section 13.5: Amortized Loans (2018). https://openstax.org/details/books/business-mathematics</p>
<p><strong>Government Guidance:</strong> Consumer Financial Protection Bureau (CFPB), “What is amortization and how does it work?” (2020-11-20). https://www.consumerfinance.gov/ask-cfpb/what-is-amortization-en-1065/</p>
<p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>
<h2>The Formula Explained</h2>
<div aria-label="Mathematical formulas" class="formula">
        Monthly rate: i = APR / 100 / 12<br/>
        Standard payment (given balance B and n months):<br/>
        M = B · [ i / (1 - (1 + i)^(-n)) ]  for i &gt; 0; otherwise M = B / n<br/><br/>
        New payoff months when adding monthly extra E (no lump sum):<br/>
        n' = ⎡ - ln(1 - i·B/(M+E)) / ln(1+i) ⎤<br/><br/>
        Amortization update each month (simulation used for lump sums):<br/>
        Interest_t = B_t · i ; Principal_t = Payment_t - Interest_t ; B_{t+1} = max(0, B_t - Principal_t)
      </div>
<h2>Glossary of Variables</h2>
<ul class="glossary">
<li><strong>B (Balance):</strong> Current principal owed on the loan.</li>
<li><strong>APR:</strong> Annual percentage rate (nominal), used to derive the monthly rate.</li>
<li><strong>i:</strong> Monthly interest rate (APR/12).</li>
<li><strong>n:</strong> Remaining number of months on the mortgage.</li>
<li><strong>M:</strong> Scheduled monthly principal-and-interest payment with no extra.</li>
<li><strong>E:</strong> Extra amount added to each monthly payment (if selected).</li>
<li><strong>n'</strong> New number of months to payoff when making extra payments.</li>
<li><strong>L:</strong> One-time lump sum applied to principal at a chosen future month.</li>
</ul>
<h2>How It Works: A Step-by-Step Example</h2>
<p>Suppose your current balance B = $300,000 at APR = 6% with 25 years remaining (n = 300 months). The monthly rate is i = 0.06/12 = 0.005.</p>
<div class="formula">
        M = 300000 × [ 0.005 / (1 − (1.005)^(-300)) ] ≈ $1,933.28
      </div>
<p>Now add a monthly extra E = $200, so the total payment is M + E ≈ $2,133.28. Using the payoff formula:</p>
<div class="formula">
        n' = ⎡ − ln(1 − 0.005 × 300000 / 2133.28) / ln(1.005) ⎤ ≈ 255 months
      </div>
<p>You would be debt‑free about 45 months sooner (3 years and 9 months earlier), saving tens of thousands in interest. If you choose a single lump sum early in the schedule, the calculator simulates amortization month‑by‑month to show the impact precisely.</p>
<h2>Frequently Asked Questions (FAQ)</h2>
<div class="faq">
<h3>Does the calculator include taxes, insurance, or PMI?</h3>
<p>No. It models principal and interest only so you can isolate the effect of extra payments.</p>
<h3>What if my APR changes?</h3>
<p>This tool assumes a fixed APR. For adjustable‑rate mortgages, results will differ when the rate resets.</p>
<h3>Is biweekly payment support available?</h3>
<p>Biweekly schedules are not modeled directly, but you can approximate by entering a monthly extra equal to half a payment every month.</p>
<h3>Why are my lender’s numbers slightly different?</h3>
<p>Lenders may apply daily interest, vary posting dates, and round to the cent each cycle. Those operational details can create small differences.</p>
<h3>Can I model multiple lump sums?</h3>
<p>This version supports one lump sum. You can approximate multiple by running separate scenarios or using the monthly extra field.</p>
<h3>What if my scheduled payment is too low to amortize?</h3>
<p>If payment ≤ monthly interest, the balance won’t decrease. Increase the extra payment or verify your remaining term and APR.</p>
<h3>How precise are the payoff dates?</h3>
<p>Dates are estimated by adding the computed months to today’s date and assume on‑time monthly payments.</p>
</div>
<div class="author">
        Tool developed by <strong>Ugo Candido</strong>. Content verified by the <strong>CalcDomain Editorial Team</strong>.<br/>
        Last reviewed for accuracy on: September 13, 2025.
      </div>
</section>
</main>
<!-- Standard Footer --> 
<script defer="">
  (function(){
    'use strict';

    // Utilities
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const curr = new Intl.NumberFormat(undefined, { style:'currency', currency: guessCurrency() });
    const fmtNum = (n, digits=2) => Number.isFinite(n) ? n.toFixed(digits) : '—';

    function guessCurrency(){
      try{
        const region = Intl.DateTimeFormat().resolvedOptions().locale?.split('-')[1] || '';
        if(region === 'GB') return 'GBP';
        if(region === 'CA') return 'CAD';
        if(region === 'AU') return 'AUD';
        if(region === 'EU' || region === 'DE' || region === 'FR' || region === 'ES' || region === 'IT' || region === 'NL' || region === 'IE' || region === 'PT') return 'EUR';
      }catch(e){}
      return 'USD';
    }

    // Elements
    const balance = $('#balance');
    const apr = $('#apr');
    const years = $('#years');
    const months = $('#months');
    const extraType = $$('input[name="extraType"]');
    const monthlyExtraGroup = $('#monthlyExtraGroup');
    const monthlyExtra = $('#monthlyExtra');
    const onceGroup = $('#onceGroup');
    const lumpSum = $('#lumpSum');
    const lumpMonth = $('#lumpMonth');

    const scheduledPaymentEl = $('#scheduledPayment');
    const newTermEl = $('#newTerm');
    const timeSavedEl = $('#timeSaved');
    const interestBaselineEl = $('#interestBaseline');
    const interestWithExtraEl = $('#interestWithExtra');
    const interestSavedEl = $('#interestSaved');
    const payoffDateEl = $('#payoffDate');
    const resultNote = $('#resultNote');

    const calcBtn = $('#calcBtn');
    const resetBtn = $('#resetBtn');

    // Tooltips
    const aprTipBtn = $('#aprTipBtn');
    const aprTip = $('#aprTip');
    const onceTipBtn = $('#onceTipBtn');
    const onceTip = $('#onceTip');

    // Errors
    const err = {
      balance: $('#balanceErr'),
      apr: $('#aprErr'),
      term: $('#termErr'),
      monthlyExtra: $('#monthlyExtraErr'),
      lump: $('#lumpSumErr')
    };

    // Validation helpers
    function setError(input, errEl, msg){
      input.setAttribute('aria-invalid', 'true');
      errEl.textContent = msg || '';
    }
    function clearError(input, errEl){
      input.setAttribute('aria-invalid', 'false');
      errEl.textContent = '';
    }

    function parseNum(input){
      const v = parseFloat(input.value);
      return Number.isFinite(v) ? v : NaN;
    }

    function validateBalance(){
      const v = parseNum(balance);
      if(!Number.isFinite(v) || v <= 0){
        setError(balance, err.balance, 'Enter a positive principal balance (e.g., 250000).');
        return false;
      }
      clearError(balance, err.balance);
      return true;
    }

    function validateApr(){
      const v = parseNum(apr);
      if(!Number.isFinite(v) || v < 0 || v >= 100){
        setError(apr, err.apr, 'Enter an APR between 0 and 100 (e.g., 6.5).');
        return false;
      }
      clearError(apr, err.apr);
      return true;
    }

    function validateTerm(){
      const y = parseNum(years) || 0;
      const m = parseNum(months) || 0;
      if((y < 0 || y > 50) || (m < 0 || m > 11)){
        setError(years, err.term, 'Years must be 0–50 and months 0–11.');
        setError(months, err.term, 'Years must be 0–50 and months 0–11.');
        return false;
      }
      const total = y*12 + m;
      if(total <= 0){
        setError(years, err.term, 'Remaining term must be at least 1 month.');
        setError(months, err.term, 'Remaining term must be at least 1 month.');
        return false;
      }
      clearError(years, err.term); clearError(months, err.term);
      return true;
    }

    function validateMonthlyExtra(){
      if(monthlyExtraGroup.hidden) { clearError(monthlyExtra, err.monthlyExtra); return true; }
      const v = parseNum(monthlyExtra) || 0;
      if(v < 0){
        setError(monthlyExtra, err.monthlyExtra, 'Monthly extra cannot be negative.');
        return false;
      }
      clearError(monthlyExtra, err.monthlyExtra);
      return true;
    }

    function validateLump(){
      if(onceGroup.hidden){ clearError(lumpSum, err.lump); clearError(lumpMonth, err.lump); return true; }
      const L = parseNum(lumpSum) || 0;
      const lm = parseNum(lumpMonth);
      const totalMonths = (parseNum(years)||0)*12 + (parseNum(months)||0);
      if(L < 0){
        setError(lumpSum, err.lump, 'Lump sum cannot be negative.');
        return false;
      }
      if(!Number.isFinite(lm) || lm < 1 || lm > Math.max(1, totalMonths)){
        setError(lumpMonth, err.lump, 'Enter a month number between 1 and the remaining term.');
        return false;
      }
      clearError(lumpSum, err.lump); clearError(lumpMonth, err.lump);
      return true;
    }

    // Event: toggle extra groups
    function updateExtraVisibility(){
      const val = extraType.find(r => r.checked)?.value || 'none';
      monthlyExtraGroup.hidden = val !== 'monthly';
      onceGroup.hidden = val !== 'once';
    }
    extraType.forEach(r => r.addEventListener('change', () => {
      updateExtraVisibility(); debouncedCalc();
    }));

    // Tooltips toggle
    function toggleTip(btn, panel){
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      panel.setAttribute('aria-hidden', String(expanded));
    }
    aprTipBtn.addEventListener('click', () => toggleTip(aprTipBtn, aprTip));
    onceTipBtn.addEventListener('click', () => toggleTip(onceTipBtn, onceTip));

    // Core math
    function scheduledPayment(B, i, n){
      if(n <= 0) return NaN;
      if(i === 0) return B / n;
      const denom = 1 - Math.pow(1 + i, -n);
      return B * (i / denom);
    }

    function payoffMonthsSim(B, i, payment, options){
      const oneMonth = Math.max(1, (options?.lumpMonth|0));
      const L = Math.max(0, options?.lumpSum || 0);
      let bal = B, month = 0, totalInterest = 0, totalPaid = 0;

      // Guard: if interest-only scenario (payment <= interest) and no lump large enough to reduce principal, prevent infinite loop
      if(i > 0 && payment <= bal * i && L === 0){
        return { months: Infinity, totalInterest: Infinity, totalPaid: Infinity };
      }

      while(bal > 0 && month < 3600){
        month++;
        let interest = bal * i;
        let principal = payment - interest;
        let extra = 0;

        if(month === oneMonth && L > 0){
          extra += L;
        }

        // If payment + extra exceeds remaining balance + interest, cap to clear balance
        let applied = principal + extra;
        if(i === 0){
          // zero-interest: payment applies fully to principal
          applied = payment + extra;
        }
        if(applied > bal){
          // pay final
          const over = applied - bal;
          // recompute interest for final month with proportional assumption:
          // For simplicity, we'll just cap principal to bal and add full interest (final month).
          applied = bal;
        }

        // Totals
        totalInterest += interest;
        totalPaid += Math.min(bal + interest, payment + extra);

        // Update balance
        if(i === 0){
          bal = Math.max(0, bal - (payment + extra));
        }else{
          bal = Math.max(0, bal + interest - payment - extra);
        }

        // Safety break if payment is not reducing balance due to rounding
        if(month > 1 && month % 120 === 0 && bal > B * 0.999){ break; }
      }

      return { months: month, totalInterest, totalPaid, remaining: bal };
    }

    function payoffMonthsClosedForm(B, i, totalPayment){
      if(i === 0){
        return Math.ceil(B / totalPayment);
      }
      const ratio = 1 - i * B / totalPayment;
      if(ratio <= 0) return 1; // paid off next cycle
      const nprime = -Math.log(ratio) / Math.log(1 + i);
      return Math.ceil(nprime);
    }

    function addMonths(date, m){
      const d = new Date(date.getTime());
      const y = d.getUTCFullYear();
      const mo = d.getUTCMonth();
      const day = d.getUTCDate();
      const targetMonthIndex = mo + m;
      const newYear = y + Math.floor(targetMonthIndex / 12);
      const newMonth = ((targetMonthIndex % 12) + 12) % 12;
      const daysInTargetMonth = new Date(Date.UTC(newYear, newMonth + 1, 0)).getUTCDate();
      d.setUTCFullYear(newYear, newMonth, Math.min(day, daysInTargetMonth));
      return d;
    }

    // Calculation
    function calculate(){
      // Validate
      const ok = [validateBalance(), validateApr(), validateTerm(), validateMonthlyExtra(), validateLump()].every(Boolean);
      if(!ok){ return; }

      const B = parseNum(balance);
      const aprVal = parseNum(apr) / 100;
      const i = aprVal / 12;
      const n = (parseNum(years)||0)*12 + (parseNum(months)||0);

      const M = scheduledPayment(B, i, n);
      // Baseline totals
      const baselineInterest = Number.isFinite(M) ? Math.max(0, M*n - B) : NaN;

      // Extra handling
      const type = extraType.find(r => r.checked)?.value || 'none';
      let E = 0, L = 0, lm = 1;
      if(type === 'monthly'){
        E = Math.max(0, parseNum(monthlyExtra) || 0);
        L = 0;
      }else if(type === 'once'){
        E = 0;
        L = Math.max(0, parseNum(lumpSum) || 0);
        lm = Math.max(1, parseNum(lumpMonth) || 1);
      }

      // New payoff
      let monthsToPay = n;
      let totalsWithExtra = { totalInterest: baselineInterest, totalPaid: M*n };
      if(type === 'none'){
        monthsToPay = n;
        totalsWithExtra.totalInterest = baselineInterest;
      }else if(type === 'monthly'){
        const totalPayment = M + E;
        monthsToPay = payoffMonthsClosedForm(B, i, totalPayment);
        // simulate to get precise interest totals
        totalsWithExtra = payoffMonthsSim(B, i, totalPayment, { lumpMonth: 0, lumpSum: 0 });
      }else{
        // lump sum simulation with scheduled M
        totalsWithExtra = payoffMonthsSim(B, i, M, { lumpMonth: lm, lumpSum: L });
        monthsToPay = totalsWithExtra.months;
      }

      // Prepare results
      const monthsSaved = Math.max(0, n - monthsToPay);
      const yearsNew = Math.floor(monthsToPay / 12);
      const monthsNew = monthsToPay % 12;
      const ySaved = Math.floor(monthsSaved / 12);
      const mSaved = monthsSaved % 12;
      const interestSaved = Math.max(0, (baselineInterest) - (totalsWithExtra.totalInterest || 0));
      const payoff = addMonths(new Date(), monthsToPay);

      // Render
      scheduledPaymentEl.textContent = Number.isFinite(M) ? curr.format(M) : '—';
      newTermEl.textContent = Number.isFinite(monthsToPay) ? `${yearsNew} yr ${monthsNew} mo` : '—';
      timeSavedEl.textContent = monthsSaved > 0 ? `${ySaved} yr ${mSaved} mo` : '—';
      interestBaselineEl.textContent = Number.isFinite(baselineInterest) ? curr.format(baselineInterest) : '—';
      interestWithExtraEl.textContent = Number.isFinite(totalsWithExtra.totalInterest) ? curr.format(totalsWithExtra.totalInterest) : '—';
      interestSavedEl.textContent = Number.isFinite(interestSaved) ? curr.format(interestSaved) : '—';
      payoffDateEl.textContent = Number.isFinite(monthsToPay) ? payoff.toLocaleDateString(undefined, { year:'numeric', month:'long' }) : '—';

      if(!Number.isFinite(monthsToPay) || monthsToPay > 3600){
        resultNote.textContent = 'Payment appears too low to amortize the balance. Increase extra payments or check your APR/term.';
        resultNote.style.color = 'var(--danger)';
      }else{
        resultNote.textContent = 'Assumes fixed rate, monthly compounding, and on‑time payments. Taxes/insurance/PMI excluded.';
        resultNote.style.color = 'var(--muted)';
      }
    }

    // Debounce
    let t;
    function debouncedCalc(){
      window.clearTimeout(t);
      t = window.setTimeout(calculate, 150);
    }

    // Bind events
    [balance, apr, years, months, monthlyExtra, lumpSum, lumpMonth].forEach(input => {
      if(!input) return;
      input.addEventListener('blur', () => {
        switch(input.id){
          case 'balance': validateBalance(); break;
          case 'apr': validateApr(); break;
          case 'years':
          case 'months': validateTerm(); break;
          case 'monthlyExtra': validateMonthlyExtra(); break;
          case 'lumpSum':
          case 'lumpMonth': validateLump(); break;
        }
      });
      input.addEventListener('input', debouncedCalc);
    });

    calcBtn.addEventListener('click', calculate);
    resetBtn.addEventListener('click', () => {
      balance.value = '';
      apr.value = '';
      years.value = '';
      months.value = '';
      monthlyExtra.value = '';
      lumpSum.value = '';
      lumpMonth.value = '';
      extraType.forEach(r => r.checked = r.value === 'none');
      updateExtraVisibility();
      // Clear errors
      Object.values(err).forEach(el => el.textContent = '');
      [balance, apr, years, months, monthlyExtra, lumpSum, lumpMonth].forEach(i => i?.setAttribute('aria-invalid','false'));
      // Clear results
      scheduledPaymentEl.textContent = '$0.00';
      newTermEl.textContent = '—';
      timeSavedEl.textContent = '—';
      interestBaselineEl.textContent = '$0.00';
      interestWithExtraEl.textContent = '$0.00';
      interestSavedEl.textContent = '$0.00';
      payoffDateEl.textContent = '—';
      resultNote.textContent = 'Assumes fixed rate, monthly compounding, and on‑time payments. Taxes/insurance/PMI excluded.';
      resultNote.style.color = 'var(--muted)';
    });

    // Initialize
    updateExtraVisibility();
    // Sensible defaults for quick testing
    balance.value = '300000';
    apr.value = '6';
    years.value = '25';
    months.value = '0';
    monthlyExtra.value = '200';
    // Pre-select monthly extra to showcase savings
    $('#extraMonthly').checked = true;
    updateExtraVisibility();
    calculate();
  })();
  </script>

</body></html>