<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<title>RMD (Required Minimum Distribution) Calculator</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="Accurately calculate your Required Minimum Distribution (RMD) using the IRS Uniform Lifetime Table. Mobile-first, WCAG-compliant, and optimized for Core Web Vitals." name="description"/>
<meta content="Ugo Candido" name="author"/>
<link href="https://calcdomain.com/rmd.html" rel="canonical"/>
<meta content="#ffffff" name="theme-color"/>
<meta content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" name="robots"/>
<link href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='64' width='64' viewBox='0 0 64 64'%3E%3Crect rx='8' ry='8' width='64' height='64' fill='%23005A9C'/%3E%3Cpath d='M16 40 L30 24 L38 32 L48 20' stroke='%23fff' stroke-width='4' fill='none'/%3E%3Ccircle cx='48' cy='20' r='3' fill='%23fff'/%3E%3C/svg%3E" rel="icon"/>
<link crossorigin="" href="https://cdn.jsdelivr.net" rel="preconnect"/>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "RMD (Required Minimum Distribution) Calculator",
  "description": "An authoritative RMD calculator that uses the IRS Uniform Lifetime Table (rev. 2022) to determine required minimum distributions for retirement accounts. WCAG 2.1 AA compliant and mobile-first.",
  "url": "https://calcdomain.com/rmd.html",
  "inLanguage": "en",
  "isPartOf": {
    "@type": "WebSite",
    "name": "CalcDomain",
    "url": "https://calcdomain.com"
  },
  "author": {
    "@type": "Person",
    "name": "Ugo Candido"
  },
  "publisher": {
    "@type": "Organization",
    "name": "CalcDomain",
    "logo": {
      "@type": "ImageObject",
      "url": "https://calcdomain.com/logo.png"
    }
  },
  "about": [
    {
      "@type": "Thing",
      "name": "RMD calculator"
    },
    {
      "@type": "Thing",
      "name": "Required Minimum Distribution"
    },
    {
      "@type": "Thing",
      "name": "Retirement planning"
    }
  ],
  "mainEntity": [
    {
      "@type": "SoftwareApplication",
      "name": "RMD (Required Minimum Distribution) Calculator",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "provider": {
        "@type": "Organization",
        "name": "CalcDomain"
      }
    },
    {
      "@type": "HowTo",
      "name": "How It Works: A Step-by-Step RMD Example",
      "description": "Example showing how to calculate an RMD using the IRS Uniform Lifetime Table.",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Gather inputs",
          "text": "Get your prior-year December 31 balance, your date of birth, and the tax year."
        },
        {
          "@type": "HowToStep",
          "name": "Determine age",
          "text": "Compute your age as of December 31 of the selected tax year."
        },
        {
          "@type": "HowToStep",
          "name": "Find factor",
          "text": "Look up the IRS Uniform Lifetime Table factor for that age."
        },
        {
          "@type": "HowToStep",
          "name": "Calculate RMD",
          "text": "Divide the account balance by the factor to obtain the annual RMD."
        }
      ]
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is an RMD and who must take it?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "An RMD is the minimum amount you must withdraw each year from most tax-advantaged retirement accounts once you reach the applicable beginning age (73 through 2032; 75 starting 2033)."
          }
        },
        {
          "@type": "Question",
          "name": "Which table does this calculator use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This tool uses the IRS Uniform Lifetime Table (rev. 2022) for account owners. It does not calculate joint life or inherited RMDs."
          }
        },
        {
          "@type": "Question",
          "name": "What if my spouse is more than 10 years younger and is my sole beneficiary?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "In that case you may use the Joint Life Expectancy Table, which often lowers your RMD. This version focuses on the Uniform Lifetime Table; consult IRS Pub. 590-B or your advisor for joint-life factors."
          }
        },
        {
          "@type": "Question",
          "name": "When is my first RMD due?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Your first RMD (the year you reach the beginning age) may be delayed until April 1 of the following year. If you delay, you will also need to take the second RMD by December 31 of that following year."
          }
        },
        {
          "@type": "Question",
          "name": "Which balances should I enter?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Enter your account’s balance as of December 31 of the prior year. IRA RMDs can be aggregated across your IRAs, but employer plans (like 401(k)) generally cannot be aggregated across plans."
          }
        },
        {
          "@type": "Question",
          "name": "Does the SECURE 2.0 Act change the RMD age?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. The beginning age is 73 for 2023–2032 and increases to 75 starting in 2033."
          }
        }
      ]
    }
  ]
}
  </script>
<style>
    /* Design tokens (critical) */
    :root{
      --primary:#005A9C; --secondary:#003F6E; --bg:#F8F9FA; --surface:#FFFFFF;
      --text:#212529; --muted:#6C757D; --border:#DEE2E6; --success:#198754; --danger:#DC3545;
      --radius:10px; --shadow:0 4px 12px rgba(0,0,0,.06);
      --touch:48px;
    }
    /* Base (critical) */
    *,*::before,*::after{box-sizing:border-box}
    html{font-size:clamp(16px,2.1vw,18px)}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
    a{color:var(--primary);text-decoration:none}
    a:focus{outline:3px solid var(--primary);outline-offset:2px;border-radius:3px}
    .skip-link{position:absolute;left:8px;top:-40px;background:var(--primary);color:#fff;padding:8px 14px;border-radius:0 0 6px 6px;z-index:1000}
    .skip-link:focus{top:0}
    main{padding:1.25rem 0 2rem}
    .container{max-width:1100px;margin:0 auto;padding:0 1rem}
    h1{font-weight:800;color:var(--secondary);font-size:clamp(1.6rem,4vw,2.4rem);margin:.25rem 0 0.5rem}
    p{max-width:70ch}
    /* Calculator layout (critical) */
    .layout{display:grid;grid-template-columns:1fr;gap:1.5rem;margin-top:1rem}
    @media(min-width:992px){.layout{grid-template-columns:420px 1fr}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:1.25rem}
    .calculator .section-title{margin:0 0 .5rem;font-size:1.25rem}
    .form-group{margin-bottom:1rem}
    .label-row{display:flex;align-items:center;gap:.5rem;justify-content:space-between}
    label{display:block;font-weight:700;margin-bottom:.35rem}
    .help-btn{appearance:none;border:1px solid var(--border);background:var(--surface);border-radius:999px;width:var(--touch);height:var(--touch);min-width:var(--touch);min-height:var(--touch);display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
    .help-btn:focus{outline:3px solid var(--primary);outline-offset:2px}
    .tooltip{display:none;margin:.35rem 0 0;color:#0b4f71;background:#e7f2fb;border:1px solid #b6dcfa;border-radius:8px;padding:.5rem .75rem}
    .tooltip[aria-hidden="false"]{display:block}
    .input-wrap{position:relative}
    .unit{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);color:var(--muted);pointer-events:none}
    input[type="number"],input[type="date"],select{
      width:100%;min-height:var(--touch);padding:.75rem 2.2rem .75rem .9rem;border:1px solid var(--border);
      border-radius:8px;font-size:1rem;background:#fff;transition:border-color .2s, box-shadow .2s;
    }
    input[type="date"]{padding-right:.9rem}
    input:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,90,156,.15)}
    .error{color:var(--danger);font-size:.92rem;margin-top:.35rem}
    .actions{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.75rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;font-weight:700;border-radius:10px;border:1px solid transparent;cursor:pointer;min-height:var(--touch);padding:.7rem 1rem}
    .btn-primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn-secondary{background:transparent;color:var(--primary);border-color:var(--primary)}
    .results{min-height:240px;border:1px solid var(--border);background:#fbfcfd;border-radius:12px;padding:1rem}
    .result-row{display:flex;justify-content:space-between;align-items:baseline;border-bottom:1px dashed var(--border);padding:.6rem 0}
    .result-row:last-child{border-bottom:none}
    .result-label{color:var(--muted)}
    .result-value{font-weight:800;color:var(--success);font-size:1.25rem}
    .note{font-size:.95rem;color:#0f5132;background:#d1e7dd;border:1px solid #badbcc;border-radius:8px;padding:.75rem .9rem;margin-top:.75rem}
    /* Content section (critical) */
    .content h2{margin:1.25rem 0 .5rem;color:var(--secondary)}
    .formula-box{background:#f1f3f5;border:1px solid var(--border);border-radius:10px;padding:1rem;overflow:auto}
    ul.clean{padding-left:1.25rem}
    .data-source{background:#fff8e6;border:1px solid #ffe5a3;color:#664d03;padding:.8rem 1rem;border-radius:10px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    footer{margin-top:2rem;padding:1.25rem 0;border-top:1px solid var(--border);color:var(--muted);font-size:.95rem}
    /* High contrast support */
    @media (prefers-contrast: more){
      .note,.tooltip{border-width:2px}
    }
    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto;transition:none}
    }
  </style>
<!-- MathJax for LaTeX rendering of formulas (deferred, non-blocking) -->
<script async="" defer="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="search.js" defer></script>
</head>
<body>

<a class="skip-link" href="#main">Skip to main content</a>
<main class="container" id="main" role="main">
<h1>RMD (Required Minimum Distribution) Calculator</h1>
<p>
      This authoritative RMD calculator estimates the minimum you must withdraw from eligible retirement accounts each year using the IRS Uniform Lifetime Table (rev. 2022). It’s designed for account owners, not inherited accounts, and helps retirees and advisors plan compliant withdrawals with confidence.
    </p>
<div class="layout" id="calculator-layout">
<!-- Calculator -->
<section aria-labelledby="calc-heading" class="card calculator">
<h2 class="section-title" id="calc-heading">Calculator</h2>
<form id="rmdForm" novalidate="">
<!-- Currency -->
<div class="form-group">
<label for="currency">Currency</label>
<select aria-label="Display currency" id="currency" name="currency">
<option selected="" value="USD">USD — US Dollar</option>
<option value="EUR">EUR — Euro</option>
<option value="GBP">GBP — British Pound</option>
<option value="CAD">CAD — Canadian Dollar</option>
<option value="AUD">AUD — Australian Dollar</option>
</select>
</div>
<!-- Balance -->
<div class="form-group">
<div class="label-row">
<label for="balance">Prior-Year 12/31 Account Balance *</label>
<button aria-controls="balanceTip" aria-expanded="false" aria-label="Toggle help for prior-year balance" class="help-btn" id="balanceHelpBtn" type="button">?</button>
</div>
<div class="input-wrap">
<input aria-describedby="balanceTip balanceError balanceUnit" aria-required="true" id="balance" inputmode="decimal" min="0" name="balance" placeholder="e.g., 250000" step="0.01" type="number"/>
<span class="unit" id="balanceUnit">$</span>
</div>
<div aria-hidden="true" class="tooltip" id="balanceTip" role="tooltip">
              Enter the account value as of December 31 of the previous year. IRA RMDs may be aggregated across IRAs; employer-plan RMDs generally cannot be aggregated across plans.
            </div>
<div aria-live="polite" class="error" id="balanceError" role="alert"></div>
</div>
<!-- Tax Year -->
<div class="form-group">
<div class="label-row">
<label for="taxYear">Tax Year *</label>
<button aria-controls="yearTip" aria-expanded="false" aria-label="Toggle help for tax year" class="help-btn" id="yearHelpBtn" type="button">?</button>
</div>
<input aria-describedby="yearTip yearError" aria-required="true" id="taxYear" max="2040" min="2023" name="taxYear" placeholder="e.g., 2025" type="number"/>
<div aria-hidden="true" class="tooltip" id="yearTip" role="tooltip">
              Choose the year for which the RMD is being calculated. The beginning age is 73 through 2032 and increases to 75 starting in 2033 (SECURE 2.0).
            </div>
<div aria-live="polite" class="error" id="yearError" role="alert"></div>
</div>
<!-- Date of Birth -->
<div class="form-group">
<div class="label-row">
<label for="dob">Your Date of Birth *</label>
<button aria-controls="dobTip" aria-expanded="false" aria-label="Toggle help for date of birth" class="help-btn" id="dobHelpBtn" type="button">?</button>
</div>
<input aria-describedby="dobTip dobError" aria-required="true" id="dob" name="dob" type="date"/>
<div aria-hidden="true" class="tooltip" id="dobTip" role="tooltip">
              Used to determine your age on December 31 of the selected tax year, which selects the correct IRS life-expectancy factor.
            </div>
<div aria-live="polite" class="error" id="dobError" role="alert"></div>
</div>
<div class="actions">
<button aria-label="Calculate Required Minimum Distribution" class="btn btn-primary" id="calcBtn" type="button">Calculate</button>
<button aria-label="Reset all fields" class="btn btn-secondary" id="resetBtn" type="reset">Reset</button>
</div>
</form>
</section>
<!-- Results -->
<section aria-labelledby="results-heading" class="card">
<h2 class="section-title" id="results-heading">Results</h2>
<div aria-live="polite" class="results" id="resultsBox">
<div class="result-row">
<span class="result-label">RMD Amount</span>
<span class="result-value" id="rmdAmount">—</span>
</div>
<div class="result-row">
<span class="result-label">IRS Factor Used</span>
<span class="result-value" id="factorUsed">—</span>
</div>
<div class="result-row">
<span class="result-label">Age at Year-End</span>
<span class="result-value" id="ageAtYearEnd">—</span>
</div>
<div class="result-row">
<span class="result-label">RMD Required?</span>
<span class="result-value" id="rmdRequired">—</span>
</div>
<div class="note" hidden="" id="rmdNote"></div>
</div>
</section>
</div>
<!-- Authoritative content -->
<section aria-labelledby="methodology" class="content">
<h2 id="methodology">Data Source and Methodology</h2>
<div class="data-source">
<p>
          Authoritative Data Source: IRS Uniform Lifetime Table (revised 2022), IRS Publication 590‑B (Distributions from Individual Retirement Arrangements) and Treasury Reg. §1.401(a)(9)‑9, Table III (Uniform Lifetime).
          Updated annually. Direct references:
        </p>
<ul class="clean">
<li><a href="https://www.irs.gov/pub/irs-pdf/p590b.pdf" rel="nofollow noopener" target="_blank">IRS Publication 590‑B (latest)</a></li>
<li><a href="https://www.irs.gov/retirement-plans/plan-participant-employee/retirement-topics-required-minimum-distributions-rmds" rel="nofollow noopener" target="_blank">IRS RMDs – Retirement Topics</a></li>
</ul>
<p><strong>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</strong></p>
</div>
<h2>The Formula Explained</h2>
<div class="formula-box">
<p>Uniform Lifetime Table method for account owners:</p>
<p>Inline: \( \text{RMD} = \dfrac{\text{Prior-Year 12/31 Balance}}{\text{Distribution Period Factor}} \)</p>
<p>Expanded: \( \text{RMD}_{y} = \frac{B_{y-1,\,12/31}}{F(\text{age as of 12/31 of } y)} \)</p>
<p>Where \(F(\cdot)\) is the IRS Uniform Lifetime factor for that age.</p>
</div>
<h2>Glossary of Variables</h2>
<ul class="clean">
<li><strong>Prior-Year 12/31 Balance (B)</strong>: Your retirement account value as of December 31 of the previous year.</li>
<li><strong>Tax Year (y)</strong>: The calendar year for which the RMD is being determined.</li>
<li><strong>Age at Year-End</strong>: Your age on December 31 of the tax year (used to select the factor).</li>
<li><strong>Distribution Period Factor (F)</strong>: The life-expectancy divisor from the IRS Uniform Lifetime Table for your age.</li>
<li><strong>RMD</strong>: The minimum amount that must be withdrawn for the tax year.</li>
</ul>
<h2>Worked Example</h2>
<h3>How It Works: A Step-by-Step Example</h3>
<ol class="clean">
<li>Inputs: Balance = $250,000 (as of 12/31 last year), Tax Year = 2025, Date of Birth = 1952‑07‑01.</li>
<li>Age at 12/31/2025 = 73.</li>
<li>Uniform Lifetime Factor for 73 = 26.5.</li>
<li>Compute RMD: \( \text{RMD} = \frac{250{,}000}{26.5} \approx 9{,}433.96 \).</li>
</ol>
<p class="note">If 2025 is your first RMD year, you may delay it until April 1, 2026; doing so means also taking your 2026 RMD by 12/31/2026.</p>
<h2>Frequently Asked Questions (FAQ)</h2>
<div>
<h3>1) What is an RMD and who must take it?</h3>
<p>An RMD is the minimum amount you must withdraw each year from most tax-deferred retirement accounts once you reach the applicable beginning age (73 through 2032; 75 starting 2033). Roth IRAs generally have no RMDs for the original owner.</p>
<h3>2) Which table does this calculator use?</h3>
<p>This calculator uses the IRS Uniform Lifetime Table (rev. 2022) for original account owners. Joint-life and inherited RMDs are out of scope for this version.</p>
<h3>3) How do I know my beginning age?</h3>
<p>Under the SECURE 2.0 Act, your RMD beginning age is 73 for 2023–2032 and 75 starting in 2033. The tool applies this automatically based on the selected tax year and your date of birth.</p>
<h3>4) Can I aggregate multiple accounts?</h3>
<p>RMDs from traditional IRAs can usually be aggregated and satisfied from any one or more of your IRAs. Employer plans (e.g., 401(k)) generally require RMDs to be taken separately from each plan.</p>
<h3>5) What if my spouse is &gt;10 years younger and is my sole beneficiary?</h3>
<p>You may use the Joint Life Expectancy Table, which often lowers the RMD. This calculator focuses on the Uniform Lifetime Table. Consult Pub. 590‑B or a fiduciary advisor for joint-life calculations.</p>
<h3>6) What happens if I delay my first RMD?</h3>
<p>You may delay your first RMD until April 1 of the year following your first RMD year. If you do, you will take two RMDs in that following year—potentially increasing taxable income.</p>
<h3>7) Are the outputs tax or investment advice?</h3>
<p>No. This tool is for educational purposes only. Confirm your numbers with a qualified tax professional or your plan custodian.</p>
</div>
<div class="card" style="margin-top:1rem">
<p aria-hidden="true" class="sr-only">Authorship and review</p>
<p>
          Tool developed by <strong>Ugo Candido</strong>. Content verified by <strong>CalcDomain Editorial Board</strong>.<br/>
          Last reviewed for accuracy on: <time datetime="" id="lastReviewed">2025-09-13</time>.
        </p>
</div>
</section>
</main>
<!-- Standard Footer --> 
<script defer="">
    (function(){
      "use strict";

      const $ = (sel, ctx=document) => ctx.querySelector(sel);
      const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

      // DOM refs
      const form = $("#rmdForm");
      const balanceEl = $("#balance");
      const taxYearEl = $("#taxYear");
      const dobEl = $("#dob");
      const currencyEl = $("#currency");
      const calcBtn = $("#calcBtn");
      const resetBtn = $("#resetBtn");

      const balanceError = $("#balanceError");
      const yearError = $("#yearError");
      const dobError = $("#dobError");

      const rmdAmountEl = $("#rmdAmount");
      const factorUsedEl = $("#factorUsed");
      const ageAtYearEndEl = $("#ageAtYearEnd");
      const rmdRequiredEl = $("#rmdRequired");
      const rmdNoteEl = $("#rmdNote");

      const balanceHelpBtn = $("#balanceHelpBtn");
      const yearHelpBtn = $("#yearHelpBtn");
      const dobHelpBtn = $("#dobHelpBtn");

      const balanceTip = $("#balanceTip");
      const yearTip = $("#yearTip");
      const dobTip = $("#dobTip");
      const balanceUnit = $("#balanceUnit");

      // Initialize
      const now = new Date();
      $("#yearNow").textContent = now.getFullYear();
      // Set defaults
      taxYearEl.value = now.getFullYear();
      dobEl.max = new Date().toISOString().slice(0,10);

      // Currency handling
      const currencySymbols = {
        USD: "$", EUR: "€", GBP: "£", CAD: "C$", AUD: "A$"
      };
      function updateCurrencyUnit(){
        const code = currencyEl.value || "USD";
        balanceUnit.textContent = currencySymbols[code] || code;
        formatAndRender(); // live update amounts
      }

      currencyEl.addEventListener("change", updateCurrencyUnit);

      // Accessible tooltip toggles
      function setupTooltip(button, panel){
        button.addEventListener("click", () => {
          const expanded = button.getAttribute("aria-expanded") === "true";
          button.setAttribute("aria-expanded", String(!expanded));
          panel.setAttribute("aria-hidden", String(expanded));
        });
        button.addEventListener("keydown", (e) => {
          if(e.key === " " || e.key === "Enter"){
            e.preventDefault();
            button.click();
          }
        });
      }
      setupTooltip(balanceHelpBtn, balanceTip);
      setupTooltip(yearHelpBtn, yearTip);
      setupTooltip(dobHelpBtn, dobTip);

      // IRS Uniform Lifetime Table (revised 2022). Age -> factor.
      // Source: IRS Pub. 590-B, Table III (Uniform Lifetime)
      const UNIFORM_FACTORS = {
        72:27.4, 73:26.5, 74:25.5, 75:24.6, 76:23.7, 77:22.9, 78:22.0, 79:21.1,
        80:20.2, 81:19.4, 82:18.5, 83:17.7, 84:16.8, 85:16.0, 86:15.2, 87:14.4,
        88:13.7, 89:12.9, 90:12.2, 91:11.5, 92:10.8, 93:10.1, 94:9.5, 95:8.9,
        96:8.4, 97:7.8, 98:7.3, 99:6.8, 100:6.4, 101:6.0, 102:5.6, 103:5.2,
        104:4.9, 105:4.6, 106:4.3, 107:4.1, 108:3.9, 109:3.7, 110:3.5, 111:3.4,
        112:3.3, 113:3.1, 114:3.0, 115:2.9, 116:2.8, 117:2.7, 118:2.5, 119:2.3, 120:2.0
      };

      function rmdBeginningAge(year){
        // SECURE 2.0: age 73 through 2032; age 75 starting 2033
        return year >= 2033 ? 75 : 73;
      }

      function ageOnDec31(dob, year){
        const born = new Date(dob);
        if (isNaN(born)) return NaN;
        return year - born.getFullYear() - (new Date(year, 11, 31) < new Date(year, born.getMonth(), born.getDate()) ? 1 : 0);
      }

      // Validation
      function setError(el, msg){
        el.textContent = msg || "";
      }
      function clearError(el){ setError(el, ""); }

      function validateBalance(){
        const v = Number(balanceEl.value);
        if(!balanceEl.value.trim()){
          setError(balanceError, "Please enter the prior-year 12/31 balance.");
          balanceEl.setAttribute("aria-invalid","true");
          return false;
        }
        if(isNaN(v) || v < 0){
          setError(balanceError, "Balance must be a number greater than or equal to 0.");
          balanceEl.setAttribute("aria-invalid","true");
          return false;
        }
        clearError(balanceError);
        balanceEl.setAttribute("aria-invalid","false");
        return true;
      }
      function validateYear(){
        const y = Number(taxYearEl.value);
        if(!taxYearEl.value.trim()){
          setError(yearError, "Please enter a tax year (e.g., " + now.getFullYear() + ").");
          taxYearEl.setAttribute("aria-invalid","true");
          return false;
        }
        if(isNaN(y) || y < 2023 || y > 2040){
          setError(yearError, "Enter a tax year between 2023 and 2040.");
          taxYearEl.setAttribute("aria-invalid","true");
          return false;
        }
        clearError(yearError);
        taxYearEl.setAttribute("aria-invalid","false");
        return true;
      }
      function validateDob(){
        const v = dobEl.value;
        if(!v){
          setError(dobError, "Please provide your date of birth.");
          dobEl.setAttribute("aria-invalid","true");
          return false;
        }
        const d = new Date(v + "T00:00:00");
        if(isNaN(d) || d > new Date()){
          setError(dobError, "Date of birth must be a valid date in the past.");
          dobEl.setAttribute("aria-invalid","true");
          return false;
        }
        // Reasonable upper bound (ensure age < 120 now)
        const ageNow = new Date().getFullYear() - d.getFullYear();
        if(ageNow > 120){
          setError(dobError, "Please enter a realistic date of birth (age 120 or less).");
          dobEl.setAttribute("aria-invalid","true");
          return false;
        }
        clearError(dobError);
        dobEl.setAttribute("aria-invalid","false");
        return true;
      }

      balanceEl.addEventListener("blur", validateBalance);
      taxYearEl.addEventListener("blur", validateYear);
      dobEl.addEventListener("blur", validateDob);

      // Formatting and calculation
      function fmtCurrency(value){
        const code = currencyEl.value || "USD";
        try {
          return new Intl.NumberFormat(undefined, {style:"currency", currency: code, maximumFractionDigits: 2}).format(value);
        } catch {
          // fallback
          return (currencySymbols[code] || "") + (Number(value).toFixed(2));
        }
      }

      function compute(){
        if(!(validateBalance() & validateYear() & validateDob())){
          return null;
        }
        const bal = Number(balanceEl.value);
        const year = Number(taxYearEl.value);
        const age = ageOnDec31(dobEl.value, year);
        if(isNaN(age) || age < 0){
          setError(dobError, "Could not determine your age for the selected year. Check the date.");
          return null;
        }
        const beginAge = rmdBeginningAge(year);
        const prevAge = ageOnDec31(dobEl.value, year - 1);

        let required = false;
        let factor = null;
        let note = "";

        if(age >= beginAge){
          required = true;
          // The factor is looked up by age in Uniform Lifetime Table.
          // Table begins at age 72; for ages below table min but required (future law changes),
          // we guard; for ages above 120 we clamp to 120.
          const lookupAge = Math.max(72, Math.min(120, age));
          factor = UNIFORM_FACTORS[lookupAge] || null;

          // If for some reason factor is missing, mark not computable
          if(!factor){
            required = false;
            note = "A factor for your age was not found in the IRS table range supported by this tool.";
          } else {
            // First RMD year note
            const firstYear = (prevAge < beginAge);
            if(firstYear){
              note = `First RMD year detected. You may delay your ${year} RMD until April 1, ${year + 1}. If you delay, you will also take your ${year + 1} RMD by December 31, ${year + 1}.`;
            } else {
              note = `Your ${year} RMD must be taken by December 31, ${year}.`;
            }
          }
        } else {
          required = false;
          note = `No RMD is required for ${year} because you have not reached the beginning age (${beginAge}).`;
        }

        const rmd = (required && factor) ? (bal / factor) : 0;

        return { rmd, factor, age, required, note, year, balance: bal };
      }

      function render(result){
        if(!result){
          rmdAmountEl.textContent = "—";
          factorUsedEl.textContent = "—";
          ageAtYearEndEl.textContent = "—";
          rmdRequiredEl.textContent = "—";
          rmdNoteEl.hidden = true;
          return;
        }
        rmdAmountEl.textContent = fmtCurrency(result.rmd);
        factorUsedEl.textContent = result.factor ? result.factor.toFixed(1) : "n/a";
        ageAtYearEndEl.textContent = String(result.age);
        rmdRequiredEl.textContent = result.required ? "Yes" : "No";
        rmdNoteEl.textContent = result.note || "";
        rmdNoteEl.hidden = !result.note;
      }

      function formatAndRender(){
        render(compute());
      }

      calcBtn.addEventListener("click", formatAndRender);
      // Progressive enhancement: auto-calc when fields change (debounced)
      let debounce;
      ["input","change"].forEach(evt => form.addEventListener(evt, () => {
        clearTimeout(debounce);
        debounce = setTimeout(formatAndRender, 120);
      }));

      resetBtn.addEventListener("click", () => {
        // Reset errors and results
        [balanceError, yearError, dobError].forEach(clearError);
        [balanceEl, taxYearEl, dobEl].forEach(el=>el.setAttribute("aria-invalid","false"));
        setTimeout(()=>{ // after native reset
          taxYearEl.value = now.getFullYear();
          updateCurrencyUnit();
          render(null);
        }, 0);
      });

      // Initial render
      updateCurrencyUnit();
      render(null);

      // Ensure input describes tooltips and errors correctly
      balanceEl.setAttribute("aria-describedby", "balanceTip balanceError balanceUnit");
      taxYearEl.setAttribute("aria-describedby", "yearTip yearError");
      dobEl.setAttribute("aria-describedby", "dobTip dobError");

      // Keyboard enhancements for buttons (Enter/Space already handled via button defaults)
    })();
  </script>

<script defer src="/assets/js/mobile-menu.js"></script>
<script defer src="/assets/js/page-enhancements.js"></script>
</body></html>