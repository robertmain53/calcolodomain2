<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/distance-calculator">





  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Distance Calculator — 2D/3D Points & Great-Circle (Lat/Lon)</title>
  <meta name="description" content="Professional distance calculator for geometry and geodesy. Compute Euclidean distance in 2D/3D or great-circle distance between coordinates using WGS84 (IUGG mean Earth radius). Includes bearings, unit conversions, and an example walkthrough." />
  

  <!-- Icons / PWA (placeholder paths; keep consistent with your site) -->
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />

  <!-- Tailwind (CDN build for a single-page artifact) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- KaTeX for fast LaTeX rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha256-MJqSWXbK8Qh3A9F2l1Jw9l8qO+9lZ8M4Jz4WBmLzqgI=" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha256-+yKcVgkqX8lQk2Gd4n3vI4kq2hZ5j0N4yP9H3k8r1lQ=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha256-7mJ8m3t0m8tWb1HkBq+Qh9n0g2o7bWqk0pF1V2gJBaQ=" crossorigin="anonymous"></script>

  <style>
    :root {
      --focus: #1d4ed8; /* blue-700 */
      --accent: #2563eb; /* blue-600 */
      --danger: #b91c1c; /* red-700 */
    }
    /* readable prose defaults */
    .prose { max-width: 70ch; }
    .prose h2 { font-size: 1.5rem; font-weight: 700; margin-top: 2rem; margin-bottom: 0.75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .prose p, .prose li { line-height: 1.7; }
    .formula-box {
      background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1rem; overflow-x: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    /* visible focus */
    :focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; border-radius: 6px; }
    /* results min-height to prevent CLS */
    #results { min-height: 12rem; }
    /* tappable targets */
    .tap-target { min-height: 48px; min-width: 48px; }
    /* print: only main content */
    @media print {
      body * { visibility: hidden; }
      #print-section, #print-section * { visibility: visible; }
      #print-section { position: absolute; inset: 0 0 auto 0; width: 100%; }
    }
  </style>

  <!-- JSON-LD: WebPage + WebApplication + HowTo + Breadcrumbs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Distance Calculator — 2D/3D & Great-Circle",
    "url":"https://calcdomain.com/distance-calculator",
    "inLanguage":"en",
    "description":"Compute Euclidean distance (2D/3D) and great-circle distance between latitude/longitude pairs using WGS84. Includes bearings, unit conversions, and a worked example.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Distance Calculator",
    "applicationCategory":"EducationalApplication",
    "operatingSystem":"Any",
    "url":"https://calcdomain.com/distance-calculator",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "author":{"@type":"Person","name":"Ugo Candido"},
    "about":["subcategories/geometry","Geodesy","Great-circle distance","Haversine","Euclidean distance"]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to compute distance between two points",
    "step":[
      {"@type":"HowToStep","name":"Choose mode","text":"Pick Cartesian (2D/3D) or Geographic (Lat/Lon)."},
      {"@type":"HowToStep","name":"Enter inputs","text":"Fill both points—coordinates or latitude/longitude."},
      {"@type":"HowToStep","name":"Review results","text":"See distance in meters, kilometers, miles, and nautical miles."},
      {"@type":"HowToStep","name":"Optional details","text":"View initial bearing and a step-by-step example."}
    ]
  }
  </script>
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Math & Conversions",
      "item": "https://calcdomain.com/math-conversions"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "subcategories/geometry",
      "item": "https://calcdomain.com/subcategories/geometry"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Distance Calculator",
      "item": "https://calcdomain.com/distance-calculator"
    }
  ]
}</script>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header (non-sticky per requisiti) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="https://calcdomain.com" class="text-2xl font-extrabold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="https://calcdomain.com/search" class="hover:text-blue-700">Search</a>
        Categories
      </nav>
      <button id="menuBtn" class="md:hidden tap-target p-2 rounded hover:bg-gray-100" aria-expanded="false" aria-controls="mnav" aria-label="Open menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"></svg>
      </button>
    </div>
    <div id="mnav" class="hidden md:hidden border-t">
      <div class="container mx-auto px-4 lg:px-6 py-3 space-y-2">
        <a class="block py-2 hover:text-blue-700" href="https://calcdomain.com/search">Search</a>
        Categories
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div id="print-section" class="max-w-5xl mx-auto">
      <!-- breadcrumbs -->
      <nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
        <a href="https://calcdomain.com" class="hover:text-blue-700">Home</a> &raquo;
        <a href="https://calcdomain.com/math" class="hover:text-blue-700">Math</a> &raquo;
        <a href="https://calcdomain.com/subcategories/geometry" class="hover:text-blue-700">Geometry</a> &raquo;
        <span class="text-gray-900">Distance Calculator</span>
      </nav>

      <!-- 1) Title -->
      <h1 class="text-3xl font-extrabold tracking-tight mb-2">Distance Calculator</h1>

      <!-- 2) Intro -->
      <p class="text-gray-700 mb-6 prose">
        Compute distances between two points either in <strong>Cartesian space</strong> (2D/3D) or on the <strong>Earth’s surface</strong> using the great-circle (Haversine) model based on WGS84. Built for students, engineers, GIS analysts, and professionals who need fast, reliable, and well-explained results—with accessible UX and transparent methodology.
      </p>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <section class="lg:col-span-2 bg-white p-6 rounded-lg shadow" aria-labelledby="calcTitle">
          <!-- 3) Calculator -->
          <h2 id="calcTitle" class="text-xl font-bold mb-4">Interactive Calculator</h2>

          <!-- Mode switch -->
          <fieldset class="mb-4">
            <legend class="sr-only">Calculation mode</legend>
            <div class="flex flex-wrap gap-3" role="tablist" aria-label="Calculation mode">
              <button id="mode-cartesian" role="tab" aria-selected="true" aria-controls="panel-cartesian"
                class="tap-target px-4 py-2 rounded border border-blue-600 text-blue-700 font-semibold">
                Cartesian (2D/3D)
              </button>
              <button id="mode-geo" role="tab" aria-selected="false" aria-controls="panel-geo"
                class="tap-target px-4 py-2 rounded border hover:border-gray-300">
                Geographic (Lat/Lon)
              </button>
            </div>
          </fieldset>

          <!-- Panels -->
          <div id="panel-cartesian" role="tabpanel" tabindex="0" aria-labelledby="mode-cartesian">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Point A -->
              <div>
                <label for="x1" class="block text-sm font-medium text-gray-800">Point A — x* </label>
                <div class="flex items-start gap-2">
                  <input id="x1" name="x1" type="number" inputmode="decimal" step="any" value="0" aria-required="true"
                         aria-describedby="x1-help x1-err"
                         class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                  <button type="button" class="tap-target mt-1 p-2 rounded border" aria-controls="x1-help" aria-expanded="false" data-tooltip>
                    ?
                  </button>
                </div>
                <p id="x1-help" class="text-xs text-gray-600 mt-1 hidden">Cartesian coordinate x for Point A.</p>
                <p id="x1-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="y1" class="block text-sm font-medium text-gray-800">Point A — y* </label>
                <input id="y1" name="y1" type="number" inputmode="decimal" step="any" value="0" aria-required="true"
                       aria-describedby="y1-err"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="y1-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="z1" class="block text-sm font-medium text-gray-800">Point A — z (optional)</label>
                <input id="z1" name="z1" type="number" inputmode="decimal" step="any" value="0"
                       aria-describedby="z1-help"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="z1-help" class="text-xs text-gray-600 mt-1">Leave 0 for 2D calculations.</p>
              </div>
              <!-- Point B -->
              <div>
                <label for="x2" class="block text-sm font-medium text-gray-800">Point B — x* </label>
                <input id="x2" name="x2" type="number" inputmode="decimal" step="any" value="3" aria-required="true"
                       aria-describedby="x2-err"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="x2-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="y2" class="block text-sm font-medium text-gray-800">Point B — y* </label>
                <input id="y2" name="y2" type="number" inputmode="decimal" step="any" value="4" aria-required="true"
                       aria-describedby="y2-err"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="y2-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="z2" class="block text-sm font-medium text-gray-800">Point B — z (optional)</label>
                <input id="z2" name="z2" type="number" inputmode="decimal" step="any" value="0"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
              </div>
            </div>
          </div>

          <div id="panel-geo" role="tabpanel" tabindex="-1" aria-labelledby="mode-geo" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="lat1" class="block text-sm font-medium text-gray-800">Point A — Latitude (°)*</label>
                <div class="flex items-start gap-2">
                  <input id="lat1" type="number" inputmode="decimal" step="any" value="41.9028" aria-required="true"
                         aria-describedby="lat1-help lat1-err"
                         class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                  <button type="button" class="tap-target mt-1 p-2 rounded border" aria-controls="lat1-help" aria-expanded="false" data-tooltip>?</button>
                </div>
                <p id="lat1-help" class="text-xs text-gray-600 mt-1 hidden">Latitude in decimal degrees (−90 to 90). Example: Rome ≈ 41.90</p>
                <p id="lat1-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="lon1" class="block text-sm font-medium text-gray-800">Point A — Longitude (°)*</label>
                <input id="lon1" type="number" inputmode="decimal" step="any" value="12.4964" aria-required="true"
                       aria-describedby="lon1-err"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="lon1-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="lat2" class="block text-sm font-medium text-gray-800">Point B — Latitude (°)*</label>
                <input id="lat2" type="number" inputmode="decimal" step="any" value="45.4642" aria-required="true"
                       aria-describedby="lat2-err"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="lat2-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="lon2" class="block text-sm font-medium text-gray-800">Point B — Longitude (°)*</label>
                <input id="lon2" type="number" inputmode="decimal" step="any" value="9.1900" aria-required="true"
                       aria-describedby="lon2-err"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="lon2-err" class="text-sm text-red-700 mt-1" role="alert" aria-live="polite"></p>
              </div>
              <div>
                <label for="speed" class="block text-sm font-medium text-gray-800">Optional speed (km/h)</label>
                <input id="speed" type="number" inputmode="decimal" step="any" value="0"
                       aria-describedby="speed-help"
                       class="tap-target mt-1 w-full px-3 py-2 border rounded focus:ring-0 focus:border-blue-600" />
                <p id="speed-help" class="text-xs text-gray-600 mt-1">If provided, we estimate travel time (distance ÷ speed).</p>
              </div>
            </div>
          </div>

          <div class="mt-6 flex flex-wrap items-center gap-3">
            <button id="btn-calc" class="tap-target px-5 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700">Calculate</button>
            <button id="btn-reset" class="tap-target px-5 py-2 rounded border hover:bg-gray-50">Reset</button>
          </div>
        </section>

        <!-- 4) Results -->
        <section id="results" class="lg:col-span-1 bg-blue-50 border border-blue-100 rounded-lg p-5">
          <h2 class="text-lg font-bold text-blue-900 mb-3">Results</h2>
          <div class="grid grid-cols-1 gap-3">
            <div class="bg-white rounded border p-3">
              <h3 class="text-sm text-gray-600">Distance</h3>
              <p id="distancePrimary" class="text-2xl font-extrabold text-blue-700">—</p>
              <p id="distanceUnits" class="text-sm text-gray-600">Meters · Kilometers · Miles · Nautical miles</p>
            </div>
            <div class="bg-white rounded border p-3">
              <h3 class="text-sm text-gray-600">Breakdown</h3>
              <ul class="text-sm text-gray-800 space-y-1">
                <li><span class="font-semibold">Meters:</span> <span id="mOut">—</span></li>
                <li><span class="font-semibold">Kilometers:</span> <span id="kmOut">—</span></li>
                <li><span class="font-semibold">Miles:</span> <span id="miOut">—</span></li>
                <li><span class="font-semibold">Nautical miles:</span> <span id="nmOut">—</span></li>
                <li id="bearingRow" class="hidden"><span class="font-semibold">Initial bearing:</span> <span id="bearingOut">—</span>°</li>
                <li id="etaRow" class="hidden"><span class="font-semibold">Estimated time @ speed:</span> <span id="etaOut">—</span></li>
              </ul>
            </div>
            <p class="text-xs text-gray-600 mt-1">Tip: For short urban paths, actual travel distance can exceed great-circle distance due to roads, terrain, or obstacles.</p>
          </div>
        </section>
      </div>

      <!-- 5) Authoritative content ecosystem -->
      <section class="prose mt-10 bg-white p-6 rounded-lg shadow">
        <h2>Authoritative Data Source & Methodology</h2>
        <p><strong>Primary standard:</strong> WGS84 geographic coordinates (EPSG:4326) and the <em>IUGG (International Union of Geodesy and Geophysics)</em> mean Earth radius
          \( R = 6{,}371{.}0088\ \text{km} \) for great-circle distance calculations. See:
          <a class="text-blue-700 underline" href="https://epsg.io/4326" rel="nofollow">EPSG:4326</a> and IUGG mean Earth radius references.
          <br><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em>
        </p>

        <h2>The Formula Explained</h2>
        <h3>Cartesian (2D/3D)</h3>
        <div class="formula-box">
          <div>2D: \\( d = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2} \\)</div>
          <div>3D: \\( d = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2 + (z_2 - z_1)^2} \\)</div>
        </div>

        <h3>Great-circle (Haversine)</h3>
        <div class="formula-box">
          \\[
          \begin{aligned}
          \Delta\varphi &= \varphi_2 - \varphi_1,\quad \Delta\lambda = \lambda_2 - \lambda_1 \\\\
          a &= \sin^2\!\left(\frac{\Delta\varphi}{2}\right)
               + \cos\varphi_1 \cos\varphi_2 \sin^2\!\left(\frac{\Delta\lambda}{2}\right) \\\\
          c &= 2 \arctan2(\sqrt{a}, \sqrt{1-a}) \\\\
          d &= R \cdot c
          \end{aligned}
          \\]
        </div>
        <p>Initial bearing (forward azimuth) from Point A to B:</p>
        <div class="formula-box">
          \\[
            \theta = \operatorname{atan2}\!\left(\sin\Delta\lambda \cdot \cos\varphi_2,\;
            \cos\varphi_1 \cdot \sin\varphi_2 - \sin\varphi_1 \cdot \cos\varphi_2 \cdot \cos\Delta\lambda\right)
          \\]
        </div>

        <h2>Glossary of Variables</h2>
        <ul>
          <li><strong>x, y, z</strong>: Cartesian coordinates (user units).</li>
          <li><strong>\(\varphi\) (phi)</strong>: Latitude in radians (north positive).</li>
          <li><strong>\(\lambda\) (lambda)</strong>: Longitude in radians (east positive).</li>
          <li><strong>R</strong>: Earth mean radius (6,371.0088 km).</li>
          <li><strong>d</strong>: Distance between the two points.</li>
          <li><strong>\(\theta\)</strong>: Initial bearing from A to B, degrees (0–360).</li>
        </ul>

        <h2>How It Works: A Step-by-Step Example</h2>
        <p><strong>Task:</strong> Great-circle distance between Rome (41.9028° N, 12.4964° E) and Milan (45.4642° N, 9.1900° E).</p>
        <ol>
          <li>Convert degrees to radians: \\( \varphi=\text{deg}\cdot\pi/180 \\).</li>
          <li>Compute \\( \Delta\varphi \\) and \\( \Delta\lambda \\), then \\( a \\) via Haversine.</li>
          <li>Compute \\( c = 2\arctan2(\sqrt{a}, \sqrt{1-a}) \\).</li>
          <li>Distance \\( d = R \cdot c \\). With \( R=6{,}371{.}0088 \) km, you get ~<em>~478 km</em> (great-circle).</li>
          <li>Initial bearing via the atan2 formula gives a heading of roughly SSE→NNW (~<em>~329°</em> from Rome to Milan).</li>
        </ol>

        <h2>FAQ</h2>
        <details>
          <summary>Great-circle vs. driving distance—why different?</summary>
          <p>Great-circle is the shortest path on a sphere. Real travel follows roads, terrain, and constraints, so it’s typically longer.</p>
        </details>
        <details>
          <summary>How accurate is the Haversine formula?</summary>
          <p>It’s excellent for most purposes. For sub-meter or polar/antipodal precision, use full ellipsoidal geodesics (e.g., Karney’s algorithms).</p>
        </details>
        <details>
          <summary>Do I enter latitude/longitude in degrees, minutes, and seconds?</summary>
          <p>Use decimal degrees here (e.g., 41.9028). Convert DMS to decimals if needed.</p>
        </details>
        <details>
          <summary>Can I calculate 3D distance with altitude?</summary>
          <p>Yes in Cartesian mode by using z coordinates. In geographic mode this tool reports surface great-circle distance.</p>
        </details>
        <details>
          <summary>What bearing is reported?</summary>
          <p>The initial bearing (forward azimuth) at the starting point, normalized to 0–360°.</p>
        </details>
        <details>
          <summary>Which Earth radius do you use?</summary>
          <p>IUGG mean Earth radius \( R=6{,}371{.}0088 \) km, widely used for global calculations.</p>
        </details>

        <!-- 6) Authorship & review -->
        <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
          Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="https://calcdomain.com/about" class="hover:text-blue-700">About</a>
        <a href="https://calcdomain.com/contact" class="hover:text-blue-700">Contact</a>
        <a href="https://calcdomain.com/privacy" class="hover:text-blue-700">Privacy</a>
        <a href="https://calcdomain.com/terms" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (placed before </body>; wrapped in DOMContentLoaded) -->
  <script defer>
  document.addEventListener('DOMContentLoaded', () => {
    // Mobile menu
    const menuBtn = document.getElementById('menuBtn');
    const mnav = document.getElementById('mnav');
    menuBtn?.addEventListener('click', () => {
      const open = mnav.classList.toggle('hidden') ? 'false' : 'true';
      menuBtn.setAttribute('aria-expanded', open);
    });

    // KaTeX auto-render (math blocks inside .formula-box)
    renderMathInElement?.(document.body, {
      delimiters: [
        {left: "\\[", right: "\\]", display: true},
        {left: "\\(", right: "\\)", display: false}
      ],
      throwOnError: false
    });

    // Mode tabs
    const tabCartesian = document.getElementById('mode-cartesian');
    const tabGeo = document.getElementById('mode-geo');
    const panelCartesian = document.getElementById('panel-cartesian');
    const panelGeo = document.getElementById('panel-geo');

    function selectMode(mode) {
      const cartActive = mode === 'cartesian';
      tabCartesian.setAttribute('aria-selected', String(cartActive));
      tabGeo.setAttribute('aria-selected', String(!cartActive));
      panelCartesian.classList.toggle('hidden', !cartActive);
      panelGeo.classList.toggle('hidden', cartActive);
      panelCartesian.setAttribute('tabindex', cartActive ? '0' : '-1');
      panelGeo.setAttribute('tabindex', cartActive ? '-1' : '0');
      // Clear bearing/eta in Cartesian mode
      toggleRow('bearingRow', !cartActive);
      toggleRow('etaRow', false);
      setText('etaOut', '—');
    }
    tabCartesian.addEventListener('click', () => selectMode('cartesian'));
    tabGeo.addEventListener('click', () => selectMode('geo'));

    // Tooltips (accessible toggle)
    document.querySelectorAll('[data-tooltip]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('aria-controls');
        const help = document.getElementById(id);
        const open = help.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', (!open).toString());
      });
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
      });
    });

    // Elements
    const ids = [
      'x1','y1','z1','x2','y2','z2',
      'lat1','lon1','lat2','lon2','speed'
    ];
    const el = Object.fromEntries(ids.map(id => [id, document.getElementById(id)]));

    // Results elements
    const distancePrimary = document.getElementById('distancePrimary');
    const mOut = document.getElementById('mOut');
    const kmOut = document.getElementById('kmOut');
    const miOut = document.getElementById('miOut');
    const nmOut = document.getElementById('nmOut');
    const bearingOut = document.getElementById('bearingOut');

    // Utils
    const R_M = 6371008.8; // meters (IUGG mean Earth radius)
    const toRad = deg => deg * Math.PI / 180;
    const toDeg = rad => rad * 180 / Math.PI;
    const fmtNum = (n, d=3) => isFinite(n) ? Number(n).toLocaleString(undefined, {maximumFractionDigits: d}) : '—';
    function setText(id, txt) { document.getElementById(id).textContent = txt; }
    function toggleRow(id, show) {
      const row = document.getElementById(id);
      row.classList.toggle('hidden', !show);
    }
    function clamp(v, min, max) { return Math.min(Math.max(v, min), max); }

    // Inline validation on blur (with aria-describedby to error ids)
    function err(id, msg='') {
      const errEl = document.getElementById(id + '-err');
      if (!errEl) return;
      errEl.textContent = msg;
      return msg === '';
    }
    function reqNumber(inputId, label, opts={}) {
      const v = document.getElementById(inputId).value.trim();
      if (v === '') return err(inputId, `${label} is required.`);
      const num = Number(v);
      if (!isFinite(num)) return err(inputId, `${label} must be a number.`);
      if (opts.min != null && num < opts.min) return err(inputId, `${label} must be ≥ ${opts.min}.`);
      if (opts.max != null && num > opts.max) return err(inputId, `${label} must be ≤ ${opts.max}.`);
      return err(inputId, '');
    }
    // attach validators
    [['x1','x'],['y1','y'],['x2','x'],['y2','y']].forEach(([id,lbl]) => el[id]?.addEventListener('blur', () => reqNumber(id, `Point ${id.endsWith('1')?'A':'B'} — ${lbl.toUpperCase()}`)));
    [['lat1','Latitude',-90,90],['lon1','Longitude',-180,180],['lat2','Latitude',-90,90],['lon2','Longitude',-180,180]].forEach(([id,lbl,min,max]) => el[id]?.addEventListener('blur', () => reqNumber(id, `Point ${id.endsWith('1')?'A':'B'} — ${lbl}`, {min, max})));
    el.speed?.addEventListener('blur', () => {
      const v = el.speed.value.trim();
      if (v === '' || Number(v) === 0) { err('speed',''); return; }
      reqNumber('speed','Speed (km/h)', {min: 0});
    });

    // Calculation
    function calcCartesian() {
      const ok = reqNumber('x1','Point A — X') &
                 reqNumber('y1','Point A — Y') &
                 reqNumber('x2','Point B — X') &
                 reqNumber('y2','Point B — Y');
      if (!ok) return;

      const x1 = parseFloat(el.x1.value)||0, y1 = parseFloat(el.y1.value)||0, z1 = parseFloat(el.z1.value)||0;
      const x2 = parseFloat(el.x2.value)||0, y2 = parseFloat(el.y2.value)||0, z2 = parseFloat(el.z2.value)||0;
      const dx = x2 - x1, dy = y2 - y1, dz = z2 - z1;
      const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);

      // Units: we don't know user units; present as raw + km/m heuristics if meters presumed
      setText('distancePrimary', `${fmtNum(dist, 6)} (input units)`);
      setText('mOut', '—');
      setText('kmOut', '—');
      setText('miOut', '—');
      setText('nmOut', '—');
      toggleRow('bearingRow', false);
      toggleRow('etaRow', false);
    }

    function calcGeo() {
      const ok =
        reqNumber('lat1','Point A — Latitude', {min:-90,max:90}) &
        reqNumber('lon1','Point A — Longitude', {min:-180,max:180}) &
        reqNumber('lat2','Point B — Latitude', {min:-90,max:90}) &
        reqNumber('lon2','Point B — Longitude', {min:-180,max:180});
      if (!ok) return;

      const lat1 = toRad(clamp(parseFloat(el.lat1.value), -90, 90));
      const lon1 = toRad(clamp(parseFloat(el.lon1.value), -180, 180));
      const lat2 = toRad(clamp(parseFloat(el.lat2.value), -90, 90));
      const lon2 = toRad(clamp(parseFloat(el.lon2.value), -180, 180));

      const dphi = lat2 - lat1;
      const dlam = lon2 - lon1;
      const sinDphi = Math.sin(dphi/2);
      const sinDlam = Math.sin(dlam/2);
      const a = sinDphi*sinDphi + Math.cos(lat1)*Math.cos(lat2)*sinDlam*sinDlam;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const meters = R_M * c;

      const km = meters / 1000;
      const mi = meters / 1609.344;
      const nm = meters / 1852;

      // Initial bearing
      const y = Math.sin(dlam) * Math.cos(lat2);
      const x = Math.cos(lat1)*Math.sin(lat2) - Math.sin(lat1)*Math.cos(lat2)*Math.cos(dlam);
      let brg = toDeg(Math.atan2(y, x));
      brg = (brg + 360) % 360;

      setText('distancePrimary', `${fmtNum(km, 3)} km`);
      setText('mOut', `${fmtNum(meters, 0)} m`);
      setText('kmOut', `${fmtNum(km, 3)} km`);
      setText('miOut', `${fmtNum(mi, 3)} mi`);
      setText('nmOut', `${fmtNum(nm, 3)} nmi`);
      setText('bearingOut', fmtNum(brg, 1));
      toggleRow('bearingRow', true);

      // ETA if speed provided
      const spd = parseFloat(el.speed.value) || 0;
      if (spd > 0) {
        const hours = km / spd;
        const h = Math.floor(hours);
        const m = Math.round((hours - h) * 60);
        setText('etaOut', `${h} h ${m} min`);
        toggleRow('etaRow', true);
      } else {
        toggleRow('etaRow', false);
      }
    }

    // Buttons
    document.getElementById('btn-calc').addEventListener('click', () => {
      if (panelGeo.classList.contains('hidden')) calcCartesian(); else calcGeo();
    });
    document.getElementById('btn-reset').addEventListener('click', () => {
      // reset forms to defaults
      ['x1','y1','z1','x2','y2','z2'].forEach((id,i) => { if (el[id]) el[id].value = [0,0,0,3,4,0][i]; });
      if (el.lat1) el.lat1.value = 41.9028;
      if (el.lon1) el.lon1.value = 12.4964;
      if (el.lat2) el.lat2.value = 45.4642;
      if (el.lon2) el.lon2.value = 9.1900;
      if (el.speed) el.speed.value = 0;
      // clear errors
      document.querySelectorAll('[id$="-err"]').forEach(n => n.textContent='');
      // clear results
      setText('distancePrimary','—'); setText('mOut','—'); setText('kmOut','—'); setText('miOut','—'); setText('nmOut','—');
      setText('bearingOut','—'); setText('etaOut','—');
      toggleRow('bearingRow', !panelGeo.classList.contains('hidden'));
      toggleRow('etaRow', false);
    });

    // Default mode: Cartesian
    selectMode('cartesian');
  });
  </script>
</body>
</html>
