<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/sodium-calculator">





  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sodium Calculator — Daily Intake, Salt ↔ Sodium Converter</title>
  <meta name="description" content="Calculate your daily sodium intake from foods, convert salt (NaCl) to sodium (Na), check % Daily Value, and compare against guideline limits. Accessible, mobile-first tool for diet & nutrition.">
  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
  <!-- KaTeX for LaTeX rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
          onload="renderMathInElement(document.body, {delimiters:[{left:'$$', right:'$$', display:true},{left:'\\(', right:'\\)', display:false}]});"></script>

  <style>
    :root { --focus: #2563eb; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .prose { max-width: 68ch; }
    .prose h2 { font-size: 1.375rem; font-weight: 700; margin-top: 1.75rem; margin-bottom: .75rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p { margin-bottom: .9rem; line-height: 1.65; }
    .prose ul, .prose ol { margin-left: 1.25rem; margin-bottom: .75rem; }
    .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:10px; padding:1rem; overflow-x:auto; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:1rem; text-align:center; }
    .result-card h4 { font-size:.95rem; color:#4b5563; margin-bottom:.25rem; }
    .result-card p { font-size:1.65rem; font-weight:800; color:#1f2937; }
    /* Accessible focus */
    :where(button, a, input, select, textarea, summary):focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
      border-radius:.5rem;
    }
    /* Prevent layout shift in results area */
    #results-box { min-height: 260px; }
    /* Touch targets */
    button, .btn { min-height: 48px; min-width: 48px; }
    /* Table */
    table th, table td { border-bottom: 1px solid #e5e7eb; }
    /* Print */
    @media print {
      header, footer, aside, #ad-slot, #chartWrap { display:none !important; }
      #print-section { position: absolute; inset: 0; }
      body { background: #fff; }
    }
  </style>

  <!-- JSON-LD: WebPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Sodium Calculator — Daily Intake & Salt Converter",
    "url":"https://calcdomain.com/sodium-calculator",
    "inLanguage":"en",
    "description":"Compute daily sodium intake from foods, convert salt (NaCl) to sodium (Na), and compare against guideline limits.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"}
  }
  </script>
  <!-- JSON-LD: Breadcrumbs -->
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Health & Fitness",
      "item": "https://calcdomain.com/health-fitness"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Diet & Nutrition",
      "item": "https://calcdomain.com/subcategories/diet-nutrition"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Sodium Calculator",
      "item": "https://calcdomain.com/sodium-calculator"
    }
  ]
}</script>
  <!-- JSON-LD: HowTo -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"How to calculate daily sodium intake",
    "description":"Add your foods and servings, convert salt to sodium if needed, and compare to the daily limit.",
    "step":[
      {"@type":"HowToStep","name":"Add foods","text":"Enter sodium per serving from the label, plus your servings."},
      {"@type":"HowToStep","name":"Convert salt to sodium (optional)","text":"Use the converter if your data is in grams of salt."},
      {"@type":"HowToStep","name":"Review results","text":"See total sodium, salt equivalent, and % Daily Value."},
      {"@type":"HowToStep","name":"Adjust plan","text":"Modify choices to keep sodium within target limits."}
    ]
  }
  </script>
  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the recommended daily sodium limit?",
        "acceptedAnswer":{"@type":"Answer","text":"For most adults, guideline targets are around 2,000–2,300 mg of sodium per day (≈5–6 g of salt). People with specific medical advice should follow their clinician’s guidance."}},
      {"@type":"Question","name":"How do I convert salt to sodium?",
        "acceptedAnswer":{"@type":"Answer","text":"Sodium is about 39.34% of salt (NaCl) by weight. Multiply grams of salt by 393.4 to get mg of sodium."}},
      {"@type":"Question","name":"Is sea salt lower in sodium than table salt?",
        "acceptedAnswer":{"@type":"Answer","text":"No. By weight, sea salt and table salt have similar sodium content. Crystal size can change volume measures."}},
      {"@type":"Question","name":"What counts as ‘high’ sodium on a label?",
        "acceptedAnswer":{"@type":"Answer","text":"As a rule of thumb, 20% DV (≈460 mg) or more per serving is considered high. 5% DV (≈115 mg) or less is low."}},
      {"@type":"Question","name":"Does exercise increase my sodium needs?",
        "acceptedAnswer":{"@type":"Answer","text":"Heavy sweating can increase electrolyte losses. Follow sports-nutrition guidance or clinician advice—this tool focuses on general daily intake."}},
      {"@type":"Question","name":"How is % Daily Value calculated?",
        "acceptedAnswer":{"@type":"Answer","text":"%DV = total sodium ÷ 2300 mg × 100. Some regions use 2000 mg—adjust the DV base in the calculator if needed."}}
    ]
  }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-white border-b">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
      <div class="flex items-center justify-between">
        <a href="https://calcdomain.com" class="text-2xl font-extrabold text-blue-600">CalcDomain</a>
        <div class="hidden md:flex gap-6 text-sm">
          <a href="https://calcdomain.com/search" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
           <a href="https://calcdomain.com/#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
        </div>
        <button class="md:hidden p-2" aria-label="Open menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-gray-600 mb-3" aria-label="Breadcrumb">
          <a href="https://calcdomain.com" class="hover:text-blue-600">Home</a> &raquo;
          <a href="https://calcdomain.com/health-fitness" class="hover:text-blue-600">Health &amp; Fitness</a> &raquo;
          <a href="https://calcdomain.com/subcategories/health-fitness-diet-nutrition" class="hover:text-blue-600">Diet &amp; Nutrition</a> &raquo;
          <span class="text-gray-900">Sodium Calculator</span>
        </nav>

        <div id="print-section" class="bg-white p-6 rounded-lg shadow-sm">
          <h1 class="text-3xl font-extrabold mb-2">sodium calculator</h1>
          <p class="text-gray-700 mb-6">
            Quickly estimate your total daily sodium intake from foods and recipes, convert grams of salt (NaCl) to sodium (Na), and check your % Daily Value against widely used guideline limits. Designed for dietitians, athletes, and health-conscious individuals who want precise, label-ready numbers.
          </p>

          <!-- Calculator UI -->
          <section id="calculator-ui" aria-labelledby="calc-heading" class="space-y-6">
            <h2 id="calc-heading" class="sr-only">Calculator Inputs</h2>

            <!-- DV Base & Target -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="dvBase" class="block text-sm font-medium text-gray-800">Daily Value base (mg)*</label>
                <div class="flex items-center gap-2">
                  <input type="number" inputmode="numeric" id="dvBase" value="2300" min="1000" max="4000" step="50"
                         aria-required="true" aria-describedby="dvBase-help dvBase-err"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                  <button type="button" class="px-2 py-1 text-xs border rounded" aria-expanded="false" aria-controls="dvBase-help" id="dvBase-tip" title="About DV">
                    ?
                  </button>
                </div>
                <p id="dvBase-help" class="text-xs text-gray-600 mt-1 hidden">
                  Default is 2300 mg (common label DV). Some guidelines use 2000 mg. Adjust to your local standard or clinician advice.
                </p>
                <p id="dvBase-err" class="text-sm text-red-600 mt-1" aria-live="polite"></p>
              </div>
              <div>
                <label for="targetMg" class="block text-sm font-medium text-gray-800">Personal target (mg)</label>
                <input type="number" inputmode="numeric" id="targetMg" value="2000" min="0" step="50"
                       aria-describedby="target-help target-err"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                <p id="target-help" class="text-xs text-gray-600 mt-1">
                  Optional lower target (e.g., 2000 mg). Leave blank to compare only with DV base.
                </p>
                <p id="target-err" class="text-sm text-red-600 mt-1" aria-live="polite"></p>
              </div>
              <div>
                <label for="unitPref" class="block text-sm font-medium text-gray-800">Display units</label>
                <select id="unitPref" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                  <option value="mg" selected>mg (milligrams)</option>
                  <option value="g">g (grams)</option>
                </select>
              </div>
            </div>

            <!-- Food entries -->
            <div class="border rounded-lg p-4">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold text-gray-900">Food items</h3>
                <div class="flex gap-2">
                  <button id="addRow" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Add item</button>
                  <button id="clearRows" class="px-3 py-2 border rounded hover:bg-gray-100">Clear</button>
                </div>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full text-sm" aria-describedby="food-help">
                  <thead class="bg-gray-100 text-gray-700">
                    <tr>
                      <th class="text-left px-3 py-2">Food</th>
                      <th class="text-left px-3 py-2">Sodium / serving (mg)*</th>
                      <th class="text-left px-3 py-2">Servings*</th>
                      <th class="text-right px-3 py-2">Total (mg)</th>
                      <th class="px-3 py-2">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="foodBody"></tbody>
                </table>
              </div>
              <p id="food-help" class="text-xs text-gray-600 mt-2">
                Enter sodium from the nutrition label and the number of servings consumed. Required fields are marked *.
              </p>
            </div>

            <!-- Salt ↔ Sodium converter -->
            <div class="border rounded-lg p-4">
              <h3 class="font-semibold text-gray-900 mb-3">Salt ↔ Sodium converter</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label for="saltG" class="block text-sm font-medium text-gray-800">Salt (NaCl) in grams</label>
                  <div class="flex items-center gap-2">
                    <input type="number" id="saltG" inputmode="decimal" min="0" step="0.1"
                           aria-describedby="salt-help" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                    <button type="button" id="saltTipBtn" class="px-2 py-1 text-xs border rounded" aria-expanded="false" aria-controls="salt-help">?</button>
                  </div>
                  <p id="salt-help" class="text-xs text-gray-600 mt-1 hidden">
                    Sodium is 39.34% of salt by weight. 1 g salt ≈ 393.4 mg sodium.
                  </p>
                </div>
                <div>
                  <label for="sodiumMgConv" class="block text-sm font-medium text-gray-800">Sodium (Na) in mg</label>
                  <input type="number" id="sodiumMgConv" inputmode="decimal" min="0" step="1"
                         class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                         aria-describedby="conv-note">
                  <p id="conv-note" class="text-xs text-gray-600 mt-1">Change either field to convert.</p>
                </div>
                <div class="flex items-end">
                  <button id="applyConv" class="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Add to intake</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Results -->
          <section id="results" class="mt-6">
            <div id="results-box" class="bg-blue-50 border border-blue-100 rounded-lg p-4">
              <div class="flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="result-card">
                    <h4>Total sodium today</h4>
                    <p id="totalSodium">0 mg</p>
                  </div>
                  <div class="result-card">
                    <h4>Salt equivalent</h4>
                    <p id="saltEquiv">0.0 g</p>
                  </div>
                  <div class="result-card">
                    <h4>% Daily Value</h4>
                    <p id="percentDV">0%</p>
                  </div>
                  <div class="result-card">
                    <h4>Versus target</h4>
                    <p id="versusTarget">—</p>
                  </div>
                </div>
                <div class="w-full md:w-1/3" id="chartWrap">
                  <canvas id="dvChart" aria-label="Intake vs Daily Value"></canvas>
                </div>
              </div>
              <div class="mt-4">
                <div class="w-full bg-white border rounded h-4" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Percent Daily Value">
                  <div id="dvBar" class="h-4 rounded" style="width:0%; background:#2563eb;"></div>
                </div>
                <p id="advice" class="text-sm mt-2 text-gray-800"></p>
              </div>
            </div>
          </section>
        </div>

        <!-- Authoritative ecosystem -->
        <section class="bg-white p-6 rounded-lg shadow-sm mt-8 prose">
          <h2>Authoritative data source &amp; methodology</h2>
          <p>
            Primary reference thresholds commonly used on nutrition labels and public health guidance include:
          </p>
          <ul>
            <li><strong>Daily Value (DV) for sodium:</strong> 2,300&nbsp;mg (U.S. FDA labeling basis).</li>
            <li><strong>Population intake target:</strong> many guidelines advise ≈2,000&nbsp;mg/day (≈5&nbsp;g salt). Follow your clinician’s advice if different.</li>
          </ul>
          <p><em>Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.</em></p>

          <h2>The formula explained</h2>
          <div class="formula-box">
            <p><strong>Salt → Sodium</strong></p>
            <p>$$\\text{Na (mg)} = \\text{Salt (g)} \\times 1000 \\times \\frac{M_{Na}}{M_{NaCl}} \\approx \\text{Salt (g)}\\times 393.4$$
            where \(M_{Na}=22.99\\,g/mol\\) and \(M_{NaCl}=58.44\\,g/mol\\).</p>
            <p><strong>% Daily Value</strong></p>
            <p>$$\\%\\,DV = \\frac{\\text{Total Na (mg)}}{\\text{DV base (mg)}} \\times 100$$</p>
            <p><strong>Food total</strong></p>
            <p>$$\\text{Total Na (mg)} = \\sum_i (\\text{Na per serving}_i \\times \\text{servings}_i) + \\text{converted Na (mg)}$$</p>
          </div>

          <h2>Glossary of variables</h2>
          <table class="w-full text-sm">
            <thead>
              <tr><th class="text-left">Symbol / Field</th><th class="text-left">Meaning</th></tr>
            </thead>
            <tbody>
              <tr><td>Na (mg)</td><td>Total sodium in milligrams.</td></tr>
              <tr><td>Salt (g)</td><td>Sodium chloride grams. Na ≈ 39.34% of NaCl by mass.</td></tr>
              <tr><td>DV base (mg)</td><td>Daily Value baseline (default 2300&nbsp;mg).</td></tr>
              <tr><td>%DV</td><td>Percent of daily value: Na ÷ DV × 100.</td></tr>
              <tr><td>Sodium / serving</td><td>Label sodium per serving in mg.</td></tr>
              <tr><td>Servings</td><td>Number of servings consumed.</td></tr>
            </tbody>
          </table>

          <h2>How it works: a step-by-step example</h2>
          <h3>Example</h3>
          <p>Suppose you ate:</p>
          <ul>
            <li>Soup: 650&nbsp;mg per serving × 1.5 servings = 975&nbsp;mg</li>
            <li>Bread: 180&nbsp;mg per serving × 2 servings = 360&nbsp;mg</li>
            <li>Added salt: 2&nbsp;g salt → \(2 \\times 393.4 = 786.8\\) mg Na</li>
          </ul>
          <p>Total Na = 975 + 360 + 787 ≈ 2,122&nbsp;mg. With DV base = 2,300&nbsp;mg, %DV ≈ \(2,122/2,300 \\times 100 = 92.3\\%\\).</p>

          <h2>Frequently asked questions</h2>
          <details>
            <summary>Is Himalayan or sea salt lower in sodium?</summary>
            <p>By weight, sodium content is similar. Mineral differences don’t meaningfully reduce sodium load.</p>
          </details>
          <details>
            <summary>Should I use 2,000 or 2,300 mg as my limit?</summary>
            <p>Label DV is often 2,300 mg; many public health targets are ≈2,000 mg. Use what your clinician recommends.</p>
          </details>
          <details>
            <summary>How do I handle homemade recipes?</summary>
            <p>Sum sodium from each ingredient (using databases or labels) and divide by portions to get per-serving sodium.</p>
          </details>
          <details>
            <summary>Does potassium salt (KCl) count?</summary>
            <p>KCl provides potassium, not sodium. It may taste salty but does not add sodium; consult your clinician regarding potassium intake.</p>
          </details>
          <details>
            <summary>Any quick label heuristic?</summary>
            <p>≈5% DV (≤115 mg) per serving is low; ≥20% DV (≥460 mg) is high.</p>
          </details>

          <div class="mt-6 p-4 bg-gray-50 border rounded text-sm text-gray-700">
            <p><strong>Tool developed by Ugo Candido.</strong> Content verified by CalcDomain Editorial Board.<br>
              Last accuracy review: <time datetime="2025-10-29">October 29, 2025</time></p>
          </div>
        </section>
      </section>

      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div id="ad-slot" class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
            Ad Placement (300×600)
          </div>
          <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="font-bold text-lg mb-3">Why use this calculator</h3>
            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
              <li>Convert salt ↔ sodium with clinically correct stoichiometry.</li>
              <li>Sum sodium from multiple foods with required-field validation.</li>
              <li>See %DV and get clear guidance when you exceed limits.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-sm">
            <h3 class="font-bold text-lg mb-3">Related nutrition tools</h3>
            <ul class="text-sm space-y-2">
              <li><a class="text-blue-600 hover:underline" href="https://calcdomain.com/potassium-calculator">Potassium Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="https://calcdomain.com/sugar-calculator">Sugar Intake Calculator</a></li>
              <li><a class="text-blue-600 hover:underline" href="https://calcdomain.com/fiber-calculator">Fiber Calculator</a></li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 CalcDomain. All rights reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="https://calcdomain.com/about" class="hover:text-blue-600">About</a>
        <a href="https://calcdomain.com/contact" class="hover:text-blue-600">Contact</a>
        <a href="https://calcdomain.com/privacy" class="hover:text-blue-600">Privacy</a>
        <a href="https://calcdomain.com/terms" class="hover:text-blue-600">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator logic (defer via end-of-body placement) -->
  <script>
  (function(){
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const els = {
      dvBase: $('#dvBase'),
      targetMg: $('#targetMg'),
      unitPref: $('#unitPref'),
      dvBaseErr: $('#dvBase-err'),
      targetErr: $('#target-err'),
      dvBaseHelp: $('#dvBase-help'),
      dvBaseTip: $('#dvBase-tip'),
      saltG: $('#saltG'),
      sodiumMgConv: $('#sodiumMgConv'),
      saltTipBtn: $('#saltTipBtn'),
      saltHelp: $('#salt-help'),
      applyConv: $('#applyConv'),
      foodBody: $('#foodBody'),
      addRow: $('#addRow'),
      clearRows: $('#clearRows'),

      totalSodium: $('#totalSodium'),
      saltEquiv: $('#saltEquiv'),
      percentDV: $('#percentDV'),
      versusTarget: $('#versusTarget'),
      advice: $('#advice'),
      dvBar: $('#dvBar')
    };

    // Accessibility: toggle tooltips
    function toggleHelp(btn, panel){
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      panel.classList.toggle('hidden', expanded);
    }
    els.dvBaseTip.addEventListener('click', ()=>toggleHelp(els.dvBaseTip, els.dvBaseHelp));
    els.saltTipBtn.addEventListener('click', ()=>toggleHelp(els.saltTipBtn, els.saltHelp));

    // Constants
    const FRACTION_NA_IN_SALT = 22.99 / 58.44; // 0.3934
    const MG_PER_G = 1000;

    // State
    let convertedExtraMg = 0; // sodium added from converter
    let dvChart;

    // Validation helpers
    function setErr(el, errEl, msg){
      errEl.textContent = msg || '';
      el.setAttribute('aria-invalid', msg ? 'true' : 'false');
    }
    function onBlurNumber(el, errEl, {min=null, max=null, name='value'}){
      el.addEventListener('blur', ()=>{
        const v = el.value.trim()==='' ? NaN : Number(el.value);
        if (Number.isNaN(v)) { setErr(el, errEl, `Enter a valid number for ${name}.`); return; }
        if (min!==null && v<min) { setErr(el, errEl, `${name} must be ≥ ${min}.`); return; }
        if (max!==null && v>max) { setErr(el, errEl, `${name} must be ≤ ${max}.`); return; }
        setErr(el, errEl, '');
      });
    }
    onBlurNumber(els.dvBase, els.dvBaseErr, {min:1000, max:4000, name:'Daily Value base'});
    onBlurNumber(els.targetMg, els.targetErr, {min:0, max:4000, name:'Personal target'});

    // Food rows
    function newFoodRow(prefill={}){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="px-3 py-2">
          <input type="text" aria-label="Food name" class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500" value="${prefill.name||''}">
        </td>
        <td class="px-3 py-2">
          <div>
            <input type="number" inputmode="decimal" required aria-required="true"
              aria-describedby="food-err" class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500 food-mg"
              min="0" step="1" value="${typeof prefill.mg==='number'?prefill.mg:''}">
            <p class="text-sm text-red-600 mt-1 food-err" aria-live="polite"></p>
          </div>
        </td>
        <td class="px-3 py-2">
          <div>
            <input type="number" inputmode="decimal" required aria-required="true"
              aria-describedby="serv-err" class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500 food-serv"
              min="0" step="0.25" value="${typeof prefill.serv==='number'?prefill.serv:''}">
            <p class="text-sm text-red-600 mt-1 serv-err" aria-live="polite"></p>
          </div>
        </td>
        <td class="px-3 py-2 text-right">
          <span class="food-total">0</span> mg
        </td>
        <td class="px-3 py-2 text-center">
          <button type="button" class="px-2 py-1 border rounded hover:bg-gray-100 removeRow" aria-label="Remove item">Remove</button>
        </td>
      `;
      // inline validation on blur
      const mgEl = tr.querySelector('.food-mg');
      const mgErr = tr.querySelector('.food-err');
      const svEl = tr.querySelector('.food-serv');
      const svErr = tr.querySelector('.serv-err');
      onBlurNumber(mgEl, mgErr, {min:0, name:'Sodium per serving (mg)'});
      onBlurNumber(svEl, svErr, {min:0, name:'Servings'});

      // bind changes
      [mgEl, svEl].forEach(el=>el.addEventListener('input', recompute));
      tr.querySelector('.removeRow').addEventListener('click', ()=>{ tr.remove(); recompute(); });

      els.foodBody.appendChild(tr);
    }

    // Seed with two example rows for UX
    newFoodRow({name:'Soup (canned)', mg:650, serv:1});
    newFoodRow({name:'Bread slice', mg:180, serv:2});

    els.addRow.addEventListener('click', ()=>newFoodRow());
    els.clearRows.addEventListener('click', ()=>{
      els.foodBody.innerHTML='';
      convertedExtraMg = 0;
      recompute();
    });

    // Converter two-way
    function saltToSodiumMg(g){ return g * MG_PER_G * FRACTION_NA_IN_SALT; }
    function sodiumMgToSaltG(mg){ return mg / (MG_PER_G * FRACTION_NA_IN_SALT); }

    let lockConv = false;
    els.saltG.addEventListener('input', ()=>{
      if (lockConv) return;
      lockConv = true;
      const g = parseFloat(els.saltG.value);
      const mg = Number.isFinite(g) ? saltToSodiumMg(g) : 0;
      els.sodiumMgConv.value = mg ? Math.round(mg) : '';
      lockConv = false;
    });
    els.sodiumMgConv.addEventListener('input', ()=>{
      if (lockConv) return;
      lockConv = true;
      const mg = parseFloat(els.sodiumMgConv.value);
      const g = Number.isFinite(mg) ? sodiumMgToSaltG(mg) : 0;
      els.saltG.value = g ? (Math.round(g*10)/10).toString() : '';
      lockConv = false;
    });

    els.applyConv.addEventListener('click', ()=>{
      const mg = parseFloat(els.sodiumMgConv.value);
      if (!Number.isFinite(mg) || mg<0){ alert('Enter a non-negative sodium amount (mg) to add.'); return; }
      convertedExtraMg += mg;
      // Reset converter inputs
      els.saltG.value = '';
      els.sodiumMgConv.value = '';
      recompute();
    });

    [els.dvBase, els.targetMg, els.unitPref].forEach(el=>el.addEventListener('input', recompute));

    function sumFoodsMg(){
      let total = 0;
      $$('#foodBody tr').forEach(tr=>{
        const mg = parseFloat(tr.querySelector('.food-mg').value);
        const sv = parseFloat(tr.querySelector('.food-serv').value);
        const mgValid = Number.isFinite(mg) && mg>=0;
        const svValid = Number.isFinite(sv) && sv>=0;
        const subtotal = (mgValid && svValid) ? mg * sv : 0;
        tr.querySelector('.food-total').textContent = Math.round(subtotal);
        total += subtotal;
      });
      return total;
    }

    function fmt(valMg, unit){
      if (unit==='g') return (Math.round(valMg/10)/100).toFixed(2)+' g'; // mg→g
      return Math.round(valMg) + ' mg';
    }
    function fmtNumber(n){ return new Intl.NumberFormat().format(n); }

    function updateChart(intakeMg, dvMg){
      const ctx = $('#dvChart');
      if (!ctx) return;
      const a = Math.max(0, Math.min(intakeMg, dvMg));
      const b = Math.max(0, dvMg - a);
      const c = Math.max(0, intakeMg - dvMg); // overage

      const data = {
        labels: ['Within DV', 'Remaining DV', 'Over DV'],
        datasets: [{ data: [a, b, c],
          backgroundColor: ['#2563eb', '#93c5fd', '#f87171'] }]
      };
      const opts = { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}} };

      if (dvChart){ dvChart.data = data; dvChart.update(); }
      else { dvChart = new Chart(ctx, { type:'doughnut', data, options:opts }); }
    }

    function recompute(){
      const foodsMg = sumFoodsMg();
      const totalMg = foodsMg + convertedExtraMg;

      const dvMg = parseFloat(els.dvBase.value) || 2300;
      const unit = els.unitPref.value;
      const saltG = totalMg / (MG_PER_G * FRACTION_NA_IN_SALT);
      const percent = dvMg>0 ? (totalMg / dvMg * 100) : 0;

      els.totalSodium.textContent = fmt(totalMg, unit);
      els.saltEquiv.textContent = (Math.round(saltG*10)/10).toFixed(1) + ' g';
      els.percentDV.textContent = Math.round(percent) + '%';

      // vs target
      const target = parseFloat(els.targetMg.value);
      if (Number.isFinite(target) && target>0){
        const diff = totalMg - target;
        els.versusTarget.textContent = (diff<=0 ? 'Below' : 'Above') + ' by ' + fmt(Math.abs(diff), 'mg');
      } else {
        els.versusTarget.textContent = '—';
      }

      // Progress bar and advice
      const clamped = Math.max(0, Math.min(100, percent));
      els.dvBar.style.width = clamped + '%';
      const bar = els.dvBar;
      bar.style.background = percent<=100 ? '#2563eb' : '#f87171';
      els.dvBar.parentElement.setAttribute('aria-valuenow', Math.round(clamped));

      const advice = (()=>{
        if (totalMg===0) return 'Enter foods or convert salt to see your daily intake.';
        if (percent<=75) return 'Your intake is well within the selected daily value.';
        if (percent<=100) return 'Approaching the daily value—consider lower-sodium swaps if desired.';
        return 'Above the daily value—review high-sodium items or reduce added salt.';
      })();
      els.advice.textContent = advice;

      updateChart(totalMg, dvMg);

      // Unit toggle: also reflect per-row totals suffix (already in mg text); keep mg label for clarity
    }

    // Initial render
    recompute();

    // Keyboard support for details element (native), buttons already accessible
  })();
  </script>
</body>
</html>
