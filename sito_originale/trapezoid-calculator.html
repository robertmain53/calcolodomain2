<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/trapezoid-calculator">





  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trapezoid Calculator — Area, Height, Median, Perimeter & More</title>
  <meta name="description" content="Professional trapezoid calculator. Compute area, height, midline (median), perimeter, and angles. Multiple solve modes, accessible tooltips, inline validation, and an interactive diagram." />
  
  <meta name="author" content="Ugo Candido" />

  <!-- Icons / Manifest (optional placeholders that won’t 404 if absent) -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- MathJax for LaTeX rendering -->
  <script defer id="mathjax" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    integrity="sha256-0S8U4a2e7H2sR+qzM2Tj6qnlYcC7mM1VYtZK2r9/ZqA=" crossorigin="anonymous"></script>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Trapezoid Calculator",
    "inLanguage": "en",
    "url": "https://calcdomain.com/trapezoid-calculator",
    "description": "Compute area, height, midline (median), perimeter, angles, and more for a trapezoid. Multiple solve modes, inline validation, and an interactive diagram.",
    "author": { "@type": "Person", "name": "Ugo Candido" },
    "publisher": { "@type": "Organization", "name": "CalcDomain" },
    "mainEntity": {
      "@type": "WebApplication",
      "applicationCategory": "Calculator",
      "name": "Trapezoid Calculator",
      "operatingSystem": "Any",
      "url": "https://calcdomain.com/trapezoid-calculator",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
    }
  }
  </script>

  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Math & Conversions",
      "item": "https://calcdomain.com/math-conversions"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Geometry",
      "item": "https://calcdomain.com/subcategories/geometry"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Trapezoid Calculator",
      "item": "https://calcdomain.com/trapezoid-calculator"
    }
  ]
}</script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is the area formula for a trapezoid?","acceptedAnswer":{"@type":"Answer","text":"Area equals the average of the two parallel bases times the height: A = (a + b) / 2 · h."}},
      {"@type":"Question","name":"How do I find height from area and bases?","acceptedAnswer":{"@type":"Answer","text":"Rearrange A = (a + b) / 2 · h to h = 2A / (a + b)."}},
      {"@type":"Question","name":"Can I solve for an unknown base?","acceptedAnswer":{"@type":"Answer","text":"Yes. If A, h, and one base are known, the other base is a = 2A / h − b (or b = 2A / h − a)."}},
      {"@type":"Question","name":"How do I get perimeter?","acceptedAnswer":{"@type":"Answer","text":"Perimeter requires both non-parallel sides (legs). Provide c and d to compute P = a + b + c + d."}},
      {"@type":"Question","name":"Can I compute angles of a trapezoid?","acceptedAnswer":{"@type":"Answer","text":"If both legs are known, angles at the bases follow from right-triangle projections: x = (c^2 − d^2 + (a − b)^2) / (2|a − b|), then tan(α) = h/x, tan(β) = h/(|a − b| − x)."}}
    ]
  }
  </script>

  <style>
    /* Base typography and layout */
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; }
    .prose { max-width: 68ch; }
    .prose h2 { font-weight: 700; font-size: 1.5rem; margin-top: 1.75rem; margin-bottom: .75rem; }
    .prose h3 { font-weight: 700; font-size: 1.25rem; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p, .prose li { line-height: 1.65; }
    .formula-box { background:#f3f4f6; border:1px solid #d1d5db; border-radius:.75rem; padding:1rem; overflow:auto; }
    .result-card { background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; text-align:center; }
    .result-card h4 { font-size:.95rem; color:#4b5563; margin-bottom:.25rem; }
    .result-card p { font-size:1.5rem; font-weight:800; color:#1d4ed8; }
    /* Visible focus for a11y */
    :focus-visible { outline: 3px solid #1d4ed8; outline-offset: 2px; }
    /* Error text */
    .error-text { color:#b91c1c; font-size:.85rem; margin-top:.375rem; }
    /* Prevent CLS when results render */
    #results { min-height: 14rem; }
    /* Touch targets */
    label, input, select, button, summary { min-height: 48px; }
    /* Print */
    @media print { #diagram { display:none !important; } }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Simple non-sticky header -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 md:px-6 py-4 flex items-center justify-between">
      <a href="https://calcdomain.com" class="text-xl font-bold text-blue-700">CalcDomain</a>
      <nav class="text-sm">
        <a class="text-gray-700 hover:text-blue-700" href="https://calcdomain.com/search">Search</a>
        <span class="mx-2 text-gray-300">|</span>
        Categories
      </nav>
    </div>
  </header>

  <main class="container mx-auto px-4 md:px-6 py-8">
    <nav aria-label="Breadcrumb" class="text-sm text-gray-600 mb-4">
      <a href="https://calcdomain.com" class="hover:text-blue-700">Home</a> &raquo;
      <a href="https://calcdomain.com/math" class="hover:text-blue-700">Math</a> &raquo;
      <a href="https://calcdomain.com/subcategories/geometry" class="hover:text-blue-700">Geometry</a> &raquo;
      <span class="text-gray-900">Trapezoid Calculator</span>
    </nav>

    <section id="print-section" class="bg-white rounded-xl shadow-sm p-6">
      <h1 class="text-3xl font-extrabold mb-2">Trapezoid Calculator</h1>
      <p class="text-gray-700 mb-6">
        Compute <strong>area</strong>, <strong>height</strong>, <strong>midline (median)</strong>, <strong>perimeter</strong>, and <strong>angles</strong> of a trapezoid with accessible, professional-grade tooling. Ideal for students, engineers, and educators.
      </p>

      <!-- Calculator (Section 3 in spec) -->
      <section aria-labelledby="calc-title" class="space-y-6">
        <h2 id="calc-title" class="sr-only">Interactive calculator</h2>

        <!-- Solve Mode -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="mode" class="block text-sm font-medium text-gray-800">Solve Mode <span class="text-red-600" aria-hidden="true">*</span></label>
            <select id="mode" aria-required="true" class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600">
              <option value="area" selected>Area (given a, b, h)</option>
              <option value="height">Height (given A, a, b)</option>
              <option value="solveA">Base a (given A, b, h)</option>
              <option value="solveB">Base b (given A, a, h)</option>
            </select>
            <p id="modeHelp" class="text-xs text-gray-600 mt-1">Pick what you want to compute; fields update automatically.</p>
          </div>

          <!-- Units (purely cosmetic, values treated as numbers) -->
          <div>
            <label for="unit" class="block text-sm font-medium text-gray-800">Unit (label only)</label>
            <input id="unit" type="text" inputmode="text" placeholder="e.g., cm, m, in"
              class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
            <p class="text-xs text-gray-600 mt-1">Units are not converted; labels display on results.</p>
          </div>
        </div>

        <!-- Core inputs -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <div class="flex items-center justify-between">
              <label for="a" class="block text-sm font-medium text-gray-800">Base a (longer) <span class="text-red-600" aria-hidden="true">*</span></label>
              <button type="button" class="ml-2 text-blue-700 underline text-xs" aria-controls="aTip" aria-expanded="false">?</button>
            </div>
            <input id="a" name="a" type="number" step="any" min="0" aria-required="true" aria-describedby="aError aTip"
              class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
            <p id="aError" class="error-text" aria-live="polite"></p>
            <p id="aTip" class="text-xs text-gray-600 hidden">Parallel base typically drawn at the bottom; enter its length.</p>
          </div>

          <div>
            <div class="flex items-center justify-between">
              <label for="b" class="block text-sm font-medium text-gray-800">Base b (shorter) <span class="text-red-600" aria-hidden="true">*</span></label>
              <button type="button" class="ml-2 text-blue-700 underline text-xs" aria-controls="bTip" aria-expanded="false">?</button>
            </div>
            <input id="b" name="b" type="number" step="any" min="0" aria-required="true" aria-describedby="bError bTip"
              class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
            <p id="bError" class="error-text" aria-live="polite"></p>
            <p id="bTip" class="text-xs text-gray-600 hidden">The second parallel base, usually drawn on top; its length.</p>
          </div>

          <div data-field="h">
            <div class="flex items-center justify-between">
              <label for="h" class="block text-sm font-medium text-gray-800">Height h <span class="text-red-600" aria-hidden="true">*</span></label>
              <button type="button" class="ml-2 text-blue-700 underline text-xs" aria-controls="hTip" aria-expanded="false">?</button>
            </div>
            <input id="h" name="h" type="number" step="any" min="0" aria-required="true" aria-describedby="hError hTip"
              class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
            <p id="hError" class="error-text" aria-live="polite"></p>
            <p id="hTip" class="text-xs text-gray-600 hidden">Perpendicular distance between the parallel bases.</p>
          </div>

          <div data-field="A" class="hidden">
            <div class="flex items-center justify-between">
              <label for="A" class="block text-sm font-medium text-gray-800">Area A <span class="text-red-600" aria-hidden="true">*</span></label>
              <button type="button" class="ml-2 text-blue-700 underline text-xs" aria-controls="ATip" aria-expanded="false">?</button>
            </div>
            <input id="A" name="A" type="number" step="any" min="0" aria-required="true" aria-describedby="AError ATip"
              class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
            <p id="AError" class="error-text" aria-live="polite"></p>
            <p id="ATip" class="text-xs text-gray-600 hidden">Total area enclosed by the trapezoid.</p>
          </div>
        </div>

        <!-- Advanced (legs for perimeter and angles) -->
        <details class="rounded-lg border border-gray-200 bg-gray-50 p-4">
          <summary class="font-semibold cursor-pointer">Advanced: Legs (for perimeter & angles)</summary>
          <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label for="c" class="block text-sm font-medium text-gray-800">Leg c (left)</label>
              <input id="c" name="c" type="number" step="any" min="0" aria-describedby="cError"
                class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
              <p id="cError" class="error-text" aria-live="polite"></p>
            </div>
            <div>
              <label for="d" class="block text-sm font-medium text-gray-800">Leg d (right)</label>
              <input id="d" name="d" type="number" step="any" min="0" aria-describedby="dError"
                class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-600" />
              <p id="dError" class="error-text" aria-live="polite"></p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-800">Notes</label>
              <p class="text-xs text-gray-600 mt-2">If both legs are provided with bases, the tool can validate geometry and compute angles.</p>
            </div>
          </div>
        </details>

        <!-- Diagram -->
        <div id="diagram" class="mt-2">
          <svg viewBox="0 0 560 300" role="img" aria-label="Trapezoid diagram" class="w-full h-56 md:h-64 rounded-lg border border-gray-200 bg-white">
            <!-- Bases labels -->
            <defs>
              <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="#374151"></path>
              </marker>
            </defs>

            <!-- Trapezoid polygon -->
            <polygon id="poly" points="80,220 480,220 420,100 140,100" fill="#dbeafe" stroke="#1d4ed8" stroke-width="2"></polygon>

            <!-- Height line -->
            <line id="hLine" x1="140" y1="100" x2="140" y2="220" stroke="#ef4444" stroke-width="2"></line>

            <!-- Base labels -->
            <text id="aLbl" x="280" y="245" text-anchor="middle" font-size="12" fill="#1f2937">a</text>
            <text id="bLbl" x="280" y="90" text-anchor="middle" font-size="12" fill="#1f2937">b</text>
            <text id="hLbl" x="120" y="160" text-anchor="end" font-size="12" fill="#1f2937">h</text>

            <!-- Dimension arrows -->
            <line x1="80" y1="255" x2="480" y2="255" stroke="#374151" stroke-width="1.5" marker-start="url(#arrow)" marker-end="url(#arrow)"></line>
            <line x1="140" y1="70" x2="420" y2="70" stroke="#374151" stroke-width="1.5" marker-start="url(#arrow)" marker-end="url(#arrow)"></line>
            <line x1="100" y1="100" x2="100" y2="220" stroke="#374151" stroke-width="1.5" marker-start="url(#arrow)" marker-end="url(#arrow)"></line>
          </svg>
        </div>
      </section>

      <!-- Results (Section 4) -->
      <section id="results" class="mt-8 bg-blue-50 border border-blue-100 rounded-lg p-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="result-card"><h4>Area</h4><p id="resArea">—</p></div>
          <div class="result-card"><h4>Height</h4><p id="resHeight">—</p></div>
          <div class="result-card"><h4>Midline (Median)</h4><p id="resMedian">—</p></div>
          <div class="result-card"><h4>Perimeter</h4><p id="resPerim">—</p></div>
        </div>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="result-card"><h4>Base Angle (left)</h4><p id="resAngleL">—</p></div>
          <div class="result-card"><h4>Base Angle (right)</h4><p id="resAngleR">—</p></div>
        </div>

        <p id="notice" class="mt-4 text-sm text-gray-700"></p>
      </section>
    </section>

    <!-- Authoritative Content Ecosystem (Section 5) -->
    <article class="prose bg-white rounded-xl shadow-sm p-6 mt-8">
      <h2>Data Source & Methodology</h2>
      <p>
        Authoritative reference: <a class="text-blue-700 underline" href="https://mathworld.wolfram.com/Trapezoid.html" rel="nofollow">Wolfram MathWorld — “Trapezoid”</a>. Accessed October 25, 2025.
        <br><em>All calculations strictly follow the formulas provided by this source.</em>
      </p>

      <h2>The Formula Explained</h2>
      <div class="formula-box">
        \( A=\frac{a+b}{2}\cdot h \)\quad (area)
        <br />\( m=\frac{a+b}{2} \)\quad (midline / median)
        <br />\( h=\frac{2A}{a+b} \)\quad (height, when \(A\) and bases are known)
        <br />\( a = \frac{2A}{h}-b,\;\; b = \frac{2A}{h}-a \)\quad (unknown base)
        <br />If legs \(c,d\) are known with base difference \(\Delta = |a-b|\):
        <br />\( x=\dfrac{c^2-d^2+\Delta^2}{2\Delta},\;\; h=\sqrt{c^2-x^2} \)
        <br />Base angles: \( \alpha=\arctan\!\left(\dfrac{h}{x}\right),\;\; \beta=\arctan\!\left(\dfrac{h}{\Delta-x}\right) \)
      </div>

      <h2>Glossary of Variables</h2>
      <ul>
        <li><strong>a</strong> — longer parallel base (length)</li>
        <li><strong>b</strong> — shorter parallel base (length)</li>
        <li><strong>h</strong> — height (perpendicular distance between bases)</li>
        <li><strong>A</strong> — area</li>
        <li><strong>m</strong> — midline (median) = (a + b) / 2</li>
        <li><strong>c, d</strong> — legs (non-parallel sides), needed to compute perimeter and angles</li>
        <li><strong>Δ</strong> — base difference = |a − b|</li>
        <li><strong>α, β</strong> — base angles at the left and right vertices (radians or degrees)</li>
      </ul>

      <h2>How It Works: A Step-by-Step Example</h2>
      <p><strong>Goal:</strong> Find the area and median for a trapezoid with a = 12, b = 7, h = 5 (units arbitrary).</p>
      <ol>
        <li>Compute median: \( m = (12 + 7)/2 = 9.5 \).</li>
        <li>Compute area: \( A = m \cdot h = 9.5 \cdot 5 = 47.5 \).</li>
        <li>If legs are also known (e.g., c = 6.4, d = 8.1), validate geometry and compute angles as in the formulas above.</li>
      </ol>

      <h2>Frequently Asked Questions (FAQ)</h2>
      <details>
        <summary>Is there a difference between trapezoid and trapezium?</summary>
        <p>In U.S. English, “trapezoid” has exactly one pair of parallel sides. In some other varieties of English, “trapezium” is used for the same shape. This tool uses the U.S. convention.</p>
      </details>
      <details>
        <summary>Can the legs be determined from bases and height alone?</summary>
        <p>Not uniquely. You also need the horizontal offset between bases (or one leg) to resolve the other leg. Otherwise, multiple trapezoids share the same a, b, h.</p>
      </details>
      <details>
        <summary>Why is perimeter optional?</summary>
        <p>Perimeter requires both legs c and d. Without them, only a + b is known.</p>
      </details>
      <details>
        <summary>What units does the calculator use?</summary>
        <p>You can enter any unit (e.g., cm, in, m). Results display with the same unit label you provide; the calculator does not convert units.</p>
      </details>
      <details>
        <summary>Are angles returned in degrees or radians?</summary>
        <p>Degrees, for readability.</p>
      </details>
      <details>
        <summary>Does the drawing reflect my inputs?</summary>
        <p>Yes. The diagram updates proportionally to your inputs to aid intuition (not to exact scale for large numbers).</p>
      </details>

      <div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
        <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.<br>
        Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
      </div>
    </article>
  </main>

  <footer class="bg-white border-t mt-10">
    <div class="container mx-auto px-4 md:px-6 py-8 text-center text-gray-700 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-3 space-x-4">
        <a href="https://calcdomain.com/about" class="hover:text-blue-700">About</a>
        <a href="https://calcdomain.com/contact" class="hover:text-blue-700">Contact</a>
        <a href="https://calcdomain.com/privacy" class="hover:text-blue-700">Privacy</a>
        <a href="https://calcdomain.com/terms" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer) -->
  <script defer>
  (function() {
    const $ = (id) => document.getElementById(id);

    const els = {
      mode: $('mode'),
      unit: $('unit'),
      a: $('a'), b: $('b'), h: $('h'), A: $('A'),
      c: $('c'), d: $('d'),
      aErr: $('aError'), bErr: $('bError'), hErr: $('hError'), AErr: $('AError'), cErr: $('cError'), dErr: $('dError'),
      resArea: $('resArea'), resHeight: $('resHeight'), resMedian: $('resMedian'),
      resPerim: $('resPerim'), resAngleL: $('resAngleL'), resAngleR: $('resAngleR'),
      notice: $('notice')
    };

    const fieldBlocks = {
      h: document.querySelector('[data-field="h"]'),
      A: document.querySelector('[data-field="A"]')
    };

    // Accessible tooltip toggles
    document.querySelectorAll('button[aria-controls]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('aria-controls');
        const tip = document.getElementById(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        tip.classList.toggle('hidden', expanded);
      });
    });

    // Helpers
    const num = (el) => {
      const v = parseFloat(el.value);
      return Number.isFinite(v) ? v : NaN;
    };
    const isPos = (x) => Number.isFinite(x) && x > 0;
    const isNonNeg = (x) => Number.isFinite(x) && x >= 0;
    const deg = (rad) => rad * (180 / Math.PI);
    const fmt = (v, unitLabel = '', decimals = 6) => {
      if (!Number.isFinite(v)) return '—';
      const s = (Math.abs(v) >= 1000) ? v.toLocaleString(undefined, { maximumFractionDigits: 4 }) : v.toFixed(4);
      return unitLabel ? `${s} ${unitLabel}` : s;
    };
    const fmtArea = (v, unit) => Number.isFinite(v) ? `${v.toFixed(4)} ${unit ? unit + '²' : ''}` : '—';

    // Mode switching: show/hide A or h
    function applyModeUI() {
      const mode = els.mode.value;
      if (mode === 'area') {
        fieldBlocks.h.classList.remove('hidden');
        fieldBlocks.A.classList.add('hidden');
        els.h.setAttribute('aria-required', 'true');
        els.A.removeAttribute('aria-required');
      } else if (mode === 'height') {
        fieldBlocks.h.classList.add('hidden');
        fieldBlocks.A.classList.remove('hidden');
        els.A.setAttribute('aria-required', 'true');
        els.h.removeAttribute('aria-required');
      } else {
        // solveA or solveB: need A and h, the opposite base + unknown base
        fieldBlocks.h.classList.remove('hidden');
        fieldBlocks.A.classList.remove('hidden');
        els.h.setAttribute('aria-required', 'true');
        els.A.setAttribute('aria-required', 'true');
      }
      clearErrors();
      compute();
    }

    function clearErrors() {
      [els.aErr, els.bErr, els.hErr, els.AErr, els.cErr, els.dErr].forEach(e => e.textContent = '');
      els.notice.textContent = '';
    }

    // Validation (on blur)
    function validate(el, errEl, name, mustBePositive = true) {
      const v = num(el);
      if (el.hasAttribute('aria-required') && !(mustBePositive ? isPos(v) : isNonNeg(v))) {
        errEl.textContent = `${name} must be a ${mustBePositive ? 'positive' : 'non-negative'} number.`;
        return false;
      }
      errEl.textContent = '';
      return true;
    }

    ['a','b','h','A','c','d'].forEach(id => {
      const el = els[id];
      const errEl = els[id + 'Err'];
      if (!el) return;
      el.addEventListener('blur', () => {
        const mustBePositive = ['A'].includes(id) ? true : true;
        validate(el, errEl, id.toUpperCase(), mustBePositive);
      });
      el.addEventListener('input', compute);
    });
    els.mode.addEventListener('change', applyModeUI);
    els.unit.addEventListener('input', compute);

    function compute() {
      clearErrors();
      const mode = els.mode.value;
      let a = num(els.a), b = num(els.b), h = num(els.h), A = num(els.A);
      const unit = (els.unit.value || '').trim();

      // Required validations by mode
      const reqOK = (() => {
        if (mode === 'area') {
          return validate(els.a, els.aErr, 'a') &
                 validate(els.b, els.bErr, 'b') &
                 validate(els.h, els.hErr, 'h');
        }
        if (mode === 'height') {
          return validate(els.a, els.aErr, 'a') &
                 validate(els.b, els.bErr, 'b') &
                 validate(els.A, els.AErr, 'A');
        }
        if (mode === 'solveA') {
          return validate(els.b, els.bErr, 'b') &
                 validate(els.h, els.hErr, 'h') &
                 validate(els.A, els.AErr, 'A');
        }
        if (mode === 'solveB') {
          return validate(els.a, els.aErr, 'a') &
                 validate(els.h, els.hErr, 'h') &
                 validate(els.A, els.AErr, 'A');
        }
        return true;
      })();
      if (!reqOK) return;

      // Solve according to mode
      const sumBases = (x, y) => (Number.isFinite(x) && Number.isFinite(y)) ? (x + y) : NaN;

      if (mode === 'area') {
        A = ((a + b) / 2) * h;
      } else if (mode === 'height') {
        const denom = a + b;
        if (denom <= 0) { els.hErr.textContent = 'a + b must be positive.'; h = NaN; }
        else h = (2 * A) / denom;
      } else if (mode === 'solveA') {
        a = (2 * A) / h - b;
        if (!(a > 0)) els.aErr.textContent = 'Computed a must be positive; check inputs.';
      } else if (mode === 'solveB') {
        b = (2 * A) / h - a;
        if (!(b > 0)) els.bErr.textContent = 'Computed b must be positive; check inputs.';
      }

      // Median
      const m = (a + b) / 2;

      // Optional: legs for perimeter & angles
      const c = num(els.c), d = num(els.d);
      let perim = NaN, alpha = NaN, beta = NaN;

      // Perimeter only if legs both provided
      if (isPos(c) && isPos(d)) {
        perim = a + b + c + d;
      }

      // Angles (if legs both provided and Δ>0)
      const Delta = Math.abs(a - b);
      if (isPos(c) && isPos(d) && Delta > 0) {
        // projection x on the longer base: x = (c^2 - d^2 + Δ^2) / (2Δ)
        const x = (c*c - d*d + Delta*Delta) / (2 * Delta);
        // geometric feasibility checks
        if (x >= 0 && x <= Delta) {
          const h2 = c*c - x*x;
          if (h2 > 0) {
            // If h is not set by mode, prefer geometry-computed h
            const hGeom = Math.sqrt(h2);
            if (!isPos(h)) h = hGeom; // fill-in if missing/nonpositive
            alpha = deg(Math.atan(hGeom / x));
            beta  = deg(Math.atan(hGeom / (Delta - x)));
          } else {
            els.notice.textContent = 'Provided legs are inconsistent with bases: cannot form a valid height.';
          }
        } else {
          els.notice.textContent = 'Provided legs are inconsistent with bases (projection out of range).';
        }
      }

      // Update results
      els.resArea.textContent = fmtArea(A, unit);
      els.resHeight.textContent = fmt(h, unit);
      els.resMedian.textContent = fmt(m, unit);
      els.resPerim.textContent = Number.isFinite(perim) ? fmt(perim, unit) : '—';
      els.resAngleL.textContent = Number.isFinite(alpha) ? `${alpha.toFixed(2)}°` : '—';
      els.resAngleR.textContent = Number.isFinite(beta) ? `${beta.toFixed(2)}°` : '—';

      // Update diagram
      updateDiagram(a, b, h);
    }

    // Diagram scaling
    function updateDiagram(a, b, h) {
      const W = 560, H = 300;
      if (!(isPos(a) && isPos(b) && isPos(h))) return;

      // Normalize to fit viewport
      const maxBase = Math.max(a, b);
      const scaleX = (W * 0.7) / maxBase;
      const scaleY = (H * 0.5) / h;
      const s = Math.min(scaleX, scaleY);

      const A = a * s, B = b * s, HH = h * s;

      const leftMargin = (W - A) / 2;
      const bottomY = H * 0.75;
      const topY = bottomY - HH;

      // Offset for top base: center it horizontally relative to bottom base
      const Delta = Math.abs(a - b) * s;
      const offset = (A >= B) ? (leftMargin + (A - B) / 2) : (leftMargin - (B - A) / 2);

      const x1 = leftMargin, x2 = leftMargin + A;
      const x3 = offset + B,  x4 = offset;

      const poly = $('poly');
      poly.setAttribute('points', `${x1},${bottomY} ${x2},${bottomY} ${x3},${topY} ${x4},${topY}`);

      // Height line from top-left vertical
      const hX = x4, hY1 = topY, hY2 = bottomY;
      $('hLine').setAttribute('x1', hX);
      $('hLine').setAttribute('x2', hX);
      $('hLine').setAttribute('y1', hY1);
      $('hLine').setAttribute('y2', hY2);

      // Labels
      $('aLbl').setAttribute('x', (x1 + x2) / 2);
      $('aLbl').setAttribute('y', bottomY + 25);
      $('bLbl').setAttribute('x', (x4 + x3) / 2);
      $('bLbl').setAttribute('y', topY - 10);
      $('hLbl').setAttribute('x', hX - 20);
      $('hLbl').setAttribute('y', (topY + bottomY) / 2);
    }

    // Init with sensible defaults
    els.a.value = 12;
    els.b.value = 7;
    els.h.value = 5;
    els.A.value = 0;
    els.c.value = '';
    els.d.value = '';
    applyModeUI();
  })();
  </script>
</body>
</html>
