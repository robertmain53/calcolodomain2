<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Loan Calculator - Calculate Payment & Interest</title>
    <meta name="description" content="Calculate your simple interest loan payments, total interest, and payoff schedule. Enter loan amount, APR, and term to get instant results with payment breakdown.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .prose { max-width: 65ch; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        .prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .prose .formula-box { 
            background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem; 
            overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; 
        }
        details > summary { cursor: pointer; font-weight: 600; }
        details[open] > summary { margin-bottom: 0.5rem; }
        /* Print-specific styles for clean output */
        @media print {
            body * {
                visibility: hidden;
            }
            #print-section, #print-section * {
                visibility: visible;
            }
            #print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            #results-chart-container {
                display: none; /* Hide chart in print view for clarity */
            }
        }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Calculate Simple Interest Loan Payments",
      "description": "A step-by-step guide to calculating simple interest loan payments and total costs.",
      "step": [
        {"@type": "HowToStep", "name": "Enter Loan Details", "text": "Input your loan amount, annual interest rate (APR), and loan term."},
        {"@type": "HowToStep", "name": "Choose Payment Frequency", "text": "Select how often you'll make payments (monthly, biweekly, or weekly)."},
        {"@type": "HowToStep", "name": "Calculate Interest", "text": "The calculator uses I = P × r × t to determine total simple interest."},
        {"@type": "HowToStep", "name": "Review Results", "text": "See your payment amount, total interest, total cost, and payment schedule."}
      ]
    }
    </script>
    <script src="search.js" defer></script>
    <style>
        /* CalcDomain Search Styles */
        .search-highlight {
            background: linear-gradient(120deg, #fbbf24 0%, #f59e0b 100%);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
            color: #78350f;
        }
        
        #search-results {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-height: 400px;
            overflow-y: auto;
        }
        
        #search-results a {
            display: block;
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        #search-results a:last-child {
            border-bottom: none;
        }
        
        #search-results a:hover {
            background-color: #f8fafc;
            transform: translateX(4px);
        }
        
        #search-results a:focus {
            background-color: #eff6ff;
            outline: 2px solid #3b82f6;
            outline-offset: -2px;
        }
        
        #search-results h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }
        
        #search-results p {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #6b7280;
            line-height: 1.4;
        }
        
        #search-results .bg-blue-100 {
            background-color: #dbeafe !important;
            color: #1e40af !important;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        input[type="search"]:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        @media (max-width: 768px) {
            #search-results {
                max-height: 300px;
                margin-top: 8px;
                border-radius: 8px;
            }
            
            #search-results a {
                padding: 12px;
            }
            
            #search-results h3 {
                font-size: 15px;
            }
            
            #search-results p {
                font-size: 13px;
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #search-results.show {
            animation: fadeInUp 0.3s ease-out;
        }
        
        #search-results::-webkit-scrollbar {
            width: 6px;
        }
        
        #search-results::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        #search-results::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        #search-results::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
            </style>
<!-- MathJax for LaTeX formulas -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\(','\)'], ['$', '$']],
      displayMath: [['\[','\]']]
    },
    svg: { fontCache: 'global' }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link rel="preload" href="/assets/js/mobile-menu.js" as="script">
<link rel="preload" href="/assets/js/page-enhancements.js" as="script">

</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="container mx-auto px-4 lg:px-6 py-4">
        <!-- TOP ROW -->
        <div class="flex justify-between items-center">
            <!-- LOGO -->
            <a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>
            
            <!-- DESKTOP SEARCH -->
            <div class="w-full max-w-md hidden md:block mx-8">
                <div class="relative">
                    <input 
                        type="search" 
                        id="search-input"
                        placeholder="Search for a calculator..." 
                        class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        autocomplete="off"
                    >
                    <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <!-- CONTAINER RISULTATI RICERCA -->
                    <div id="search-results" class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-lg mt-2 max-h-96 overflow-y-auto z-50 hidden border border-gray-200"></div>
                </div>
            </div>
            
            <!-- NAVIGATION LINKS -->
            <div class="hidden md:flex items-center space-x-6">
                <a href="search.html" class="text-gray-700 hover:text-blue-600 transition-colors">Advanced Search</a>
                <a href="index.html#categories" class="text-gray-700 hover:text-blue-600 transition-colors">Categories</a>
            </div>
            
            <!-- MOBILE TOGGLE -->
            <button id="mobile-menu-toggle" class="md:hidden p-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        
        <!-- MOBILE MENU -->
        <div id="mobile-menu" class="md:hidden mt-4 hidden">
            <div class="mb-4">
                <div class="relative">
                    <input 
                        type="search" 
                        id="mobile-search-input"
                        placeholder="Search calculators..." 
                        class="w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                    <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
            <div class="space-y-2">
                <a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
                <a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
            </div>
        </div>
    </nav>
</header>

    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">

            <main class="w-full lg:w-2/3">
                <nav class="text-sm mb-4 text-gray-600">
                    <a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
                    <a href="finance.html" class="hover:text-blue-600">Finance</a> &raquo;
                    <a href="https://calcdomain.com/subcategories/loans-debt.html" class="hover:text-blue-600">Loans and Debts</a> &raquo;
                    <span>Simple Loan Calculator</span>
                </nav>

                <div id="print-section" class="bg-white p-6 rounded-lg shadow-md">
                    <h1 class="text-3xl font-bold mb-2">Advanced Loan Calculator</h1>
                    <p class="text-gray-600 mb-6">Calculate payments for simple or standard (amortizing) loans. See how extra payments can save you money and shorten your loan term.</p>

                    <div id="calculator-ui" class="space-y-6">
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Interest Type</label>
                            <div class="mt-2 grid grid-cols-2 gap-2 rounded-md bg-gray-100 p-1">
                                <button id="interestTypeSimple" type="button" class="px-3 py-2 text-sm font-medium rounded-md text-gray-500">Simple Interest</button>
                                <button id="interestTypeAmortizing" type="button" class="px-3 py-2 text-sm font-medium rounded-md bg-white text-blue-600 shadow-sm">Standard (Amortizing)</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="currency" class="block text-sm font-medium text-gray-700">Currency</label>
                                <select id="currency" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="USD" selected>USD — $</option>
                                    <option value="EUR">EUR — €</option>
                                    <option value="GBP">GBP — £</option>
                                    <option value="AUD">AUD — $</option>
                                    <option value="CAD">CAD — $</option>
                                </select>
                            </div>
                            <div>
                                <label for="principal" class="block text-sm font-medium text-gray-700">Loan Amount <span class="text-red-500">*</span></label>
                                <div class="mt-1 relative">
                                    <input type="number" id="principal" value="10000" step="0.01" class="block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="10000">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" id="currencySymbol">$</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="rate" class="block text-sm font-medium text-gray-700">Annual Interest Rate (APR) <span class="text-red-500">*</span></label>
                                <div class="mt-1 relative">
                                    <input type="number" id="rate" value="8" step="0.01" class="block w-full pr-8 pl-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="8">
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">%</span>
                                </div>
                            </div>
                            <div>
                                <label for="termValue" class="block text-sm font-medium text-gray-700">Loan Term <span class="text-red-500">*</span></label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="number" id="termValue" value="36" class="flex-1 block w-full rounded-none rounded-l-md px-3 py-2 border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="36">
                                    <select id="termUnit" class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500">
                                        <option value="months" selected>Months</option>
                                        <option value="years">Years</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="frequency" class="block text-sm font-medium text-gray-700">Payment Frequency <span class="text-red-500">*</span></label>
                                <select id="frequency" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="12" selected>Monthly (12/year)</option>
                                    <option value="26">Biweekly (26/year)</option>
                                    <option value="52">Weekly (52/year)</option>
                                </select>
                            </div>
                            <div>
                                <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
                                <input type="date" id="startDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <div id="extraPaymentsSection" class="border-t pt-6 space-y-4">
                            <h3 class="text-base font-medium text-gray-800">Extra Payments (Optional)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="extraPayment" class="block text-sm font-medium text-gray-700">Extra Recurring Payment</label>
                                    <div class="mt-1 relative">
                                        <input type="number" id="extraPayment" step="0.01" class="block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="100">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" id="currencySymbolExtra">$</span>
                                    </div>
                                    <p class="mt-1 text-xs text-gray-500">Added to each scheduled payment.</p>
                                </div>
                                <div>
                                    <label for="lumpSumPayment" class="block text-sm font-medium text-gray-700">One-Time Payment</label>
                                    <div class="mt-1 relative">
                                        <input type="number" id="lumpSumPayment" step="0.01" class="block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="1000">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" id="currencySymbolLump">$</span>
                                    </div>
                                    <p class="mt-1 text-xs text-gray-500">Applied on the first payment date.</p>
                                </div>
                            </div>
                            <p id="extraPaymentNote" class="text-xs text-orange-600 hidden">Extra payments are most effective with Standard (Amortizing) loans.</p>
                        </div>
                    </div>

                    <div id="results" class="mt-8 bg-blue-50 p-6 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Loan Summary:</h3>
                            <div class="flex gap-2">
                                <button id="shareButton" title="Copy Share Link" class="p-2 rounded-md hover:bg-blue-200 text-blue-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" /></svg>
                                </button>
                                <button id="printButton" title="Print Results" class="p-2 rounded-md hover:bg-blue-200 text-blue-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v3h6v-3z" clip-rule="evenodd" /></svg>
                                </button>
                                <span id="shareFeedback" class="text-sm text-green-600 hidden">Copied!</span>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6">
                             <div class="flex-grow grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="text-center bg-white p-3 rounded-md">
                                    <p class="text-sm text-gray-600">Scheduled Payment</p>
                                    <p class="text-2xl font-bold text-blue-600" id="rPayment">$0.00</p>
                                    <p class="text-xs text-gray-500" id="rPaymentsCount">0 payments</p>
                                </div>
                                <div class="text-center bg-white p-3 rounded-md">
                                    <p class="text-sm text-gray-600">Total Interest</p>
                                    <p class="text-2xl font-bold text-orange-600" id="rInterest">$0.00</p>
                                    <p class="text-xs text-gray-500" id="interestSavedText"> </p>
                                </div>
                                <div class="text-center bg-white p-3 rounded-md">
                                    <p class="text-sm text-gray-600">Total to Repay</p>
                                    <p class="text-2xl font-bold text-gray-700" id="rTotal">$0.00</p>
                                    <p class="text-xs text-gray-500">Principal + Interest</p>
                                </div>
                                <div class="text-center bg-white p-3 rounded-md">
                                    <p class="text-sm text-gray-600">Payoff Date</p>
                                    <p class="text-2xl font-bold text-green-600" id="rPayoff">—</p>
                                    <p class="text-xs text-gray-500" id="timeSavedText"> </p>
                                </div>
                            </div>
                            <div id="results-chart-container" class="flex-shrink-0 w-full md:w-52 h-52 flex items-center justify-center">
                                <canvas id="resultsChart"></canvas>
                            </div>
                        </div>

                        <p class="mt-4 text-xs text-center text-gray-500" id="resNote">Enter loan details to see your payment breakdown.</p>
                        
                        <div class="mt-6">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="text-sm font-semibold text-gray-700">Payment Schedule (Preview)</h4>
                                <button id="toggleSchedule" class="text-sm text-blue-600 hover:text-blue-800">Show Full Schedule</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="bg-gray-100">
                                            <th class="px-3 py-2 text-left">#</th>
                                            <th class="px-3 py-2 text-left">Date</th>
                                            <th class="px-3 py-2 text-right">Payment</th>
                                            <th class="px-3 py-2 text-right">Principal</th>
                                            <th class="px-3 py-2 text-right">Interest</th>
                                            <th class="px-3 py-2 text-right">Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="scheduleBody">
                                        <tr><td colspan="6" class="px-3 py-4 text-center text-gray-500">Enter loan details to generate schedule</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
                    <h2>How Simple Interest Loans Work</h2>
                    <p>A simple interest loan calculates interest only on the principal amount using the formula I = P × r × t. Unlike compound interest loans, the interest doesn't compound over time, making these loans easier to understand and often more affordable for borrowers.</p>
                    
                    <h2>The Simple Interest Formula</h2>
                    <div class="formula-box">
                        <p><strong>Simple Interest:</strong> I = P × r × t</p>
                    </div>

                    <h2>How Amortizing Loans Work</h2>
                    <p>Most consumer loans (like mortgages and auto loans) are amortizing. This means each payment consists of two parts: a portion that pays down the principal and a portion that covers the interest. Interest is calculated on the outstanding balance, so as you pay down the principal, the amount of interest you pay with each period decreases.</p>

                    <div class="text-center my-6 bg-gray-200 py-10">
                        <p class="text-gray-500">In-Content Ad Unit</p>
                    </div>
                    
                    <h2>Frequently Asked Questions</h2>
                    <details class="border-b py-2">
                        <summary>What's the difference between simple and amortizing interest?</summary>
                        <p class="mt-2 text-gray-700">Simple interest is calculated once on the original principal for the entire loan term. Amortizing interest is calculated periodically (usually monthly) on the remaining loan balance. This means with an amortizing loan, you can save significant interest by paying it off early.</p>
                    </details>
                </article>
            </main>

            <aside class="w-full lg:w-1/3">
                <div class="sticky top-24">
                    <div class="bg-gray-200 h-96 rounded-lg mb-6 flex items-center justify-center">
                        <p class="text-gray-500">Sticky Ad Unit (e.g., 300x600)</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-4">Related Financial Tools</h3>
                        <ul class="space-y-3">
                            <li><a href="#" class="text-blue-600 hover:underline">Compound Interest Calculator</a></li>
                            <li><a href="#" class="text-blue-600 hover:underline">Mortgage Calculator</a></li>
                            <li><a href="#" class="text-blue-600 hover:underline">Loan Comparison Calculator</a></li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    
    <footer class="bg-white border-t mt-12">
        <div class="container mx-auto px-6 py-8 text-center text-gray-600">
            <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // ########## DOM ELEMENTS ##########
        const elements = {
            // Inputs
            currency: document.getElementById('currency'),
            currencySymbol: document.getElementById('currencySymbol'),
            currencySymbolExtra: document.getElementById('currencySymbolExtra'),
            currencySymbolLump: document.getElementById('currencySymbolLump'),
            principal: document.getElementById('principal'),
            rate: document.getElementById('rate'),
            termValue: document.getElementById('termValue'),
            termUnit: document.getElementById('termUnit'),
            frequency: document.getElementById('frequency'),
            startDate: document.getElementById('startDate'),
            extraPayment: document.getElementById('extraPayment'),
            lumpSumPayment: document.getElementById('lumpSumPayment'),
            // Interest Type Toggle
            interestTypeSimple: document.getElementById('interestTypeSimple'),
            interestTypeAmortizing: document.getElementById('interestTypeAmortizing'),
            extraPaymentsSection: document.getElementById('extraPaymentsSection'),
            extraPaymentNote: document.getElementById('extraPaymentNote'),
            // Results
            rPayment: document.getElementById('rPayment'),
            rPaymentsCount: document.getElementById('rPaymentsCount'),
            rInterest: document.getElementById('rInterest'),
            rTotal: document.getElementById('rTotal'),
            rPayoff: document.getElementById('rPayoff'),
            resNote: document.getElementById('resNote'),
            interestSavedText: document.getElementById('interestSavedText'),
            timeSavedText: document.getElementById('timeSavedText'),
            // Schedule
            scheduleBody: document.getElementById('scheduleBody'),
            toggleSchedule: document.getElementById('toggleSchedule'),
            // Actions
            shareButton: document.getElementById('shareButton'),
            printButton: document.getElementById('printButton'),
            shareFeedback: document.getElementById('shareFeedback'),
            // Chart
            resultsChart: document.getElementById('resultsChart').getContext('2d'),
        };

        // ########## STATE & CONFIG ##########
        const currencyMap = {
            USD: {symbol:'$', code:'USD', locale:'en-US'},
            EUR: {symbol:'€', code:'EUR', locale:'en-IE'},
            GBP: {symbol:'£', code:'GBP', locale:'en-GB'},
            AUD: {symbol:'$', code:'AUD', locale:'en-AU'},
            CAD: {symbol:'$', code:'CAD', locale:'en-CA'}
        };
        let currentCurrency = currencyMap.USD;
        let showFullSchedule = false;
        let interestType = 'amortizing'; // 'simple' or 'amortizing'
        let chartInstance = null;
        let fullSchedule = [];

        // ########## HELPER FUNCTIONS ##########
        const formatMoney = (amount) => new Intl.NumberFormat(currentCurrency.locale, { style: 'currency', currency: currentCurrency.code }).format(amount);
        const formatDate = (date) => new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'short', day: '2-digit' }).format(date);
        
        const addPeriod = (date, frequency) => {
            const newDate = new Date(date.getTime());
            if (frequency === 12) newDate.setMonth(newDate.getMonth() + 1);
            else if (frequency === 26) newDate.setDate(newDate.getDate() + 14);
            else newDate.setDate(newDate.getDate() + 7);
            return newDate;
        };
        
        // ########## CALCULATION LOGIC ##########
        function calculate() {
            // Get inputs
            const P = parseFloat(elements.principal.value) || 0;
            const annualRate = parseFloat(elements.rate.value) || 0;
            const termVal = parseInt(elements.termValue.value) || 0;
            const termUnit = elements.termUnit.value;
            const frequency = parseInt(elements.frequency.value) || 12;
            const startDate = elements.startDate.valueAsDate || new Date();
            const extraPayment = parseFloat(elements.extraPayment.value) || 0;
            const lumpSum = parseFloat(elements.lumpSumPayment.value) || 0;

            if (P <= 0 || annualRate < 0 || termVal <= 0) {
                resetResults();
                return;
            }

            // Calculate based on selected interest type
            let results;
            if (interestType === 'simple') {
                results = calculateSimpleInterest(P, annualRate, termVal, termUnit, frequency, startDate);
            } else {
                results = calculateAmortizingInterest(P, annualRate, termVal, termUnit, frequency, startDate, extraPayment, lumpSum);
            }
            
            fullSchedule = results.schedule;
            updateResults(results);
            updateChart(P, results.totalInterest);
        }

        function calculateSimpleInterest(P, annualRate, termVal, termUnit, frequency, startDate) {
            const tYears = termUnit === 'years' ? termVal : (termVal / 12);
            const I = P * (annualRate / 100) * tYears;
            const totalAmount = P + I;
            let numPayments = Math.round(frequency * tYears);
            const payment = totalAmount / numPayments;

            // Generate schedule
            const schedule = [];
            let balance = P;
            let currentDate = new Date(startDate.getTime());
            const principalPerPayment = P / numPayments;
            const interestPerPayment = I / numPayments;

            for (let i = 1; i <= numPayments; i++) {
                balance -= principalPerPayment;
                schedule.push({
                    number: i, date: new Date(currentDate.getTime()), payment, principal: principalPerPayment,
                    interest: interestPerPayment, balance: (i === numPayments ? 0 : balance)
                });
                currentDate = addPeriod(currentDate, frequency);
            }

            return {
                payment: payment, numPayments: numPayments, totalInterest: I, totalAmount: totalAmount,
                payoffDate: schedule.length > 0 ? schedule[schedule.length - 1].date : null,
                schedule: schedule, interestSaved: 0, timeSaved: { years: 0, months: 0 }
            };
        }

        function calculateAmortizingInterest(P, annualRate, termVal, termUnit, frequency, startDate, extraPayment, lumpSum) {
            const numPaymentsOriginal = termUnit === 'years' ? termVal * frequency : termVal * (frequency / 12);
            const periodicRate = (annualRate / 100) / frequency;
            
            // Calculate standard payment without extras
            const standardPayment = periodicRate > 0 ? P * (periodicRate * Math.pow(1 + periodicRate, numPaymentsOriginal)) / (Math.pow(1 + periodicRate, numPaymentsOriginal) - 1) : P / numPaymentsOriginal;

            // Generate schedule with extra payments
            const schedule = [];
            let balance = P;
            let currentDate = new Date(startDate.getTime());
            let totalInterestPaid = 0;
            let i = 1;

            while (balance > 0) {
                let interestForPeriod = balance * periodicRate;
                let principalPaid = (standardPayment + extraPayment) - interestForPeriod;
                
                // Apply one-time lump sum on first payment
                if (i === 1) {
                    principalPaid += lumpSum;
                }

                if (balance - principalPaid < 0) {
                    principalPaid = balance;
                }

                balance -= principalPaid;
                totalInterestPaid += interestForPeriod;

                schedule.push({
                    number: i, date: new Date(currentDate.getTime()), payment: principalPaid + interestForPeriod,
                    principal: principalPaid, interest: interestForPeriod, balance: balance
                });

                currentDate = addPeriod(currentDate, frequency);
                i++;
                if (i > numPaymentsOriginal * 2 && balance > 0) break; // Safety break
            }

            const totalAmountPaid = P + totalInterestPaid;
            const numPaymentsWithExtras = schedule.length;
            
            // Calculate savings
            const originalTotalInterest = (standardPayment * numPaymentsOriginal) - P;
            const interestSaved = originalTotalInterest - totalInterestPaid;
            const monthsSaved = numPaymentsOriginal - numPaymentsWithExtras;
            const timeSaved = { years: Math.floor(monthsSaved / 12), months: monthsSaved % 12 };

            return {
                payment: standardPayment, numPayments: numPaymentsWithExtras, totalInterest: totalInterestPaid, totalAmount: totalAmountPaid,
                payoffDate: schedule.length > 0 ? schedule[schedule.length - 1].date : null,
                schedule: schedule, interestSaved: interestSaved, timeSaved: timeSaved
            };
        }

        // ########## UI UPDATE FUNCTIONS ##########
        function updateResults(results) {
            elements.rPayment.textContent = formatMoney(results.payment);
            elements.rPaymentsCount.textContent = `${results.numPayments} payment${results.numPayments === 1 ? '' : 's'}`;
            elements.rInterest.textContent = formatMoney(results.totalInterest);
            elements.rTotal.textContent = formatMoney(results.totalAmount);
            elements.rPayoff.textContent = results.payoffDate ? formatDate(results.payoffDate) : '—';
            elements.resNote.textContent = 'Results are estimates. Verify details with your lender.';
            
            // Update savings text
            if(results.interestSaved > 0) {
                elements.interestSavedText.textContent = `You saved ${formatMoney(results.interestSaved)}`;
            } else {
                elements.interestSavedText.textContent = 'Over loan term';
            }
            if(results.timeSaved.years > 0 || results.timeSaved.months > 0) {
                elements.timeSavedText.textContent = `Paid off ${results.timeSaved.years}y ${results.timeSaved.months}m early`;
            } else {
                elements.timeSavedText.textContent = 'Estimated';
            }

            updateScheduleTable();
        }

        function updateScheduleTable() {
            if (!fullSchedule || fullSchedule.length === 0) {
                elements.scheduleBody.innerHTML = '<tr><td colspan="6" class="px-3 py-4 text-center text-gray-500">Enter loan details to generate schedule</td></tr>';
                return;
            }
            const displaySchedule = showFullSchedule ? fullSchedule : fullSchedule.slice(0, 5);
            elements.scheduleBody.innerHTML = displaySchedule.map((row, index) => `
                <tr class="${index % 2 === 0 ? 'bg-gray-50' : ''}">
                    <td class="px-3 py-2">${row.number}</td>
                    <td class="px-3 py-2">${formatDate(row.date)}</td>
                    <td class="px-3 py-2 text-right">${formatMoney(row.payment)}</td>
                    <td class="px-3 py-2 text-right">${formatMoney(row.principal)}</td>
                    <td class="px-3 py-2 text-right">${formatMoney(row.interest)}</td>
                    <td class="px-3 py-2 text-right">${formatMoney(row.balance)}</td>
                </tr>
            `).join('');

            if (!showFullSchedule && fullSchedule.length > 5) {
                elements.scheduleBody.innerHTML += '<tr><td colspan="6" class="px-3 py-2 text-center text-gray-500">... and ' + (fullSchedule.length - 5) + ' more payments</td></tr>';
            }
        }

        function updateChart(principal, totalInterest) {
            const data = {
                labels: ['Principal', 'Total Interest'],
                datasets: [{
                    data: [principal, totalInterest],
                    backgroundColor: ['#3b82f6', '#f97316'],
                    borderWidth: 0,
                }]
            };
            if(chartInstance) {
                chartInstance.data = data;
                chartInstance.update();
            } else {
                chartInstance = new Chart(elements.resultsChart, {
                    type: 'pie',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } }
                    }
                });
            }
        }

        function resetResults() {
            elements.rPayment.textContent = '$0.00';
            elements.rPaymentsCount.textContent = '0 payments';
            elements.rInterest.textContent = '$0.00';
            elements.rTotal.textContent = '$0.00';
            elements.rPayoff.textContent = '—';
            elements.resNote.textContent = 'Enter loan details to see your payment breakdown.';
            elements.interestSavedText.textContent = ' ';
            elements.timeSavedText.textContent = ' ';
            elements.scheduleBody.innerHTML = '<tr><td colspan="6" class="px-3 py-4 text-center text-gray-500">Enter loan details to generate schedule</td></tr>';
            if(chartInstance) {
                chartInstance.data.datasets[0].data = [0, 0];
                chartInstance.update();
            }
        }
        
        function toggleInterestType(type) {
            interestType = type;
            if (type === 'simple') {
                elements.interestTypeSimple.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                elements.interestTypeSimple.classList.remove('text-gray-500');
                elements.interestTypeAmortizing.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                elements.interestTypeAmortizing.classList.add('text-gray-500');
                elements.extraPaymentsSection.classList.add('opacity-50');
                elements.extraPaymentNote.classList.remove('hidden');
                elements.extraPayment.disabled = true;
                elements.lumpSumPayment.disabled = true;
            } else {
                elements.interestTypeAmortizing.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                elements.interestTypeAmortizing.classList.remove('text-gray-500');
                elements.interestTypeSimple.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                elements.interestTypeSimple.classList.add('text-gray-500');
                elements.extraPaymentsSection.classList.remove('opacity-50');
                elements.extraPaymentNote.classList.add('hidden');
                elements.extraPayment.disabled = false;
                elements.lumpSumPayment.disabled = false;
            }
            calculate();
        }

        // ########## EVENT LISTENERS ##########
        elements.currency.addEventListener('change', () => {
            currentCurrency = currencyMap[elements.currency.value] || currencyMap.USD;
            elements.currencySymbol.textContent = currentCurrency.symbol;
            elements.currencySymbolExtra.textContent = currentCurrency.symbol;
            elements.currencySymbolLump.textContent = currentCurrency.symbol;
            calculate();
        });

        elements.toggleSchedule.addEventListener('click', () => {
            showFullSchedule = !showFullSchedule;
            elements.toggleSchedule.textContent = showFullSchedule ? 'Show Preview' : 'Show Full Schedule';
            updateScheduleTable();
        });
        
        elements.interestTypeSimple.addEventListener('click', () => toggleInterestType('simple'));
        elements.interestTypeAmortizing.addEventListener('click', () => toggleInterestType('amortizing'));
        
        elements.shareButton.addEventListener('click', () => {
            const params = new URLSearchParams({
                p: elements.principal.value,
                r: elements.rate.value,
                tv: elements.termValue.value,
                tu: elements.termUnit.value,
                f: elements.frequency.value,
                it: interestType
            }).toString();
            navigator.clipboard.writeText(window.location.href.split('?')[0] + '?' + params);
            elements.shareFeedback.classList.remove('hidden');
            setTimeout(() => elements.shareFeedback.classList.add('hidden'), 2000);
        });
        
        elements.printButton.addEventListener('click', () => window.print());

        // Add input event listeners for real-time calculation
        [elements.principal, elements.rate, elements.termValue, elements.termUnit, elements.frequency, elements.startDate, elements.extraPayment, elements.lumpSumPayment].forEach(el => {
            el.addEventListener('input', calculate);
        });

        // ########## INITIALIZATION ##########
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            elements.startDate.valueAsDate = today;
            
            // Check for URL params to pre-fill calculator
            const urlParams = new URLSearchParams(window.location.search);
            if(urlParams.has('p')) elements.principal.value = urlParams.get('p');
            if(urlParams.has('r')) elements.rate.value = urlParams.get('r');
            if(urlParams.has('tv')) elements.termValue.value = urlParams.get('tv');
            if(urlParams.has('tu')) elements.termUnit.value = urlParams.get('tu');
            if(urlParams.has('f')) elements.frequency.value = urlParams.get('f');
            if(urlParams.get('it') === 'simple') toggleInterestType('simple');
            
            calculate();
        });
    </script>
</body>
</html>
