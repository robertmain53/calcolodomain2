<!DOCTYPE html>
<html lang="en">
<head>
<link rel="canonical" href="https://calcdomain.com/proportion-calculator.html">





  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Proportion Calculator — Solve A:B = C:D, Check Ratios, Step-by-Step</title>
  <meta name="description" content="Professional proportion calculator for A:B = C:D. Solve for the missing term, check if two ratios form a proportion, simplify ratios, scale quantities, and see step-by-step cross-multiplication. WCAG-compliant, mobile-first, and fast." />
  
  <link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
  <link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
  <link rel="manifest" href="https://calcdomain.com/site.webmanifest" />

  <!-- Tailwind (JIT CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- MathJax for LaTeX -->
  <script>
    window.MathJax = { tex: { inlineMath: [['\\(','\\)'], ['$', '$']] }, svg: { fontCache: 'global' } };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    :root {
      --brand:#1d4ed8; /* blue-700 */
      --ink:#0f172a;   /* slate-900 */
      --muted:#64748b; /* slate-500 */
      --surface:#ffffff;
      --subtle:#f8fafc;/* slate-50 */
      --ring:#2563eb;  /* blue-600 */
      --error:#b91c1c; /* red-700 */
    }
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji'; }
    /* Prose */
    .prose { max-width: 68ch; }
    .prose h2 { font-size: 1.375rem; font-weight: 700; margin-top: 2rem; margin-bottom: .75rem; color: var(--ink); }
    .prose h3 { font-size: 1.125rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: .5rem; }
    .prose p, .prose li { line-height: 1.7; }
    .formula-box {
      background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: .75rem; padding: 1rem; overflow-x: auto;
      font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;
    }
    /* Focus styles (WCAG) */
    :where(a, button, input, select, textarea, summary, [role="switch"], [role="button"]) {
      outline: none;
    }
    :where(a, button, input, select, textarea, summary, [role="switch"], [role="button"]):focus-visible {
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--ring) 65%, transparent);
      outline: 3px solid color-mix(in srgb, var(--ring) 85%, white);
      outline-offset: 2px;
      border-radius: .5rem;
    }
    /* Form helpers */
    .help-text { color: var(--muted); font-size: .875rem; margin-top: .25rem; }
    .error-text { color: var(--error); font-size: .875rem; margin-top: .25rem; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: .825rem; background:#eef2ff; border:1px solid #c7d2fe; padding:.1rem .375rem; border-radius:.375rem;}
    /* Result container min-height to prevent CLS */
    #results-panel { min-height: 260px; }
    /* Tactile target >= 48px */
    .tappable { min-height: 48px; min-width: 48px; }
    details > summary { cursor: pointer; }
  </style>

  <!-- JSON-LD: WebPage + WebApplication (Calculator) + BreadcrumbList + FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Proportion Calculator",
    "url":"https://calcdomain.com/proportion-calculator.html",
    "inLanguage":"en",
    "description":"Solve A:B = C:D, check proportionality, simplify and scale ratios with step-by-step cross-multiplication.",
    "author":{"@type":"Person","name":"Ugo Candido"},
    "publisher":{"@type":"Organization","name":"CalcDomain"},
    "about":[{"@type":"Thing","name":"Ratio"},{"@type":"Thing","name":"Proportion"}],
    "isPartOf":{"@type":"CreativeWorkSeries","name":"Math — Algebra"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Proportion Calculator",
    "applicationCategory":"EducationalApplication",
    "operatingSystem":"All",
    "url":"https://calcdomain.com/proportion-calculator.html",
    "creator":{"@type":"Person","name":"Ugo Candido"},
    "featureList":[
      "Solve for missing term in A:B = C:D",
      "Proportion checker with tolerance",
      "Ratio simplifier and scaler",
      "Step-by-step cross-multiplication",
      "LaTeX formula rendering"
    ]
  }
  </script>
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://calcdomain.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Math & Conversions",
      "item": "https://calcdomain.com/math-conversions.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Algebra",
      "item": "https://calcdomain.com/subcategories/core-math-algebra.html"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Proportion Calculator",
      "item": "https://calcdomain.com/proportion-calculator.html"
    }
  ]
}</script>
  <script type="application/ld+json" id="faq-json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"What is a proportion?","acceptedAnswer":{"@type":"Answer","text":"A proportion states that two ratios are equal, often written as A:B = C:D or A/B = C/D."}},
      {"@type":"Question","name":"How do I solve for the missing term?","acceptedAnswer":{"@type":"Answer","text":"Use cross-multiplication: A·D = B·C. Rearrange to isolate the unknown, e.g., A = (B·C)/D."}},
      {"@type":"Question","name":"Can I include decimals and fractions?","acceptedAnswer":{"@type":"Answer","text":"Yes. Enter decimals directly; the tool shows exact math and a simplified ratio. You can set precision for the numeric output."}},
      {"@type":"Question","name":"How do I check if two ratios are proportional?","acceptedAnswer":{"@type":"Answer","text":"Compute A·D and B·C. If they are equal within your chosen tolerance, the ratios are proportional."}},
      {"@type":"Question","name":"What does simplifying a ratio mean?","acceptedAnswer":{"@type":"Answer","text":"It means dividing both terms by their greatest common divisor (or a common factor) to express the ratio in lowest terms."}},
      {"@type":"Question","name":"What tolerance should I use?","acceptedAnswer":{"@type":"Answer","text":"For exact integers, use 0. For measurements or decimals, select a small tolerance (e.g., 1e-9 to 1e-6) to account for rounding."}},
      {"@type":"Question","name":"Does order matter in a ratio?","acceptedAnswer":{"@type":"Answer","text":"Yes. A:B is generally not the same as B:A. Keep the order consistent across the proportion."}}
    ]
  }
  </script>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header (non-sticky as requested) -->
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 lg:px-6 py-4 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-blue-700">CalcDomain</a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a class="hover:text-blue-700" href="search.html">Advanced Search</a>
        Categories
      </nav>
      <a class="md:hidden px-3 py-2 rounded-md border tappable hover:bg-slate-100" href="search.html" aria-label="Open search">Search</a>
    </div>
  </header>

  <main class="container mx-auto px-4 lg:px-6 py-10">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Content -->
      <section class="w-full lg:w-2/3">
        <nav class="text-sm text-slate-600 mb-4" aria-label="Breadcrumb">
          <a href="index.html" class="hover:text-blue-700">Home</a> &raquo;
          <a href="math.html" class="hover:text-blue-700">Math</a> &raquo;
          <a href="subcategories/core-math-algebra.html" class="hover:text-blue-700">Algebra</a> &raquo;
          <span class="text-slate-900">Proportion Calculator</span>
        </nav>

        <!-- 1. H1 -->
        <h1 class="text-3xl font-extrabold mb-2">proportion calculator</h1>

        <!-- 2. Intro -->
        <p class="text-slate-700 mb-6">
          Solve <strong>A:B = C:D</strong> in one click. This professional-grade tool finds the missing term,
          checks whether two ratios form a proportion, simplifies ratios, and shows the
          <em>exact</em> cross-multiplication steps — ideal for students, engineers, analysts, and educators.
        </p>

        <!-- 3. Calculator -->
        <section id="calculator" class="bg-white p-6 rounded-lg shadow-sm border">
          <h2 class="text-xl font-bold mb-4">Enter your values</h2>

          <form id="prop-form" class="grid grid-cols-1 md:grid-cols-2 gap-6" novalidate>
            <!-- A -->
            <div>
              <label for="valA" class="block text-sm font-medium text-slate-800">A <span aria-hidden="true" class="text-rose-700">*</span></label>
              <div class="flex items-start gap-2">
                <input id="valA" name="valA" type="text" inputmode="decimal" aria-required="true"
                  aria-describedby="helpA" class="tappable mt-1 w-full px-3 py-2 border rounded-md"
                  placeholder="e.g., 3 or 4.5" />
                <button type="button" class="px-2 py-2 rounded-md border tappable"
                  aria-expanded="false" aria-controls="tipA" data-tooltip="tipA" aria-label="Explain A">?</button>
              </div>
              <p id="helpA" class="help-text">Leave exactly <em>one</em> of A, B, C, D empty to solve for it.</p>
              <p id="errA" class="error-text hidden"></p>
              <div id="tipA" class="help-text hidden">A is the first term of the first ratio A:B.</div>
            </div>

            <!-- B -->
            <div>
              <label for="valB" class="block text-sm font-medium text-slate-800">B <span aria-hidden="true" class="text-rose-700">*</span></label>
              <div class="flex items-start gap-2">
                <input id="valB" name="valB" type="text" inputmode="decimal" aria-required="true"
                  aria-describedby="helpB" class="tappable mt-1 w-full px-3 py-2 border rounded-md"
                  placeholder="e.g., 5" />
                <button type="button" class="px-2 py-2 rounded-md border tappable"
                  aria-expanded="false" aria-controls="tipB" data-tooltip="tipB" aria-label="Explain B">?</button>
              </div>
              <p id="helpB" class="help-text">B is the second term of the first ratio A:B.</p>
              <p id="errB" class="error-text hidden"></p>
              <div id="tipB" class="help-text hidden">Use positive or negative values; decimals allowed.</div>
            </div>

            <!-- C -->
            <div>
              <label for="valC" class="block text-sm font-medium text-slate-800">C <span aria-hidden="true" class="text-rose-700">*</span></label>
              <div class="flex items-start gap-2">
                <input id="valC" name="valC" type="text" inputmode="decimal" aria-required="true"
                  aria-describedby="helpC" class="tappable mt-1 w-full px-3 py-2 border rounded-md"
                  placeholder="e.g., 12" />
                <button type="button" class="px-2 py-2 rounded-md border tappable"
                  aria-expanded="false" aria-controls="tipC" data-tooltip="tipC" aria-label="Explain C">?</button>
              </div>
              <p id="helpC" class="help-text">C is the first term of the second ratio C:D.</p>
              <p id="errC" class="error-text hidden"></p>
              <div id="tipC" class="help-text hidden">You can leave C empty if it is the unknown.</div>
            </div>

            <!-- D -->
            <div>
              <label for="valD" class="block text-sm font-medium text-slate-800">D <span aria-hidden="true" class="text-rose-700">*</span></label>
              <div class="flex items-start gap-2">
                <input id="valD" name="valD" type="text" inputmode="decimal" aria-required="true"
                  aria-describedby="helpD" class="tappable mt-1 w-full px-3 py-2 border rounded-md"
                  placeholder="e.g., 20" />
                <button type="button" class="px-2 py-2 rounded-md border tappable"
                  aria-expanded="false" aria-controls="tipD" data-tooltip="tipD" aria-label="Explain D">?</button>
              </div>
              <p id="helpD" class="help-text">D is the second term of the second ratio C:D.</p>
              <p id="errD" class="error-text hidden"></p>
              <div id="tipD" class="help-text hidden">You can leave D empty if it is the unknown.</div>
            </div>

            <!-- Precision -->
            <div>
              <label for="precision" class="block text-sm font-medium text-slate-800">Output precision (decimals)</label>
              <select id="precision" class="tappable mt-1 w-full px-3 py-2 border rounded-md" aria-describedby="helpPrec">
                <option>0</option><option>1</option><option selected>2</option><option>3</option><option>4</option><option>6</option><option>9</option>
              </select>
              <p id="helpPrec" class="help-text">Controls rounding for the numeric output (not the exact step algebra).</p>
            </div>

            <!-- Tolerance -->
            <div>
              <label for="tolerance" class="block text-sm font-medium text-slate-800">Proportion tolerance</label>
              <select id="tolerance" class="tappable mt-1 w-full px-3 py-2 border rounded-md" aria-describedby="helpTol">
                <option value="0">0 (exact)</option>
                <option value="1e-12">1e-12</option>
                <option value="1e-9" selected>1e-9</option>
                <option value="1e-6">1e-6</option>
                <option value="1e-3">1e-3</option>
              </select>
              <p id="helpTol" class="help-text">Useful when inputs are measured or rounded decimals.</p>
            </div>

            <!-- Actions -->
            <div class="md:col-span-2 flex flex-wrap gap-3">
              <button id="btn-solve" type="button" class="tappable px-4 py-3 rounded-md bg-blue-700 text-white font-semibold hover:bg-blue-800">
                Solve / Check
              </button>
              <button id="btn-clear" type="button" class="tappable px-4 py-3 rounded-md border hover:bg-slate-100" aria-label="Clear all fields">
                Clear
              </button>
              <button id="btn-example" type="button" class="tappable px-4 py-3 rounded-md border hover:bg-slate-100" aria-label="Load example input">
                Load example
              </button>
            </div>
          </form>

          <div class="mt-6 text-sm text-slate-600">
            Tip: Leave exactly one of <span class="kbd">A</span>, <span class="kbd">B</span>, <span class="kbd">C</span>, <span class="kbd">D</span> blank to solve for it. Use the tolerance to judge near-equality for decimal inputs.
          </div>
          <hr class="my-6">
          <!-- Ratio tools -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-semibold mb-2">Simplify ratio</h3>
              <div class="flex gap-2">
                <input id="simpX" inputmode="decimal" class="tappable w-1/2 px-3 py-2 border rounded-md" placeholder="X (e.g., 42)">
                <input id="simpY" inputmode="decimal" class="tappable w-1/2 px-3 py-2 border rounded-md" placeholder="Y (e.g., 56)">
              </div>
              <button id="btn-simplify" type="button" class="tappable mt-3 px-4 py-2 rounded-md border hover:bg-slate-100">Simplify</button>
              <p id="simpOut" class="help-text mt-2"></p>
            </div>
            <div>
              <h3 class="font-semibold mb-2">Scale ratio</h3>
              <div class="flex flex-col gap-2">
                <div class="flex gap-2">
                  <input id="scaleX" inputmode="decimal" class="tappable w-1/2 px-3 py-2 border rounded-md" placeholder="X">
                  <input id="scaleY" inputmode="decimal" class="tappable w-1/2 px-3 py-2 border rounded-md" placeholder="Y">
                </div>
                <div class="flex gap-2">
                  <input id="scaleK" inputmode="decimal" class="tappable w-full px-3 py-2 border rounded-md" placeholder="Scale factor k (e.g., 3)">
                </div>
              </div>
              <button id="btn-scale" type="button" class="tappable mt-3 px-4 py-2 rounded-md border hover:bg-slate-100">Apply scale</button>
              <p id="scaleOut" class="help-text mt-2"></p>
            </div>
          </div>
        </section>

        <!-- 4. Results -->
        <section id="results-panel" class="bg-blue-50 border border-blue-100 rounded-lg p-6 mt-6">
          <h2 class="text-xl font-bold mb-4">Results</h2>
          <div id="results-cards" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="bg-white border rounded-lg p-4 text-center">
              <h4 class="text-sm text-slate-500">Unknown solved</h4>
              <p id="res-unknown" class="text-2xl font-extrabold text-blue-700">—</p>
            </div>
            <div class="bg-white border rounded-lg p-4 text-center">
              <h4 class="text-sm text-slate-500">Proportion check (A·D ?= B·C)</h4>
              <p id="res-check" class="text-xl font-bold">—</p>
            </div>
          </div>

          <details class="mt-4 bg-white border rounded-lg p-4">
            <summary class="font-semibold">Show step-by-step algebra</summary>
            <div id="res-steps" class="mt-3 space-y-2 text-sm"></div>
          </details>

          <div class="mt-4 text-sm grid grid-cols-1 md:grid-cols-3 gap-3">
            <div class="bg-white border rounded-lg p-3">
              <div class="text-slate-500">Simplified A:B</div>
              <div id="res-simp-ab" class="font-semibold">—</div>
            </div>
            <div class="bg-white border rounded-lg p-3">
              <div class="text-slate-500">Simplified C:D</div>
              <div id="res-simp-cd" class="font-semibold">—</div>
            </div>
            <div class="bg-white border rounded-lg p-3">
              <div class="text-slate-500">Equality of ratios</div>
              <div id="res-equality" class="font-semibold">—</div>
            </div>
          </div>
        </section>

        <!-- 5. Authoritative ecosystem -->
        <section class="bg-white p-6 rounded-lg shadow-sm border mt-8 prose">
          <h2>Data source &amp; methodology</h2>
          <p>
            <strong>AuthoritativeDataSource:</strong> OpenStax, <em>Elementary Algebra 2e</em>, section “Ratios and Proportions”
            (Houston, TX: OpenStax, 2015, CC BY). Direct link:
            <a href="https://openstax.org/details/books/elementary-algebra-2e" rel="noopener">openstax.org/details/books/elementary-algebra-2e</a>.
            All computations follow the proportional identity \(A:B=C:D \iff \frac{A}{B}=\frac{C}{D}\) and cross-multiplication \(A\cdot D = B\cdot C\).
          </p>
          <p><em>“Tutti i calcoli si basano rigorosamente sulle formule e sui dati forniti da questa fonte.”</em></p>

          <h2>The formula explained</h2>
          <div class="formula-box">
            \( \displaystyle A:B = C:D \quad \Longleftrightarrow \quad \frac{A}{B} = \frac{C}{D} \quad \Longleftrightarrow \quad A\cdot D = B\cdot C. \)<br>
            Solve for the missing term:<br>
            \( A = \dfrac{B\cdot C}{D},\qquad B = \dfrac{A\cdot D}{C},\qquad C = \dfrac{A\cdot D}{B},\qquad D = \dfrac{B\cdot C}{A}. \)
          </div>

          <h2>Glossary of variables</h2>
          <ul>
            <li><strong>A</strong> — first term of the first ratio A:B.</li>
            <li><strong>B</strong> — second term of the first ratio A:B.</li>
            <li><strong>C</strong> — first term of the second ratio C:D.</li>
            <li><strong>D</strong> — second term of the second ratio C:D.</li>
            <li><strong>Tolerance</strong> — acceptable difference \(|A\cdot D - B\cdot C|\) to treat as equal when using decimals/measurements.</li>
            <li><strong>Precision</strong> — number of decimals used when displaying numeric results.</li>
          </ul>

          <h2>How it works: a step-by-step example</h2>
          <h3>Example</h3>
          <p>Suppose you know \(A=3\), \(B=5\), \(C=12\), and want to find \(D\) in \(3:5 = 12:D\).</p>
          <ol>
            <li>Write the identity \(A\cdot D = B\cdot C \Rightarrow 3\cdot D = 5\cdot 12 = 60\).</li>
            <li>Isolate \(D\): \(D = \dfrac{60}{3} = 20\).</li>
            <li>Check: \(A/B = 3/5 = 0.6\) and \(C/D = 12/20 = 0.6\) — the ratios are equal.</li>
          </ol>

          <h2>Frequently asked questions</h2>
          <details open>
            <summary>How does the calculator decide the unknown?</summary>
            <p>Exactly one of A, B, C, D must be empty. The empty one is solved using the rearranged cross-multiplication formulas shown above.</p>
          </details>
          <details>
            <summary>What if I enter all four values?</summary>
            <p>The tool won’t overwrite any value; it will check proportionality using your tolerance and report whether \(A\cdot D\) equals \(B\cdot C\).</p>
          </details>
          <details>
            <summary>How are simplified ratios displayed?</summary>
            <p>For integers, the calculator divides both terms by their greatest common divisor (GCD). For decimals, it scales to integers when possible and then simplifies.</p>
          </details>
          <details>
            <summary>Can values be negative or zero?</summary>
            <p>Yes, but ratios with zero in the denominator (B=0 or D=0) are invalid. The tool flags division-by-zero conditions with clear error messages.</p>
          </details>
          <details>
            <summary>Can I copy the algebra steps?</summary>
            <p>Yes. Expand “Show step-by-step algebra”, then copy the LaTeX-rendered lines as needed.</p>
          </details>
        </section>

        <!-- 6. Author & Review -->
        <section class="bg-white p-6 rounded-lg shadow-sm border mt-8 text-sm">
          <p><strong>Tool developed by Ugo Candido.</strong> Content verified by the CalcDomain Editorial Board.</p>
          <p>Last accuracy review: <time datetime="2025-10-25">October 25, 2025</time></p>
        </section>
      </section>

      <!-- Sidebar -->
      <aside class="w-full lg:w-1/3">
        <div class="sticky top-24 space-y-6">
          <div class="bg-slate-200 h-72 rounded-lg flex items-center justify-center text-slate-500">Ad Placement (300×600)</div>
          <div class="bg-white p-6 rounded-lg shadow-sm border">
            <h3 class="font-bold text-lg mb-3">Why this calculator</h3>
            <ul class="list-disc list-inside text-sm text-slate-700 space-y-2">
              <li>Clear step-by-step cross-multiplication.</li>
              <li>Precision &amp; tolerance controls for real-world data.</li>
              <li>Built with accessibility and performance in mind.</li>
            </ul>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-sm border">
            <h3 class="font-bold text-lg mb-4">Related math tools</h3>
            <ul class="space-y-2 text-sm">
              <li><a href="ratio.html" class="text-blue-700 hover:underline">Ratio Calculator</a></li>
              <li><a href="percentage-calculator.html" class="text-blue-700 hover:underline">Percentage Calculator</a></li>
              <li>Fraction Simplifier</li>
              <li>Rule of Three</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-6 py-8 text-center text-slate-600 text-sm">
      <p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
      <div class="mt-4 space-x-4">
        <a href="about.html" class="hover:text-blue-700">About</a>
        <a href="contact.html" class="hover:text-blue-700">Contact</a>
        <a href="privacy.html" class="hover:text-blue-700">Privacy</a>
        <a href="terms.html" class="hover:text-blue-700">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Calculator Logic (defer at end) -->
  <script defer>
  (function(){
    const $ = (id) => document.getElementById(id);
    const els = {
      form: $('prop-form'),
      A: $('valA'), B: $('valB'), C: $('valC'), D: $('valD'),
      errA: $('errA'), errB: $('errB'), errC: $('errC'), errD: $('errD'),
      precision: $('precision'), tolerance: $('tolerance'),
      btnSolve: $('btn-solve'), btnClear: $('btn-clear'), btnExample: $('btn-example'),
      simpX: $('simpX'), simpY: $('simpY'), btnSimplify: $('btn-simplify'), simpOut: $('simpOut'),
      scaleX: $('scaleX'), scaleY: $('scaleY'), scaleK: $('scaleK'), btnScale: $('btn-scale'), scaleOut: $('scaleOut'),
      resUnknown: $('res-unknown'), resCheck: $('res-check'), resSteps: $('res-steps'),
      resSimpAB: $('res-simp-ab'), resSimpCD: $('res-simp-cd'), resEquality: $('res-equality')
    };

    // Accessible tooltips
    document.querySelectorAll('[data-tooltip]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const tid = btn.getAttribute('data-tooltip');
        const tip = $(tid);
        const open = tip.classList.toggle('hidden') ? false : true;
        btn.setAttribute('aria-expanded', String(open));
        if(open) tip.setAttribute('role','note');
      });
      btn.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
      });
    });

    // Helpers
    const parseNum = (v) => {
      if (v == null) return null;
      const s = (''+v).trim();
      if (s === '') return null;
      const n = Number(s.replace(',', '.'));
      return Number.isFinite(n) ? n : NaN;
    };
    const showError = (el, errEl, msg) => {
      if (!msg) {
        errEl.textContent = '';
        errEl.classList.add('hidden');
        el.setAttribute('aria-invalid','false');
        el.removeAttribute('aria-describedby');
        return;
      }
      errEl.textContent = msg;
      errEl.classList.remove('hidden');
      el.setAttribute('aria-invalid','true');
      el.setAttribute('aria-describedby', errEl.id);
    };
    const gcd = (a,b) => {
      a = Math.abs(a); b = Math.abs(b);
      if (!Number.isFinite(a) || !Number.isFinite(b)) return 1;
      while (b) { const t = b; b = a % b; a = t; }
      return a || 1;
    };
    const toSimplified = (x,y) => {
      if (![x,y].every((n)=>Number.isFinite(n))) return '—';
      // scale decimals to integers if needed
      const sx = x.toString(), sy = y.toString();
      const dx = (sx.split('.')[1]||'').length, dy = (sy.split('.')[1]||'').length;
      const p = Math.pow(10, Math.max(dx,dy));
      const xi = Math.round(x*p), yi = Math.round(y*p);
      const g = gcd(xi, yi);
      return `${xi/g} : ${yi/g}`;
    };
    const fmt = (n, dec) => Number.isFinite(n) ? n.toFixed(dec) : '—';

    // Validation (on blur)
    [els.A,els.B,els.C,els.D].forEach((input, idx)=>{
      const errs = [els.errA, els.errB, els.errC, els.errD];
      input.addEventListener('blur', ()=>{
        const v = input.value.trim();
        if (v === '') { showError(input, errs[idx], 'Leave empty only if this is the unknown. Otherwise, enter a number.'); return; }
        const n = parseNum(v);
        if (Number.isNaN(n)) { showError(input, errs[idx], 'Please enter a valid number (decimals allowed).'); return; }
        if ((input===els.B || input===els.D) && n === 0) {
          showError(input, errs[idx], 'Denominator terms B and D cannot be zero.'); return;
        }
        showError(input, errs[idx], '');
      });
    });

    function solveOrCheck() {
      // Gather values
      const A = parseNum(els.A.value);
      const B = parseNum(els.B.value);
      const C = parseNum(els.C.value);
      const D = parseNum(els.D.value);
      const dec = parseInt(els.precision.value,10);
      const tol = Number(els.tolerance.value);

      const vals = {A,B,C,D};
      const blanks = Object.entries(vals).filter(([,v]) => v === null);
      const filled  = Object.entries(vals).filter(([,v]) => v !== null);

      // Reset inline errors (solve-time)
      [els.errA,els.errB,els.errC,els.errD].forEach(e => { e.textContent=''; e.classList.add('hidden'); });

      // Basic checks
      if (filled.length === 0) {
        els.resUnknown.textContent = '—';
        els.resCheck.textContent = 'Enter at least three values.';
        els.resEquality.textContent = '—';
        els.resSteps.innerHTML = '';
        els.resSimpAB.textContent = '—';
        els.resSimpCD.textContent = '—';
        return;
      }
      if (blanks.length > 1 && filled.length < 3) {
        els.resUnknown.textContent = '—';
        els.resCheck.textContent = 'Provide exactly three values to solve for the fourth.';
        els.resEquality.textContent = '—';
        els.resSteps.innerHTML = '';
        return;
      }
      if ((B === 0) || (D === 0)) {
        els.resUnknown.textContent = '—';
        els.resCheck.textContent = 'Invalid: denominator terms B or D cannot be zero.';
        return;
      }

      // Compute AD and BC (for check)
      const ad = (A==null || D==null) ? null : A*D;
      const bc = (B==null || C==null) ? null : B*C;

      // If exactly one blank, solve it
      if (blanks.length === 1) {
        const u = blanks[0][0]; // unknown key
        let solved = NaN;
        let deriv = '';
        if (u === 'A') { if (D===0) return flag('D cannot be zero.'); solved = (B*C)/D; deriv = '\\( A = \\dfrac{B\\cdot C}{D} \\)'; }
        if (u === 'B') { if (C===0) return flag('C cannot be zero.'); solved = (A*D)/C; deriv = '\\( B = \\dfrac{A\\cdot D}{C} \\)'; }
        if (u === 'C') { if (B===0) return flag('B cannot be zero.'); solved = (A*D)/B; deriv = '\\( C = \\dfrac{A\\cdot D}{B} \\)'; }
        if (u === 'D') { if (A===0) return flag('A cannot be zero.'); solved = (B*C)/A; deriv = '\\( D = \\dfrac{B\\cdot C}{A} \\)'; }

        els.resUnknown.textContent = fmt(solved, dec);

        // With solved, we can check proportionality (exactly true algebraically, but round check anyway)
        const _A = (u==='A')? solved : A;
        const _B = (u==='B')? solved : B;
        const _C = (u==='C')? solved : C;
        const _D = (u==='D')? solved : D;

        const _ad = _A*_D, _bc = _B*_C;
        const equal = Math.abs(_ad - _bc) <= tol;
        els.resCheck.textContent = equal ? 'Proportion holds ✓' : 'Not proportional ✗';
        els.resEquality.textContent = equal ? `${fmt(_A/_B, dec)} = ${fmt(_C/_D, dec)}` : `${fmt(_A/_B, dec)} ≠ ${fmt(_C/_D, dec)}`;

        // Steps
        const steps = [
          '\\( A:B = C:D \\iff \\frac{A}{B} = \\frac{C}{D} \\iff A\\cdot D = B\\cdot C. \\)',
          `Solve for ${u}: ${deriv}`,
          `Compute: \\( B\\cdot C = ${_B.toString()}\\cdot ${_C.toString()} = ${(_B*_C).toString()} \\)`,
          `and \\( A\\cdot D = ${_A.toString()}\\cdot ${_D.toString()} = ${(_A*_D).toString()} \\).`,
          `Result: \\( ${u} = ${fmt(solved, dec)} \\).`
        ];
        els.resSteps.innerHTML = steps.map(s=>`<div>${s}</div>`).join('');
        if (window.MathJax && window.MathJax.typesetPromise) window.MathJax.typesetPromise();

        // Simplified ratios
        els.resSimpAB.textContent = toSimplified(_A, _B);
        els.resSimpCD.textContent = toSimplified(_C, _D);
        return;
      }

      // Otherwise, no unknown (all given) — check proportionality
      if (ad == null || bc == null) {
        els.resUnknown.textContent = '—';
        els.resCheck.textContent = 'Please provide either three values to solve, or all four to check.';
        els.resSteps.innerHTML = '';
        return;
      }
      const equal = Math.abs(ad - bc) <= tol;
      els.resUnknown.textContent = '—';
      els.resCheck.textContent = equal ? 'Proportion holds ✓' : 'Not proportional ✗';
      els.resEquality.textContent = (B && D) ? (equal ? `${fmt(A/B, dec)} = ${fmt(C/D, dec)}` : `${fmt(A/B, dec)} ≠ ${fmt(C/D, dec)}`) : '—';
      els.resSteps.innerHTML = [
        '\\( A\\cdot D \\stackrel{?}{=} B\\cdot C \\)',
        `\\( ${A} \\cdot ${D} = ${fmt(ad, dec)} \\) vs \\( ${B} \\cdot ${C} = ${fmt(bc, dec)} \\)`,
        equal ? '\\( |AD-BC| \\leq \\text{tolerance} \\Rightarrow \\) proportion confirmed.' : '\\( |AD-BC| > \\text{tolerance} \\Rightarrow \\) not a proportion.'
      ].map(s=>`<div>${s}</div>`).join('');
      if (window.MathJax && window.MathJax.typesetPromise) window.MathJax.typesetPromise();
      els.resSimpAB.textContent = toSimplified(A, B);
      els.resSimpCD.textContent = toSimplified(C, D);
    }

    function flag(msg){ els.resCheck.textContent = msg; }

    // Buttons
    els.btnSolve.addEventListener('click', solveOrCheck);
    els.btnClear.addEventListener('click', ()=>{
      [els.A,els.B,els.C,els.D,els.simpX,els.simpY,els.scaleX,els.scaleY,els.scaleK].forEach(i=> i.value='');
      els.resUnknown.textContent='—'; els.resCheck.textContent='—'; els.resSteps.innerHTML='';
      els.resSimpAB.textContent='—'; els.resSimpCD.textContent='—'; els.resEquality.textContent='—';
      [els.errA,els.errB,els.errC,els.errD].forEach(e=>{ e.textContent=''; e.classList.add('hidden'); });
    });
    els.btnExample.addEventListener('click', ()=>{
      els.A.value='3'; els.B.value='5'; els.C.value='12'; els.D.value='';
      els.precision.value='2'; els.tolerance.value='1e-9';
      solveOrCheck();
      els.D.focus();
    });

    // Simplify
    els.btnSimplify.addEventListener('click', ()=>{
      const x = parseNum(els.simpX.value), y = parseNum(els.simpY.value);
      if (x==null || y==null || Number.isNaN(x) || Number.isNaN(y)) { els.simpOut.textContent = 'Enter two numbers to simplify X:Y.'; return; }
      if (y===0) { els.simpOut.textContent = 'Y cannot be zero.'; return; }
      els.simpOut.textContent = `Simplified: ${toSimplified(x,y)}`;
    });

    // Scale
    els.btnScale.addEventListener('click', ()=>{
      const x = parseNum(els.scaleX.value), y = parseNum(els.scaleY.value), k = parseNum(els.scaleK.value);
      if ([x,y,k].some(v=>v==null || Number.isNaN(v))) { els.scaleOut.textContent='Enter X, Y and a scale factor k.'; return; }
      els.scaleOut.textContent = `Scaled ratio: ${fmt(x*k, 6)} : ${fmt(y*k, 6)} (then simplified → ${toSimplified(x*k, y*k)})`;
    });

    // Keyboard: Enter triggers solve
    [els.A,els.B,els.C,els.D,els.precision,els.tolerance].forEach(node=>{
      node.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); solveOrCheck(); }});
    });
  })();
  </script>
</body>
</html>
