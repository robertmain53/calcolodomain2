<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" href="https://calcdomain.com/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://calcdomain.com/favicon.svg" />
<link rel="shortcut icon" href="https://calcdomain.com/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://calcdomain.com/apple-touch-icon.png" />
<link rel="manifest" href="https://calcdomain.com/site.webmanifest" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipe Nutrition Calculator: Analyze Calories &amp; Macros</title>
<meta name="description" content="Instantly analyze any recipe's nutritional information. Paste your ingredient list to get a full breakdown of calories, protein, fat, carbs, and micronutrients per serving.">
<link rel="canonical" href="https://calcdomain.com/recipe-nutrition-calculator.html"https://calcdomain.com/>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; }
.prose { max-width: 65ch; }
.prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
.prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
.prose p { margin-bottom: 1rem; line-height: 1.6; }
.prose ul, .prose ol { margin-left: 1.5rem; margin-bottom: 1rem; }
.prose li { margin-bottom: 0.5rem; }
.formula-box {
background:#f3f4f6; border:1px solid #d1d5db; border-radius:8px; padding:1rem;
overflow-x:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
}
details > summary { cursor: pointer; font-weight: 600; padding: 0.5rem 0; }
details[open] > summary { margin-bottom: 0.5rem; }
.result-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 1.25rem; text-align: center; }
.result-card h4 { font-size: 0.95rem; color: #6b7280; margin-bottom: 0.25rem; }
.result-card p { font-size: 1.75rem; font-weight: 700; color: #2563eb; }

/* Custom Focus State - WCAG AA */
:focus-visible {
outline: 3px solid #3b82f6;
outline-offset: 2px;
border-radius: 4px;
}
/* Prevent CLS on result */
#results-container { min-height: 400px; }
/* Error Message Styling */
.error-message { color: #dc2626; font-size: 0.875rem; margin-top: 0.5rem; }
/* Accessible Tooltip */
.tooltip-container {
position: relative;
display: inline-block;
}
.tooltip-btn {
background: none;
border: none;
padding: 0;
margin: 0 0 0 4px;
cursor: pointer;
color: #6b7280;
}
.tooltip-text {
visibility: hidden;
width: 220px;
background-color: #1f2937;
color: #fff;
text-align: center;
border-radius: 6px;
padding: 8px;
position: absolute;
z-index: 10;
bottom: 125%;
left: 50%;
margin-left: -110px;
opacity: 0;
transition: opacity 0.3s;
font-size: 0.875rem;
font-weight: 400;
}
.tooltip-btn:focus + .tooltip-text,
.tooltip-btn:hover + .tooltip-text {
visibility: visible;
opacity: 1;
}
</style>

<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "WebPage",
"name": "Recipe Nutrition Calculator: Analyze Calories & Macros",
"description": "Instantly analyze any recipe's nutritional information. Paste your ingredient list to get a full breakdown of calories, protein, fat, carbs, and micronutrients per serving.",
"url": "https://calcdomain.com/recipe-nutrition-calculator.html",
"inLanguage": "en",
"author": { "@type": "Person", "name": "Ugo Candido" },
"publisher": { "@type": "Organization", "name": "CalcDomain" }
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
{ "@type": "ListItem", "position": 1, "name": "Home", "item": "https://calcdomain.com/" },
{ "@type": "ListItem", "position": 2, "name": "Health & Fitness", "item": "https://calcdomain.com/health-fitness.html" },
{ "@type": "ListItem", "position": 3, "name": "Diet & Nutrition", "item": "https://calcdomain.com/subcategories/health-fitness-diet-nutrition.html" },
{ "@type": "ListItem", "position": 4, "name": "Recipe Nutrition Calculator", "item": "https://calcdomain.com/recipe-nutrition-calculator.html" }
]
}
</script>
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "HowTo",
"name": "How to Calculate Recipe Nutrition",
"description": "A step-by-step guide to analyzing the nutritional content of any recipe.",
"step": [
{"@type": "HowToStep", "name": "Paste Ingredients", "text": "Copy and paste your complete ingredient list (e.g., '1 cup flour', '2 large eggs') into the text area, with each ingredient on a new line."},
{"@type": "HowToStep", "name": "Enter Servings", "text": "Input the total number of servings the recipe yields."},
{"@type": "HowToStep", "name": "Calculate & Analyze", "text": "Click the 'Calculate Nutrition' button."},
{"@type": "HowToStep", "name": "Review Results", "text": "See a full nutritional breakdown, including calories, macronutrients, and key micronutrients for both the total recipe and per individual serving."}
]
}
</script>
<script src="search.js" defer></script> 
</head>
<body class="bg-gray-50 text-gray-900">

<header class="bg-white shadow-sm">
<nav class="container mx-auto px-4 lg:px-6 py-4">
<div class="flex justify-between items-center">
<a href="index.html" class="text-2xl font-bold text-blue-600">CalcDomain</a>

<div class="w-full max-w-md hidden md:block mx-8">
<div class="relative">
<input type="search" id="search-input" placeholder="Search for a calculator..."
class="w-full py-2 px-4 pr-12 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
autocomplete="off">
<svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"
fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<div id="search-results" class="absolute top-full left-0 right-0 hidden bg-white border border-gray-200 rounded-lg shadow-lg mt-2 max-h-96 overflow-y-auto z-50"></div>
</div>
</div>

<div class="hidden md:flex items-center space-x-6 text-sm">
<a href="search.html" class="text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="text-gray-700 hover:text-blue-600">Categories</a>
</div>

<button id="mobile-menu-toggle" class="md:hidden p-2" aria-label="Open menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
d="M4 6h16M4 12h16M4 18h16"></path>
</svg>
</button>
</div>

<div id="mobile-menu" class="md:hidden mt-4 hidden">
<div class="space-y-2">
<a href="search.html" class="block py-2 text-gray-700 hover:text-blue-600">Advanced Search</a>
<a href="index.html#categories" class="block py-2 text-gray-700 hover:text-blue-600">Categories</a>
</div>
</div>
</nav>
</header>

<main class="container mx-auto px-4 lg:px-6 py-10">
<div class="flex flex-col lg:flex-row gap-8">

<section class="w-full lg:w-2/3">
<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
<a href="index.html" class="hover:text-blue-600">Home</a> &raquo;
<a href="health-fitness.html" class="hover:text-blue-600">Health &amp; Fitness</a> &raquo;
<a href="subcategories/health-fitness-diet-nutrition.html" class="hover:text-blue-600">Diet &amp; Nutrition</a> &raquo;
<span class="text-gray-900">Recipe Nutrition Calculator</span>
</nav>

<article id="print-section" class="bg-white p-6 rounded-lg shadow-md">
<h1 class="text-3xl font-extrabold text-gray-900 mb-2">Recipe Nutrition Calculator</h1>
<p class="text-gray-600 mb-6">Stop guessing your recipe's macros. This tool analyzes any ingredient list to provide a detailed nutritional breakdown. It's designed for home cooks, meal preppers, and nutrition-conscious individuals who want accurate calorie and macronutrient data per serving.</p>

<section id="calculator-ui" class="space-y-6">
<form id="nutrition-form">
<div>
<label for="ingredient-list" class="block text-sm font-medium text-gray-700">
Ingredient List
<span class="text-red-600">*</span>
<span class="tooltip-container">
<button type="button" class="tooltip-btn" aria-label="Ingredient list formatting tip">
<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
</button>
<span class="tooltip-text" role="tooltip" id="ingredient-tip">Paste your full recipe, with each ingredient on a new line. E.g., "1 cup all-purpose flour".</span>
</span>
</label>
<textarea id="ingredient-list" rows="10"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
placeholder="Paste your ingredients here, one per line...&#10;e.g., 2 large eggs&#10;e.g., 100g chicken breast&#10;e.g., 1 tbsp olive oil"
aria-required="true"
aria-describedby="ingredient-error ingredient-tip"></textarea>
<p id="ingredient-error" class="error-message" aria-live="polite" style="display: none;"></p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label for="servings" class="block text-sm font-medium text-gray-700">
Number of Servings
<span class="text-red-600">*</span>
</label>
<input type="number" id="servings" value="1" step="1" min="1"
class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
aria-required="true"
aria-describedby="servings-error">
<p id="servings-error" class="error-message" aria-live="polite" style="display: none;"></p>
</div>
<div class="pt-6">
<button type="submit" id="calculate-btn"
class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50">
Calculate Nutrition
</button>
</div>
</div>
</form>
</section>

<section id="results-container" class="mt-8" aria-live="polite" aria-busy="false">
<div id="loading-spinner" class="text-center py-12" style="display: none;">
<svg class="animate-spin h-8 w-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
<p class="mt-2 text-sm font-medium text-gray-600">Analyzing recipe...</p>
</div>

<div id="api-error" class="bg-red-50 border border-red-200 text-red-800 rounded-lg p-4" style="display: none;">
<h4 class="font-bold">Analysis Failed</h4>
<p id="api-error-message">Could not calculate nutrition. Please check your ingredient list for clarity or try again later.</p>
</div>

<div id="results-content" class="bg-blue-50 border border-blue-100 rounded-lg p-6" style="display: none;">
<h3 class="text-xl font-semibold text-gray-900 mb-4">Nutritional Summary</h3>
<div class="flex flex-col md:flex-row gap-6">
<div class="w-full md:w-1/3 flex-shrink-0">
<p class="text-center text-sm font-medium text-gray-700 mb-2">Calorie Breakdown</p>
<div id="results-chart-container" class="h-40">
<canvas id="resultsChart" aria-label="Macronutrient calorie breakdown chart"></canvas>
</div>
</div>
<div class="w-full md:w-2/3 grid grid-cols-2 gap-4">
<div class="result-card">
<h4>Total Calories</h4>
<p id="total-calories">0</p>
</div>
<div class="result-card">
<h4>Calories per Serving</h4>
<p id="serving-calories">0</p>
</div>
<div class="result-card">
<h4>Total Protein</h4>
<p id="total-protein">0g</p>
</div>
<div class="result-card">
<h4>Protein per Serving</h4>
<p id="serving-protein">0g</p>
</div>
<div class="result-card">
<h4>Total Fat</h4>
<p id="total-fat">0g</p>
</div>
<div class="result-card">
<h4>Fat per Serving</h4>
<p id="serving-fat">0g</p>
</div>
<div class="result-card">
<h4>Total Carbs</h4>
<p id="total-carbs">0g</p>
</div>
<div class="result-card">
<h4>Carbs per Serving</h4>
<p id="serving-carbs">0g</p>
</div>
</div>
</div>

<details class="mt-6 bg-white rounded-lg" id="details-table">
<summary class="font-semibold text-gray-800 p-4">View Full Nutrition Label</summary>
<div class="border-t border-gray-200 overflow-x-auto">
<table class="min-w-full text-sm">
<thead class="bg-gray-100 text-gray-700">
<tr>
<th class="px-4 py-2 text-left">Nutrient</th>
<th class="px-4 py-2 text-right">Total Recipe</th>
<th class="px-4 py-2 text-right">Per Serving</th>
<th class="px-4 py-2 text-right">% Daily Value (per serving)</th>
</tr>
</thead>
<tbody id="nutrition-table-body">
</tbody>
</table>
</div>
</details>
</div>
</article>

<article class="bg-white p-6 rounded-lg shadow-md mt-8 prose">
<h2>Data Source and Methodology</h2>
<p>This calculator provides nutritional estimates using the <a href="https://developer.edamam.com/edamam-nutrition-api" target="_blank" rel="noopener noreferrer"><strong>Edamam Nutrition Analysis API</strong></a>, a leading service that leverages Natural Language Processing (NLP) to parse ingredient lists. Edamam's database is a comprehensive collection of food data aggregated from authoritative sources, including:</p>
<ul>
<li><strong>USDA FoodData Central:</strong> The premier food composition database from the U.S. Department of Agriculture.</li>
<li><strong>FDA Food Labels:</strong> Data from the U.S. Food and Drug Administration.</li>
<li><strong>International Databases:</strong> Data from food agencies in Canada, the UK, and Europe.</li>
</ul>
<p><strong>All calculations are based strictly on the data and formulas provided by this service.</strong> This tool provides an estimate; exact nutritional values can vary based on specific brands, ingredient preparation, and cooking methods.</p>

<h2>The Formula Explained</h2>
<p>The calculation is a two-step process. First, the total nutrition for the entire recipe is determined by summing the nutritional values of each individual ingredient identified by the analysis engine. Second, the "per serving" values are calculated by dividing the totals by the number of servings you provide.</p>
<p class="formula-box">
$$ TotalNutrient_{recipe} = \sum_{i=1}^{n} NutrientValue_{ingredient \, i} $$
</p>
<p class="formula-box">
$$ NutrientPerServing = \frac{TotalNutrient_{recipe}}{NumberOfServings} $$
</p>

<h2>Glossary of Variables</h2>
<ul class="list-disc list-outside">
<li><strong>Ingredient List (Input):</strong> A text list of all ingredients in your recipe. The parser is most accurate with standard measurements (e.g., '1 cup', '100g', '2 large').</li>
<li><strong>Number of Servings (Input):</strong> The total number of equal portions the recipe yields.</li>
<li><strong>Total Calories (Output):</strong> The total kilocalories (kcal) for the entire recipe.</li>
<li><strong>Calories per Serving (Output):F</strong> The kilocalories (kcal) for one serving.</li>
<li><strong>Macronutrients (Output):</strong> Includes Protein, Total Fat, and Total Carbohydrates. These are the main nutrients that provide energy.</li>
<li><strong>Micronutrients (Output):</strong> Includes vitamins and minerals (like Sodium, Cholesterol, Vitamin D, etc.) essential for health in smaller amounts.</li>
<li><strong>% Daily Value (Output):</strong> The percentage of a nutrient in one serving, based on a 2,000-calorie daily diet, as recommended by the FDA.</li>
</ul>

<h2>How It Works: A Step-by-Step Example</h2>
<p>Let's analyze a simple recipe for "Simple Tomato Sauce" that yields 4 servings.</p>
<ol>
<li><strong>Step 1: Enter Ingredients.</strong> A user pastes the following into the text area:
<pre class="bg-gray-100 p-2 rounded">
1 tbsp olive oil
1 small onion, chopped
2 cloves garlic, minced
1 (28 ounce) can crushed tomatoes
1 tsp dried oregano
</pre>
</li>
<li><strong>Step 2: Enter Servings.</strong> The user enters <strong>4</strong> into the "Number of Servings" field.</li>
<li><strong>Step 3: Calculate.</strong> The user clicks "Calculate Nutrition".</li>
<li><strong>Step 4: Analysis.</strong> The tool sends this list to the nutrition API. The API analyzes each line and returns the *total* nutritional data for the entire pot of sauce. For example, it might find the totals are:
<ul>
<li><strong>Total Calories:</strong> 240 kcal</li>
<li><strong>Total Fat:</strong> 15g</li>
<li><strong>Total Carbs:</strong> 25g</li>
<li><strong>Total Protein:</strong> 5g</li>
</ul>
</li>
<li><strong>Step 5: Final Result.</strong> The calculator divides these totals by 4 to provide the "per serving" nutrition:
<ul>
<li><strong>Calories per Serving:</strong> 60 kcal ($240 / 4$)</li>
<li><strong>Fat per Serving:</strong> 3.75g ($15 / 4$)</li>
<li><strong>Carbs per Serving:</strong> 6.25g ($25 / 4$)</li>
<li><strong>Protein per Serving:</strong> 1.25g ($5 / 4$)</li>
</ul>
</li>
</ol>
<p>The tool then displays these values in the results cards and the detailed nutrition table.</p>

<h2>Frequently Asked Questions</h2>
<details>
<summary>How accurate is this calculator?</summary>
<p>This calculator provides a very good estimate based on high-quality, standardized food databases (like the USDA's). However, true nutrition can vary based on the specific brand of ingredient, the freshness of produce, and cooking methods (e.g., how much oil is actually absorbed during frying).</p>
</details>
<details>
<summary>Why are the results different from myfitnesspal or other apps?</summary>
<p>Different apps use different food databases. Some rely on user-submitted data, which can be inaccurate. This tool uses a professional, curated database, which may differ from crowd-sourced entries. Always check the data source for any nutrition app you use.</p>
</details>
<details>
<summary>My ingredient wasn't recognized. What should I do?</summary>
<p>The Natural Language Processing (NLP) is powerful but can sometimes get confused by vague or complex entries. Try to be more specific. For example, instead of "chicken," write "100g boneless skinless chicken breast." If an ingredient is missed, the total nutrition will be underestimated.</p>
</details>
<details>
<summary>Does this account for nutrients lost during cooking?</summary>
<p>No. This calculator analyzes the *raw ingredients* you provide. It does not account for nutrient degradation from heat (like Vitamin C loss) or changes in weight from water evaporation or absorption. For most macronutrient calculations, this provides a reliable baseline.</p>
</details>
<details>
<summary>What if my recipe lists a range, like "1-2 tbsp olive oil"?</summary>
<p>For the most accurate result, enter a specific amount. The calculator will likely interpret a range as the first number (e.g., "1 tbsp"). If you want to know the "worst-case" scenario, use the higher value ("2 tbsp") in your entry.</p>
</details>

<div class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600">
<p><strong>Tool developed by Ugo Candido.</strong> Nutrition content and methodology verified by the CalcDomain Editorial Board.<br>
Last accuracy review: <time datetime="2025-10-29">October 29, 2025</time></p>
</div>
</article>
</section>

<aside class="w-full lg:w-1/3">
<div class="sticky top-24 space-y-6">
<div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center text-gray-500">
Ad Placement (300×600)
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-3">Why use this calculator</h3>
<ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
<li>Get instant, accurate macro and calorie counts.</li>
<li>Analyze recipes without manually entering each ingredient's data.</li>
<li>Make informed decisions for meal planning and dietary goals.</li>
<li>Based on authoritative data from the USDA and other global sources.</li>
</ul>
</div>
<div class="bg-white p-6 rounded-lg shadow-md">
<h3 class="font-bold text-lg mb-4">Related Nutrition Tools</h3>
<ul class="space-y-3 text-sm">
<li><a href="bmi-calculator.html" class="text-blue-600 hover:underline">BMI Calculator</a></li>
<li><a href="tdee-calculator.html" class="text-blue-600 hover:underline">TDEE Calculator (Calorie Needs)</a></li>
<li><a href="macro-calculator.html" class="text-blue-600 hover:underline">Macronutrient Calculator</a></li>
<li><a href="body-fat-calculator.html" class="text-blue-600 hover:underline">Body Fat Calculator</a></li>
</ul>
</div>
</div>
</aside>
</div>
</main>

<footer class="bg-white border-t">
<div class="container mx-auto px-6 py-8 text-center text-gray-600 text-sm">
<p>&copy; 2025 CalcDomain. All Rights Reserved.</p>
<div class="mt-4 space-x-4">
<a href="about.html" class="hover:text-blue-600">About</a>
<a href="contact.html" class="hover:text-blue-600">Contact</a>
<a href="privacy.html" class="hover:text-blue-600">Privacy</a>
<a href="terms.html" class="hover:text-blue-600">Terms</a>
</div>
</div>
</footer>

<script defer>
document.addEventListener('DOMContentLoaded', () => {
// --- API Credentials ---
// NOTA: Questi sono placeholder. Sostituire con le vere chiavi API di Edamam.
const API_ID = 'YOUR_EDAMAM_APP_ID';
const API_KEY = 'YOUR_EDAMAM_APP_KEY';
const API_URL = `https://api.edamam.com/api/nutrition-details?app_id=${API_ID}&app_key=${API_KEY}`;

// --- Element References ---
const form = document.getElementById('nutrition-form');
const ingredientInput = document.getElementById('ingredient-list');
const servingsInput = document.getElementById('servings');
const calculateBtn = document.getElementById('calculate-btn');
const resultsContainer = document.getElementById('results-container');
const loadingSpinner = document.getElementById('loading-spinner');
const apiErrorDisplay = document.getElementById('api-error');
const apiErrorMessage = document.getElementById('api-error-message');
const resultsContent = document.getElementById('results-content');
const ingredientError = document.getElementById('ingredient-error');
const servingsError = document.getElementById('servings-error');

// Result Elements
const totalCalories = document.getElementById('total-calories');
const servingCalories = document.getElementById('serving-calories');
const totalProtein = document.getElementById('total-protein');
const servingProtein = document.getElementById('serving-protein');
const totalFat = document.getElementById('total-fat');
const servingFat = document.getElementById('serving-fat');
const totalCarbs = document.getElementById('total-carbs');
const servingCarbs = document.getElementById('serving-carbs');
const tableBody = document.getElementById('nutrition-table-body');
const chartCtx = document.getElementById('resultsChart').getContext('2d');
let resultsChart = null;

// --- Helper Functions ---
const fmtNum = (val, digits = 0) => (val || 0).toFixed(digits);

// Show/Hide Validation Error
function setFieldError(field, errorEl, message) {
if (message) {
errorEl.textContent = message;
errorEl.style.display = 'block';
field.setAttribute('aria-invalid', 'true');
field.classList.add('border-red-500');
} else {
errorEl.style.display = 'none';
field.setAttribute('aria-invalid', 'false');
field.classList.remove('border-red-500');
}
}

// Set Loading State
function setLoading(isLoading) {
resultsContainer.setAttribute('aria-busy', isLoading.toString());
if (isLoading) {
calculateBtn.disabled = true;
calculateBtn.textContent = 'Calculating...';
loadingSpinner.style.display = 'block';
apiErrorDisplay.style.display = 'none';
resultsContent.style.display = 'none';
} else {
calculateBtn.disabled = false;
calculateBtn.textContent = 'Calculate Nutrition';
loadingSpinner.style.display = 'none';
}
}

// --- Form Validation ---
function validateForm() {
let isValid = true;
const ingredients = ingredientInput.value.trim();
const servings = parseInt(servingsInput.value, 10);

if (!ingredients) {
setFieldError(ingredientInput, ingredientError, 'Please enter an ingredient list.');
isValid = false;
} else {
setFieldError(ingredientInput, ingredientError, null);
}

if (isNaN(servings) || servings < 1) {
setFieldError(servingsInput, servingsError, 'Servings must be a number of 1 or more.');
isValid = false;
} else {
setFieldError(servingsInput, servingsError, null);
}

return isValid;
}

// --- API Call ---
async function fetchNutritionData(ingredients, servings) {
if (API_ID === 'YOUR_EDAMAM_APP_ID' || API_KEY === 'YOUR_EDAMAM_APP_KEY') {
console.error('API keys are not configured.');
// Mock error for demo purposes
setLoading(false);
showApiError("Calculator not configured. Please add valid API keys to the JavaScript.");
return;
}

setLoading(true);
const ingredientList = ingredients.split('\n').filter(line => line.trim().length > 0);

try {
const response = await fetch(API_URL, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ ingr: ingredientList })
});

if (!response.ok) {
const errorData = await response.json();
throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
}

const data = await response.json();
processAndRenderResults(data, servings);

} catch (error) {
console.error('Fetch error:', error);
setLoading(false);
showApiError(error.message);
}
}

// --- Render Functions ---
function showApiError(message) {
apiErrorMessage.textContent = `Error: ${message}. Please check your ingredient list for typos or try again.`;
apiErrorDisplay.style.display = 'block';
resultsContent.style.display = 'none';
}

function processAndRenderResults(data, servings) {
const nutrients = data.totalNutrients;
const daily = data.totalDaily;

const getNutrient = (key) => nutrients[key] || { quantity: 0, unit: 'g' };
const getDaily = (key) => daily[key] || { quantity: 0 };

// Main Macros
const totalCalsData = { quantity: data.calories, unit: 'kcal' };
const totalProteinData = getNutrient('PROCNT');
const totalFatData = getNutrient('FAT');
const totalCarbsData = getNutrient('CHOCDF'); // Total Carbs
const totalFiberData = getNutrient('FIBTG');
const totalSugarsData = getNutrient('SUGAR');
const totalSatFatData = getNutrient('FASAT');
const totalTransFatData = getNutrient('FATRN');
const totalCholesterolData = getNutrient('CHOLE');
const totalSodiumData = getNutrient('NA');
const totalVitaminDData = getNutrient('VITD');
const totalCalciumData = getNutrient('CA');
const totalIronData = getNutrient('FE');
const totalPotassiumData = getNutrient('K');

// Update Summary Cards
totalCalories.textContent = fmtNum(totalCalsData.quantity, 0);
servingCalories.textContent = fmtNum(totalCalsData.quantity / servings, 0);

totalProtein.textContent = `${fmtNum(totalProteinData.quantity, 0)}${totalProteinData.unit}`;
servingProtein.textContent = `${fmtNum(totalProteinData.quantity / servings, 1)}${totalProteinData.unit}`;

totalFat.textContent = `${fmtNum(totalFatData.quantity, 0)}${totalFatData.unit}`;
servingFat.textContent = `${fmtNum(totalFatData.quantity / servings, 1)}${totalFatData.unit}`;

totalCarbs.textContent = `${fmtNum(totalCarbsData.quantity, 0)}${totalCarbsData.unit}`;
servingCarbs.textContent = `${fmtNum(totalCarbsData.quantity / servings, 1)}${totalCarbsData.unit}`;

// Update Detailed Table
tableBody.innerHTML = '';
const tableRows = [
{ label: 'Total Fat', total: totalFatData, daily: getDaily('FAT') },
{ label: 'Saturated Fat', total: totalSatFatData, daily: getDaily('FASAT'), indent: true },
{ label: 'Trans Fat', total: totalTransFatData, daily: getDaily('FATRN'), indent: true },
{ label: 'Cholesterol', total: totalCholesterolData, daily: getDaily('CHOLE') },
{ label: 'Sodium', total: totalSodiumData, daily: getDaily('NA') },
{ label: 'Total Carbohydrate', total: totalCarbsData, daily: getDaily('CHOCDF') },
{ label: 'Dietary Fiber', total: totalFiberData, daily: getDaily('FIBTG'), indent: true },
{ label: 'Total Sugars', total: totalSugarsData, daily: getDaily('SUGAR'), indent: true },
{ label: 'Protein', total: totalProteinData, daily: getDaily('PROCNT') },
{ label: 'Vitamin D', total: totalVitaminDData, daily: getDaily('VITD') },
{ label: 'Calcium', total: totalCalciumData, daily: getDaily('CA') },
{ label: 'Iron', total: totalIronData, daily: getDaily('FE') },
{ label: 'Potassium', total: totalPotassiumData, daily: getDaily('K') }
];

tableRows.forEach(row => {
const tr = document.createElement('tr');
tr.className = 'border-t border-gray-200';
tr.innerHTML = `
<td class="px-4 py-2 text-left ${row.indent ? 'pl-8' : 'font-semibold'}">${row.label}</td>
<td class="px-4 py-2 text-right">${fmtNum(row.total.quantity, 1)} ${row.total.unit}</td>
<td class="px-4 py-2 text-right">${fmtNum(row.total.quantity / servings, 1)} ${row.total.unit}</td>
<td class="px-4 py-2 text-right font-semibold">${fmtNum(row.daily.quantity / servings, 0)}%</td>
`;
tableBody.appendChild(tr);
});

// Update Chart
// Calories from macros: Fat=9cal/g, Protein=4cal/g, Carbs=4cal/g
const fatCals = totalFatData.quantity * 9;
const proteinCals = totalProteinData.quantity * 4;
const carbCals = totalCarbsData.quantity * 4;

const chartData = {
labels: ['Fat', 'Protein', 'Carbs'],
datasets: [{
data: [fatCals, proteinCals, carbCals],
backgroundColor: ['#f97316', '#2563eb', '#16a34a'],
}]
};

if (resultsChart) {
resultsChart.data = chartData;
resultsChart.update();
} else {
resultsChart = new Chart(chartCtx, {
type: 'doughnut',
data: chartData,
options: {
plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } },
responsive: true,
maintainAspectRatio: false,
cutout: '60%'
}
});
}

// Show results
setLoading(false);
apiErrorDisplay.style.display = 'none';
resultsContent.style.display = 'block';
// Scroll to results on mobile
window.scrollTo({ top: resultsContainer.offsetTop - 20, behavior: 'smooth' });
}

// --- Event Listeners ---
form.addEventListener('submit', (e) => {
e.preventDefault();
if (validateForm()) {
const ingredients = ingredientInput.value.trim();
const servings = parseInt(servingsInput.value, 10);
fetchNutritionData(ingredients, servings);
}
});

// Inline validation on blur
ingredientInput.addEventListener('blur', () => validateForm());
servingsInput.addEventListener('blur', () => validateForm());

// Mobile menu toggle
const menuToggle = document.getElementById('mobile-menu-toggle');
const mobileMenu = document.getElementById('mobile-menu');
if(menuToggle) {
menuToggle.addEventListener('click', () => {
const isHidden = mobileMenu.classList.contains('hidden');
mobileMenu.classList.toggle('hidden', !isHidden);
menuToggle.setAttribute('aria-expanded', isHidden.toString());
});
}

// Accessible Tooltip toggle
document.querySelectorAll('.tooltip-btn').forEach(btn => {
const tooltip = btn.nextElementSibling;
btn.addEventListener('click', (e) => {
e.preventDefault();
const isVisible = tooltip.style.visibility === 'visible';
tooltip.style.visibility = isVisible ? 'hidden' : 'visible';
tooltip.style.opacity = isVisible ? '0' : '1';
});
// Hide on focus out for keyboard users
btn.addEventListener('blur', () => {
tooltip.style.visibility = 'hidden';
tooltip.style.opacity = '0';
});
});
});
</script>

</body>
</html>